(function(){function r(s,l,c){function o(t,e){if(!l[t]){if(!s[t]){var a="function"==typeof require&&require
if(!e&&a)return a(t,!0)
if(_)return _(t,!0)
var i=new Error("Cannot find module '"+t+"'")
throw i.code="MODULE_NOT_FOUND",i}var n=l[t]={exports:{}}
s[t][0].call(n.exports,function(e){return o(s[t][1][e]||e)},n,n.exports,r,s,l,c)}return l[t].exports}for(var _="function"==typeof require&&require,e=0;e<c.length;e++)o(c[e])
return o}return r})()({1:[function(e,t,r){"use strict"
r.abTestsFBLoginButton=abTestsFBLoginButton
var a=e("../glov/client/abtests_client").abTestsGetSplitGroup
var i=e("../glov/client/engine.js")
var o=e("../common/abtests_worlds_common")
var n=o.FBLoginButtonTestGroups
var s=o.FB_LOGIN_BUTTON_TEST
function abTestsFBLoginButton(){return i.defines.FBWEBLOGIN||a(s)===n.Show}},{"../common/abtests_worlds_common":189,"../glov/client/abtests_client":237,"../glov/client/engine.js":250}],2:[function(e,t,r){"use strict"
r.accessControlStartup=accessControlStartup
r.accessControlGetUserContext=accessControlGetUserContext
r.accessControlGetUser=accessControlGetUser
r.accessControlRun=accessControlRun
r.doAccessControl=doAccessControl
var a=e("../glov/client/cmds.js").cmd_parse
var i=e("./editvolume_client.js"),O=i.editVolumeAddHereCmd,b=i.editVolumeClearContents,N=i.editVolumeDefaultAccess,o=i.editVolumeForPos
var n=e("../common/editvolume_common.js"),u=n.EDITVOLUME_MAX_SIZE,d=n.volumeContainsPoint
var C=e("../glov/client/engine.js")
var f=e("../common/globals.js").CHUNK_SIZE
var M=e("../glov/client/input.js")
var s=e("./layout.js"),D=s.layoutCameraCurX1,P=s.layoutCameraCurY1,k=s.layoutWide
var B=e("./localization/localization").L
var l=e("./main.js"),c=l.charControllerPos,U=l.menuExit,_=l.toggleMenuPage
var G=e("./main_menu.js").getWorldInfo
var v=Math.abs,F=Math.max
var h=e("./menu.js"),p=h.ACCESS_CONTROL,m=h.menuInteractGetPos,g=h.menuPanelX0
var E=e("../glov/client/net.js").netSubs
var W=e("../glov/client/selection_box.js").dropDownCreate
var j=e("../glov/client/scroll_area.js").scrollAreaCreate
var H=e("./status.js")
var y=e("./styles.js"),T=y.color_line,z=y.label_style,V=y.label_warning_style,Y=y.menu_header_style
var q=e("../glov/client/ui.js")
var K=e("./ui_util.js")
var I=e("./user_data.js"),X=I.areaClearAllowed,Q=I.manageVolumesAllowed
var J=e("../glov/common/util.js").nop
var S=e("../glov/common/vmath.js"),A=S.vec3,w=S.v3add
var L=e("./voxel_data.js").worldPosFromLocalPos
var R=e("./waygate_ui.js"),$=R.PAD,ee=R.FONT_HEIGHT
var x=e("./world_comm.js"),te=x.getWorldID,re=x.worldGetRoles
var ae=e("../common/world_constants.js"),ie=ae.ACCESS_READONLY,oe=ae.ACCESS_BUILDER,ne=ae.ACCESS_ADMIN,se=ae.ACCESS_OWNER,le=ae.VOLUME_SETTLEMENT_PREFIX,ce=ae.WORLD_ACCESS_MODIFY_LIMITED
var _e=e("./world_info_view.js"),ue=_e.accessString,de=_e.worldGetUserList,fe=_e.worldCmdParseGated,ve=_e.worldInfoModifyingAccess,he=_e.displayUserList
var pe
var me
function accessControlStartup(){pe=q.font
me=q.title_font}a.register({cmd:"area_access_control",help:"Open the Area Access Control interface",access_run:["world_areabuilder"],func:function func(e,t){_(p)
t()}})
var ge=[{name:B.LBL_ACCESS_PRESET_READONLY,tag:"readonly"},{name:B.LBL_ACCESS_PRESET_BUILD,tag:"builder"}]
var Ee=100
var ye=254
function lineSep(e,t,r){q.drawLine(e-40,t,e+40,t,r+.1,2,1,T)
return 8}var Te
var Ie
var Se
function userAccessFromVolume(e,t){var r=e&&e.access&&e.access.ids
if(r){var a=r[t]
if(a){Se=false
return a.level}}Se=true
return N(e)}function accessControlGetUserContext(){var e=re().world_admin
if(!Te)return{is_world_admin:e}
var t=userAccessFromVolume(Te,E().getUserId())
return{my_volume_access:t,is_world_admin:e,is_volume_admin:t>=ne,is_volume_owner:t>=se,mcid:null==Te?void 0:Te.mcid,volume_id:null==Te?void 0:Te.volume_id}}var Ae={loading:false,allow_actions:false}
function accessControlGetUser(e,t,r){if(!Te)return Ae
var a=e.is_world_admin,i=e.is_volume_admin,o=e.my_volume_access
if(!a&&!i)return Ae
var n=ve()
var s=false
if(a&&t!==E().getUserId())s=true
var l=userAccessFromVolume(Te,t)
var c=Se
if(i&&o>l)s=true
if(!a)if(Ie[t])if(Ie[t].world_admin)s=false
return{loading:n,allow_actions:s,access:ue(l),access_from_default:c}}function volumeLost(){U()
H.push(B.ACCESSCONTROL_AREA_LOST)}var we=[B.LBL_AREA_COORDS_X,B.LBL_AREA_COORDS_Y,B.LBL_AREA_COORDS_Z]
function displayResizeControls(e){var s=e.edit_volume,n=e.x,t=e.w,l=e.y,c=e.local_pos
var r=n
var a=.3*t
var _=ve()
function mod(e,t,r){var a={min:s.min.slice(0),max:s.max.slice(0)}
a[t][e]+=r*f
var i="world_volume_bounds "+s.mcid+" "+s.volume_id+" "+a.min+" "+a.max
var o=false
if(c){var n=L(A(),c)
if(d(s,n)&&!d(a,n))o=true}if(o)q.modalDialog({text:B.DLG_MOVE_WARN_MSG,buttons:{ok:function ok(){fe(i,volumeLost)},cancel:null}})
else fe(i,J)}function button(e,t,r){var a="min"===t?"max":"min"
var i=s[t][e]+r*f
var o=s[a][e]
if(q.buttonText({x:n,y:l,w:Ee,h:Ee,font_height:Ee,disabled:_||i===o||v(i-o)>u,text:r<0?"-":"+"}))mod(e,t,r)
n+=Ee+$}function text(e,t,r){if(r)pe.draw({style:Y,x:n,y:l-ee,w:e,align:pe.ALIGN.HCENTERFIT,size:ee,text:r})
pe.draw({style:z,x:n,y:l,w:e,h:Ee,align:pe.ALIGN.HVCENTERFIT,size:ee,text:t})
n+=e+$}var i=Ee
l+=$+ee
for(var o=0;o<3;++o){n=r+(t-a-2*i-4*Ee-6*$)/2
button(o,"min",-1)
text(i,String(s.min[o]),0===o&&B.LBL_AREA_COORDS_MIN)
button(o,"min",1)
text(a,B.$(we[o],s.max[o]-s.min[o]),0===o&&B.LBL_AREA_COORDS_SIZE)
button(o,"max",-1)
text(i,String(s.max[o]),0===o&&B.LBL_AREA_COORDS_MAX)
button(o,"max",1)
l+=Ee+$}return l}var Le
var Re
var xe
var Oe
function accessControlRun(e,t,r,a){var i
var o=Oe!==C.frame_index-1
if(o){xe=false
if(Re)Re.resetScroll()}Oe=C.frame_index
if(!o&&Te&&!r){volumeLost()
return}Te=r
var n=Q()
var s=Z.UI
var l=D()-e
var c=e+l/2
var _=e+l/3
var u=t+8
var d=ve()
if(!r&&!n){u+=pe.draw({style:V,x:e,y:u,z:s,w:l,size:ee,align:pe.ALIGN.HWRAP|pe.ALIGN.HCENTER,text:B.ACCESSCONTROL_CANNOT_CREATE})+$
return}if(!r){if(q.buttonText({text:B.BTN_CREATE_AREA,font_height:ee,w:q.button_width,h:Ee,x:c-q.button_width/2,y:u,disabled:d}))fe(O(null,a),J)
return}var f=accessControlGetUserContext().is_volume_admin||n
var v=r.volume_id.startsWith(le)
var h=n&&!v
var p=N(r)
if(f){pe.draw({style:z,x:_-8,y:u,z:s,h:Ee,size:ee,align:pe.ALIGN.HRIGHT|pe.ALIGN.VCENTER,text:B.LBL_ACCESS_PRESET})
if(!Le)Le=W({z:Z.UI,width:2*ye,auto_reset:false,entry_height:Ee,display:{centered:true},items:ge,font_height:ee})
if(!d&&!Le.dropdown_visible)Le.selected=p===ie?0:1
Le.run({x:_,y:u,disabled:d})
if(Le.was_clicked&&!d)if("builder"===Le.getSelected().tag)fe("world_volume_access "+r.mcid+" "+r.volume_id+" default BUILDER",J)
else fe("world_volume_access "+r.mcid+" "+r.volume_id+" default READONLY",J)
u+=Ee+$}else u+=pe.draw({style:V,x:e,y:u,z:s,w:l,size:ee,align:pe.ALIGN.HWRAP|pe.ALIGN.HCENTER,text:B.ACCESSCONTROL_CANNOT_MANAGE})+$
u+=$
var m=e
var g=l
var E=P()-u
if(k()){m+=(g-1e3)/2
g=1e3}if(!Re)Re=j({auto_hide:true,background_color:null})
Re.begin({x:m,y:u,w:g,h:E})
u=0
c=g/2
var y=g-Re.barWidth()
if(f){var T
if(p===ie)T=B.ACCESSCONTROL_READONLY_NOTE
if(!T&&p===oe){var I=G(te(),true)
if(I)if(I.access_modify!==ce)T=B.ACCESSCONTROL_WORLD_PRESET_NOTE}if(T)u+=pe.draw({style:z,x:0,y:u,z:s,w:g,size:ee,align:pe.ALIGN.HWRAP|pe.ALIGN.HCENTER,text:T})+$}if(h){if(q.button({img:K.sprite,frame:K.LOCK,x:c-Ee-$/2,y:u,w:Ee,h:Ee,tooltip:B.TLTP_CHANGE_ACCESS,font_height:ee,disabled:d||!xe}))xe=false
if(q.button({img:K.sprite,frame:K.RESIZE,x:c+$/2,y:u,w:Ee,h:Ee,tooltip:B.LBL_RESIZE_OR_DELETE_AREA,font_height:ee,disabled:d||xe}))xe=true
u+=Ee+$}else xe=false
var S=(null==(i=r.access)?void 0:i.ids)||{}
var A=N(r)
Ie={}
function clientIdsToVolumeAccess(e){var t=e.user_id,r=e.roles
if(!r.world_areabuilder)return null
Ie[t]=r
var a
if(S[t])a=S[t].level
else a=A
if(r.world_admin)a=F(a,ne)
return ue(a)}if(xe){me.drawSizedAligned(Y,c,u,s+1,1.5*ee,pe.ALIGN.HCENTER,0,0,B.LBL_RESIZE_OR_DELETE_AREA)
u+=1.5*ee+8
u+=lineSep(c,u,s)
u=displayResizeControls({edit_volume:r,x:0,w:g,y:u,local_pos:a})
var w=X()
if(q.buttonText({text:B.addEllipsis(B.BTN_DELETE_AREA),font_height:ee,w:ye,h:Ee,x:c-(w?ye+$/2:ye/2),y:u,disabled:d}))q.modalDialog({title:B.DLG_DELETE_AREA_TITLE,text:B.DLG_DELETE_AREA_MSG,buttons:{yes:{cb:function cb(){fe("world_volume_delete "+r.mcid+" "+r.volume_id,J)
U()},in_event_cb:!M.touch_mode?M.pointerLockEnter:null},no:null}})
if(w&&q.buttonText({text:B.addEllipsis(B.BTN_CLEAR_AREA),font_height:ee,w:ye,h:Ee,x:c+$/2,y:u,disabled:d}))q.modalDialog({title:B.DLG_CLEAR_AREA_TITLE,text:B.DLG_CLEAR_AREA_MSG,buttons:{yes:{cb:function cb(){b(r,function(e){if(e)H.push(e)})
U()},in_event_cb:!M.touch_mode?M.pointerLockEnter:null},no:null}})}else{var L=de(S,clientIdsToVolumeAccess,!f),R=L.online_users,x=L.offline_users
if(f){me.drawSizedAligned(Y,c,u,s+1,1.5*ee,pe.ALIGN.HCENTER,0,0,B.LBL_AREA_ACCESS_FOR_NEARBY_BUILDERS)
u+=1.5*ee+8
u+=lineSep(c,u,s)
u+=he(R,{x:0,y:u,w:y,z:s,font_height:ee,row_h:Ee})}if(x.length){me.drawSizedAligned(Y,c,u+=8,s+1,1.5*ee,pe.ALIGN.HCENTER,0,0,f?B.LBL_OFFLINE_USERS:B.LBL_AREA_OWNER)
u+=1.5*ee+8
u+=lineSep(c,u,s)
u+=he(x,{x:0,y:u,w:y,z:s,font_height:ee,row_h:Ee})}}Re.end(u)}var be=[A(0,1,0),A(-1,0,0),A(0,-1,0),A(1,0,0),A(0,0,-1),A(0,0,1)]
var Ne=A()
function doAccessControl(){var e=m()
var t
if(e){var r=e[3]
if(!(t=o(e)))for(var a=0;a<be.length&&!t;++a){var i=a
if(r&&a<4)i=(a+r)%4
w(Ne,e,be[i])
t=o(Ne)}}else{e=c()
t=o(e)}accessControlRun(g(),q.button_height,t,e)
return B.LBL_AREA_ACCESS_CONTROL}},{"../common/editvolume_common.js":193,"../common/globals.js":197,"../common/world_constants.js":212,"../glov/client/cmds.js":244,"../glov/client/engine.js":250,"../glov/client/input.js":271,"../glov/client/net.js":279,"../glov/client/scroll_area.js":289,"../glov/client/selection_box.js":290,"../glov/client/ui.js":306,"../glov/common/util.js":330,"../glov/common/vmath.js":332,"./editvolume_client.js":72,"./layout.js":99,"./localization/localization":108,"./main.js":112,"./main_menu.js":113,"./menu.js":117,"./status.js":156,"./styles.js":160,"./ui_util.js":168,"./user_data.js":170,"./voxel_data.js":175,"./waygate_ui.js":179,"./world_comm.js":182,"./world_info_view.js":184}],3:[function(e,t,r){"use strict"
r.formatUserID=formatUserID
r.createAccountUI=createAccountUI
var a=e("../glov/client/external_users_client")
var ee=a.externalUsersEnabled
var te=a.externalUsersLogOut
var i=e("../common/external_users/external_users_provider_ids")
var re=i.USERS_PROVIDER_APPLE
var ae=i.USERS_PROVIDER_FACEBOOK_GAMING
var ie=i.USERS_PROVIDER_FACEBOOK_INSTANT
var oe=e("./localization/localization").L
var ne=e("./abtests_worlds_client").abTestsFBLoginButton
var se=e("../glov/client/engine.js")
var le=e("../glov/client/subscription_manager").isFirstSession
var ce=e("assert")
var _e=e("../glov/client/local_storage.js")
var ue=e("../glov/client/font.js")
var o=e("../glov/client/input.js"),de=o.click,fe=o.KEYS,ve=o.keyDownEdge,he=o.inputTouchMode
var n=e("../glov/client/link.js"),pe=n.linkGetDefaultStyle,me=n.linkText
var ge=Math.random
var s=e("../glov/client/net.js"),Ee=s.netClient,ye=s.netSubs
var Te=e("../glov/client/ui.js")
var Ie=e("../glov/common/util.js").errorString
var l=e("../glov/common/vmath.js"),c=l.vec2,Se=l.vec4
var _=e("./iframe_content_handlers.js"),Ae=_.privacyPolicyShow,we=_.termsOfServiceShow
var u=e("../glov/client/wsclient.js"),Le=u.ERR_RESTARTING,Re=u.ERR_CLIENT_VERSION_NEW,xe=u.ERR_CLIENT_VERSION_OLD
var d=e("../glov/client/sprites.js").spriteCreate
var f=e("../glov/client/client_config.js"),Oe=f.PLATFORM_FBINSTANT,be=f.PLATFORM_MOBILE,Ne=f.PLATFORM_WEB,Ce=f.PLATFORM_MSSTART
var v=e("./analytics.js"),Me=v.analyticsPostLogin,De=v.analyticsPostLogout,Pe=v.analyticsAccountCreated,ke=v.analyticsLoginFailed
var Be=e("./styles.js").helper_text_style
var Ue
var Ge=3e3
function formatUserID(e,t){var r=t||e
if(e.toLowerCase()!==r.toLowerCase())r=oe.addParenthesesAfter(t,e)
return r}function copyUserId(e,t){var r
if(!Te.copyTextToClipboard(t))Te.provideUserString(e,t)
else r=oe.MSG_COPY_TEXT_SUCCESS
return r}var Fe=false
function AccountUI(){this.edit_box_name=Te.createEditBox({placeholder:oe.LBL_USERNAME,initial_focus:true,text:_e.get("name")||"",autocomplete:"username"})
this.edit_box_password=Te.createEditBox({placeholder:oe.LBL_PASSWORD,type:"password",text:_e.get("name")&&_e.get("password")||""})
this.edit_box_password_confirm=Te.createEditBox({initial_focus:true,placeholder:oe.LBL_CONFIRM_PASSWORD,type:"password",text:"",autocomplete:"new-password"})
this.edit_box_email=Te.createEditBox({placeholder:oe.LBL_EMAIL_ADDRESS,text:"",autocomplete:"email"})
this.edit_box_display_name=Te.createEditBox({placeholder:oe.LBL_DISPLAY_NAME,text:"",autocomplete:"nickname"})
this.creation_mode=false
this.age_consented=false
this.checked_sprite=d({url:"img/ui/checkbox_checked.png",size:c(128,128),soft_error:true})
this.unchecked_sprite=d({url:"img/ui/checkbox.png",size:c(128,128),soft_error:true})
this.login_button_facebook=d({url:"img/ui/button_login_facebook.png",size:c(100,100),soft_error:true})
this.login_button_apple=d({url:"img/ui/button_login_apple.png",size:c(100,100),soft_error:true})
this.attempting_auto_login=false
this.auto_login_enabled=Oe}AccountUI.prototype.showLogin=function(e){var t=this
var d=e.x,f=e.y,v=e.style,r=e.button_height,a=e.button_width,i=e.prelogout,h=e.url_tos,p=e.url_priv,o=e.text_w,m=e.font_height,n=e.font_height_small,g=e.pad,s=e.user_id_x
m=m||Te.font_height
n=n||.75*m
r=r||Te.button_height
a=a||240
o=o||400
g=g||10
var l=this.edit_box_name,c=this.edit_box_password,_=this.edit_box_password_confirm,u=this.edit_box_email,E=this.edit_box_display_name
var y
var T=m
var I=2*T+3*g+r
function showTOS(e){if(h){ce(p)
var t=.6*m
var r=(e?oe.DISCLAIMER_CREATE_ACCOUNT:oe.DISCLAIMER_LOGIN)+" "
var a=oe.LBL_TERMS_OF_SERVICE
var i=oe.separateWords("",oe.DISCLAIMER_TOS_PP_SEPARATOR,"")
var o=oe.LBL_PRIVACY_POLICY
var n=Te.font.getStringWidth(v,t,r)
var s=pe()
var l=Te.font.getStringWidth(s,t,a)
var c=Te.font.getStringWidth(v,t,i)
var _=Te.font.getStringWidth(s,t,o)
var u=(n+l+c+_)/-2
f+=g
Te.font.drawSizedAligned(v,d+u,f,Z.UI,t,ue.ALIGN.HLEFT,0,0,r)
if(me({x:d+(u+=n),y:f,z:Z.UI,font_size:t,url:h,text:a,internal:true}))we()
Te.font.drawSizedAligned(v,d+(u+=l),f,Z.UI,t,ue.ALIGN.HLEFT,0,0,i)
if(me({x:d+(u+=c),y:f,z:Z.UI,font_size:t,url:p,text:o,internal:true}))Ae()
u+=_
f+=t+2*g}}var S=Ee()
var A=ye()
if(!S.connected)if(S.connect_error===Le||S.connect_error===Re)y=oe.LOGINMSG_SERVER_RESTARTING
else if(S.connect_error===xe)y=Oe?oe.LOGINMSG_NEW_VERSION+"\n"+oe.LOGINMSG_RESTART_OR_UPDATE_APP:be?oe.LOGINMSG_NEW_VERSION+"\n"+oe.LOGINMSG_UPDATE_APP:Ne?oe.LOGINMSG_NEW_VERSION+"\n"+oe.LOGINMSG_RELOAD_PAGE:oe.LOGINMSG_UNDER_MAINTENANCE+"\n"+oe.LOGINMSG_TRY_AGAIN
else y=oe.LOGINMSG_CONNECTING
else if(A.logging_in||this.attempting_auto_login)y=oe.LOGINMSG_LOGGING_IN
else if(A.logging_out)y=oe.LOGINMSG_LOGGING_OUT
else if(!A.loggedIn()&&!this.attempting_auto_login&&this.auto_login_enabled){this.attempting_auto_login=true
var w
var L
var R=function login_cb(e){if(e){Te.modalDialog({title:oe.$(oe.DLG_PLATFORM_LOGIN_FAILED_TITLE,L),text:Ie(e),buttons:{retry:{cb:function cb(){return t.attempting_auto_login=false}}}})
ke(e,w)}else{if(le())Pe(A.loggedIn(),w)
Me(A.loggedIn(),w)
t.attempting_auto_login=false}}
if(Oe){w="facebook"
L="Facebook"
A.loginExternal(ie,R)}}else if(!A.loggedIn()&&A.auto_create_user&&!_e.get("did_auto_anon")&&!_e.get("name")){y=oe.LOGINMSG_AUTO_LOGGING_IN
_e.set("did_auto_anon","yes")
var x="anon"+String(ge()).slice(2,8)
var O="test"
_e.set("name",x)
A.login(x,O,function(e){if(e){Te.modalDialog({title:oe.DLG_AUTO_LOGGIN_FAILED_TITLE,text:Ie(e),buttons:{retry:{cb:function cb(){_e.set("did_auto_anon",void 0)
_e.set("name",void 0)}},cancel:null}})
ke(e,"auto")}else{Pe(A.loggedIn(),"auto")
Me(A.loggedIn(),"auto")
A.sendCmdParse("rename_random",function(e){if(e)console.log(e)})}})}else if(!A.loggedIn()){if(A.auto_login_error&&!Fe){Fe=true
ke(A.auto_login_error,"worlds_auto")}var b=.25*o
var N=d-1.5*b+b
var C=g/2
var M=N-g
var D=ue.ALIGN.HRIGHT
var P=N+C
var k=2*b
var B=.6*m
var U=Te.font.getStringWidth(v,B,oe.AGE_CONSENTMENT)
var G=U/-2
var F=d-a-C
var W=d+C
var j=false
Te.font.drawSizedAligned(v,M,f,Z.UI,m,D,0,0,oe.addColon(oe.LBL_USERNAME))
j=l.run({x:P,y:f,w:k,font_height:m})===l.SUBMIT||j
f+=T+g
Te.font.drawSizedAligned(v,M,f,Z.UI,m,D,0,0,oe.addColon(oe.LBL_PASSWORD))
j=c.run({x:P,y:f,w:k,font_height:m,autocomplete:this.creation_mode?"new-password":"current-password"})===c.SUBMIT||j
f+=T+g
if(this.creation_mode){Te.font.drawSizedAligned(v,M,f,Z.UI,m,D,0,0,oe.addColon(oe.LBL_CONFIRM_PASSWORD))
j=_.run({x:P,y:f,w:k,font_height:m})===c.SUBMIT||j
f+=T+g
Te.font.drawSizedAligned(v,M,f,Z.UI,m,D,0,0,oe.addColon(oe.LBL_EMAIL_ADDRESS))
j=u.run({x:P,y:f,w:k,font_height:m})===c.SUBMIT||j
f+=T+g
Te.font.drawSizedAligned(v,M,f,Z.UI,m,D,0,0,oe.addColon(oe.LBL_DISPLAY_NAME))
j=E.run({x:P,y:f,w:k,font_height:m})===c.SUBMIT||j
if(Te.buttonText({x:P+k+g,y:f,w:.5*a,h:T+g-2,font_height:n,text:oe.BTN_RANDOM}))S.send("random_name",null,function(e,t){if(t)E.setText(t)})
f+=T+g
showTOS(true)
Te.font.drawSizedAligned(v,d+G,f+g,Z.UI,B,ue.ALIGN.HLEFT,0,0,oe.AGE_CONSENTMENT)
if(Te.buttonImage({x:d+G+U,y:f,w:.5*a,h:T+g-2,no_bg:true,shrink:1,img:this.age_consented?this.checked_sprite:this.unchecked_sprite}))this.age_consented=!this.age_consented
f+=T+g
j=Te.buttonText({x:F,y:f,w:a,h:r,font_height:m,text:oe.BTN_CREATE_USER,disabled:!this.age_consented})||j
if(Te.buttonText({x:W,y:f,w:a,h:r,font_height:m,text:oe.BTN_CANCEL})||ve(fe.ESC)){this.creation_mode=false
this.age_consented=false}f+=r+g
if(j&&this.age_consented){_e.set("name",l.text)
A.userCreate({user_id:l.text,email:u.text,password:c.text,password_confirm:_.text,display_name:E.text},function(e){if(e){ke(e,"worlds_sign_up")
Te.modalDialog({title:oe.DLG_LOGIN_ERROR_TITLE,text:Ie(e),buttons:{ok:null}})}else{t.creation_mode=false
_.setText("")
u.setText("")
E.setText("")
Me(A.loggedIn(),"worlds_sign_up")
Pe(A.loggedIn())}})}}else{showTOS(false)
j=Te.buttonText({x:F,y:f,w:a,h:r,font_height:m,text:oe.BTN_LOGIN})||j
if(Te.buttonText({x:W,y:f,w:a,h:r,font_height:m,text:oe.BTN_NEW_USER})){this.creation_mode=true
E.setText(l.text)
if(l.text&&c.text)_.initial_focus=true
else{_.initial_focus=false
l.focus()}}f+=r+g
var H=ee(ae)
H=H&&ne()&&!Ce
var z=ee(re)
var V=(H?1:0)+(z?1:0)
if(V>0){f+=n
Te.font.drawSizedAligned(v,d,f,Z.UI,n,ue.ALIGN.HCENTER,0,0,oe.addColon(oe.LBL_EXTERNAL_LOGINS))
f+=n+g
var Y=r
var q=2*g
var K=d-(Y*V+q*(V-1))/2
if(H){if(Te.buttonImage({x:K,y:f,shrink:1,w:Y,h:r,img:this.login_button_facebook,no_bg:true}))A.loginExternal(ae,function(e){if(e){Te.modalDialog({title:oe.$(oe.DLG_PLATFORM_LOGIN_FAILED_TITLE,"Facebook"),text:Ie(e),buttons:{cancel:null}})
ke(e,"fb_but")}else{if(le())Pe(A.loggedIn(),"fb_but")
Me(A.loggedIn(),"fb_but")}})
K+=Y+q}if(z){if(Te.buttonImage({x:K,y:f,w:Y,h:r,img:this.login_button_apple,shrink:1,no_bg:true}))A.loginExternal(re,function(e){if(e){Te.modalDialog({title:oe.$(oe.DLG_PLATFORM_LOGIN_FAILED_TITLE,"Apple"),text:Ie(e),buttons:{cancel:null}})
ke(e,"apple_but")}else{if(le())Pe(A.loggedIn(),"apple_but")
Me(A.loggedIn(),"apple_but")}})
K+=Y+q}f+=r+g}if(j){_e.set("name",l.text)
A.login(l.text,c.text,function(e){if(e){Te.modalDialog({title:oe.DLG_LOGIN_ERROR_TITLE,text:Ie(e),buttons:{ok:null}})
ke(e,"worlds_sign_in")}else Me(A.loggedIn(),"worlds_sign_in")})}}}else{var X=!this.auto_login_enabled
var Q=A.loggedIn()
var J=.8*n
if(X){Me(Q,"worlds_auto")
if(Te.buttonText({x:d-.5*a,y:f,w:a,h:r,font_height:m,text:oe.BTN_LOGOUT})){c.setText("")
if(i)i()
te()
A.logout()
De("button")}f+=r+8
Te.font.drawSizedAligned(v,(s||d)-.5*o,f,Z.UI,J,ue.ALIGN.HCENTERFIT,o,0,oe.separateColon(oe.LBL_LOGGED_IN_AS,Q))
f+=J+4
Te.font.drawSizedAligned(Be,(s||d)-o/2,f,Z.UI,.7*J,ue.ALIGN.HCENTERFIT,o,0,Ue||(he()?oe.LBL_TAP_TO_COPY:oe.LBL_CLICK_TO_COPY))
if(de({x:d-o/2,y:f-=J+4,w:o,h:1.7*J,button:0}))Ue=copyUserId(oe.DLG_SHARE_USER_ID_TITLE,Q)
else if(Ue)if((Ge-=se.frame_dt)<=0){Ge=3e3
Ue=void 0}f+=J+8}else{Me(Q,"facebook")
Te.font.drawSizedAligned(v,(s||d)-.5*o,f,Z.UI,m,ue.ALIGN.HCENTER|ue.ALIGN.VCENTER|ue.ALIGN.HFIT,o,r,oe.separateColon(oe.LBL_LOGGED_IN_AS,Q))
f+=1.5*m
Te.font.drawSizedAligned(Be,(s||d)-o/2,f,Z.UI,.6*m,ue.ALIGN.HCENTERFIT,o,0,Ue||(he()?oe.LBL_TAP_TO_COPY:oe.LBL_CLICK_TO_COPY))
if(de({x:d-.5*o,y:f-=1.5*m,w:o,h:2.1*m,button:0}))Ue=copyUserId(oe.DLG_SHARE_USER_ID_TITLE,Q)
else if(Ue)if((Ge-=se.frame_dt)<=0){Ge=3e3
Ue=void 0}f+=J+8}}if(y){var $=800
Te.font.drawSizedAligned(v,d-400,f,Z.UI,1.5*m,ue.ALIGN.HVCENTERFIT|ue.ALIGN.HWRAP,$,I,y)
Te.drawRect(d-.5*($+=100),f,d+.5*$,f+I,Z.UI-.5,Se(0,0,0,.25))
f+=I}return f}
function createAccountUI(){return new AccountUI}},{"../common/external_users/external_users_provider_ids":196,"../glov/client/client_config.js":243,"../glov/client/engine.js":250,"../glov/client/external_users_client":256,"../glov/client/font.js":260,"../glov/client/input.js":271,"../glov/client/link.js":273,"../glov/client/local_storage.js":274,"../glov/client/net.js":279,"../glov/client/sprites.js":302,"../glov/client/subscription_manager":303,"../glov/client/ui.js":306,"../glov/client/wsclient.js":313,"../glov/common/util.js":330,"../glov/common/vmath.js":332,"./abtests_worlds_client":1,"./analytics.js":5,"./iframe_content_handlers.js":88,"./localization/localization":108,"./styles.js":160,assert:void 0}],4:[function(e,t,r){"use strict"
r.resetMoveTime=resetMoveTime
r.aiTick=aiTick
var s=e("assert")
var a=e("../glov/client/engine")
var i=a.getFrameDt
var o=a.getFrameTimestamp
var n=e("../glov/common/vmath")
var l=n.v3distSq
var c=n.vec3
var _=e("../common/entity_worlds_common").EntityType
var u=e("../common/globals").CHUNK_SIZE
var d=e("./client_entities").getEntityManager
var f=e("./main").charControllerPos
var v=e("./voxel_chunk_manager").getViewDist
var h=e("./voxel_data").worldPosFromLocalPos
var p=Math.PI,m=Math.random,g=Math.sin,E=Math.cos
var y=2e3
var T
var I=c()
function lastUpdatedBySomeoneElse(e){if(!e.data.seq_ai_move)return false
if(e.data.seq_ai_move.startsWith(e.entity_manager.sub_id_prefix))return false
return true}function resetMoveTime(e,t){e.next_move_time=T+500+m()*(500+(t?y:0))}function tickAI(e,t){if(e.waiting||e.hasPendingBatchUpdate())return
if(T<e.next_move_time)return
if(lastUpdatedBySomeoneElse(e))if(T-e.last_update_timestamp<y){resetMoveTime(e,false)
return}var r=e.getData("pos")
s(r)
var a=v()*u/2
if(l(r,I)>a*a)return
if(!e.home_point)e.home_point=r.slice(0)
var i=5*m()
var o=m()*p*2
var n=[e.home_point[0]+g(o)*i,e.home_point[1]-E(o)*i,0,o,0,0]
e.my_activate_time=T
resetMoveTime(e,false)
e.applyAIMove(n)}var S=o()
function aiTick(){if((T=o())<S+100)return
h(I,f())
S=T
var e=i()
var t=d().entities
for(var r in t){var a=t[Number(r)]
if(a.data.type!==_.TestingDummy)continue
tickAI(a,e)}}},{"../common/entity_worlds_common":195,"../common/globals":197,"../glov/client/engine":250,"../glov/common/vmath":332,"./client_entities":35,"./main":112,"./voxel_chunk_manager":174,"./voxel_data":175,assert:void 0}],5:[function(t,e,r){"use strict"
r.errorEvent=errorEvent
r.logEvent=logEvent
r.logEventOnce=logEventOnce
r.clearEventOnce=clearEventOnce
r.analyticsPostLogin=analyticsPostLogin
r.analyticsPostLogout=analyticsPostLogout
r.analyticsAccountCreated=analyticsAccountCreated
r.analyticsLoginFailed=analyticsLoginFailed
r.analyticsAddFieldFunction=analyticsAddFieldFunction
r.analyticsStartup=analyticsStartup
function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]
for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))e[a]=r[a]}return e}).apply(this,arguments)}var n=t("assert")
var a=t("../glov/client/client_config")
var i=a.MODE_PRODUCTION
var o=a.PLATFORM_ANDROID
var s=a.PLATFORM_IOS
var l=t("../glov/client/environments").getCurrentEnvironment
var c=t("../glov/client/fbinstant").onready
var _=t("../glov/client/net")
var u=_.netClient
var d=_.netDisconnected
var f=_.netSubs
var v=t("../glov/common/md5")
var h=t("../common/globals").ENV_PRODUCTION
var p
var m=false
var g=false
function errorEvent(e,t,r,a){n(g)
if(!m)return
if(p&&p.analytics)p.analytics.logEvent("error",{msg:e,line:t,col:r,label:a})
if(t&&r)e="["+t+","+r+"] "+e
if(a)e=e+" "+a
if(window.FBInstant)c(function(){return window.FBInstant.logEvent("error",1,{msg:e})})
if(window.gtag)window.gtag("event","exception",{description:e,fatal:false})}function logEvent(e,t,r,a,i){n(g)
if(!m)return
var o=void 0!==i&&"object"!==typeof i?{extra:i}:i
if(p&&p.analytics)p.analytics.logEvent(e,_extends({value:t,category:r,label:a},o))
if(window.FBInstant)c(function(){return window.FBInstant.logEvent(e,t,_extends({category:r,label:a},o))})
if(window.gtag)window.gtag("event",e,{event_category:r,event_label:a,value:t})}var E={}
function logEventOnce(e,t,r,a,i){if(E[e])return
E[e]=true
logEvent(e,t,r,a,i)}function clearEventOnce(e){if("*"===e){E={}
return}delete E[e]}function getRuid(t){n(f().loggedIn())
n(!d())
f().getMyUserChannel().onceSubscribe(function(e){t(e.public?e.public.ruid:void 0)})}var y=false
function analyticsPostLogin(a,i){n(g)
if(y||!m)return
y=true
getRuid(function(e){if(!e){errorEvent("RUID not present")
m=false
return}a=v(a+e)
i=i||"worlds"
if(p&&p.analytics){var t=p.globalUserId()
p.analytics.logEvent("logged_in",{newUserID:a,oldUserID:t,method:i})
p.globalUserId=function(){return a}
if(window.gtag)window.gtag("set",{user_id:p.globalUserId()})
var r=p.analytics.getPlaySessionId()
u().send("session_id",r)}})}function analyticsPostLogout(e){n(g)
if(!y||!m)return
y=false
clearEventOnce("*")
if(p){var t=p.globalUserId()
p.analytics.logEvent("logged_out",{oldUserID:t,method:e})
p.globalUserId=p.defaultGlobalUserId
if(window.gtag)window.gtag("set",{user_id:p.globalUserId()})}}var T={}
function analyticsAccountCreated(r,a){if(void 0===a)a="worlds"
n(g)
getRuid(function(e){if(!e){errorEvent("RUID not present")
m=false
return}r=v(r+e)
if(T[r])return
if(p&&p.analytics){var t=p.globalUserId()
p.analytics.logEvent("account_created",{newUserID:r,oldUserID:t,method:a})
T[r]=true}})}function analyticsLoginFailed(e,t){if(void 0===t)t="worlds"
n(g)
if(p&&p.analytics){var r=p.globalUserId()
p.analytics.logEvent("login_failed",{error:e,oldUserID:r,method:t})}}function analyticsAddFieldFunction(e,t){n(g)
if(p)p.analytics.addFieldFunction(e,t)}function analyticsStartup(){n(!g);(function(){n(!window.__FRVR)})()
t("../frvr/client/frvr-analytics.js")
if((p=window.__FRVR)&&p.analytics&&(o||s))p.analytics.setProtocolOverride("https://")
var e=l()
if(m=Boolean(i&&e&&e.name===h)){if(window.gtag&&p)window.gtag("set",{user_id:p.globalUserId()})}else console.log("Analytics are turned off")
g=true
logEvent("page_loading")}},{"../common/globals":197,"../frvr/client/frvr-analytics.js":215,"../glov/client/client_config":243,"../glov/client/environments":254,"../glov/client/fbinstant":257,"../glov/client/net":279,"../glov/common/md5":324,assert:void 0}],6:[function(e,t,r){"use strict"
r.logEventFTUE=logEventFTUE
r.FTUE=void 0
var a
function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]
for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))e[a]=r[a]}return e}).apply(this,arguments)}var i=e("../glov/client/subscription_manager").isFirstSession
var o=e("./analytics").logEvent
var n;(function(){((r.FTUE=n)||(r.FTUE=n={}))["MAIN"]="main"})()
var s=((a={})[n.MAIN]=0,a)
function logEventFTUE(e,t,r,a){if(i()&&s[e]<t){s[e]=t
o("ftue",1,void 0,void 0,_extends({ftue_type:e,step_number:t,step_name:r},a))}}},{"../glov/client/subscription_manager":303,"./analytics":5}],7:[function(e,t,r){"use strict"
r.getSkeleton=getSkeleton
r.animationStartup=animationStartup
r.Skeleton=void 0
function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]
for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))e[a]=r[a]}return e}).apply(this,arguments)}var s=e("assert")
var S=e("../glov/client/engine.js")
var o=e("../glov/client/fetch.js").fetch
var i=e("../glov/client/filewatch.js").filewatchOn
var n=e("../glov/client/net.js").netDisconnected
var a=e("../glov/client/quat.js")
var A=a.qInvert
var w=a.qLerp
var L=a.qMult
var R=a.qTransformVec3
var l=a.quat
var c=e("../glov/client/urlhash.js").getURLBase
var _=e("../glov/client/webfs.js")
var u=_.webFSGetFile
var d=_.webFSGetFileNames
var f=e("../glov/common/util.js").map01
var v=e("../glov/common/vmath.js")
var x=v.v3addScale
var O=v.v3copy
var b=v.v3lengthSq
var N=v.v3lerp
var C=v.v4copy
var h=v.vec3
var p=v.vec4
var m=e("./animation_enum.js")
var M=m.AnimEnum
var D=m.isCrouchAnim
var g=e("./client_entities.js").registerMovingAnim
var E=e("./particle_system.js").createParticleSystemWithOwner
var P=Math.min
var k;(function(e){e[e["NOT_LOADED"]=1]="NOT_LOADED"
e[e["LOADING"]=2]="LOADING"
e[e["LOADED"]=3]="LOADED"})(k=k||{})
var y="animations/animation_data/"
var T=".json"
var I=4
var B={}
var U={}
var G={}
function getSkeleton(e){return U[e]||null}var F=1/15
var W=p(-.5,.5,.5,.5)
var j=h(12,0,0)
var H=.01
function findInterval(e,t){for(var r=0;r<t.length;r++){if(r===t.length-1)return r
if(e<t[r+1].time)return r}return 0}function lerpAnimation(e,t,r,a,i,o){var n=r%i
var s=0
if((s=findInterval(n,a))===a.length-1)if(0===o.loop){O(e,a[s].pos)
C(t,a[s].value)}else{n=f(n,a[s].time,i)
N(e,n,a[s].pos,a[0].pos)
w(t,n,a[s].value,a[0].value)}else{n=f(n,a[s].time,a[s+1].time)
N(e,n,a[s].pos,a[s+1].pos)
w(t,n,a[s].value,a[s+1].value)}}function initAnimation(e,t){var r
if(t.particleSystems){r={}
for(var a=0;a<t.particleSystems.length;a++){var i=t.particleSystems[a]
var o=r[i.bone]
if(!o)o=r[i.bone]=[]
o.push(i)}}B[e]=_extends({id:e,status:k.LOADED,particleMap:r,attempts:0,last_attempt:0},t)}function loadAnimation(r,a,e){var t=Date.now()
if(!e&&t-a.last_attempt<a.attempts*a.attempts*100)return
if(n())a.attempts=0
else if(a.attempts<I&&!n()){var i=M[r].toLowerCase()
a.status=k.LOADING
o({url:""+c()+y+i+T+(a.attempts?"?retry="+a.attempts:""),response_type:"json"},function(e,t){if(e){a.status=k.NOT_LOADED
a.last_attempt=Date.now()
a.attempts++
console.error("Failed to load animation: "+i+": "+e)
if(a.attempts===I)s(false,"Exhausted attempts to load animation: "+i+" ("+e+")")}else{s(t)
initAnimation(r,t)}})}}function getLoadedAnimation(e){var t=B[e]
s(t)
s(t.status===k.LOADED)
return t}function getAnimation(e){var t=B[e]
s(t)
if(t.status===k.NOT_LOADED)loadAnimation(e,t)
return t}function getAnimId(e){var t=M[e.toUpperCase()]
s(t)
return t}var z=l()
var V=[]
var Y=function(){function Skeleton(o){this.scale=F
this.bone_root={pos:h(),rot:l()}
this.bones={}
this.animationBones=void 0
this.animationBones_old=void 0
this.last_update_frame=0
this.time=[0,0]
this.blend_start=[0,0]
this.blend_start_old=[0,0]
this.animations={}
this.animation_array=[]
this.animation_old_array=[]
this.difference=10
this.rot_old=l()
this.rot_new=l()
this.head_rot=l()
this.is_lerping=false
this.qd=l()
this.hand_pos=h()
this.hand_rot=l()
this.temp_offs=h()
this.rot_lerped=l()
this.pos_lerped=h()
this.rot_lerped_old=l()
this.pos_lerped_old=h()
this.tool_pos=h()
this.animation_particles=[]
this.costume_particles=[]
this.generation=void 0
this.variant_source=void 0
this.variant=void 0
var e=getAnimId(o.animations.default)
var t=getLoadedAnimation(e)
this.animationBones=new Array(t.animationBones.length)
this.animationBones_old=new Array(t.animationBones.length)
this.generation=o.generation
this.variant_source=o.variant_source
var n=this
function initBones(e){var t="root"===e?n.bone_root:n.bones[e]
s(t)
var r=o.bone_tree[e]
if(r)for(var a=0;a<r.length;++a){var i=r[a]
n.bones[i]={parent:t,pos:h(),rot:l()}
initBones(i)}}initBones("root")
this.animations[e]=true
if(o.animations.preloaded)for(var r=0;r<o.animations.preloaded.length;r++)this.animations[getAnimId(o.animations.preloaded[r])]=true
if(o.animations.streamed)for(var a=0;a<o.animations.streamed.length;a++)this.animations[getAnimId(o.animations.streamed[a])]=true
this.animation_array[0]=this.animation_array[1]=t
this.animationBones=t.animationBones
this.animation_old_array[0]=this.animation_old_array[1]=t
this.animationBones_old=t.animationBones
for(var i=0;i<this.animationBones.length;i++)this.animation_particles[i]=[]}var e=Skeleton.prototype
e.initParticles=function initParticles(e,t,r,a){for(var i=0;i<t.length;i++){var o=t[i]
var n=E(null,o,a)
n.fitToOwner(a,r)
e.push(n)}}
e.particleSystemRunLimb=function particleSystemRunLimb(e,t,r,a){if(S.defines.NOPARTICLES)return null
if(!e[0])this.initParticles(e,t,r,a)
for(var i=0;i<e.length;i++)e[i].updateParticleSystemOwner(a,r)
return e.length}
e.update=function update(e,t,r,a,i,o){C(z,i)
V[0]=t
V[1]=r?r:t
this.time[0]+=e
this.time[1]+=e
if(this.last_update_frame!==S.frame_index-1){C(this.head_rot,o)
C(this.rot_old,z)
C(this.rot_new,z)}this.last_update_frame=S.frame_index
if(this.animation_array[1].id===M.FALL&&(r===M.IDLE||r===M.WALK||r===M.RUN)){this.animation_old_array[1]=this.animation_array[1]
t=M.LANDING
this.animation_array[0]=getLoadedAnimation(t)
this.blend_start_old[0]=this.time[0]
this.time[0]=0
this.blend_start[0]=this.time[0]}var n
if(this.animations[V[0]]&&this.animations[V[1]])for(var s=0;s<2;s++){n=this.time[s]*this.animation_array[s].speed/this.animation_array[s].length
var l=getAnimation(V[s])
if(l.status===k.LOADED&&V[s]!==this.animation_array[s].id&&(this.animation_array[s].priority>=l.priority||n+l.blendTime/this.animation_array[s].length>=1)){this.animation_old_array[s]=this.animation_array[s]
this.animation_array[s]=l
this.blend_start_old[s]=this.time[s]
this.time[s]=0
this.blend_start[s]=this.time[s]}}A(this.qd,z)
L(this.qd,this.qd,this.rot_old)
var c=b(this.qd)
this.difference=2*Math.atan2(c,this.qd[3])
var _=.3
var u=.02
if(r!==M.IDLE)u=_=0
if(this.difference>_){C(this.rot_new,z)
this.is_lerping=true}if(this.difference<u){this.is_lerping=false
C(z,this.rot_old)}while(e>0){var d=P(e,8)
w(this.head_rot,.01*d,this.head_rot,o)
if(this.is_lerping){w(z,.005*d,this.rot_old,this.rot_new)
C(this.rot_old,z)}else C(z,this.rot_old)
e-=8}O(this.bone_root.pos,a)
C(this.bone_root.rot,z)
for(var f=0;f<this.animationBones.length;f++){var v=0
if(("leg_r"===this.animationBones[f].name||"leg_l"===this.animationBones[f].name)&&r!==M.LANDING)v=1
if(r&&D(r)&&"torso"===this.animationBones[f].name)v=1
var h=this.animation_array[v]
var p=this.animation_old_array[v]
this.animationBones_old=p.animationBones
this.animationBones=h.animationBones
lerpAnimation(this.pos_lerped,this.rot_lerped,this.time[v]*h.speed,this.animationBones[f].rotation,h.length,h)
var m=(this.time[v]-this.blend_start[v])/h.blendTime
if(m<=1){lerpAnimation(this.pos_lerped_old,this.rot_lerped_old,(this.blend_start_old[v]+this.time[v])*p.speed,this.animationBones_old[f].rotation,p.length,p)
w(this.rot_lerped,m,this.rot_lerped_old,this.rot_lerped)
N(this.pos_lerped,m,this.pos_lerped_old,this.pos_lerped)}var g=this.bones[this.animationBones[f].name]
L(g.rot,g.parent.rot,this.rot_lerped)
if("head"===this.animationBones[f].name){this.pos_lerped[0]+=H
if(1===h.additiveHead)L(g.rot,this.head_rot,this.rot_lerped)
else if(!h.additiveHead)C(g.rot,this.head_rot)}if("torso"===this.animationBones[f].name&&t===M.MINING)L(g.rot,w(this.head_rot,.5,this.head_rot,z),this.rot_lerped)
R(this.temp_offs,this.pos_lerped,g.parent.rot)
x(g.pos,g.parent.pos,this.temp_offs,this.scale)
var E=this.variant&&G[this.variant]
if(E){R(this.temp_offs,E.offs[this.animationBones[f].name],g.parent.rot)
x(g.pos,g.pos,this.temp_offs,this.scale)}var y=this.animation_particles[f]
var T=h.particleMap&&h.particleMap[this.animationBones[f].name]
if(T)this.particleSystemRunLimb(y,T,g.pos,g.rot)
else while(y.length){var I=y.pop()
if(Infinity===I.system_lifetime)I.killParticles()
else I.addParticleSystemToQueue()}}if(this.bones.arm_r){if(this.tool_pos)R(this.temp_offs,this.tool_pos,this.bones.arm_r.rot)
else R(this.temp_offs,j,this.bones.arm_r.rot)
x(this.hand_pos,this.bones.arm_r.pos,this.temp_offs,this.scale)
L(this.hand_rot,this.bones.arm_r.rot,W)}}
return Skeleton}()
r.Skeleton=Y
function getAnimIdFromFilename(e){var t=e.split("/")[2]
if(".json"===t.substring(t.length-5))t=t.slice(0,-5)
return getAnimId(t)}function loadBundledAnimation(e){var t=u(e,"jsobj")
initAnimation(getAnimIdFromFilename(e),t)}function loadSkeleton(e){var t=u(e,"jsobj")
loadBundledAnimation(""+y+t.animations.default)
if(t.animations.preloaded)for(var r=0;r<t.animations.preloaded.length;++r)loadBundledAnimation(""+y+t.animations.preloaded[r])
if(t.animations.streamed)for(var a=0;a<t.animations.streamed.length;++a){var i=getAnimId(t.animations.streamed[a])
B[i]={status:k.NOT_LOADED,attempts:0,last_attempt:0}}if(t.moving_animations)for(var o=0;o<t.moving_animations.length;++o){var n=getAnimId(t.moving_animations[o])
g(n)}var s=U[t.name]
var l=s&&s.generation||0
t.generation=++l
U[t.name]=t}function loadSkeletonVariant(e){var t=u(e,"jsobj")
G[t.name]=t}function animationReload(e){var t=getAnimIdFromFilename(e)
var r=B[t]
r.attempts=0
loadAnimation(t,r,true)}function animationStartup(){var e=d("animations/skeletons/skeleton_bases")
var t=d("animations/skeletons/skeleton_variants")
for(var r in e)loadSkeleton(e[r])
for(var a in t)loadSkeletonVariant(t[a])
i(/^animations\/animation_data\//,animationReload)
i(/^animations\/skeletons\/skeleton_bases\//,loadSkeleton)
i(/^animations\/skeletons\/skeleton_variants\//,loadSkeletonVariant)}},{"../glov/client/engine.js":250,"../glov/client/fetch.js":258,"../glov/client/filewatch.js":259,"../glov/client/net.js":279,"../glov/client/quat.js":287,"../glov/client/urlhash.js":307,"../glov/client/webfs.js":309,"../glov/common/util.js":330,"../glov/common/vmath.js":332,"./animation_enum.js":8,"./client_entities.js":35,"./particle_system.js":126,assert:void 0}],8:[function(e,t,r){"use strict"
r.isCrouchAnim=isCrouchAnim
r.isLadderAnim=isLadderAnim
r.AnimEnum=void 0
var a;(function(e){e[e["IDLE"]=1]="IDLE"
e[e["WALK"]=2]="WALK"
e[e["RUN"]=3]="RUN"
e[e["JUMP"]=4]="JUMP"
e[e["FALL"]=5]="FALL"
e[e["LANDING"]=6]="LANDING"
e[e["CROUCH_IDLE"]=7]="CROUCH_IDLE"
e[e["CROUCH_WALK"]=8]="CROUCH_WALK"
e[e["CROUCH_RUN"]=9]="CROUCH_RUN"
e[e["SWIM_IDLE"]=10]="SWIM_IDLE"
e[e["SWIM"]=11]="SWIM"
e[e["LADDER_IDLE"]=12]="LADDER_IDLE"
e[e["LADDER_CLIMB"]=13]="LADDER_CLIMB"
e[e["LADDER_SPRINT"]=14]="LADDER_SPRINT"
e[e["LADDER_SLIDE"]=15]="LADDER_SLIDE"
e[e["MINING"]=16]="MINING"
e[e["DIG"]=17]="DIG"
e[e["SIT"]=18]="SIT"
e[e["WAVE"]=19]="WAVE"
e[e["STATIC"]=20]="STATIC"
e[e["PART_THUMBNAIL"]=21]="PART_THUMBNAIL"})((r.AnimEnum=a)||(r.AnimEnum=a={}))
function isCrouchAnim(e){return e===a.CROUCH_IDLE||e===a.CROUCH_WALK||e===a.CROUCH_RUN}function isLadderAnim(e){return e===a.LADDER_IDLE||e===a.LADDER_CLIMB||e===a.LADDER_SPRINT||e===a.LADDER_SLIDE}},{}],9:[function(e,t,r){"use strict"
r.drawCostumePrep=drawCostumePrep
r.animationDrawPlayer=animationDrawPlayer
var y=e("../glov/client/engine.js")
var a=e("../glov/common/util.js")
var d=a.clone
var f=a.deepEqual
var i=e("./animation.js")
var c=i.Skeleton
var _=i.getSkeleton
var o=e("./cosmetics.js")
var v=o.DEFAULT_COSTUME
var u=o.attachInit
var h=o.canInitGeomThisFrame
var p=o.costume_dict
var m=o.instantiateCostumeData
var g=o.parts_dict
var E=e("./voxel_data_xraw.js").loadAsyncModelBinary
function setAnimDataVariant(e){for(var t=0;t<e.costume_data.attachments.length;++t)if(e.costume_data.attachments[t].bone===e.skeleton.variant_source)e.skeleton.variant=e.costume_data.attachments[t].skeleton_variant}function setAnimDataCostume(e,t,r){var a=r&&r.name||v
var i
if("custom"===a){i=r
var o=[]
for(var n=0;n<r.parts.length;n++){var s=r.parts[n].name
var l=g[s]
if(!l){s=p[v].parts[n].name
l=g[s]}var c=d(l)
if(r.parts[n].swaps&&l.available_swaps)for(var _=0;_<l.available_swaps.length;_++)if(f(l.available_swaps[_],r.parts[n].swaps)){c.swaps=r.parts[n].swaps
break}o.push(c)}i.attachments=o}else i=p[a]||p[v]
var u=r||{}
e.costume_data=m(i,u)
e.costume_mod=t.costume_mod
setAnimDataVariant(e)}function drawCostumePrep(e,t){var r=e.anim_data
var a=_("player")
if(!r)setAnimDataCostume(r=e.anim_data={skeleton:new c(a)},e,t)
else if(r.skeleton.generation!==a.generation){r.skeleton=new c(a)
setAnimDataCostume(r,e,t)}else if(r.costume_mod!==e.costume_mod)setAnimDataCostume(r,e,t)
var i=r.costume_data
if(i.fully_drawable)return true
var o=i.attachments
var n=true
for(var s=0;s<o.length;++s){var l=o[s]
if(l.drawable||!l.geom)continue
if(E(l.geom)&&h())u(l,i)
else n=false}return n}function animationDrawPlayer(e,t,r,a,i,o){var n=y.frame_dt
var s=e.draw_opts
drawCostumePrep(e,r)
var l=e.anim_data
var c=l.skeleton,_=l.costume_data
var u=t.anim_state,d=u.anim,f=u.anim_secondary
var v=e.anim_override
if(v)if((y.frame_timestamp-v.start)/v.duration>=1)e.anim_override=null
else d=v.anim
c.update(n,d,f,a,i,o)
var h=_.attachments
for(var p=0;p<h.length;++p){var m=h[p]
var g=c.bones[m.bone]
if(m.drawable){if(e.alpha<1&&p>e.alpha*h.length);else m.drawable.draw(g.pos,g.rot,7*c.scale,s)
if(m.drawable.opts.tool_pos)c.tool_pos=m.drawable.opts.tool_pos
if(m.particleSystems){if(!c.costume_particles[p])c.costume_particles[p]=[]
var E=m.particleSystems
c.particleSystemRunLimb(c.costume_particles[p],E,g.pos,g.rot)}}}return{pos:c.hand_pos,rot:c.hand_rot,animation_progress:c.time_progress}}},{"../glov/client/engine.js":250,"../glov/common/util.js":330,"./animation.js":7,"./cosmetics.js":55,"./voxel_data_xraw.js":176}],10:[function(e,t,r){"use strict"
window.glov_build_version="1675164989368"
var a=false
function onLoad(){if(a)return
a=true
window.time_load_onload=Date.now()
e("../glov/client/bootstrap.js")
e("../glov/client/worker_comm.js").startup(null,["mesh","gen","lod"])
e("./main.js").main()
window.time_load_init=Date.now()}window.addEventListener("DOMContentLoaded",onLoad)
window.onload=onLoad},{"../glov/client/bootstrap.js":238,"../glov/client/worker_comm.js":311,"./main.js":112}],11:[function(e,t,r){"use strict"
r.accessServerSpec=accessServerSpec
r.accessRequiresToken=accessRequiresToken
r.accessHasAccess=accessHasAccess
r.accessAllowFeedback=accessAllowFeedback
r.accessSubtitle=accessSubtitle
r.accessAllowNewArt=accessAllowNewArt
var a=e("./localization/localization").L
var i=e("../glov/client/client_config").PLATFORM_IOS
var o=e("../glov/client/net.js")
var n=e("./world_comm.js").getPerm
function accessServerSpec(){var e
return(null==(e=o.subs.cack_data.app_data)?void 0:e.access)||{}}function accessRequiresToken(){return accessServerSpec().token}function accessHasAccess(){if(accessRequiresToken())return n("access")
else return true}function accessAllowFeedback(){return accessServerSpec().feedback}function accessSubtitle(){return accessServerSpec().subtitle||(i?"":a.SUBTITLE_BETA)}function accessAllowNewArt(){return accessServerSpec().allow_new_art}},{"../glov/client/client_config":243,"../glov/client/net.js":279,"./localization/localization":108,"./world_comm.js":182}],12:[function(e,t,r){"use strict"
r.startup=startup
var a=e("../glov/client/cmds.js").cmd_parse
var i=e("../glov/client/settings.js")
var o=e("../glov/client/browser.js").is_discrete_gpu
var n=e("./character_controller.js").MAX_CAMERA_DISTANCE
var s={fly_relative:{default_value:0,type:a.TYPE_INT,range:[0,1]},max_jump_tap_touch:{default_value:1,type:a.TYPE_INT,range:[0,1],help:"Jump to max height with only a tap on touch controls"},max_jump_tap_kb:{default_value:0,type:a.TYPE_INT,range:[0,1],help:"Jump to max height with only a tap on keyboard controls"},ctrl_disable:{default_value:0,type:a.TYPE_INT,range:[0,1],help:"Disable Ctrl as a movement key"},camera_view:{default_value:0,type:a.TYPE_INT,range:[0,1]},camera_max_distance:{default_value:6,type:a.TYPE_FLOAT,range:[5,n]},fov_third:{default_value:60,type:a.TYPE_FLOAT,range:[40,100]},mouse_sensitivity:{default_value:1,type:a.TYPE_FLOAT,range:[.001,10]},quickbar_show_inhand:{default_value:0,ver:1,type:a.TYPE_INT,range:[0,1]},quickbar_show_recent:{default_value:1,type:a.TYPE_INT,range:[0,1]},live_url:{default_value:1,type:a.TYPE_INT,range:[0,1],help:"Keep the browser URL in sync with your current location"},aa:{label:"Anti-aliasing",default_value:o,type:a.TYPE_INT,range:[0,1],help:"Use anti-aliasing when available"}}
function startup(){i.register(s)}},{"../glov/client/browser.js":239,"../glov/client/cmds.js":244,"../glov/client/settings.js":291,"./character_controller.js":30}],13:[function(e,t,r){t.exports={primary:{fn:"voxels",tiles_per_row:8,tile_res:224,pad:4,tex_res:2048,nudge:[56,60],tile_map:"default"},primary_mask:{fn:"voxels_mask",tiles_per_row:8,tile_res:224,pad:4,tex_res:2048,nudge:[56,60],tile_map:"default"},primary_normal:{fn:"voxels_normal",tiles_per_row:8,tile_res:224,pad:4,tex_res:2048,nudge:[56,60],tile_map:"default"},util:{fn:"voxel_util",tiles_per_row:4,tile_res:124,pad:2,tex_res:512}}},{}],14:[function(e,t,r){"use strict"
var a=e("assert")
var i=e("../../common/ids.js")
var o=e("../../common/materials_common")
var n=o.CraftClass
var s=o.Mat
var l=i.TYPE_ITEM,c=i.TYPE_BLOCK,_=i.TYPE_CRAFT_CLASS
var u=e("../items.js"),d=u.COST_FUNCS,f=u.DYNAMIC_COST_FUNCS,v=u.parseAttribMods
var h=e("../localization/localization").L
var p=e("../tiles.js")
var m=e("../../glov/common/vmath.js").vec3
var g=e("../../glov/common/util.js").arrayToSet
r.init=function(e){a(h.ITEM_ACCESS_CONTROL_NAME)
e(l,"ITEM_ACCESS_CONTROL",function ItemAccessControl(e){this.initBase(e)
this.name=h.ITEM_ACCESS_CONTROL_NAME
if(h.get("ITEM_ACCESS_CONTROL_DESC"))this.desc=h.ITEM_ACCESS_CONTROL_DESC
if(h.get("ITEM_ACCESS_CONTROL_INFO"))this.info=h.ITEM_ACCESS_CONTROL_INFO
this.cost=[d.item({type:l,id:i.ITEM_INGOT,attr1:s.ANY,count:1})]
this.updateCostFromMatMap()},{def_material:s.IRON,intangible:false,rooted:false,size_auto:true,baked_swap:true,baked_key:"access_control",cost_mat_map:{attr1:{cost_idx:0,def:"IRON"}}})
a(h.ITEM_ANVIL_NAME)
e(l,"ITEM_ANVIL",function ItemAnvil(e){this.initBase(e)
this.name=h.ITEM_ANVIL_NAME
if(h.get("ITEM_ANVIL_DESC"))this.desc=h.ITEM_ANVIL_DESC
if(h.get("ITEM_ANVIL_INFO"))this.info=h.ITEM_ANVIL_INFO
this.cost=[d.item({type:l,id:i.ITEM_INGOT,attr1:s.ANY,count:20})]
this.updateCostFromMatMap()},{def_material:s.IRON,baked_key:"anvil",baked_swap:true,intangible:false,size_auto:true,flips_on_x:true,cost_mat_map:{attr1:{cost_idx:0,def:"IRON"}},floater_z:1.2,unlock_display_item:{type:l,id:i.ITEM_ANVIL,attr1:s.IRON},particle_systems:[{name:"factory_spark_particles",rot:0,offset_position:m(0,0,1.5)}]})
e(l,"ITEM_BAG",function ItemBag(e){this.initBase(e)},{name:"Bag",clickable:false,mineable:false,is_container:true})
a(h.ITEM_BED_NAME)
e(l,"ITEM_BED",function ItemBed(e){this.initBase(e)
this.initBaked()
this.name=h.ITEM_BED_NAME
if(h.get("ITEM_BED_DESC"))this.desc=h.ITEM_BED_DESC
if(h.get("ITEM_BED_INFO"))this.info=h.ITEM_BED_INFO
this.cost=[d.fromMaterial(this,0,60)]},{mat_baked_key:{IRON:"bed-metal",STONE:"bed-stone",FANCY_STONE:"bed-fancystone",LIGHT_WOOD:"bed-lightwood",DARK_WOOD:"bed-darkwood",RED_WOOD:"bed-redwood",def:"bed-wood"},intangible:false,size_auto:true,flips_on_x:true})
a(h.ITEM_BENCH_NAME)
e(l,"ITEM_BENCH",function ItemBench(e){this.initBase(e)
this.initBaked()
this.name=h.ITEM_BENCH_NAME
if(h.get("ITEM_BENCH_DESC"))this.desc=h.ITEM_BENCH_DESC
if(h.get("ITEM_BENCH_INFO"))this.info=h.ITEM_BENCH_INFO
this.cost=[d.fromMaterial(this,0,24)]},{mat_baked_key:{IRON:"bench-metal",STONE:"bench-stone",FANCY_STONE:"bench-fancystone",LIGHT_WOOD:"bench-lightwood",DARK_WOOD:"bench-darkwood",RED_WOOD:"bench-redwood",def:"bench-wood"},size_auto:true})
a(h.ITEM_BERRY_NAME)
e(l,"ITEM_BERRY",function ItemBerry(e){this.initBase(e)
this.name=h.ITEM_BERRY_NAME
if(h.get("ITEM_BERRY_DESC"))this.desc=h.ITEM_BERRY_DESC
if(h.get("ITEM_BERRY_INFO"))this.info=h.ITEM_BERRY_INFO
this.cost=[d.identity(this,1)]},{consume_attribs:v({STAMINA:2}),craft_classes:g([n.INGREDIENT,n.PIE_FILLING]),placeable:false,consumable:true,allowed_in_inventory:true,baked_swap:true,baked_key:"berries",has_variants:true})
a(h.ITEM_BERRY_BUSH_BLUE_NAME)
e(l,"ITEM_BERRY_BUSH_BLUE",function ItemBerryBushBlue(e){this.initBase(e)
this.name=h.ITEM_BERRY_BUSH_BLUE_NAME
if(h.get("ITEM_BERRY_BUSH_BLUE_DESC"))this.desc=h.ITEM_BERRY_BUSH_BLUE_DESC
if(h.get("ITEM_BERRY_BUSH_BLUE_INFO"))this.info=h.ITEM_BERRY_BUSH_BLUE_INFO
this.cost=[d.identity(this,1)]},{def_material:s.LEAF,size:m(2,2,1),allowed_in_inventory:true,snapshot_size:m(2,2,1),tool_page:true})
a(h.ITEM_BERRY_BUSH_RED_NAME)
e(l,"ITEM_BERRY_BUSH_RED",function ItemBerryBushRed(e){this.initBase(e)
this.name=h.ITEM_BERRY_BUSH_RED_NAME
if(h.get("ITEM_BERRY_BUSH_RED_DESC"))this.desc=h.ITEM_BERRY_BUSH_RED_DESC
if(h.get("ITEM_BERRY_BUSH_RED_INFO"))this.info=h.ITEM_BERRY_BUSH_RED_INFO
this.cost=[d.identity(this,1)]},{def_material:s.LEAF,size:m(2,2,1),allowed_in_inventory:true,snapshot_size:m(2,2,1),tool_page:true})
a(h.ITEM_BERRY_BUSH_YELLOW_NAME)
e(l,"ITEM_BERRY_BUSH_YELLOW",function ItemBerryBushYellow(e){this.initBase(e)
this.name=h.ITEM_BERRY_BUSH_YELLOW_NAME
if(h.get("ITEM_BERRY_BUSH_YELLOW_DESC"))this.desc=h.ITEM_BERRY_BUSH_YELLOW_DESC
if(h.get("ITEM_BERRY_BUSH_YELLOW_INFO"))this.info=h.ITEM_BERRY_BUSH_YELLOW_INFO
this.cost=[d.identity(this,1)]},{def_material:s.LEAF,size:m(2,2,2),allowed_in_inventory:true,snapshot_size:m(2,2,2),tool_page:true})
a(h.ITEM_BONFIRE_NAME)
e(l,"ITEM_BONFIRE",function ItemBonfire(e){this.initBase(e)
this.name=h.ITEM_BONFIRE_NAME
if(h.get("ITEM_BONFIRE_DESC"))this.desc=h.ITEM_BONFIRE_DESC
if(h.get("ITEM_BONFIRE_INFO"))this.info=h.ITEM_BONFIRE_INFO
this.cost=[d.item({type:_,id:n.WOOD_PLANK,count:5}),d.item({type:_,id:n.STONE_RAW,count:5})]
this.updateCostFromMatMap()},{def_material:s.WOOD,baked_key:"bonfire",baked_swap:true,intangible:false,size_auto:true,place_rot:1,flips_on_x:true,particles_always_on_in_unlimited:true,progress_indicator:false,cost_mat_map:{attr1:{cost_idx:0,def:"WOOD"},attr2:{cost_idx:1,def:"STONE",pick_as:0}},floater_z:1.1,particle_systems:[{name:"factory_bonfire_particles",rot:0,offset_position:m(0,0,.4)},{name:"factory_bonfire_smoke_particles",rot:0,offset_position:m(0,0,1.4)}]})
a(h.ITEM_BONFIRE_METAL_NAME)
e(l,"ITEM_BONFIRE_METAL",function ItemBonfireMetal(e){this.initBase(e)
this.name=h.ITEM_BONFIRE_METAL_NAME
if(h.get("ITEM_BONFIRE_METAL_DESC"))this.desc=h.ITEM_BONFIRE_METAL_DESC
if(h.get("ITEM_BONFIRE_METAL_INFO"))this.info=h.ITEM_BONFIRE_METAL_INFO
this.cost=[d.item({type:l,id:i.ITEM_INGOT,attr1:s.ANY,count:1}),d.item({type:_,id:n.STONE_RAW,count:10})]
this.updateCostFromMatMap()},{def_material:s.IRON,baked_key:"bonfire_metal",baked_swap:true,intangible:false,size_auto:true,place_rot:1,flips_on_x:true,particles_always_on_in_unlimited:true,progress_indicator:false,cost_mat_map:{attr1:{cost_idx:0,def:"IRON"},attr2:{cost_idx:1,def:"STONE",pick_as:0}},floater_z:1.5,particle_systems:[{name:"factory_bonfire_particles",rot:0,offset_position:m(0,0,1)},{name:"factory_bonfire_smoke_particles",rot:0,offset_position:m(0,0,2)}]})
a(h.ITEM_BOTTLE_NAME)
e(l,"ITEM_BOTTLE",function ItemBottle(e){this.initBase(e)
this.name=h.ITEM_BOTTLE_NAME
if(h.get("ITEM_BOTTLE_DESC"))this.desc=h.ITEM_BOTTLE_DESC
if(h.get("ITEM_BOTTLE_INFO"))this.info=h.ITEM_BOTTLE_INFO
this.cost=[d.identity(this,1)]},{def_material:s.SAND,allowed_in_inventory:true,baked_key:"bottle",is_crafted:true,no_attribs:true})
a(h.ITEM_BREAD_NAME)
e(l,"ITEM_BREAD",function ItemBread(e){this.initBase(e)
this.name=h.ITEM_BREAD_NAME
if(h.get("ITEM_BREAD_DESC"))this.desc=h.ITEM_BREAD_DESC
if(h.get("ITEM_BREAD_INFO"))this.info=h.ITEM_BREAD_INFO
this.cost=[d.identity(this,1)]},{consume_attribs:v({STAMINA:5}),craft_classes:g([n.INGREDIENT]),placeable:false,allowed_in_inventory:true,consumable:true,baked_key:"bread",is_crafted:true})
a(h.ITEM_BUCKET_NAME)
e(l,"ITEM_BUCKET",function ItemBucket(e){this.initBase(e)
this.name=h.ITEM_BUCKET_NAME
if(h.get("ITEM_BUCKET_DESC"))this.desc=h.ITEM_BUCKET_DESC
if(h.get("ITEM_BUCKET_INFO"))this.info=h.ITEM_BUCKET_INFO},{placeable:false,no_spin:true,potentially_unlimited:true,allowed_in_inventory:true,tool_page:true,is_crafted:true,recipe_list:["wood_bucket","metal_bucket"]})
a(h.ITEM_BUZZERGOAL_NAME)
e(l,"ITEM_BUZZERGOAL",function ItemBuzzergoal(e){this.initBase(e)
this.name=h.ITEM_BUZZERGOAL_NAME
if(h.get("ITEM_BUZZERGOAL_DESC"))this.desc=h.ITEM_BUZZERGOAL_DESC
if(h.get("ITEM_BUZZERGOAL_INFO"))this.info=h.ITEM_BUZZERGOAL_INFO
this.cost=[d.item({type:_,id:n.STONE_RAW,count:15}),d.item({type:l,id:i.ITEM_CORD,count:3})]
this.updateCostFromMatMap()},{def_material:s.STONE,baked_key:"buzzergoal_ready",intangible:true,size_auto:true,cost_mat_map:{attr1:{cost_idx:0,def:"STONE",pick_as:0}},particle_systems:[{name:"buzzer_circle_bottom_particles",rot:0,offset_position:m(0,0,0)}],particle_triggers:{fireworks:[{name:"buzzer_firework_particles",rot:0,offset_position:m(0,0,3)}]}})
a(h.ITEM_BUZZERSTART_NAME)
e(l,"ITEM_BUZZERSTART",function ItemBuzzerstart(e){this.initBase(e)
this.name=h.ITEM_BUZZERSTART_NAME
if(h.get("ITEM_BUZZERSTART_DESC"))this.desc=h.ITEM_BUZZERSTART_DESC
if(h.get("ITEM_BUZZERSTART_INFO"))this.info=h.ITEM_BUZZERSTART_INFO
this.cost=[d.item({type:_,id:n.STONE_RAW,count:15}),d.item({type:l,id:i.ITEM_CORD,count:3})]
this.updateCostFromMatMap()},{def_material:s.STONE,baked_key:"buzzerstart_ready",intangible:false,size_auto:true,cost_mat_map:{attr1:{cost_idx:0,def:"STONE",pick_as:0}},particle_triggers:{press:[{name:"buzzer_smoke_particles",rot:0,offset_position:m(0,0,1)},{name:"buzzer_spark_particles",rot:0,offset_position:m(0,0,1)}]}})
a(h.ITEM_CAMPFIRE_NAME)
e(l,"ITEM_CAMPFIRE",function ItemCampfire(e){this.initBase(e)
this.name=h.ITEM_CAMPFIRE_NAME
if(h.get("ITEM_CAMPFIRE_DESC"))this.desc=h.ITEM_CAMPFIRE_DESC
if(h.get("ITEM_CAMPFIRE_INFO"))this.info=h.ITEM_CAMPFIRE_INFO
this.cost=[d.item({type:_,id:n.WOOD_RAW,count:5}),d.item({type:_,id:n.STONE_RAW,count:5})]
this.updateCostFromMatMap()},{def_material:s.WOOD,baked_key:"campfire",baked_swap:true,intangible:false,size_auto:true,place_rot:1,cost_mat_map:{attr1:{cost_idx:0,def:"WOOD"},attr2:{cost_idx:1,def:"STONE"}},floater_z:1.1,particles_always_on_in_unlimited:true,particle_systems:[{name:"factory_campfire_particles",rot:0,offset_position:m(.1,-.1,0)},{name:"factory_fire_burst_particles",rot:0,offset_position:m(.1,-.1,.8)},{name:"factory_campfire_smoke_particles",rot:0,offset_position:m(0,0,1.2)}]})
a(h.ITEM_CARROT_NAME)
e(l,"ITEM_CARROT",function ItemCarrot(e){this.initBase(e)
this.name=h.ITEM_CARROT_NAME
if(h.get("ITEM_CARROT_DESC"))this.desc=h.ITEM_CARROT_DESC
if(h.get("ITEM_CARROT_INFO"))this.info=h.ITEM_CARROT_INFO
this.cost=[d.identity(this,1)]},{consume_attribs:v({STAMINA:2}),craft_classes:g([n.INGREDIENT,n.VEGETABLE,n.PIE_FILLING]),baked_key:"carrot",size_auto:true,placeable:false,consumable:true,allowed_in_inventory:true})
a(h.ITEM_CHAIR_NAME)
e(l,"ITEM_CHAIR",function ItemChair(e){this.initBase(e)
this.initBaked()
this.name=h.ITEM_CHAIR_NAME
if(h.get("ITEM_CHAIR_DESC"))this.desc=h.ITEM_CHAIR_DESC
if(h.get("ITEM_CHAIR_INFO"))this.info=h.ITEM_CHAIR_INFO
this.cost=[d.fromMaterial(this,0,12)]},{mat_baked_key:{IRON:"chair-metal",STONE:"chair-stone",FANCY_STONE:"chair-fancystone",LIGHT_WOOD:"chair-lightwood",DARK_WOOD:"chair-darkwood",RED_WOOD:"chair-redwood",def:"chair-wood"},intangible:false,tangible_height:1,size_auto:true,snapshot_size:m(1,1,2)})
a(h.ITEM_CHEST_MEDIUM_NAME)
e(l,"ITEM_CHEST_MEDIUM",function ItemChestMedium(e){this.initBase(e)
this.initBaked()
this.name=h.ITEM_CHEST_MEDIUM_NAME
if(h.get("ITEM_CHEST_MEDIUM_DESC"))this.desc=h.ITEM_CHEST_MEDIUM_DESC
if(h.get("ITEM_CHEST_MEDIUM_INFO"))this.info=h.ITEM_CHEST_MEDIUM_INFO
this.cost=[d.fromMaterial(this,0,30)]},{intangible:false,is_container:true,draw_scale:.1425714,size:m(2,2,2),mat_baked_key:{IRON:"chest-medium-metal",STONE:"chest-medium-stone",FANCY_STONE:"chest-medium-fancystone",LIGHT_WOOD:"chest-medium-lightwood",DARK_WOOD:"chest-medium-darkwood",RED_WOOD:"chest-medium-redwood",def:{BLUE:"chest-medium-wood-sunken",def:"chest-medium-wood"}},unlockable_variants:[{attr1:"WOOD",attr3:"BLUE",methods:"lf_break"}],fallback_baked_key:"chest-medium-wood"})
a(h.ITEM_CHEST_SMALL_NAME)
e(l,"ITEM_CHEST_SMALL",function ItemChestSmall(e){this.initBase(e)
this.initBaked()
this.name=h.ITEM_CHEST_SMALL_NAME
if(h.get("ITEM_CHEST_SMALL_DESC"))this.desc=h.ITEM_CHEST_SMALL_DESC
if(h.get("ITEM_CHEST_SMALL_INFO"))this.info=h.ITEM_CHEST_SMALL_INFO
this.cost=[d.fromMaterial(this,0,20)]},{intangible:false,is_container:true,size:m(2,1,1),mat_baked_key:{IRON:"chest-small-metal",STONE:"chest-small-stone",FANCY_STONE:"chest-small-fancystone",LIGHT_WOOD:"chest-small-lightwood",DARK_WOOD:"chest-small-darkwood",RED_WOOD:"chest-small-redwood",def:"chest-small-wood"}})
a(h.ITEM_CHEST_TALL_NAME)
e(l,"ITEM_CHEST_TALL",function ItemChestTall(e){this.initBase(e)
this.initBaked()
this.name=h.ITEM_CHEST_TALL_NAME
if(h.get("ITEM_CHEST_TALL_DESC"))this.desc=h.ITEM_CHEST_TALL_DESC
if(h.get("ITEM_CHEST_TALL_INFO"))this.info=h.ITEM_CHEST_TALL_INFO
this.cost=[d.fromMaterial(this,0,60)]},{intangible:false,is_container:true,size_auto:true,mat_baked_key:{IRON:"chest-tall-metal",STONE:"chest-tall-stone",FANCY_STONE:"chest-tall-fancystone",LIGHT_WOOD:"chest-tall-lightwood",DARK_WOOD:"chest-tall-darkwood",RED_WOOD:"chest-tall-redwood",def:"chest-tall-wood"}})
a(h.ITEM_CHEST_TINY_NAME)
e(l,"ITEM_CHEST_TINY",function ItemChestTiny(e){this.initBase(e)
this.initBaked()
this.name=h.ITEM_CHEST_TINY_NAME
if(h.get("ITEM_CHEST_TINY_DESC"))this.desc=h.ITEM_CHEST_TINY_DESC
if(h.get("ITEM_CHEST_TINY_INFO"))this.info=h.ITEM_CHEST_TINY_INFO
this.cost=[d.fromMaterial(this,0,10)]},{intangible:false,is_container:true,mat_baked_key:{IRON:"chest-tiny-metal",STONE:"chest-tiny-stone",FANCY_STONE:"chest-tiny-fancystone",LIGHT_WOOD:"chest-tiny-lightwood",DARK_WOOD:"chest-tiny-darkwood",RED_WOOD:"chest-tiny-redwood",def:"chest-tiny-wood"}})
a(h.ITEM_COAL_NAME)
e(l,"ITEM_COAL",function ItemCoal(e){this.initBase(e)
this.initPreviewBlock()
this.name=h.ITEM_COAL_NAME
if(h.get("ITEM_COAL_DESC"))this.desc=h.ITEM_COAL_DESC
if(h.get("ITEM_COAL_INFO"))this.info=h.ITEM_COAL_INFO
this.cost=[d.identity(this,1)]},{def_material:s.COAL,baked_key:"coal",intangible:false,size_auto:true,allowed_in_inventory:true,fuel_rate:1,preview_block_map:{def:"COAL"},is_crafted:true,no_attribs:true})
a(h.ITEM_CORAL_POWDER_NAME)
e(l,"ITEM_CORAL_POWDER",function ItemCoralPowder(e){this.initBase(e)
this.name=h.ITEM_CORAL_POWDER_NAME
if(h.get("ITEM_CORAL_POWDER_DESC"))this.desc=h.ITEM_CORAL_POWDER_DESC
if(h.get("ITEM_CORAL_POWDER_INFO"))this.info=h.ITEM_CORAL_POWDER_INFO
this.cost=[d.identity(this,1)]},{def_material:s.LEAF,baked_key:"coral_powder",allowed_in_inventory:true,size:m(2,2,2),is_crafted:true,no_attribs:true,placeable:false})
a(h.ITEM_CORD_NAME)
e(l,"ITEM_CORD",function ItemCord(e){this.initBase(e)
this.name=h.ITEM_CORD_NAME
if(h.get("ITEM_CORD_DESC"))this.desc=h.ITEM_CORD_DESC
if(h.get("ITEM_CORD_INFO"))this.info=h.ITEM_CORD_INFO},{baked_key:"cord",placeable:false,is_crafted:true,no_attribs:true,size:m(1.5,1.5,1)})
a(h.ITEM_CORN_NAME)
e(l,"ITEM_CORN",function ItemCorn(e){this.initBase(e)
this.name=h.ITEM_CORN_NAME
if(h.get("ITEM_CORN_DESC"))this.desc=h.ITEM_CORN_DESC
if(h.get("ITEM_CORN_INFO"))this.info=h.ITEM_CORN_INFO},{craft_classes:g([n.INGREDIENT,n.GRINDABLE,n.WHEAT_CORN,n.VEGETABLE]),placeable:false,baked_key:"corn-harvested",allowed_in_inventory:true,size:m(2,2,2)})
a(h.ITEM_CROISSANT_NAME)
e(l,"ITEM_CROISSANT",function ItemCroissant(e){this.initBase(e)
this.initUniqueSpiced()
this.name=h.ITEM_CROISSANT_NAME
if(h.get("ITEM_CROISSANT_DESC"))this.desc=h.ITEM_CROISSANT_DESC
if(h.get("ITEM_CROISSANT_INFO"))this.info=h.ITEM_CROISSANT_INFO
this.cost=[d.identity(this,1)]},{consume_attribs:v({STAMINA:5}),craft_classes:g([n.INGREDIENT]),placeable:false,size:m(2,2,2),allowed_in_inventory:true,consumable:true,baked_key:"croissant",is_crafted:true})
a(h.ITEM_DOOR_NAME)
e(l,"ITEM_DOOR",function ItemDoor(e){this.initBase(e)
this.name=h.ITEM_DOOR_NAME
if(h.get("ITEM_DOOR_DESC"))this.desc=h.ITEM_DOOR_DESC
if(h.get("ITEM_DOOR_INFO"))this.info=h.ITEM_DOOR_INFO
this.cost=[d.fromMaterial(this,0,16)]},{intangible:false,size:m(2,1,4),flips_on_x:true})
a(h.ITEM_DOOR_DOUBLE_NAME)
e(l,"ITEM_DOOR_DOUBLE",function ItemDoorDouble(e){this.initBase(e)
this.name=h.ITEM_DOOR_DOUBLE_NAME
if(h.get("ITEM_DOOR_DOUBLE_DESC"))this.desc=h.ITEM_DOOR_DOUBLE_DESC
if(h.get("ITEM_DOOR_DOUBLE_INFO"))this.info=h.ITEM_DOOR_DOUBLE_INFO
this.cost=[d.fromMaterial(this,0,32)]},{intangible:false,size:m(4,1,4)})
a(h.ITEM_DOWSER_ADVANCED_NAME)
e(l,"ITEM_DOWSER_ADVANCED",function ItemDowserAdvanced(e){this.initBase(e)
this.initDowser()
this.name=h.ITEM_DOWSER_ADVANCED_NAME
if(h.get("ITEM_DOWSER_ADVANCED_DESC"))this.desc=h.ITEM_DOWSER_ADVANCED_DESC
if(h.get("ITEM_DOWSER_ADVANCED_INFO"))this.info=h.ITEM_DOWSER_ADVANCED_INFO},{baked_key:"dowser-advanced",size_auto:true,placeable:false,baked_swap:true,stackable:false,allowed_in_inventory:true,snapshot_size:m(2,2,3.2),tool_page:true,is_crafted:true})
a(h.ITEM_DOWSER_SIMPLE_NAME)
e(l,"ITEM_DOWSER_SIMPLE",function ItemDowserSimple(e){this.initBase(e)
this.initDowser()
this.name=h.ITEM_DOWSER_SIMPLE_NAME
if(h.get("ITEM_DOWSER_SIMPLE_DESC"))this.desc=h.ITEM_DOWSER_SIMPLE_DESC
if(h.get("ITEM_DOWSER_SIMPLE_INFO"))this.info=h.ITEM_DOWSER_SIMPLE_INFO},{baked_key:"dowser",size_auto:true,placeable:false,baked_swap:true,stackable:false,allowed_in_inventory:true,snapshot_size:m(2,2,3.2),tool_page:true,is_crafted:true})
a(h.ITEM_ENERGY_WELL_NAME)
e(l,"ITEM_ENERGY_WELL",function ItemEnergyWell(e){this.initBase(e)
this.name=h.ITEM_ENERGY_WELL_NAME
if(h.get("ITEM_ENERGY_WELL_DESC"))this.desc=h.ITEM_ENERGY_WELL_DESC
if(h.get("ITEM_ENERGY_WELL_INFO"))this.info=h.ITEM_ENERGY_WELL_INFO
this.cost=[d.item({type:_,id:n.STONE_RAW,count:100})]
this.updateCostFromMatMap()},{def_material:s.STONE,baked_key:"energy-well-empty",intangible:false,size_auto:true,cost_mat_map:{attr1:{cost_idx:0,def:"STONE",pick_as:0}},particle_systems:[{name:"energy_well_particles",rot:0,offset_position:m(0,0,.5)}]})
e(l,"ITEM_FACTORY_DEBUG",function ItemFactoryDebug(e){this.initBase(e)},{def_material:s.STONE,name:"Debug Factory",baked_key:"factory-placeholder",intangible:false,size_auto:true,particle_systems:[],cost:[]})
a(h.ITEM_FENCE_NAME)
e(l,"ITEM_FENCE",function ItemFence(e){this.initBase(e)
this.initBaked()
this.name=h.ITEM_FENCE_NAME
if(h.get("ITEM_FENCE_DESC"))this.desc=h.ITEM_FENCE_DESC
if(h.get("ITEM_FENCE_INFO"))this.info=h.ITEM_FENCE_INFO
this.cost=[d.fromMaterial(this,0,2)]},{intangible:false,no_auto_rot:true,size:m(1,1,2),mat_baked_key:{IRON:"fence-metal",STONE:"fence-stone",FANCY_STONE:"fence-fancystone",LIGHT_WOOD:"fence-lightwood",DARK_WOOD:"fence-darkwood",RED_WOOD:"fence-redwood",def:"fence-wood"}})
a(h.ITEM_FIBER_NAME)
e(l,"ITEM_FIBER",function ItemFiber(e){this.initBase(e)
this.name=h.ITEM_FIBER_NAME
if(h.get("ITEM_FIBER_DESC"))this.desc=h.ITEM_FIBER_DESC
if(h.get("ITEM_FIBER_INFO"))this.info=h.ITEM_FIBER_INFO},{def_material:s.LEAF,baked_key:"fiber",placeable:false,size:m(1.5,1.5,2),allowed_in_inventory:true})
a(h.ITEM_FLOUR_NAME)
e(l,"ITEM_FLOUR",function ItemFlour(e){this.initBase(e)
this.name=h.ITEM_FLOUR_NAME
if(h.get("ITEM_FLOUR_DESC"))this.desc=h.ITEM_FLOUR_DESC
if(h.get("ITEM_FLOUR_INFO"))this.info=h.ITEM_FLOUR_INFO
this.cost=[d.identity(this,1)]},{def_material:s.LEAF,craft_classes:g([n.INGREDIENT]),baked_key:"flour",allowed_in_inventory:true,size:m(1,1,1),is_crafted:true,no_attribs:true})
a(h.ITEM_FLOWERPOT_NAME)
e(l,"ITEM_FLOWERPOT",function ItemFlowerpot(e){this.initBase(e)
this.name=h.ITEM_FLOWERPOT_NAME
if(h.get("ITEM_FLOWERPOT_DESC"))this.desc=h.ITEM_FLOWERPOT_DESC
if(h.get("ITEM_FLOWERPOT_INFO"))this.info=h.ITEM_FLOWERPOT_INFO},{def_material:s.DIRT,intangible:false,baked_key:"flowerpot",no_auto_rot:true,cost:[]})
a(h.ITEM_FURNACE_GLASS_NAME)
e(l,"ITEM_FURNACE_GLASS",function ItemFurnaceGlass(e){this.initBase(e)
this.name=h.ITEM_FURNACE_GLASS_NAME
if(h.get("ITEM_FURNACE_GLASS_DESC"))this.desc=h.ITEM_FURNACE_GLASS_DESC
if(h.get("ITEM_FURNACE_GLASS_INFO"))this.info=h.ITEM_FURNACE_GLASS_INFO
this.cost=[d.item({type:c,id:p.BRICK_STONE,count:20}),d.item({type:_,id:n.WOOD_PLANK,count:10}),d.item({type:l,id:i.ITEM_INGOT,attr1:s.IRON,count:2})]
this.updateCostFromMatMap()},{def_material:s.WOOD,baked_key:"furnace-glass",baked_swap:true,intangible:false,size_auto:true,place_rot:1,flips_on_x:true,cost_mat_map:{attr1:{cost_idx:1,def:"WOOD"},attr2:{cost_idx:2,def:"IRON"}},floater_z:1.2,particle_systems:[{name:"factory_spark_particles",rot:0,offset_position:m(0,0,1.7)},{name:"factory_furnacefire_particles",rot:0,offset_position:m(1,0,1.05)}]})
a(h.ITEM_FURNACE_ORE_NAME)
e(l,"ITEM_FURNACE_ORE",function ItemFurnaceOre(e){this.initBase(e)
this.name=h.ITEM_FURNACE_ORE_NAME
if(h.get("ITEM_FURNACE_ORE_DESC"))this.desc=h.ITEM_FURNACE_ORE_DESC
if(h.get("ITEM_FURNACE_ORE_INFO"))this.info=h.ITEM_FURNACE_ORE_INFO},{def_material:s.STONE,baked_key:"furnace-ore",intangible:false,size_auto:true,floater_z:.9,particle_systems:[{name:"factory_smoke_particles",rot:0,offset_position:m(0,.8,2.8)},{name:"factory_furnacefire_particles",rot:0,offset_position:m(0,.2,.8)}],cost:[d.item({type:c,id:p.BRICK_STONE,count:20})]})
a(h.ITEM_GEM_NAME)
e(l,"ITEM_GEM",function ItemGem(e){this.initBase(e)
this.name=h.ITEM_GEM_NAME
if(h.get("ITEM_GEM_DESC"))this.desc=h.ITEM_GEM_DESC
if(h.get("ITEM_GEM_INFO"))this.info=h.ITEM_GEM_INFO},{def_material:s.FANCY_STONE,no_auto_rot:true,intangible:true,rooted:false,sysadmin_only:true,size:m(1,1,2),baked_key:"emit-1x2",cost:[]})
a(h.ITEM_HOE_NAME)
e(l,"ITEM_HOE",function ItemHoe(e){this.initBase(e)
this.calcHP()
this.name=h.ITEM_HOE_NAME
if(h.get("ITEM_HOE_DESC"))this.desc=h.ITEM_HOE_DESC
if(h.get("ITEM_HOE_INFO"))this.info=h.ITEM_HOE_INFO},{size_auto:true,placeable:false,no_spin:true,stackable:false,has_hp:true,brush_size:"2x1",allowed_in_inventory:true,potentially_unlimited:true,tool_page:true,is_crafted:true})
a(h.ITEM_INDICATOR_NAME)
e(l,"ITEM_INDICATOR",function ItemIndicator(e){this.initBase(e)
this.name=h.ITEM_INDICATOR_NAME
if(h.get("ITEM_INDICATOR_DESC"))this.desc=h.ITEM_INDICATOR_DESC
if(h.get("ITEM_INDICATOR_INFO"))this.info=h.ITEM_INDICATOR_INFO},{def_material:s.FANCY_STONE,no_auto_rot:true,intangible:true,rooted:false,sysadmin_only:true,size:m(2,2,2),cost:[]})
a(h.ITEM_INGOT_NAME)
e(l,"ITEM_INGOT",function ItemIngot(e){this.initBase(e)
this.name=h.ITEM_INGOT_NAME
if(h.get("ITEM_INGOT_DESC"))this.desc=h.ITEM_INGOT_DESC
if(h.get("ITEM_INGOT_INFO"))this.info=h.ITEM_INGOT_INFO
this.cost=[d.identity(this,3)]},{craft_classes:g([n.SCALED_INGOT]),baked_key:"ingot-iron",baked_swap:true,intangible:false,size_auto:true,is_crafted:true,allowed_in_inventory:true,has_variants:true})
a(h.ITEM_JUICE_NAME)
e(l,"ITEM_JUICE",function ItemJuice(e){this.initBase(e)
this.initSpiced()
this.name=h.ITEM_JUICE_NAME
if(h.get("ITEM_JUICE_DESC"))this.desc=h.ITEM_JUICE_DESC
if(h.get("ITEM_JUICE_INFO"))this.info=h.ITEM_JUICE_INFO
this.cost=[d.identity(this,1)]},{consume_attribs:v({STAMINA:3,TIMED_STAMINA_MED:10}),placeable:false,allowed_in_inventory:true,consumable:true,is_crafted:true,has_variants:true})
a(h.ITEM_JUICER_NAME)
e(l,"ITEM_JUICER",function ItemJuicer(e){this.initBase(e)
this.name=h.ITEM_JUICER_NAME
if(h.get("ITEM_JUICER_DESC"))this.desc=h.ITEM_JUICER_DESC
if(h.get("ITEM_JUICER_INFO"))this.info=h.ITEM_JUICER_INFO
this.cost=[d.item({type:_,id:n.WOOD_PLANK,count:60}),d.item({type:l,id:i.ITEM_INGOT,attr1:s.IRON,count:3})]
this.updateCostFromMatMap()},{def_material:s.WOOD,baked_key:"juicer",baked_swap:true,intangible:false,size_auto:true,cost_mat_map:{attr1:{cost_idx:0,def:"WOOD"},attr2:{cost_idx:1,def:"IRON"}},particle_systems:[{name:"factory_color_particles",rot:0,offset_position:m(0,0,1.3)}]})
a(h.ITEM_KILN_NAME)
e(l,"ITEM_KILN",function ItemKiln(e){this.initBase(e)
this.name=h.ITEM_KILN_NAME
if(h.get("ITEM_KILN_DESC"))this.desc=h.ITEM_KILN_DESC
if(h.get("ITEM_KILN_INFO"))this.info=h.ITEM_KILN_INFO
this.cost=[d.item({type:_,id:n.STONE_RAW,count:10}),d.item({type:c,id:p.DIRT,count:10})]
this.updateCostFromMatMap()},{def_material:s.STONE,baked_key:"kiln",baked_swap:true,intangible:false,size_auto:true,cost_mat_map:{attr1:{cost_idx:0,def:"STONE",pick_as:0}},floater_z:1.1,particle_systems:[{name:"factory_smoke_particles",rot:0,offset_position:m(0,0,2.8)},{name:"factory_furnacefire_particles",rot:0,offset_position:m(0,0,0)}]})
a(h.ITEM_LADDER_NAME)
e(l,"ITEM_LADDER",function ItemLadder(e){this.initBase(e)
this.initBaked()
this.name=h.ITEM_LADDER_NAME
if(h.get("ITEM_LADDER_DESC"))this.desc=h.ITEM_LADDER_DESC
if(h.get("ITEM_LADDER_INFO"))this.info=h.ITEM_LADDER_INFO
this.cost=[d.fromMaterial(this,0,4)]},{mat_baked_key:{IRON:"ladder-metal",STONE:"ladder-stone",FANCY_STONE:"ladder-fancystone",LIGHT_WOOD:"ladder-lightwood",DARK_WOOD:"ladder-darkwood",RED_WOOD:"ladder-redwood",def:"ladder-wood"},snapshot_size:m(2,1,2),size:m(2,1,1)})
a(h.ITEM_LANTERN_NAME)
e(l,"ITEM_LANTERN",function ItemLantern(e){this.initBase(e)
this.initBaked()
this.name=h.ITEM_LANTERN_NAME
if(h.get("ITEM_LANTERN_DESC"))this.desc=h.ITEM_LANTERN_DESC
if(h.get("ITEM_LANTERN_INFO"))this.info=h.ITEM_LANTERN_INFO
this.cost=[d.fromMaterial(this,0,4)]},{no_auto_rot:true,on_flow:"dig",mat_baked_key:{IRON:"lantern-metal",STONE:"lantern-stone",FANCY_STONE:"lantern-fancystone",LIGHT_WOOD:"lantern-lightwood",DARK_WOOD:"lantern-darkwood",RED_WOOD:"lantern-redwood",def:"lantern-wood"}})
a(h.ITEM_LEAPGATE_NAME)
e(l,"ITEM_LEAPGATE",function ItemLeapgate(e){this.initBase(e)
this.name=h.ITEM_LEAPGATE_NAME
if(h.get("ITEM_LEAPGATE_DESC"))this.desc=h.ITEM_LEAPGATE_DESC
if(h.get("ITEM_LEAPGATE_INFO"))this.info=h.ITEM_LEAPGATE_INFO},{def_material:s.STONE,intangible:false,rooted:false,size:m(2,2,1),baked_key:"leapgate",cost:[d.item({type:c,id:p.STONE_LIGHT,count:1})]})
a(h.ITEM_LEAPGATE_SHARD_NAME)
e(l,"ITEM_LEAPGATE_SHARD",function ItemLeapgateShard(e){this.initBase(e)},{def_material:s.FANCY_STONE,allowed_in_inventory:true,debug_only:true,placeable:false,size:m(1,1,2),stackable:false,baked_key:"leapgate_shard",cost:[]})
a(h.ITEM_LEFTOVERS_NAME)
e(l,"ITEM_LEFTOVERS",function ItemLeftovers(e){this.initBase(e)
this.name=h.ITEM_LEFTOVERS_NAME
if(h.get("ITEM_LEFTOVERS_DESC"))this.desc=h.ITEM_LEFTOVERS_DESC
if(h.get("ITEM_LEFTOVERS_INFO"))this.info=h.ITEM_LEFTOVERS_INFO
this.cost=[d.identity(this,1)]},{consume_attribs:v({STAMINA:1}),placeable:false,size:m(1.3,1.3,1),allowed_in_inventory:true,consumable:true,baked_key:"leftovers",is_crafted:true,no_attribs:true})
a(h.ITEM_LIGHT_CUBE_NAME)
e(l,"ITEM_LIGHT_CUBE",function ItemLightCube(e){this.initBase(e)
this.initBaked()
this.name=h.ITEM_LIGHT_CUBE_NAME
if(h.get("ITEM_LIGHT_CUBE_DESC"))this.desc=h.ITEM_LIGHT_CUBE_DESC
if(h.get("ITEM_LIGHT_CUBE_INFO"))this.info=h.ITEM_LIGHT_CUBE_INFO
this.cost=[d.fromMaterial(this,0,4),d.item({type:l,id:i.ITEM_COAL,count:1})]},{intangible:false,on_flow:"block",mat_baked_key:{IRON:"cubelight-metal",STONE:"cubelight-stone",FANCY_STONE:"cubelight-fancystone",LIGHT_WOOD:"cubelight-lightwood",DARK_WOOD:"cubelight-darkwood",RED_WOOD:"cubelight-redwood",def:"cubelight-wood"}})
a(h.ITEM_LIQUID_NAME)
e(l,"ITEM_LIQUID",function ItemLiquid(e){this.initBase(e)
this.name=h.ITEM_LIQUID_NAME
if(h.get("ITEM_LIQUID_DESC"))this.desc=h.ITEM_LIQUID_DESC
if(h.get("ITEM_LIQUID_INFO"))this.info=h.ITEM_LIQUID_INFO},{placeable:false,no_spin:true,potentially_unlimited:true})
a(h.ITEM_MILL_NAME)
e(l,"ITEM_MILL",function ItemMill(e){this.initBase(e)
this.name=h.ITEM_MILL_NAME
if(h.get("ITEM_MILL_DESC"))this.desc=h.ITEM_MILL_DESC
if(h.get("ITEM_MILL_INFO"))this.info=h.ITEM_MILL_INFO
this.cost=[d.item({type:_,id:n.WOOD_PLANK,count:20}),d.item({type:_,id:n.STONE_RAW,count:10})]
this.updateCostFromMatMap()},{def_material:s.DARK_WOOD,baked_key:"mill",baked_swap:true,intangible:false,size_auto:true,place_rot:1,cost_mat_map:{attr1:{cost_idx:0,def:"DARK_WOOD"},attr2:{cost_idx:1,def:"STONE"}},floater_z:1.1,particle_systems:[{name:"factory_spark_particles",rot:0,offset_position:m(0,0,1)}]})
a(h.ITEM_MUSHROOM_NAME)
e(l,"ITEM_MUSHROOM",function ItemMushroom(e){this.initBase(e)
this.initUniqueSpiced()
this.name=h.ITEM_MUSHROOM_NAME
if(h.get("ITEM_MUSHROOM_DESC"))this.desc=h.ITEM_MUSHROOM_DESC
if(h.get("ITEM_MUSHROOM_INFO"))this.info=h.ITEM_MUSHROOM_INFO
this.cost=[d.identity(this,1)]},{def_material:s.LEAF,consume_attribs:v({STAMINA:1}),craft_classes:g([n.INGREDIENT,n.VEGETABLE,n.PIE_FILLING]),baked_swap:true,baked_key:"mushroom",placeable:false,consumable:true,allowed_in_inventory:true,snapshot_size:m(1,1,1),has_variants:true})
a(h.ITEM_ORE_NAME)
e(l,"ITEM_ORE",function ItemOre(e){this.initBase(e)
this.initPreviewBlock()
this.name=h.ITEM_ORE_NAME
if(h.get("ITEM_ORE_DESC"))this.desc=h.ITEM_ORE_DESC
if(h.get("ITEM_ORE_INFO"))this.info=h.ITEM_ORE_INFO
this.cost=[d.identity(this,5)]},{baked_key:"ore-iron",baked_swap:true,intangible:false,size_auto:true,ignore_take:true,allowed_in_inventory:true,preview_block_map:{COPPER:"COPPER",IRON:"IRON",TIN:"TIN",SILVER:"SILVER",EMBERYLLIUM:"EMBERYLLIUM",GOLD:"GOLD",COBALT:"COBALT",MYTHRIL:"MYTHRIL",AETHERSTONE:"AETHERSTONE",def:"IRON"},has_variants:true})
a(h.ITEM_OVEN_NAME)
e(l,"ITEM_OVEN",function ItemOven(e){this.initBase(e)
this.name=h.ITEM_OVEN_NAME
if(h.get("ITEM_OVEN_DESC"))this.desc=h.ITEM_OVEN_DESC
if(h.get("ITEM_OVEN_INFO"))this.info=h.ITEM_OVEN_INFO},{def_material:s.STONE,baked_key:"oven",intangible:false,size_auto:true,floater_z:1.2,particle_systems:[{name:"factory_smoke_particles",rot:0,offset_position:m(0,.4,3.5)},{name:"factory_furnacefire_particles",rot:0,offset_position:m(0,.2,1.2)}],cost:[d.item({type:c,id:p.BRICK_STONE,count:10}),d.item({type:l,id:i.ITEM_INGOT,attr1:s.BRONZE,count:1})]})
a(h.ITEM_PAINT_NAME)
e(l,"ITEM_PAINT",function ItemPaint(e){this.initBase(e)
this.name=h.ITEM_PAINT_NAME
if(h.get("ITEM_PAINT_DESC"))this.desc=h.ITEM_PAINT_DESC
if(h.get("ITEM_PAINT_INFO"))this.info=h.ITEM_PAINT_INFO
this.cost=[d.identity(this,1)]},{placeable:false,allowed_in_inventory:true,baked_swap:true,baked_key:"paint",is_crafted:true})
a(h.ITEM_PAINT_MIXER_NAME)
e(l,"ITEM_PAINT_MIXER",function ItemPaintMixer(e){this.initBase(e)
this.name=h.ITEM_PAINT_MIXER_NAME
if(h.get("ITEM_PAINT_MIXER_DESC"))this.desc=h.ITEM_PAINT_MIXER_DESC
if(h.get("ITEM_PAINT_MIXER_INFO"))this.info=h.ITEM_PAINT_MIXER_INFO
this.cost=[d.item({type:_,id:n.WOOD_PLANK,count:50}),d.item({type:l,id:i.ITEM_INGOT,attr1:s.IRON,count:3})]
this.updateCostFromMatMap()},{def_material:s.WOOD,baked_key:"paint-mixer",baked_swap:true,intangible:false,size_auto:true,flips_on_x:true,cost_mat_map:{attr1:{cost_idx:0,def:"WOOD"}},particle_systems:[{name:"factory_color_particles",rot:0,offset_position:m(.642,0,1.5)}]})
e(l,"ITEM_PARTICLE_DEBUGGER",function ItemParticleDebugger(e){this.initBase(e)},{def_material:s.STONE,name:"Debugger Particle",baked_key:"factory-placeholder",intangible:false,size_auto:true,particle_systems:[{name:"watering_system_particles",rot:0,offset_position:m(0,0,.6)},{name:"energy_well_particles",rot:.5,offset_position:m(0,0,.6)},{name:"factory_campfire_particles",rot:1,offset_position:m(0,0,.6)},{name:"factory_color_particles",rot:1.5,offset_position:m(0,0,.6)},{name:"factory_sawmill_particles",rot:1,offset_position:m(0,0,.6)},{name:"factory_spark_particles",rot:1,offset_position:m(0,0,.6)},{name:"factory_smoke_particles",rot:1,offset_position:m(0,0,.6)}],cost:[d.item({type:c,id:p.STONE,count:1})]})
a(h.ITEM_PIE_NAME)
e(l,"ITEM_PIE",function ItemPie(e){this.initBase(e)
this.initUniqueSpiced()
this.name=h.ITEM_PIE_NAME
if(h.get("ITEM_PIE_DESC"))this.desc=h.ITEM_PIE_DESC
if(h.get("ITEM_PIE_INFO"))this.info=h.ITEM_PIE_INFO
this.cost=[d.identity(this,1)]},{consume_attribs:v({TIMED_STAMINA_SMALL:300}),craft_classes:g([n.INGREDIENT,n.BAKED_FOOD]),placeable:false,allowed_in_inventory:true,consumable:true,is_crafted:true,has_variants:true})
a(h.ITEM_PLANT_NAME)
e(l,"ITEM_PLANT",function ItemPlant(e){this.initBase(e)
this.name=h.ITEM_PLANT_NAME
if(h.get("ITEM_PLANT_DESC"))this.desc=h.ITEM_PLANT_DESC
if(h.get("ITEM_PLANT_INFO"))this.info=h.ITEM_PLANT_INFO
this.cost=[d.identity(this,1)]},{def_material:s.LEAF,allowed_in_inventory:true,snapshot_size:m(1,1,1),dig_rate:10,tool_page:true})
a(h.ITEM_PUMPKIN_NAME)
e(l,"ITEM_PUMPKIN",function ItemPumpkin(e){this.initBase(e)
this.name=h.ITEM_PUMPKIN_NAME
if(h.get("ITEM_PUMPKIN_DESC"))this.desc=h.ITEM_PUMPKIN_DESC
if(h.get("ITEM_PUMPKIN_INFO"))this.info=h.ITEM_PUMPKIN_INFO
this.cost=[d.identity(this,1)]},{craft_classes:g([n.INGREDIENT,n.VEGETABLE,n.PIE_FILLING]),baked_key:"pumpkin",size_auto:true,placeable:false,allowed_in_inventory:true})
a(h.ITEM_ROAST_VEGETABLES_NAME)
e(l,"ITEM_ROAST_VEGETABLES",function ItemRoastVegetables(e){this.initBase(e)
this.initUniqueSpiced()
this.name=h.ITEM_ROAST_VEGETABLES_NAME
if(h.get("ITEM_ROAST_VEGETABLES_DESC"))this.desc=h.ITEM_ROAST_VEGETABLES_DESC
if(h.get("ITEM_ROAST_VEGETABLES_INFO"))this.info=h.ITEM_ROAST_VEGETABLES_INFO
this.cost=[d.identity(this,1)]},{consume_attribs:v({STAMINA:3}),craft_classes:g([n.INGREDIENT]),baked_key:"roast-vegetables",baked_swap:true,placeable:false,allowed_in_inventory:true,consumable:true,is_crafted:true,has_variants:true})
a(h.ITEM_ROD_NAME)
e(l,"ITEM_ROD",function ItemRod(e){this.initBase(e)
this.initFuelRate()
this.name=h.ITEM_ROD_NAME
if(h.get("ITEM_ROD_DESC"))this.desc=h.ITEM_ROD_DESC
if(h.get("ITEM_ROD_INFO"))this.info=h.ITEM_ROD_INFO
this.cost=[d.identity(this,1)]},{is_crafted:true,intangible:false,no_auto_rot:true,snapshot_size:m(1,1,2),baked_key:"rod",baked_swap:true,fuel_rate_map:{WOOD:20,LIGHT_WOOD:20,DARK_WOOD:20,RED_WOOD:20},mode_list:["Auto","Vert","Horiz"],mode_list_ids:[null,i.ITEM_RODV,i.ITEM_RODH],pick_as_mode:0,recipe_list:["wood_rod","metal_rod"]})
a(h.ITEM_RODH_NAME)
e(l,"ITEM_RODH",function ItemRodh(e){this.initBase(e)
this.name=h.ITEM_RODH_NAME
if(h.get("ITEM_RODH_DESC"))this.desc=h.ITEM_RODH_DESC
if(h.get("ITEM_RODH_INFO"))this.info=h.ITEM_RODH_INFO
this.cost=[d.item({type:l,id:i.ITEM_ROD,count:1})]
this.updateCostFromMatMap()},{def_material:s.WOOD,is_crafted:false,intangible:false,no_auto_rot:false,snapshot_size:m(1,1,2),baked_key:"rodh",baked_swap:true,pick_as_id:i.ITEM_ROD,pick_as_mode:2,cost_mat_map:{attr1:{cost_idx:0,def:"WOOD"}}})
a(h.ITEM_RODV_NAME)
e(l,"ITEM_RODV",function ItemRodv(e){this.initBase(e)
this.name=h.ITEM_RODV_NAME
if(h.get("ITEM_RODV_DESC"))this.desc=h.ITEM_RODV_DESC
if(h.get("ITEM_RODV_INFO"))this.info=h.ITEM_RODV_INFO
this.cost=[d.item({type:l,id:i.ITEM_ROD,count:1})]
this.updateCostFromMatMap()},{def_material:s.WOOD,is_crafted:false,intangible:false,no_auto_rot:false,snapshot_size:m(1,1,2),baked_key:"rodv",baked_swap:true,pick_as_id:i.ITEM_ROD,pick_as_mode:1,cost_mat_map:{attr1:{cost_idx:0,def:"WOOD"}}})
a(h.ITEM_RUG_NAME)
e(l,"ITEM_RUG",function ItemRug(e){this.initBase(e)
this.name=h.ITEM_RUG_NAME
if(h.get("ITEM_RUG_DESC"))this.desc=h.ITEM_RUG_DESC
if(h.get("ITEM_RUG_INFO"))this.info=h.ITEM_RUG_INFO},{def_material:s.WOOD,baked_key:"rug",size_auto:true,cost:[]})
a(h.ITEM_SANDWICH_NAME)
e(l,"ITEM_SANDWICH",function ItemSandwich(e){this.initBase(e)
this.initUniqueSpiced()
this.name=h.ITEM_SANDWICH_NAME
if(h.get("ITEM_SANDWICH_DESC"))this.desc=h.ITEM_SANDWICH_DESC
if(h.get("ITEM_SANDWICH_INFO"))this.info=h.ITEM_SANDWICH_INFO
this.cost=[d.identity(this,1)]},{consume_attribs:v({STAMINA:6}),craft_classes:g([n.INGREDIENT,n.BAKED_FOOD]),placeable:false,size:m(2,2,2),allowed_in_inventory:true,consumable:true,is_crafted:true,has_variants:true})
a(h.ITEM_SAWMILL_NAME)
e(l,"ITEM_SAWMILL",function ItemSawmill(e){this.initBase(e)
this.name=h.ITEM_SAWMILL_NAME
if(h.get("ITEM_SAWMILL_DESC"))this.desc=h.ITEM_SAWMILL_DESC
if(h.get("ITEM_SAWMILL_INFO"))this.info=h.ITEM_SAWMILL_INFO
this.cost=[d.item({type:_,id:n.WOOD_RAW,count:20}),d.item({type:l,id:i.ITEM_TOOL_HEAD,attr1:s.ANY,count:1})]
this.updateCostFromMatMap()},{def_material:s.WOOD,baked_key:"sawmill",baked_swap:true,intangible:false,size_auto:true,place_rot:1,flips_on_x:true,cost_mat_map:{attr1:{cost_idx:0,def:"WOOD"},attr2:{cost_idx:1,def:"STONE"}},floater_z:1.5,particle_systems:[{name:"factory_sawmill_particles",rot:1,offset_position:m(.5,0,1.3)}]})
a(h.ITEM_SEASHELL_NAME)
e(l,"ITEM_SEASHELL",function ItemSeashell(e){this.initBase(e)
this.initBaked()
this.name=h.ITEM_SEASHELL_NAME
if(h.get("ITEM_SEASHELL_DESC"))this.desc=h.ITEM_SEASHELL_DESC
if(h.get("ITEM_SEASHELL_INFO"))this.info=h.ITEM_SEASHELL_INFO
this.cost=[d.identity(this,1)]},{size:m(1,1,1),mat_baked_key:{RED:"seashell-red",ORANGE:"seashell-orange",YELLOW:"seashell-yellow",GREEN:"seashell-green",BLUE:"seashell-blue",PURPLE:"seashell-purple",def:"seashell-red"},intangible:true,dig_rate:10,allowed_in_inventory:true,has_variants:true})
a(h.ITEM_SEEDS_CARROT_NAME)
e(l,"ITEM_SEEDS_CARROT",function ItemSeedsCarrot(e){this.initBase(e)
this.name=h.ITEM_SEEDS_CARROT_NAME
if(h.get("ITEM_SEEDS_CARROT_DESC"))this.desc=h.ITEM_SEEDS_CARROT_DESC
if(h.get("ITEM_SEEDS_CARROT_INFO"))this.info=h.ITEM_SEEDS_CARROT_INFO
this.cost=[d.identity(this,1)]},{def_material:s.LEAF,craft_classes:g([n.FARMING_SEED]),rooted:true,allowed_in_inventory:true,always_interact:true,size:m(2,2,1),tool_page:true})
a(h.ITEM_SEEDS_CORN_NAME)
e(l,"ITEM_SEEDS_CORN",function ItemSeedsCorn(e){this.initBase(e)
this.name=h.ITEM_SEEDS_CORN_NAME
if(h.get("ITEM_SEEDS_CORN_DESC"))this.desc=h.ITEM_SEEDS_CORN_DESC
if(h.get("ITEM_SEEDS_CORN_INFO"))this.info=h.ITEM_SEEDS_CORN_INFO
this.cost=[d.identity(this,1)]},{def_material:s.LEAF,craft_classes:g([n.FARMING_SEED]),rooted:true,allowed_in_inventory:true,always_interact:true,size:m(2,2,1),tool_page:true})
a(h.ITEM_SEEDS_PUMPKIN_NAME)
e(l,"ITEM_SEEDS_PUMPKIN",function ItemSeedsPumpkin(e){this.initBase(e)
this.name=h.ITEM_SEEDS_PUMPKIN_NAME
if(h.get("ITEM_SEEDS_PUMPKIN_DESC"))this.desc=h.ITEM_SEEDS_PUMPKIN_DESC
if(h.get("ITEM_SEEDS_PUMPKIN_INFO"))this.info=h.ITEM_SEEDS_PUMPKIN_INFO
this.cost=[d.identity(this,1)]},{def_material:s.LEAF,craft_classes:g([n.FARMING_SEED]),rooted:true,allowed_in_inventory:true,always_interact:true,size:m(2,2,1),tool_page:true})
a(h.ITEM_SEEDS_SUGAR_CANE_NAME)
e(l,"ITEM_SEEDS_SUGAR_CANE",function ItemSeedsSugarCane(e){this.initBase(e)
this.name=h.ITEM_SEEDS_SUGAR_CANE_NAME
if(h.get("ITEM_SEEDS_SUGAR_CANE_DESC"))this.desc=h.ITEM_SEEDS_SUGAR_CANE_DESC
if(h.get("ITEM_SEEDS_SUGAR_CANE_INFO"))this.info=h.ITEM_SEEDS_SUGAR_CANE_INFO
this.cost=[d.identity(this,1)]},{def_material:s.LEAF,craft_classes:g([n.FARMING_SEED]),rooted:true,allowed_in_inventory:true,always_interact:true,size:m(2,2,1),tool_page:true})
a(h.ITEM_SEEDS_TOMATO_NAME)
e(l,"ITEM_SEEDS_TOMATO",function ItemSeedsTomato(e){this.initBase(e)
this.name=h.ITEM_SEEDS_TOMATO_NAME
if(h.get("ITEM_SEEDS_TOMATO_DESC"))this.desc=h.ITEM_SEEDS_TOMATO_DESC
if(h.get("ITEM_SEEDS_TOMATO_INFO"))this.info=h.ITEM_SEEDS_TOMATO_INFO
this.cost=[d.identity(this,1)]},{def_material:s.LEAF,craft_classes:g([n.FARMING_SEED]),rooted:true,allowed_in_inventory:true,always_interact:true,size:m(1,1,2),tool_page:true})
a(h.ITEM_SEEDS_WHEAT_NAME)
e(l,"ITEM_SEEDS_WHEAT",function ItemSeedsWheat(e){this.initBase(e)
this.name=h.ITEM_SEEDS_WHEAT_NAME
if(h.get("ITEM_SEEDS_WHEAT_DESC"))this.desc=h.ITEM_SEEDS_WHEAT_DESC
if(h.get("ITEM_SEEDS_WHEAT_INFO"))this.info=h.ITEM_SEEDS_WHEAT_INFO
this.cost=[d.identity(this,1)]},{def_material:s.LEAF,craft_classes:g([n.FARMING_SEED]),rooted:true,allowed_in_inventory:true,always_interact:true,size:m(2,2,1),tool_page:true})
a(h.ITEM_SHELF_NAME)
e(l,"ITEM_SHELF",function ItemShelf(e){this.initBase(e)
this.initBaked()
this.name=h.ITEM_SHELF_NAME
if(h.get("ITEM_SHELF_DESC"))this.desc=h.ITEM_SHELF_DESC
if(h.get("ITEM_SHELF_INFO"))this.info=h.ITEM_SHELF_INFO
this.cost=[d.fromMaterial(this,0,12)]},{intangible:false,size:m(3,1,1),mat_baked_key:{IRON:"shelf-metal",STONE:"shelf-stone",FANCY_STONE:"shelf-fancystone",LIGHT_WOOD:"shelf-lightwood",DARK_WOOD:"shelf-darkwood",RED_WOOD:"shelf-redwood",def:"shelf-wood"}})
a(h.ITEM_SIGNBOARD_NAME)
e(l,"ITEM_SIGNBOARD",function ItemSignboard(e){this.initBase(e)
this.name=h.ITEM_SIGNBOARD_NAME
if(h.get("ITEM_SIGNBOARD_DESC"))this.desc=h.ITEM_SIGNBOARD_DESC
if(h.get("ITEM_SIGNBOARD_INFO"))this.info=h.ITEM_SIGNBOARD_INFO
this.cost=[d.item({type:_,id:n.WOOD_PLANK,count:4})]
this.updateCostFromMatMap()},{def_material:s.WOOD,baked_key:"signboard",baked_swap:true,size_auto:true,cost_mat_map:{attr1:{cost_idx:0,def:"WOOD"}}})
a(h.ITEM_SIGNPOST_NAME)
e(l,"ITEM_SIGNPOST",function ItemSignpost(e){this.initBase(e)
this.name=h.ITEM_SIGNPOST_NAME
if(h.get("ITEM_SIGNPOST_DESC"))this.desc=h.ITEM_SIGNPOST_DESC
if(h.get("ITEM_SIGNPOST_INFO"))this.info=h.ITEM_SIGNPOST_INFO
this.cost=[d.item({type:_,id:n.WOOD_PLANK,count:6})]
this.updateCostFromMatMap()},{def_material:s.WOOD,baked_key:"signpost",baked_swap:true,size_auto:true,cost_mat_map:{attr1:{cost_idx:0,def:"WOOD"}}})
a(h.ITEM_SPICE_NAME)
e(l,"ITEM_SPICE",function ItemSpice(e){this.initBase(e)
this.name=h.ITEM_SPICE_NAME
if(h.get("ITEM_SPICE_DESC"))this.desc=h.ITEM_SPICE_DESC
if(h.get("ITEM_SPICE_INFO"))this.info=h.ITEM_SPICE_INFO
this.cost=[d.identity(this,1)]},{craft_classes:g([n.INGREDIENT]),allowed_in_inventory:true,placeable:false,has_variants:true})
a(h.ITEM_SPICE_PLANT_NAME)
e(l,"ITEM_SPICE_PLANT",function ItemSpicePlant(e){this.initBase(e)
this.name=h.ITEM_SPICE_PLANT_NAME
if(h.get("ITEM_SPICE_PLANT_DESC"))this.desc=h.ITEM_SPICE_PLANT_DESC
if(h.get("ITEM_SPICE_PLANT_INFO"))this.info=h.ITEM_SPICE_PLANT_INFO
this.cost=[d.identity(this,1)]},{def_material:s.LEAF,snapshot_size:m(1,1,1),dig_rate:10,sysadmin_only:true})
a(h.ITEM_STARFISH_NAME)
e(l,"ITEM_STARFISH",function ItemStarfish(e){this.initBase(e)
this.initBaked()
this.name=h.ITEM_STARFISH_NAME
if(h.get("ITEM_STARFISH_DESC"))this.desc=h.ITEM_STARFISH_DESC
if(h.get("ITEM_STARFISH_INFO"))this.info=h.ITEM_STARFISH_INFO
this.cost=[d.identity(this,1)]},{size:m(1,1,1),mat_baked_key:{RED:"starfish-red",YELLOW:"starfish-yellow",BLUE:"starfish-blue",def:"starfish-yellow"},intangible:true,underwater_only:true,dig_rate:10,allowed_in_inventory:true,has_variants:true})
a(h.ITEM_STEPS_NAME)
e(l,"ITEM_STEPS",function ItemSteps(e){this.initBase(e)
this.initBaked()
this.name=h.ITEM_STEPS_NAME
if(h.get("ITEM_STEPS_DESC"))this.desc=h.ITEM_STEPS_DESC
if(h.get("ITEM_STEPS_INFO"))this.info=h.ITEM_STEPS_INFO
this.cost=[d.fromMaterial(this,4,0)]},{mat_baked_key:{IRON:"steps-metal",STONE:"steps-stone",FANCY_STONE:"steps-fancystone",LIGHT_WOOD:"steps-lightwood",DARK_WOOD:"steps-darkwood",RED_WOOD:"steps-redwood",def:"steps-wood"},size_auto:true,intangible:false})
a(h.ITEM_STONECUTTER_ADVANCED_NAME)
e(l,"ITEM_STONECUTTER_ADVANCED",function ItemStonecutterAdvanced(e){this.initBase(e)
this.name=h.ITEM_STONECUTTER_ADVANCED_NAME
if(h.get("ITEM_STONECUTTER_ADVANCED_DESC"))this.desc=h.ITEM_STONECUTTER_ADVANCED_DESC
if(h.get("ITEM_STONECUTTER_ADVANCED_INFO"))this.info=h.ITEM_STONECUTTER_ADVANCED_INFO
this.cost=[d.item({type:_,id:n.WOOD_RAW,count:20}),d.item({type:l,id:i.ITEM_TOOL_HEAD,attr1:s.ANY,count:4}),d.item({type:c,id:p.BRICK_STONE,count:4})]
this.updateCostFromMatMap()},{def_material:s.WOOD,baked_key:"stonecutter-advanced",baked_swap:true,intangible:false,size_auto:true,place_rot:1,cost_mat_map:{attr1:{cost_idx:0,def:"WOOD"},attr2:{cost_idx:1,def:"STONE"}},particle_systems:[]})
a(h.ITEM_STONECUTTER_SIMPLE_NAME)
e(l,"ITEM_STONECUTTER_SIMPLE",function ItemStonecutterSimple(e){this.initBase(e)
this.name=h.ITEM_STONECUTTER_SIMPLE_NAME
if(h.get("ITEM_STONECUTTER_SIMPLE_DESC"))this.desc=h.ITEM_STONECUTTER_SIMPLE_DESC
if(h.get("ITEM_STONECUTTER_SIMPLE_INFO"))this.info=h.ITEM_STONECUTTER_SIMPLE_INFO
this.cost=[d.item({type:_,id:n.STONE_RAW,count:10}),d.item({type:l,id:i.ITEM_CORD,count:2})]
this.updateCostFromMatMap()},{def_material:s.STONE,baked_key:"stonecutter-simple",intangible:false,size_auto:true,cost_mat_map:{attr1:{cost_idx:0,def:"STONE",pick_as:0}},floater_z:1.5,particle_systems:[{name:"factory_stonecutter_particles",rot:1,offset_position:m(0,.4,.5)}]})
a(h.ITEM_SUGAR_NAME)
e(l,"ITEM_SUGAR",function ItemSugar(e){this.initBase(e)
this.name=h.ITEM_SUGAR_NAME
if(h.get("ITEM_SUGAR_DESC"))this.desc=h.ITEM_SUGAR_DESC
if(h.get("ITEM_SUGAR_INFO"))this.info=h.ITEM_SUGAR_INFO
this.cost=[d.identity(this,1)]},{def_material:s.LEAF,craft_classes:g([n.INGREDIENT]),baked_key:"sugar",allowed_in_inventory:true,size:m(2,2,2),is_crafted:true,no_attribs:true,placeable:false})
a(h.ITEM_SUGAR_CANE_NAME)
e(l,"ITEM_SUGAR_CANE",function ItemSugarCane(e){this.initBase(e)
this.name=h.ITEM_SUGAR_CANE_NAME
if(h.get("ITEM_SUGAR_CANE_DESC"))this.desc=h.ITEM_SUGAR_CANE_DESC
if(h.get("ITEM_SUGAR_CANE_INFO"))this.info=h.ITEM_SUGAR_CANE_INFO},{craft_classes:g([n.GRINDABLE]),placeable:false,baked_key:"sugar-cane-harvested",allowed_in_inventory:true,size:m(2,2,2)})
a(h.ITEM_TABLE_LARGE_NAME)
e(l,"ITEM_TABLE_LARGE",function ItemTableLarge(e){this.initBase(e)
this.initBaked()
this.name=h.ITEM_TABLE_LARGE_NAME
if(h.get("ITEM_TABLE_LARGE_DESC"))this.desc=h.ITEM_TABLE_LARGE_DESC
if(h.get("ITEM_TABLE_LARGE_INFO"))this.info=h.ITEM_TABLE_LARGE_INFO
this.cost=[d.fromMaterial(this,0,24)]},{mat_baked_key:{IRON:"table-large-metal",STONE:"table-large-stone",FANCY_STONE:"table-large-fancystone",LIGHT_WOOD:"table-large-lightwood",DARK_WOOD:"table-large-darkwood",RED_WOOD:"table-large-redwood",def:"table-large-wood"},intangible:false,size_auto:true})
a(h.ITEM_TABLE_SMALL_NAME)
e(l,"ITEM_TABLE_SMALL",function ItemTableSmall(e){this.initBase(e)
this.initBaked()
this.name=h.ITEM_TABLE_SMALL_NAME
if(h.get("ITEM_TABLE_SMALL_DESC"))this.desc=h.ITEM_TABLE_SMALL_DESC
if(h.get("ITEM_TABLE_SMALL_INFO"))this.info=h.ITEM_TABLE_SMALL_INFO
this.cost=[d.fromMaterial(this,0,16)]},{mat_baked_key:{IRON:"table-small-metal",STONE:"table-small-stone",FANCY_STONE:"table-small-fancystone",LIGHT_WOOD:"table-small-lightwood",DARK_WOOD:"table-small-darkwood",RED_WOOD:"table-small-redwood",def:"table-small-wood"},intangible:false,size_auto:true})
e(l,"ITEM_TEST00",function ItemTest00(e){this.initBase(e)},{def_material:s.WOOD,name:"Item Test00",intangible:false,placeable:true,rooted:false,baked_key:"test00",size_auto:true,debug_only:true,cost:[]})
e(l,"ITEM_TEST01",function ItemTest01(e){this.initBase(e)},{def_material:s.WOOD,name:"Item Test01",baked_key:"test01",size_auto:true,debug_only:true,cost:[]})
e(l,"ITEM_TEST02",function ItemTest02(e){this.initBase(e)},{def_material:s.WOOD,name:"Item Test02",baked_key:"test02",size_auto:true,debug_only:true,cost:[]})
e(l,"ITEM_TEST03",function ItemTest03(e){this.initBase(e)},{def_material:s.WOOD,name:"Item Test03",baked_key:"test03",size_auto:true,debug_only:true,cost:[]})
e(l,"ITEM_TEST04",function ItemTest04(e){this.initBase(e)},{def_material:s.WOOD,name:"Item Test04",baked_key:"test04",size_auto:true,debug_only:true,cost:[]})
e(l,"ITEM_TEST05",function ItemTest05(e){this.initBase(e)},{def_material:s.WOOD,name:"Item Test05",baked_key:"test05",size_auto:true,debug_only:true,cost:[]})
e(l,"ITEM_TEST06",function ItemTest06(e){this.initBase(e)},{def_material:s.WOOD,name:"Item Test06",baked_key:"test06",size_auto:true,debug_only:true,cost:[]})
e(l,"ITEM_TEST07",function ItemTest07(e){this.initBase(e)},{def_material:s.WOOD,name:"Item Test07",baked_key:"test07",size_auto:true,debug_only:true,cost:[]})
e(l,"ITEM_TEST08",function ItemTest08(e){this.initBase(e)},{def_material:s.WOOD,name:"Item Test08",baked_key:"test08",size_auto:true,debug_only:true,cost:[]})
e(l,"ITEM_TEST09",function ItemTest09(e){this.initBase(e)},{def_material:s.WOOD,name:"Item Test09",baked_key:"test09",size_auto:true,debug_only:true,cost:[]})
a(h.ITEM_TOMATO_NAME)
e(l,"ITEM_TOMATO",function ItemTomato(e){this.initBase(e)
this.name=h.ITEM_TOMATO_NAME
if(h.get("ITEM_TOMATO_DESC"))this.desc=h.ITEM_TOMATO_DESC
if(h.get("ITEM_TOMATO_INFO"))this.info=h.ITEM_TOMATO_INFO
this.cost=[d.identity(this,1)]},{def_material:s.LEAF,consume_attribs:v({STAMINA:2}),craft_classes:g([n.INGREDIENT,n.VEGETABLE,n.PIE_FILLING]),baked_key:"tomato",placeable:false,consumable:true,allowed_in_inventory:true,size_auto:true})
a(h.ITEM_TOOL_HEAD_NAME)
e(l,"ITEM_TOOL_HEAD",function ItemToolHead(e){this.initBase(e)
this.name=h.ITEM_TOOL_HEAD_NAME
if(h.get("ITEM_TOOL_HEAD_DESC"))this.desc=h.ITEM_TOOL_HEAD_DESC
if(h.get("ITEM_TOOL_HEAD_INFO"))this.info=h.ITEM_TOOL_HEAD_INFO},{baked_key:"tool-head",placeable:false,is_crafted:true,size_auto:true,baked_swap:true,recipe_list:["stone_tool_head","metal_tool_head_cast"]})
a(h.ITEM_TOOL_HEAD_CAST_NAME)
e(l,"ITEM_TOOL_HEAD_CAST",function ItemToolHeadCast(e){this.initBase(e)
this.name=h.ITEM_TOOL_HEAD_CAST_NAME
if(h.get("ITEM_TOOL_HEAD_CAST_DESC"))this.desc=h.ITEM_TOOL_HEAD_CAST_DESC
if(h.get("ITEM_TOOL_HEAD_CAST_INFO"))this.info=h.ITEM_TOOL_HEAD_CAST_INFO},{def_material:s.STONE,baked_key:"tool-head-cast",intangible:false,tangible_height:1,size_auto:true,floater_z:.5,flips_on_x:true,particle_system_type:"factory_spark_particles",particle_systems:[{name:"factory_tool_head_cast_molten_particles",rot:0,offset_position:m(-.25,0,.4)},{name:"factory_tool_head_cast_smoke_particles",rot:0,offset_position:m(-.2,0,.7)}],cost:[d.item({type:c,id:p.BRICK_STONE,count:5})]})
a(h.ITEM_TORCH_NAME)
e(l,"ITEM_TORCH",function ItemTorch(e){this.initBase(e)
this.initBaked()
this.name=h.ITEM_TORCH_NAME
if(h.get("ITEM_TORCH_DESC"))this.desc=h.ITEM_TORCH_DESC
if(h.get("ITEM_TORCH_INFO"))this.info=h.ITEM_TORCH_INFO
this.cost=[d.fromMaterial(this,1,0)]},{no_auto_rot:true,on_flow:"dig",mat_baked_key:{LIGHT_WOOD:"torch-lightwood",DARK_WOOD:"torch-darkwood",RED_WOOD:"torch-redwood",def:"torch-wood"}})
e(l,"ITEM_UNKNOWNID",function ItemUnknownid(e){this.initBase(e)
this.name=h.ITEM_UNKNOWNID_NAME
if(h.get("ITEM_UNKNOWNID_DESC"))this.desc=h.ITEM_UNKNOWNID_DESC
if(h.get("ITEM_UNKNOWNID_INFO"))this.info=h.ITEM_UNKNOWNID_INFO},{mineable:false,baked_key:"unknown",allowed_in_inventory:false,cost:[d.item({type:l,id:i.ITEM_UNKNOWNID,count:1})]})
a(h.ITEM_VEINIUM_GRINDER_NAME)
e(l,"ITEM_VEINIUM_GRINDER",function ItemVeiniumGrinder(e){this.initBase(e)
this.name=h.ITEM_VEINIUM_GRINDER_NAME
if(h.get("ITEM_VEINIUM_GRINDER_DESC"))this.desc=h.ITEM_VEINIUM_GRINDER_DESC
if(h.get("ITEM_VEINIUM_GRINDER_INFO"))this.info=h.ITEM_VEINIUM_GRINDER_INFO
this.cost=[d.item({type:l,id:i.ITEM_INGOT,attr1:s.ANY,count:2}),d.item({type:_,id:n.WOOD_PLANK,count:5})]
this.updateCostFromMatMap()},{def_material:s.IRON,baked_key:"veinium-grinder",baked_swap:true,intangible:false,size_auto:true,place_rot:1,flips_on_x:true,cost_mat_map:{attr1:{cost_idx:0,def:"IRON"},attr2:{cost_idx:1,def:"WOOD"}},floater_z:1.1,particle_systems:[{name:"factory_veinium_grinder_particles",rot:0,offset_position:m(1,0,1.3)},{name:"factory_veinium_grinder_dirt_particles",rot:0,offset_position:m(.5,0,1.5)}]})
a(h.ITEM_WATERING_SYSTEM_NAME)
e(l,"ITEM_WATERING_SYSTEM",function ItemWateringSystem(e){this.initBase(e)
this.name=h.ITEM_WATERING_SYSTEM_NAME
if(h.get("ITEM_WATERING_SYSTEM_DESC"))this.desc=h.ITEM_WATERING_SYSTEM_DESC
if(h.get("ITEM_WATERING_SYSTEM_INFO"))this.info=h.ITEM_WATERING_SYSTEM_INFO
this.cost=[d.item({type:_,id:n.WOOD_PLANK,count:20}),d.item({type:l,id:i.ITEM_BOTTLE,count:1})]
this.updateCostFromMatMap()},{def_material:s.WOOD,allowed_in_inventory:true,size:m(1,1,2),cost_mat_map:{attr1:{cost_idx:0,def:"WOOD"}},particle_systems:[{name:"watering_system_particles",rot:0,offset_position:m(0,0,.6)},{name:"watering_system_particles",rot:.5,offset_position:m(0,0,.6)},{name:"watering_system_particles",rot:1,offset_position:m(0,0,.6)},{name:"watering_system_particles",rot:1.5,offset_position:m(0,0,.6)}]})
a(h.ITEM_WAYGATE_NAME)
e(l,"ITEM_WAYGATE",function ItemWaygate(e){this.initBase(e)
this.name=h.ITEM_WAYGATE_NAME
if(h.get("ITEM_WAYGATE_DESC"))this.desc=h.ITEM_WAYGATE_DESC
if(h.get("ITEM_WAYGATE_INFO"))this.info=h.ITEM_WAYGATE_INFO},{def_material:s.FANCY_STONE,dynamic_cost:f.waygate,intangible:false,rooted:false,size:m(2,2,1),baked_key:"waygate",cost:[d.item({type:c,id:p.STONE_LIGHT,count:20})]})
a(h.ITEM_WHEAT_NAME)
e(l,"ITEM_WHEAT",function ItemWheat(e){this.initBase(e)
this.name=h.ITEM_WHEAT_NAME
if(h.get("ITEM_WHEAT_DESC"))this.desc=h.ITEM_WHEAT_DESC
if(h.get("ITEM_WHEAT_INFO"))this.info=h.ITEM_WHEAT_INFO},{craft_classes:g([n.GRINDABLE,n.WHEAT_CORN]),placeable:false,baked_key:"wheat-harvested",size:m(2,2,2),allowed_in_inventory:true})
a(h.ITEM_WILD_CROP_NAME)
e(l,"ITEM_WILD_CROP",function ItemWildCrop(e){this.initBase(e)
this.name=h.ITEM_WILD_CROP_NAME
if(h.get("ITEM_WILD_CROP_DESC"))this.desc=h.ITEM_WILD_CROP_DESC
if(h.get("ITEM_WILD_CROP_INFO"))this.info=h.ITEM_WILD_CROP_INFO
this.cost=[d.identity(this,1)]},{def_material:s.LEAF,rooted:true,always_interact:true,size:m(1,1,1),dig_rate:10,sysadmin_only:true})
a(h.ITEM_WINDOW_LARGE_NAME)
e(l,"ITEM_WINDOW_LARGE",function ItemWindowLarge(e){this.initBase(e)
this.initBaked()
this.name=h.ITEM_WINDOW_LARGE_NAME
if(h.get("ITEM_WINDOW_LARGE_DESC"))this.desc=h.ITEM_WINDOW_LARGE_DESC
if(h.get("ITEM_WINDOW_LARGE_INFO"))this.info=h.ITEM_WINDOW_LARGE_INFO
this.cost=[d.fromMaterial(this,0,30)]},{intangible:false,size_auto:true,mat_baked_key:{IRON:"window-large-metal",STONE:"window-large-stone",FANCY_STONE:"window-large-fancystone",LIGHT_WOOD:"window-large-lightwood",DARK_WOOD:"window-large-darkwood",RED_WOOD:"window-large-redwood",def:"window-large-wood"}})
a(h.ITEM_WINDOW_MEDIUM_NAME)
e(l,"ITEM_WINDOW_MEDIUM",function ItemWindowMedium(e){this.initBase(e)
this.initBaked()
this.name=h.ITEM_WINDOW_MEDIUM_NAME
if(h.get("ITEM_WINDOW_MEDIUM_DESC"))this.desc=h.ITEM_WINDOW_MEDIUM_DESC
if(h.get("ITEM_WINDOW_MEDIUM_INFO"))this.info=h.ITEM_WINDOW_MEDIUM_INFO
this.cost=[d.fromMaterial(this,0,20)]},{intangible:false,size_auto:true,mat_baked_key:{IRON:"window-medium-metal",STONE:"window-medium-stone",FANCY_STONE:"window-medium-fancystone",LIGHT_WOOD:"window-medium-lightwood",DARK_WOOD:"window-medium-darkwood",RED_WOOD:"window-medium-redwood",def:"window-medium-wood"}})
a(h.ITEM_WINDOW_SMALL_NAME)
e(l,"ITEM_WINDOW_SMALL",function ItemWindowSmall(e){this.initBase(e)
this.initBaked()
this.name=h.ITEM_WINDOW_SMALL_NAME
if(h.get("ITEM_WINDOW_SMALL_DESC"))this.desc=h.ITEM_WINDOW_SMALL_DESC
if(h.get("ITEM_WINDOW_SMALL_INFO"))this.info=h.ITEM_WINDOW_SMALL_INFO
this.cost=[d.fromMaterial(this,0,10)]},{intangible:false,size_auto:true,mat_baked_key:{IRON:"window-small-metal",STONE:"window-small-stone",FANCY_STONE:"window-small-fancystone",LIGHT_WOOD:"window-small-lightwood",DARK_WOOD:"window-small-darkwood",RED_WOOD:"window-small-redwood",def:"window-small-wood"}})
a(h.ITEM_WORKBENCH_NAME)
e(l,"ITEM_WORKBENCH",function ItemWorkbench(e){this.initBase(e)
this.name=h.ITEM_WORKBENCH_NAME
if(h.get("ITEM_WORKBENCH_DESC"))this.desc=h.ITEM_WORKBENCH_DESC
if(h.get("ITEM_WORKBENCH_INFO"))this.info=h.ITEM_WORKBENCH_INFO
this.cost=[d.item({type:_,id:n.WOOD_RAW,count:10}),d.item({type:_,id:n.STONE_RAW,count:4})]
this.updateCostFromMatMap()},{def_material:s.WOOD,baked_key:"workbench",baked_swap:true,intangible:false,size_auto:true,cost_mat_map:{attr1:{cost_idx:0,def:"WOOD"},attr2:{cost_idx:1,def:"STONE"}},floater_z:1.5,particle_systems:[{name:"factory_workbench_particles",rot:0,offset_position:m(0,.21,1.5)}]})}},{"../../common/ids.js":198,"../../common/materials_common":201,"../../glov/common/util.js":330,"../../glov/common/vmath.js":332,"../items.js":98,"../localization/localization":108,"../tiles.js":162,assert:void 0}],15:[function(e,t,r){"use strict"
var a
e("../../glov/client/hsv").hsvToRGB
e("../../glov/common/vmath").vec3
e("../../common/ids")
e("../../common/ids").TYPE_ITEM
var i=e("../../common/materials_common")
i.CraftClass
i.Mat
var o=e("../tiles_const")
var n=o.LIQUID_TILES
o.TILES
o.FuelRate
o.Tint
t.exports=((a={})[n.WATER]={tile_code:"WATER",def:24,inv:[],name:"Water"},a[n.WATER_FLOW]={tile_code:"WATER_FLOW",def:34,inv:[],name:"Water"},a)},{"../../common/ids":198,"../../common/materials_common":201,"../../glov/client/hsv":269,"../../glov/common/vmath":332,"../tiles_const":163}],16:[function(e,t,r){"use strict"
var a,i,o,n,s
var l=e("../../glov/client/hsv").hsvToRGB
var c=e("../../glov/common/vmath").vec3
var _=e("../../common/ids")
var u=e("../../common/ids").TYPE_ITEM
var d=e("../../common/materials_common")
var f=d.CraftClass
var v=d.Mat
var h=e("../tiles_const")
h.LIQUID_TILES
var p=h.TILES
var m=h.FuelRate
var g=h.Tint
t.exports=((s={})[p.AETHERSTONE]={tile_code:"AETHERSTONE",mat:v.AETHERSTONE,def:4,not_material_source:true,variable_yield:true,name:"Drop Debug: Aetherstone",unplaceable:true},s[p.BRICK_CLAY]={tile_code:"BRICK_CLAY",mat:v.STONE,craft_class:f.BRICK,def:28,not_material_source:true,crafted:true},s[p.BRICK_STONE]={tile_code:"BRICK_STONE",mat:v.FANCY_STONE,craft_class:f.BRICK,def:36,crafted:true},s[p.COAL]={tile_code:"COAL",mat:v.COAL,def:4,inv:[{type:u,id:_.ITEM_COAL}],not_material_source:true},s[p.COBALT]={tile_code:"COBALT",mat:v.COBALT,def:4,not_material_source:true,variable_yield:true,name:"Drop Debug: Cobalt",unplaceable:true},s[p.COLORED_HUE0]={tile_code:"COLORED_HUE0",tint_color:l(c(),342,1,1),mat:v.WOOD,def:10,not_material_source:true,crafted:true},s[p.COLORED_HUE1]={tile_code:"COLORED_HUE1",tint_color:l(c(),38,1,1),mat:v.WOOD,def:10,not_material_source:true,crafted:true},s[p.COLORED_HUE2]={tile_code:"COLORED_HUE2",tint_color:l(c(),55,.85,1),mat:v.WOOD,def:10,not_material_source:true,crafted:true},s[p.COLORED_HUE3]={tile_code:"COLORED_HUE3",tint_color:l(c(),134,1,.89),mat:v.WOOD,def:10,not_material_source:true,crafted:true},s[p.COLORED_HUE4]={tile_code:"COLORED_HUE4",tint_color:l(c(),195,.67,1),mat:v.WOOD,def:10,not_material_source:true,crafted:true},s[p.COLORED_HUE5]={tile_code:"COLORED_HUE5",tint_color:l(c(),260,.63,.86),mat:v.WOOD,def:10,not_material_source:true,crafted:true},s[p.COPPER]={tile_code:"COPPER",mat:v.COPPER,def:4,not_material_source:true,variable_yield:true,name:"Drop Debug: Copper",unplaceable:true},s[p.CORAL]={tile_code:"CORAL",mat:v.CORAL,def:3,debug_only:true},s[p.DIRT]={tile_code:"DIRT",below:((a={})[p.STONE]=57,a),mat:v.DIRT,def:8,face:[9,9]},s[p.DIRT_WITH_FLINT]={tile_code:"DIRT_WITH_FLINT",mat:v.DIRT,blueprint:p.DIRT,def:33,inv:[p.DIRT,{type:u,id:_.ITEM_HATCHET,attr1:v.FLINT}],name:"Dirt (+Flint)",unplaceable:true},s[p.EMBERYLLIUM]={tile_code:"EMBERYLLIUM",mat:v.EMBERYLLIUM,def:4,not_material_source:true,variable_yield:true,name:"Drop Debug: Emberyllium",unplaceable:true},s[p.GLASS]={tile_code:"GLASS",mat:v.SAND,def:35,tile1:true,no_self:true,alpha_cutout:true,crafted:true},s[p.GOLD]={tile_code:"GOLD",mat:v.GOLD,def:4,not_material_source:true,variable_yield:true,name:"Drop Debug: Gold",unplaceable:true},s[p.GRASS]={tile_code:"GRASS",below:((i={})[p.GRASS]=1,i[p.STONE]=58,i),tint:g.GRASS,mat:v.DIRT,def:56,face:[1,9],inv:p.DIRT,not_material_source:true},s[p.IRON]={tile_code:"IRON",mat:v.IRON,def:4,not_material_source:true,variable_yield:true,name:"Drop Debug: Iron",unplaceable:true},s[p.LEAVES1]={tile_code:"LEAVES1",tint_color:l(c(),70,1,.76),mat:v.LEAF,def:20,inv:p.LEAVES3,not_material_source:true},s[p.LEAVES2]={tile_code:"LEAVES2",tint_color:l(c(),90,1,.76),mat:v.LEAF,def:20,inv:p.LEAVES3,not_material_source:true},s[p.LEAVES3]={tile_code:"LEAVES3",tint_color:l(c(),105,1,.76),mat:v.LEAF,fuel_rate:m.LEAVES,def:20,inv:p.LEAVES3},s[p.LEAVES4]={tile_code:"LEAVES4",tint_color:l(c(),120,1,.76),mat:v.LEAF,def:20,inv:p.LEAVES3,not_material_source:true},s[p.LEAVES5]={tile_code:"LEAVES5",tint_color:l(c(),140,1,.76),mat:v.LEAF,def:20,inv:p.LEAVES3,not_material_source:true},s[p.MYTHRIL]={tile_code:"MYTHRIL",mat:v.MYTHRIL,def:4,not_material_source:true,variable_yield:true,name:"Drop Debug: Mythril",unplaceable:true},s[p.ORE_IN_STONE]={tile_code:"ORE_IN_STONE",tint:g.ORE,mat:v.STONE,limited_blueprint:p.STONE,def:5,not_material_source:true,is_stone:true,unlimited_only:true,variable_yield:true},s[p.ORE_IN_STONE_DARK]={tile_code:"ORE_IN_STONE_DARK",tint:g.ORE,mat:v.STONE,limited_blueprint:p.STONE_DARK,def:13,not_material_source:true,is_stone:true,unlimited_only:true,variable_yield:true},s[p.ORE_IN_STONE_LIGHT]={tile_code:"ORE_IN_STONE_LIGHT",tint:g.ORE,mat:v.STONE,limited_blueprint:p.STONE_LIGHT,def:21,not_material_source:true,is_stone:true,unlimited_only:true,variable_yield:true},s[p.ORE_IN_STONE_RED]={tile_code:"ORE_IN_STONE_RED",tint:g.ORE,mat:v.STONE,limited_blueprint:p.STONE_RED,def:22,not_material_source:true,is_stone:true,unlimited_only:true,variable_yield:true},s[p.ORE_IN_VEINIUM]={tile_code:"ORE_IN_VEINIUM",tint:g.ORE,mat:v.STONE,limited_blueprint:p.VEINIUM,def:11,not_material_source:true,is_stone:true,unlimited_only:true,variable_yield:true},s[p.PASSABLE_LEAVES]={tile_code:"PASSABLE_LEAVES",tint_color:l(c(),90,1,.76),mat:v.LEAF,debug_as:p.LEAVES2,def:20,no_self:true,doublesided:true,draw_passable_overlay:true,inv:p.LEAVES3,not_material_source:true},s[p.PLANKS_WOOD]={tile_code:"PLANKS_WOOD",mat:v.WOOD,craft_class:f.WOOD_PLANK,fuel_rate:m.PLANKS,def:31,crafted:true},s[p.PLANKS_WOOD_DARK]={tile_code:"PLANKS_WOOD_DARK",mat:v.DARK_WOOD,craft_class:f.WOOD_PLANK,fuel_rate:m.PLANKS,def:47,crafted:true},s[p.PLANKS_WOOD_LIGHT]={tile_code:"PLANKS_WOOD_LIGHT",mat:v.LIGHT_WOOD,craft_class:f.WOOD_PLANK,fuel_rate:m.PLANKS,def:39,crafted:true},s[p.PLANKS_WOOD_RED]={tile_code:"PLANKS_WOOD_RED",mat:v.RED_WOOD,craft_class:f.WOOD_PLANK,fuel_rate:m.PLANKS,def:55,crafted:true},s.prop={def:52,tile1:true,unplaceable:true},s[p.SAND]={tile_code:"SAND",mat:v.SAND,def:18,face:[19,19]},s[p.SILVER]={tile_code:"SILVER",mat:v.SILVER,def:4,not_material_source:true,variable_yield:true,name:"Drop Debug: Silver",unplaceable:true},s[p.SNOW]={tile_code:"SNOW",mat:v.DIRT,def:26,face:[27,27],not_material_source:true},s[p.STONE]={tile_code:"STONE",mat:v.STONE,craft_class:f.STONE_RAW,def:16,face:[17,17],is_stone:true},s[p.STONE_DARK]={tile_code:"STONE_DARK",mat:v.STONE,craft_class:f.STONE_RAW,def:14,not_material_source:true,is_stone:true},s[p.STONE_LIGHT]={tile_code:"STONE_LIGHT",mat:v.STONE,craft_class:f.STONE_RAW,def:15,not_material_source:true,is_stone:true},s[p.STONE_RED]={tile_code:"STONE_RED",mat:v.STONE,craft_class:f.STONE_RAW,def:23,not_material_source:true,is_stone:true},s[p.TILLED]={tile_code:"TILLED",above:((o={})[p.TILLED]=8,o[p.TILLED_WATERED]=8,o[p.DIRT]=8,o[p.GRASS]=8,o),mat:v.DIRT,limited_blueprint:p.DIRT,def:59,face:[6,8],inv:p.DIRT,not_material_source:true,unlimited_only:true},s[p.TILLED_WATERED]={tile_code:"TILLED_WATERED",above:((n={})[p.TILLED]=8,n[p.TILLED_WATERED]=8,n[p.DIRT]=8,n[p.GRASS]=8,n),mat:v.DIRT,limited_blueprint:p.DIRT,def:60,face:[7,8],inv:p.DIRT,not_material_source:true,unlimited_only:true},s[p.TIN]={tile_code:"TIN",mat:v.TIN,def:4,not_material_source:true,variable_yield:true,name:"Drop Debug: Tin",unplaceable:true},s.unknown={mat:v.DIRT,def:52,tile1:true,inv:[],not_material_source:true,unknown:true,unplaceable:true},s[p.VEINIUM]={tile_code:"VEINIUM",mat:v.STONE,craft_class:f.STONE_RAW,def:12,not_material_source:true,is_stone:true},s[p.WOOD]={tile_code:"WOOD",mat:v.WOOD,craft_class:f.WOOD_RAW,fuel_rate:m.WOOD,def:29,face:[30,30]},s[p.WOOD_BARK]={tile_code:"WOOD_BARK",mat:v.WOOD,blueprint:p.WOOD,def:29,face:[30,30],inv:[p.WOOD,{type:u,id:_.ITEM_FIBER}],name:"Wood",name2:"Old Wood w/ Bark",unplaceable:true},s[p.WOOD_DARK]={tile_code:"WOOD_DARK",mat:v.DARK_WOOD,craft_class:f.WOOD_RAW,fuel_rate:m.WOOD,def:45,face:[46,46]},s[p.WOOD_DARK_BARK]={tile_code:"WOOD_DARK_BARK",mat:v.DARK_WOOD,blueprint:p.WOOD_DARK,def:45,face:[46,46],inv:[p.WOOD_DARK,{type:u,id:_.ITEM_FIBER}],name:"Dark Wood",name2:"Old Dark Wood w/ Bark",unplaceable:true},s[p.WOOD_LIGHT]={tile_code:"WOOD_LIGHT",mat:v.LIGHT_WOOD,craft_class:f.WOOD_RAW,fuel_rate:m.WOOD,def:37,face:[38,38]},s[p.WOOD_LIGHT_BARK]={tile_code:"WOOD_LIGHT_BARK",mat:v.LIGHT_WOOD,blueprint:p.WOOD_LIGHT,def:37,face:[38,38],inv:[p.WOOD_LIGHT,{type:u,id:_.ITEM_FIBER}],name:"Light Wood",name2:"Old Light Wood w/ Bark",unplaceable:true},s[p.WOOD_RED]={tile_code:"WOOD_RED",mat:v.RED_WOOD,craft_class:f.WOOD_RAW,fuel_rate:m.WOOD,def:53,face:[54,54]},s[p.WOOD_RED_BARK]={tile_code:"WOOD_RED_BARK",mat:v.RED_WOOD,blueprint:p.WOOD_RED,def:53,face:[54,54],inv:[p.WOOD_RED,{type:u,id:_.ITEM_FIBER}],name:"Red Wood",name2:"Old Red Wood w/ Bark",unplaceable:true},s)},{"../../common/ids":198,"../../common/materials_common":201,"../../glov/client/hsv":269,"../../glov/common/vmath":332,"../tiles_const":163}],17:[function(e,t,r){"use strict"
r.drawBaked=drawBaked
r.drawBaked2=drawBaked2
r.getBakedEmit=getBakedEmit
r.assertBakeRuleExists=assertBakeRuleExists
r.resetBakeRules=resetBakeRules
r.bakedEmits=bakedEmits
r.bakedSize=bakedSize
r.bakedSwapped=bakedSwapped
r.bakedSwappedSimple=bakedSwappedSimple
r.startup=startup
var d=e("assert")
var ee=e("../glov/client/engine")
var te=e("../glov/client/filewatch").filewatchOn
var a=e("../glov/client/quat")
var g=a.qFromAxisAngle
var E=a.qRotateX
var y=a.qRotateY
var T=a.qRotateZ
var i=a.quat
var o=e("../glov/client/webfs")
var re=o.webFSExists
var ae=o.webFSGetFile
var n=e("../glov/common/util")
var f=n.defaults
var s=n.mod
var l=n.nop
var I=e("../glov/common/verify")
var c=e("../glov/common/vmath")
var _=c.unit_vec
var S=c.v3add
var A=c.v3iAdd
var w=c.v4copy
var u=c.vec3
var L=c.zaxis
var v=e("../common/globals").CHUNK_SIZE
var h=e("../common/materials_common.js").Mat
var p=e("./mesh_calc").meshCalcBakeRules
var m=e("./palette")
var R=m.generateSwapKey
var x=m.paletteGet
var O=m.paletteSwap
var b=e("./task_sched")
var N=b.WORKER_MESH
var C=b.taskCreate
var M=b.workerFlush
var D=e("./tiles")
var P=D.TILE_INTANGIBLE
var k=D.TILE_PROP_BASE
var B=D.TILE_PROP_MAX
var U=e("./voxel_data")
var G=U.andGetProp
var F=U.getTileLocal
var W=e("./voxel_data_xraw").loadXRAW
var j=Math.max,ie=Math.PI
var oe=30/180*ie
var H=-.25*ie
var ne
function fitsPeriod(e,t){if(s(e[0],v)%t[0]^s(e[1],v)%t[1]^s(e[2],v)%t[2])return false
return true}var z=u()
var V=u()
var Y=i()
function isTangible(e,t){S(z,e,t)
var r=F(z,0,false)
if(!r)return false
if(r>=P)if(r>=k&&r<=B){var a=G()
if(!a||a.inv.intangible)return false}else return false
return true}function isSame(e,t,r){S(z,e,t)
var a=F(z,0,false)
if(a>=k&&a<=B){var i=G()
if(i&&i.item_id===r.item_id)return true}return false}function isEmpty(e,t){S(z,e,t)
return!F(z,0,false)}function drawBaked(e,t){var r=e.baked.key
var a=ne[r]
if(!I(a))return
w(Y,e.quat)
var i
var o=e.draw_opts.for_snapshot
for(var n=0;n<a.rules.length;++n){i=a.rules[n]
if(o){if(i.snapshot)break
continue}var s=true
if(i.period&&!fitsPeriod(t,i.period))s=false
if(i.same)for(var l=0;l<i.same.length;++l)if(!isSame(t,i.same[l],e)){s=false
break}if(i.tangible)for(var c=0;c<i.tangible.length;++c)if(!isTangible(t,i.tangible[c])){s=false
break}if(i.intangible)for(var _=0;_<i.intangible.length;++_)if(isTangible(t,i.intangible[_])){s=false
break}if(i.empty)for(var u=0;u<i.empty.length;++u)if(!isEmpty(t,i.empty[u])){s=false
break}if(s)break}if(!i)return
if(void 0!==i.rot)g(Y,L,i.rot*ie/2)
var d=1
S(V,t,e.draw_offs)
if(o){if(a.tool){var f=i.data.drawing.vd,v=f.maxpos,h=f.minpos
var p=j(v[0]-h[0],v[1]-h[1],v[2]-h[2])+1
V[1]-=h[0]/7
d=7/p}if(a.roty===oe){y(Y,Y,oe)
A(V,[-.28,0,.03])}else if(a.roty===H){y(Y,Y,H)
A(V,[.35,0,.13])}else if(a.roty)y(Y,Y,a.roty)
if(a.draw_offs)A(V,a.draw_offs)
if(a.rotx)E(Y,Y,a.rotx)
if(a.rotz)T(Y,Y,a.rotz)}var m=i.data.drawing
e.draw_opts.unlit=!e.draw_opts.scale_lights
if(a.emit)e.draw_opts.torch_factor=a.emit
m.draw(V,Y,d,e.draw_opts)}function drawBaked2(e,t,r){var a=ne[t]
d(a)
var i
for(var o=0;o<a.rules.length;++o)if((i=a.rules[o]).snapshot||i.preview)break
if(!i)return
var n=i.data.drawing
if(a.emit)r.torch_factor=a.emit
n.drawMat(e,r)}function getBakedEmit(e){var t=ne[e]
d(t)
return t.emit}function assertBakeRuleExists(e){d(ne[e])}function lookupMat(e){if(!e)return 0
d(h[e],'Unknown material "'+e+'"')
return h[e]}var q
function loadBothSub(e,t){if(q)return q
d(!t.origin_offset||Array.isArray(t.origin_offset)||t.origin_offset instanceof Float32Array)
var r=W(e,f({for_baking:true},t))
d(r.baked)
if(ee.defines.NOPROPS)q={meshing:r.baked,drawing:r}
return{meshing:r.baked,drawing:r}}function loadBoth(e,t){var r=lookupMat(t.mat1)
var a=lookupMat(t.mat2)
var i=loadBothSub(e,t)
if(r||a){i.src_mat1=r
i.src_mat2=a}i.orig_filename=e
return i}function replaceWithMeshing(e){d(e.meshing)
return e.meshing}function cloneDataReplace(e,t){if("object"!==typeof e)return e
if(Array.isArray(e)){var r=[]
for(var a=0;a<e.length;++a)r[a]=cloneDataReplace(e[a],t)
return r}var i={}
for(var o in e){var n=e[o]
if("data"===o)i[o]=t(n)
else i[o]=cloneDataReplace(n,t)}return i}function updateRules(e){var t=cloneDataReplace(e,replaceWithMeshing)
t.metal_tints=x("metal_tints")
if(!ee.defines.NOWORKERS){C({worker:N,time:0,type:"mesh_bake_rules",data:t},l)
M(N)}p(t)}function resetBakeRules(){updateRules(ne)}function bakedEmits(e){return ne[e]&&ne[e].emit||0}function bakedSize(e){return ne[e]&&ne[e].size||_}function bakedSwapped(e,c,_){var t=e+","+(c=c||0)+","+(_=_||0)
if(ne[t])return t
var r=ne[e]
if(!r)d(r,"Could not find bake_rule["+e+"]")
var u=[]
var a=cloneDataReplace(r,function(e){for(var t=0;t<u.length;++t)if(u[t].key===e)return u[t].value
var r
if(!e.orig_filename)r=e
else{var a=e.src_mat1,i=e.src_mat2,o=e.orig_filename
var n=e.drawing.opts
d(n)
var s={}
if(a&&c)s[a]=c
if(i&&_)s[i]=_
var l=O(n.palette,s)
r=loadBothSub(o,f({palette:l},n))}u.push({key:e,value:r})
return r})
ne[t]=a
var i={}
i[t]=a
updateRules(i)
return t}function bakedSwappedSimple(e,o){var t=R(e,o)
if(ne[t])return t
var r=ne[e]
if(!r)d(r,"Could not find bake_rule["+e+"]")
var n=[]
var a=cloneDataReplace(r,function(e){for(var t=0;t<n.length;++t)if(n[t].key===e)return n[t].value
var r
var a=e.drawing.opts
d(a)
var i=O(a.palette,o)
r=loadBothSub(e.orig_filename,f({palette:i},a))
n.push({key:e,value:r})
return r})
ne[t]=a
var i={}
i[t]=a
updateRules(i)
return t}function simple(e){return{rules:[{data:e}],size:e.meshing.size}}function simpleEmit(e,t){return{rules:[{data:e}],size:e.meshing.size,emit:t||1}}function tool(e){return{tool:1,rotx:30/180*ie,roty:H,rotz:-.5*ie,rules:[{data:e}],size:e.meshing.size}}function torchRules(e,t,r,a,i){var o={emit:1,rules:[{tangible:[[0,0,-1]],data:e,snapshot:1},{tangible:[[0,-1,0]],data:t,rot:0},{tangible:[[0,1,0]],data:t,rot:2},{tangible:[[1,0,0]],data:t,rot:1},{tangible:[[-1,0,0]],data:t,rot:3},{tangible:[[0,0,1]],data:r},{data:a}],size:e.meshing.size}
if(i)o.rules.splice(1,0,{tangible:[[0,0,1],[0,1,0],[0,-1,0]],data:r,rot:0},{tangible:[[0,0,1],[1,0,0],[-1,0,0]],data:r,rot:1},{tangible:[[0,0,1],[0,1,0],[-1,0,0]],data:i,rot:0},{tangible:[[0,0,1],[-1,0,0],[0,-1,0]],data:i,rot:1},{tangible:[[0,0,1],[0,-1,0],[1,0,0]],data:i,rot:2},{tangible:[[0,0,1],[1,0,0],[0,1,0]],data:i,rot:3},{tangible:[[0,0,1],[0,1,0]],data:r,rot:0},{tangible:[[0,0,1],[0,-1,0]],data:r,rot:2},{tangible:[[0,0,1],[1,0,0]],data:r,rot:1},{tangible:[[0,0,1],[-1,0,0]],data:r,rot:3})
return o}function fenceRules(e,t,r,a,i,o,n){return{rules:[{tangible:[[1,0,0],[0,-1,0],[-1,0,0],[0,1,0]],data:o,rot:0},{tangible:[[1,0,0],[0,-1,0],[-1,0,0]],data:i,rot:0},{tangible:[[1,0,0],[-1,0,0],[0,1,0]],data:i,rot:2},{tangible:[[1,0,0],[0,-1,0],[0,1,0]],data:i,rot:1},{tangible:[[0,-1,0],[-1,0,0],[0,1,0]],data:i,rot:3},{tangible:[[1,0,0],[2,0,0],[-1,0,0],[-2,0,0]],intangible:[[1,-1,0],[1,1,0],[-1,-1,0],[-1,1,0]],period:[4,1,1],data:n,rot:0,snapshot:1},{tangible:[[0,1,0],[0,2,0],[0,-1,0],[0,-2,0]],intangible:[[1,-1,0],[1,1,0],[-1,-1,0],[-1,1,0]],period:[1,4,1],data:n,rot:1},{tangible:[[1,0,0],[-1,0,0]],data:e,rot:0},{tangible:[[0,-1,0],[0,1,0]],data:e,rot:1},{tangible:[[1,0,0],[0,-1,0]],data:a,rot:0},{tangible:[[-1,0,0],[0,1,0]],data:a,rot:2},{tangible:[[1,0,0],[0,1,0]],data:a,rot:1},{tangible:[[0,-1,0],[-1,0,0]],data:a,rot:3},{tangible:[[0,-1,0]],data:r,rot:0},{tangible:[[0,1,0]],data:r,rot:2},{tangible:[[1,0,0]],data:r,rot:1},{tangible:[[-1,0,0]],data:r,rot:3},{data:t}],size:e.meshing.size}}function ladderRules(e,t,r){return{rules:[{period:[1,1,2],data:t},{data:r},{snapshot:1,data:e}],size:e.meshing.size}}function startup(){var e=["wood","lightwood","darkwood","redwood","stone","fancystone","metal"]
var t=["red","orange","yellow","green","blue","purple"]
ne={}
var a=ae("model_opts/torch-cube","jsobj")
e.forEach(function(e){var t="torch-"+e
if(e.includes("wood"))ne[t]=torchRules(loadBoth(t+"-torch-base.vm",ae("model_opts/torch-base","jsobj")),loadBoth(t+"-torch-horiz.vm",ae("model_opts/torch-horiz","jsobj")),loadBoth(t+"-torch-top.vm",ae("model_opts/torch-top","jsobj")),loadBoth(t+"-torch-float.vm",ae("model_opts/torch-float","jsobj")))
var r
if(re(t+"-lantern-top-corner.vm"))r=loadBoth(t+"-lantern-top-corner.vm",ae("model_opts/torch-top","jsobj"))
ne["lantern-"+e]=torchRules(loadBoth(t+"-lantern-base.vm",ae("model_opts/torch-base","jsobj")),loadBoth(t+"-lantern-horiz.vm",ae("model_opts/torch-horiz","jsobj")),loadBoth(t+"-lantern-top.vm",ae("model_opts/torch-top","jsobj")),loadBoth(t+"-lantern-float.vm",ae("model_opts/torch-float","jsobj")),r)
ne["cubelight-"+e]=simpleEmit(loadBoth("torch-"+e+"-cube.vm",a))})
var r=ae("model_opts/fence","jsobj")
var i=ae("model_opts/fence-pole","jsobj")
var o=ae("model_opts/fence-end","jsobj")
var n=ae("model_opts/fence-corner","jsobj")
var s=ae("model_opts/fence-t","jsobj")
var l=ae("model_opts/fence-plus","jsobj")
var c=ae("model_opts/fence-dash","jsobj")
e.forEach(function(e){ne["fence-"+e]=fenceRules(loadBoth("fence-"+e+".vm",r),loadBoth("fence-"+e+"-pole.vm",i),loadBoth("fence-"+e+"-end.vm",o),loadBoth("fence-"+e+"-corner.vm",n),loadBoth("fence-"+e+"-t.vm",s),loadBoth("fence-"+e+"-plus.vm",l),loadBoth("fence-"+e+"-dash.vm",c))})
var _=ae("model_opts/ladder","jsobj")
var u=ae("model_opts/ladder-half","jsobj")
var d=ae("model_opts/ladder-half","jsobj")
e.forEach(function(e){ne["ladder-"+e]=ladderRules(loadBoth("ladder-"+e+".vm",_),loadBoth("ladder-"+e+"-up.vm",u),loadBoth("ladder-"+e+"-down.vm",d))})
function loadSimple(e,t){ne[e]=simple(loadBoth(e+".vm",t))}var f=ae("model_opts/plant-7x7","jsobj")
var v=ae("model_opts/plant-15x15","jsobj")
var h=ae("model_opts/plant-7x7-blue","jsobj")
var p=ae("model_opts/plant-7x7-sway","jsobj")
loadSimple("plant-seed",f)
loadSimple("mushroom-seed",p)
loadSimple("plant-1",ae("model_opts/plant-1","jsobj"))
loadSimple("plant-2",p)
loadSimple("plant-3",p)
loadSimple("plant-4",p)
loadSimple("plant-5",ae("model_opts/plant-5","jsobj"))
loadSimple("plant-6",ae("model_opts/plant-6","jsobj"))
loadSimple("plant-7",ae("model_opts/plant-7","jsobj"))
loadSimple("plant-8",ae("model_opts/plant-8","jsobj"))
loadSimple("plant-13",p)
loadSimple("plant-14",p)
loadSimple("plant-15",p)
loadSimple("plant-16",p)
loadSimple("plant-17",p)
loadSimple("plant-18",p)
loadSimple("plant-19",p)
loadSimple("plant-20",p)
loadSimple("plant-21",p)
loadSimple("plant-22",p)
loadSimple("plant-23",p)
loadSimple("plant-24",p)
loadSimple("plant-25",p)
loadSimple("plant-26",p)
loadSimple("plant-27",p)
loadSimple("plant-28",p)
loadSimple("plant-29",p)
loadSimple("plant-30",p)
loadSimple("plant-31",p)
loadSimple("plant-32",p)
loadSimple("plant-33",p)
var m=loadBoth("plant-34.vm",f)
ne["plant-34"]=simpleEmit(m,.5)
ne["plant-35"]=simpleEmit(m,.4)
ne["plant-36"]=simpleEmit(m,.25)
ne["plant-34-no-emit"]=simple(m)
ne["plant-36-no-emit"]=ne["plant-35-no-emit"]=ne["plant-34-no-emit"]
loadSimple("plant-37",p)
loadSimple("plant-38",p)
var g=ae("model_opts/plant-14x14","jsobj")
loadSimple("red-berry-bush-0",g)
ne["yellow-berry-bush-0"]=ne["blue-berry-bush-0"]=ne["red-berry-bush-0"]
loadSimple("red-berry-bush-1",g)
loadSimple("red-berry-bush-2",g)
loadSimple("blue-berry-bush-1",g)
loadSimple("blue-berry-bush-2",g)
loadSimple("yellow-berry-bush-1",g)
loadSimple("yellow-berry-bush-2",g)
loadSimple("berries",h)
loadSimple("bottle",f)
loadSimple("hot-plant",f)
loadSimple("hot",f)
loadSimple("pungent-plant",f)
loadSimple("pungent",f)
loadSimple("savory-plant",f)
loadSimple("savory",f)
loadSimple("wild-crop-tomato",f)
loadSimple("wild-crop-corn",f)
loadSimple("wild-crop-pumpkin",f)
loadSimple("wild-crop-wheat",f)
loadSimple("wild-crop-carrot",f)
loadSimple("wild-crop-sugarcane",f)
var E=ae("model_opts/crop-corn","jsobj")
for(var y=1;y<9;y++)loadSimple("crop-corn-"+y,E)
loadSimple("corn-harvested",v)
var T=ae("model_opts/crop-wheat","jsobj")
for(var I=1;I<6;I++)loadSimple("crop-wheat-"+I,T)
loadSimple("wheat-harvested",v)
loadSimple("flour",f)
var S=ae("model_opts/crop-sugar-cane","jsobj")
for(var A=1;A<6;A++)loadSimple("crop-sugar-cane-"+A,S)
loadSimple("sugar-cane-harvested",v)
loadSimple("sugar",v)
var w=ae("model_opts/crop-tomato","jsobj")
for(var L=1;L<6;L++)loadSimple("crop-tomato-"+L,w)
var R=ae("model_opts/crop-pumpkin","jsobj")
for(var x=1;x<5;x++)loadSimple("crop-carrot-"+x,R)
var O=ae("model_opts/crop-pumpkin","jsobj")
for(var b=1;b<6;b++)loadSimple("crop-pumpkin-"+b,O)
loadSimple("tomato",v)
loadSimple("carrot",v)
loadSimple("pumpkin",v)
loadSimple("mushroom",f)
loadSimple("bread",ae("model_opts/prop-mat-7x7","jsobj"))
loadSimple("pie",f)
loadSimple("leftovers",ae("model_opts/leftovers","jsobj"))
loadSimple("roast-vegetables",f)
loadSimple("sandwich",v)
loadSimple("croissant",v)
var N=ae("model_opts/seashell","jsobj")
t.forEach(function(e){loadSimple("seashell-"+e,N)})
loadSimple("coral_powder",ae("model_opts/coral_powder","jsobj"))
var C=ae("model_opts/starfish","jsobj")
loadSimple("starfish-red",C)
loadSimple("starfish-yellow",C)
loadSimple("starfish-blue",C)
var M=ae("model_opts/watering-system","jsobj")
for(var D=0;D<4;D++)loadSimple("watering-system-"+D,M)
loadSimple("paint",ae("model_opts/prop-mat-7x7","jsobj"))
var P=ae("model_opts/chest-medium","jsobj")
var k=ae("model_opts/chest-tiny","jsobj")
var B=ae("model_opts/chest-small","jsobj")
e.forEach(function(e){loadSimple("chest-medium-"+e,P)
loadSimple("chest-tiny-"+e,k)
loadSimple("chest-small-"+e,B)})
loadSimple("chest-medium-wood-sunken",P)
loadSimple("chest-tall-wood",ae("model_opts/chest-tall-wood","jsobj"))
loadSimple("chest-tall-darkwood",ae("model_opts/chest-tall-darkwood","jsobj"))
loadSimple("chest-tall-redwood",ae("model_opts/chest-tall-redwood","jsobj"))
loadSimple("chest-tall-lightwood",ae("model_opts/chest-tall-lightwood","jsobj"))
loadSimple("chest-tall-stone",ae("model_opts/chest-tall-stone","jsobj"))
loadSimple("chest-tall-fancystone",ae("model_opts/chest-tall-fancystone","jsobj"))
loadSimple("chest-tall-metal",ae("model_opts/chest-tall-metal","jsobj"))
var U=ae("model_opts/rod-h","jsobj")
var G=loadBoth("rod-h1.vm",U)
var F=loadBoth("rod-h2.vm",U)
var W=ae("model_opts/rod-v","jsobj")
var j=loadBoth("rod-v1.vm",W)
var H=loadBoth("rod-v2.vm",W)
var z=loadBoth("rod-snapshot.vm",W)
ne.rod={roty:oe,rules:[{tangible:[[0,0,-1]],period:[1,1,2],data:j},{tangible:[[0,0,-1]],data:H},{same:[[0,1,0]],period:[1,2,1],data:G},{same:[[0,1,0]],data:F},{same:[[0,-1,0]],period:[1,2,1],data:G},{same:[[0,-1,0]],data:F},{same:[[1,0,0]],period:[2,1,1],data:G,rot:1},{same:[[1,0,0]],data:F,rot:1},{same:[[-1,0,0]],period:[2,1,1],data:G,rot:1},{same:[[-1,0,0]],data:F,rot:1},{tangible:[[0,1,0],[0,-1,0]],period:[1,2,1],data:G},{tangible:[[0,1,0],[0,-1,0]],data:F},{tangible:[[1,0,0],[-1,0,0]],period:[2,1,1],data:G,rot:1},{tangible:[[1,0,0],[-1,0,0]],data:F,rot:1},{tangible:[[0,1,0]],period:[1,2,1],data:G},{tangible:[[0,1,0]],data:F},{tangible:[[0,-1,0]],period:[1,2,1],data:G},{tangible:[[0,-1,0]],data:F},{tangible:[[1,0,0]],period:[2,1,1],data:G,rot:1},{tangible:[[1,0,0]],data:F,rot:1},{tangible:[[-1,0,0]],period:[2,1,1],data:G,rot:1},{tangible:[[-1,0,0]],data:F,rot:1},{period:[1,1,2],data:j},{data:H,preview:1},{snapshot:1,data:z}],size:j.meshing.size}
ne.rodv={roty:0,rules:[{period:[1,1,2],data:j},{data:H,preview:1},{snapshot:1,data:z}],size:j.meshing.size}
ne.rodh={rotx:30/180*ie,roty:.5*ie,draw_offs:[-1,0,1],rules:[{period:[2,2,1],data:G},{data:F,preview:1},{snapshot:1,data:z}],size:G.meshing.size}
function loadTools(e,t){ne[e+"_pickax"]=tool(loadBoth(e+"-15-pickax.vm",t))
ne[e+"_hatchet"]=tool(loadBoth(e+"-15-hatchet.vm",t))
ne[e+"_hoe"]=tool(loadBoth(e+"-15-hoe.vm",t))
ne[e+"_shovel"]=tool(loadBoth(e+"-15-shovel.vm",t))
ne[e+"_shovel"].rotz=ie
ne[e+"_hoe"].roty=oe}loadTools("metal",ae("model_opts/metal-15","jsobj"))
loadTools("stone",ae("model_opts/stone-15","jsobj"))
ne["crude-stone-hatchet"]=tool(loadBoth("crude-stone-hatchet.vm",ae("model_opts/crude-stone-hatchet","jsobj")))
ne["crude-stone-pickax"]=tool(loadBoth("crude-stone-pickax.vm",ae("model_opts/crude-stone-pickax","jsobj")))
ne["crude-stone-shovel"]=tool(loadBoth("crude-stone-shovel.vm",ae("model_opts/crude-stone-shovel","jsobj")))
loadSimple("dowser",ae("model_opts/dowser","jsobj"))
loadSimple("dowser-advanced",ae("model_opts/dowser","jsobj"))
var V=ae("model_opts/bucket","jsobj")
ne.bucket_full=tool(loadBoth("bucket-full.vm",V))
ne.bucket_empty=tool(loadBoth("bucket-empty.vm",V))
ne.bucket_full.rotz=ne.bucket_empty.rotz=ie/4
ne.bucket_full.roty=ne.bucket_empty.roty=0
ne.bucket_full.rotx=ne.bucket_empty.rotx=ie/6
var Y=ae("model_opts/bluebox","jsobj")
loadSimple("bluebox-paused",Y)
loadSimple("bluebox-pre-edit",Y)
loadSimple("bluebox-build",Y)
loadSimple("bluebox-edit",Y)
loadSimple("access_control",ae("model_opts/access_control","jsobj"))
loadSimple("waygate",ae("model_opts/waygate","jsobj"))
loadSimple("leapgate",ae("model_opts/leapgate","jsobj"))
loadSimple("leapgate_shard",ae("model_opts/leapgate_shard","jsobj"))
loadSimple("gem",ae("model_opts/gem","jsobj"))
loadSimple("unknown",ae("model_opts/unknown","jsobj"))
ne.buzzerstart_ready=simpleEmit(loadBoth("buzzerstart_ready.vm",ae("model_opts/buzzerstart","jsobj")),.3)
ne.buzzergoal_ready=simpleEmit(loadBoth("buzzergoal_ready.vm",ae("model_opts/buzzergoal","jsobj")),.3)
ne.buzzerstart_racing=simpleEmit(loadBoth("buzzerstart_racing.vm",ae("model_opts/buzzerstart","jsobj")),.3)
ne.buzzergoal_racing=simpleEmit(loadBoth("buzzergoal_racing.vm",ae("model_opts/buzzergoal","jsobj")),.3)
loadSimple("buzzerstart_blank",ae("model_opts/buzzerstart","jsobj"))
loadSimple("buzzergoal_blank",ae("model_opts/buzzergoal","jsobj"))
var q=ae("model_opts/shelf","jsobj")
e.forEach(function(e){loadSimple("shelf-"+e,q)})
var K=loadBoth("flowerpot.vm",ae("model_opts/flowerpot","jsobj"))
var Z=loadBoth("flowerpot-wall.vm",ae("model_opts/flowerpot-wall","jsobj"))
var X=loadBoth("flowerpot-wall.vm",ae("model_opts/flowerpot-wall-raised","jsobj"))
ne.flowerpot={rules:[{empty:[[0,0,-1],[0,0,1]],tangible:[[0,1,0]],data:X},{empty:[[0,0,-1],[0,0,1]],tangible:[[0,-1,0]],data:X,rot:2},{empty:[[0,0,-1],[0,0,1]],tangible:[[1,0,0]],data:X,rot:3},{empty:[[0,0,-1],[0,0,1]],tangible:[[-1,0,0]],data:X,rot:1},{empty:[[0,0,-1]],tangible:[[0,1,0]],data:Z},{empty:[[0,0,-1]],tangible:[[0,-1,0]],data:Z,rot:2},{empty:[[0,0,-1]],tangible:[[1,0,0]],data:Z,rot:3},{empty:[[0,0,-1]],tangible:[[-1,0,0]],data:Z,rot:1},{data:K,preview:1}],size:K.meshing.size}
var Q=ae("model_opts/steps","jsobj")
e.forEach(function(e){loadSimple("steps-"+e,Q)})
loadSimple("table-large-wood",ae("model_opts/table-large-wood","jsobj"))
loadSimple("table-large-lightwood",ae("model_opts/table-large-lightwood","jsobj"))
loadSimple("table-large-darkwood",ae("model_opts/table-large-darkwood","jsobj"))
loadSimple("table-large-redwood",ae("model_opts/table-large-redwood","jsobj"))
loadSimple("table-large-stone",ae("model_opts/table-large-stone","jsobj"))
loadSimple("table-large-fancystone",ae("model_opts/table-large-fancystone","jsobj"))
loadSimple("table-large-metal",ae("model_opts/table-large-metal","jsobj"))
loadSimple("table-small-wood",ae("model_opts/table-small-wood","jsobj"))
loadSimple("table-small-lightwood",ae("model_opts/table-small-lightwood","jsobj"))
loadSimple("table-small-darkwood",ae("model_opts/table-small-darkwood","jsobj"))
loadSimple("table-small-redwood",ae("model_opts/table-small-redwood","jsobj"))
loadSimple("table-small-stone",ae("model_opts/table-small-stone","jsobj"))
loadSimple("table-small-fancystone",ae("model_opts/table-small-fancystone","jsobj"))
loadSimple("table-small-metal",ae("model_opts/table-small-metal","jsobj"))
loadSimple("chair-wood",ae("model_opts/chair-wood","jsobj"))
loadSimple("chair-lightwood",ae("model_opts/chair-lightwood","jsobj"))
loadSimple("chair-darkwood",ae("model_opts/chair-darkwood","jsobj"))
loadSimple("chair-redwood",ae("model_opts/chair-redwood","jsobj"))
loadSimple("chair-stone",ae("model_opts/chair-stone","jsobj"))
loadSimple("chair-fancystone",ae("model_opts/chair-fancystone","jsobj"))
loadSimple("chair-metal",ae("model_opts/chair-metal","jsobj"))
loadSimple("bench-wood",ae("model_opts/bench-wood","jsobj"))
loadSimple("bench-lightwood",ae("model_opts/bench-lightwood","jsobj"))
loadSimple("bench-darkwood",ae("model_opts/bench-darkwood","jsobj"))
loadSimple("bench-redwood",ae("model_opts/bench-redwood","jsobj"))
loadSimple("bench-stone",ae("model_opts/bench-stone","jsobj"))
loadSimple("bench-fancystone",ae("model_opts/bench-fancystone","jsobj"))
loadSimple("bench-metal",ae("model_opts/bench-metal","jsobj"))
loadSimple("bed-wood",ae("model_opts/bed-wood","jsobj"))
loadSimple("bed-lightwood",ae("model_opts/bed-lightwood","jsobj"))
loadSimple("bed-darkwood",ae("model_opts/bed-darkwood","jsobj"))
loadSimple("bed-redwood",ae("model_opts/bed-redwood","jsobj"))
loadSimple("bed-stone",ae("model_opts/bed-stone","jsobj"))
loadSimple("bed-fancystone",ae("model_opts/bed-fancystone","jsobj"))
loadSimple("bed-metal",ae("model_opts/bed-metal","jsobj"))
loadSimple("signboard",ae("model_opts/signboard","jsobj"))
loadSimple("signpost",ae("model_opts/signpost","jsobj"))
loadSimple("rug",ae("model_opts/rug","jsobj"))
loadSimple("ore-iron",ae("model_opts/ore-iron","jsobj"))
loadSimple("coal",ae("model_opts/coal","jsobj"))
loadSimple("ingot-iron",ae("model_opts/ingot-iron","jsobj"))
loadSimple("furnace-ore",ae("model_opts/furnace-ore","jsobj"))
loadSimple("furnace-glass",ae("model_opts/furnace-glass","jsobj"))
loadSimple("sawmill",ae("model_opts/sawmill","jsobj"))
loadSimple("workbench",ae("model_opts/workbench","jsobj"))
loadSimple("anvil",ae("model_opts/anvil","jsobj"))
loadSimple("juicer",ae("model_opts/factory-placeholder","jsobj"))
ne.campfire=simpleEmit(loadBoth("campfire.vm",ae("model_opts/factory-placeholder","jsobj")),1)
loadSimple("tool-head-cast",ae("model_opts/tool-head-cast","jsobj"))
loadSimple("oven",ae("model_opts/oven","jsobj"))
loadSimple("mill",ae("model_opts/mill","jsobj"))
loadSimple("kiln",ae("model_opts/kiln","jsobj"))
loadSimple("factory-placeholder",ae("model_opts/factory-placeholder","jsobj"))
loadSimple("stonecutter-simple",ae("model_opts/stonecutter-simple","jsobj"))
loadSimple("stonecutter-advanced",ae("model_opts/stonecutter-advanced","jsobj"))
loadSimple("cord",ae("model_opts/cord","jsobj"))
loadSimple("fiber",ae("model_opts/fiber","jsobj"))
loadSimple("tool-head",ae("model_opts/tool-head","jsobj"))
loadSimple("paint-mixer",ae("model_opts/paint-mixer","jsobj"))
loadSimple("veinium-grinder",ae("model_opts/veinium-grinder","jsobj"))
ne.bonfire=simpleEmit(loadBoth("bonfire.vm",ae("model_opts/bonfire","jsobj")),1)
ne.bonfire_metal=simpleEmit(loadBoth("bonfire-metal.vm",ae("model_opts/bonfire-metal","jsobj")),1)
var J=ae("model_opts/energy-well","jsobj")
loadSimple("energy-well-empty",J)
loadSimple("energy-well-full1",J)
loadSimple("energy-well-full2",J)
loadSimple("energy-well-full3",J)
var $={small:ae("model_opts/window-small","jsobj"),medium:ae("model_opts/window-medium","jsobj"),large:ae("model_opts/window-large","jsobj")}
e.forEach(function(r){["small","medium","large"].forEach(function(e){var t="window-"+e+"-"+r
ne[t]=simple(loadBoth(t+".vm",$[e]))})})
ne["emit-1x2"]={emit:1,size:[1,1,2],rules:[]}
if(ee.DEBUG){ne.test00=simple(loadBoth("test00.vm",ae("model_opts/test00","jsobj")))
ne.test01=simple(loadBoth("test01.vm",ae("model_opts/test01","jsobj")))
ne.test02=simple(loadBoth("test02.vm",ae("model_opts/test02","jsobj")))
ne.test03=simple(loadBoth("test03.vm",ae("model_opts/test03","jsobj")))
ne.test04=simple(loadBoth("test04.vm",ae("model_opts/test04","jsobj")))
ne.test05=simple(loadBoth("test05.vm",ae("model_opts/test05","jsobj")))
ne.test06=simple(loadBoth("test06.vm",ae("model_opts/test06","jsobj")))
ne.test07=simple(loadBoth("test07.vm",ae("model_opts/test07","jsobj")))
ne.test08=simple(loadBoth("test08.vm",ae("model_opts/test08","jsobj")))
ne.test09=simple(loadBoth("test09.vm",ae("model_opts/test09","jsobj")))}updateRules(ne)
te(/^model_opts\//,ee.reloadSafe)}},{"../common/globals":197,"../common/materials_common.js":201,"../glov/client/engine":250,"../glov/client/filewatch":259,"../glov/client/quat":287,"../glov/client/webfs":309,"../glov/common/util":330,"../glov/common/verify":331,"../glov/common/vmath":332,"./mesh_calc":118,"./palette":123,"./task_sched":161,"./tiles":162,"./voxel_data":175,"./voxel_data_xraw":176,assert:void 0}],18:[function(e,t,r){"use strict"
r.fdeg=fdeg
r.fpos=fpos
r.isJumpingController=isJumpingController
r.isFlyingController=isFlyingController
r.isDoubleJumpToFlyController=isDoubleJumpToFlyController
r.BaseController=r.TODEG=r.TORAD=r.MAX_STEP_DT=r.MAX_TIMESLICE=void 0
var a=e("../glov/common/util").clamp
var i=e("../glov/common/verify")
var o=e("../glov/common/vmath")
var n=o.v2copy
var s=o.v3copy
var l=o.v3iAdd
var c=o.vec2
var _=o.vec3
var u=o.zero_vec
var d=e("../common/globals")
var f=d.CHUNK_SIZE
var v=d.SAFE_DIST
var h=d.SAFE_DIST_Z
var p=e("./camera")
var m=p.getActiveController
var g=p.shiftCurrentCameraPos
var E=e("./voxel_data")
var y=Math.abs,T=Math.sign,I=Math.PI
var S=1e3
r.MAX_TIMESLICE=S
var A=16
r.MAX_STEP_DT=A
var w=I/180
var L=1/(r.TORAD=w)
r.TODEG=L
function fdeg(e){return(e*L).toFixed(0)}function fpos(e,t){return e.toFixed(t)}var R=[v,v,h]
var x=.01
var O=function(){function BaseController(e){this.pos=_(0,0,100)
this.ypr=_(90*w,0,0)
this.facing=_()
this.cardinal_facing=c()
this.char_right=_()
this.char_up=_()
this.eye_height=void 0
this.col_bounds=void 0
this.controller_height=void 0
this.camera_pos=void 0
this.user_active=false
this.vel=_(0,0,0)
this.auto_run=false
this.blocked_accum=0
this.blocked_frames=0
this.blocked_target=null
this.col_bounds=e.col_bounds
this.eye_height=e.eye_height
this.controller_height=this.eye_height+this.col_bounds.max[2]}var e=BaseController.prototype
e.setPos=function setPos(e){s(this.pos,e)
this.makePositionSafe()}
e.getCardinalFacing=function getCardinalFacing(){var e=y(this.facing[0])>y(this.facing[1])?0:1
n(this.cardinal_facing,u)
this.cardinal_facing[e]=T(this.facing[e])
return this.cardinal_facing}
e.getPosString=function getPosString(){var e=E.origin_chunk
var t=this.pos
var r=f
return fpos(t[0]+e[0]*r,1)+","+fpos(t[1]+e[1]*r,1)+","+fpos(t[2]+e[2]*r,1)+","+fdeg(this.ypr[0])+","+fdeg(this.ypr[1])+","+(this.flying?"f":"")}
e.makePositionSafe=function makePositionSafe(){for(var e=0;e<3;++e){var t=R[e]
var r=this.pos[e]+E.origin_chunk[e]*f
if(r<-t)this.pos[e]=-t-E.origin_chunk[e]*f
else if(r>t)this.pos[e]=t-E.origin_chunk[e]*f
if(!i(isFinite(this.pos[e])))this.pos[e]=0}}
e.shift=function shift(e){l(this.pos,e)
if(this.blocked_target&&3===this.blocked_target.length)l(this.blocked_target,e)
if(m()===this)g(e)}
e.updateSize=function updateSize(e){this.col_bounds=e.col_bounds
this.eye_height=e.eye_height
this.controller_height=this.eye_height+this.col_bounds.max[2]}
e.getClearanceHeight=function getClearanceHeight(){return this.controller_height}
e.updateYawPitch=function updateYawPitch(e){n(this.ypr,e)
if(this.ypr[0]<0)this.ypr[0]+=2*I
else if(this.ypr[0]>2*I)this.ypr[0]-=2*I
this.ypr[1]=a(this.ypr[1],-I/2+x,I/2-x)}
e.getCameraPos=function getCameraPos(){return this.camera_pos}
e.getCameraTargetDir=function getCameraTargetDir(){return this.facing}
return BaseController}()
r.BaseController=O
function isJumpingController(e){return void 0!==e.jump_time}function isFlyingController(e){return Boolean(e.isAerial)}function isDoubleJumpToFlyController(e){return e.can_doublejump_to_fly}},{"../common/globals":197,"../glov/common/util":330,"../glov/common/verify":331,"../glov/common/vmath":332,"./camera":28,"./voxel_data":175}],19:[function(e,t,a){"use strict"
a.seedWorld=seedWorld
a.providerSpring=providerSpring
a.providerMegaTree=providerMegaTree
a.providerFloatyRocks=providerFloatyRocks
a.SPRING_3x3=a.MARKER=a.ROCK=a.STUMP=a.BOULDER=a.MEGA_TREE=a.SNOW_PINE_FOREST=a.FOREST_MEDIUM=void 0
var w=e("assert")
var i=e("./detail_generators.js")
var o=e("../common/globals.js").CHUNK_SIZE
var L=Math.abs,s=Math.cos,ee=Math.floor,R=Math.max,A=Math.min,x=Math.PI,h=Math.round,l=Math.sin,O=Math.sqrt
var te=e("./proc_gen.js")
var r=e("./proc_gen_biomes.js"),d=r.NOISE_DETAIL_IDX,f=r.world_noise,n=r.getVerticalSliceById
var c=e("./detail_gen_base.js").DETAIL_Z0
var _=e("../glov/common/rand_alea.js").mashString
var re=e("./rand_seed.js").createFast
var u=e("open-simplex-noise").makeNoise3D
var b=e("./proc_gen_constants.js").SNOW_ELEVATION
var v=e("./tiles.js"),p=v.TILE_COLORED_HUE0,N=v.TILE_SNOW,ae=v.TILE_WOOD,T=v.TILE_WOOD_LIGHT,C=v.TILE_WOOD_DARK,E=v.TILE_WOOD_RED,M=v.TILE_LEAVES1,D=v.TILE_LEAVES2,P=v.TILE_LEAVES3,k=v.TILE_LEAVES4,B=v.TILE_LEAVES5,ie=v.TILE_GRASS,U=v.TILE_STONE,m=v.TILE_STONE_DARK,g=v.TILE_STONE_LIGHT,y=v.TILE_STONE_RED,I=v.TILE_ORE_IN_STONE_LIGHT,S=v.TILE_ORE_IN_STONE_DARK,G=v.TILE_ORE_IN_STONE_RED,F=v.TILE_ORE_IN_STONE,W=v.TILE_AIR,j=v.TILE_WATER
var H=e("../glov/common/util.js").sign
var z=e("../glov/common/vmath.js"),V=z.vec2,Y=z.v2add,q=z.v2distSq,oe=z.vec3,ne=z.v3distSq,se=z.v3set,K=z.v3sub,Z=z.unit_vec,X=z.v3copy,Q=z.v3iAdd,le=z.v2set
var ce=e("../common/voxel_data_common.js").createUtilVD
var J=1
var $=2
var _e=3
var ue=new Array(1)
function seedWorld(e){var t="bd"+e.seed
for(var r=0;r<ue.length;++r)ue[r]=u(_(""+t+r))}var de=12
var fe=4
var ve=100
var he=15
var pe=36
var me=de+2*he
var ge=4*me
var Ee=me/2
var ye=70
var Te=120
var Ie=12
var Se=15
var Ae=Ie+2*Se
var we=70
var Le=100
var Re=45
var xe=40
var Oe=14
var be=4
var Ne=[[0,1,ae],[0,2,ae],[1,0,ae],[1,1,ae],[1,2,ae],[1,3,ae],[2,0,ae],[2,1,ae],[2,2,ae],[2,3,ae],[3,1,ae],[3,2,ae]]
var Ce=[[1,1,ae],[1,2,ae],[2,1,ae],[2,2,ae]]
var Me=[[0,1,-1],[0,2,-1],[1,0,-2],[1,3,2],[2,0,-2],[2,3,2],[3,1,1],[3,2,1]]
var De=[[-1,1,-1],[-1,2,-1],[1,-1,-2],[2,-1,-2],[1,4,2],[2,4,2],[4,1,1],[4,2,1]]
var Pe={}
Pe[ae]=ae
var ke={}
ke[ae]=T
var Be={}
Be[ae]=C
var Ue={}
Ue[ae]=E
var Ge=[m,U,y,g]
function rotate(e,t,r,a,i){var o=ee(t*s(e)+r[0])
var n=ee(t*l(e)+r[1])
return se(i,o,n,r[2]+1+a.range(3))}function randomWalk(e,t,r,a,i,o,n){var s=oe()
K(s,e,t)
var l=oe()
l[0]=L(s[0]+a.range(2))
l[1]=L(s[1]+a.range(2))
l[2]=L(s[2])
var c=l[0]+l[1]+l[2]
r.set(e,o)
var _=c
for(var u=0;u<_;u++){var d=a.range(c)
if(d<l[0]){l[0]--
e[0]+=-1*H(s[0])}else if(d<l[0]+l[1]){l[1]--
e[1]+=-1*H(s[1])}else if(d<c){l[2]--
e[2]+=-1*H(s[2])}r.set(e,o)
for(var f=1;f<15;f++){se(n,e[0],e[1],e[2]-f)
if(r.get(n)!==i)break
r.set(n,null)}c--}}function placeFoot(i,o,e,n,s,l,c,_,u,d){function extendFootRecursive(e,t,r){if(t<r)if(1===l.range(2)){t++
c[L(o[e][2])-1]+=H(o[e][2])
d[0]=s.pos_world[0]+c[0]
d[1]=s.pos_world[1]+c[1]
var a=te.getVerticalSliceMapData(d).h-(u-1)
if(c[2]>a&&c[2]>=0){n.set(c,i)
c[2]=a}if(c[2]>=0)n.set(c,i)
extendFootRecursive(e,t,r)
return}if(t>0){c[0]=_+o[e][0]
c[1]=_+o[e][1]
c[2]++
r=t-1
if(c[2]>=0)n.set(c,i)
extendFootRecursive(e,0,r)}}for(var t=0;t<o.length;++t){c[0]=_+o[t][0]
c[1]=_+o[t][1]
Y(d,s.pos_world,c)
var r=te.getVerticalSliceMapData(d)
c[2]=r.h-u+1
if(c[2]>=0&&c[2]<n.size[2]&&l.range(5)>1){n.set(c,i)
extendFootRecursive(t,0,e)}}}function placeTrunk(e,t,r,a,i,o,n,s){var l=oe()
for(var c=a;c<i;++c){l[2]=c
for(var _=0;_<t.length;++_){if(!s&&!o.range(16))continue
l[0]=e+t[_][0]
l[1]=e+t[_][1]
n.set(l,r)}}}var Fe=function(){var S=oe()
var A=oe(me/2,me/2,0)
var w=V()
var L=[k,B,P]
return function genOakFn(e,t,r){var i=ce(oe(me,me,ye))
var o=re(e.seed)
var a=r?7:o.range(8)
var n=ee(a/3)
var s=6+a
var l=L[o.range(3)]
se(e.pos_world,e.origin[0]-he,e.origin[1]-he,t)
var c=(me-4)/2
var _=ee(1.8*s)
if(r)_=11+(s=50)
placeTrunk(c,Ne,C,0,s,o,i)
placeTrunk(c,Ce,C,s,_,o,i)
var u=6+o.range(8)
var d=new Array(u)
A[2]=s
var f=2*x/u
for(var v=0;v<u;v++){d[v]=oe()
d[v]=rotate(v*f,8+a,A,o,d[v])}A[2]=_
var h=4+o.range(4)
var p=new Array(u)
f=2*x/h
for(var m=0;m<h;m++){p[m]=oe()
p[m]=rotate(m*f,5+n,A,o,p[m])}function branching(e,t,r){for(var a=0;a<e;a++){if(r)A[2]=R(s,A[2]-o.range(_-s-2))
randomWalk(t[a],A,i,o,l,C,S)}}A[2]=s-4
var g=500
var E=3.5
f=2*x/g
a-=4
for(var y=s-4;y<_+5;y++){A[2]++
if(A[2]<s)a+=2
else a--
if(y>_)E=R(0,--E)
for(var T=0;T<g;T++){S=rotate(T*f,8+a,A,o,S)
var I=E*ue[0](e.origin[0]+.25*S[0],e.origin[1]+.25*S[1],t+.25*S[2])
if((S=rotate(T*f,8+a+I,A,o,S))[2]<_+8)i.set(S,l)}}A[2]=s
branching(u,d,false)
A[2]=_
branching(h,p,true)
placeFoot(C,De,2,i,e,o,S,c,t,w)
return i}}()
var We=function(){var m=V()
var g=oe()
var E=oe(me/2,me/2,0)
var y=[D,P,M]
return function genWillowFn(c,_){var u=ce(oe(me,me,ye))
var d=re(c.seed)
var e=d.range(12)
var f=12+e
var v=ee(e/3)
se(c.pos_world,c.origin[0]-he,c.origin[1]-he,_)
var t=(me-4)/2
placeTrunk(t,Ce,T,0,f/2,d,u)
var h=y[d.range(3)]
function placeDropDown(e,t,r){var a=3+d.range(7+v)
for(var i=0;i<a;i++){se(g,e,t,r-i)
u.set(g,h)}}function placeCrown(e,t,r){var a=(.12+.06*d.range(8+v))*Ee
for(var i=0;i<me;++i)for(var o=0;o<me;++o)for(var n=f-8;n<f+25;++n){var s=O(ne([i,o,n],[E[0]+e,E[1]+t,E[2]+r]))/a
se(g,i,o,n-ee(a/2))
var l=.1*ue[0](c.origin[0]+.25*g[0],c.origin[1]+.25*g[1],_+.25*g[2])
if(s<1+l&&s>.75-L(l)&&E[2]+r+ee(a/2)<n){u.set(g,h)
if(E[2]+r+ee(a/2)===n-1&&1===d.range(5))placeDropDown(i,o,n-ee(a/2))}}}var r=3+d.range(v)
var a=new Array(r)
var i=oe()
E[2]=f
for(var o=0;o<r;o++){i[0]=-7+d.range(14+v)
i[1]=-7+d.range(14+v)
i[2]=-4+d.range(6+v)
a[o]=oe(i[0]+E[0],i[1]+E[1],i[2]+E[2])
placeCrown(i[0],i[1],i[2])}E[2]=f/2
for(var n=0;n<r;n++){a[n][2]--
for(var s=0;s<5;s++)if(u.get(a[n])!==h){a[n][2]++
continue}else{a[n][2]--
break}randomWalk(a[n],E,u,d,h,T,g)}for(var l=0;l<Me.length;++l){g[0]=t+Me[l][0]
g[1]=t+Me[l][1]
Y(m,c.pos_world,g)
var p=te.getVerticalSliceMapData(m)
g[2]=p.h-_
if(g[2]>=0&&g[2]<u.size[2])u.set(g,ie)}placeFoot(T,Me,0,u,c,d,g,t,_,m)
return u}}()
var je=function(){var h=oe()
var p=oe(me/2,me/2,0)
var m=V()
var g=[k,B,P]
return function genPineFn(r,a,e){var c=ce(oe(me,me,ye))
var _=re(r.seed)
var t=_.range(12)
var i=9+t
se(r.pos_world,r.origin[0]-he,r.origin[1]-he,a)
var u=e?N:g[_.range(3)]
function checkHeight(e){Y(m,r.pos_world,e)
var t=te.getVerticalSliceMapData(m)
if(e[2]<=t.h-a)return false
return true}function branch(e,t,r){var a=oe()
se(h,p[0],p[1],r)
if(e<=1){h[L(t)-1]+=H(t)
c.set(h,u)
return}var i=0
for(var o=0;o<e;o++){if(o%3===1&&_.range(10)>1){if(o>e-2){h[L(t)-1]+=H(t)
c.set(h,u)
h[L(t)-1]-=H(t)}h[2]--
h[L(t)-1]+=2*H(t)
c.set(h,u)
h[L(t)-1]-=2*H(t)
se(a,h[0],h[1],h[2])
a[1-(L(t)-1)]--
for(var n=0;n<3;n++){c.set(a,u)
a[1-(L(t)-1)]++}c.set(h,u)}se(a,h[0],h[1],h[2])
if(o<ee(e/2))i=2*o
else i=2+e-o
i=R(1,i-_.range(3))
if(o>e-1)i=1
a[L(t)-1]+=H(t)
if(1!==i)a[1-(L(t)-1)]-=ee(i/2)
for(var s=0;s<i;s++){if(!checkHeight(a))return
c.set(a,u)
a[1-(L(t)-1)]++}h[L(t)-1]+=H(t)
if(e-2>=o){c.set(h,u)
se(a,h[0],h[1],h[2]+1)
c.set(a,u)
i-=2
i-=_.range(3)
a[1-(L(t)-1)]-=ee(i/2)
for(var l=0;l<i;l++){c.set(a,u)
a[1-(L(t)-1)]++}}}}var o=(me-4)/2
placeTrunk(o,Ce,E,0,i,_,c)
p[2]=ee(2*i)
se(h,p[0],p[1],p[2])
var n=_.range(8)
for(var s=i;s<2*i;s++){se(h,p[0],p[1],s)
if(s>2*i-n){c.set(h,u)
continue}c.set(h,E)}for(var l=3+_.range(t/2);l<ee(1.8*i);l+=2){branch(R(1,i/2-l/2.5+4+(-2+_.range(5))),1,2+l)
l+=_.range(4)}for(var d=3+_.range(t/2);d<ee(1.8*i);d+=2){branch(R(1,i/2-d/2.5+4+(-2+_.range(5))),-1,2+d)
d+=_.range(4)}for(var f=3+_.range(t/2);f<ee(1.8*i);f+=2){branch(R(1,i/2-f/2.5+4+(-2+_.range(5))),-2,2+f)
f+=_.range(4)}for(var v=3+_.range(t/2);v<ee(1.8*i);v+=2){branch(R(1,i/2-v/2.5+4+(-2+_.range(5))),2,2+v)
v+=_.range(4)}se(h,p[0],p[1],p[2])
placeFoot(E,Me,1,c,r,_,h,o,a,m)
return c}}()
var He=function(){var f=oe()
var v=V()
var h=oe(me/2,me/2,0)
var p=[B,k,M]
return function genPoplarFn(e,t){var r=ce(oe(me,me,ye))
var a=re(e.seed)
var i=30+a.range(12)
se(e.pos_world,e.origin[0]-he,e.origin[1]-he,t)
var o=p[a.range(3)]
var n=.4*(2+a.range(3))*Ee
h[2]=i
for(var s=0;s<me;++s)for(var l=0;l<me;++l)for(var c=i-25;c<i+15;++c){var _=R(i-25+3,A(c,i+5-5))
var u=O(ne([s,l,c],[h[0],h[1],_])/n)
if(u<1)if(a.range(7)*u<2){se(f,s,l,c)
r.set(f,o)}}var d=(me-4)/2
placeTrunk(d,Ce,ae,0,i,a,r)
placeFoot(ae,Me,1,r,e,a,f,d,t,v)
return r}}()
function sampleNoise(e,t,r,a){return f[e].noise2D(r*t,a*t)}function spikyRockNoise(e,t){var r
var a
r=sampleNoise(1,.05,e,t)
a=sampleNoise(2,.05,e,t)
return sampleNoise(2,.05,e+=r,t+=a)}var ze=oe()
function dropLiana(e,t,r,a,i){X(ze,e)
var o=2+a.range(t)
for(var n=0;n<o;++n){ze[2]--
if(ze[2]<0||i.get(ze))return
i.set(ze,r)}}var Ve=function(){var T=oe()
var I=oe()
var S=oe(Ae/2,Ae/2,0)
var A=[B,k,M,D,P]
return function genFloatyRockFn(e){var u=ce(oe(Ae,Ae,we))
var d=re(e.seed)
var t=e.provider_data.height
var r=d.uint32()
var f=A[d.range(5)]
var a=te.getVerticalSliceMapData(e.origin).h
se(e.pos_world,e.origin[0],e.origin[1],a)
var i=Ge[ee(r/3)%Ge.length]
var o=ie
if(a>=b)f=o=N
function smallTree(e){var t=3+d.range(3)
var r=5
var a=3+d.range(3)
if(e[0]-t<0||e[1]-t<0||e[2]-1<0||e[0]+t>Ae||e[1]+t>Ae||e[2]+r+a>we)return
X(I,e)
I[2]++
var i=3
var o=d.range(2)
for(var n=-ee(t/2);n<ee(t/2)+1;++n){I[o]=e[o]+n
if(u.get(I)){u.set(I,ae)
I[2]++}else{u.set(I,ae)
I[2]--
if(u.get(I))I[2]++}if(1===d.range(i)){i++
u.set(I,ae)
I[L(o-1)]+=1===d.range(2)?-1:1}u.set(I,ae)}X(I,e)
for(var s=0;s<a;++s){I[2]++
if(1===d.range(3)){u.set(I,ae)
I[d.range(2)]+=1===d.range(2)?-1:1}u.set(I,ae)}if(I[0]-t<0||I[1]-t<0||I[2]-1<0||I[0]+t>Ae||I[1]+t>Ae)return
for(var l=-t;l<t+1;++l)for(var c=-t;c<t+1;++c)for(var _=0;_<r;++_)if(.5*(l*l+c*c)<t-_+d.range(2)){se(I,e[0]+l,e[1]+c,e[2]+_+a)
u.set(I,f)
if(0===_&&1===d.range(10))dropLiana(I,2,f,d,u)}}var n=e.provider_data.radius
S[2]=t
for(var s=0;s<Ae;++s)for(var l=0;l<Ae;++l)for(var c=0;c<we;++c){se(I,s,l,c)
var _=O(q(I,S)/n)
var v=we-c
if(L(spikyRockNoise(s+e.origin[0],l+e.origin[1]))*(3+_*_*-1)/2>v/35&&_<2+d.range(2)&&5*L(sampleNoise(2,.02,s+e.origin[0],l+e.origin[1]))<v){se(T,s,l,c-t)
if(c-t>0)u.set(T,i)}}for(var h=0;h<me;h++)for(var p=0;p<me;p++)for(var m=we;m>0;m--){se(T,h,p,m)
if(u.get(T)===i){se(T,h,p,m)
u.set(T,o)
if(1===d.range(80))smallTree(T)
break}}for(var g=0;g<Ae;g++)for(var E=0;E<Ae;E++)for(var y=0;y<we;y++){se(T,g,E,y)
if(u.get(T)===i){if(1===d.range(20))dropLiana(T,15,f,d,u)
break}}return u}}()
var Ye=function(){var p=oe()
var m=oe()
var g=oe()
var E=oe()
var y=oe()
var T=oe()
var I=[B,k,M,D,P]
var S=[]
return function genLianafn(e){var t=re(e.seed)
var r=I[t.range(5)]
X(m,e.provider_data.start_pos)
X(g,e.provider_data.end_pos)
var a=te.getVerticalSliceMapData(m).h
var i=te.getVerticalSliceMapData(g).h
m[2]=we+a-m[2]
g[2]=we+i-g[2]
if(a>=b||i>=b)r=N
if(L(m[0])-L(g[0])>40||L(m[1])-L(g[1])>40||L(m[2])-L(g[2])>40){se(E,0,0,0)
return ce(E)}se(e.pos_world,Ae/2+A(m[0],g[0]),Ae/2+A(m[1],g[1]),A(m[2]-6,g[2])-6)
K(E,m,g)
se(T,H(E[0]),H(E[1]),H(E[2]))
E[0]=L(E[0])
E[1]=L(E[1])
E[2]=L(E[2])
var o=3
se(y,E[0]+1,E[1]+1,E[2]+1+o)
var n=ce(y)
var s=T[2]>0?0:E[2]
var l
var c=E[0]+E[1]+E[2]
if(0===c)return n
var _=c/E[0]
var u=c/E[1]
var d=c/E[2]
S=[]
for(var f=0;f<c;++f){l=s/E[2]*2
var v=false
if(f%_<1){S.push(0)
v=true}if(f%u<1){S.push(1)
v=true}if(f%d*(2-l)<1){S.push(2)
s+=T[2]
v=true}if(!v)c++}se(p,T[0]>0?0:E[0],T[1]>0?0:E[1],T[2]>0?o:E[2]+o)
n.set(p,r)
for(var h=0;h<S.length;++h){p[S[h]]+=T[S[h]]
if(p[0]<0||p[0]>E[0]||p[1]<0||p[1]>E[1]||p[2]<0||p[2]>E[2]+o){p[S[h]]-=T[S[h]]
continue}if(1===t.range(25))dropLiana(p,5,r,t,n)
n.set(p,r)}return n}}()
var qe=30
var Ke=function(){var h=oe()
var p=V()
return function genStumpFn(e,t,r){var a=ce(oe(Oe,Oe,qe))
var i=re(e.seed)
var o=3+i.range(3)
var n
var s
var l
var c
var _=[]
if(i.range(100)<1)o+=i.range(15)
if(r===Pe){n=Ce
s=Me
l=ae
c=1}else if(r===Ue){n=Ce
s=Me
l=E
c=1}else if(r===ke){n=Ce
s=Me
l=T
c=1}else{n=Ne
s=De
l=C
c=2}se(e.pos_world,e.origin[0],e.origin[1],t)
var u=(Oe-4)/2
for(var d=0;d<n.length;++d)_[d]=o+i.range(3)
for(var f=0;f<o+3;++f){h[2]=f
for(var v=0;v<n.length;++v){h[0]=u+n[v][0]
h[1]=u+n[v][1]
if(_[v]<f)continue
a.set(h,l)}}placeFoot(l,s,c,a,e,i,h,u,t,p)
return a}}()
var Ze=function(){var u=oe()
var h=oe()
var d=[M,D,P,k,B]
return function genMegaMapleFn(l,c){var f=re(l.seed)
var v=ce(oe(ge,ge,Te))
var _=d[f.range(5)]
se(l.pos_world,l.origin[0]-pe,l.origin[1]-pe,c-10)
se(u,ge/2,ge/2,10)
function randomBranch(e,t){var r=oe()
K(r,e,t)
var a=oe()
a[0]=L(r[0]+f.range(2))
a[1]=L(r[1]+f.range(2))
a[2]=L(r[2])
var i=a[0]+a[1]+a[2]
var o=i
for(var n=0;n<o;n++){var s=f.range(i)
if(s<a[0]){a[0]--
e[0]+=-1*H(r[0])}else if(s<a[0]+a[1]){a[1]--
e[1]+=-1*H(r[1])}else if(s<i){a[2]--
e[2]+=-1*H(r[2])}i--
var l=5
for(var c=e[0]-l;c<e[0]+l;c++)for(var _=e[1]-l;_<e[1]+l;_++)for(var u=e[2]-l;u<e[2]+l;u++){se(h,c,_,u)
var d=O(ne([c,_,u],e))
if(h[2]>=0&&d<3-A(2,i/20))v.set(h,ae)}}}function placeCrown(e){var t=15+f.range(15)
e[2]-=t-3
for(var r=e[0]-t;r<e[0]+t;++r)for(var a=e[1]-t;a<e[1]+t;++a)for(var i=e[2]-t;i<e[2]+t;++i){var o=O(ne([r,a,i],[e[0],e[1],e[2]]))
se(h,r,a,i)
var n=2*ue[0](l.origin[0]+.2*h[0],l.origin[1]+.2*h[1],c+.2*h[2])
var s=4*ue[0](l.origin[0]+.04*h[0],l.origin[1]+.04*h[1],c+.04*h[2])
if(o<t-n&&o>t-(n+3)&&o>.75-L(n)&&e[2]+t/1.5+s<i)if(h[2]>=0&&h[2]<Te&&h[0]>=0&&h[0]<ge&&h[1]>=0&&h[1]<ge)v.set(h,_)}e[2]+=t}function branch(e,t,r,a){var i=r+f.range(5)
var o=new Array(i)
var n=f.range(60)
var s=2*x/(i+n)
for(var l=0;l<i;l++){o[l]=oe()
o[l]=rotate(f.range(n)*s,e,h,f,o[l])
Q(o[l],[0,0,t-10])
if(a)placeCrown(o[l])
X(h,u)
randomBranch(o[l],h,a)}}var e=0
var t=0
for(var r=0;r<70;r++){switch(r){case 10:X(h,u)
branch(30,-(15+f.range(5)),10,false)
break
case 30:X(h,u)
branch(35,f.range(20),1,true)
break
case 35:X(h,u)
branch(25,f.range(20),1,true)
break
case 40:X(h,u)
branch(20,f.range(20),1,true)
break
case 55:X(h,u)
branch(15,f.range(20),1,true)
break
case 65:X(h,u)
branch(10,f.range(20),1,true)}var a=ue[0](l.origin[0]+.1*u[0],l.origin[1]+.1*u[1],c+.1*u[2])
if(a>.15)u[0]++
else if(a<-.15)u[0]--
var i=ue[0](l.origin[0]+.1*(u[0]+10),l.origin[1]+.1*(u[1]+10),c+.1*(u[2]+10))
if(i>.15)u[1]++
else if(i<-.15)u[1]--
if(ue[0](l.origin[0]+.1*(u[0]+20),l.origin[1]+.1*(u[1]+20),c+.1*(u[2]+20))>-.8)u[2]++
if(10===++e){if(t>=u[2])u[2]++
t=u[2]
e=0}for(var o=u[0]-7;o<u[0]+7;o++)for(var n=u[1]-7;n<u[1]+7;n++)for(var s=u[2];s<u[2]+7;s++){se(h,o,n,s)
if(O(ne([o,n,s],u))<7-A(7,r/14))v.set(h,ae)}}placeCrown(u)
return v}}()
var Xe=[]
Xe[g]=I
Xe[U]=F
Xe[m]=S
Xe[y]=G
var Qe=function(){var X=oe()
var Q=oe()
var J=V()
var $=[P,k,B]
return function genBoulderfn(c,_){var u=re(c.seed)
var e=u.uint32()
var d=$[e%3]
var f=Ge[ee(e/3)%Ge.length]
var o=1
var n=new Array(u.range(10)+25)
for(var t=0;t<n.length;t++){n[t]=oe()
se(n[t],u.range(xe),u.range(xe),u.range(Re))}se(n[0],xe/2,xe/2,10)
var s=[]
s.push(0)
var r=[]
var l=[]
for(var a=0;a<xe;a++)for(var i=0;i<xe;i++)for(var v=Re;v>0;v--){var h=Infinity
var p=Infinity
se(X,a,i,v)
for(var m=0;m<n.length;m++){var g=ne(n[m],X)
if(h>g){p=m
h=g}}if(0===a||0===i||0===v||a===xe-1||i===xe-1||i===Re-1){if(void 0===l[p])l[p]=1
l[p]++}r.push(p)}function addRandomCell(){var e=u.range(o)
var t=Infinity
var r=Infinity
for(var a=0;a<n.length;a++){if(-1!==s.indexOf(a))continue
if(l[a]>225)continue
var i=ne(n[a],n[s[e]])
if(t>i){r=a
t=i}}o++
s.push(r)}var E=u.range(5)
for(var y=0;y<E;y++)addRandomCell()
var T=-Infinity
var I=-Infinity
var S=-Infinity
var A=Infinity
var w=Infinity
var L=Infinity
var R=0
for(var x=0;x<xe;x++)for(var O=0;O<xe;O++)for(var b=Re;b>0;b--){if(-1!==s.indexOf(r[R])){if(x<A)A=x
if(x>T)T=x
if(O<w)w=O
if(O>I)I=O
if(b<L)L=b
if(b>S)S=b}R++}var N=T-A
var C=I-w
var M=S-L
var D=ce(oe(N+1,C+1,M+20))
function destroyUpwards(e){for(var t=0;t<e;t++){if(X[2]===Re-1)return
D.set(X,0)
X[2]++}}se(c.pos_world,c.origin[0]+A,c.origin[1]+w,_+L-5)
for(var P=R=0;P<xe;P++)for(var k=0;k<xe;k++)for(var B=Re;B>0;B--){if(-1!==s.indexOf(r[R])){se(X,P-A,k-w,B-L)
var U=false
le(J,c.pos_world[0]+X[0],c.pos_world[1]+X[1])
var G=te.getVerticalSliceMapData(J)
if(c.pos_world[2]+X[2]-1<G.water_level)U=true
if((0===P||0===k||P===xe-1||k===xe-1)&&u.range(20)<1)destroyUpwards(20)
else if(!U){D.set(X,f)
var F=ne(X,n[0])
if(u.range(F)<1)D.set(X,Xe[f])}else{D.set(X,0)
X[2]++
D.set(X,0)
X[2]++
D.set(X,0)
X[2]++
if(u.range(3)>0)destroyUpwards(u.range(4))}}R++}function smallPine(e){var t=u.range(10)
var r=5+t
var a=3+u.range(3)
var i=1+u.range(t/2)
if(e[0]<=i||e[0]>=N-i||e[1]<=i||e[1]>=C-i)return
e[2]++
D.set(e,ae)
for(var o=0;o<r;o++){e[2]++
for(var n=e[0]-10;n<e[0]+10;n++)for(var s=e[1]-10;s<e[1]+10;s++){se(Q,n,s,e[2])
var l=2*ue[0](c.origin[0]+4*Q[0],c.origin[1]+4*Q[1],_+4*Q[2])
if(ne(e,Q)+l<i*(1-o/r)*(a-o%a))if(D.get(Q)!==f)D.set(Q,d)}if(D.get(e)!==f)D.set(e,ae)}e[2]++
D.set(e,d)}var W=5+u.range(20)
var j=600
function checkNeighbours(){--X[0]
if(D.get(X))return false
X[0]+=2
if(D.get(X))return false;--X[0];--X[1]
if(D.get(X))return false
X[1]+=2
if(D.get(X))return false;--X[1]
D.set(X,0)
return true}function checkKernel(e){if(D.data[e+1]&&D.data[e-1]&&D.data[e-N]&&D.data[e+N]&&D.data[e-N*C]&&D.data[e-N*C])return
D.data[e]=0}var H=N*C*M
var z=.04*H+u.range(.04*H)
for(var V=0;V<z;V++)checkKernel(u.range(H))
for(var Y=0;Y<N+1;Y++)for(var q=0;q<C+1;q++)for(var K=M;K>0;K--){se(X,Y,q,K)
if(D.get(X)===f){le(J,c.pos_world[0]+X[0],c.pos_world[1]+X[1])
var Z=te.getVerticalSliceMapData(J)
if(checkNeighbours())continue
se(X,Y,q,K)
if(u.range(W)>1&&X[2]+c.pos_world[2]>Z.h){D.set(X,ie)
if(u.range(j)<1)smallPine(X)}break}}return D}}()
var Je=6
var $e=function(){var E=be
var y=be
var T=E*y
var I=[0,E-1,T-1,T-E]
var S=[1,E,-1,-E]
var A=[E,-1,-E,1]
return function genRockFn(e,t){var r=re(e.seed)
var a=3+r.range(4)
w(a<=Je)
var i=ce(oe(E,y,a))
var o=i.data
for(var n=0;n<T;++n)o[n]=U
for(var s=1;s<a;++s){var l=s*T
for(var c=0;c<T;++c)o[l+c]=o[l+c-T]
if(s===y/2)for(var _=0;_<4;++_)if(o[l+I[_]])o[l+I[_]]=0
var u=r.range(4)
var d=l+I[u]
var f=S[u]
var v=A[u]
var h=1&u?y:E
var p=1&u?E:y
if(o[d]&&o[d+f*(h-1)])o[d]=o[d+f*(h-1)]=0
else for(var m=0;m<h;++m)for(var g=0;g<p;++g)if(o[d+m*f+g*v]){o[d+m*f+g*v]=0
break}}se(e.pos_world,e.origin[0]+4,e.origin[1]+4,t)
return i}}()
var et=[V(4,4),V(4,8),V(8,8),V(8,4),V(6,6)]
var tt=[V(1,1),V(1,16),V(16,16),V(16,1),V(8,8),V(0,8),V(8,0)]
var rt=V()
function genForestMedium(e){var t=-Infinity
var r=Infinity
var a=false
for(var i=0;i<et.length;++i){Y(rt,e.origin,et[i])
var o=te.getVerticalSliceMapData(rt)
t=R(t,o.h)
r=A(r,o.h)
if(o.h<o.water_level)a=true}if(t-r>2||a)return $e(e,r)
else{var n=this.tree_types
var s=0
var l=-1
for(var c=0;c<n.length;++c){var _=f[d].noise2D(100*c+.001*e.pos_world[0],.001*e.pos_world[1])
if(_>l){l=_
s=c}}var u=n[s]
if(re(e.seed).range(100)>1)if(u===Ue)return je(e,r)
else if(u===Pe)return He(e,r)
else if(u===ke)return We(e,r)
else return Fe(e,r)
else return Ke(e,r,u)}}function genSnowPineForest(e){var t=-Infinity
var r=Infinity
var a=false
var i=0
var o=0
for(var n=0;n<et.length;++n){Y(rt,e.origin,et[n])
var s=te.getVerticalSliceMapData(rt)
i+=s.surface===N?1:0
o+=s.surface===ie?1:0
t=R(t,s.h)
r=A(r,s.h)
if(s.h<s.water_level)a=true}if(t-r>4||a)return $e(e,r)
else{if(i>4)return je(e,r,true)
if(o>1)return je(e,r,false)
return $e(e,r)}}var at=.8*xe
var it=.2*xe
var ot=[V(it,it),V(it,at),V(at,it),V(at,at)]
function genBoulders(e){var t=-Infinity
var r=Infinity
for(var a=0;a<ot.length;++a){Y(rt,e.origin,ot[a])
var i=te.getVerticalSliceMapData(rt)
t=R(t,i.h)
r=A(r,i.h)}if(t-r>50)return $e(e,r)
else return Qe(e,r)}function genStumps(e){var t=-Infinity
var r=Infinity
for(var a=0;a<et.length;++a){Y(rt,e.origin,et[a])
var i=te.getVerticalSliceMapData(rt)
t=R(t,i.h)
r=A(r,i.h)}return Ke(e,r)}function genMegaTree(e){var t=Infinity
for(var r=0;r<tt.length;++r){Y(rt,e.origin,tt[r])
rt[0]+=pe
rt[1]+=pe
var a=te.getVerticalSliceMapData(rt)
t=A(t,a.h)}return Ze(e,t)}function genRockOnly(e){var t=Infinity
for(var r=0;r<et.length;++r){Y(rt,e.origin,et[r])
var a=te.getVerticalSliceMapData(rt)
t=A(t,a.h)}return $e(e,t)}var nt
function genMarker(e){var t=te.getVerticalSliceMapData(e.origin).h+1
if(!nt){var r=(nt=ce(oe(3,1,5))).data
for(var a=0;a<5;++a)r[1+3*a]=p+a
r[3]=p
r[5]=p}se(e.pos_world,e.origin[0]-1,e.origin[1],t)
return nt}var st=[V(0,-1),V(-1,0),V(1,0),V(0,1)]
var lt=5
var ct=lt+2
function genSpring3x3(e){var t
var r=1
var a
do{var i=0
t=[]
for(var o=0;o<st.length;++o){rt[0]=e.origin[0]+1+st[o][0]*r
rt[1]=e.origin[1]+1+st[o][1]*r
var n=te.getVerticalSliceMapData(rt)
var s=n.h<n.water_level
t.push(s)
if(s)++i}if(!i){if(!a)return ce(oe(1,1,1))
t=a
break}else if(i<3)break;++r
a=t}while(true)
Y(rt,e.origin,Z)
var l=te.getVerticalSliceMapData(rt).water_level-lt+1
var c=ce(oe(3,3,ct))
c.alloc(true)
var _=c.data
var u=c.liquid
var d=re(e.seed)
for(var f=0;f<lt;++f){var v=3*f*3
_[v+0]=d.range(3)?U:0
_[v+1]=U
_[v+2]=d.range(3)?U:0
_[v+3]=U
_[v+4]=W
u[v+4]=j
_[v+5]=U
_[v+6]=d.range(3)?U:0
_[v+7]=U
_[v+8]=d.range(3)?U:0}var h=3*lt*3
_[h+0]=d.range(3)?U:0
_[h+1]=t[0]?W:U
u[h+1]=t[0]?j:0
_[h+2]=d.range(3)?U:0
_[h+3]=t[1]?W:U
u[h+3]=t[1]?j:0
_[h+4]=W
u[h+4]=j
_[h+5]=t[2]?W:U
u[h+5]=t[2]?j:0
_[h+6]=d.range(3)?U:0
_[h+7]=t[3]?W:U
u[h+7]=t[3]?j:0
_[h+8]=d.range(3)?U:0
_[(h+=9)+4]=U
se(e.pos_world,e.origin[0],e.origin[1],l)
return c}var _t={exclusion:oe(de,de,fe),bounds:[oe(-he,-he,c),oe(de+he,de+he,ye)],gen:genForestMedium,priority:J,tree_types:[Pe,ke,Be,Ue]}
a.FOREST_MEDIUM=_t
var ut={exclusion:oe(0,0,0),bounds:[oe(0,0,c),oe(Ie+2*Se,Ie+2*Se,we)],gen:Ve,priority:$}
var dt={exclusion:oe(0,0,0),bounds:[oe(0,0,c),oe(Le,Le,Le)],gen:Ye,priority:J}
var ft={exclusion:oe(de,de,fe),bounds:[oe(-he,-he,c),oe(de+he,de+he,ye)],gen:genSnowPineForest,priority:J}
a.SNOW_PINE_FOREST=ft
var vt={exclusion:oe(ve,ve,fe),bounds:[oe(-pe,-pe,c),oe(pe+ve,pe+ve,Te)],gen:genMegaTree,priority:_e,tree_types:[Pe,ke,Be,Ue],unblockable:true}
a.MEGA_TREE=vt
var ht={exclusion:oe(xe+1,xe+1,1),bounds:[oe(0,0,c),oe(xe+1,xe+1,Re)],gen:genBoulders,priority:J}
a.BOULDER=ht
var pt={exclusion:oe(Oe,Oe,1),bounds:[oe(0,0,c),oe(Oe,Oe,qe)],gen:genStumps,priority:J}
a.STUMP=pt
var mt={exclusion:oe(be+1,be+1,1),bounds:[oe(0,0,c),oe(be+1,be+1,Je)],gen:genRockOnly,priority:J}
a.ROCK=mt
var gt={exclusion:oe(1,1,1),bounds:[oe(-1,0,c),oe(2,1,5)],gen:genMarker,priority:_e}
a.MARKER=gt
var Et={exclusion:oe(3,3,1),bounds:[oe(0,0,c),oe(3,3,ct)],gen:genSpring3x3,priority:_e}
a.SPRING_3x3=Et
function providerSpring(e){w(null!==e.hydro_source_vsid)
var t=n(e.hydro_source_vsid)
te.initPhase40(t)
w(isFinite(t.hydro_jitter_x))
w(isFinite(t.hydro_jitter_y))
var r=t.pos_world[0]+o/2+t.hydro_jitter_x
var a=t.pos_world[1]+o/2+t.hydro_jitter_y
return[{pos:oe(r-1,a-1,0),type:Et}]}function providerMegaTree(e){var t=h(e.pos_world[0])
var r=h(e.pos_world[1])
return[{pos:oe(t-he,r-he,0),type:vt}]}function providerFloatyRocks(e){var t=[]
var r=[]
var a=re(e.seed)
var i=0
var o=h(e.pos_world[0])
var n=h(e.pos_world[1])
var s=2+a.range(4)
for(var l=0;l<s;l++){i=20+a.range(50)
var c=a.range(50)
var _=oe(o+(a.range(60)-30),n+(a.range(60)-30),c)
r.push(_)
t.push({pos:_,type:ut,provider_data:{radius:i,height:c}})}for(var u=0;u<3*s;u++){var d=a.range(s)
var f=r[d]
var v=r[d+1===r.length?d-1:d+1]
t.push({pos:f,type:dt,provider_data:{start_pos:f,end_pos:v}})}return t}(function(){for(var e in a){var t=a[e]
if(t.gen){w.equal(t.exclusion.length,3)
w.equal(t.bounds[0].length,3)
w.equal(t.bounds[1].length,3)
w.equal(typeof t.priority,"number")
t.name=e}}for(var r in i){w(!a[r])
a[r]=i[r]}})()},{"../common/globals.js":197,"../common/voxel_data_common.js":209,"../glov/common/rand_alea.js":327,"../glov/common/util.js":330,"../glov/common/vmath.js":332,"./detail_gen_base.js":63,"./detail_generators.js":65,"./proc_gen.js":132,"./proc_gen_biomes.js":133,"./proc_gen_constants.js":134,"./rand_seed.js":145,"./tiles.js":162,assert:void 0,"open-simplex-noise":void 0}],20:[function(e,t,r){"use strict"
r.setupFlat=setupFlat
r.BIOME_PARAM_TYPE=r.TYPE_NON_INTERP=r.TYPE_ARR=r.BIOME_BY_ID=r.BIOMES=r.TYPE_IDS=void 0
var i=e("assert")
var a=e("../common/globals").SAFE_DIST_Z
var o=e("../common/ids")
var n=o.ITEM_BERRY_BUSH_BLUE
var s=o.ITEM_BERRY_BUSH_RED
var l=o.ITEM_BERRY_BUSH_YELLOW
var c=o.ITEM_PLANT
var _=o.ITEM_SPICE_PLANT
var u=o.ITEM_WILD_CROP
var d=e("../common/materials_common").Mat
var f=e("../common/waygate_common")
var v=f.FLAT_SEED_EMPTY
var h=f.FLAT_SEED_GRASS_ON_STONE
var p=f.FLAT_SEED_WATER
var m=e("./flora_constants")
var g=m.ALL_PLANTS
var E=m.BLUE_FLOWERS
var y=m.RED_FLOWERS
var T=m.WILD_CARROT
var I=m.WILD_CORN
var S=m.WILD_PUMPKIN
var A=m.WILD_SUGAR_CANE
var w=m.WILD_TOMATO
var L=m.WILD_WHEAT
var R=m.YELLOW_FLOWERS
var x=e("./proc_gen_constants")
var O=x.PROP_1x1x1
var b=x.PROP_2x2x1
var N=x.PROP_2x2x2
var C=e("./tiles")
var M=C.TILE_DIRT
var D=C.TILE_GRASS
var P=C.TILE_SAND
var k=C.TILE_SNOW
var B=C.TILE_STONE
var U=C.TILE_STONE_DARK
var G=C.TILE_STONE_LIGHT
var F=C.TILE_STONE_RED
function avgTint(e){var t=[]
for(var r=0;r<3;++r){var a=e[r]
if(a.length)a=(a[0]+a[1])/2
t.push(a)}return t}var W=[[75,125,.005,0],.65,.8]
var j=[[70,110,.01,0],[.6,.9,.005,0],.9]
var H=[[100,130,.005,0],.7,[.9,.5,.005,0,0]]
var z=H
var V=z
var Y=[[60,155,.005,0],.55,.6]
var q=avgTint(W)
var K=[[120,145,.005,0],.65,.9]
var Z=[[120,145,.005,0],.65,.9]
var X=[[55,70,.005,0],.65,.9]
var Q=[[55,70,.005,0],.65,.9]
var J={FLAT:1,HILLS:2,HILLS_FOREST:3,TUNDRA:4,PLAINS:5,PLAINS_BLUE:6,PLAINS_RED:7,PLAINS_FOREST:8,DENSE_FOREST:9,DESERT:10,OCEAN:11,MOUNTAINS:12,CLIFFS:13,PLAINS_SPRING:14,HILLS_SPRING:15,MOUNTAINS_SPRING:16,FOREST_MEGA_TREE:17,SNOW_PINE_MOUNTAINS:18,FOREST_RUIN:19,RIVER_DELTA:20,SHALLOWS_SPIKY:21,PLAINS_FOREST_SPIKY:22,PLAINS_YELLOW:23,PLAINS_RED_V2:24,PLAINS_BLUE_V2:25,PLAINS_WITH_BERRIES:26,PLAINS_BLUE_V3:27,MOUNTAINS_FLOATY_ROCKS:28}
r.TYPE_IDS=J
var $={BASE:{name:"BASE",surface:D,surface_depth:[1],ground:M,ground_depth:[10,20],noise_periods:[],noise_weights:[],height_func:null,blend:[.5,.5],details:[],plants:[],min_erosion:0,spawn_weight:0,debug_color_hsv:[[0,360],1,1],tint_grass_hsv:W},FLAT:{name:"Flat",surface:B,surface_depth:[Infinity],ground:B,ground_depth:[0,0],details:[],plants:[],spawn_weight:1,debug_color_hsv:[0,0,[0,1]],tint_grass_hsv:q},HILLS:{name:"Hills",noise_periods:[.005,.025],noise_weights:[32,4],height_func:"genericHeight",details:[{type_name:"BOULDER",min:-10,max:1,freq:.005,chance:.02,offs:10}],plants:[{id:c,size:O,over:D,min:-2,max:6,freq:.005,chance:1,offs:100,attr3_list:g},{id:u,over:D,min:-2,max:2,freq:.007,chance:.3,offs:450,attr3_list:[I]}],spawn_weight:0,debug_color_hsv:[[100,140],.75,1],tint_grass_hsv:j},HILLS_FOREST:{name:"ForestedHills",inherit:"HILLS",debug_color_hsv:[[100,140],.75,.5],details:[{type_name:"BOULDER",min:-10,max:1,freq:.005,chance:.2,offs:10},{type_name:"FOREST_MEDIUM",min:0,max:4,freq:.005,chance:.66,offs:0}],plants:[{id:c,size:O,over:D,min:-2,max:1,freq:.005,chance:1,offs:100,attr3_list:g},{id:u,over:D,min:-2,max:1,freq:.005,chance:.2,offs:270,attr3_list:[S]},{id:_,over:D,min:-2,max:1,freq:.005,chance:.5,offs:200,attr3_list:[d.HOT]},{id:u,over:D,min:-2,max:2,freq:.005,chance:.2,offs:150,attr3_list:[A]}],spawn_weight:.5,tint_grass_hsv:H,tint_lod_hsv:z},TUNDRA:{name:"Tundra",surface:k,surface_depth:[3],noise_periods:[1/80],noise_weights:[4],height_func:"genericHeight",details:[],plants:[],debug_color_hsv:[[195,285],.125,2]},PLAINS:{name:"Plains",noise_periods:[.025],noise_weights:[2],height_func:"genericHeight",details:[{type_name:"BOULDER",min:-10,max:1,freq:.005,chance:.2,offs:10},{type_name:"FOREST_MEDIUM",min:-16,max:4,freq:.004,chance:.125,offs:0}],plants:[{id:c,size:O,over:D,min:-2,max:6,freq:.005,chance:1,offs:100,attr3_list:g},{id:u,over:D,min:-2,max:2,freq:.007,chance:.2,offs:150,attr3_list:[L]}],spawn_weight:1,debug_color_hsv:[[40,80],.75,1]},PLAINS_WITH_BERRIES:{inherit:"PLAINS",spawn_weight:.2,plants:[{id:c,size:O,over:D,min:-2,max:6,freq:.005,chance:1,offs:100,attr3_list:g},{id:u,over:D,min:-2,max:2,freq:.007,chance:.2,offs:150,attr3_list:[L]},{id:s,over:D,size:b,min:-30,max:10,freq:.003,chance:.03,offs:100},{id:l,over:D,size:N,min:-30,max:10,freq:.003,chance:.03,offs:100},{id:n,over:D,size:b,min:-30,max:10,freq:.003,chance:.03,offs:100}]},PLAINS_BLUE:{name:"Blue Flower Plains",inherit:"PLAINS",spawn_weight:.2,debug_color_hsv:[[150,190],.75,1],plants:[{id:c,over:D,min:-30,max:25,freq:.003,chance:1,offs:100,attr3_list:E.weighted}],tint_grass_hsv:K,tint_lod_hsv:Z},PLAINS_BLUE_V2:{inherit:"PLAINS_BLUE",plants:[{id:c,over:D,min:-30,max:25,freq:.003,chance:1,offs:100,attr3_list:E.weighted},{id:n,over:D,size:b,min:-30,max:25,freq:.003,chance:.2,offs:100}]},PLAINS_BLUE_V3:{inherit:"PLAINS_BLUE",plants:[{id:c,over:D,min:-30,max:27,freq:.003,chance:1,offs:100,attr3_list:E.weighted},{id:n,over:D,size:b,min:-30,max:10,freq:.003,chance:.2,offs:100}]},PLAINS_RED:{name:"Red Flower Plains",inherit:"PLAINS",spawn_weight:.2,tint_grass_hsv:X,tint_lod_hsv:Q,debug_color_hsv:[[0,40],.75,1],plants:[{id:c,over:D,min:-30,max:30,freq:.003,chance:1,offs:100,attr3_list:y.key}]},PLAINS_RED_V2:{inherit:"PLAINS_RED",plants:[{id:c,over:D,min:-30,max:30,freq:.003,chance:1,offs:100,attr3_list:y.key},{id:s,over:D,size:b,min:-30,max:10,freq:.003,chance:.2,offs:100}]},PLAINS_YELLOW:{name:"Yellow Flower Plains",inherit:"PLAINS",spawn_weight:.2,debug_color_hsv:[[45,60],.75,1],plants:[{id:c,over:D,min:-30,max:25,freq:.003,chance:1,offs:100,attr3_list:R.key},{id:l,over:D,size:N,min:-30,max:10,freq:.003,chance:.2,offs:100}],tint_grass_hsv:X,tint_lod_hsv:Q},PLAINS_FOREST:{name:"ForestedPlains",inherit:"PLAINS",spawn_weight:1,debug_color_hsv:[[40,80],.75,.5],details:[{type_name:"BOULDER",min:-10,max:1,freq:.005,chance:.2,offs:10},{type_name:"FOREST_MEDIUM",min:-1,max:4,freq:.005,chance:.66,offs:0}],plants:[{id:c,size:O,over:D,min:-2,max:1,freq:.005,chance:1,offs:100,attr3_list:g},{id:u,over:D,min:-2,max:1,freq:.005,chance:.2,offs:100,attr3_list:[S]},{id:_,over:D,min:-2,max:1,freq:.005,chance:.5,offs:100,attr3_list:[d.HOT]}],tint_grass_hsv:H,tint_lod_hsv:z},PLAINS_FOREST_SPIKY:{name:"ForestedPlainsSpiky",inherit:"PLAINS_FOREST",height_func:"spikyHeight",local_func:"shallowsSpikyReef",spawn_weight:.1,debug_color_hsv:[[270,300],.48,.91],ground_depth:[0,0],surface_depth:[1],plants:[{id:u,over:D,min:-2,max:2,freq:.005,chance:1,offs:100,attr3_list:[T]}]},DENSE_FOREST:{name:"DenseForest",inherit:"PLAINS",noise_periods:[.005,.025],noise_weights:[16,3],spawn_weight:.5,debug_color_hsv:[[0,40],.75,.5],details:[{type_name:"BOULDER",min:-10,max:1,freq:.005,chance:.2,offs:10},{type_name:"FOREST_MEDIUM",min:1,max:4,freq:.005,chance:.75,offs:0}],plants:[{id:c,over:D,min:-2,max:10,freq:.005,chance:1,offs:100,attr3_list:g},{id:_,over:D,min:-2,max:1,freq:.005,chance:.5,offs:200,attr3_list:[d.HOT]},{id:u,over:D,min:-2,max:2,freq:.005,chance:.2,offs:150,attr3_list:[A]}],tint_grass_hsv:H,tint_lod_hsv:V},FOREST_RUIN:{name:"ForestRuin",inherit:"DENSE_FOREST",spawn_weight:0,debug_color_hsv:[[0,10],1,.75],details:[{type_name:"FOREST_MEDIUM",min:2,max:6,freq:.005,chance:.75,offs:0}],detail_provider:"providerForestedRuin"},DESERT:{name:"Desert",surface:P,surface_depth:[9],noise_periods:[.005,.025],noise_weights:[10,6],height_func:"genericHeight",details:[],plants:[{id:_,over:P,min:-2,max:1,freq:.005,chance:1,offs:100,attr3_list:[d.SAVORY]}],debug_color_hsv:[[40,80],.25,1],spawn_weight:-1},OCEAN:{name:"Ocean",surface:P,surface_depth:[3],noise_periods:[.005,.025],noise_weights:[-6,-2],height_func:"genericHeight",details:[],plants:[],spawn_weight:-100,debug_color_hsv:[[195,285],.75,1]},MOUNTAINS:{name:"Mountains",surface:M,surface_depth:[0],ground_depth:[-100,0],height_func:"mountainsHeight",local_func:"grassyMountain",blend:[0,0],plants:[{id:_,over:D,min:-2,max:2,freq:.005,chance:1,offs:100,attr3_list:[d.PUNGENT]},{id:u,over:D,min:-2,max:2,freq:.003,chance:1,offs:230,attr3_list:[w]}],spawn_weight:-1,debug_color_hsv:[[0,360],.125,.75],min_erosion:7,tint_grass_hsv:Y},MOUNTAINS_FLOATY_ROCKS:{name:"Mountains Floaty Rocks",inherit:"MOUNTAINS",detail_provider:"providerFloatyRocks",debug_color_hsv:[270,1,.8]},RIVER_DELTA:{name:"RiverDelta",inherit:"OCEAN",height_func:"riverDeltaHeight",debug_color_hsv:[[195,285],.25,.5]},SHALLOWS_SPIKY:{name:"shallows_spiky",inherit:"OCEAN",ground_depth:[0,0],surface_depth:[0],debug_color_hsv:[[270,300],.48,[.2,.3]],height_func:"shallowsSpikyHeight",local_func:"shallowsSpikyReef"},CLIFFS:{name:"Cliffs",surface:U,surface_depth:[3],ground_depth:[-100,0],height_func:"cliffsHeight",blend:[0,0],details:[],plants:[],spawn_weight:-1,debug_color_hsv:[[0,360],.125,.25],min_erosion:7,tint_grass_hsv:Y},HILLS_SPRING:{name:"HillsSpring",inherit:"HILLS",detail_provider:"providerSpring"},PLAINS_SPRING:{name:"PlainsSpring",inherit:"PLAINS",detail_provider:"providerSpring"},MOUNTAINS_SPRING:{name:"MountainsSpring",inherit:"MOUNTAINS",detail_provider:"providerSpring"},FOREST_MEGA_TREE:{name:"MegaTree",inherit:"DENSE_FOREST",detail_provider:"providerMegaTree",spawn_weight:.2,plants:[{id:c,over:D,min:-2,max:6,freq:.03,chance:1,offs:100,attr3_list:g}],debug_color_hsv:[300,1,1]},SNOW_PINE_MOUNTAINS:{name:"SnowPineMountain",inherit:"MOUNTAINS",details:[{type_name:"SNOW_PINE_FOREST",min:1,max:4,freq:.005,chance:.75,offs:0}]}}
r.BIOMES=$
var ee=function(){var e=[]
for(var t in $)if("BASE"!==t){var r=J[t]
i(r)
e[$[t].id=r]=$[t]}return e}()
r.BIOME_BY_ID=ee
var te=1
r.TYPE_ARR=te
var re=2
r.TYPE_NON_INTERP=re
var ae=function(){var e={}
var t=$.BASE
for(var r in t){var a=t[r]
i(a||0===a||null===a)
e[r]=a&&a.length?te:re}return e}();(r.BIOME_PARAM_TYPE=ae).debug_color=te
function doInherit(e,t){if(t){var r=$[t]
i(r)
i(!r.inherit)
for(var a in r)if(void 0===e[a])e[a]=r[a]}}(function(){for(var e in $){var t=$[e]
var r=t.inherit
if("BASE"!==e&&void 0===r)r="BASE"
doInherit($[e],r)
i.equal($[e].ground_depth.length,2)
delete t.inherit}})()
var ie=[D,B,k,P,U,G,F]
function setupFlat(e){var t=$.FLAT
t.fixed_elev=-1
switch(e){case p:t.surface=P
t.surface_depth=[1]
t.ground=M
t.ground_depth=[15,15]
t.fixed_elev=-16
break
case h:t.surface=D
t.surface_depth=[1]
t.ground=M
t.ground_depth=[15,15]
break
case v:t.surface=U
t.surface_depth=[Infinity]
t.ground=U
t.ground_depth=[0,0]
t.fixed_elev=2*-a
break
default:var r=e
if(-1===ie.indexOf(e))r=B
t.surface=r
t.surface_depth=[Infinity]
t.ground=r
t.ground_depth=[0,0]}}},{"../common/globals":197,"../common/ids":198,"../common/materials_common":201,"../common/waygate_common":210,"./flora_constants":85,"./proc_gen_constants":134,"./tiles":162,assert:void 0}],21:[function(e,t,r){"use strict"
r.drawBlockIntersections=drawBlockIntersections
var a=e("./camera.js"),I=a.getActiveController,S=a.getCurrentCameraPos,A=a.getCurrentCameraTargetDir
var i=e("../glov/client/cmds.js").cmd_parse
var w=e("../glov/client/engine.js")
var o=e("./main.js").charControllerPos
var L=Math.tan,R=Math.min,x=Math.max,O=Math.floor
var n=e("./proc_gen_biomes.js").getElevationEstimate
var b=e("../glov/client/settings.js")
var s=e("./tiles.js"),l=s.TILE_COAL,c=s.TILE_NON_OPAQUE
var _=e("../glov/common/vmath.js"),N=_.v3add,C=_.v3addScale,M=_.v3sub,u=_.vec3,D=_.unit_vec
var d=e("./voxel_data.js"),P=d.drawSingleVoxel,k=d.getPropLighting,f=d.getTileLocal,v=d.worldPosFromLocalPos
b.register({draw_block_intersections:{default_value:1,type:i.TYPE_INT,range:[0,1],access_run:["sysadmin"]}})
var h=u()
function tileSolid(e){var t=f(e,-1,false)
if(-1===t){v(h,o())
if(n(h)-h[2]<0)t=0
else t=l}if(t>=c)t=0
return t}var B=[u(),u(),u(),u()]
var U=[[-1,-1],[-1,1],[1,1],[1,-1]]
var G=u()
var F=u()
var W=u()
var j=u()
var H=u()
var z={scale_lights:true,torch_factor:1,sun_factor:1}
var V=[null,u(0,0,1),u(0,0,-1),u(0,1,0),u(0,-1,0),u(1,0,0),u(-1,0,0)]
function drawBlockIntersections(){if(!b.draw_block_intersections)return
var e=w.fov_x,t=w.fov_y,r=w.ZNEAR
var a=I(),i=a.char_up,o=a.char_right
C(G,S(),A(),r)
var n=L(t/2)*r
var s=L(e/2)*r
for(var l=0;l<B.length;++l){var c=B[l]
C(c,C(c,G,i,U[l][0]*n),o,U[l][1]*s)
for(var _=0;_<3;++_){var u=O(c[_])
if(0===l)F[_]=W[_]=u
else{F[_]=R(F[_],u)
W[_]=x(W[_],u)}}}M(F,F,D)
N(W,W,D)
var d=false
for(var f=F[2];f<=W[2];++f){var v=f===F[2]?1:f===W[2]?2:0
j[2]=f
for(var h=F[1];h<=W[1];++h){var p=h===F[1]?3:h===W[1]?4:0
if(p&&v)continue
var m=p+v
j[1]=h
for(var g=F[0];g<=W[0];++g){var E=(j[0]=g)===F[0]?5:g===W[0]?6:0
if(m&&E)continue
var y=m+E
if(!y)continue
var T=tileSolid(j)
if(T){N(H,j,V[y])
if(tileSolid(H)){if(!d)k(z,j,false)
P({tile:T,opaque:true,pos:j,lit:true,draw_opts:z,face:y-1})}}}}}}},{"../glov/client/cmds.js":244,"../glov/client/engine.js":250,"../glov/client/settings.js":291,"../glov/common/vmath.js":332,"./camera.js":28,"./main.js":112,"./proc_gen_biomes.js":133,"./tiles.js":162,"./voxel_data.js":175}],22:[function(e,t,r){"use strict"
r.blueboxDrawAllEditBounds=blueboxDrawAllEditBounds
r.blueboxEditListAdd=blueboxEditListAdd
r.blueboxEditListRemove=blueboxEditListRemove
r.blueboxEditListUpdate=blueboxEditListUpdate
r.blueboxEditListCheck=blueboxEditListCheck
r.blueboxEditListCheckPoint=blueboxEditListCheckPoint
r.boundsStartup=boundsStartup
var a=e("../glov/client/aabbtree.js")
var i=e("./bluebox_ui.js"),h=i.blueboxGetSelected,o=i.bluebox_color_bounds
var n=e("./camera.js").getCurrentCameraPos
var s=e("../glov/client/cmds.js").cmd_parse
var l=e("../glov/client/draw_list.js")
var p=e("../glov/client/engine.js")
var c=e("../glov/client/geom.js")
var _=e("../common/globals.js").CHUNK_SIZE
var u=e("./huds.js"),m=u.settlementBoundsShouldDraw,g=u.settlementVolumeBoundsShouldDraw
var d=e("./main.js").charControllerPos
var E=Math.abs,f=Math.max,v=Math.min,y=Math.sin,T=Math.sqrt
var I=e("./megachunk_client.js").megaChunkGetNearbyVolumes
var S=e("./settlement.js").settlementFromVolume
var A=e("../glov/client/settings.js")
var w=e("../glov/client/shaders.js")
var L=e("../glov/client/textures.js")
var R=e("../glov/common/util.js"),x=R.easeInOut,O=R.ridx
var b=e("../glov/common/vmath.js"),N=b.mat4,C=b.vec3,M=b.v3add,D=b.v3addScale,P=b.v3copy,k=b.v3mul,B=b.v3scale,U=b.v3sub,G=b.v3iMin,F=b.vec4,W=b.v4copy,j=b.v4mul,H=b.unit_vec
var z=e("./voxel_chunk_manager.js").getThisFrameFrustumPlanes
var V=e("./voxel_data.js")
var Y=V.localPosFromWorldPos
var q=e("../common/world_constants.js").VOLUME_SETTLEMENT_PREFIX
var K
var Z
var X
var Q
function BlueboxListEdit(){this.tree=a.create({name:"bluebox_list_edit"})
this.prepared_list=[]
this.query_list=[]}var J=new Float32Array(6)
var $=1/_
BlueboxListEdit.prototype.add=function(e){J[0]=e.bluebox_bounds_origin[0]*$
J[1]=e.bluebox_bounds_origin[1]*$
J[2]=e.bluebox_bounds_origin[2]*$
J[3]=J[0]+e.bluebox_bounds_size[0]*$
J[4]=J[1]+e.bluebox_bounds_size[1]*$
J[5]=J[2]+e.bluebox_bounds_size[2]*$
this.tree.add(e,J)}
BlueboxListEdit.prototype.remove=function(e){this.tree.remove(e)}
BlueboxListEdit.prototype.update=function(e){J[0]=e.bluebox_bounds_origin[0]*$
J[1]=e.bluebox_bounds_origin[1]*$
J[2]=e.bluebox_bounds_origin[2]*$
J[3]=J[0]+e.bluebox_bounds_size[0]*$
J[4]=J[1]+e.bluebox_bounds_size[1]*$
J[5]=J[2]+e.bluebox_bounds_size[2]*$
this.tree.update(e,J)}
BlueboxListEdit.prototype.getVisible=function(){this.tree.finalize()
var e=z()
var t=this.tree.getVisibleNodes(e,this.prepared_list,0)
this.prepared_list.length=t
return this.prepared_list}
var ee=.25*$
var te=2*ee
BlueboxListEdit.prototype.query=function(e,t){J[0]=e[0]*$+V.origin_chunk[0]+ee
J[1]=e[1]*$+V.origin_chunk[1]+ee
J[2]=e[2]*$+V.origin_chunk[2]+ee
J[3]=J[0]+t[0]*$-te
J[4]=J[1]+t[1]*$-te
J[5]=J[2]+t[2]*$-te
var r=this.tree.getOverlappingNodes(J,this.query_list,0)
this.query_list.length=r
return this.query_list}
var re=new BlueboxListEdit
var ae=F()
function drawBoundsBoxImp(e){var t=this
p.projectionZBias(.03,f(16,t.min_dist))
p.updateMatrices(t.mat)
L.bind(0,Q)
W(ae,t.color_set.outside)
ae[3]*=t.alpha
var r={size:t.size,color:ae,char_pos:d(),pos_world:t.pos_world}
w.bind(K,Z,r)
X.draw()
if(t.color_set.inside!==t.color_set.outside){W(ae,t.color_set.inside)
ae[3]*=t.alpha
w.bind(K,Z,r)}gl.cullFace(gl.FRONT)
X.draw()
gl.cullFace(gl.BACK)
p.projectionZBias(0)}var ie=C()
var oe=C()
function drawBoundsBox(e,t,r){profilerStart("drawBoundsBox")
e.mat=e.mat||N()
e.pos_world=e.pos_world||new Float32Array(e.mat.buffer,48,3)
P(e.pos_world,t)
e.drawAlpha=drawBoundsBoxImp
e.size=r
var a=n()
U(ie,a,t)
M(oe,t,r)
U(oe,a,oe)
for(var i=0;i<3;++i)if(ie[i]>0&&oe[i]<0)ie[i]=0
k(ie,ie,ie)
k(oe,oe,oe)
G(ie,oe)
e.min_dist=T(ie[0]+ie[1]+ie[2])
l.alphaQueue(e)
profilerStop("drawBoundsBox")}function volumeBoundaryForPos(e,t,r){var a=e.size,i=e.local_pos
var o=Infinity
for(var n=0;n<3;++n){var s=t[n]-i[n]
o=v(o,E(s),E(s-a[n]))}if(o<r)return o
return null}function volumeBoundsAlpha(e){var t=volumeBoundaryForPos(e,d(),10)
if(null===t)return 0
return x(1-t/10,2)}A.register({show_area_bounds:{label:"Show Area Bounds",usage:"Automatic (default): /show_area_bounds -1\nAlways: /show_area_bounds 1\nNever: /show_area_bounds 0",default_value:-1,type:s.TYPE_INT,range:[-1,1]},show_settlement_bounds:{label:"Show Settlement Bounds",usage:"Automatic (default): /show_settlement_bounds -1\nAlways: /show_settlement_bounds 1\nNever: /show_settlement_bounds 0",default_value:-1,type:s.TYPE_INT,range:[-1,1]}})
function showLabel(e){return-1===e?"Automatic (default)":0===e?"OFF":"ON"}s.register({cmd:"show_bounds",help:"Show Area and Settlement Bounds",usage:"Automatic (default): /show_bounds -1\nAlways: /show_bounds 1\nNever: /show_bounds 0",func:function func(e,t){var r=Number(e)
if(-1===r||0===r||1===r){A.set("show_area_bounds",r)
A.set("show_settlement_bounds",r)}return void t(null,"Show EditVolume Bounds = "+showLabel(A.show_area_bounds)+"\nShow Settlement Bounds = "+showLabel(A.show_settlement_bounds))}})
var ne={inside:o,outside:j(F(),o,[1,1,1,.25])}
var se=F(.7,.4,1,1)
var le={inside:se,outside:se}
var ce={inside:F(0,1,1,1),outside:F(0,1,1,.25)}
var _e=F(1,.2,.1,.5)
var ue={inside:j(F(),_e,[1,1,1,.5]),outside:_e}
var de=C()
var fe=.25
var ve={}
function contextAlloc(e,t){var r={local_pos:de,color_set:t?le:ce,size:C(),contains_settlement:e,alpha:1}
if(e)r.settlement_ctx=contextAlloc(false,true)
return r}function blueboxDrawAllEditBounds(){if(p.defines.NOUI)return
profilerStart("blueboxDrawAllEditBounds")
profilerStart("bluebox")
var e=re.getVisible()
var t=h()
for(var r=0;r<e.length;++r){var a=e[r]
Y(de,a.bluebox_bounds_origin)
var i=a.box_ctx=a.box_ctx||{sort_bias:a.bluebox_bounds_sort_bias,color_set:ne}
if(a===t)i.alpha=.5+.5*E(y(.005*p.frame_timestamp))
else i.alpha=1
drawBoundsBox(a.box_ctx,de,a.bluebox_bounds_size)}profilerStopStart("volumes")
var o=I()
for(var n in o){var s=o[n]
var l=ve[n]
if(!l){var c=n.startsWith(q)
l=ve[n]=contextAlloc(c)}U(l.size,s.max,s.min)
Y(de,s.min)
if(l.contains_settlement){var _=false
var u=false
if(!s.build_allowed)_=true
else{if(m())u=true
_=g()}if(-1!==A.show_area_bounds)_=Boolean(A.show_area_bounds)
if(-1!==A.show_settlement_bounds)u=Boolean(A.show_settlement_bounds)
if(_){var d=1===A.show_area_bounds?1:volumeBoundsAlpha(l)
if(d){l.alpha=d
l.color_set=s.build_allowed?ce:ue
drawBoundsBox(l,de,l.size)}}if(u){l=l.settlement_ctx
var f=S(s)
if(f){D(de,f.world_pos,H,-f.radius)
Y(de,de)
B(l.size,H,2*f.radius+1)
var v=(1===A.show_settlement_bounds?1:volumeBoundsAlpha(l))*fe
if(v){l.alpha=v
drawBoundsBox(l,de,l.size)}}}}else{l.color_set=s.build_allowed?ce:ue
drawBoundsBox(l,de,l.size)}}profilerStop()
profilerStop("blueboxDrawAllEditBounds")}function blueboxEditListAdd(e){re.add(e)}function blueboxEditListRemove(e){re.remove(e)}function blueboxEditListUpdate(e){re.update(e)}function blueboxEditListCheck(e,t,r,a){var i=re.query(e,t)
if(r||a)for(var o=i.length-1;o>=0;--o){var n=i[o]
if(n===r||a&&a===n.blueprint_def.owner_id)O(i,o)}return i.length?i:null}function blueboxEditListCheckPoint(e,t,r){return blueboxEditListCheck(e,H,t,r)}function boundsStartup(){K=w.create("shaders/bounds.vp")
Z=w.create("shaders/bounds.fp")
w.prelink(K,Z)
X=c.createQuads([[w.semantic.POSITION,gl.UNSIGNED_BYTE,4,false],[w.semantic.TEXCOORD_0,gl.UNSIGNED_BYTE,4,false],[w.semantic.TEXCOORD_1,gl.UNSIGNED_BYTE,4,false]],new Uint8Array([0,1,1,0,0,0,1,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,1,0,1,0,1,0,1,0,0,0,0,0,1,0,1,1,1,0,1,0,1,0,0,0,0,0,1,1,0,0,1,0,1,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1,0,0,1,0,0,0,0,1,0,1,0,0,0,1,1,1,1,1,0,0,1,0,0,0,0,1,1,0,1,1,0,0,0,0,0,0,1,0,1,0,1,0,0,0,0,1,0,0,1,0,1,1,1,0,0,0,1,1,0,0,0,0,0,1,1,0,0,0,1,1,0,0,0,0,0,0,1,0,0,0,0,1,0,0,1,1,0,0,1,1,0,0,0,0,0,0,1,1,0,1,1,1,0,0,1,0,0,0,0,1,0,1,2,0,0,0,1,0,1,0,0,1,0,0,2,0,0,0,0,0,1,0,1,1,1,0,2,0,1,0,0,0,0,0,1,1,1,1,2,0,1,0,1,0,0,0,0,0,1,1,2,0,1,0,1,0,0,0,0,0,1,0,2,0,1,0,0,0,0,0,1,0,0,0,2,0,0,0,0,0,1,0,1,0,0,1,2,0,0,0,1,0,1,0,0]))
Q=L.load({url:"img/bounds.png",filter_min:gl.LINEAR_MIPMAP_LINEAR,filter_max:gl.LINEAR,wrap_s:gl.REPEAT,wrap_t:gl.REPEAT})}},{"../common/globals.js":197,"../common/world_constants.js":212,"../glov/client/aabbtree.js":236,"../glov/client/cmds.js":244,"../glov/client/draw_list.js":246,"../glov/client/engine.js":250,"../glov/client/geom.js":263,"../glov/client/settings.js":291,"../glov/client/shaders.js":293,"../glov/client/textures.js":304,"../glov/common/util.js":330,"../glov/common/vmath.js":332,"./bluebox_ui.js":23,"./camera.js":28,"./huds.js":87,"./main.js":112,"./megachunk_client.js":116,"./settlement.js":148,"./voxel_chunk_manager.js":174,"./voxel_data.js":175}],23:[function(e,t,r){"use strict"
r.blueprintCaptureEnabled=blueprintCaptureEnabled
r.blueboxUIInit=blueboxUIInit
r.blueboxShift=blueboxShift
r.blueboxSelected=blueboxSelected
r.blueboxGetSelected=blueboxGetSelected
r.blueboxSelect=blueboxSelect
r.simpleSnapShotToExport=simpleSnapShotToExport
r.tickBlueboxUI=tickBlueboxUI
r.blueboxShowPreview=blueboxShowPreview
r.blueboxDrawForSnapshot=blueboxDrawForSnapshot
r.blueboxTickProp=blueboxTickProp
r.blueboxGetTitle=blueboxGetTitle
r.doBluebox=doBluebox
r.blueboxOnPlace=blueboxOnPlace
r.blueboxSelectProp=blueboxSelectProp
r.blueboxAutoSelect=blueboxAutoSelect
r.blueprintViewInit=blueprintViewInit
r.doBlueprintView=doBlueprintView
r.capture_preview_origin_offset=r.capture_preview_size=r.bluebox_color_bounds=void 0
var a=e("../glov/common/vmath")
var d=a.mat4
var Je=a.unit_vec
var V=a.v3add
var f=a.v3addScale
var $e=a.v3copy
var n=a.v3distSq
var Y=a.v3iAdd
var et=a.v3iMax
var tt=a.v3iMin
var q=a.v3iSub
var rt=a.v3same
var at=a.v3scale
var it=a.v3set
var i=a.vec3
var o=a.vec4
var s=o(.5,.5,1,1)
r.bluebox_color_bounds=s
var ot=e("assert")
var l=e("../glov/client/cmds").cmd_parse
var c=e("../glov/client/draw_list").opaqueQueue
var _=e("../glov/client/effects")
var oe=e("../glov/client/engine")
var ne=e("../glov/client/input")
var v=e("../glov/client/mat4ScaleRotateTranslate")
var h=e("../glov/client/net").netSubs
var se=e("../glov/client/scroll_area").scrollAreaCreate
var nt=e("../glov/client/settings")
var le=e("../glov/client/ui")
var u=e("../glov/client/urlhash")
var p=e("../glov/common/util")
var K=p.deepEqual
var ce=p.defaults
var st=p.nop
var lt=p.toNumber
var m=e("../glov/common/verify")
var H=e("../common/blueprint_common").BLUEPRINT_MAX_DIM
var g=e("../common/globals")
var ct=g.CHUNK_SIZE
var _t=g.CS3
var X=g.ID2
var Q=g.ID_FACTOR
var E=e("../common/ids")
var _e=E.ITEM_BLUEPRINT
var y=E.ITEM_BUCKET
var T=E.ITEM_LIQUID
var I=E.TYPE_BLOCK
var ue=E.TYPE_ITEM
var S=e("../common/materials_common").Mat
var A=e("../common/voxel_data_common")
var ut=A.ANIM_STYLE_BEAM
var dt=A.ANIM_TYPE_POS
var w=A.TRANSACT_PROP_INV_MOD
var L=e("../common/world_constants")
var ft=L.ACCESS_BUILDER
var vt=L.ACCESS_OWNER
var ht=L.WORLD_ACCESS_MODIFY_BUILDER
var R=e("./account_ui").formatUserID
var x=e("./bluebox_edit_list")
var pt=x.blueboxEditListCheck
var mt=x.blueboxEditListCheckPoint
var O=e("./blueprint")
var gt=O.STATE_BUILD
var Et=O.STATE_EDIT
var yt=O.STATE_PRE_BUILD
var Tt=O.STATE_PRE_EDIT
var It=O.STATE_SELF_DESTRUCT
var J=O.TYPE_EDITABLE
var b=O.blueprintGetDef
var $=O.blueprintGetTempDef
var N=O.blueprintIdValid
var St=O.finalizeCost
var C=e("./build_menu")
var M=C.blueprintAddToLibrary
var de=C.blueprintInLibrary
var At=e("./build_mode")
var D=e("./build_mode")
var wt=D.VU_TILE_BOX
var Lt=D.VU_TILE_ERROR
var Rt=D.drawUtilVoxel
var xt=D.protectBlock
var Ot=D.tempPoint
var bt=D.unlimitedMode
var P=e("./editvolume_client")
var Nt=P.editVolumeDefaultAccess
var Ct=P.editVolumeForPos
var Mt=P.inEditBounds
var fe=e("./file_management").uploadInProgress
var Dt=e("./inventory")
var k=e("./inventory")
var ve=k.INV_PLAYER
var Pt=k.countAvailableEx
var B=k.findAddIdxList
var kt=k.inventoryEmpty
var he=k.inventoryGetArr
var Bt=k.payCostEx
var U=k.transBucketConsume
var G=k.transInvAdd
var Ut=k.transInvDec
var F=e("./inventory_ui")
var pe=F.inventoryButton
var me=F.inventoryButtonPrep
var Gt=e("./item_anims")
var ge=e("./item_info_view").itemInfoViewShow
var Ee=e("./items")
var W=e("./items")
var ye=W.ITEM_CONTEXT_BUILD
var Ft=W.createItem
var Wt=W.itemIsAllowedInQuickbar
var jt=W.notLiquid
var Ht=W.sameItem
var j=e("./layout")
var z=j.UIVIEWS_BUTTON_H
var ee=j.UIVIEWS_BUTTON_W
var te=j.UIVIEWS_CONTENT_PAD
var zt=e("./localization/localization").L
var re=e("./main")
var ae=e("./main")
var ie=ae.charControllerPos
var Vt=ae.getFrameTransaction
var Te=ae.menuExit
var Ie=e("./main_menu")
var Se=Ie.ensureDefaultSeed
var Yt=Ie.getWorldInfo
var Ae=Ie.requireLogin
var we=e("./menu")
var Le=e("./menu")
var Re=Le.menuInteractGetProp
var xe=Le.menuX1
var Oe=Le.menuY1
var qt=e("./props")
var be=e("./props")
var Ne=be.PIEB_CHECK_CUR_SIZE
var Ce=be.inv_rot_mat
var Me=be.inv_rot_mat_flipped
var Kt=be.propClone
var Zt=be.rot_mat
var Xt=be.rot_mat_flipped
var De=e("./quickbar")
var Qt=e("./status")
var Pe=e("./styles")
var ke=Pe.label_style
var Be=Pe.loading_style
var Ue=e("./tiles")
var Jt=Ue.TILE_AIR
var $t=Ue.TILE_PROP_BASE
var er=Ue.TILE_PROP_MAX
var tr=Ue.tile_map_default
var Ge=e("./ui_util")
var Fe=e("./user_data").worldReadOnly
var We=e("./user_info_view").userInfoGet
var je=e("./voxel_data")
var He=e("./voxel_data")
var rr=He.andGetLiquid
var ar=He.andGetProp
var ir=He.chunkIdFromLocalIntPos
var ze=He.createSimpleDrawable
var Ve=He.createWorldVD
var or=He.drawProp
var nr=He.drawSingleVoxel
var Ye=He.exportCombinedGeometry
var sr=He.getPropLocalExact
var lr=He.getTileLocal
var cr=He.getTileLocalOrQueuedPlace
var _r=He.liquidUpdateDefer
var ur=He.transPropRemove
var dr=He.transPropUpdateField
var fr=He.transSetPropLocal
var vr=He.transSetTileLocal
var qe=He.worldPosFromLocalPos
var Ke=e("./world_comm")
var Ze=Ke.getPerm
var hr=Ke.getWorldID
var Xe=Ke.myUserCmdParse
var pr=e("./world_metadata").worldAccessExvolume
var Qe=Math.abs,mr=Math.floor,gr=Math.max,Er=Math.min,yr=Math.random,Tr=Math.round,Ir=Math.sin
ot(tr)
var Sr
var Ar=le.makeColorSet([.5,1,.5,1])
var wr=le.makeColorSet([.75,0,0,1])
var Lr=o(0,1,0,.667)
var Rr=o(1,1,1,.5)
var xr=o(1,.5,.5,.5)
var Or=o(0,1,0,.5)
nt.register({blueprint_auto_resize:{default_value:1,type:l.TYPE_INT,range:[0,1]},blueprint_auto_destroy:{default_value:0,type:l.TYPE_INT,range:[0,1],help:"Placed blueprints destroy themselves if they cannot complete instead of pausing"},blueprint_rate:{type:l.TYPE_FLOAT,default_value:1,range:[.001,1e6],help:"(Admin) Adjust the rate at which blueprints build",access_run:["sysadmin"],store:false}})
var br=0
var Nr=24
l.registerValue("blueprint_capture",{type:l.TYPE_INT,help:"(Admin) Allow placing an empty blueprints over content",label:"Blueprint Capture",range:[0,1],get:function get(){return br},set:function set(e){return br=e},access_run:["sysadmin"]})
l.registerValue("blueprint_capture_size",{type:l.TYPE_INT,help:"(Admin) Choose size used by /blueprint_capture",label:"Blueprint Capture Size",range:[1,256],get:function get(){return Nr},set:function set(e){return Nr=e},access_run:["sysadmin"]})
function blueprintCaptureEnabled(){return br}function blueboxUIInit(){}function blueboxShift(e){if(Sr)Y(Sr,e)}function blueboxSelected(e){return Sr&&rt(Sr,e)}function blueboxGetSelected(){if(!Sr)return null
var e=sr(Sr)
if(!e||e.item_id!==_e)return Sr=null
return e}function blueboxSelect(e,t){if(!Sr)Sr=i()
$e(Sr,e)}function matchingItem(e,t){ot(e)
return Ht(e,t)||t&&e.type===ue&&t.type===ue&&(e.id===y||e.id===T)&&(t.id===y||t.id===T)&&e.attr2===t.attr2}function countInList(e,t){var r=0
for(var a=0;a<t.length;++a)if(matchingItem(e,t[a]))r+=t[a].count
return r}function deposit(e,t,r,a,i,o,n){ot(!bt())
var s=e.contents
var l=he()
for(var c=0;o&&c<l.length;++c){var _=l[c]
if(!matchingItem(i,_))continue
var u=Er(o,_.count)
if(_.type===ue&&_.id===y){var d=U(a,c,u)
if(d)a=d
else u=0}else{a=a||Vt()
Ut(a,ve,c,u)}if(u){o-=u
var f=B(e,i,u,true)
ot(f)
for(var v=0;v<f.length;){var h=f[v++]
var p=f[v++]
if(n)if(s[h])s[h].count+=p
else{var m=i
if(m.count!==p)(m=Ft(i)).count=p
s[h]=m}else{a=a||Vt()
G(a,e,i,h,false,p)}}}}if(e.bluebox_state!==gt&&r){var g=false
for(var E=0;E<t.length;++E)if(countInList(t[E],s)){g=true
break}if(g)e.blueboxChangeState(a,gt,n)}return a}function depositAll(e,t,r,a,i,o){ot(!bt())
var n=e.contents
var s=he()
for(var l=0;l<t.length;++l){var c=t[l]
var _=countInList(c,n)
var u=gr(c.count-_,0)
var d=countInList(c,s)
if(u&&d)i=deposit(e,r,a,i,c,Er(u,d),o)}}var Cr=2
var Mr=3
function notPropInvMod(e){return e[0]!==w}var Dr=[]
function blockToItem(e){var t=Dr[e]
if(!t){t=Dr[e]=Ft({type:I,id:e})
ot(t.cost)}return t}var Pr=[]
function liquidToItem(e){var t=Pr[e]
if(!t){var r=e
if(1&r)--r;(t=Pr[e]=Ft({type:ue,id:T,attr1:S.ANY,attr2:r})).cost=[t]}return t}function blueboxSelfDelete(e,t){if(e)e.ops=e.ops.filter(notPropInvMod)
e=e||Vt()
t.transBusy(e)
ur(e,t)
e.bluebox_no_last_update=true
if(t.bluebox_state===It)e.silent_error=true
return e}var kr=o(.5,.5,1,1)
var Br=2
var Ur=2
var Gr=new Int32Array([Nr,Nr,Nr])
r.capture_preview_size=Gr
var Fr=new Int32Array([-7,1,0])
r.capture_preview_origin_offset=Fr
var Wr=100
var jr=15e3
function flipAmount(e){if(e.inv.flips_on_x)return e.rot%2===0?2:0
else return e.rot%2===0?0:2}var Hr=function(){var Ue=[new Int32Array(3),new Int32Array(3)]
var Ge=new Int32Array(3)
var B=[new Int32Array(3),new Int32Array(3)]
var U=new Int32Array(3)
function getBounds(e,t){if(t[0]<0){Ue[0][0]=e[0]+t[0]+1
Ue[1][0]=e[0]
Ge[0]=-t[0]}else{Ue[0][0]=e[0]
Ue[1][0]=e[0]+t[0]-1
Ge[0]=t[0]}if(t[1]<0){Ue[0][1]=e[1]+t[1]+1
Ue[1][1]=e[1]
Ge[1]=-t[1]}else{Ue[0][1]=e[1]
Ue[1][1]=e[1]+t[1]-1
Ge[1]=t[1]}Ue[0][2]=e[2]
Ue[1][2]=e[2]+t[2]-1
Ge[2]=t[2]}function showBounds(){Rt(wt,Ue[0],s,$e(Ot(),Ge),Mr+Ge[2]/2)
Rt(wt,[Ue[1][0]+1,Ue[1][1]+1,Ue[1][2]+1],s,[-Ge[0],-Ge[1],-Ge[2]],Mr+Ge[2]/2)}var Fe
var We
function checkBounds(e,t,r,a,i,o){if(r&&i.is_preview)showBounds()
if(a)for(U[2]=Ue[0][2];U[2]<=Ue[1][2];++U[2])for(U[1]=Ue[0][1];U[1]<=Ue[1][1];++U[1])for(U[0]=Ue[0][0];U[0]<=Ue[1][0];++U[0]){var n=false
if(lr(U))if(!a[U.join(",")]){if(r){Rt(Lt,U,At.color_prop_blocked,Je,Cr)
n=true}We=false}if(rr(0))if(!a["L"+U.join(",")]){if(r){Rt(Lt,U,At.color_prop_blocked,Je,Cr)
n=true}We=false}if(!n&&o)if(mt(U,i)){Fe=false
if(r)Rt(Lt,U,At.color_prop_blocked,Je,Cr)}}else We=false}function checkPosBlocked(e){if(lr(U,0,true))return true
var t
if(e)t=cr(U)
else t=lr(U)
if(t){if(t===$t){var r=ar()
if(r&&r.vacate)return false}return true}return false}var je=new Int32Array(3)
var G=new Int32Array(3)
var F=[[0,0,0,-1,0,2,1,0,"-Y"],[1,0,0,1,1,2,0,1,"+X"],[0,1,0,1,0,2,1,2,"+Y"],[0,0,0,-1,1,2,0,3,"-X"],[0,0,1,1,0,1,2,-1,"+Z"]]
var W=[[0,0,1],[0,1,1],[1,0,-1],[1,1,-1]]
var j=[[1,0,-1],[1,1,-1],[0,0,1],[0,1,1]]
function checkResize(e,t,r){if(!nt.blueprint_auto_resize||Dt.locked(t)||t.trans_busy)return e
var a=t.rot,i=t.flipped
$e(B[0],Ue[0])
$e(B[1],Ue[1])
var o=false
var n=true
var s=br?Nr:H
var l=(a+2)%4
var c
do{c=false
for(var _=0;_<F.length;++_){var u=F[_]
var d=u[7]
if(d===a)continue
var f=u[8]
var v=u[4]
var h=u[5]
var p=u[6]
var m=B[1][v]-B[0][v]+1
var g=B[1][h]-B[0][h]+1
var E=B[1][p]-B[0][p]+1
it(U,B[u[0]][0],B[u[1]][1],B[u[2]][2])
var y=U[v]
var T=U[h]
var I=true
if(1===E||U[p]===je[p])I=false
for(var S=0;S<m&&I;++S){U[v]=y+S
for(var A=0;A<g;++A){U[h]=T+A
if(checkPosBlocked(true)){I=false
break}}}if(I){if(d===l){if(E<=Ur)continue}else switch(f){case"+Z":if(B[1][2]-B[0][2]<Br)continue
break
case"-X":if(B[0][0]>=je[0]-1)continue
break
case"+X":if(B[1][0]<=je[0]+1)continue
break
case"-Y":if(B[0][1]>=je[1]-1)continue
break
case"+Y":if(B[1][1]<=je[1]+1)continue
break
default:ot(0)}U[p]-=u[3]
var w=true
for(var L=0;L<m&&w;++L){U[v]=y+L
for(var R=0;R<g;++R){U[h]=T+R
if(checkPosBlocked(true)){w=false
break}}}if(w){o=true
B[u[3]>0?1:0][p]=U[p]
c=true}}else{if(d===l){if(E>=s)continue}else if(B[1][p]-B[0][p]+1>=s)continue
U[p]+=u[3]
U[v]=y
U[h]=T
G[v]=m
G[h]=g
G[p]=1
var x=true
if(pt(U,G))x=false
if(x)for(var O=0;O<m;++O){U[v]=y+O
for(var b=0;b<g;++b){U[h]=T+b
if(checkPosBlocked(false)){x=false
if(!r)Rt(Lt,U,kr,Je,Cr)
n=false}}}if(x){c=o=true
B[u[3]>0?1:0][p]=U[p]}}}}while(c)
if(o)n=false
if(r)return n
if(o){e=e||Vt()
var N=[B[1][0]-B[0][0]+1,B[1][1]-B[0][1]+1,B[1][2]-B[0][2]+1]
if(1===a||3===a){var C=N[0]
N[0]=N[1]
N[1]=C}if(!rt(N,t.bluebox_size)){dr(e,t,"bs","bluebox_size",N)
e.silent_error=true}var M=(i?j:W)[a]
var D=B[M[0]][M[1]]-Ue[M[0]][M[1]]
if(D){var P=t.bluebox_origin_offset
var k=[P[0]+D*M[2],P[1],P[2]]
dr(e,t,"bo","bluebox_origin_offset",k)}t.blueboxUpdatePos()
t.transBusy(e)
ot(e.ops.length)}return e}var He=new Int32Array([3,2,2])
var ze=new Int32Array([-1,1,0])
var Ve=-2
var Ye=new Int32Array(3)
var qe=new Int32Array(3)
var Ke=new Int32Array(3)
var Ze=new Int32Array(3)
var Xe=new Int32Array(3)
var Qe=new Int32Array([H,H,H])
return function blueboxEvaluateImp(u,e){var t=e.do_build,r=e.draw_debug,a=e.highlight_good,i=e.show_blocked_ghosts,o=e.check_bounds,n=e.do_transitions,s=e.place_preview
var l=8e3
if(Dt.locked(u)||u.trans_busy)n=t=false
if(br){it(Gr,Nr,Nr,Nr)
Fr[0]=mr(-(Nr-1)/2)}var c=r&&!s
var _=c||s
var d=[]
var f=[]
var v=u.blueprint_def,h=u.rot,p=u.flipped,m=u.bluebox_state
ot(v.loaded)
if(!v.subscribe())n=t=false
var g=t
var E=v.origin_offset,y=v.size
ot(E)
if(m===Et){E=u.bluebox_origin_offset
y=u.bluebox_size
if(v.isEmptyEditable()&&s)if(br){y=Gr
E=Fr}else{y=He
E=ze}ot(E&&y)}if(!y)y=Qe
var T=(p?Xt:Zt)[h]
u.getLocalPos(je)
Ye[0]=je[0]+E[0]*T[0]+E[1]*T[1]
Ye[1]=je[1]+E[0]*T[2]+E[1]*T[3]
Ye[2]=je[2]+E[2]
var I=null
it(Xe,y[0]*T[0]+y[1]*T[1],y[0]*T[2]+y[1]*T[3],y[2])
getBounds(Ye,Xe)
if(m===Et){if(u.is_preview)showBounds()
var S
if(n)I=checkResize(I,u,false)
else if(o)S=checkResize(null,u,true)
return{trans:I,cost:[],cost_clear:[],bounds_stable:S}}function checkEject(e,t){var r=true
var a=u.contents
var i
for(var o=0;o<a.length;++o){var n=a[o]
if(!n)continue
var s=countInList(n,d)
var l=n.count-s
if(l>0){if(!i)i=u.findDropOptions(false,e,t)
if(!i.length){r=false
Qt.get("nodrop").setMessage(zt.STATUSMSG_BBOX_CANNOT_EJECT)}else{I=I||Vt()
var c=i[mr(yr()*i.length)]
var _=Ft(n)
_.count=l
u.getLocalPos(Ke)
if(jt(_))qt.bagAddTrans(I,{target_pos:c,item:_,src_pos:Ke,emptied_pos:null,is_update_func:true})
Ut(I,u,o,l)}}}return r}if(m===It){if(t)if(checkEject())if(n)I=blueboxSelfDelete(I,u)
return{trans:I,cost:[],cost_clear:[]}}var A=r&&m===Tt
var w
if(o=o||m===Tt)w={}
var L=[Infinity,Infinity,Infinity]
var R=[-Infinity,-Infinity,-Infinity]
var x=false
var O=true
Fe=We=true
var b=false
var N=false
function checkFailed(e,t){O=false
if(r&&l){--l
Rt(t?wt:Lt,e,At.color_prop_blocked,Je,Cr)}}function addPosRot(e){var t=qe[0]+(15&e)
var r=qe[1]+((240&e)>>4)
Ke[0]=Ye[0]+t*T[0]+r*T[1]
Ke[1]=Ye[1]+t*T[2]+r*T[3]
Ke[2]=Ye[2]+qe[2]+((3840&e)>>8)}var C={}
function getTile(e){var t=lr(e,-1,false)
if(t===$t&&rt(e,je))return 0
if(!t)return C[e.join(",")]||0
return t}var M=v.chunk_map,D=v.owner_id
var P=t>=Wr
var k=pt(Ue[0],Ge,u)
var B=false
if(k){Fe=false
B=pt(Ue[0],Ge,u,D)}var U=[]
var G={}
function volumeForPos(e){var t=ir(e)
var r=G[t]
if(!r)r=G[t]=Ct(e)
return r}var F=false
var W
if(pr()>vt)W=false
else{var j=Yt(hr(),true)
if(!j)F=true
else{var H=j.access_modify
W=H===ht}}var z=volumeForPos(je)
function canEditPos(e){var t=volumeForPos(e)
var r
if(t===z)r=true
else if(t&&z)r=Nt(t)>=ft&&Nt(z)>=ft
else if(F)r=false
else if(W)r=z&&!t
else r=t&&!z
if(r&&!Mt(e))return false
return r}var V=Object.keys(M).map(lt)
for(var Y=0;Y<V.length;++Y){var q=M[V[Y]]
var K=q.data
if(K){at(qe,q.pos,ct)
for(var Z=0;Z<_t;++Z){var X=K[Z]
if(tr[X].unplaceable)X=0
if(!X||X>=$t&&X<=er)continue
if(X===Jt)X=0
addPosRot(Z)
if(w)w[Ke.join(",")]=true
tt(L,Ke)
et(R,Ke)
var Q=getTile(Ke)
if(-1===Q){O=false
continue}if(!bt()&&X&&X!==Q)X=tr[X].limited_blueprint||X
if(X&&Q&&X!==Q){X=tr[X].blueprint||X
Q=tr[Q].blueprint||Q}if(X===Q){if(a&&l){--l
Rt(wt,Ke,Or,Je,Cr)}continue}var J=void 0
if(X){J=blockToItem(X)
for(var $=0;$<J.cost.length;++$)d.push(J.cost[$])}if(B&&mt(Ke,u,D)){Fe=false
Q=-1}if(Q===$t){var ee=ar()
if(ee&&ee.vacate){Q=0
if(t){I=I||Vt()
ur(I,ee,true)
U.push(ee)}}}if(Q||!canEditPos(Ke)){checkFailed(Ke)
continue}if(!X)continue
for(var te=0;te<J.cost.length;++te)f.push(J.cost[te])
C[Ke.join(",")]=X
if(c&&l){--l
nr({tile:X,pos:$e(Ot(),Ke),color:Rr,sort_bias:Cr})}if(g)if(Pt(u,J))if(t){--t
I=I||Vt()
Bt(I,u,J)
if(!P)Gt.add({style:ut,target_type:dt,target:Ke,src_type:dt,src:je,item:J})
vr(I,Ke,X,false,false,Q,true)
var re=lr(Ke,0,true)
if(re)vr(I,Ke,0,true,false,re,true)
xt(Ke)}else N=true
else x=true
else b=true}}}for(var ae=0;ae<V.length;++ae){var ie=M[V[ae]]
var oe=ie.props
at(qe,ie.pos,ct)
for(var ne in oe){var se=oe[ne=Number(ne)]
if(!Wt(se.inv)||!se.inv.placeable)continue
addPosRot(ne)
var le=(se.size[0]-1)*T[0]+(se.size[1]-1)*T[1]
var ce=(se.size[0]-1)*T[2]+(se.size[1]-1)*T[3]
if(le<0){Ke[0]+=le
le=-le}if(ce<0){Ke[1]+=ce
ce=-ce}tt(L,Ke)
et(R,[Ke[0]+le,Ke[1]+ce,Ke[2]+se.size[2]])
var _e=sr(Ke)
if(_e)if(Ht(_e.toItem(),se.toItem())){if(a&&l){--l
Rt(wt,Ke,Or,[le+1,ce+1,se.size[2]],Cr)}if(w)for(var ue=0;ue<=ce;++ue){Ze[1]=Ke[1]+ue
for(var de=0;de<=le;++de){Ze[0]=Ke[0]+de
for(var fe=0;fe<se.size[2];++fe){Ze[2]=Ke[2]+fe
w[Ze.join(",")]=true}}}continue}var ve=se.toItem()
var he=ve.cost
ot(he)
d=d.concat(he)
var pe=false
for(var me=0;me<=ce;++me){Ze[1]=Ke[1]+me
for(var ge=0;ge<=le;++ge){Ze[0]=Ke[0]+ge
if(se.inv.rooted||se.groundFilter){Ze[2]=Ke[2]-1
var Ee=getTile(Ze)
if(Ee&&se.groundFilter&&!se.groundFilter(Ee))Ee=0
if(Ee>=$t&&Ee<=er){var ye=ar()
if(!ye||ye.inv.intangible)Ee=0}if(!Ee){checkFailed(Ze,true)
pe=true}}for(var Te=0;Te<se.size[2];++Te){Ze[2]=Ke[2]+Te
var Ie=Ze.join(",")
if(w)w[Ie]=true
var Se=getTile(Ze)
if(Se===$t){var Ae=ar()
if(Ae&&Ae.vacate){Se=0
if(t){I=I||Vt()
ur(I,Ae,true)
U.push(Ae)}}}if(B&&mt(Ze,u,D)){Fe=false
Se=-1}if(Se||!canEditPos(Ze)){checkFailed(Ze)
pe=true}else C[Ie]=Ve}}}var we=null
if(c||_&&!(se.baked&&se.baked.key))if(pe){if(i)we=xr}else we=Rr
if(we||t&&!pe){(se=Kt(se)).size[0]=le+1
se.size[1]=ce+1
se.setRot(se.inv.no_auto_rot?0:se.rot+h+(p?flipAmount(se):0))}if(we&&l){--l
se.allowAlpha()
se.draw_opts.color=we
se.draw_opts.unlit=true
se.draw_opts.z_bias=-.03
or(se,$e(Ot(),Ke))}if(pe)continue
f=f.concat(he)
if(g)if(Pt(u,ve))if(t){--t
I=I||Vt()
Bt(I,u,ve)
if(!P)Gt.add({style:ut,target_type:dt,target:Ke,src_type:dt,src:je,item:ve})
se.blueprintFilter()
se.updateBeforePlace(Ke)
fr(I,Ke,se,true,rt(Ke,je))
xt(Ke)}else N=true
else x=true
else b=true}}var Le=false
for(var Re=0;Re<V.length;++Re){var xe=M[V[Re]]
var Oe=xe.liquid
at(qe,xe.pos,ct)
if(Oe)for(var be=0;be<_t;++be){var Ne=Oe[be]
if(!Ne)continue
if(Ne===Jt)Ne=0
addPosRot(be)
if(w)w["L"+Ke.join(",")]=true
tt(L,Ke)
et(R,Ke)
var Ce=liquidToItem(Ne)
var Me=getTile(Ke)
var De=rr(-1)
if(Ne!==De)d.push(Ce)
if(Ne===De){if(a&&l){--l
Rt(wt,Ke,Or,Je,Cr)}continue}if(B&&mt(Ke,u,D)){Fe=false
Me=-1}if(De||!canEditPos(Ke)){checkFailed(Ke)
continue}if(Me>=$t&&Me<=er){var Pe=ar()
if(Pe&&Pe.onFlow&&Pe.onFlow===st)Me=0}if(Me===Ve)Me=0
if(Me&&Ne){checkFailed(Ke)
continue}f.push(Ce)
if(c&&l){--l
nr({is_liquid:true,tile:Ne,pos:$e(Ot(),Ke),color:Rr,sort_bias:Cr})}if(g)if(Pt(u,Ce))if(t){Le=true
I=I||Vt()
Bt(I,u,Ce)
if(!P)Gt.add({style:ut,target_type:dt,target:Ke,src_type:dt,src:je,item:Ce})
vr(I,Ke,Ne,true,false,De,true)
_r(ir(Ke))}else N=true
else x=true
else b=true}}if(Le)--t
if(A||o)checkBounds(Ye,Xe,A,w,u,k)
d=St({},{},d)
f=St({},{},f)
for(var ke=0;ke<U.length;++ke){var Be=U[ke]
Be.getLocalPos(Ke)
Be.vacate(I,Ke,true)}if(t)if(!checkEject(L,R))O=false
if(x||N||!O)b=true
if(I)I.compact()
if(g&&m===gt&&!N&&kt(u))if(!b||nt.blueprint_auto_destroy)I=blueboxSelfDelete(I,u)
else{I=I||Vt()
u.blueboxChangeState(I,yt)}if(n&&m===yt&&nt.blueprint_auto_destroy&&!N&&kt(u))I=blueboxSelfDelete(I,u)
if(n&&m===Tt)if(b){if(!I){I=Vt()
u.blueboxChangeState(I,yt)
I.silent_error=true}}else if(We&&Fe&&!b)if(!I){I=Vt()
u.blueboxChangeState(I,Et)
I.silent_error=true}return{trans:I,cost:d,cost_clear:f,build_all:O,build_incomplete:b,bounds_clear:We,bounds_clear_edit:Fe}}}()
var zr=function(){var c=i()
var _=i()
var u=i(.5,.5,0)
return function blueboxDrawForSnapshotInternalImp(e,t){(t=t||{}).alpha_queue=true
var r=e.blueprint_def,a=e.quat
if(null===e.chunk_id)it(_,0,0,0)
else e.getLocalPos(_)
Y(_,u)
ot(r.loaded)
var i=r.chunk_map,o=r.origin_offset
ot(o)
var n=e.preview_mat
if(!n)n=e.preview_mat=d()
v(n,1,a,_)
if(e.flipped){t.flipped=true
at(n,n,-1)}for(var s in i){var l=i[s]
if(l.ver_meshing!==l.geom_ver_meshing){l.updateGeometrySimple({need_offs:true})
f(c,o,l.pos,ct)
at(c,c,-1)
Y(c,u)
Y(c,Je)
l.bluebox_drawable=ze(l,c)}l.bluebox_drawable.drawMat(n,t)}}}()
function simpleSnapShotToExport(e){var t=e
var r=new Uint16Array
var a=t.chunk_map
for(var i in a){var o=a[i]
var n=o.updateAndReturnGeometry(o.pos)
var s=r.length+n.length
var l=new Uint16Array(s)
l.set(r,0)
l.set(n,r.length)
r=l}Ye(r,t.name)}var Vr=function(){var k=new Int32Array(3)
var B=new Int32Array(3)
var U=new Int32Array(3)
var G=new Int32Array(3)
var F=new Int32Array(3)
var W=0
var j=1
var H=2
var z=0
return function blueboxSerializeDefFn(e,t){var r=e.blueprint_def,a=e.rot,i=e.flipped,o=e.bluebox_last_serialized_def,n=e.bluebox_last_serialized_chunk_deps
ot(r)
ot(r.loaded)
ot(r.channel)
ot.equal(r.type,J)
var s=e.bluebox_origin_offset.slice(0)
var l=e.bluebox_size.slice(0)
var c=(i?Xt:Zt)[a]
var _=(i?Me:Ce)[a]
e.getLocalPos(U)
k[0]=U[0]+s[0]*c[0]+s[1]*c[1]
k[1]=U[1]+s[0]*c[2]+s[1]*c[3]
k[2]=U[2]+s[2]
var u={}
for(var d=0;;){var f=(mr((k[2]+d)/ct)+je.origin_chunk[2])*X
for(var v=0;;){for(var h=0;;){B[0]=h*c[0]+v*c[1]
B[1]=h*c[2]+v*c[3]
var p=mr((k[0]+B[0])/ct)+je.origin_chunk[0]+(mr((k[1]+B[1])/ct)+je.origin_chunk[1])*Q+f
var m=je.chunk_map[p]
u[p]=m&&m.ver_data||0
if(h===l[0]-1)break
h=Er(h+16,l[0]-1)}if(v===l[1]-1)break
v=Er(v+16,l[1]-1)}if(d===l[2]-1)break
d=Er(d+16,l[2]-1)}if(n)if(K(n,u))return o
var g=[-s[0],0,0]
var E=[-s[0],0,0]
for(var y=0;y<l[2];++y){G[2]=k[2]+y
for(var T=0;T<l[1];++T)for(var I=0;I<l[0];++I){B[0]=I*c[0]+T*c[1]
B[1]=I*c[2]+T*c[3]
G[0]=k[0]+B[0]
G[1]=k[1]+B[1]
if(lr(G,0,false)||rr()){it(F,I,T,y)
tt(g,F)
et(E,F)}}}V(l,E,Je)
Y(s,g)
q(l,g)
k[0]=U[0]+s[0]*c[0]+s[1]*c[1]
k[1]=U[1]+s[0]*c[2]+s[1]*c[3]
k[2]=U[2]+s[2]
var S=$()
$e(S.origin_offset,s)
S.name=r.name
$e(S.size,l)
function set(e,t,r,a,i){var o=(-16&e)>>4
var n=(-16&t)>>4
var s=(-16&r)>>4
var l=s*X+n*Q+o
var c=S.chunk_map[l]
if(!c)(c=S.chunk_map[l]=Ve(o,n,s,l)).main_world=false
it(F,15&e,15&t,15&r)
switch(i){case W:if(!c.data)c.alloc()
a=tr[a].blueprint||a
c.setUnchecked(F,a)
break
case j:if(!c.liquid)c.alloc(true)
c.setUncheckedLiquid(F,a)
break
case H:var _=F[2]*c.stride2+F[1]*c.stride1+F[0]
if(!c.props)c.props={}
a.setPos(F)
var u=a
if((c.props[_]=u).baked){if(!c.baked_props)c.baked_props={}
c.baked_props[_]=u.baked}if(u.draw){if(!c.drawable_props)c.drawable_props={}
c.drawable_props[_]=u}if(!c.data)c.alloc()
c.setUnchecked(F,$t)
break
default:ot(0)}}S.has_fallbacks=false
for(var A=0;A<l[2];++A){G[2]=k[2]+A
for(var w=0;w<l[1];++w)for(var L=0;L<l[0];++L){B[0]=L*c[0]+w*c[1]
B[1]=L*c[2]+w*c[3]
G[0]=k[0]+B[0]
G[1]=k[1]+B[1]
var R=lr(G,0,false)
if(R)if(R===$t){var x=ar()
ot(x)
var O=Kt(x).blueprintFilter()
if(O){if(O.fallback)S.has_fallbacks=true
var b=L
var N=w
var C=[B[0]+x.size[0],B[1]+x.size[1]]
var M=C[0]*_[0]+C[1]*_[1]-b
var D=C[0]*_[2]+C[1]*_[3]-N
if(M<0){b+=M+1
M=-M}if(D<0){N+=D+1
D=-D}O.size[0]=M
O.size[1]=D
O.setRot(x.inv.no_auto_rot?0:x.rot-a+(i?flipAmount(x,x.rot):0))
set(b,N,A,O,H)}}else if(R<$t)set(L,w,A,R,W)
var P=rr()
if(P)set(L,w,A,P,j)}}S.ver=-z++
S.loaded=true
e.bluebox_last_serialized_def=S
e.bluebox_last_serialized_chunk_deps=u
if(t)S.calcCost()
return S}}()
var Yr=256
var qr=256
var Kr={}
function blueboxSaveDef(a){var e=Vr(a,false)
var t=a.blueprint_def
var r=Kr[t.bid]
ot(r)
r.blueprint_def=e
var i
r.updateThumbnail({snapshot_backdrop:Ee.sprite_blueprint_bg.texs[0],snapshot_res:Yr,snapshot_post:function snapshot_post(){_.clearAlpha()
var e=oe.canvas
var t=document.createElement("canvas")
t.width=Yr
t.height=qr
t.getContext("2d").drawImage(e,0,oe.height-qr,Yr,qr,0,0,Yr,qr)
i=t.toDataURL("image/jpeg",.92)},force_update:true})
ot(i)
var o={snapshot:{data:i,w:Yr,h:qr}}
if(blueprintCaptureEnabled())e.c=1
t.saveBlueprint(e,o,function(e,t){if(!e){a.bluebox_saved_at=Date.now()
ot(t.ver&&t.ver!==a.bluebox_ver)
if(!a.removed){var r=Vt()
dr(r,a,"bv","bluebox_ver",t.ver)
ot(r.ops.length)}}})}function blueboxEvaluateAndCheckResources(e,t){t=ce(t,{do_build:false,draw_debug:true,do_transitions:true})
var r=Hr(e,t)
var a=r.cost,i=r.cost_clear,o=r.trans,n=r.build_incomplete
var s=true
var l=0
var c=false
if(bt())c=i.length>0
else{var _=e.contents
for(var u=0;u<a.length;++u){var d=a[u]
if(countInList(d,_)<d.count){s=false
l++}}for(var f=0;f<i.length;++f)if(countInList(i[f],_))c=true}r.resources_all=s
r.resources_missing=l
if(!Dt.locked(e)&&!e.trans_busy){if(e.bluebox_state===yt&&c){o=o||Vt()
e.blueboxChangeState(o,gt)
o.silent_error=true}if(e.bluebox_state===yt&&kt(e)&&!n){var v=e.blueprint_def
if(v&&v.loaded&&!v.isEditable()){Qt.push(zt.STATUSMSG_BP_COMPLETELY_BUILT)
o=blueboxSelfDelete(o,e)}}}r.trans=o
return r}var Zr=o(1,0,0,1)
var Xr=o(.5,.5,1,1)
var Qr=o(1,1,0,1)
var Jr=new Int32Array(3)
function tickBlueboxUI(){var e=blueboxGetSelected()
if(!e)return
if(!e.blueprint_def.loaded)return
e.getLocalPos(Jr)
if(n(ie(),Jr)>3*ct*ct*3){Sr=null
return}var t=blueboxEvaluateAndCheckResources(e,{draw_debug:true})
var r=t.build_all,a=t.bounds_clear,i=t.bounds_clear_edit,o=t.resources_all
if(e.bluebox_state===Et){Qr[3]=Qe(Ir(.005*oe.frame_timestamp))
Rt(wt,Jr,Qr)}else if(!(r&&o&&a&&i)){Zr[3]=Qe(Ir(.005*oe.frame_timestamp))
Rt(wt,Jr,Zr)}else{Xr[3]=.25*Qe(Ir(.005*oe.frame_timestamp))
Rt(wt,Jr,Xr)}}function blueboxShowPreview(e){var t=e.blueprint_def
var r=Hr(e,{do_build:false,draw_debug:true,highlight_good:true,show_blocked_ghosts:true,do_transitions:false,place_preview:true,check_bounds:t.isEmptyEditable()&&!br})
var a={noprops:true,color:Rr,unlit:true}
c(zr.bind(null,e,a))
var i=r.build_incomplete
if(t.isEditable()&&!i){if(e.bluebox_state!==Et){e.bluebox_state=Et
e.updateDrawable()}}else if(e.bluebox_state!==gt){e.bluebox_state=gt
e.updateDrawable()}}function blueboxDrawForSnapshot(e){zr(e)}function expTicks(e){var t=mr((e-7)/2)
return e<5?0:e<8?1:2+t*(t-1)+(!(1&e)?t:0)}function blueboxTickProp(e,t){ot(t)
if(bt()&&e.bluebox_state===gt){var r=e.bluebox_done_ticks
var a=expTicks(e.bluebox_total_ticks)
t=a-r
e.bluebox_done_ticks=a
if(!m(t>=0))return null
if(!t)return null
var i=Er(Tr(Wr*nt.blueprint_rate),jr)
if(t>i){var o=t-i
e.bluebox_done_ticks-=o
t-=o}}return Hr(e,{do_build:t,draw_debug:false,do_transitions:true}).trans}function cmpItem(e,t){if(e.type!==t.type)return e.type-t.type
if(e.id!==t.id)return e.id-t.id
if(e.attr1!==t.attr1)return e.attr1<t.attr1?-1:1
if(e.attr2!==t.attr2)return e.attr2<t.attr2?-1:1
return e.attr3-t.attr3}var $r={label:zt.BTN_DEPOSIT_ALL}
var ea={label:zt.BTN_SAVE}
var ta={label:zt.BTN_REMOVE_BBOX}
var ra={label:zt.BTN_INFO}
var aa=[]
aa[yt]=Ge.BLUEBOX_PRE_BUILD
aa[gt]=Ge.BLUEBOX_BUILD
aa[Tt]=Ge.BLUEBOX_PRE_EDIT
aa[Et]=Ge.BLUEBOX_EDIT
aa[It]=Ge.BLUEBOX_PRE_EDIT
var ia=8
var oa
var na
function blueboxGetTitle(){return oa}function doBluebox(){var e=le.button_height
var t=Z.UI
var r=Oe()
var a=0
var i=xe()-a
var o=r-e
var n=e
var s=oe.font
oa=zt.LBL_BLUEPRINT
var l=Re()
if(!l){Sr=null
Te()
return}l.getLocalPos(Jr)
blueboxSelect(Jr,false)
var c=l.bluebox_state,_=l.blueprint_def
if(_.error){s.drawSizedAligned(Be,a,e,t,le.font_height,s.ALIGN.HVCENTER,i,2*o/3,zt.$(zt.BBOX_BP_DATA_ERROR,_.error))
oa=zt.LBL_BLUEPRINT_ERROR
return}if(!_.loaded){s.drawSizedAligned(Be,a,e,t,le.font_height,s.ALIGN.HVCENTER,i,2*o/3,zt.BBOX_BP_DATA_LOADING)
oa=zt.LBL_BLUEPRINT_LOADING
return}if(Dt.locked(l)||Dt.locked(ve)){s.drawSizedAligned(Be,a,e,t,le.font_height,s.ALIGN.HVCENTER,i,2*o/3,zt.BBOX_REFRESHING_STATE)
oa=zt.LBL_BLUEPRINT_LOADING
return}var u=false
var d
if(_.isEditable()){oa=zt.LBL_EDITABLE_BLUEPRINT
d=u=_.isMyBlueprint()}else d=de(_.bid)
oa=zt.separateColon(oa,_.name)
var f=l.contents
var v=he()
var h=blueboxEvaluateAndCheckResources(l,{draw_debug:true,check_bounds:_.isEditable()})
var p=h.cost,m=h.cost_clear,g=h.build_all,E=h.bounds_clear,y=h.bounds_clear_edit,T=h.resources_all,I=h.resources_missing
var S
if(c===Et)p=(S=Vr(l,true)).cost
var A=100
var w={x:a+i/2-A-4,y:n+=ia,z:t,w:A,h:A,frame:aa[c]}
Ge.sprite.draw(w)
var L={x:a+i/2+4,y:n,z:t,w:A,h:A,dynamic_snapshot_on_mouseover:true,draw_only:true,hide_count:true,tooltip:null,snapshot_backdrop:Ee.sprite_blueprint_bg.texs[0],no_perframe_limit:true}
L.z++
var R=Kr[_.bid]
if(!R)R=Kr[_.bid]=Ft({type:ue,id:_e,attr1:_.bid,attr2:1})
R.blueprint_def=S||_
me(L,R)
L.img.draw(L)
n+=A+ia
if(!na)na=se({z:Z.UI,background_color:null,auto_hide:true})
na.keyboardScroll()
na.begin({x:a,y:n,w:i,h:r-n})
n=0
var x=[]
var O=[]
function addButton(e,t){O[x.length]=t
x.push(e)}function statusLine(e){s.drawSizedAligned(ke,a,n,t,le.font_height,s.ALIGN.HCENTER,i,0,e)
n+=le.font_height+ia}var b=false
var N=g
if(c===Tt&&!p.length);else{var C=bt()&&c!==Et?zt.LBL_LEFT_TO_BUILD:zt.LBL_REQUIRED_RESOURCES
statusLine(C=p.length?zt.addColon(C):zt.separateColon(C,zt.LBL_NONE_RESOURCES.upper()))
p.sort(cmpItem)
var M=p.length>15?9:5
var D=Er(M,p.length)
var P=0
var k=bt()||c===Et
for(var B=0;B<p.length;++B){var U=a+(i-(A+ia)*D-ia)/2+(A+ia)*P
var G=p[B]
var F={x:U,y:n,w:A,z:t,disabled:true,base_name:"inv_info"}
var W=countInList(G,f)
var j=bt()?Infinity:countInList(G,v)
var H=gr(0,G.count-W)
var z=0
if(!k){F.count_override=zt.$(zt.FORMAT_FRACTION,W,G.count)
if(!H){F.base_name="inv_info"
Ge.sprite.draw(ce({color:Lr,h:A,z:t+.5,frame:Ge.CHECK},F))}else if(j){F.base_name="inv_active"
z=Er(H,j)
b=true
F.tooltip=zt.$(zt.TLTP_DEPOSIT_RESOURCE,z,G.getName())
F.disabled=false
F.colors=Ar
if(z!==H)N=false
else if(1===I&&g)F.in_event_cb=ne.pointerLockEnter}else{F.base_name="inv_info"
F.colors=wr
N=false}}if(pe(F,G)&&z){deposit(l,m,g,null,G,z,false)
if(F.in_event_cb)Te()}if(++P===M||B===p.length-1){P=0
D=Er(p.length-B-1,M)
n+=A+ia}}if(!T&&!b)statusLine(zt.BBOX_NO_MATCHING_RESOURCES)
if(!T)statusLine(zt.BBOX_MISSING_RESOURCES)}if(c===Tt){if(!y)statusLine(zt.BBOX_OVERLAPS_ANOTHER_EDITED_BP)
if(!E)statusLine(zt.BBOX_MUST_CLEAR_BOUNDS)}if(c===yt||c===gt){if(!g)statusLine(zt.BBOX_SOMETHING_BLOCKING)
if(!y)statusLine(zt.BBOX_OVERLAPS_EDITED_BP)
if(!bt())addButton($r,!b)
if(u&&_.isEditable())statusLine(zt.BBOX_TO_EDIT_FINISH_AND_PLACE)}var V=true
var Y=false
if(c===Et){var q=!u||_.saving||fe()||S.has_fallbacks
if(_.saving)statusLine(zt.MSG_SAVING)
else if(S.has_fallbacks)statusLine(zt.BBOX_HAS_FALLBACKS_SAVE)
else{if(fe())statusLine(zt.BBOX_WAITING_PREVIOUS_SAVE)
if((Y=l.bluebox_ver!==_.ver)&&u){statusLine(zt.BBOX_MODIFIED_ELSEWHERE_MSG_WARNING)
statusLine(zt.BBOX_MODIFIED_ELSEWHERE_MSG_OVERWRITE)
statusLine(zt.BBOX_MODIFIED_ELSEWHERE_MSG_EDIT)}if((V=l.blueprint_def.equals(S))&&l.blueprint_def.img_url){q=true
statusLine(l.bluebox_saved_at&&Date.now()-l.bluebox_saved_at<1e4?zt.BBOX_BP_SAVED:zt.BBOX_NO_CHANGES_DETECTED)}else if(!u)statusLine(zt.$(zt.BBOX_CANNOT_SAVE_OWNED_BY,_.owner_id))
if(Y&&V){var K=Vt()
dr(K,l,"bv","bluebox_ver",_.ver)
ot(K.ops.length)}}addButton(ea,q)}addButton(ta,_.saving)
addButton(ra,_.deleted||!d)
var X=260
var Q=36
var J=Er(x.length,3)
var $=a+(i-((X+ia)*J-ia))/2
for(var ee=0;ee<x.length;++ee){var te=null
var re=x[ee]
if(!ne.touch_mode)if(re===ta||re===$r&&N)te=ne.pointerLockEnter
var ae=x[ee].label
if(le.buttonText({x:$,y:n,z:t,font_height:Q,w:X,text:ae,disabled:O[ee],colors:!O[ee]&&re===$r?Ar:void 0,in_event_cb:te})){switch(re){case $r:depositAll(l,p,m,N,null)
break
case ea:blueboxSaveDef(l)
break
case ta:if(!V&&!_.deleted)le.modalDialog({title:zt.DLG_UNSAVED_CHANGES_TITLE,text:zt.DLG_UNSAVED_CHANGES_MSG,buttons:{yes:{cb:function cb(){if(!l.removed&&l.inEditBounds(Ne)&&!Fe())l.blueboxOnDig()},in_event_cb:!ne.touch_mode?ne.pointerLockEnter:null},no:{cb:st,in_event_cb:!ne.touch_mode?ne.pointerLockEnter:null}}})
else{if(l.inEditBounds(Ne)&&!Fe())l.blueboxOnDig()
if(!ne.touch_mode){var ie=De.getSelected()
if(ie&&ie.getBID()===_.bid)De.selectGatheringTools()}}break
case ra:ge({x:$,y:le.button_height,inv:l.inv,context:ye})
break
default:ot(false)}if(te)Te()}$+=X+ia
if(ee===J-1){n+=le.button_height+8
$=a+(i-((X+ia)*(x.length-J)-ia))/2}}na.end(n)}function blueboxOnPlace(e,t){if(t.bluebox_state===Et)t.bluebox_state=Tt
var r=t.blueprint_def.isEmptyEditable()&&br
var a=Hr(t,{do_build:false,draw_debug:false,do_transitions:false,check_bounds:t.blueprint_def.isEditable()&&!r})
var i=a.cost,o=a.cost_clear,n=a.build_incomplete,s=a.bounds_clear,l=a.bounds_clear_edit
if(r){s=l=true
br=false}if(t.bluebox_state===Tt)if(s&&l&&!n)t.bluebox_state=Et
else t.bluebox_origin_offset=t.bluebox_size=null
else{ot.equal(t.bluebox_state,yt)
if(t.blueprint_def.isEditable()&&!n)if(s&&l)t.blueboxChangeState(e,Et,true)
else t.blueboxChangeState(e,Tt,true)
else if(bt())if(o.length)t.blueboxChangeState(e,gt,true)
else t.blueboxChangeState(e,yt,true)
else{depositAll(t,i,o,true,e,true)
if(t.bluebox_state===yt&&!n)t.blueboxChangeState(e,gt,true)}}}function blueboxSelectProp(e){if(blueboxSelected(e.interactDetails())){e.blueboxOpenUI()
return}blueboxSelect(e.interactDetails())
if(!e.blueprint_def.loaded){Qt.push(zt.STATUSMSG_BP_STILL_LOADING)
return}var t=false
if(e.bluebox_state===yt){if(blueboxEvaluateAndCheckResources(e,{do_build:false,draw_debug:false,do_transitions:false}).resources_missing)t=true}else if(e.bluebox_state===Et)if(blueboxEvaluateAndCheckResources(e,{do_build:false,draw_debug:false,do_transitions:false,check_bounds:true}).bounds_stable)t=true
if(t)e.blueboxOpenUI()
else Qt.push(zt.STATUSMSG_PREVIEWING_BP)}function filterEditable(e){return e.bid[0]===J}var sa=i()
function blueboxAutoSelect(e){var t=mt(e)
if(t){var r=blueboxGetSelected()
if(r&&r.blueboxCalcBounds()){var a=r.bluebox_bounds_origin
var i=r.bluebox_bounds_inv_origin
qe(sa,e)
if(sa[0]>=a[0]&&sa[0]<i[0]&&sa[1]>=a[1]&&sa[1]<i[1]&&sa[2]>=a[2]&&sa[2]<i[2])return}if(1===(t=t.filter(filterEditable)).length)blueboxSelect(t[0].interactDetails())}}var la
var ca
var _a=false
var ua=false
function blueprintViewInit(e){Se()
ua=false
if(e){_a=false
ca=Ft({type:ue,id:_e,attr1:la=e})
oa=zt.LBL_BP_VIEW_LOADING}}function blueprintViewReInit(){re.toggleMenuPage(we.BLUEPRINT_VIEW)
ua=true}function doBlueprintView(){var e=le.button_height
var t=Z.UI
var r=Oe()
var a=0
var i=xe()-a
var o=r-e
var n=e
var s=a
var l=oe.font
oa=zt.LBL_BP_VIEW
if(!N(la)){l.drawSizedAligned(Be,a,e,t,le.font_height,l.ALIGN.HVCENTER,i,2*o/3,zt.BBOX_INVALID_BP_ID)
oa=zt.LBL_BP_VIEW_ERROR
return}var c=b(la)
if(c.error){l.drawSizedAligned(Be,a,e,t,le.font_height,l.ALIGN.HVCENTER,i,2*o/3,zt.$(zt.BBOX_BP_DATA_ERROR,c.error))
oa=zt.LBL_BP_VIEW_ERROR
return}if(!c.loaded){l.drawSizedAligned(Be,a,e,t,le.font_height,l.ALIGN.HVCENTER,i,2*o/3,zt.BBOX_BP_DATA_LOADING)
oa=zt.LBL_BP_VIEW_LOADING
return}if(c.isEditable()){l.drawSizedAligned(Be,a,e,t,le.font_height,l.ALIGN.HVCENTER,i,2*o/3,zt.BBOX_INVALID_BP_ID)
oa=zt.LBL_BP_VIEW_ERROR
return}var _=500
var u={x:s+(i-_)/2,y:n,w:_,z:t+2,hide_count:true,dynamic_snapshot:true}
me(u,ca)
u.img.draw(u)
n+=_+2*te
var d=2*le.font_height
l.drawSizedAligned(ke,s,n,t+1,d,l.ALIGN.HCENTERFIT,i,0,ca.getBuildName())
n+=d+te
var f=We(c.owner_id)
l.drawSizedAligned(ke,s,n,t+1,le.font_height,l.ALIGN.HCENTERFIT,i,0,zt.separateColon(zt.LBL_AUTHOR,R(f.user_id,f.display_name)))
n+=le.font_height+te
if(c.desc)n+=l.drawSizedWrapped(ke,s,n,t+1,i,80,le.font_height,zt.separateColon(zt.LBL_DESCRIPTION,c.desc))+te
n+=2*te
if(de(la)){l.drawSizedAligned(ke,s,n,t+1,le.font_height,l.ALIGN.HCENTERFIT,i,0,zt.BBOX_BP_IS_IN_YOUR_LIBRARY)
n+=le.font_height+te}else{if(le.buttonText({x:s+(i-ee)/2,y:n,w:ee,h:z,z:t+2,disabled:_a,text:_a?zt.BTN_ADDING_TO_LIBRARY:zt.BTN_ADD_TO_LIBRARY})||ua){ua=false
_a=true
if(h().loggedIn())M(la,function(e){_a=false
if(e)le.modalDialog({title:zt.DLG_ERROR_ADDING_BP_TITLE,text:e,buttons:{OK:null}})})
else Ae(blueprintViewReInit)}n+=z+te}if(Ze("sysadmin")&&!c.deleted)if(le.buttonText({x:s+(i-ee)/2,y:n,w:ee,h:z,z:t+2,disabled:_a,text:"(Admin) Purge blueprint..."}))le.modalDialog({title:"Purge Blueprint",text:"Are you sure you wish to purge this blueprint, making it invalid for all users?",buttons:{yes:function yes(){_a=true
Xe("blueprint_purge "+la,function(e){_a=false
if(e)le.modalDialog({title:zt.DLG_ERROR_ADDING_BP_TITLE,text:e,buttons:{OK:null}})
else le.modalDialog({text:"Blueprint has been purged, will take effect when clients reload",buttons:{OK:null}})})},no:null}})}l.register({cmd:"blueprint_view",help:"View blueprint details",func:function func(e,t){u.set("blueprint",e)
re.toggleMenuPage(we.BLUEPRINT_VIEW,e)
t()}})},{"../common/blueprint_common":192,"../common/globals":197,"../common/ids":198,"../common/materials_common":201,"../common/voxel_data_common":209,"../common/world_constants":212,"../glov/client/cmds":244,"../glov/client/draw_list":246,"../glov/client/effects":249,"../glov/client/engine":250,"../glov/client/input":271,"../glov/client/mat4ScaleRotateTranslate":277,"../glov/client/net":279,"../glov/client/scroll_area":289,"../glov/client/settings":291,"../glov/client/ui":306,"../glov/client/urlhash":307,"../glov/common/util":330,"../glov/common/verify":331,"../glov/common/vmath":332,"./account_ui":3,"./bluebox_edit_list":22,"./blueprint":24,"./build_menu":26,"./build_mode":27,"./editvolume_client":72,"./file_management":82,"./inventory":94,"./inventory_ui":95,"./item_anims":96,"./item_info_view":97,"./items":98,"./layout":99,"./localization/localization":108,"./main":112,"./main_menu":113,"./menu":117,"./props":141,"./quickbar":142,"./status":156,"./styles":160,"./tiles":162,"./ui_util":168,"./user_data":170,"./user_info_view":171,"./voxel_data":175,"./world_comm":182,"./world_metadata":186,assert:void 0}],24:[function(e,t,r){"use strict"
r.finalizeCost=finalizeCost
r.blueprintIdValid=blueprintIdValid
r.blueprintGetDef=blueprintGetDef
r.blueprintGetTempDef=blueprintGetTempDef
r.blueprintUnsubscribeAll=blueprintUnsubscribeAll
r.blueprintStartup=blueprintStartup
var a=e("../common/blueprint_common")
var i=a.BLUEPRINT_MAX_DIM
var o=a.STATE_BUILD
var n=a.STATE_EDIT
var s=a.STATE_PRE_BUILD
var l=a.STATE_PRE_EDIT
var c=a.STATE_SELF_DESTRUCT
var _=a.TYPE_EDITABLE
var u=a.TYPE_READONLY
var d=a.bid_valid_regex
r.STATE_SELF_DESTRUCT=c
r.STATE_PRE_BUILD=s
r.STATE_BUILD=o
r.STATE_PRE_EDIT=l
r.STATE_EDIT=n
r.TYPE_EDITABLE=_
r.TYPE_READONLY=u
var h=e("assert")
var f=e("../glov/client/engine")
var v=e("../glov/client/local_storage")
var p=e("../glov/client/net")
var m=p.netClient
var g=p.netSubs
var E=p.netUserId
var y=e("../glov/common/util")
var T=y.callEach
var I=y.empty
var S=y.ridx
var A=e("../glov/common/verify")
var w=e("../glov/common/vmath")
var L=w.unit_vec
var R=w.v3copy
var x=w.v3same
var O=w.zero_vec
var b=e("../common/ids")
var N=b.ITEM_GEM
var C=b.ITEM_LIQUID
var M=b.TYPE_BLOCK
var D=b.TYPE_CRAFT_CLASS
var P=b.TYPE_ITEM
var k=e("../common/materials_common")
var B=k.CraftClass
var U=k.Mat
var G=e("../common/megachunk_common").parseChunkId
var F=e("./analytics").logEvent
var W=e("./build_menu").updateBlueprintMetadata
var j=e("./crafting").craftClassMatches
var H=e("./file_management").uploadImageSet
var z=e("./items")
var V=z.createItem
var Y=z.isItem
var q=z.sameItem
var K=e("./localization/localization").L
var Z=e("./main")
var X=e("./status")
var Q=e("./tiles").TILE_PROP_BASE
var J=e("./voxel_data").createWorldVD
var $=e("./world_comm")
var ee=$.getPerm
var te=$.whenConnected
function BlueprintDef(e){this.bid=e
this.type=e[0]
this.chunk_map=[]
this.origin_offset=new Int32Array(3)
this.size=new Int32Array(3)
this.name=void 0
this.desc=void 0
this.owner_id=void 0
this.deleted=false
this.world_id=void 0
this.modified=0
this.loaded=false
this.ver=1
this.subscribed=false
this.channel=null
this.props=[]
this.on_load=[]}BlueprintDef.prototype.toJSON=function(){var e={}
var t=this.chunk_map
for(var r in t)e[r]=t[r].serialize()
var a={cm:e,o:[this.origin_offset[0],this.origin_offset[1],this.origin_offset[2]],s:[this.size[0],this.size[1],this.size[2]]}
if(this.type===_)a.v=this.ver
return a}
BlueprintDef.prototype.dispose=function(){var e=this.chunk_map
for(var t in e){e[t].dispose()
delete e[t]}}
BlueprintDef.prototype.isEmptyEditable=function(){if(this.type!==_)return false
return I(this.chunk_map)}
BlueprintDef.prototype.isEmpty=function(){return I(this.chunk_map)}
BlueprintDef.prototype.isEditable=function(){return this.type===_}
BlueprintDef.prototype.isMyBlueprint=function(){return Z.omp?E()===this.owner_id:true}
BlueprintDef.prototype.isSubscribed=function(){return this.channel}
BlueprintDef.prototype.onBlueprintDataInternal=function(e){var t=e.def,r=e.owner_id,a=e.name,i=e.desc,o=e.world_id,n=e.deleted,s=e.img,l=e.modified,c=e.renamed
if(t)this.fromJSON(t)
if(r)this.owner_id=r
if(a)this.name=a
if(i)this.desc=i
if(o)this.world_id=o
if(n)this.deleted=n
if(l)this.modified=l
this.renamed=Boolean(c)
if(s)this.img_url=s}
BlueprintDef.prototype.onBlueprintData=function(e){this.onBlueprintDataInternal(e)
this.subscribed=true}
BlueprintDef.prototype.saveBlueprint=function(a,e,i){var o=this
if(!Z.omp){this.ver++
a.ver=this.ver
v.setJSON("blueprint."+this.bid,a.toData())
this.fromJSON(a.toJSON())
i(null,{ver:this.ver})
return}h(this.channel)
this.saving=true
H(e,true,function(e,t){if(e){o.saving=false
Z.chat_ui.addChatError(K.$(K.CHATERROR_SAVING_BP_SNAPSHOT,e))
return i(e)}var r=m().pak("blueprint_save")
r.writeAnsiString(o.bid)
r.writeInt(t.snapshot.id)
r.writeJSON(a)
return r.send(function(e,t){o.saving=false
if(e)Z.chat_ui.addChatError(K.$(K.CHATERROR_SAVING_BP,e))
else{F("blueprint_saved")
X.push(K.STATUSMSG_BP_SAVED)}return i(e,t)})})}
function onBlueprintData(e){var t=this.bpdef
if(t)t.onBlueprintData(e)}BlueprintDef.prototype.unsubscribe=function(){if(!this.channel)return
g().unsubscribe("blueprint."+this.bid)
this.subscribed=false
this.channel.bpdef=null
this.channel=null}
BlueprintDef.prototype.subscribe=function(){if(this.type!==_||!Z.omp)return true
if(!this.channel){this.channel=g().getChannel("blueprint."+this.bid,true)
this.channel.bpdef=this}return this.subscribed}
function compressCost(e){for(var t=0;t<e.length;++t){var r=e[t]
for(var a=e.length-1;a>t;--a){var i=e[a]
if(q(r,i)){if(r===e[t])r=V(r)
r.count+=i.count
S(e,a)}}e[t]=r}return e}function finalizeCost(e,t,r){for(var a=0;a<r.length;++a){var i=r[a]
if(!Y(i))r[a]=V(i)}for(var o in e){o=Number(o)
var n=V({type:M,id:o}).cost
if(!A(n))n=[]
for(var s=0;s<n.length;++s){var l=n[s];(l=V(l)).count*=e[o]
r.push(l)}}for(var c in t){c=Number(c)
r.push(V({type:P,id:C,attr1:U.ANY,attr2:c,count:t[c]}))}return compressCost(r)}BlueprintDef.prototype.calcCost=function(){var e=this.chunk_map
var t={}
var r={}
var a=[]
for(var i in e){var o=e[i]
if(o.data)for(var n=0;n<o.data.length;++n){var s=o.data[n]
if(!s||s>=Q)continue
t[s]=(t[s]||0)+1}if(o.liquid)for(var l=0;l<o.liquid.length;++l){var c=o.liquid[l]
if(!c)continue
if(1&c)--c
r[c]=(r[c]||0)+1}if(o.props)for(var _ in o.props){var u=o.props[_].toItem().cost
h(u)
a=a.concat(u)}}this.cost=finalizeCost(t,r,a)
var d=-1
for(var f=0;f<this.cost.length;++f){var v=this.cost[f]
if(-1===d||v.count>this.cost[d].count)if(j(B.STONE_RAW,v))d=f}if(-1!==d){this.cost[d]=V(this.cost[d])
this.cost[d].count++}else this.cost.push(V({type:D,id:B.STONE_RAW,count:1}))}
BlueprintDef.prototype.fromJSON=function(e){var t=e.cm
var r=this.chunk_map
for(var a in r){if(!r[a].dispose)throw new Error("Non-VoxelData element found in BlueprintDef.chunk_map["+a+"]")
r[a].dispose()
delete r[a]}for(var i in t){i=Number(i)
var o=G(i)
var n=r[i]=J(o.chunk_pos[0],o.chunk_pos[1],o.chunk_pos[2],i)
n.main_world=false
n.deserialize(t[i])
if(n.props)for(var s in n.props)if(n.props[s].item_id===N){delete n.props[s]
delete n.baked_props[s]
delete n.drawable_props[s]}}this.calcCost()
R(this.origin_offset,e.o||O)
R(this.size,e.s||L)
if(this.type===_)this.ver=e.v||0
this.loaded=true
for(var l=0;l<this.props.length;++l)this.props[l].blueboxUpdatePos()
T(this.on_load,this.on_load=null)}
BlueprintDef.prototype.fromError=function(e){this.error=e
this.loaded=false}
BlueprintDef.prototype.fromData=function(e){var t
if(null!=e&&null!=(t=e.def)&&t.s&&(e.def.s[0]>i||e.def.s[1]>i||e.def.s[2]>i)&&!ee("sysadmin")){this.fromError("ERR_INVALID_BLUEPRINT")
return}this.onBlueprintDataInternal(e)
W(this)}
BlueprintDef.prototype.toData=function(){return{name:this.name,desc:this.desc,owner_id:this.owner_id,world_id:this.world_id,img_url:this.img_url,def:this.toJSON()}}
BlueprintDef.prototype.onLoad=function(e){h(!this.loaded)
if(!this.on_load)this.on_load=[]
this.on_load.push(e)}
BlueprintDef.prototype.addProp=function(e){this.props.push(e)}
BlueprintDef.prototype.removeProp=function(e){var t=this.props.indexOf(e)
S(this.props,t)}
BlueprintDef.prototype.equals=function(e){if(!x(this.origin_offset,e.origin_offset))return false
if(!x(this.size,e.size))return false
var t=this.chunk_map
var r=e.chunk_map
for(var a in t){var i=t[a]
var o=r[a]
if(!o)return false
if(!i.equals(o))return false}for(var n in r)if(!t[n])return false
return true}
var re={}
function blueprintIdValid(e){return e&&e.match(d)}function blueprintGetDef(r){var e=r[0]
h(e===u||e===_)
var a=re[r]
if(a)return a
a=re[r]=new BlueprintDef(r)
te(function(){m().send("blueprint_get",r,function(e,t){if(a.channel)return
if(e){console.warn("Error getting blueprint definition "+r+": "+e)
a.fromError(e)}else{f.fixNatives(false)
a.fromData(t)}})})
return a}function blueprintGetTempDef(){return new BlueprintDef("E(temp)")}function blueprintUnsubscribeAll(){for(var e in re)re[e].unsubscribe()}function blueprintStartup(){g().onChannelMsg("blueprint","blueprint_data",onBlueprintData)}},{"../common/blueprint_common":192,"../common/ids":198,"../common/materials_common":201,"../common/megachunk_common":202,"../glov/client/engine":250,"../glov/client/local_storage":274,"../glov/client/net":279,"../glov/common/util":330,"../glov/common/verify":331,"../glov/common/vmath":332,"./analytics":5,"./build_menu":26,"./crafting":57,"./file_management":82,"./items":98,"./localization/localization":108,"./main":112,"./status":156,"./tiles":162,"./voxel_data":175,"./world_comm":182,assert:void 0}],25:[function(e,t,r){"use strict"
r.blueprintMetaEdit=blueprintMetaEdit
var a=e("../glov/client/cmds").cmd_parse
var p=e("../glov/client/engine")
var m=e("../glov/client/environments").getLinkBase
var g=e("../glov/client/input")
var E=e("../glov/client/ui").provideUserString
var y=e("../glov/client/ui")
var T=e("../glov/common/util").nop
var I=e("../common/blueprint_common").BLUEPRINT_NAME_LEN
var i=e("../common/ids")
var S=i.ITEM_BLUEPRINT
var A=i.TYPE_ITEM
var w=e("./analytics").logEvent
var L=e("./bluebox_ui").simpleSnapShotToExport
var o=e("./blueprint").blueprintGetDef
var n=e("./build_menu")
var R=n.blueprintAddToLibraryOrSelect
var x=n.blueprintInLibrary
var s=n.blueprintLastPublishedID
var O=n.buildMenuRemoveBlueprint
var b=n.buildMenuRenameBlueprint
var l=n.dynamicAddBlueprint
var c=e("./fbinstant_worlds")
var N=c.fbShareBlueprint
var C=c.fbShareBlueprintLink
var _=e("./item_info_view")
var M=_.itemInfoViewClear
var D=_.itemInfoViewPush
var P=_.itemInfoViewing
var u=e("./items")
var k=u.ITEM_CONTEXT_BUILD
var B=u.createItem
var U=e("./localization/localization").L
var G=e("./main")
var F=e("./menu")
var d=e("./menu")
var W=d.isBuildMenu
var j=d.menuActive
var f=e("./quickbar")
var v=e("./world_comm")
var H=v.myUserCmdParse
var z=v.myUserCmdParseWrap
var V=4
var Y=false
function blueprintPublish(r,a){var e=o(r)
if(!(e.loaded&&e.isEditable()&&e.isMyBlueprint()))return void a(U.ERR_CMD_REQUIRES_OWNED_BP)
var t
function onLoad(){if(t)if(t.equals(e))return void R(t.bid,function(){a(null,t.bid,true)})
H("blueprint_publish "+r,function(e,t){if(t&&t.bid){l(t.bid,r)
return void a(null,t.bid,false)}a(e,t)})}var i=s(r)
if(!i)return void onLoad()
if((t=o(i)).loaded)return void onLoad()
t.onLoad(onLoad)}a.register({cmd:"blueprint_publish",help:"Make a read-only copy of the blueprint currently held in hand for sharing",func:function func(e,a){var t=f.getSelected()
var r=t&&t.getBID()
if(!r)return void a("No blueprint in-hand")
blueprintPublish(r,function(e,t,r){if(e)return void a(e,t)
return void a(null,"Blueprint "+(r?"already ":"")+"published as "+t)})}})
function blueprintMetaEdit(r,a,i,o){var e=0
var n=Z.USER_INFO_VIEW
var s=i.getBID()
var l=e
var c=(a-V)/2
var _=.65*y.button_height
var t=g.keyDown(g.KEYS.SHIFT)||g.padButtonDown(g.PAD.LT)
var u=o.isEditable()
var d=o.loaded
function button(e){if(l+c>a){l=0
r+=_+V}var t=y.buttonText({x:l,y:r,z:n,w:c,h:_,disabled:Y,text:e.text,tooltip:e.tooltip,tooltip_above:e.tooltip_above})
l+=c+V
return t}var f=u?U.BTN_DELETE:U.BTN_REMOVE
var v=u?U.TLTP_DELETE_THIS_BP:U.TLTP_REMOVE_THIS_BP
if(button({text:f=t?f:U.addEllipsis(f),tooltip:v=t?v:v+"\n"+U.$(U.TLTP_HOLD_SKIP_CONFIRMATION,U.INPUT_KEY_SHIFT.upper()),tooltip_above:true})){var h=function doDelete(){w("blueprint_delete")
M()
z("blueprint_delete "+s,function(e){O(i)
G.chat_ui.handleCmdParse(null,u?U.MSG_BP_DELETED:U.MSG_BP_REMOVED)})}
if(t)h()
else y.modalDialog({title:u?U.DLG_DELETE_BP_TITLE:U.DLG_REMOVE_BP_TITLE,text:U.$(u?U.DLG_DELETE_BP_MSG:U.DLG_REMOVE_BP_MSG,i.getBlueprintName()),buttons:{yes:h,no:null}})}if(d&&button({text:U.addEllipsis(U.BTN_RENAME),tooltip:!u&&o.isMyBlueprint()?U.TLTP_RENAME_BP_FOR_ALL:U.TLTP_RENAME_BP_IN_LIBRARY,tooltip_above:true}))y.modalTextEntry({edit_text:i.getBlueprintName(),title:U.DLG_RENAME_BP_TITLE,text:U.$(U.DLG_RENAME_BP_MSG,i.getBlueprintName()),max_len:I,buttons:{OK:function OK(r){if(r===i.getBlueprintName())return
var a="blueprint_rename "+s+" "+r
H(a,function(e,t){if(e){G.chat_ui.addChatError(U.$(U.CHATERROR_RUNNING_CMD,"/"+a,e))
y.modalDialog({title:U.DLG_ERROR_RENAMING_BP_TITLE,text:e,buttons:{ok:null}})}else{o.renamed=true
b(s,r)
G.chat_ui.handleCmdParse(null,U.MSG_BP_RENAMED)}})},Cancel:null}})
if(d&&u&&o.isMyBlueprint()&&!o.isEmpty())if(button({text:Y?U.BTN_SHARING:U.BTN_SHARE,tooltip:U.TLTP_SHARE_BP})){Y=true
blueprintPublish(s,function(e,t,r){Y=false
if(e){y.modalDialog({title:U.DLG_ERROR_SHARING_BP_TITLE,text:e,buttons:{ok:null}})
G.chat_ui.addChatError(e)}else{w("blueprint_share")
if(P(i,k))D(B({type:A,id:S,attr1:t}),k)}})}if(d&&!u&&o.isMyBlueprint()){if(button({disabled:Y,text:U.BTN_GET_LINK,tooltip:U.TLTP_LINK_BP_GET}))if(!o.renamed)y.modalDialog({title:U.DLG_ERROR_SHARING_BP_TITLE,text:U.ERR_MUST_NAME_BP,buttons:{ok:null}})
else if(window.FBInstant)C(s)
else E(U.DLG_SHARE_BP_TITLE,m()+"blueprint/"+s)
if(window.FBInstant&&button({disabled:Y,text:U.BTN_SHARE,tooltip:U.TLTP_LINK_BP_SHARE}))N(s)
if(o.isMyBlueprint()&&p.DEBUG)if(button({text:"Export",tooltip:"Get a OBJ file from your blueprint"}))L(o)}if(d&&x(s)&&!(j()&&W()))if(button({text:U.BTN_SHOW_IN_BUILD_MENU,tooltip:U.TLTP_SHOW_BP_IN_BUILD_MENU})){F.init(F.BUILD)
R(s,T)}return r+=_+V}},{"../common/blueprint_common":192,"../common/ids":198,"../glov/client/cmds":244,"../glov/client/engine":250,"../glov/client/environments":254,"../glov/client/input":271,"../glov/client/ui":306,"../glov/common/util":330,"./analytics":5,"./bluebox_ui":23,"./blueprint":24,"./build_menu":26,"./fbinstant_worlds":80,"./item_info_view":97,"./items":98,"./localization/localization":108,"./main":112,"./menu":117,"./quickbar":142,"./world_comm":182}],26:[function(e,t,r){"use strict"
r.getBuildMenuSubPage=getBuildMenuSubPage
r.blueprintInLibrary=blueprintInLibrary
r.blueprintMetaName=blueprintMetaName
r.blueprintLastPublishedID=blueprintLastPublishedID
r.buildMenuRemoveBlueprint=buildMenuRemoveBlueprint
r.buildMenuRenameBlueprint=buildMenuRenameBlueprint
r.updateUserBlueprints=updateUserBlueprints
r.updateBlueprintMetadata=updateBlueprintMetadata
r.dynamicAddBlueprint=dynamicAddBlueprint
r.blueprintAddToLibrary=blueprintAddToLibrary
r.blueprintAddToLibraryOrSelect=blueprintAddToLibraryOrSelect
r.buildMenuInit=buildMenuInit
r.deselect=deselect
r.buildMenuStartup=buildMenuStartup
r.doBuildEarly=doBuildEarly
r.doBuild=doBuild
r.SUB_SEARCH=r.SUB_BLUEPRINTS=r.SUB_TOOLS=r.SUB_SETTLEMENT=r.SUB_PROPS=r.SUB_BRICKS=r.SUB_BLOCKS=void 0
var a,i
var I=0
r.SUB_BLOCKS=I
var S=1
r.SUB_BRICKS=S
var A=2
r.SUB_PROPS=A
var w=3
r.SUB_SETTLEMENT=w
var de=4
r.SUB_TOOLS=de
var fe=5
r.SUB_BLUEPRINTS=fe
var ve=6
r.SUB_SEARCH=ve
var L=e("assert")
var R=e("../glov/client/camera2d.js")
var o=e("../glov/client/cmds.js").cmd_parse
var x=e("../glov/client/engine.js")
var he=e("../glov/client/input.js")
var n=e("../glov/client/net.js").netSubs
var pe=e("../glov/client/scroll_area.js").scrollAreaCreate
var me=e("../glov/client/settings.js")
var s=e("../glov/client/sprites.js")
var ge=s.spriteClipPause
var Ee=s.spriteClipResume
var ye=e("../glov/client/ui.js")
var Te=e("../glov/client/ui.js").buttonWasFocused
var Ie=e("../glov/common/util.js").defaults
var l=e("../glov/common/vmath.js").vec2
var c=e("../common/ids")
var O=c.ITEM_ACCESS_CONTROL
var b=c.ITEM_ANVIL
var N=c.ITEM_BED
var C=c.ITEM_BENCH
var M=c.ITEM_BERRY_BUSH_BLUE
var D=c.ITEM_BERRY_BUSH_RED
var P=c.ITEM_BERRY_BUSH_YELLOW
var _=c.ITEM_BLUEPRINT
var k=c.ITEM_BONFIRE
var B=c.ITEM_BONFIRE_METAL
var U=c.ITEM_BUCKET
var G=c.ITEM_BUZZERGOAL
var F=c.ITEM_BUZZERSTART
var W=c.ITEM_CAMPFIRE
var j=c.ITEM_CHAIR
var H=c.ITEM_CHEST_MEDIUM
var z=c.ITEM_CHEST_SMALL
var V=c.ITEM_CHEST_TALL
var Y=c.ITEM_CHEST_TINY
var q=c.ITEM_COAL
var K=c.ITEM_DOOR
var X=c.ITEM_DOOR_DOUBLE
var Se=c.ITEM_ENERGY_WELL
var Q=c.ITEM_FACTORY_DEBUG
var J=c.ITEM_FENCE
var $=c.ITEM_FLOWERPOT
var ee=c.ITEM_FURNACE_GLASS
var te=c.ITEM_FURNACE_ORE
var re=c.ITEM_GEM
var ae=c.ITEM_HOE
var ie=c.ITEM_INGOT
var oe=c.ITEM_JUICER
var ne=c.ITEM_KILN
var se=c.ITEM_LADDER
var le=c.ITEM_LANTERN
var ce=c.ITEM_LEAPGATE
var _e=c.ITEM_LEAPGATE_SHARD
var ue=c.ITEM_LIGHT_CUBE
var Ae=c.ITEM_MILL
var we=c.ITEM_ORE
var Le=c.ITEM_OVEN
var Re=c.ITEM_PAINT_MIXER
var xe=c.ITEM_PARTICLE_DEBUGGER
var Oe=c.ITEM_PLANT
var be=c.ITEM_ROD
var Ne=c.ITEM_RUG
var Ce=c.ITEM_SAWMILL
var Me=c.ITEM_SEASHELL
var De=c.ITEM_SEEDS_CARROT
var Pe=c.ITEM_SEEDS_CORN
var ke=c.ITEM_SEEDS_PUMPKIN
var Be=c.ITEM_SEEDS_SUGAR_CANE
var Ue=c.ITEM_SEEDS_TOMATO
var Ge=c.ITEM_SEEDS_WHEAT
var Fe=c.ITEM_SHELF
var We=c.ITEM_SIGNBOARD
var je=c.ITEM_SIGNPOST
var He=c.ITEM_SPICE_PLANT
var ze=c.ITEM_STARFISH
var Ve=c.ITEM_STEPS
var Ye=c.ITEM_STONECUTTER_SIMPLE
var qe=c.ITEM_TABLE_LARGE
var Ke=c.ITEM_TABLE_SMALL
var Ze=c.ITEM_TEST00
var Xe=c.ITEM_TOOL_HEAD_CAST
var Qe=c.ITEM_TORCH
var Je=c.ITEM_VEINIUM_GRINDER
var $e=c.ITEM_WATERING_SYSTEM
var et=c.ITEM_WAYGATE
var tt=c.ITEM_WILD_CROP
var rt=c.ITEM_WINDOW_LARGE
var at=c.ITEM_WINDOW_MEDIUM
var it=c.ITEM_WINDOW_SMALL
var ot=c.ITEM_WORKBENCH
var nt=c.TYPE_BLOCK
var st=c.TYPE_ITEM
var lt=e("../common/materials_common").Mat
var ct=e("../common/world_constants.js").ATTRIB_FIXED_MAX
var u=e("./analytics.js").logEvent
var d=e("./app_access.js").accessAllowNewArt
var f=e("./blueprint.js")
var v=f.TYPE_EDITABLE
var _t=f.blueprintGetDef
var ut=e("./build_mode.js")
var h=e("./flora_constants.js")
var dt=h.DEBUG_FLOWERS
var ft=h.FLOWERS
var vt=h.WILD_CROP_TO_CROP
var p=e("./inventory.js")
var m=p.INV_PLAYER
var ht=p.countAvailable
var g=p.inventoryGet
var E=p.inventoryGetSize
var y=p.inventoryGetVer
var T=e("./inventory_ui.js")
var pt=T.inventoryButton
var mt=T.setMouseoverItem
var gt=T.setSelectedItem
var Et=e("./item_info_view.js")
var yt=Et.ITEM_INFO_VIEW_W
var Tt=Et.itemInfoViewClear
var It=Et.itemInfoViewShow
var St=Et.itemInfoViewing
var At=e("./items.js")
var wt=At.ITEM_CONTEXT_BUILD
var Lt=At.createItem
var Rt=At.itemIsAccountLocked
var xt=At.itemIsAllowedInQuickbar
var Ot=At.itemIsBlueprint
var bt=At.itemIsSettlementLocked
var Nt=At.sameItem
var Ct=e("./layout.js")
var Mt=Ct.WIDE
var Dt=Ct.layoutCameraTallWide
var Pt=Ct.layoutCameraTallWideMode
var kt=e("./localization/localization").L
var Bt=e("./main.js")
var Ut=Math.floor,Gt=Math.max,Ft=Math.min
var Wt=e("./menu.js")
var jt=e("./menu.js")
var Ht=jt.menuPanelX0
var zt=jt.menuX1
var Vt=jt.menuY1
var Yt=e("./quickbar.js")
var qt=e("./settlement.js").settlementCurrent
var Kt=e("./styles.js")
var Zt=Kt.label_style
var Xt=Kt.menu_header_style
var Qt=e("./tiles.js")
var Jt=Qt.TILE_EMPTY
var $t=Qt.TILE_WATER
var er=Qt.tile_map_default
var tr=e("./tiles_ui").TILES_UI_SORT
var rr=e("./ui_util.js")
var ar=e("./user_data.js")
var ir=ar.isWaiting
var or=ar.worldReadOnly
var nr=e("./world_comm.js")
var sr=nr.getPerm
var lr=nr.getWorldID
var cr=nr.myUserCmdParse
var _r=nr.myUserCmdParseWrap
var ur=e("./world_metadata.js")
var dr=ur.adventureMode
var fr=ur.unlimitedMode
var vr=e("./worlds_sound.js").playSound
var hr=I
function getBuildMenuSubPage(){return hr}var pr=230
var mr=8
var gr=false
var Er
var yr=ye.makeColorSet([.65,.78,1,1])
var Tr
var Ir
var Sr=-1
var Ar=null
var wr
var Lr
var Rr
var xr=0
var Or=1
var br=2
var Nr=/[\u2000-\u206F\u2E00-\u2E7F\\'!"#$%&()*+,\-./:;<=>?@[\]^_`{|}~]/g
function stripSearch(e){return e.replace(/\s+/g," ").replace(Nr,"").toLowerCase()}function itemUpdateSearch(e){var t=[e.getBuildName({for_search:true})]
t=t.concat(e.getDesc(true))
e.calced_text=stripSearch(t.join(" "))
e.calced_text_simple=e.calced_text.replace(/ /g,"")}function cmpAlphabetical(e,t){if(e.calced_text_simple<t.calced_text_simple)return-1
else if(e.calced_text_simple>t.calced_text_simple)return 1
L(e.getBID())
L(t.getBID())
return e.blueprint_sort_idx-t.blueprint_sort_idx}var Cr=((a={})[fe]=true,a)
function updateSearch(){var e=[]
for(var t=0;t<ve;++t){var r=wr[t]
for(var a=0;a<r.length;++a){var i=r[a]
if(!i.calced_text)itemUpdateSearch(i)}if(Cr[t])(r=r.slice(0)).sort(cmpAlphabetical)
e=e.concat(r)}var o={}
e=e.filter(function(e){var t=[e.type,e.id,e.attr1||0,e.attr2||0,e.attr3||0].join(",")
if(o[t])return false
return o[t]=true})
wr[ve]=e}function cmpTile(e,t){return(tr[er[e.id].tile_code]||9e9)-(tr[er[t.id].tile_code]||9e9)||e.id-t.id}var Mr=[lt.COPPER,lt.TIN,lt.BRONZE,lt.IRON,lt.SILVER,lt.EMBERYLLIUM,lt.GOLD,lt.BRIGHTSTEEL,lt.COBALT,lt.MYTHRIL,lt.AETHERSTONE,lt.AETHERSTEEL,lt.MUTTAL]
var Dr=((i={})[lt.BRONZE]=true,i[lt.BRIGHTSTEEL]=true,i[lt.AETHERSTEEL]=true,i[lt.MUTTAL]=true,i)
var Pr=0
var kr=1
var Br=2
function shouldShowAll(){return x.defines.NEWART&&d()?Br:x.DEBUG&&!x.defines.NONEWART?kr:Pr}var Ur
function gatherBuildables(){var e=shouldShowAll()
var r=(Ur=e)>=Br
var t=e>=kr
var a=null==wr?void 0:wr[fe]
wr=[]
for(var i=0;i<ve;++i)wr.push([])
if(a)wr[fe]=a
for(var o in er){var n=er[o]
o=Number(o)
if(isFinite(o)&&!n.unplaceable&&(!n.debug_only||t)){var s=Lt({type:nt,id:o})
if(n.crafted)wr[S].push(s)
else wr[I].push(s)}}wr[I].sort(cmpTile)
wr[S].sort(cmpTile)
var l=st
var c=false
var _=A
function add2(e,t,r,a,i,o){var n=Lt({type:l,id:e,attr1:t,attr2:r,attr3:a,attribs:i})
if(c)n.unlimited_only_for_build_menu=true
if(o)n.spot_key=o
wr[_].push(n)}function add(e,t,r){add2(e,t,0,r)}function addWithKey(e,t,r,a){add2(e,r,0,a,void 0,t)}function addEachWood(e,t){add(e,lt.LIGHT_WOOD,t)
add(e,lt.WOOD,t)
add(e,lt.DARK_WOOD,t)
add(e,lt.RED_WOOD,t)}function addEachNewMats(e,t){if(r){add(e,lt.IRON,t)
add(e,lt.STONE,t)
add(e,lt.FANCY_STONE,t)}}function addEachBase(e,t){addEachWood(e,t)
addEachNewMats(e,t)}function addEachColor(e,t){add(e,lt.RED,t)
add(e,lt.ORANGE,t)
add(e,lt.YELLOW,t)
add(e,lt.GREEN,t)
add(e,lt.BLUE,t)
add(e,lt.PURPLE,t)}addEachWood(be)
addEachBase(H)
add(H,lt.WOOD,lt.BLUE)
addEachBase(K,0)
addEachWood(K,1)
addEachBase(X)
addEachBase(se)
add(je)
add(We)
addEachWood(Qe)
addEachBase(le)
addEachBase(ue)
addEachBase(J)
addEachBase(j)
addEachBase(qe)
addEachBase(Ke)
add(F)
add(G)
add(W)
add(re)
add(et)
for(var u=0;u<Mr.length;++u)add(be,Mr[u])
for(var d=0;d<Mr.length;++d)if(!Dr[Mr[d]])add(we,Mr[d])
add(q)
for(var f=0;f<Mr.length;++f)add(ie,Mr[f])
if(r){add($)
addEachBase(Fe)
addEachBase(Y)
addEachBase(z)
addEachBase(V)
addEachBase(Ve)
addEachBase(C)
addEachBase(N)
addEachBase(it)
addEachBase(at)
addEachBase(rt)
add(Ne)}if(r&&x.DEBUG)for(var v=0;v<10;++v)add(Ze+v)
if(t)add(xe)
_=w
add(et)
add(W)
add(Se)
addWithKey(ot,"build_menu_workbench")
add(Ye)
add(Ce)
add(te)
add(Xe)
add(ee)
add(b,lt.IRON)
add(oe)
add(Ae)
add($e)
add(Le)
add(ne)
add(Re)
add(k)
add(B)
add(Je)
if(t)add(Q)
add(O)
if(r){add(ce)
add(_e)}_=de
c=true
add2(ae,lt.IRON,lt.WOOD,0,{hp:ct})
add2(U,lt.WOOD,$t)
add2(U,lt.WOOD,Jt)
add(Pe)
add(Ge)
add(Be)
add(Ue)
add(De)
add(ke)
for(var h=0;h<ft.length;h++)add(Oe,0,ft[h].key[0])
if(t)for(var p=0;p<dt.length;p++)add(Oe,0,dt[p].key[0])
add(D,0,0)
add(M,0,0)
add(P,0,0)
if(r){for(var m=0;m<vt.length;++m)add(tt,0,m)
add(He,0,lt.HOT)
add(He,0,lt.PUNGENT)
add(He,0,lt.SAVORY)}if(t){addEachColor(Me)
add(ze,lt.RED)
add(ze,lt.YELLOW)
add(ze,lt.BLUE)}if(x.DEBUG)for(var g=0;g<ve;++g){var E=wr[g]
for(var y=0;y<E.length;++y){var T=E[y]
if(T.isCrafted())L(T.getCraftCost())
L(xt(T)||T.sysadmin_only)}}updateSearch()}var Gr=0
var Fr=false
var Wr={}
function blueprintInLibrary(e){return Boolean(Wr[e])}function blueprintMetaName(e){var t=Wr[e]
return t&&t.meta_name}function blueprintLastPublishedID(e){var t=Wr[e]
return t&&t.last_publish}function addBlueprint(e,t,r,a){var i=Lt({type:st,id:_,attr1:e})
if(t)i.meta_name=t
if(r)i.last_publish=r
Wr[e]=i
var o=wr[fe]
if(a)if(e[0]===v)o.splice(0,0,i)
else{var n=0
while(n<o.length&&o[n].getBID()[0]===v)++n
o.splice(n,0,i)}else{o.push(i)
Fr=true}updateSearch()
return i}function buildMenuRemoveBlueprint(e){var t=e.getBID()
delete Wr[t]
var r=wr[fe]
for(var a=r.length-1;a>=0;--a)if(r[a].getBID()===t)r.splice(a,1)
Sr=-1
if(!ir()&&lr())Yt.unslot(e)
if(t[0]===v)--Gr
updateSearch()}function buildMenuRenameBlueprint(e,t){var r=wr[fe]
for(var a=r.length-1;a>=0;--a){var i=r[a]
if(i.getBID()===e){i.meta_name=t
itemUpdateSearch(i)}}}function clearUserBlueprints(){wr[fe].length=0
Wr={}
Gr=0}var jr=null
function updateUserBlueprints(){if(!wr)gatherBuildables()
function onBlueprintList(e){clearUserBlueprints()
for(var t in e.edit){var r=e.edit[t]
addBlueprint(t,r.name,r.last_publish);++Gr}for(var a in e.library)addBlueprint(a,e.library[a].name)
updateSearch()}var e=n().loggedIn()
if(e!==jr)if(jr=e)_r("blueprint_list",onBlueprintList)
else clearUserBlueprints()
updateSearch()}function refreshBlueprints(){jr=null
updateUserBlueprints()}function newBlueprintName(){var e=wr[fe]
var t={}
for(var r=0;r<e.length;++r)t[e[r].getBlueprintName()]=true
for(var a=1;;++a){var i=String(kt.addParenthesesAfter(kt.LBL_NEW_BLUEPRINT,a))
if(!t[i])return i}}function updateBlueprintMetadata(e){var t=e.bid
var r=Wr[t]
if(r){Fr=true
itemUpdateSearch(r)}}function autoSelectBlueprint(e){hr=fe
Ar=e}function dynamicAddBlueprint(e,t){if(t){var r=Wr[t]
if(r)r.last_publish=e}var a=addBlueprint(e,void 0,void 0,true)
itemUpdateSearch(a)
if(Bt.main_active&&!or()){Yt.selectByItem(a)
autoSelectBlueprint(a)}}function blueprintAddToLibrary(r,a){if(!(r=r.trim().toUpperCase()))return void a(kt.ERR_MISSING_BLUEPRINT_ID)
cr("blueprint_add "+r,function(e,t){if(!e)dynamicAddBlueprint(r)
a(e,t)})}o.register({cmd:"blueprint_add",help:"Add a public blueprint to your library",func:blueprintAddToLibrary})
function blueprintAddToLibraryOrSelect(e,t){if(!blueprintInLibrary(e))return void blueprintAddToLibrary(e,function(e){t()})
var r=Wr[e]
if(!ir())Yt.selectByItem(r)
autoSelectBlueprint(r)
t()}function searchPrep(e){var t=e.split(" ").filter(function(e){return e})
if(!t.length)return null
var r=[]
var a=0
var i=false
while(a<t.length){var o=t[a++]
if('"'===o[0]){i=true
o=o.slice(1)
while(a<t.length){var n=t[a++]
if('"'===n.slice(-1)){o+=" "+n.slice(0,-1)
break}o+=" "+n}}r.push(stripSearch(o))}r.quoted=i
return r}function searchMatch(e,t){if(1===e.length&&!e.quoted)return-1!==t.calced_text_simple.indexOf(e[0])
var r=t.calced_text
for(var a=0;a<e.length;++a)if(-1===r.indexOf(e[a]))return false
return true}function buildMenuInit(){Sr=-1
Tt()}function deselect(){Sr=-1
Tt()}function buildMenuStartup(){Er=rr.sprite
Lr=ye.font
Rr=ye.title_font
n().onLogin(updateUserBlueprints)
n().on("logout",updateUserBlueprints)
n().onChannelMsg("user","blueprints_need_refresh",refreshBlueprints)
gatherBuildables()}me.register({build_menu_details:{label:"Build Menu Details View",default_value:1,type:o.TYPE_INT,range:[0,1]}})
var Hr
var zr=l()
var Vr=l(24,24)
var Yr
function buildMenuContext(){if(Yr===x.frame_index)return Hr
Yr=x.frame_index
Dt()
var e=Wt.page===Wt.QUICK_SLOT
var t=false
var r=ye.button_height
var a=gr
var i=[]
if(hr===fe)i.push(xr)
if(fr()||hr===de)a=false
else i.push(Or)
if(hr===ve){var o=Tr&&Tr.isFocused()
if(he.touch_mode&&o){R.domDeltaToVirtual(zr,Vr)
r=Gt(r,zr[0])
if(R.w()>3*R.h()){t=true
r*=2}}}i.push(br)
var n=r/ye.button_height
var s=t?R.x0():Ht()
var l=t?R.x1():zt()
var c=0
var _=s+mr
var u=l-_
var d=t?R.y0():ye.button_height
if(c)u-=pr*n
return Hr={do_filter_afford:a,list_row_height:r,list_fullscreen:t,is_quick_slot:e,buttons:i,scale:n,do_selected:c,max_x:l,avail_w:u,x0:s,y0:d,contents_x:_,did_early:false}}function buildMenuTooltip(e){var t=e.tooltip_user_data,r=e.tooltip_clicking_closes,a=e.tooltip_inv
var i=t.is_quick_slot,o=t.details_view
if(i)return o?null:a.getBuildName()
else{var n=o?"":a.getBuildName()+"\n"
var s=he.touch_mode?kt.INPUT_TAP:kt.INPUT_CLICK
var l=he.touch_mode?kt.INPUT_TAP_DOUBLE:kt.INPUT_CLICK_RIGHT
var c=r?kt.TLTP_CLOSE_BUILD_MENU:kt.TLTP_SELECT_IN_QB_AND_VIEW
n+=Wt.prefixShortcutKey(s,c)+"\n"+Wt.prefixShortcutKey(l,kt.TLTP_SELECT_AND_CLOSE_BUID_MENU)
if(!he.touch_mode)n+="\n"+Wt.prefixShortcutKey("2-"+(me.split_build?7:8),kt.TLTP_PLACE_IN_QB)
return n}}var qr=12
var Kr
var Zr=null
var Xr=0
var Qr={}
function showList(e,t,r,a,i,o,n){var s=e.is_quick_slot,l=e.do_filter_afford,c=e.scale
profilerStart("filter")
var _=ye.button_height*c
var u=_
var d=u+qr*c
var f=d
var v=Ut((o-u)/d)+1
var h=hr===ve&&Ir&&searchPrep(Ir)
var p=[]
var m=false
var g=false
for(var E=0;E<t.length;++E){var y=t[E]
var T=false
if(h&&!searchMatch(h,y))T=true
if(!T&&(y.unlimited_only||y.unlimited_only_for_build_menu)&&!fr())T=true
if(!T&&Rt(y))T=true
if(!T&&y.sysadmin_only&&!sr("sysadmin"))T=true
if(!T&&y.is_settlement_locked){var I=bt(y)
if(1===I)m=true
else if(2===I)T=m=true}if(!T&&l)if(!ht(y))if(Ot(y)){var S=_t(y.getBID())
if(S&&!S.loaded);else g=T=true}else g=T=true
if(!T)p.push(E)}var A=[]
for(var w=0;w<p.length;++w){var L=p[w]
var R=t[L]
A[L]=ht(R)}if(!fr())p.sort(function(e,t){if(A[e]){if(!A[t])return-1}else if(A[t])return 1
return e-t})
if(!Kr)Kr=pe({z:Z.UI,background_color:null,auto_hide:false,no_disable:true,min_dist:ut.MIN_DRAG_DISTANCE})
var x=Ut(v/3)
var O=me.build_menu_details
if(O)d=(u=(o-(v=x)*qr*c-Kr.barWidth())/v)+qr*c
if(Ar){var b=t.indexOf(Ar)
if(-1!==b){Sr=b
var N=p.indexOf(b)
if(-1!==N){var C=Ut(N/v)
Kr.scrollIntoFocus(C*f,(C+1)*f,n)}}}var M=!he.touch_mode&&!s
var D={x:r,y:a,z:i,w:o,h:n}
Kr.begin(D)
r=a=0
var P={is_quick_slot:s,details_view:O}
profilerStopStart("show")
var k=0
var B=0
for(var U=0;U<p.length;++U){var G=p[U]
var F=t[G]
var W=Sr===G
var j=A[G]
if(W)gt(F)
if(k>=v){k=0
B++}var H=r+k*d
var z=a+B*f
k++
if(z+f<Kr.getScrollPos()||z>Kr.getScrollPos()+D.h)continue
var V=F.spot_key||U
var Y=Qr[V]
if(!Y)Y=Qr[V]={drag_over:true,dynamic_snapshot_on_mouseover:true,tooltip:buildMenuTooltip,key:F.spot_key||void 0}
Y.tooltip_user_data=P
Y.tooltip_inv=F
Y.x=H
Y.y=z
Y.z=i+2
Y.w=u
Y.h=_
Y.left_align=O
delete Y.count_override
var q=void 0
if(Ot(F))if(!(q=_t(F.getBID())).loaded||q.error)Y.count_override=q.error?kt.LBL_ERROR.lower():kt.MSG_LOADING.lower()
if(fr()){Y.hide_count=true
Y.auto_count=false}else{Y.hide_count=false
Y.auto_count=true}if(s)Y.in_event_cb=he.pointerLockEnter
else Y.in_event_cb=void 0
if(M){var K=Y.drag_param
if(!K){(K=Y.drag_param={}).min_dist=ut.MIN_DRAG_DISTANCE
K.button=0}K.x=Y.x
K.y=Y.y
K.w=Y.w
K.h=Y.h
K.payload=F
var X=he.drag(K)
if(X){var Q=Ie({disabled:true,x:X.cur_pos[0]-_/2,y:X.cur_pos[1]-Y.h/2,z:Z.DRAG,w:_,base_name:"inv_active",draw_only:true,dynamic_snapshot_on_mouseover:false,dynamic_snapshot:false},Y)
ge()
pt(Q,F)
Ee()
Sr=G}}Y.base_name=W?"inv_selected":j?"inv_active":"inv_empty"
if(q&&q.isEditable()&&"inv_selected"!==Y.base_name)Y.colors=yr
else Y.colors=void 0
var J=W&&St(F,wt)
Y.tooltip_clicking_closes=J
if(F.is_settlement_locked&&dr()&&F.id!==Se)Y.hook="w_b_"+F.id
else Y.hook=void 0
if(!he.touch_mode&&!s){Y.in_event_cb=he.pointerLockEnter
if(J){Y.button=0
if(he.click(Y)){vr("button_click")
Bt.menuExit()}delete Y.phys}Y.button=2
if(he.click(Y)){vr("button_click")
Yt.selectByItem(F)
Bt.menuExit()}delete Y.button
delete Y.in_event_cb}if(pt(Y,F))if(s){Yt.setQuickItem(F)
Bt.menuExit()}else if(J)Bt.menuExit()
else{Yt.selectByItem(F)
Zr=F
Xr=Y.x+Y.w
if(he.touch_mode&&ye.button_click&&ye.button_click.was_double_click){Zr=null
Bt.menuExit()}if(Sr===G&&St(F,wt))deselect()
else Sr=G}if(Te())mt(F)
if(O){var $=H+_
Lr.drawSizedAligned(Zt,$,z,i+4,24*c,Lr.ALIGN.HFIT|Lr.ALIGN.VCENTER,H+u-$-8,_,F.getBuildName())}}var ee=a+ ++B*f
if(!p.length){var te=n/3
Lr.drawSizedAligned(Zt,r,a,i,ye.font_height*c*2,Lr.ALIGN.HVCENTER,o,te,g?kt.BUILDMENU_NOTHING_AFFORDABLE:m&&!qt()?kt.MSG_OUT_OF_SETTLEMENT_ALERT:hr===fe?kt.BUILDMENU_NO_BP_AVAILABLE:hr===de?kt.BUILDMENU_NO_TOOLS_OR_CONSUMABLES:kt.BUILDMENU_ITEM_NOT_FOUND)
ee+=.5*te}var re
if(m&&hr!==ve)if(!qt())re=[kt.MSG_OUT_OF_SETTLEMENT_ALERT]
else re=[kt.BUILDMENU_UNLOCK_SCHEMATICS]
if(hr===fe&&t.length<4)re=[kt.BUILDMENU_HINT_NEW_BP_MSG_CREATE,kt.BUILDMENU_HINT_NEW_BP_MSG_START]
if(hr===de&&t.length<6)re=[kt.BUILDMENU_HINT_CRAFT_TOOLS_AND_CONSUMABLES]
if(re){var ae=600
var ie=24
var oe=r+(o-ae)/2
var ne=ee+=f/2
var se=ye.font_height*c*2
var le=(f-se)/2
ee+=le
for(var ce=0;ce<re.length;++ce)ee+=Lr.drawSizedAligned(Zt,oe,ee,i+1,se,Lr.ALIGN.HCENTER|Lr.ALIGN.HWRAP,ae,0,re[ce])
ye.panel({x:oe-ie,y:ne,z:i,w:ae+2*ie,h:(ee+=le)-ne,color:Wt.hint_color,sprite:ye.sprites.hint_panel})}Kr.end(ee)
if(1===p.length&&hr===ve){var _e=p[0]
var ue=t[_e]
if(!Yt.getSelected()||!Nt(Yt.getSelected(),ue)){Yt.selectByItem(ue)
Zr=ue
Xr=r
Sr=_e}}Ar=null
profilerStop()}var Jr=120
var $r=48
var ea=8
var ta=0
function doBuildEarly(){Dt()
var e=buildMenuContext()
var t=e.list_fullscreen,r=e.list_row_height,a=e.scale,i=e.avail_w,o=e.contents_x,n=e.buttons
e.did_early=true
if(hr===ve){var s=ye.button_height
var l=Tr&&Tr.isFocused()
if(t)s=R.y0()
if(!Tr)Tr=ye.createEditBox({placeholder:kt.LBL_SEARCH_ALL,initial_select:true,auto_unfocus:true,max_len:40,text:"",spellcheck:false})
var c=s
var _=2*ye.font_height
var u=300
if(he.touch_mode){_=r
u=Ft(l?10*_:400,i-(Jr*a+ea)*n.length-2*mr)}u=Ft(u,i-mr)
var d=Tr.run({x:t?0:o,y:c,w:u,font_height:_,initial_focus:!he.touch_mode,pointer_lock:!he.touch_mode})
if(d===Tr.SUBMIT)Tr.unfocus()
else if(d===Tr.CANCEL)Bt.menuExit()
ta=c+_+12}if(t)doBuild(true)}function cmpBlueprint(e,t){var r=e.getBID()
var a=t.getBID()
if(r[0]!==a[0])if(r[0]===v)return-1
else return 1
var i=_t(r)
if(i&&!i.loaded)i=null
var o=_t(a)
if(o&&!o.loaded)o=null
if(!i){if(!o)return r<a?-1:1
return 1}else if(!o)return-1
return o.modified-i.modified||(r<a?-1:1)}function sortBlueprints(){var e=wr[fe]
e.sort(cmpBlueprint)
for(var t=0;t<e.length;++t)e[t].blueprint_sort_idx=t}var ra=false
function newBlueprint(){var e=sr("max_blueprints")
if(Gr>=e){u("blueprint_new_fail",1,"button",null,{num:Gr,quota:e})
ye.modalDialog({title:kt.DLG_QUOTA_EXCEEDED_TITLE,text:kt.$(kt.DLG_QUOTA_EXCEEDED_MSG,sr("max_blueprints")),buttons:{OK:null}})}else{u("blueprint_new",1,"button",null,{num:Gr,quota:e})
var i=newBlueprintName()
if(!Bt.omp);else{ra=true
var t=lr()
cr("blueprint_create "+t+" "+i,function(e,t){ra=false
var r=t&&t.blueprint_id
if(r){var a=addBlueprint(r,i,void 0,true);++Gr
itemUpdateSearch(a)
if(!ir()&&lr())Yt.selectByItem(a)
autoSelectBlueprint(a)
Bt.menuExit()}else{e=e||kt.CHATERROR_EMPTY_RESPONSE
Bt.chat_ui.addChatError(e)
he.pointerLockExit()}})}}}var aa=[]
var ia
function gatherToolsList(){var e=y(m)
if(e===ia)return aa
var t=E(m)
var r=0
e:for(var a=0;a<t;++a){var i=g(a)
if(i&&i.showOnToolPage()){if(i.has_hp){if(!i.hp_cur)continue;(i=Lt(i)).hp_cur=i.hp_max}for(var o=0;o<r;++o)if(Nt(aa[o],i,"hp"))continue e
aa[r++]=i}}aa.length=r
ia=e
return aa}function doBuild(e){profilerStart("doBuild")
profilerStart("top")
var t=buildMenuContext()
var r=t.list_fullscreen,a=t.list_row_height,s=t.scale,l=t.buttons,i=t.max_x,c=t.avail_w,o=t.x0,_=t.y0,u=t.contents_x
if(!t.did_early)doBuildEarly()
if(r&&true!==e){profilerStop()
profilerStop("doBuild")
return}if(Ur!==shouldShowAll())gatherBuildables()
if(Fr){Fr=false
sortBlueprints()
updateSearch()}var d=Z.UI+15
var f=o-ye.button_height
var v=_
function tabButton(e,t,r,a,i,o){var n=hr===e
if(ye.buttonImage({x:f-4,y:v,z:n?d:d-20,z_bias:n?null:{down:20},shrink:o||.7,img:Er,frame:t,colors:n?Wt.tab_colors_selected:Wt.tab_colors_unselected,disabled:false,base_name:n?"tab_horiz":"tab_inactive",tooltip:r,drag_over:true,reddot_pos:"upper_left",hook:i,key:"build_menu_tab_"+e})){if(!n&&Kr)Kr.resetScroll()
if(e<hr)n=true
hr=e
Sr=-1
Tt()}v+=ye.button_height
if(n&&!a)Rr.drawSizedAligned(Xt,u,_+mr,d,$r*s,Lr.ALIGN.HFIT,c-(Jr*s+ea)*l.length,0,r)}if(!r){v+=.25*ye.button_height
tabButton(I,rr.RAW_BLOCKS,kt.LBL_RAW_BLOCKS)
tabButton(S,rr.CRAFTED_BLOCKS,kt.LBL_CRAFTED_BLOCKS)
tabButton(A,rr.PROPS,kt.LBL_PROPS)
tabButton(w,rr.SETTLEMENT_PROPS,kt.LBL_SETTLEMENT,false,"new_build_settlement")
tabButton(de,rr.TAB_TOOLS,fr()?kt.LBL_TOOLS_AND_FARMING:kt.LBL_TOOLS_AND_CONSUMABLES,false,void 0,.8)
tabButton(fe,rr.BLUEPRINTS,kt.addParenthesesAfter(kt.LBL_BLUEPRINTS,kt.$(kt.FORMAT_FRACTION,Gr,sr("max_blueprints"))))
v+=.5*ye.button_height
tabButton(ve,rr.SEARCH,kt.LBL_SEARCH_ALL,true)}f=u
var n=Vt()
if(r)n=R.y1()
var h=u+c
var p={y:v=_,z:d,w:Jr*s,h:a,font_height:ye.font_height*s}
h-=l.length*(p.w+ea)
for(var m=0;m<l.length;++m){switch(l[m]){case xr:if(ye.buttonText(Ie({x:h,text:ra?kt.BTN_ALLOCATING:kt.BTN_NEW_BP,disabled:ra,in_event_cb:!he.touch_mode?he.pointerLockEnter:null},p)))newBlueprint()
break
case Or:if(ye.buttonText(Ie({x:h,text:gr?kt.BTN_AFFORDABLE_ITEMS:kt.BTN_ALL_ITEMS},p)))gr=!gr
break
case br:if(ye.buttonText(Ie({x:h,text:me.build_menu_details?kt.BTN_DETAILS:kt.BTN_ICONS},p)))me.set("build_menu_details",1-me.build_menu_details)
break
default:L(0)}h+=p.w+ea}var g=v+p.h+ea
if(hr===ve)if(Tr){Ir=Tr.getText()
g=Gt(g,ta)}var E=wr[hr]
if(hr===de&&!fr())E=gatherToolsList()
var y=n-g-mr
Zr=null
profilerStopStart("showList")
showList(t,E,f,g,d,c,y)
profilerStop()
if(r){ye.panel({x:R.x0Real(),y:_,z:d-1,w:R.wReal(),h:n-_,color:Wt.panel_color,pixel_scale:ye.button_height/256})
Tt()}if(Zr){var T=i-yt+50
if(Xr+150>T)T=Pt()===Mt?100:mr
It({x:T,y:200,inv:Zr,auto_close:false,context:wt})}profilerStop("doBuild")}},{"../common/ids":198,"../common/materials_common":201,"../common/world_constants.js":212,"../glov/client/camera2d.js":241,"../glov/client/cmds.js":244,"../glov/client/engine.js":250,"../glov/client/input.js":271,"../glov/client/net.js":279,"../glov/client/scroll_area.js":289,"../glov/client/settings.js":291,"../glov/client/sprites.js":302,"../glov/client/ui.js":306,"../glov/common/util.js":330,"../glov/common/vmath.js":332,"./analytics.js":5,"./app_access.js":11,"./blueprint.js":24,"./build_mode.js":27,"./flora_constants.js":85,"./inventory.js":94,"./inventory_ui.js":95,"./item_info_view.js":97,"./items.js":98,"./layout.js":99,"./localization/localization":108,"./main.js":112,"./menu.js":117,"./quickbar.js":142,"./settlement.js":148,"./styles.js":160,"./tiles.js":162,"./tiles_ui":164,"./ui_util.js":168,"./user_data.js":170,"./world_comm.js":182,"./world_metadata.js":186,"./worlds_sound.js":187,assert:void 0}],27:[function(e,t,r){"use strict"
r.unlimitedMode=unlimitedMode
r.doStamina=doStamina
r.startup=startup
r.doingDragPlace=doingDragPlace
r.shift=shift
r.tempPoint=tempPoint
r.tempMat=tempMat
r.tempColorFade=tempColorFade
r.oreFromLocalPos=oreFromLocalPos
r.applyDigProgress=applyDigProgress
r.isEmptyOrBag=isEmptyOrBag
r.addToBagSplatter=addToBagSplatter
r.protectBlock=protectBlock
r.protectBlockIdx=protectBlockIdx
r.tileMaterial=tileMaterial
r.playSoundForMaterial=playSoundForMaterial
r.checkStaminaBeforeAction=checkStaminaBeforeAction
r.drawUtilVoxel=drawUtilVoxel
r.interactDetails=interactDetails
r.interactableProp=interactableProp
r.undergroundFactors=undergroundFactors
r.tickBuildModeInactive=tickBuildModeInactive
r.mouseMoveFadeReset=mouseMoveFadeReset
r.tempPointReset=tempPointReset
r.doPointerLockTop=doPointerLockTop
r.doPointerLockBottom=doPointerLockBottom
r.pointerLockJustEntered=pointerLockJustEntered
r.suppressQueuedPlaceCancel=suppressQueuedPlaceCancel
r.cancelDragPlace=cancelDragPlace
r.tickBuildMode=tickBuildMode
r.reset=reset
r.tex_voxel_util=r.color_prop_blocked=r.MAX_INTERACT_DIST_CHECK_SQ=r.MAX_INTERACT_DIST=r.MIN_DRAG_DISTANCE=r.VU_TILE_RETICULE_WATER=r.VU_TILE_RETICULE_DIG=r.VU_TILE_DIG_PROGRESS=r.VU_TILE_BRUSHSIZE3=r.VU_TILE_BRUSHSIZE2=r.VU_TILE_BOX=r.VU_TILE_ERROR=void 0
var b=0
r.VU_TILE_ERROR=b
var G=1
r.VU_TILE_BOX=G
var N=2
r.VU_TILE_BRUSHSIZE2=N
var a=3
r.VU_TILE_BRUSHSIZE3=a
var T=4
r.VU_TILE_DIG_PROGRESS=T
var n=9
r.VU_TILE_RETICULE_DIG=n
var C=10
r.VU_TILE_RETICULE_WATER=C
var i=20
var o=11
var M=160
var D=20
var s=20
r.MIN_DRAG_DISTANCE=s
var P=32
var l=11
var c=Math.max(l,i)
var _=((r.MAX_INTERACT_DIST=c)+5)*(c+5)
r.MAX_INTERACT_DIST_CHECK_SQ=_
var u=200
var d=100
var I=1500
var F=e("assert")
var W=e("gl-mat4/invert")
var j=e("../glov/client/camera2d")
var f=e("../glov/client/cmds").cmd_parse
var H=e("../glov/client/engine")
var z=e("../glov/client/input")
var v=e("../glov/client/input").mouseDownAnywhere
var S=e("../glov/client/net").netDisconnected
var V=e("../glov/client/settings")
var h=e("../glov/client/spot").spotUnfocus
var p=e("../glov/client/textures")
var Y=e("../glov/client/ui")
var q=e("../glov/client/ui.js").buttonWasFocused
var m=e("../glov/common/util")
var k=m.clamp
var g=m.defaults
var E=m.easeOut
var y=m.nop
var A=m.ridx
var w=e("../glov/common/verify")
var L=e("../glov/common/vmath")
var B=L.half_vec
var R=L.mat4
var K=L.unit_vec
var X=L.v2addScale
var Q=L.v2copy
var x=L.v2same
var J=L.v2set
var U=L.v3add
var $=L.v3addScale
var ee=L.v3copy
var te=L.v3distSq
var O=L.v3dot
var re=L.v3floor
var ae=L.v3iAdd
var ie=L.v3iFloor
var oe=L.v3iNormalize
var ne=L.v3mulMat4
var se=L.v3same
var le=L.v3sub
var ce=L.v4copy
var _e=L.v4set
var ue=L.vec2
var de=L.vec3
var fe=L.vec4
var ve=L.xaxis
var he=L.yaxis
var pe=L.zaxis
var me=e("../common/entity_worlds_common").EntityType
var ge=e("../common/globals")
var Ee=ge.CHUNK_SIZE
var ye=ge.ID_FACTOR
var Te=e("../common/ids")
var Ie=Te.ITEM_BAG
var Se=Te.ITEM_BLUEPRINT
var Ae=Te.ITEM_DOWSER_ADVANCED
var we=Te.ITEM_DOWSER_SIMPLE
var Le=Te.ITEM_HANDSTOOL
var Re=Te.ITEM_HOE
var xe=Te.ITEM_ORE
var Oe=Te.ITEM_WAYGATE
var be=Te.TYPE_BLOCK
var Ne=Te.TYPE_ITEM
var Ce=e("../common/materials_common").Mat
var Me=e("../common/megachunk_common")
var De=e("../common/voxel_data_common")
var Pe=De.ANIM_STYLE_BEAM
var ke=De.ANIM_TYPE_PLAYER
var Be=De.ANIM_TYPE_POS
var Ue=e("../common/world_constants").WORLD_DIG_MAX_CLIENTS
var Ge=e("../common/world_trans").encodeChunkPos
var Fe=e("./analytics").logEvent
var We=e("./bluebox_edit_list").blueboxEditListCheck
var je=e("./bluebox_ui")
var He=je.blueboxAutoSelect
var ze=je.blueboxShowPreview
var Ve=je.tickBlueboxUI
var Ye=e("./blueprint").STATE_PRE_EDIT
var qe=e("./build_menu").blueprintInLibrary
var Ke=e("./camera")
var Ze=Ke.getCurrentCameraPos
var Xe=Ke.getCurrentCameraTargetDir
var Qe=Ke.getCurrentViewMatrix
var Je=e("./client_entities").getEntityManager
var $e=e("./debug")
var et=e("./dowser_simple").simpleDowserStartup
var tt=e("./dowser_ui").dowserUI
var rt=e("./draw_line3d").drawLine3D
var at=e("./editvolume_client")
var it=at.editVolumeShift
var ot=at.inEditBounds
var nt=at.settlementEstablishAllowed
var st=at.updateEditVolumes
var lt=e("./inventory")
var ct=e("./inventory")
var _t=ct.INV_EQUIP
var ut=ct.INV_PLAYER
var dt=ct.countAvailable
var ft=ct.findAvailableEx
var vt=ct.inventoryGetAccountMapped
var ht=ct.inventoryGetMaterialCostMapped
var pt=ct.inventoryTransHPMod
var mt=ct.payCostEx
var gt=ct.transInvDec
var Et=ct.undoTransactionOp
var yt=e("./items")
var Tt=yt.ITEM_CONTEXT_BUILD
var It=yt.createItem
var St=yt.isItem
var At=yt.itemIsAllowedInQuickbar
var wt=yt.itemIsPlaceable
var Lt=yt.itemIsSettlementLocked
var Rt=yt.sameItem
var xt=e("./layout")
var Ot=xt.layoutCameraFull
var bt=xt.menuUpperLeft
var Nt=xt.quickbarOnTop
var Ct=e("./line3d").lineLineDist
var Mt=e("./localization/localization").L
var Dt=e("./main")
var Pt=e("./materials")
var kt=Pt.MATERIAL_CLASS
var Bt=Pt.MATERIAL_CLASS_SOUND
var Ut=Pt.MATERIAL_DIG_RATE
var Gt=Pt.MATERIAL_DURABILITY_COST
var Ft=Pt.MATERIAL_NAME
var Wt=Pt.MATERIAL_SOUND
var jt=Pt.MATERIAL_TIER
var Ht=Pt.MATERIAL_TO_MINE_MATERIAL
var zt=Pt.MATERIAL_TO_MINE_STONE_TIER
var Vt=Pt.MaterialClass
var Yt=Pt.STAMINA_BY_MATERIAL
var qt=Pt.STAMINA_BY_MATERIAL_CLASS
var Kt=e("./megachunk_client")
var Zt=e("./megachunk_client").megachunkResubscribing
var Xt=e("./mobs")
var Qt=Xt.placePrevented
var Jt=Xt.playerToolAnim
var $t=e("./particle_system").createDetachedParticlesFromList
var er=e("./proc_gen")
var tr=er.oreFromChunkPos
var rr=er.stoneTierFromPos
var ar=e("./proc_gen_biomes").getElevationEstimate
var ir=e("./proc_gen_debug")
var or=ir.fmt
var nr=ir.hexomeDebug
var sr=e("./props")
var lr=e("./props").PIEB_CHECK_CUR_SIZE
var cr=e("./quickbar")
var _r=e("./quickbar")
var ur=_r.bucketFill
var dr=_r.bucketSelected
var fr=_r.consumableSelected
var vr=_r.consumeSelected
var hr=_r.consumeSelectedBucket
var pr=_r.getCurrentBrushSize
var mr=_r.getCurrentModeMappedProp
var gr=_r.getSelectedGatherTool
var Er=_r.getSelectedIfOwned
var yr=_r.payCostSelected
var Tr=_r.selectedIsFlipped
var Ir=e("./status")
var Sr=e("./stone_tiers")
var Ar=Sr.STONE_TIER_NAMES
var wr=Sr.STONE_TIER_SCALAR
var Lr=e("./tiles")
var Rr=Lr.DIG_RATE_DEFAULT
var xr=Lr.DIG_RATE_PROP
var Or=Lr.TILE_DIRT
var br=Lr.TILE_EMPTY
var Nr=Lr.TILE_GRASS
var Cr=Lr.TILE_PROP_BASE
var Mr=Lr.TILE_PROP_MAX
var Dr=Lr.TILE_PROP_PENDING
var Pr=Lr.TILE_TILLED
var kr=Lr.TILE_TILLED_WATERED
var Br=Lr.TILE_UNDIGABLE
var Ur=Lr.TILE_WATER
var Gr=Lr.TILE_WATER_FLOW
var Fr=Lr.tile_code_name
var Wr=Lr.tile_map_default
var jr=Lr.tile_name_block
var Hr=e("./todo_list").todoDone
var zr=e("./tutorial").tutorialHook
var Vr=e("./ui_util")
var Yr=e("./ui_util").getUIUtilSprite
var qr=e("./user_data")
var Kr=qr.blueprintAllowed
var Zr=qr.shouldHaveAvatar
var Xr=qr.staminaUsageScale
var Qr=qr.userAttribGetDigRate
var Jr=qr.userDataGet
var $r=qr.userDataIsWaiting
var ea=qr.userDataPredict
var ta=qr.userStaminaCur
var ra=qr.userStaminaMod
var aa=qr.worldReadOnly
var ia=e("./voxel_data")
var oa=e("./voxel_data")
var na=oa.chunkIdFromLocalIntPos
var sa=oa.getPropLighting
var la=oa.liquidUpdateDefer
var ca=oa.propInWorld
var _a=oa.transItemAnim
var ua=oa.transSetPropLocal
var da=oa.transSetTileLocal
var fa=oa.worldPosFromLocalPos
var va=e("./voxel_gen").voxelGenGetDetailDebugData
var ha=e("./voxel_mesh").voxelMeshGetZMapDebugData
var pa=e("./world_claims").CLAIM_NAME
var ma=e("./world_comm")
var ga=ma.getPerm
var Ea=ma.getWorldID
var ya=ma.worldGetRoles
var Ta=ma.worldPak
var Ia=ma.worldSetUserData
var Sa=e("./world_metadata")
var Aa=e("./world_metadata")
var wa=Aa.adventureMode
var La=Aa.worldSeed
var Ra=Aa.worldToolLock
var xa=e("./worlds_sound").playSound
var Oa=e("./worlds_soundscape")
var ba=Oa.SoundScapeEventMod
var Na=Oa.logSSEventModState
var Ca=Math.ceil,Ma=Math.cos,Da=Math.floor,Pa=Math.max,ka=Math.min,Ba=Math.random,Ua=Math.round,Ga=Math.sin,Fa=Math.sqrt
var Wa=de()
var ja=de()
var Ha=de()
var za=fe(1,1,1,.25)
var Va=fe(1,1,1,.5)
var Ya
var qa=fe(1,1,1,1)
var Ka=fe(0,0,0,1)
var Za=fe(1,1,1,1)
var Xa=fe(0,0,0,1)
var Qa=fe(0,1,.5,1)
var Ja=fe(1,1,1,.5)
var $a=fe(.5,0,0,1)
var ei=fe(0,0,0,1)
var ti=fe(1,0,0,1)
r.color_prop_blocked=ti
var ri
r.tex_voxel_util=ri
var ai
var ii
var oi=false
var ni=null
var si=1
var li=50
var ci=500
var _i=50
var ui=250
var di=40
var fi=0
var vi=250
var hi=250
var pi=250
var mi=300
var gi=.05
var Ei=.15
var yi=.75
var Ti=1/2e3
var Ii=50
var Si=[50,250]
var Ai=.2
var wi=100
var Li=0
var Ri=-28
var xi=-.01
var Oi=-.01
var bi=-.04
var Ni=250
var Ci=15
var Mi=(Ci-1)/2e4
var Di=false
var Pi=false
var ki=null
var Bi=false
var Ui=false
var Gi={}
var Fi=false
var Wi=false
var ji
var Hi=null
var zi=null
var Vi=[]
var Yi=[]
var qi=null
var Ki
var Zi
var Xi
V.register({debug_verbose:{label:"(Admin) Verbose info in F3 Debug Cursor",default_value:H.DEBUG?1:0,type:f.TYPE_INT,range:[0,1],access_run:["sysadmin"]},ignore_volumes:{label:"(Admin) Ignore edit volumes in client logic",default_value:0,type:f.TYPE_INT,range:[0,1],access_run:["sysadmin"],on_change:st}})
function unlimitedMode(){return Sa.unlimitedMode()}function doStamina(){return wa()&&!aa()}function startup(){ji=Dt.getFrameTransaction
ii=Dt.char_controller
r.tex_voxel_util=ri=p.load(g({url:H.webgl2?"img/voxel_util.array.png":"img/voxel_util.atlas.png"},ia.pack_tex_params))
ai=Yr()
et()}function doingDragPlace(){return Boolean(ni)}function shift(e){if(ni)ae(ni,e)
it(e)
for(var t in Gi){var r=Gi[t]
ae(r.pos,e)}for(var a=Hi;a;a=a.next)ae(a.pos,e)
for(var i=0;i<Vi.length;++i)ae(Vi[i].pos,e)
for(var o=0;o<Yi.length;++o)ae(Yi[o].pos,e)}var Qi=[]
var Ji
function tempPoint(){if(Ji===Qi.length)Qi.push(de())
return Qi[Ji++]}var $i=[]
var eo
function tempMat(){if(eo===$i.length)$i.push(R())
return $i[eo++]}var to=[]
var ro
function tempColor(){if(ro===to.length)to.push(fe())
return to[ro++]}function tempColorFade(e,t){if(1===t)return e
var r=tempColor()
r[0]=e[0]
r[1]=e[1]
r[2]=e[2]
r[3]=e[3]*t
return r}var ao=de()
var io=de()
var oo=de()
function oreFromLocalPos(e){$(oo,ia.origin_chunk,e,1/Ee)
ie(oo)
return tr(oo)}function getDigTarget(e,t){var r=e.join()
var a=Gi[r]
if(a)return a
ia.getLocalPosFromPosPair(ao,e)
var i
if(!t)i=ia.getPropLocalExact(ao)
var o=Rr
var n
var s
var l
var c=0
var _=ia.getTilePosPair(e,0,t)
var u
if(i){o=i.inv.dig_rate||xr
s=i.getMaterial()
l=i.getMaterialClass()}else{if(!(n=Wr[_]))return 0
s=n.mat
if(!w(t||s))return 0
u=n.stamina_use
l=kt[s]
if(n.variable_yield&&s===Ce.STONE){s=oreFromLocalPos(ao)
l=Vt.METAL}if(n.is_stone){fa(io,ao)
c=rr(io)
o/=wr[c]}if(Ut[s])o*=Ut[s]}if(void 0===u)u=Yt[s]||qt[l]||qt[Vt.STONE]
return Gi[r]={pos:ao.slice(0),pair:e,progress:0,size:i?i.size:K,base_rate:o,tile:_,tile_data:n,tile_material:s,tile_material_class:l,is_liquid:t,stone_tier:c,stamina_use:u,prop:Boolean(i),done:false,key:r,last_rate:0,other_rate:0,other_rate_countdown:0}}var no=7500
function applyDigProgress(e){var t=0
var r=e.readInt()
var a=0
var i=0
for(var o=0;o<r;++o){var n=a+e.readInt()
a=n
var s=i+e.readInt()
i=s
var l=e.readU8()/255
var c=e.readU8()/no
var _=[n,s]
if(!ia.getTilePosPair(_,0,false))continue
var u=getDigTarget(_)
if(!u)continue
t=Pa(t,c)
u.progress=Pa(u.progress,l)
u.other_rate=c
u.other_rate_countdown=wi}}function cmpDigProgress(e,t){var r=e[0]-t[0]
if(r)return r
return e[1]-t[1]}function notMoreNearbyPlayersThan(e){var t=Je().entities
var r=0
for(var a in t)if(t[a].data.type===me.Player)if(++r>e)return false
return true}var so=0
function updateDigTargets(e){var t=H.frame_index
var r=Dt.omp&&H.frame_timestamp-so>wi&&notMoreNearbyPlayersThan(Ue)
var a
if(r){a=[]
so=H.frame_timestamp}for(var i in Gi){var o=Gi[i]
if(o.frame!==t&&!o.done)o.progress-=e*Ti
var n=ia.getTilePosPair(o.pair,0,o.is_liquid)
if(o.progress<=0||n!==o.tile){delete Gi[i]
continue}var s=gi
if(o.prop){s=Ei
var l=ia.getPropLocalExact(o.pos)
if(!l||l.item_id===Ie){delete Gi[i]
continue}if(l&&l.shouldDigSlow())s*=Ai}if(o.other_rate_countdown&&o.progress<1){var c=ka(e,o.other_rate_countdown)
o.other_rate_countdown-=c
o.progress=ka(.999,o.progress+c*o.other_rate)}if(o.progress>s){var _=o.pos
var u=o.progress
var d=void 0
var f=void 0
if(o.done){d=4
f=0}else{d=Da(3*u)
F(d>=0&&d<3)
F((f=3*u-d)>=0&&f<=1)}ia.drawSingleVoxelTextured({tile:T+d,blend:f,pos:_,z_bias:-Oi,color:ei,tex:ri,size:o.size,sort_bias:Ri,atlas_params_vp:ia.atlas_params_voxel_util_vp,atlas_params_fp:ia.atlas_params_voxel_util_fp})
if(r&&o.frame===t&&!o.done)a.push([o.pair[0],o.pair[1],Da(255*o.progress),k(Ua(o.last_rate*no),0,255)])}}if(r&&a.length&&!S()){var v=Ta("dig")
v.writeInt(a.length)
var h=0
var p=0
a.sort(cmpDigProgress)
for(var m=0;m<a.length;++m){var g=a[m]
var E=g[0]-h
h=g[0]
v.writeInt(E)
var y=g[1]-p
p=g[1]
v.writeInt(y)
v.writeU8(g[2])
v.writeU8(g[3])}v.send()}}function getPlaceQueue(e){for(var t=Hi;t;t=t.next)if(se(t.pos,e))return t.tile
for(var r=0;r<Vi.length;++r)if(se(Vi[r].pos,e))return Vi[r].tile
for(var a=0;a<Yi.length;++a){var i=Yi[a].pos
var o=Yi[a].prop.size
if(e[0]>=i[0]&&e[0]<i[0]+o[0]&&e[1]>=i[1]&&e[1]<i[1]+o[1]&&e[2]>=i[2]&&e[2]<i[2]+o[2])return Dr}return 0}function propAt(e,t){var r=ia.getPropLocal(e)
return r&&r.item_id===t&&r}function isEmptyOrBag(e){var t=ia.getTileLocal(e,1)
if(!t||t===Cr&&propAt(e,Ie))if(!getPlaceQueue(e)&&ot(e))return true
return false}var lo=1
var co
var _o=function(){var e=[de(0,0,0)]
for(var t=-lo;t<=lo;++t){if(1===t)co=e.length
for(var r=-lo;r<=lo;++r)for(var a=-lo;a<=lo;++a)if(a||r||t)e.push(de(a,r,t))}return e}()
var uo=de()
function addToBagSplatter(e,t,r,a,i){F(r.cost)
if(unlimitedMode()&&!a)return
var o=[0]
var n=[]
for(var s=1;s<_o.length;++s){var l=_o[s]
U(uo,t,l)
if(isEmptyOrBag(uo))if(s>=co)n.push(s)
else o.push(s)}var c=r.cost
F(c)
var _=o.length/(o.length+.25*n.length)
var u=1===c.length?4:2===c.length?2:1
if(1===c.length&&c[0].type===Ne&&!r.variable_yield)u=1
for(var d=0;d<c.length;++d){var f=c[d]
F(f.type===Ne||f.type===be)
if(f.type===Ne&&!St(f)){c[d]=f=It(f)
if(f.has_hp)f.setHP(f.hp_max)}if(r.variable_yield){var v={type:Ne,count:1+Da(5*Ba())}
v.attr1=oreFromLocalPos(t)
v.id=xe
f=It(v)}var h=f.count
var p=Ca(h/u)
while(h){var m=ka(p,h)
h-=m
var g=void 0
if(m===f.count)g=f
else(g=It(f)).count=m
var E=void 0
if(H.defines.BAG&&0===o[0])E=0
else if(Ba()<_)E=o[Da(Ba()*o.length)]
else E=n[Da(Ba()*n.length)]
var y={target_pos:U(tempPoint(),t,_o[E]),item:g,src_pos:t,auto_pickup:true,emptied_pos:t,from_center:true,is_update_func:i}
sr.bagAddTrans(e,y)}}}function protectBlock(e){if(!qi)return
var t=ia.posPairFromLocalIntPos(e)
qi[t.join(",")]=true}function protectBlockIdx(e,t){if(!qi)return
qi[e+","+t]=true}function tileMaterial(e){var t=Wr[e]
return t&&t.mat||null}function playSoundForMaterial(e,t){var r=Wt[t]||Bt[kt[t]]||"_dirt"
xa(""+e+r)}function digProgressName(e,t){var r=e.tile_data
if(r){var a=Mt.get("TILES_"+Fr[e.tile]+"_NAME")
if(r&&r.variable_yield&&e.tile_material_class===Vt.METAL)a=Ft[e.tile_material]+" Ore"
return a}else return t.inv.getName()}function consumeDurability(e,t,r,a){var i=a||Gt[r]
w(i)
var o=-(i||1)
var n=_t
var s=n.contents.indexOf(t)
if(-1===s){s=(n=ut).contents.indexOf(t)
F(-1!==s)}pt(e,n,s,o)
if(!t.hp_cur){xa("tool_break")
var l=t.getRarity()<=1&&t.getMaterialClass()===Vt.STONE
if(l)gt(e,n,s,1)
var c=false
if(H.defines.AUTOREPLACE)if(n===_t){var _=ft(ut,t)
if(_){var u=ut.contents.indexOf(_)
F(-1!==u)
lt.transSwap(e,_t,s,ut,u)
Ir.push(Mt.STATUSMSG_TOOL_BROKE_REPLACE)
c=true}}if(!c)Ir.push(l?Mt.STATUSMSG_TOOL_BROKE:Mt.STATUSMSG_TOOL_BROKE_REPAIR)}}f.register({cmd:"damage_tool",help:"Damages an equipped tool",access_run:["sysadmin"],usage:"$HELP\nUsage: /damage_tool <0|1|2> <amount>",func:function func(e,t){var r=e.split(" ")
if(2!==r.length)return void t("Need a tool index and damage")
var a=Number(r[0])
var i=Number(r[1])
var o=_t.contents[a]
if(!o)return void t("No tool found at index "+a)
o.tool_last_use_frame=H.frame_index+60
consumeDurability(Dt.getFrameTransaction(),o,null,i)
t()}})
function checkStaminaBeforeAction(e){var t=ta()
if(doStamina())if(!t){if(e){Ir.get("dig_error").setMessage(e,I)
Ir.get("no_stamina_hint").setMessage(Mt.STATUSMSG_DIG_NO_STAMINA_HINT,I).noBounce()}return false}return true}function calcDigData(e,t,r){var a=ia.posPairFromLocalIntPos(t)
if(qi&&qi[a.join(",")])return false
var i=getDigTarget(a)
if(!i)return false
if(i.stamina_use&&!checkStaminaBeforeAction(e?Mt.STATUSMSG_DIG_NO_STAMINA_DIG:void 0))return false
if(r&&!r.mineable()){if(r.inv.mineable)if(e)r.mineWhenBlocked()
return false}if(r&&!r.inEditBounds(lr))return false
var o=i.tile_material_class,n=i.tile_material,s=i.stone_tier
var l=gr(o,e)
if(!l){if(Ra()&&e){var c=digProgressName(i,r)
Ir.get("dig_error_"+c).setMessage(Mt.STATUSMSG_TOOL_CUSTOM_NOT_ALLOWED,I)}return false}F(l.is_gather)
F(l.dig_rates)
var _=l.dig_rates[o]*l.dig_rate_mod
if(!_){if(e){var u=digProgressName(i,r)
var d=Ir.get("dig_error_"+u)
if(l&&(l.type!==Ne||l.id!==Le))d.setMessage(Mt.$(Mt.STATUSMSG_DIG_WRONG_TOOL,l.getName(),u),I)}return false}if(l.max_tier){var f=l.max_tier[o]
if(f)if(jt[n]>f&&!unlimitedMode()){if(e){var v=Ht[n]
var h=v&&Ft[v]
if(h){var p=digProgressName(i,r)
var m
m=Ir.get("dig_error_"+p)
if(r)m.setMessage(Mt.$(Mt.STATUSMSG_DIG_WRONG_TIER_DECONSTRUCT,l.name,h,p),I)
else m.setMessage(Mt.$(Mt.STATUSMSG_DIG_WRONG_TIER_GATHER,l.name,h,p),I)}}return false}}if(s)if(l.max_stone_tier<s&&!unlimitedMode()){if(e){var g=zt[s]
var E=g&&Ft[g]
if(E){var y=digProgressName(i,r)
Ir.get("dig_error_"+y).setMessage(Mt.$(Mt.STATUSMSG_DIG_WRONG_TIER_BREAK,Mt.ITEM_PICKAX_NAME,E,Ar[s],y),I)}}return false}if(r&&r.shouldDigSlow())_*=Ai
return{rate_mod:_*=i.base_rate,target:i,inv:l}}var fo=[{name:"stone_dig_particles",rot:0}]
var vo=[{name:"water_gather_particles",rot:0}]
var ho=de()
function calcBucketData(e,t){var r=ia.posPairFromLocalIntPos(e)
if(qi&&qi[r.join(",")])if(t.liquid===Ur||t.liquid===Gr);else return false
var a=getDigTarget(r,true)
if(!a)return false
return{rate_mod:1,target:a}}function drawUtilVoxel(e,t,r,a,i){ia.drawSingleVoxelTextured({tile:e,pos:ee(tempPoint(),t),z_bias:-bi,color:r,tex:ri,size:a,sort_bias:i||Ri-.2,atlas_params_vp:ia.atlas_params_voxel_util_vp,atlas_params_fp:ia.atlas_params_voxel_util_fp})}function waterTile(t,e,r){t.progress=0
t.done=true
var a=hr()
if(a){da(a,Wa,kr,false,false,e.tile,true)
if(doStamina()){var i=d*Xr()
ra(a,-Ua(i))}a.silent_error=true
Jt(r,false,void 0,ja)
xa("bucket_water_crops")
a.onComplete(function(e){if(e)console.log("Error watering tile at "+t.pos[0]+","+t.pos[1]+","+t.pos[2]+": "+e)
Gi[t.key]=null
delete Gi[t.key]})}}function fillBucket(e,t,r,a){a.progress=0
a.done=true
var i=ur(Ur)
if(i){da(i,e,0,true,false,t.liquid,true)
if(doStamina()){var o=d*Xr()
ra(i,-Ua(o))}i.silent_error=true
Jt(r,false,void 0,ja)
xa("bucket_fill")
i.onComplete(function(e){if(e)console.log("Error gathering water at "+a.pos[0]+","+a.pos[1]+","+a.pos[2]+": "+e)
Gi[a.key]=null
delete Gi[a.key]})}}function wateringProgress(e,t,r){var a=calcDigData(false,Wa)
if(!a)return 0
var i=a.rate_mod,o=a.target
if(S()||Zt())e=0
i*=Qr()
if(!Bi)i=ka(i,1)
if(!unlimitedMode())i=ka(i,3)
o.last_rate=i/mi
o.progress+=e*o.last_rate
if(Ui)o.progress=1
if(o.progress>1)o.progress=1
var n=gi
if(o.progress>n){r.tool_last_use_frame=H.frame_index
Jt(r,true,i,ja)}if(o.progress>=1)waterTile(o,t,r)
o.frame=H.frame_index
return o.progress}var po=8
function doHoeing(t,e,r){t.progress=0
t.done=true
var a=Dt.getFrameTransaction()
da(a,e,Pr,false,false,void 0,true)
a.silent_error=true
Jt(r,false,void 0,ja)
xa("hoe")
if(doStamina()){var i=ft(ut,r)
if(i){if(i.has_hp)consumeDurability(a,i,null,po)
var o=u*i.getStaminaRate()*Xr()
ra(a,-Ua(o))}}a.onComplete(function(e){if(e)console.log("Error using hoe at "+t.pos[0]+","+t.pos[1]+","+t.pos[2]+": "+e)
Gi[t.key]=null
delete Gi[t.key]})}function hoeProgress(e,t,r){var a=calcDigData(false,t)
if(!a)return 0
var i=a.rate_mod,o=a.target
if(S()||Zt())e=0
i*=Qr()
if(!Bi)i=ka(i,1)
if(!unlimitedMode())i=ka(i,3)
o.last_rate=i/mi
o.progress+=e*o.last_rate
if(Ui)o.progress=1
if(o.progress>1)o.progress=1
var n=gi
if(o.progress>n){r.tool_last_use_frame=H.frame_index
Jt(r,true,i,ja)}if(o.progress>=1)doHoeing(o,t,r)
o.frame=H.frame_index
return o.progress}function fillProgress(e,t,r,a){var i=calcBucketData(e,r)
if(!i)return 0
var o=i.rate_mod,n=i.target
if(S()||Zt())t=0
o*=Qr()
n.last_rate=o/mi
n.progress+=t*n.last_rate
if(Ui)n.progress=1
if(n.progress>1)n.progress=1
var s=gi
if(n.progress>s){la(na(e))
a.tool_last_use_frame=H.frame_index
Jt(a,true,o,ja)}if(n.progress>=1){U(ho,n.pos,B)
$t(ho,vo,ii.pos)
fillBucket(e,r,a,n)}n.frame=H.frame_index
return n.progress}function digProgress(e,t,r){var a=calcDigData(true,e,t),i=a.rate_mod,o=a.target,n=a.inv
if(!i)return 0
var s=o.tile_material,l=o.stamina_use
if(S()||Zt())r=0
var c=i
i*=Qr()
if(!Bi)i=ka(i,1)
if(!unlimitedMode())i=ka(i,3)
o.last_rate=i/mi
o.progress+=r*o.last_rate
if(Ui)o.progress=1
if(o.progress>1)o.progress=1
var _=t?Ei:gi
if(o.progress>_){n.tool_last_use_frame=H.frame_index
Jt(n,true,i,ja)}if(o.progress>=1&&!o.done){Na(ba.Broken)
playSoundForMaterial("block_break",s)
U(ho,o.pos,B)
$t(ho,fo,ii.pos,o)
Bi=true
o.done=true
var u=Dt.getFrameTransaction()
u.silent_error=true
if(t)t.onDig(u)
else{var d=ia.getTileLocal(e,0,false)
F(d)
da(u,e,0,false,false,d,true)
addToBagSplatter(u,e,It({type:be,id:d}))}for(var f=-1;f<o.size[2]+1;++f){ao[2]=o.pos[2]+f
for(var v=-1;v<o.size[1]+1;++v){ao[1]=o.pos[1]+v
for(var h=-1;h<o.size[0]+1;++h){ao[0]=o.pos[0]+h
var p=ia.getPropLocal(ao)
if(p&&p.neighborChanged)p.neighborChanged(u,o.pos)}}}if(!unlimitedMode())if(n.has_hp)consumeDurability(u,n,s)
if(doStamina()&&l){l*=Xr()
var m=Pa(1,Ua(l*n.getStaminaRate()/Pa(1,c)))
ra(u,-m)}u.onComplete(function(e){if(e)console.log("Error digging tile at "+o.pos[0]+","+o.pos[1]+","+o.pos[2]+": "+e)
Gi[o.key]=null
delete Gi[o.key]})
He(e)}o.frame=H.frame_index
return o.progress}function getLiquidTile(e){ia.getTileLocal(e,1,false)
return ia.andGetLiquid(1)}var mo=false
var go
function canPlaceOverTile(e,t,r){var a=ia.getTileLocal(e,1,false)
var i
if(r)i=ia.andGetLiquid(1)
if(a===Cr){var o=ia.getPropLocal(e)
if(o&&o.vacate&&t){go=o
return true}mo=false}if(r&&i)return i===Gr
return!a}function canPlaceOver(e,t,r,a){mo=true
if(!canPlaceOverTile(e,t,a))return false
mo=false
if(!ot(e))return false
return r||!Qt(e)}var Eo=0
function placeBlockFinish(t,e){var r=t.pos,a=t.tile,i=t.pay_cost,o=t.is_liquid
i=i||[]
var n=ia.getPropLocal(r)
if(!e&&n&&!n.vacate){Ir.get("placefail").setMessage(Mt.STATUSMSG_PLACE_BLOCKED)
e=true}var s=ia.getVDFromLocalPos(r)
if(!e&&(!s||!s.did_gen)){Ir.get("placefail").setMessage(Mt.STATUSMSG_PLACE_CHUNK_UNLOAD)
e=true}if(!e&&!ot(r))e=true
if(e){i.forEach(Et)
ia.queuedPlaceClear(r)
return}if(1===++Eo||100===Eo||1e3===Eo||1e4===Eo)Fe("blocks_placed",Eo,"game_event")
var l=o?hr():ji()
if(n)n.vacate(l,r)
if(o)Jt(t.inv,false,void 0,ja)
else Jt({type:be,id:a},false,void 0,ja)
for(var c=0;c<i.length;++c)l.opInvMod(i[c])
Na(ba.BlocksPlaced)
if(o)xa("bucket_place_liquid")
else playSoundForMaterial("block_place",tileMaterial(a))
var _={type:be,id:a,count:1}
Hr(_,Tt)
if(o){if(l){var u=ia.getTileLocal(r,1,true)
if(u!==Ur){var d=t.liquid_tile
F(d)
F.equal(d,Ur)
da(l,r,d,true,false,u===Gr?Gr:0)}}}else{da(l,r,a,false,false,0)
da(l,r,0,true,false,void 0)
_a(l,{style:Pe,src_type:ke,target_type:Be,target:r,items:[_]})}if(l){Vi.push(t)
l.silent_error=true
l.onComplete(function(e){if(e)Ir.get("placefail").setMessage(Mt.STATUSMSG_PLACE_BLOCKED)
t.wait_trans=false
t.vd_ver=t.vd.ver_meshing})}else ia.queuedPlaceClear(r)}function placeBlock(e,t,r,a){F(t)
F(!(t>=Cr&&t<=Mr))
if(getPlaceQueue(e))return
var i
if(!unlimitedMode()&&!r){if(!(i=yr()))return
F(i.length)
F(i[0].delta)}var o={tile:t,pay_cost:i,pos:e.slice(0),is_liquid:r,time:Ni,next:null,vd:ia.getVDFromLocalPos(e),wait_trans:true,pointer_locked:z.pointerLocked()}
if(r){o.liquid_tile=a.attr2
o.time=1
o.inv=a}o.vd_reused=o.vd.reused
if(Hi){zi.next=o
zi=o}else Hi=zi=o
ia.queuedPlaceSet(o.pos,o.tile)
He(o.pos)}var yo=de()
function placeProp(e,t,r,a){r=t.inv
F(r.placeable)
var i=sr.createFromInv(r)
i.is_preview=true
i.flipped=t.flipped
i.faceMe()
var o=i.size
for(var n=0;n<o[2];++n){yo[2]=e[2]+n
for(var s=0;s<o[1];++s){yo[1]=e[1]+s
for(var l=0;l<o[0];++l){yo[0]=e[0]+l
if(getPlaceQueue(yo))return}}}var c=ji()
var _=mt(c,ut,cr.getSelected())
var u=false
if(a){u=true
a.vacate(c,e)}i.updateBeforePlace(e,c)
ua(c,e,i,false,u)
_a(c,{style:Pe,src_type:ke,target_type:Be,target:e,items:[r]})
var d=sr.createFromInv(r)
d.is_preview=true
d.allowAlpha()
d.faceMe()
d.draw_opts.color=sr.color_prop_preview
if(d.item_id===Se){d.blueboxChangeState(null,i.bluebox_state,true)
d.updateDrawable()}for(var f=0;f<o[2];++f){yo[2]=e[2]+f
for(var v=0;v<o[1];++v){yo[1]=e[1]+v
for(var h=0;h<o[0];++h){yo[0]=e[0]+h
ia.queuedPlaceSet(yo,Dr)}}}var p={prop:i,prop_preview:d,pos:e.slice(0),vd:ia.getVDFromLocalPos(e),wait_trans:true,pay_cost:_}
p.vd_reused=p.vd.reused
Yi.push(p)
c.silent_error=true
var m=i.item_id===Oe&&wa()&&!_.length&&!Jr("used_free_settlement")
if(m){p.pay_cost=null
ea("used_free_settlement",1,false)}zr("transacting_build_prop_"+p.prop.item_id,true,true)
c.onComplete(function(e){zr("transacting_build_prop_"+p.prop.item_id,false,true)
if(e)Ir.get("placefail").setMessage(Mt.STATUSMSG_PLACE_BLOCKED)
else if(m)Ia("used_free_settlement",1,y)
p.vd_ver=p.vd.ver_meshing
p.wait_trans=false
if(!e&&Ea()&&!$r()){zr("build_prop_"+p.prop.item_id)
Hr(i.inv,Tt)}})
He(p.pos)}function resetBlockPlaceQueue(){Hi=zi=null
Vi=[]
Yi=[]
ia.queuedPlaceReset()}var To
var Io=0
var So=1
var Ao=2
var wo=3
var Lo=4
var Ro=6
var xo=7
var Oo
var bo=1
var No=2
var Co=3
var Mo=4
var Do
var Po=ue()
var ko=ue()
var Bo=de()
var Uo=de()
var Go=de()
var Fo=de()
var Wo=[[1,2],[0,2],[0,1]]
var jo={monochrome:true}
function utilVoxelGetLighting(e){sa(jo,e,false)}function drawUtilVoxelLit(e,t,r,a,i){var o={tile:e,pos:ee(tempPoint(),t),z_bias:-bi,color:r,tex:ri,size:a,sort_bias:i||Ri-.2,atlas_params_vp:ia.atlas_params_voxel_util_vp,atlas_params_fp:ia.atlas_params_voxel_util_fp,lit:true,draw_opts:jo}
ia.drawSingleVoxelTextured(o)}var Ho
function interactDetails(){return Ho}var zo
function interactableProp(){if(zo&&!ca(zo))zo=null
return zo}function blockPlacePreview(e){ia.drawSingleVoxel({tile:e.tile,is_liquid:e.is_liquid,pos:e.pos,color:Va,sort_bias:Ri})}function propPlacePreview(e){ia.getPropLighting(e.prop_preview.draw_opts,e.pos)
ia.drawProp(e.prop_preview,e.pos)}var Vo=1
var Yo=0
function tickBlockPlaceQueue(e){var t=e*(Vo=k(Vo+(Hi?1:-5)*Mi*e,1,Ci))
if(!Hi)Yo=ka(Yo+t,Ni)
else if(Yo){t=ka(t+Yo,Ni)
Yo=0}while(Hi){var r=Hi.pointer_locked&&!z.pointerLocked()&&!doingDragPlace()
if(t>=Hi.time||r){t-=Hi.time
var a=Hi
if(!(Hi=Hi.next))zi=null
placeBlockFinish(a,r)}else{Hi.time-=t
t=0
break}}for(var i=Hi;i;i=i.next)blockPlacePreview(i)
for(var o=Vi.length-1;o>=0;--o){var n=Vi[o]
if(n.vd.reused!==n.vd_reused){ia.queuedPlaceClear(n.pos)
A(Vi,o)
continue}if(!n.wait_trans&&n.vd.geom_ver_meshing>=n.vd_ver){ia.queuedPlaceClear(n.pos)
A(Vi,o)
continue}blockPlacePreview(n)}for(var s=Yi.length-1;s>=0;--s){var l=Yi[s]
var c=false
if(l.vd.reused!==l.vd_reused)c=true
else if(!l.wait_trans&&l.vd.geom_ver_meshing>=l.vd_ver)c=true
if(c){var _=ia.getPropLocalExact(l.pos)
if(_&&_.item_id===l.prop.item_id){_.local_last_pay_cost=l.pay_cost
_.afterPlace()}var u=l.prop.size
for(var d=0;d<u[2];++d){yo[2]=l.pos[2]+d
for(var f=0;f<u[1];++f){yo[1]=l.pos[1]+f
for(var v=0;v<u[0];++v){yo[0]=l.pos[0]+v
ia.queuedPlaceClear(yo)}}}A(Yi,s)}else propPlacePreview(l)}}var qo=de()
function lineLineDistNoNear(e,t,r,a,i){var o=r[0]?0:a[0]-t[0]
var n=r[1]?0:a[1]-t[1]
var s=r[2]?0:a[2]-t[2]
if(o*o+n*n+s*s<2)return-2
var l=Ct(e,t,r,a,i)
le(qo,e,a)
if(O(qo,i)<=0)return-3
return l}function undergroundFactors(){if(H.defines.NOSHADOW)return 0
fa(io,ii.pos)
var e=ar(io)-io[2]
return[k((e-100)/100,0,1),k(e/50,0,1)]}var Ko={type:1,seed:1,priority:1,blockable:1,blocked:1,blocked_origin:1,blocked_size:1,blocked_r:1,blocked_check:1,lines:1,factory_estimator:1}
var Zo=de()
var Xo=de()
var Qo=de()
var Jo=fe(.5,.5,.5,1)
function cursorDebug(e){var t=V.debug_verbose
re(Qo,e)
e=Qo
var r=ia.chunkIdFromLocalFloatPos(Zo,e)
var a=Me.parseChunkId(r)
fa(Xo,e)
var i=["Block under cursor"]
i.push("  World Pos: "+or(Xo)+(t?" (local: "+or(e)+")":"")+" (seed: "+La()+")")
if(t){i.push("  Chunk "+r+(t?" ("+or(a.chunk_pos)+") offset "+or(Zo):"")+" idx "+Ge(Zo))
i.push("  VSID "+(a.chunk_pos[0]+a.chunk_pos[1]*ye))}var o=ia.chunk_map[r]
if(o){var n=[]
if(o.mesh_dirty)n.push("MeshDirty")
if(o.liquid_unstable&&o.liquid)n.push("LiquidUnstable")
if(!o.did_gen)n.push("NOT(DidGen)")
if(t)n.push(pa[o.claimed])
if(n.length)i.push("  "+n.join(", "))}if(t){var s=Kt.getSpoilInfo(a.chunk_pos)
var l=""
if(s){l="spoiled:"+s.spoiled
if(t)l+=" details:"+(s.details?s.details.ver:"-")+(s.details_spoiled?",s":"")}var c=ha(Xo)
i.push("  MegaChunk "+a.mcid+(t?" ("+or(a.mchunk_pos)+") offset "+or(a.local_pos):"")+" "+l+(t?" ZM:"+c:""))}if(H.defines.DETAILS){var _=va(r)
if(_.length)for(var u=0;u<_.length;++u){var d=_[u]
i.push("  Detail "+u+" ("+d.type+"#"+d.seed+", P"+d.priority+"):")
if(d.blocked)i.push("    BLOCKED: "+d.blocked_origin+"+"+d.blocked_size+", r="+d.blocked_r)
else{for(var f in d){if(Ko[f])continue
i.push("    "+f+": "+JSON.stringify(d[f]).replace(/"/g,""))}if(d.blockable)i.push("    Blockable: "+(d.blocked_check?"":"UNCHECKED ")+" "+d.blocked_origin+"+"+d.blocked_size+", r="+d.blocked_r)}if(d.lines)for(var v=0;v<d.lines.length;++v){var h=d.lines[v]
rt({p0:h[0],p1:h[1],color:Jo,color2:K})}}}var p=ia.getTileLocal(e,-1,false)
var m=ia.andGetLiquid(-1)
var g=ia.andGetLightDebug()
var E=null
if(p>=Cr&&p<=Mr)E=ia.andGetProp()
var y
var T=Wr[p]
if(T){if(wa()||!ya().world_admin)if(T.debug_as){g.sun=g.torch=0
p=T.debug_as}y=jr[p]}if(!y&&p>=Cr&&p<=Mr)y="Prop"+p
y=y||"Unknown"
if(t)y=p+"("+y+")"
i.push("  Tile="+y+"  Liquid="+m+"  Sun="+g.sun+"  Torch="+g.torch)
if(t&&wa()){var I=ar(Xo)-Xo[2]
var S=tr(a.chunk_pos)
var A=rr(Xo)
i[i.length-1]+="  Ore="+Ft[S]+", StoneTier="+Ar[A]+"("+A+") (depth="+I.toFixed(0)+")"}if(E){var w
if(t){var L=[]
E=E.toDebug()
w=Object.keys(E).filter(function(e){if(true===E[e]){L.push(e)
return false}return true}).map(function(e){return e+": "+or(E[e])}).join("\n    ").replace(/"/g,"")
w=L.join(", ")+"\n    "+w}else{var R=E.inv
w=""+R.id
if(E.item_id!==Se&&(R.attr1||R.attr2||R.attr3)){w+=" attr:"+R.attr1
if(R.attr2||R.attr3){w+="/"+R.attr2
if(R.attr3)w+="/"+R.attr3}}}i.push("  Prop="+w)}$e.addText(i.join("\n"))}function tickBuildModeInactive(){tickBlockPlaceQueue(H.frame_dt)
if(ga("sysadmin")&&Zr()&&!Je().hasMyEnt())Y.font.drawSizedAligned(null,j.x1(),j.y1(),Z.DEBUG,Y.font_height,Y.font.ALIGN.HRIGHT|Y.font.ALIGN.VBOTTOM,0,0,"(no entity / invisible)")}function clickAnywhere(e){var t=z.click({max_dist:_i,peek:e})
return t&&!Fi&&Date.now()-t.start_time<ci}var $o=0
function mouseMoveFade(){if(H.defines.NOUI)return 0
if(z.touch_mode)return 1
return E(k(1-($o-500)/1e3,0,1),2)}function mouseMoveFadeReset(){$o=0}function tempPointReset(){ro=eo=Ji=0}var en=1e3
function doPointerLockTop(){var e=z.pointerLocked()
if(e&&!Wi){Fi=true
h()}Wi=e
if(z.touch_mode){if(e)z.pointerLockExit()}else if(!e){if(!cr.isDragging()&&!z.pad_mode)z.click({button:0,in_event_cb:z.pointerLockEnter})}else if(!Fi)if(z.click({button:2}))z.pointerLockExit()
return e}function doPointerLockBottom(){if(Fi&&!v(0)&&!v(2))Fi=false}function pointerLockJustEntered(){return Fi}function suppressQueuedPlaceCancel(){for(var e=Hi;e;e=e.next)e.pointer_locked=false}function cancelDragPlace(){if(ni){suppressQueuedPlaceCancel()
ni=null
Fi=true}}function gameplayHUD(){Ot()
if(H.defines.NOUI)return
if(aa())return
var e=cr.getSelectedVisible()
if(e.type===Ne&&(e.id===we||e.id===Ae))tt(e)}var tn=R()
function checkRayLength(e,t,r){if(e&&t*t<te(ii.pos,r||Wa))return 0
return e}var rn
function doFakeTouch(e){if(rn&&(!e||z.mouseButtonHadEdge())){rn=false
z.fakeTouchEvent(rn)}if(z.keyDownEdge(z.KEYS.R,{in_event_cb:z.pointerLockEnter}))if(!rn){rn=true
z.fakeTouchEvent(rn)}if(rn&&(z.keyUpEdge(z.KEYS.R)||z.keyDown(z.KEYS.SPACE)||z.keyDown(z.KEYS.ESC))){rn=false
z.fakeTouchEvent(rn)}if(z.keyDownEdge(z.KEYS.T,rn?null:{in_event_cb:z.pointerLockEnter})){rn=!rn
z.fakeTouchEvent(rn)
Fi=false}}function getCursorModeFromInventory(e,t,r,a,i,o){if(e.type===be)if(wt(e))To=t||Wr[e.id].unknown?wo:So
else To=xo
else if(e.id===Le)To=xo
else if(wt(e))if(t);else{To=Ao
var n=e
if(e.mode_list_ids)n=mr()
else n=ht(n)
n=vt(n)
a=(r=sr.getForPreview(n,sr.PREVIEW_PLACE)).size[0]*r.size[1]*r.size[2]}else if(fr());else if(e.id===we||e.id===Ae){To=xo
i=true}else if(e.is_gather){To=Lo
Oo=bo}else if(e.id===Re){To=Lo
Oo=Mo}else if(dr())if(t);else if(dr(br)){To=Lo
Oo=No}else{var s=ia.raycast3DLocal(Wa,Ha,ja,o,Bo,di,true)
if(s&&(s.tile===Pr||s.tile===kr)){To=Lo
Oo=Co}else To=So}else To=xo
return{inv:e,edit_prop:r,prop_size_sum:a,want_crosshair:i}}function getCursorMaxDistance(){return To===So||To===Ao?unlimitedMode()?i:o:l}function handleItemPick(e,t){var r
if(e){r=e.toItem()
if(e.item_id===Se&&!qe(r.getBID()))r=null}else if(!t.liquid&&t.tile&&t.tile!==Dr&&-1!==t.tile){var a
var i=t.tile
if(null!=(a=Wr[i])&&a.blueprint){var o
i=null==(o=Wr[i])?void 0:o.blueprint}if((r=It({type:be,id:i}))&&!wt(r))if(r.cost&&r.cost.length>=1)r=It(r.cost[0])}if(At(r))cr.selectByItem(r,true)}function handleHitProp(e,t,r,a){if(e.shouldPropertyEdit()){To=Ro
Ya=Qa
Xi=true}else if(To===So&&doingDragPlace())e=null
else if((!t&&e.inEditBounds(lr)||e.read_only_interact)&&(r=e.interactable())){if(To!==Lo||To===Lo&&Oo===No)To=wo
if(!Di)Ya=r
Ho=(zo=e).interactDetails()
Xi=true
var i=a>=(z.touch_mode?pi:0)
var o=Do&&Do.prop
if(e.interactable_continuously&&i&&o){Pi=true
e.interact(null,ja)
Na(ba.PropsInteracted)
To=wo}else if(clickAnywhere())if(Do&&Do.prop===e){e.interact(null,ja)
Na(ba.PropsInteracted)
To=wo}}else if(e.inv.always_interact){if(To===So||To===Ao||To===Lo&&Oo===No)To=wo}else if(To===So||To===Ao)e=null
return{hit_prop:e,interactable:r}}function startAction(e,t,r,a,i,o){var n=z.touch_mode?Ii:Infinity
var s=e?hi:z.touch_mode?vi:fi
if(!Di){if(t.total<n)if(r>=s){Di=true
ki=o
Bi=false
a=z.touch_mode?ka(i,r-s)*yi:ka(i,t.down_time)}}else a=ka(i,t.down_time)
if((Oo===bo?pr()===K:true)&&!Bi)if(clickAnywhere(true))if(unlimitedMode())if(t.total<n){Di=Ui=true
ki=o
Bi=false}return a}function handleActionPlaceDragStart(e,t,r,a,i,o,n,s){if(e){cr.lock()
if(To===So)if(!Di)if(z.touch_mode){if(e.total>t)To=wo
else if(r>ci||z.click({peek:true})){Di=oi=true
F(ki=s)}}else{Di=oi=true
F(ki=s)}if(To===Ao)if(z.touch_mode)if(e.total>t)To=wo
else F(ki=s)
if(To===Lo)i=startAction(a,e,r,i,o,s)}else{Bi=Di=false
cancelDragPlace()
if(z.touch_mode)To=Io
else{z.mousePos(ko)
if(!n&&!z.pad_mode)To=H.defines.DEBUGCURSOR?wo:Io
if(H.defines.DEBUGCURSOR)if(!x(Po,ko)){mouseMoveFadeReset()
Q(Po,ko)}}}return{action_delta:i}}function handleConsumable(e){if((To===wo||To===xo)&&fr()&&!e){To=Io
if(!z.touch_mode&&clickAnywhere())if(Pi)Pi=false
else vr(null)}}function handleDigOnProp(e,t,r,a,i){if(e.mineable()){var o=tempPoint()
e.getLocalPos(o)
var n=!ot(o)
Go[2]=o[2]+e.size[2]
e:for(var s=0;s<e.size[1];++s){Go[1]=o[1]+s
for(var l=0;l<e.size[0];++l){Go[0]=o[0]+l
var c=ia.getPropLocal(Go)
if(c&&c.inv.rooted){n=true
break e}}}if(n){if(!i||Di)Ya=ti}else if(Di)t=digProgress(Wa,e,r)}else if(e.inv.mineable&&Di&&a>mi){Ya=ti
e.mineWhenBlocked()}return t}var an=de()
function digBeamCast(e,t,r,a,i,o,n,s){Ki=[]
Zi=[]
var l
if(e===K){if(t)if(r)F(false)
else if(t.tile<Br){Ki.push(Wa)
if(calcDigData(false,Wa,null).rate_mod)Zi.push(ce(tempColor(),qa))
else Zi.push(ce(tempColor(),ti))
a.push(1)
i.push(null)}}else{var c=tempPoint()
F.equal(e[0],e[1])
F.equal(e[1],e[2])
var _=e[0]/2+.25
var u=Fa(2)/2
var d=e[0]/2+.5
var f=tempPoint()
var v=checkRayLength(t=ia.beamcast3DLocal2(an,o,Bo,di,_,f),n)
if(!(t=checkRayLength(t,n,an))&&v)if(te(an,Wa)<2)t=v
if(H.defines.BEAM&&t){drawUtilVoxel(N,$(de(),an,K,-.5),[1,0,1,1])
if(H.defines.BEAMHIT)drawUtilVoxel(b,f,[1,0,0,.5])}if(t){var h=Ca(d+.5)
l=tempPoint()
s=tempPoint()
re(s,an)
for(var p=-h;p<=h;++p){c[2]=s[2]+p
for(var m=-h;m<=h;++m){c[1]=s[1]+m
for(var g=-h;g<=h;++g){c[0]=s[0]+g
var E=ia.getTileLocal(c,0,false)
if(E){ee(l,c)
var y=false
for(var T=0;T<3;++T){l[T]+=ii.pos[T]<c[T]?-1:1
var I=ia.getTileLocal(l,1,false)
if(!I||I>=Br){y=true
break}l[T]=c[T]}if(te(Ze(),c)<1)y=true
if(!y)continue
U(l,c,B)
var S=Fa(te(an,l))
if(S>=d){if(H.defines.BEAM&&E<Br){Ki.push(ee(tempPoint(),c))
Zi.push(ti)}continue}var A=k(1-(S-u)/(d-u),0,1)
if(E<Br){Ki.push(ee(tempPoint(),c))
a[Ki.length-1]=A
var w=tempColor()
if(calcDigData(false,c,null).rate_mod)ce(w,qa)
else ce(w,ti)
if(H.defines.BEAM)_e(w,A,A,A)
else w[3]=A
Zi.push(w)}else if(E>=Cr&&E<=Mr){var L=ia.getPropLocal(c)
if(L)if(L.inv.clickable){Ki.push(ee(tempPoint(),c))
var R=tempColor()
var x=calcDigData(false,L.getLocalPos(),L)
var O=i.indexOf(L)
i[Ki.length-1]=L
if(-1===O)a[Ki.length-1]=A
else a[O]=Pa(a[O],A)
if(x.rate_mod)ce(R,qa)
else ce(R,ti)
if(H.defines.BEAM)_e(R,A,A,A,1)
else R[3]=A
Zi.push(R)}}}}}}}}return{dig_weights:a,dig_props:i,ray_hit:t,check_root:s}}function checkBrushTargetBlockage(e,t,r){for(var a=0;a<Ki.length;++a)if(e[a])if(t[a]){var i=t[a]
if(!r)r=tempPoint()
i.getLocalPos(r)
var o=!ot(r)
Go[2]=r[2]+i.size[2]+1
e:for(var n=0;n<i.size[1];++n){Go[1]=r[1]+n
for(var s=0;s<i.size[0];++s){Go[0]=r[0]+s
var l=ia.getPropLocal(Go)
if(l&&l.inv.rooted){o=true
break e}}}if(o){e[a]=0
for(var c=a;c<t.length;++c)if(t[c]===i)ee(Zi[c],ti)}}else{var _=Ki[a]
var u=ia.getPropLocal(U(Go,_,pe))
if(u&&(u.inv.rooted||u.neighborChanged&&!u.inEditBounds(lr))||!ot(_)){ee(Zi[a],ti)
e[a]=0}}}function doDigging(e,t,r,a){if(Di)if(Ki.length)for(var i=Ki.length-1;i>=0;--i)if(e[i]){var o=t[i]
var n=void 0
if(o){if(!o.existsInWorld())continue
n=digProgress(o.getLocalPos(tempPoint()),o,r*e[i])}else n=digProgress(Ki[i],null,r*e[i])
a=Pa(a,n)}return a}function drawTouchModeCircle(e){Y.drawCircle(ko[0],ko[1],Z.DIG_INDICATOR,ka(1,e)*Si[1],.99,Ja)
Y.drawHollowCircle(ko[0],ko[1],Z.DIG_INDICATOR,Si[1],.99,$a)}var on=de()
function doDigAction(e,t,r,a,i,o,n,s,l){var c=0
if(e&&(!e.inv.mineable||t||r===K))c=handleDigOnProp(e,c,a,i,t)
else{var _
var u=digBeamCast(r,s,e,o,n,on,l,_)
o=u.dig_weights
n=u.dig_props
s=u.ray_hit
_=u.check_root
F.equal(Ki.length,Zi.length)
checkBrushTargetBlockage(o,n,_)
c=doDigging(o,n,a,c)}if(s)Xi=true
if(Di&&z.touch_mode&&!Ui)drawTouchModeCircle(c)}function hoeBeamCast(e,t,r,a){if(e&&t)e=0
else{Ki=[]
Zi=[]
if(r===K){if(e)Ki.push(Wa)}else if(e=checkRayLength(e=ia.beamcast3DLocal(Wa,on,Bo,di,r,true,true),a)){var i=tempPoint()
for(var o=0;o<r[2];++o){i[2]=Wa[2]+o
for(var n=0;n<r[1];++n){i[1]=Wa[1]+n
for(var s=0;s<r[0];++s){i[0]=Wa[0]+s
if(ia.getTileLocal(i,0,false))Ki.push(ee(tempPoint(),i))}}}}var l=false
if(!checkStaminaBeforeAction())l=true
for(var c=0;c<Ki.length;++c){var _=Ki[c]
var u=ia.getTileLocal(_,0,false)
if(u===Pr||u===kr)Zi[c]=Xa
else if(l)Ya=ti
else if(u===Or||u===Nr){U(Go,_,pe)
var d=ia.getTileLocal(Go,1,false)
var f=ia.andGetLiquid()
if(d||f||!ot(_))Zi[c]=ti
else Zi[c]=Za}else Zi[c]=ti}}Xi=true
return e}function doHoeAction(e,t,r,a,i,o){if(!ot(Wa)){Ya=ti
return}e=hoeBeamCast(e,t,r,a)
if(Di&&Ki.length){if(!checkStaminaBeforeAction(Mt.STATUSMSG_DIG_NO_STAMINA_HOE)){Xi=false
return}var n=0
for(var s=0;s<Ki.length;++s)if(Zi[s]===Za){var l=void 0
l=hoeProgress(i,Ki[s],o)
n=Pa(n,l)}if(z.touch_mode&&!Ui)drawTouchModeCircle(n)}}function doBucketProgress(e,t,r,a){if(!checkStaminaBeforeAction())Ya=ti
else Ya=sr.color_interact_water
if(Di){if(!checkStaminaBeforeAction(e?Mt.STATUSMSG_DIG_NO_STAMINA_BUCKET:Mt.STATUSMSG_DIG_NO_STAMINA_WATER))return
var i=e?wateringProgress(t,r,a):fillProgress(Ki[0],t,r,a)
var o=Pa(0,i)
if(z.touch_mode&&!Ui)drawTouchModeCircle(o)}}function doBucketAction(e,t,r,a){if(!ot(Wa)){Ya=ti
Xi=true
return}(Ki=[]).push(Wa)
Zi=[]
if(Oo===Co&&!r&&e){if(e.tile===kr)Ya=ti
else if(e.tile===Pr)doBucketProgress(true,t,e,a)
Xi=true}else if(Oo===No&&!r&&e){if(e.liquid===Ur||e.liquid===Gr)doBucketProgress(false,t,e,a)
else Ya=ti
Xi=true}}var nn=false
function placeBeamCast(e,t,r,a,i){Ki=[]
Zi=[]
var o
var n
if(e===K){var s=(n=r.liquid===Gr)?Wa:Ha
if(n&&ni&&se(ni,Wa))nn=true
else nn=false
if(canPlaceOver(t=o=s,true))Ki.push(s)
else{Zi[Ki.length]=ti
Ki.push(s)}}else{r=checkRayLength(r=ia.beamcast3DLocal(Wa,on,Bo,di,e,false,false),a)
o=Wa
if(r){var l=tempPoint()
for(var c=0;c<e[2];++c){l[2]=Wa[2]+c
for(var _=0;_<e[1];++_){l[1]=Wa[1]+_
for(var u=0;u<e[0];++u){l[0]=Wa[0]+u
if(canPlaceOver(l,true))Ki.push(ee(tempPoint(),l))
else{Zi[Ki.length]=ti
Ki.push(ee(tempPoint(),l))}}}}}}i=o
if(oi&&r){oi=false
ni=o.slice(0)
if(n)nn=true
si=e}return{debug_pos:t,ray_hit:r,this_frame_place_origin:i}}function placePropBeamCast(e,t,r,a){e.faceMe()
e.flipped=Tr()
if(t&&r)t=0
else if(1===e.size[0]&&1===e.size[1]&&1===e.size[2])ee(Fo,Ha)
else if(e.inv.rooted&&H.defines.PROPROOT){Q(Fo,e.size)
Fo[2]=1
t=checkRayLength(t=ia.beamcast3DLocal(Fo,on,Bo,di,Fo,true,false),a,Fo)
Fo[2]++}else if(!H.defines.PROPFULL){$(an,on,pe,(e.size[2]-1)/2)
ee(Fo,e.size)
t=checkRayLength(t=ia.beamcast3DLocal(Fo,an,Bo,di,Fo,false,false),a,Fo)}else{ee(Fo,e.size)
t=checkRayLength(t=ia.beamcast3DLocal(Fo,on,Bo,di,Fo,false,false),a,Fo)}return t}function doDragPlace(e,t,r,a,i,o){F(i)
var n=z.click({max_dist:Infinity})
Xi=true
$(Uo,ni,e,.5)
var s=[tempPoint(),tempPoint(),tempPoint()]
var l=[lineLineDistNoNear(s[0],Uo,ve,t,Bo),lineLineDistNoNear(s[1],Uo,he,t,Bo),lineLineDistNoNear(s[2],Uo,pe,t,Bo)]
for(var c=0;c<3;++c){if(l[c]<0)continue
var _=s[c][c]-Uo[c]>0?1:-1
var u=Wo[c][0]
var d=Wo[c][1]
var f=false
for(var v=0;v<e[u];++v){Wa[u]=ni[u]+v
for(var h=0;h<e[d];++h){Wa[d]=ni[d]+h
if(_>0)Wa[c]=ni[c]+e[c]
else Wa[c]=ni[c]-1
if(canPlaceOver(Wa,true))f=true}}if(!f)l[c]=-4
if(l[c]>=0)l[c]/=Fa(te(s[c],t))}var p=0
if(l[1]>=0&&(l[p]<0||l[1]<l[p]))p=1
if(l[2]>=0&&(l[p]<0||l[2]<l[p]))p=2
var m=s[p]
var g=Fa(te(Uo,m))-.5*e[p]
if(se(r,ni)||nn&&te(r,ni)<=1)g=0
g+=e[p]-1
g=ka(g,P-1)
g=Pa(g,e[p]-1)
var E=0
var y=m[p]-Uo[p]>0?1:-1
var T=Wo[p][0]
var I=Wo[p][1]
var S=dt(a,true)
var A=unlimitedMode()?M:D
var w=dr(Ur)
for(var L=0;S&&L<e[T];++L){Wa[T]=ni[T]+L
for(var R=0;S&&R<e[I];++R){Wa[I]=ni[I]+R
if(y>0)Wa[p]=ni[p]-1
else Wa[p]=ni[p]+e[p]
for(var x=0;S&&x<g+1;++x){Wa[p]+=y
if(Fa(te(t,Wa))>A)break
if(!canPlaceOver(Wa,true,false,w)){if(!mo)drawUtilVoxel(G,Wa,ti)
break}ia.drawSingleVoxel({tile:i,is_liquid:w,pos:ee(tempPoint(),Wa),z_bias:-xi,color:Va,sort_bias:Ri})
E=Pa(E,x)
if(w)drawUtilVoxel(C,Wa,sr.color_interact_water_place)
else drawUtilVoxel(G,Wa,Ka);--S
if(n)if(w)placeBlock(Wa,i,true,a)
else placeBlock(Wa,i)}}}if(E){var O=Ir.get("drag_place")
O.setMessage(E+1+"x"+e[0])
O.fade(5)}if(n)ni=null}function doPropPlace(e,t,r){var a=true
var i=se(e.size,K)
go=null
var o
for(var n=0;n<e.size[1];++n){Go[1]=Fo[1]+n
for(var s=0;s<e.size[0];++s){Go[0]=Fo[0]+s
if(e.inv.rooted||e.groundFilter){Go[2]=Fo[2]-1
var l=ia.getTileLocal(Go,0,false)
if(l&&e.groundFilter&&!e.groundFilter(l))l=0
if(l>=Cr&&l<=Mr){var c=ia.andGetProp()
if(!c||c.inv.intangible)l=0}if(!l){if(e.groundFilter&&e.groundFilter.label)o=e.groundFilter.label
a=false
drawUtilVoxel(G,Go,ti)}else drawUtilVoxel(G,Go,Ya)}for(var _=0;_<e.size[2];++_){Go[2]=Fo[2]+_
if(e.inv.underwater_only&&getLiquidTile(Go)!==Ur||e.onFlow&&e.onFlow!==y&&getLiquidTile(Go)||!canPlaceOver(Go,i,e.inv.intangible)){a=false
drawUtilVoxel(G,Go,ti)}}}}if(o)Ir.get("ground_filter").setMessage(Mt.$(Mt.STATUSMSG_GROUND_WRONG_KIND,o)).fade()
var u=We(Fo,e.size,null)
if(u){fa(Go,Fo)
for(var d=0;d<u.length;++d){var f=u[d]
if(f.bluebox_state===Ye)continue
var v=f.bluebox_bounds_origin
var h=f.bluebox_bounds_size
if(Go[0]<v[0]||Go[0]+e.size[0]>v[0]+h[0]||Go[1]<v[1]||Go[1]+e.size[1]>v[1]+h[1]||Go[2]<v[2]||Go[2]+e.size[2]>v[2]+h[2])a=false}}Xi=true
if(e.item_id===Se&&!Kr())Ir.get("blueprint_err").setMessage(Mt.STATUSMSG_BP_NOT_ALLOWED)
else if(a){if(Lt(e.inv))Ir.get("settlement_locked").setMessage(Mt.STATUSMSG_SETTLEMENT_OUT_OF_BOUNDS)
if(e.item_id===Oe&&wa())if(!nt(Fo))Ir.get("settlement_overlap").setMessage(Mt.STATUSMSG_SETTLEMENT_OVERLAP).fade()
if(e.item_id===Se&&e.blueprint_def.loaded){e.setLocalPos(Fo)
ze(e)}ia.getPropLighting(e.draw_opts,Fo)
ia.drawProp(e,Fo)
if(t){Na(ba.PropsPlaced)
playSoundForMaterial("prop_place",e.getMaterial())
placeProp(Fo,e,r,go)
Jt(r,false,void 0,ja)}}else drawUtilVoxel(G,Fo,ti,e.size)}function drawBlockHighlight(e,t){var r=e&&e.tile||(To===wo?G:n)
var a=mouseMoveFade()
if(a>0){var i
if(unlimitedMode())i=drawUtilVoxel
else{i=drawUtilVoxelLit
utilVoxelGetLighting(Ha)}if(Ki.length)for(var o=0;o<Ki.length;++o)i(r,Ki[o],tempColorFade(Zi&&Zi[o]||Ya,a))
else i(r,Wa,tempColorFade(Ya,a),t&&t.size)}}function drawCrosshair(){var e=mouseMoveFade()
if(e>0){var t=Xi?fe(1,1,1,.5*e):fe(1,1,1,e)
ai.draw({x:(j.w()-li)/2,y:(j.h()-li)/2,z:Z.CROSSHAIR+.1,w:li,h:li,frame:Vr.CROSSHAIR,color:t})
if(To===Ro)ai.draw({x:j.w()/2,y:j.h()/2,z:Z.CROSSHAIR,w:li,h:li,frame:Vr.EDIT,color:t})}}function cancelCurrentAction(){ki=null
oi=Di=false
ni=true
cancelDragPlace()
To=Io}function itemChangedDuringAction(e){if(ki&&!Rt(e,ki))return true
return false}function inventoryLockedDuringAction(e){if(ki&&e)return true
return false}function tickBuildMode(){var e=H.frame_dt
var t=ka(1.5*en,e)
en=t
zo=Ho=null
if(ii.user_active)$o=0
else $o+=e
var r=doPointerLockTop()
doFakeTouch(r)
var a=aa()
if(!a)Ve()
var i=Ze()
var o=Xe()
ee(on,i)
if((V.camera_view&&!Dt.char_controller.zoomed_in_fpv||Dt.char_controller.zoomed_out_tpv)&&!z.touch_mode)$(on,i,o,Dt.char_controller.camera_distance)
W(tn,Qe())
j.setAspectFixed2(H.game_width,H.game_height)
var n=z.drag(!z.touch_mode?{button:0}:null)
if(Fi)n=null
if(n){$o=0
Q(ko,n.cur_pos)}else{if(Do)Do=void 0
if(Pi)Pi=false}var s=n?Date.now()-n.start_time:0
var l=a?null:Er()
var c=a?true:lt.locked(ut)
var _
Ya=qa
var u=false
var d
var f=!r&&!z.touch_mode&&!z.pad_mode
if(!Di||f){To=wo
Oo=Io
if(H.defines.DEBUGCURSOR);else if(Y.isMenuUp()||f||Fi){To=Io
Di=false}else if(l){var v=getCursorModeFromInventory(l,c,d,_,u,i)
l=v.inv
d=v.edit_prop
_=v.prop_size_sum
u=v.want_crosshair}}if(d)d.updatePreview()
if(r||z.pad_mode)J(ko,.5*j.w(),.5*j.h())
if(Li&&(To===Lo||To===wo||To===xo)&&z.touch_mode)X(ko,ko,K,Li)
var h
if(H.defines.DEBUGHEXOME)h=300
else h=getCursorMaxDistance()
Bo[0]=(ko[0]-j.x0Real())/j.wReal()
Bo[1]=(ko[1]-j.y0Real())/j.hReal()
Bo[0]=(2*Bo[0]-1)*Ga(H.fov_x/2)/Ma(H.fov_x/2)
Bo[1]=(2*(1-Bo[1])-1)*Ga(H.fov_y/2)/Ma(H.fov_y/2)
Bo[2]=-1
ne(Bo,Bo,tn)
oe(Bo)
var p=To===So||To===Ao
var m=ia.raycast3DLocal(Wa,Ha,ja,i,Bo,di,dr(),p)
m=checkRayLength(m,h)
if(H.defines.DEBUGHEXOME)nr(Wa)
var g=Wa
var E=H.defines.DEBUGCURSOR?null:m&&m.prop
if(n&&!Do)Do=m||true
var y=E
Xi=false
if(m&&!c&&z.click({button:1}))if(dr()){var T=ia.raycast3DLocal(Wa,Ha,ja,i,Bo,di,false,p)
if(T=checkRayLength(T,h))handleItemPick(H.defines.DEBUGCURSOR?null:m&&m.prop,T)}else handleItemPick(y,m)
var I=false
if(To&&E){var S=handleHitProp(E,a,I,s)
E=S.hit_prop
I=S.interactable}if(E)E.getLocalPos(Wa)
Ui=false
var A=0
var w=z.touch_mode&&To===Ao&&_>2?ui:_i
if(!Pi)A=handleActionPlaceDragStart(n,w,s,I,A,t,r,l).action_delta
handleConsumable(I)
var L=K
if(doingDragPlace())L=si
else if(!E||E.inv.mineable)L=pr()
var R
var x=[]
var O=[]
Ki=[]
if(To===Lo&&Di){if(!qi)qi={}}else qi=null
if(itemChangedDuringAction(l)||inventoryLockedDuringAction(c))cancelCurrentAction()
else if(To===Lo)switch(Oo){case bo:doDigAction(E,I,L,A,s,x,O,m,h)
break
case No:case Co:doBucketAction(m,A,E,l)
break
case Mo:doHoeAction(m,E,L,h,A,l)}else if(To===So){var b=placeBeamCast(L,g,m,h,R)
g=b.debug_pos
m=b.ray_hit
R=b.this_frame_place_origin}else if(To===Ao&&d)m=placePropBeamCast(d,m,E,h)
if(To){var N
if(To===So)if(dr(Ur))N=l.attr2
else N=l&&l.type===be&&l.id||0
if(To===So&&doingDragPlace()){F(ki)
F(!a)
F(N)
var C=false
if(z.touch_mode){var M=270
var D=230
var P={x:bt()?10:j.x1()-M-10,y:0,w:M,h:D,z:Z.MENUBUTTON+10,font_height:90,text:"Cancel",max_dist:Infinity}
if(n&&n.start_pos[0]>=P.x&&n.start_pos[0]<=P.x+P.w&&n.start_pos[1]>=P.y&&n.start_pos[1]<=P.y+P.h){P.x=bt()?j.x1()-M-Y.button_height-10:Y.button_height+10
if(!bt()&&Nt())P.y+=Y.button_height+10}if(Y.buttonText(P)){ni=null
C=true}if(q())C=true}if(C);else doDragPlace(L,i,R,l,N,m)}else if(m||L!==K&&Ki.length){var k=z.click({max_dist:w})
if(k&&!(To===So||To===Ao))if(Date.now()-k.start_time>ci)k=null
if(Fi)k=null
if(k&&k.button)k=null
if(To===Ao&&d)doPropPlace(d,k,l)
else if(To===wo||To===xo||To===Lo){if(!a&&To!==xo||I)drawBlockHighlight(I,E)}else if(To===So){var B=za
if(Ki.length)for(var U=0;U<Ki.length;++U)if(Zi&&Zi[U])drawUtilVoxel(G,Ki[U],Zi[U])
else{ia.drawSingleVoxel({tile:N,is_liquid:dr(Ur),pos:Ki[U],z_bias:-xi,color:B,sort_bias:Ri})
Ya=Ka
drawUtilVoxel(G,Ki[U],Ya)}Xi=true}else if(To===Ro){drawUtilVoxel(G,Wa,tempColorFade(Ya,mouseMoveFade()),E.size)
if(k)E.propertyEdit()}}}if(r||z.pad_mode||u)drawCrosshair()
gameplayHUD()
if(z.keyDownEdge(z.KEYS.F3))H.defines.DEBUGCURSOR=!H.defines.DEBUGCURSOR
if(H.defines.DEBUGCURSOR)cursorDebug(g)
doPointerLockBottom()
updateDigTargets(e)
tickBuildModeInactive()}function reset(){resetBlockPlaceQueue()}},{"../common/entity_worlds_common":195,"../common/globals":197,"../common/ids":198,"../common/materials_common":201,"../common/megachunk_common":202,"../common/voxel_data_common":209,"../common/world_constants":212,"../common/world_trans":213,"../glov/client/camera2d":241,"../glov/client/cmds":244,"../glov/client/engine":250,"../glov/client/input":271,"../glov/client/net":279,"../glov/client/settings":291,"../glov/client/spot":300,"../glov/client/textures":304,"../glov/client/ui":306,"../glov/client/ui.js":306,"../glov/common/util":330,"../glov/common/verify":331,"../glov/common/vmath":332,"./analytics":5,"./bluebox_edit_list":22,"./bluebox_ui":23,"./blueprint":24,"./build_menu":26,"./camera":28,"./client_entities":35,"./debug":62,"./dowser_simple":67,"./dowser_ui":68,"./draw_line3d":69,"./editvolume_client":72,"./inventory":94,"./items":98,"./layout":99,"./line3d":102,"./localization/localization":108,"./main":112,"./materials":114,"./megachunk_client":116,"./mobs":120,"./particle_system":126,"./proc_gen":132,"./proc_gen_biomes":133,"./proc_gen_debug":135,"./props":141,"./quickbar":142,"./status":156,"./stone_tiers":157,"./tiles":162,"./todo_list":165,"./tutorial":166,"./ui_util":168,"./user_data":170,"./voxel_data":175,"./voxel_gen":177,"./voxel_mesh":178,"./world_claims":181,"./world_comm":182,"./world_metadata":186,"./worlds_sound":187,"./worlds_soundscape":188,assert:void 0,"gl-mat4/invert":void 0}],28:[function(e,t,r){"use strict"
r.getActiveController=getActiveController
r.setCharacterControllerAsActive=setCharacterControllerAsActive
r.setPhotoControllerAsActive=setPhotoControllerAsActive
r.getCurrentCameraPos=getCurrentCameraPos
r.getCurrentCameraTargetDir=getCurrentCameraTargetDir
r.getCurrentCameraUnderwater=getCurrentCameraUnderwater
r.setCurrentCameraPos=setCurrentCameraPos
r.setCurrentCameraTargetDir=setCurrentCameraTargetDir
r.checkCameraUnderwater=checkCameraUnderwater
r.shiftCurrentCameraPos=shiftCurrentCameraPos
r.updateCurrentCamera=updateCurrentCamera
r.updateAndGetViewMatrix=updateAndGetViewMatrix
r.getCurrentViewMatrix=getCurrentViewMatrix
r.getChunkViewMatrix=getChunkViewMatrix
r.setViewParameters=setViewParameters
r.getCameraMode=getCameraMode
r.setCameraModeRegular=setCameraModeRegular
r.changeCameraMode=changeCameraMode
r.handleCameraInput=handleCameraInput
r.CAMMODE_REGULAR=void 0
var a=1
var i=4
var o=a
r.CAMMODE_REGULAR=o
var n=2
var s=3
var l=i
var c=e("../glov/client/cmds.js").cmd_parse
var _=e("./controller_common.js").UP
var u=e("./debug.js")
var d=e("../glov/client/engine.js")
var f=e("../common/globals.js").CHUNK_SIZE
var v=e("../glov/client/input.js")
var h=e("./main.js")
var p=h.charControllerPos
var m=e("gl-mat4/lookAt")
var g=e("../glov/client/settings.js")
var E=e("./status.js")
var y=e("./tiles.js"),T=y.TILE_WATER,I=y.TILE_WATER_FLOW
var S=e("../glov/common/vmath.js"),A=S.mat4,w=S.m4TransformVec3,L=S.vec3,R=S.v3add,x=S.v3addScale,O=S.v3copy,b=S.v3iAdd,N=S.v3iFloor
var C=e("./voxel_data.js")
var M=e("./world_comm.js").getPerm
var D=d.defines.FREECAM&&d.DEBUG?n:o
var P
function getActiveController(){return P}function setCharacterControllerAsActive(){P=h.char_controller}function setPhotoControllerAsActive(){P=h.pht_controller}var k=L()
var B=L()
var U=false
function getCurrentCameraPos(){return k}function getCurrentCameraTargetDir(){return B}function getCurrentCameraUnderwater(){return U}function setCurrentCameraPos(e){O(k,e)}function setCurrentCameraTargetDir(e){O(B,e)}var G=L()
function checkCameraUnderwater(){O(G,k)
x(G,G,B,d.ZNEAR)
G[2]-=.01
N(G)
var e=C.getTileLocal(G,0,true)
U=e===T||e===I
if(d.defines.CAMERA&&U)u.addText("camera_underwater")}function shiftCurrentCameraPos(e){b(k,e)}function updateCurrentCamera(){setCurrentCameraPos(P.updateAndGetCameraPos())
setCurrentCameraTargetDir(P.getCameraTargetDir())
checkCameraUnderwater()}var F=L()
var W=A()
function updateAndGetViewMatrix(){R(F,k,B)
m(W,k,F,_)
return W}function getCurrentViewMatrix(){return W}var j=L()
var H=L()
var z=A()
function getChunkViewMatrix(){x(j,C.origin_chunk,P.getCameraPos(),1/f)
R(H,j,P.getCameraTargetDir())
m(z,j,H,_)
return z}function setViewParameters(e,t){e=e||updateAndGetViewMatrix()
if(t||!P.is_tpv)h.flashlight_pos_vs[0]=h.flashlight_pos_vs[1]=h.flashlight_pos_vs[2]=0
else w(h.flashlight_pos_vs,p(),e)
d.setGlobalMatrices(e)}g.register({camera_mode_max:{default_value:i,type:c.TYPE_INT,range:[a,i],help:"(Admin) Change maximum camera mode to cycle",access_run:["sysadmin"]}})
function getCameraMode(){return D}function setCameraModeRegular(){h.char_controller.updateCameraPos()
setCharacterControllerAsActive()
h.char_controller.setModeToWalk()
h.setExploreCanMovePht(true)
h.setExploreCanMoveChar(true)
D=o
E.push("Current Camera Mode: Regular")}function setCameraModeFreecam(){setCharacterControllerAsActive()
h.char_controller.setModeToFreeCam()
h.setExploreCanMovePht(true)
h.setExploreCanMoveChar(true)
D=n
E.push("Current Camera Mode: FreeCam")}function setCameraModeDetached(){h.char_controller.setModeToWalk()
if(D!==l)h.pht_controller.getParamsFromController(h.char_controller)
setPhotoControllerAsActive()
h.setExploreCanMovePht(false)
h.setExploreCanMoveChar(true)
D=s
E.push("Current Camera Mode: Detached")}function setCameraModeMoveCam(){h.char_controller.setModeToWalk()
if(D!==s)h.pht_controller.getParamsFromController(h.char_controller)
setPhotoControllerAsActive()
h.setExploreCanMovePht(true)
h.setExploreCanMoveChar(false)
D=l
E.push("Current Camera Mode: MoveCam")}function changeCameraMode(e){if(e===o)setCameraModeRegular()
else if(e===n)setCameraModeFreecam()
else if(e===s)setCameraModeDetached()
else if(e===l)setCameraModeMoveCam()
else console.warn("Invalid Camera Mode")}var V=false
function handleCameraInput(){var e=M("sysadmin")||d.DEBUG
if(v.keyDown(v.KEYS.V)&&1===g.camera_view){var t=-v.mouseWheel()
if(t+=.02*(v.keyDown(v.KEYS.PAGEUP)-v.keyDown(v.KEYS.PAGEDOWN))){V=true
g.set("camera_max_distance",g.camera_max_distance+t)}}if(v.keyUpEdge(v.KEYS.V)){if(!V)g.setAsync("camera_view",g.camera_view?0:1)
V=false}if(e)if(v.keyDown(v.KEYS.SHIFT)&&v.keyDownEdge(v.KEYS.F2))if(D===a)changeCameraMode(g.camera_mode_max)
else changeCameraMode(D-1)
else if(v.keyDownEdge(v.KEYS.F2))if(D>=g.camera_mode_max)changeCameraMode(a)
else changeCameraMode(D+1)}},{"../common/globals.js":197,"../glov/client/cmds.js":244,"../glov/client/engine.js":250,"../glov/client/input.js":271,"../glov/client/settings.js":291,"../glov/common/vmath.js":332,"./controller_common.js":40,"./debug.js":62,"./main.js":112,"./status.js":156,"./tiles.js":162,"./voxel_data.js":175,"./world_comm.js":182,"gl-mat4/lookAt":void 0}],29:[function(e,t,r){"use strict"
r.caveGenSphere=caveGenSphere
r.caveGenBoring=caveGenBoring
r.oreVeinGen=oreVeinGen
r.caveGenMaze=caveGenMaze
var I=e("assert")
var a=e("../glov/client/quat")
var T=a.qFromYPR
var S=a.qMult
var A=a.qTransformVec3
var i=a.quat
var o=e("../glov/client/rand_fast")
var n=o.randFastCreate
var Z=o.randSimpleSpatial
var s=e("../glov/common/util")
var w=s.easeIn
var l=s.inherits
var K=s.lerp
var c=e("../glov/common/vmath")
var d=c.ivec3
var L=c.v3copy
var X=c.v3distSq
var Q=c.v3iAdd
var R=c.v3iMax
var x=c.v3iMin
var O=c.v3iMul
var J=c.v3iNormalize
var $=c.v3scale
var b=c.v3set
var ee=c.v3sub
var N=c.vec2
var _=c.vec3
var u=c.vec4
var f=e("../common/globals")
var te=f.CHUNK_SIZE
var re=f.CS2
var v=e("../common/ids")
var ae=v.ITEM_CHEST_MEDIUM
var ie=v.ITEM_DOOR
var oe=v.ITEM_DOOR_DOUBLE
var ne=v.ITEM_INGOT
var se=v.ITEM_PLANT
var le=v.ITEM_TORCH
var ce=v.TYPE_ITEM
var _e=e("../common/materials_common").Mat
var h=e("./detail_gen_base")
var C=h.DetailGenBase
var p=h.blocksAlways
var m=h.blocksNever
var ue=h.bounds_z
var de=h.maxSurfaceClear
var fe=h.step_pos
var ve=h.surfaceCheckSetParams
var he=h.tryDeleteProp
var pe=h.tryPlaceProp
var g=e("./flora_constants")
var me=g.BROWN_MUSHROOMS
var ge=g.LUMINESCENT_MUSHROOMS
var Ee=g.RED_MUSHROOMS
var ye=e("./line2d").ptLineDistSqBBV
var E=e("./line3d")
var z=E.ptLineDist3DSqBBV
var Te=E.ptLineNearestBBV
var V=E.v3distSqBV
var y=e("./maze_gen")
var Ie=y.M_DOOR
var Se=y.M_INTERIOR
var M=y.M_LEAF
var Ae=y.M_TORCH
var we=y.M_TREASURE
var Le=y.M_WALL
var D=y.mazeGen
var Re=e("./proc_gen_biomes").world_noise3D
var P=e("./proc_gen_constants")
var xe=P.PROP_1x1x1
var Oe=P.PROP_1x2x4
var be=P.PROP_1x4x4
var Ne=P.PROP_2x1x4
var Ce=P.PROP_2x2x2
var Me=P.PROP_4x1x4
var k=e("./proc_gen_details")
var B=k.MAX_DETAIL_REACH
var U=k.f32Alloc
var G=e("./tiles")
var De=G.TILE_BRICK_STONE
var Pe=G.TILE_COAL
var Y=G.TILE_DIRT
var q=G.TILE_GRASS
var F=G.TILE_ORE_IN_STONE
var W=G.TILE_ORE_IN_STONE_DARK
var j=G.TILE_ORE_IN_STONE_LIGHT
var H=G.TILE_ORE_IN_STONE_RED
var ke=G.TILE_ORE_IN_VEINIUM
var Be=G.TILE_PROP_BASE
var Ue=G.TILE_STONE
var Ge=G.TILE_STONE_DARK
var Fe=G.TILE_STONE_LIGHT
var We=G.TILE_STONE_RED
var je=G.TILE_VEINIUM
var He=G.TILE_WATER
var ze=Math.abs,Ve=Math.acos,Ye=Math.cos,qe=Math.ceil,Ke=Math.floor,Ze=Math.max,Xe=Math.min,Qe=Math.round,Je=Math.sin,$e=Math.sqrt,et=Math.PI
var tt=false
var rt=n()
function CaveGenSphere(e,t,r){C.call(this)
rt.reseed(e)
this.origin=t.slice(0)
var a=this.r=rt.floatBetween(5,16)
this.boundsAlloc(1)
this.boundsPush(this.bounds_idx,t[0]-a,t[1]-a,t[2]-a,t[0]+a,t[1]+a,t[2]+a)}l(CaveGenSphere,C)
CaveGenSphere.prototype.type="CaveGenSphere"
CaveGenSphere.prototype.priority=100
CaveGenSphere.prototype.blocksOther=p
var at=[_e.WOOD,_e.LIGHT_WOOD,_e.DARK_WOOD,_e.RED_WOOD]
CaveGenSphere.prototype.genLocal=function(e){var t=e.vd,r=e.vs,a=e.non_spatial_rand
var i=t.data
if(!i)return
var o=r.map
var n=t.pos_world,s=t.props
var l=this.origin,c=this.r
var _=c*c
var u=r.owner_hexome.water_level
ve(o,u,n[2])
var d=l[2]-Qe(.25*c)
this.stepInit(n)
for(var f=0;f<te;++f){if(!this.stepY(f))continue
var v=o[f]
for(var h=0;h<te;++h){if(!this.stepX(h))continue
var p=f*te+h
var m=de(v,h,f)
var g=Xe(te,m-n[2]+1)
var E=fe[0]===l[0]&&fe[1]===l[1]
for(var y=0;y<g;++y,p+=re){var T=n[2]+y
fe[2]=T
if(!i[p])continue
if(X(fe,l)>_)continue
var I=l[2]-fe[2]
var S=0
var A=null
if(E&&fe[2]===d&&fe[2]<m-10)A={id:le,attr1:at[a.range(at.length)],size:xe}
else if(I>0){fe[2]-=I/2
if(X(fe,l)>_)if(ze(fe[0]-l[0])+ze(fe[1]-l[1])<1.99&&T<l[2]-c+1)S=ke
else if(E)S=a.random()>.8?ke:je
else if(I<3||a.random()>.75)continue
else S=Y
else if(E&&fe[2]<d)S=a.random()>.8?ke:je}var w=i[p]
if(w>=Be)if(!he(t,w,h,f,y))continue
if(A){i[p]=Be
if(!s)s=t.props={}
s[p]=A}else i[p]=S
t.full=false}}}}
function caveGenSphere(e,t,r){return new CaveGenSphere(e,t,r)}function randFloatExp(e,t){var r=rt.random()
return e+r*r*(t-e)}function randomQuatAngle(e){var t=rt.floatBetween(0,2*et)
var r=Ve(rt.floatBetween(-1,1))
T(e,t,r,0)}var it=_()
var ot=_()
var nt=_()
var st=i()
var lt=i()
var ct=_()
var _t=10
var ut=20
var dt=16
I(_t*ut+dt<B)
var ft=_()
var vt=6
function CaveGenBoring(e,t,r){C.call(this)
rt.reseed(e)
var a=rt.random()
var i=rt.random()
var o=0
if(a<.05)b(ft,.2,1,1)
else if(a<.1)b(ft,1,.2,1)
else if(a<.15)b(ft,1/3,1/3,1)
else if(a<.3)b(ft,1,1,.2)
else{b(ft,1,1,1)
if(i<.1)o=1}var n=randFloatExp(2,dt/2)
var s=randFloatExp(1,dt/2)
var l=rt.floatBetween(n,s)
var c=8+rt.range(_t+1-8)
randomQuatAngle(st)
var _=rt.floatBetween(.75*ut,ut)
var u=rt.floatBetween(et/4,et/2)
var d=rt.floatBetween(0,1)
this.boundsAlloc(c)
var f=this.bounds_idx
var v=vt+4*(c+1)
var h=U(v),p=h[0],m=h[1]
this.f32buf=p
var g=m
this.header_idx=m
p[m++]=ft[0]
p[m++]=ft[1]
p[m++]=ft[2]
p[m++]=d
p[m++]=o
p[m++]=i
this.origin_idx=m
function addPoint(){p[m++]=nt[0]*ft[0]
p[m++]=nt[1]*ft[1]
p[m++]=nt[2]*ft[2]
p[m++]=l}var E=this
function addLeg(e){L(it,nt)
L(ot,nt)
b(ct,0,0,_)
A(ct,ct,st)
O(ct,ft)
if(o)ct[2]=-ze(ct[2])
Q(nt,ct)
T(lt,rt.floatBetween(-u,u),rt.floatBetween(-u,u),0)
S(st,st,lt)
var t=l
l=rt.floatBetween(n,s)
t=Ze(t,l)+1
x(it,nt)
R(ot,nt)
f=E.boundsPush(f,it[0]-t/ft[0],it[1]-t/ft[1],it[2]-t/ft[2],ot[0]+t/ft[0],ot[1]+t/ft[1],ot[2]+t/ft[2])
addPoint()}L(nt,t)
addPoint()
for(var y=0;y<c;++y)addLeg(y)
I.equal(f,this.bounds_idx+6*this.bounds_len)
I.equal(m,g+v)}l(CaveGenBoring,C)
CaveGenBoring.prototype.type="CaveGenBoring"
CaveGenBoring.prototype.priority=100
CaveGenBoring.prototype.getDebugLines=function(){var e=this.origin_idx,t=this.f32buf,r=this.header_idx
var a=[]
for(var i=0;i<this.bounds_len;++i){var o=e+4*i
a.push([[t[o]/t[r],t[o+1]/t[r+1],t[o+2]/t[r+2]],[t[o+4]/t[r],t[o+5]/t[r+1],t[o+6]/t[r+2]]])}return a}
var ht=u()
var pt=u()
var mt=_()
CaveGenBoring.prototype.blocksOther=function(e,t,r,a){var i=e.blocked_r
var o=this.origin_idx,n=this.f32buf,s=this.header_idx
mt[0]=t[0]*n[s]
mt[1]=t[1]*n[s+1]
for(var l=0;l<this.bounds_len;++l)if(a&1<<l){var c=o+4*l
var _=(n[c+2]+n[c+6])/(2*n[s+2])
if(t[2]>_)mt[2]=t[2]
else if(t[2]+r<_)mt[2]=t[2]+r
else mt[2]=_
mt[2]*=n[s+2]
z(ht,n,c,c+4,mt)
var u=ht[1]
var d=K(ht[0],n[c+3],n[c+7])+.25
if(u<(d+=i)*d)return true}return false}
var gt=[]
gt[Fe]=j
gt[Ue]=F
gt[Ge]=W
gt[We]=H
var Et=.5
var yt=2.5
var Tt=.1
var It=.87
var St=.25
var At=new Array(32)
var wt=_()
var Lt=_()
CaveGenBoring.prototype.genLocal=function(e){var t=e.vd,r=e.vs,a=e.non_spatial_rand
var i=t.data
if(!i)return
var o=t.liquid
var n=r.map
var s=r.owner_hexome.water_level
var l=t.pos_world,c=t.props
var _=this.origin_idx,u=this.f32buf,d=this.header_idx
var f=u[d+3]
var v=u[d+4]
var h=u[d+5]
var p=!(Ke(1001*h)%4)
var m=!(Ke(10001*h)%3)
this.stepInit(l)
ve(n,s,l[2])
for(var g=0;g<te;++g){if(!this.stepY(g))continue
wt[1]=fe[1]*u[d+1]
var E=n[g]
for(var y=0;y<te;++y){var T=this.stepX(y)
if(!T)continue
wt[0]=fe[0]*u[d]
for(var I=0;I<T;++I)At[I]=_+4*ue[I]
var S=g*te+y
var A=de(E,y,g)
var w=false
var L=Xe(te,A-l[2]+1)
var R=false
for(var x=0;x<L;++x,S+=re){var O=l[2]+x
var b=false
var N=false
var C=false
var M=null
if(w&&i[S]>=Be)b=true
else{fe[2]=O
w=false
for(var D=0;D<T;++D){var P=At[D]
wt[2]=O*u[d+2]
Te(ht,u,P,P+4,wt)
var k=X(ht,wt)
var B=wt[2]-ht[2]
var U=k?B*B/k:1
if(B>0)U*=f
var G=(2*Re[0](wt[0]*Et,wt[1]*Et,.1*wt[2])-1)*(1-U)*3
wt[2]+=G
Te(ht,u,P,P+4,wt)
k=X(ht,wt)
var F=ht[3]
var W=K(F,u[P+3],u[P+7])
if(k<W*W){b=true
break}var j=$e(k)
if(v)if(O<A-5&&B<0&&j<W+v+.5){ye(pt,u,P,P+4,wt)
if(pt[1]<1.5)N=true}if(!N)if(j<W+yt)if(Re[0](fe[0]*Tt,fe[1]*Tt,fe[2]*Tt)>It&&a.random()<St){ee(Lt,wt,ht)
J(Lt)
$(Lt,Lt,W)
Q(Lt,ht)
Lt[0]/=u[d]
Lt[1]/=u[d+1]
Lt[2]=(Lt[2]-G)/u[d+2]
if(X(Lt,fe)<yt*yt)C=true}}if(b&&p&&O<A-30&&!R&&i[S-re]&&!N){R=true
var H=Re[0](.05*fe[0],.05*fe[1],.05*fe[2])
var z=a.range(100)
if(H>.5&&z>85)M={id:se,size:xe,attr3:me.key[a.range(me.key.length)]}
var V=500
if((H=Re[0](.05*fe[0]+V,.05*fe[1]+V,.05*fe[2]))>.7&&z>90)M={id:se,size:xe,attr3:Ee.key[a.range(Ee.key.length)]}
if(a.range(1e3)<1&&O<A-50)M={id:se,size:xe,attr3:ge.key[a.range(ge.key.length)]}}}if(N)if(!b)b=true
else N=false
if(b)C=false
if(!b&&!C)continue
var Y=i[S]
if(Y>=Be)if(!he(t,Y,y,g,x))continue
if(N){if(!o){t.alloc(true)
o=t.liquid}t.liquid_stable=false
o[S]=He}if(C){var q=gt[Y]
if(q)i[S]=m?Pe:q}else if(M){if(!c)c=t.props={}
c[S]=M
i[S]=Be
t.full=false}else if(b){i[S]=0
w=true
t.full=false}}}}}
function caveGenBoring(e,t,r){return new CaveGenBoring(e,t,r)}var Rt=[[Pe,null],[ke,je],[ke,je],[ke,je]]
function OreVeinGen(e,t,r){C.call(this,e,t,r)
rt.reseed(e)
var a=Rt[rt.range(Rt.length)]
this.ore_type=a[0]
this.stone_type=tt?0:a[1]
this.surface_offs=randFloatExp(-.66,1)
this.ore_r=randFloatExp(1,1.5)
var i=this.vein_r=this.ore_r+rt.floatBetween(1,3)
var o=rt.floatBetween(30,80)
var n=5+Ke((o-30)/50*4)
var s=o/(this.num_legs=n)
var l=randFloatExp(et/4,et/2)
this.center_factor=this.ore_type===Pe?1:.5
this.center_chance=this.ore_type===Pe?.9:.6
var c=N(rt.floatBetween(0,2*et),rt.floatBetween(0,2*et))
var _=c.slice(0)
this.boundsAlloc(2*n+1)
var u=this.bounds_idx
var d=2*(n+1)*4
var f=U(d),v=f[0],h=f[1]
this.f32buf=v
var p=h
this.origin_idx=h
var m=qe(this.ore_r+1)
u=this.boundsPush(u,t[0]-m,t[1]-m,t[2]-m,t[0]+m,t[1]+m,t[2]+m)
var g=1
function addPoint(){v[h++]=nt[0]
v[h++]=nt[1]
v[h++]=nt[2]
v[h++]=g}var E=this
function addLeg(e){L(it,nt)
L(ot,nt)
nt[0]+=Je(_[0])*s
nt[1]+=Ye(_[0])*s
nt[2]+=Ye(_[1])*s
_[0]+=rt.floatBetween(-l,l)
_[1]+=rt.floatBetween(-l,l)
x(it,nt)
R(ot,nt)
var t=g*i
u=E.boundsPush(u,it[0]-t,it[1]-t,it[2]-t,ot[0]+t,ot[1]+t,ot[2]+t)
g=w(1-(e+1)/n,2)
addPoint()}L(nt,t)
addPoint()
for(var y=0;y<n;++y)addLeg(y);(_=c)[0]+=et
_[1]+=et
g=1
L(nt,t)
addPoint()
for(var T=0;T<n;++T)addLeg(T)
I.equal(h,p+d)
I.equal(u,this.bounds_idx+6*this.bounds_len)}l(OreVeinGen,C)
OreVeinGen.prototype.type="OreVeinGen"
OreVeinGen.prototype.priority=10
OreVeinGen.prototype.blocksOther=m
OreVeinGen.prototype.checkBounds=function(e){e=this.bounds_idx+6*e
if(fe[0]<this.bounds_buf[e++]||fe[0]>=this.bounds_buf[e++]||fe[1]<this.bounds_buf[e++]||fe[1]>=this.bounds_buf[e++])return false
return true}
OreVeinGen.prototype.genLocal=function(e){var t=e.vd,r=e.vs,a=e.non_spatial_rand
var i=t.data
if(!i)return
var o=t.liquid
var n=r.map
var s=t.pos_world
var l=this.origin_idx,c=this.stone_type,_=this.ore_type,u=this.ore_r,d=this.vein_r,f=this.surface_offs,v=this.f32buf,h=this.num_legs,p=this.center_factor,m=this.center_chance
var g=h+1
var E
this.stepInit(s)
var y
for(var T=0;T<te;++T){if(!this.stepY(T))continue
var I=n[T]
for(var S=0;S<te;++S){var A=this.stepX(S)
if(!A)continue
for(var w=0;w<A;++w){var L=ue[w]
if(L)At[w]=l+4*(L-1)+(L>=g?4:0)
else At[w]=0}var R=T*te+S
var x=I[S].h
var O=x+Ke(f+.66*a.random())
var b=-1
for(var N=0;N<te;++N,R+=re){fe[2]=s[2]+N
var C=a.random()
if(fe[2]>O){var M=fe[2]-O
if(M>4)break
var D=N&&i[R-re]
if(!D||D>=Be)break
C-=.25*M}var P=false
for(var k=0;k<A;++k){var B=At[k]
if(!B){var U=Ze(0,u+2*C-1)
if(V(v,l,fe)>U*U)continue
E=_}else{z(ht,v,B,B+4,fe)
var G=ht[1]
var F=K(ht[0],v[B+3],v[B+7])
var W=Ze(0,F*d+2*C)
if(G>W*W)continue
if(G<p*F&&a.random()<m)E=_
else{if(null===c)continue
E=c}}P=true
break}if(!P)continue
var j=i[R]
if(j>=Be)if(!he(t,j,S,T,N))continue
i[R]=E
if(o)o[R]=0
if(fe[2]>x){var H=R-re
fe[2]--
while(H>=0&&fe[2]>=x&&(!i[H]||i[H]===q||i[H]===Y)){if(o)o[H]=0
i[H]=c
H-=re
fe[2]--}b=R}if(tt)t.full=false}if(-1!==b){if(!y)y=[]
y.push(b)}}}if(y&&a.random()<.75)i[y[a.range(y.length)]]=_}
function oreVeinGen(e,t,r){return new OreVeinGen(e,t,r)}var xt=16
function CaveGenMaze(e,t,r){C.call(this)
rt.reseed(e)
var a=this.size=Qe(randFloatExp(37,60))
this.origin=d(t[0]-a/2,t[1]-a/2,t[2])
var i=this.door_w=2+Ze(0,rt.range(5)-2)
var o={seed:e,w:a,h:a,min_dim:2+rt.range(2),door_w:i,r1:2+rt.range(7),treasure:4e-4,treasure_size:2}
var n=this.maze=D(o)
this.room_h=8
this.wood=at[rt.range(at.length)]
this.boundsAlloc(1)
this.boundsPush(this.bounds_idx,this.origin[0],this.origin[1],this.origin[2],this.origin[0]+a-1,this.origin[1]+a-1,this.origin[2]+this.room_h+xt-1)
var s=a*a-1
for(var l=a-1;l>=0;--l)for(var c=a-1;c>=0;--c,--s){var _=n[s]
if((15&_)===we)if((15&n[s-1])===we||(15&n[s-a])===we)n[s]=-16&_|M
else{var u=s
if((this.origin[0]+c)%te===te-1)--u
if((this.origin[1]+l)%te===te-1)u-=a
if(s!==u){n[u]=we|-16&n[u]
n[s]=-16&_|M}}}}l(CaveGenMaze,C)
CaveGenMaze.prototype.type="CaveGenMaze"
CaveGenMaze.prototype.priority=50
CaveGenMaze.prototype.dispose=function(){this.maze=null}
var Ot=d()
CaveGenMaze.prototype.genLocal=function(e){var t=e.vd,r=e.vs,a=e.non_spatial_rand
var i=t.data
if(!i)return
var o=t.liquid
var n=this.room_h,s=this.maze,l=this.size,c=this.door_w,_=this.seed,u=this.origin
var d=r.map
var f=r.owner_hexome.water_level
var v=t.pos_world,h=t.props
ve(d,f,v[2])
ee(Ot,v,u)
var p=Ze(-Ot[0],0)
var m=Xe(l-Ot[0],te)
var g=Ze(-Ot[1],0)
var E=Xe(l-Ot[1],te)
var y=[]
var T=[]
var I=0
for(var S=g;S<E;++S){var A=v[1]+S
var w=A-u[1]
var L=d[S]
for(var R=p;R<m;++R){var x=v[0]+R
var O=x-u[0]+w*l
var b=s[O]
var N=15&b
if(N===Le)continue
var C=b>>4
var M=de(L,R,S)
var D=Ot[2]-C
var P=Ze(-D,0)
var k=Xe(Xe(n-D,te),M-v[2])
var B=S*te+R+P*re
var U=u[2]-v[2]+C+1
if(U>=-4&&U<te){if(N===Ie&&(2===c||4===c)&&Z(_,x,A,u[2])<.25){var G=false
if((15&s[O-1])===Ie||(15&s[O-l])===Ie);else if((15&s[O+1])===Ie){if(R<=te-c){G=true
I=0}}else if((15&s[O+l])===Ie)if(S<=te-c){G=true
I=1}if(G)T.push([R,S,U,I])}if(N===we)y.push([R,S,U])}for(var F=P;F<k;++F,B+=re){var W=v[2]+F-u[2]-C
var j=i[B]
if(!j)continue
if(j>=Be)if(!he(t,j,R,S,F))continue
var H=0
if(N===Ie&&W>=5)H=5===W?Ue:De
else if(0===W||W===n-1)H=N===Se?Ue:De
else if(N===Ae&&4===W){H=Be
if(!h)h=t.props={}
h[B]={id:le,attr1:this.wood,size:xe}}if(!(i[B]=H))t.full=false
if(o)o[B]=0}}}for(var z=0;z<y.length;++z){var V=y[z]
pe(t,V,{id:ae,size:Ce,attr1:this.wood,rot:a.range(4),contents:[{type:ce,id:ne,attr1:_e.GOLD,count:3+a.range(4)}]})}for(var Y=0;Y<T.length;++Y){var q=T[Y]
var K=q[3]
pe(t,q,{id:4===c?oe:ie,size:4===c?K?be:Me:K?Oe:Ne,attr1:this.wood,rot:K})}}
function caveGenMaze(e,t,r){return new CaveGenMaze(e,t,r)}},{"../common/globals":197,"../common/ids":198,"../common/materials_common":201,"../glov/client/quat":287,"../glov/client/rand_fast":288,"../glov/common/util":330,"../glov/common/vmath":332,"./detail_gen_base":63,"./flora_constants":85,"./line2d":101,"./line3d":102,"./maze_gen":115,"./proc_gen_biomes":133,"./proc_gen_constants":134,"./proc_gen_details":136,"./tiles":162,assert:void 0}],30:[function(e,t,r){"use strict"
r.dirToLookAngle=dirToLookAngle
r.CharacterController=r.MAX_CAMERA_DISTANCE=r.CHAR_SIZES=r.CHAR_SIZE_SMALL=r.CHAR_SIZE_TALL=r.PLAYER_COL_HEIGHT=r.PLAYER_COL_WIDTH=void 0
var a,i
function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
return e}function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype)
_setPrototypeOf(e.prototype.constructor=e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){e.__proto__=t
return e})(e,t)}var o=e("../glov/common/vmath.js")
var s=o.v2add
var l=o.v2dist
var c=o.v2length
var _=o.v2scale
var u=o.v3add
var b=o.v3addScale
var N=o.v3copy
var C=o.v3distSq
var d=o.v3floor
var f=o.v3iAdd
var M=o.v3iNormalize
var v=o.v3iSub
var h=o.v3length
var D=o.v3lengthSq
var p=o.v3lerp
var n=o.v3scale
var P=o.v3sub
var m=o.vec2
var g=o.vec3
var E=o.zaxis
var k=o.zero_vec
var y=3
var T=.75
r.PLAYER_COL_WIDTH=T
var I=3.75
r.PLAYER_COL_HEIGHT=I
var S=.001
var A=1.5+S
var w=I-y
var B=.75
var L=g(0,0,-y+1.75)
var R=g(0,0,-y)
var x=10
var O=5
var U=20
var G="tall"
r.CHAR_SIZE_TALL=G
var F="small"
r.CHAR_SIZE_SMALL=F
var W=((a={})[G]={col_bounds:{min:g(-T,-T,-y+A),max:g(T,T,w)},eye_height:y,center_pos_offset:N(g(),L),feet_pos_offset:N(g(),R)},a[F]={col_bounds:{min:g(-T,-T,-y*B+A),max:g(T,T,w*B)},eye_height:y*B,center_pos_offset:n(g(),L,B),feet_pos_offset:n(g(),R,B)},a)
r.CHAR_SIZES=W
var j=e("assert")
var H=e("../glov/client/engine.js")
var z=e("../glov/client/error_report.js").errorReportSetDynamicDetails
var V=e("../glov/client/net.js")
var Y=V.netDisconnected
var q=V.netSubs
var K=e("../glov/client/ui.js").isMenuUp
var Z=e("../glov/client/urlhash.js")
var X=e("../glov/common/util.js")
var Q=X.lerp
var J=X.map01
var $=X.toNumber
var ee=e("../common/globals.js").CHUNK_SIZE
var te=e("../common/ids")
var re=te.ITEM_BUZZERGOAL
var ae=te.ITEM_LADDER
var ie=te.ITEM_SEEDS_CORN
var oe=te.ITEM_SEEDS_SUGAR_CANE
var ne=te.TYPE_ITEM
var se=e("../common/world_trans.js").decodeWorldPos
var le=e("./animation_enum.js").AnimEnum
var ce=e("./baking.js").bakedEmits
var _e=e("./base_controller.js")
var ue=_e.BaseController
var de=_e.MAX_STEP_DT
var fe=_e.MAX_TIMESLICE
var ve=_e.TODEG
var he=_e.TORAD
var pe=e("./build_mode.js")
var me=pe.doStamina
var ge=pe.playSoundForMaterial
var Ee=pe.tileMaterial
var ye=e("./camera.js")
var Te=ye.checkCameraUnderwater
var Ie=ye.getActiveController
var Se=ye.setCurrentCameraPos
var Ae=ye.setCurrentCameraTargetDir
var we=e("./client_entities")
var Le=we.adminWantsNoEntity
var Re=we.clientEntityForUser
var xe=we.getEntityManager
var Oe=we.getEntityPosManager
var be=e("./controller_common.js")
var Ne=be.movementShared
var Ce=be.rotationShared
var Me=be.updateFacing
var De=e("./controller_components/auto_crouch_comp.js").AutoCrouchComponent
var Pe=e("./controller_components/debug_comp.js").DebugComponent
var ke=e("./controller_components/feet_check_comp.js")
var Be=ke.FeetCheckComponent
var Ue=ke.makePropsOnOffset
var Ge=e("./controller_modes/fly_mode.js").FlyMode
var Fe=e("./controller_modes/freecam_mode.js").FreeCamMode
var We=e("./controller_modes/ladderclimbing_mode.js").LadderClimbingMode
var je=e("./controller_modes/mode_common.js")
var He=je.FLY_ID
var ze=je.FLY_MULT_MAX_SPEED
var Ve=je.FREECAM_ID
var Ye=je.LADDERCLIMBING_ID
var qe=je.MAX_SPEED
var Ke=je.SITTING_ID
var Ze=je.SWIMMING_ID
var Xe=je.WALK_ID
var Qe=je.WALK_SHIFT_MULT_SPEED
var Je=je.clampPhotoPosition
var $e=je.getFloorPos
var et=e("./controller_modes/sitting_mode.js").SittingMode
var tt=e("./controller_modes/swimming_mode.js").SwimmingMode
var rt=e("./controller_modes/walk_mode.js").WalkMode
var at=e("./debug.js")
var it=e("./huds.js").showStaminaDamage
var ot=e("./localization/localization").L
var nt=e("./main.js")
var st=e("./photo_mode.js")
var lt=st.getPhotoStartPosition
var ct=st.photoModeActive
var _t=st.photoModeCancel
var ut=e("./proc_gen_biomes.js").getElevationEstimate
var dt=e("./proc_gen_constants.js").SNOW_ELEVATION
var ft=e("./props.js")
var vt=ft.PREVIEW_HELD
var ht=ft.getForPreview
var pt=e("./quickbar.js").getSelectedVisible
var mt=e("./race_ui").raceReady
var gt=e("./settlement.js")
var Et=gt.settlementCurrent
var yt=gt.settlementLastBound
var Tt=e("./sky.js").getSkyPropsTime
var It=e("./state_machine.js").StateMachine
var St=e("./status.js").statusGet
var At=e("./ui_util.js").STAMINA_SYMBOL
var wt=e("./user_data.js")
var Lt=wt.flyingAllowed
var Rt=wt.isPlayAsViewer
var xt=wt.staminaUsageScale
var Ot=wt.userAttribGetSprintingStaminaScale
var bt=wt.userHomeSettlementID
var Nt=wt.userO2Cur
var Ct=wt.userO2Max
var Mt=wt.userStaminaCur
var Dt=wt.userStaminaMod
var Pt=e("./user_party.js")
var kt=Pt.partyGetParticipants
var Bt=Pt.partyIsActive
var Ut=e("./voxel_data.js")
var Gt=e("./voxel_data.js")
var Ft=Gt.getPropLighting
var Wt=Gt.getTileLocal
var jt=Gt.localPosFromWorldPos
var Ht=Gt.worldPosFromLocalPos
var zt=e("./waygate_ui.js").waygateSuppressAutoActivate
var Vt=e("./world_comm.js")
var Yt=e("./world_comm.js").getWorldChannel
var qt=e("./world_metadata.js")
var Kt=qt.adventureMode
var Zt=qt.worldMetadataFreePos
var Xt=qt.worldMetadataWaygate
var Qt=e("./worlds_sound.js").playSound
var Jt=e("./worlds_soundscape.js")
var $t=Jt.SoundScapeInstantMod
var er=Jt.SoundScapePeriodicMod
var tr=Jt.SoundScapeTag
var rr=Jt.addSSPeriodicModState
var ar=Jt.setSSInstantModState
var ir=Jt.soundscapeSetTag
var or=e("../glov/client/settings.js")
var nr=e("./tiles.js"),sr=nr.TILE_PROP_BASE,lr=nr.TILE_PROP_MAX,cr=nr.TILE_WATER,_r=nr.TILE_WATER_FLOW
var ur=e("./user_data.js")
var dr=Math.abs,fr=Math.ceil,vr=Math.cos,hr=Math.floor,pr=Math.min,mr=Math.random,gr=Math.round,Er=Math.sin,yr=Math.sqrt,Tr=Math.PI
var Ir=1.3
var Sr=12
r.MAX_CAMERA_DISTANCE=Sr
var Ar=[m(0,0),m(0,.4),m(0,-.4),m(1,.4),m(1,-.4)]
var wr=g()
var Lr=g()
var Rr=g()
var xr=((i={})[re]=true,i[ae]=true,i[ie]=true,i[oe]=true,i)
var Or=1e-4
var br=.05
var Nr=g()
var Cr=g()
var Mr=g()
var Dr=m()
var Pr=g()
var kr=g()
var Br={}
function updateOnGround(e){var t=e.pos[2]-e.eye_height
var r=$e(e,e.pos)
e.on_ground=false
if(t-r<.05)e.on_ground=true}var Ur=.02
var Gr=.04
var Fr=1500
var Wr=.05
var jr=15e3
function fallingDamageFromDeltaVelocity(e){var t=0
if(e<Ur)t=0
else if(e<Gr)t=Q(J(e,Ur,Gr),0,Fr)
else t=Q(J(e,Gr,Wr),Fr,jr)
if(t<500)return 0
return gr(t*xt())}var Hr=qe*Qe
var zr=qe*Qe*ze
var Vr=40
var Yr=20
function checkHasStaminaToRun(e){if(e.sprinting&&Mt()<=0){St("sprint_no_stamina").setMessage(ot.$(ot.STATUSMSG_CANNOT_SPRINT,At),1e3)
St("no_stamina_hint").setMessage(ot.STATUSMSG_CONSUME_OR_RETURN,1e3).noBounce()
e.sprinting=0}}function checkPosUnderwater(e,t){d(e,t)
var r=Wt(e,0,true)
return r===cr||r===_r}function dirToLookAngle(e){return Math.atan2(e[1],e[0])-Tr/2}var qr=g()
var Kr=""
var Zr=0
var Xr=1e3
var Qr="0,0,100,0,0"
var Jr
Z.register({key:"pos",change:function change(e){if(Jr)Jr.updatePosFromString(e,true)}})
z("pos",function(){if(!Jr||!nt.omp)return""
return"w/"+Vt.world_id+"?pos="+Jr.getPosString()})
function sitHandler(e,t,r){var a=r.new_look_angle
if(e.csm.getState()!==Ke)e.csm.transit(t,Ke)
if(void 0!==a&&!isNaN(a))e.head_angle[0]=a
e.head_angle[1]=0
e.look_angle=e.head_angle[0]
if(!or.camera_view&&!e.fpv_when_done){e.fpv_when_done=true
or.camera_view=true}}function setModeToWalkHandler(e,t){e.csm.transit(t,Xe)}function setModeToFreeCamHandler(e,t){e.csm.transit(t,Ve)}function useToolHandler(e,t,r){var a=r.look_angle,i=r.anim
if(e.csm.getState()===Ke)e.csm.transit(t,Xe)
if(null!==a&&e.csm.getState()!==Ye)e.look_angle=a
e.anim=i
e.anim_in_grace_time=true
e.animation_grace_time=0}function waveHandler(e,t){if(e.csm.getState()===Ke)e.csm.transit(t,Xe)
e.anim=le.WAVE
e.anim_in_grace_time=true
e.animation_grace_time=0
if(!or.camera_view){e.zoomed_out_tpv=true
e.camera_distance=2.1
e.zoom_timer=0}}var $r=1e3
var ea=300
var ta=function(n){_inheritsLoose(CharacterController,n)
function CharacterController(){var e
var t;(t=n.call(this,W[G])||this).csm=void 0
t.auto_crouch_comp=void 0
t.feet_check_comp=void 0
t.debug_comp=void 0
t.center_pos=g()
t.feet_pos=g()
t.root_pos=g()
t.on_ground=false
t.sizes=void 0
t.center_pos_offset=void 0
t.feet_pos_offset=void 0
t.camera_pos=g()
t.camera_distance=or.camera_max_distance
t.camera_height_scale=Ir
t.camera_dir=g()
t.dummy_camera_pos=g()
t.is_tpv=false
t.zoomed_in_fpv=false
t.zoomed_out_tpv=false
t.zoom_timer=0
t.camera_translation=void 0
t.jump_time=0
t.jump_ok=true
t.jumping_off=void 0
t.flying=false
t.can_doublejump_to_fly=true
t.jump_last_tap_time=0
t.jump_last_tap_frame=0
t.stamina_sprint_time_accum=0
t.stamina_swim_time_accum=0
t.fall_damage_shield=void 0
t.underwater={head:false,body:false,feet:false}
t.not_underwater_timer=Infinity
t.ladder_cooldown=0
t.dropped_from_ladder=void 0
t.ladder=void 0
t.fpv_when_done=void 0
t.props_collided={}
t.last_tick_props_collided={}
t.anim=le.IDLE
t.anim_secondary=le.IDLE
t.anim_in_grace_time=false
t.animation_grace_time=0
t.head_angle=m(0,0)
t.look_angle=100
t.lighting_values={force_opaque:true,scale_lights:true,torch_factor:0,sun_factor:1,torch_target:0,sun_target:1}
t.net_pos=new Float64Array(6)
t.follow_user_on_update=void 0
t.follow_user_on_load=void 0
t.just_jumped=void 0
t.just_landed=void 0
t.just_toggled_flying=false
t.just_stepped_into_water=void 0
var r=G
var a=F
t.sizes=W
t.csm=new It(_assertThisInitialized(t),[Ge,Fe,et,tt,rt,We],H.defines.FREECAM&&H.DEBUG?Ve:Xe)
t.center_pos_offset=t.sizes[r].center_pos_offset
t.feet_pos_offset=t.sizes[r].feet_pos_offset
var i="fly"
var o=Ue(t.sizes[r])
t.feet_check_comp=new Be(_assertThisInitialized(t),((e={})[r]=o,e[a]=Ue(t.sizes[a]),e[i]=o.concat(o.map(function(e){return u(g(),e,E)})),e),r)
t.auto_crouch_comp=new De(_assertThisInitialized(t),[Xe,Ke,Ze],a,r)
t.csm.addObserver(t.auto_crouch_comp)
t.debug_comp=new Pe(_assertThisInitialized(t))
t.updatePosFromString(null,false)
Jr=_assertThisInitialized(t)
return t}var e=CharacterController.prototype
e.setPosBase=function setPosBase(e){if(ct())Je(e,lt())
n.prototype.setPos.call(this,e)
this.updateSecondaryPos()
this.updatePropsOn()}
e.setPos=function setPos(e){this.setPosBase(e)
if(this.shouldUpdateOnGround())updateOnGround(this)}
e.shouldUpdateOnGround=function shouldUpdateOnGround(){switch(this.csm.getState()){case Ye:return!this.dropped_from_ladder
case Ze:case Xe:return true
default:return false}}
e.updateSecondaryPos=function updateSecondaryPos(){u(this.center_pos,this.pos,this.center_pos_offset)
u(this.feet_pos,this.pos,this.feet_pos_offset)}
e.updatePosFromString=function updatePosFromString(e,t){if(e&&(!t||Zt())){var r=e.split(",")
var a=true
for(var i=0;i<pr(r.length,3);++i){Mr[i]=$(r[i])
if(!isFinite(Mr[i]))a=false}for(var o=3;o<pr(r.length,5);++o){Dr[o-3]=$(r[o])
if(!isFinite(Dr[o-3]))a=false}if(r.length>=3&&a){jt(Mr,Mr)
if(!t){Mr[0]+=.004*mr()-.002
Mr[1]+=.004*mr()-.002
Mr[2]+=.004*mr()-.002}_t()
this.setPos(Mr)}else nt.chat_ui.addChatError(ot.$(ot.CHATERROR_INVALID_POS_STRING,e))
if(r.length>=5&&a){_(Dr,Dr,he)
this.updateYawPitch(Dr)}if(r.length>=6&&a)if(r[5].includes("f")&&Lt())this.flying=true
else this.flying=false
this.updateCameraPos()}var n=vr(-this.ypr[1])
this.facing[0]=Er(this.ypr[0])*n
this.facing[1]=vr(this.ypr[0])*n
this.facing[2]=Er(-this.ypr[1])
this.head_angle[0]=-this.ypr[0]
this.head_angle[1]=-this.ypr[1]
this.look_angle=this.head_angle[0]
if(Ie()===this){Se(this.camera_pos)
Ae(this.facing)
Te()}zt()}
e.getRootPos=function getRootPos(){b(this.root_pos,this.feet_pos,E,S)
return this.root_pos}
e.shift=function shift(e){n.prototype.shift.call(this,e)
f(this.camera_pos,e)
this.updateSecondaryPos()}
e.toggleSize=function toggleSize(e){var t=this.sizes[e],r=t.center_pos_offset,a=t.feet_pos_offset
var i=this.eye_height
this.updateSize(this.sizes[e])
this.center_pos_offset=r
this.feet_pos_offset=a
var o=g()
b(o,this.pos,E,this.eye_height-i)
this.setPosAndSmoothCam(true,o)
this.setPropsOnOffset(e)}
e.getClearanceHeight=function getClearanceHeight(){var e=this.sizes.small
return e.eye_height+e.col_bounds.max[2]}
e.updateCameraTranslation=function updateCameraTranslation(e,t){var r=t.pos,a=t.speed
N(this.camera_pos,e)
P(this.camera_pos,this.camera_pos,r)
p(this.camera_pos,a,this.camera_pos,e)
P(r,e,this.camera_pos)
if(D(r)<Or)this.camera_translation=null}
e.updateCameraPos=function updateCameraPos(){if(!this.zoomed_in_fpv&&(this.zoomed_out_tpv||or.camera_view)){this.is_tpv=true
b(Nr,this.pos,this.facing,-this.camera_distance)
b(Nr,Nr,this.char_up,this.camera_height_scale)}else{this.is_tpv=false
N(Nr,this.pos)}if(this.camera_translation)this.updateCameraTranslation(Nr,this.camera_translation)
else N(this.camera_pos,Nr)}
e.setPosAndSmoothCam=function setPosAndSmoothCam(e,t,r){if(e)if(this.camera_translation){f(this.camera_translation.pos,t)
v(this.camera_translation.pos,this.pos)
this.camera_translation.speed=r||br}else{this.camera_translation={pos:g(),speed:r||br}
P(this.camera_translation.pos,t,this.pos)}this.setPosBase(t)}
e.updateAndGetCameraPos=function updateAndGetCameraPos(){this.updateCameraPos()
return this.getCameraPos()}
e.isAerial=function isAerial(){var e=this.csm.getState()
return e===Ze||e===He||e===Ve}
e.getNetAnimState=function getNetAnimState(){var e=pt()
j(e)
j(e.type)
return{anim:this.anim,anim_secondary:this.anim_secondary,held_item:e}}
e.update=function update(e){profilerStart("input")
if(this.follow_user_on_update){this.updatePosFollowUser(this.follow_user_on_update)
this.follow_user_on_update=null
Z.set("u","")
Z.set("action","")}if(K())e=false
var t=me()
var r=pt()
var a=!xe().checkNet()
if(!a)e=false
if(e&&this.flying&&!Lt())this.flying=false
var i=pr(H.frame_dt,fe)
this.animation_grace_time+=i
if(this.animation_grace_time>500&&this.anim_in_grace_time)this.anim_in_grace_time=false
if(this.csm.getState()!==Ye&&this.ladder_cooldown>0)this.ladder_cooldown-=i
N(Cr,this.vel)
var o=Ne(this,i,e)
if(mt())N(o,k)
if(t)checkHasStaminaToRun(o)
var n=-1
var s=.5
this.underwater.head=checkPosUnderwater(kr,this.pos)
N(Mr,this.pos)
Mr[2]+=n*(this.getCrouched()?B:1)
this.underwater.body=checkPosUnderwater(kr,Mr)
if(this.underwater.body)this.not_underwater_timer=0
else this.not_underwater_timer+=i
var l=this.underwater.feet
N(Mr,this.feet_pos)
Mr[2]+=s
this.underwater.feet=checkPosUnderwater(kr,Mr)
this.just_stepped_into_water=!l&&this.underwater.feet
if(e)Ce(this,i)
Me(this)
for(var c in this.last_tick_props_collided)if(!this.last_tick_props_collided[c].existsInWorld())delete this.last_tick_props_collided[c]
var _={frame_time_sprinting:0,frame_time_swimming:0}
if(i>0){profilerStopStart("tick")
var u=i
while(u>0){var d=pr(u,de)
var f=void 0
f=this.csm.tick({dt:d,impulse:o,do_stamina:t})||Br
_.frame_time_sprinting+=f.frame_time_sprinting||0
_.frame_time_swimming+=f.frame_time_swimming||0
u-=d
for(var v in this.props_collided)if(this.props_collided[v].collisionInteract)this.props_collided[v].collisionInteract(u)
this.last_tick_props_collided=this.props_collided
this.props_collided={}}}profilerStopStart("bottom")
if(H.defines.CAMERA&&Ie()===this)this.setDebugFloorInfo()
if(t){var h=0
this.stamina_sprint_time_accum+=_.frame_time_sprinting
var p=Vr/Ot()
if(this.stamina_sprint_time_accum>=p){var m=hr(this.stamina_sprint_time_accum/p)
this.stamina_sprint_time_accum-=m*p
h+=m}this.stamina_swim_time_accum+=_.frame_time_swimming
p=Yr/xt()
if(this.stamina_swim_time_accum>=p){var g=hr(this.stamina_swim_time_accum/p)
this.stamina_swim_time_accum-=g*p
h+=g}if(this.getCrouched())h*=2
var E
if(this.fall_damage_shield){this.fall_damage_shield-=i
if(this.fall_damage_shield<=0){this.fall_damage_shield=0
St("fall_damage_shield").remove()}else{var y=fr(this.fall_damage_shield/1e3)
St("fall_damage_shield").setMessage(ot.STATUSMSG_FALL_DAMAGE_SHIELD.$({val:y}))}}else if(!(this.csm.getState()===He)){for(var T=0;T<3;++T)if(Cr[T]>0&&this.vel[T]<Cr[T])Pr[T]=pr(Cr[T],Cr[T]-this.vel[T])
else if(Cr[T]<0&&this.vel[T]>Cr[T])Pr[T]=pr(-Cr[T],-(Cr[T]-this.vel[T]))
else Pr[T]=0
if(E=fallingDamageFromDeltaVelocity(yr(D(Pr)))){h+=E
it(E,"fall damage")}}if(h)Dt(null,-h)
if(E)Qt("fall_damage")}this.updateHeldTorchFactor()
Ft(this.lighting_values,this.pos,true)
if(H.defines.CAMERA&&Ie()===this)this.addControllerDebugText()
j(r)
j(r.type)
if(a)Oe().updateMyPos(this.getNetPos(),this.getNetAnimState())
this.updateHistoryFromPos()
var I=0
var S=0
b(this.dummy_camera_pos,this.pos,this.facing,-or.camera_max_distance)
b(this.dummy_camera_pos,this.dummy_camera_pos,this.char_up,Ir)
P(this.camera_dir,this.dummy_camera_pos,this.pos)
M(this.camera_dir)
for(var A=0;A<5;A++){var w=Ar[A]
b(kr,this.pos,this.char_right,w[0]*w[1])
b(kr,kr,this.char_up,(1-w[0])*w[1])
if(Ut.raycast3DLocal(wr,Lr,Rr,kr,this.camera_dir,or.camera_max_distance,null,null,xr)){I++
S+=C(kr,Rr)}}while(i>0){var L=pr(i,8)
var R=.005*L
this.zoom_timer+=L
var x=void 0
if(this.zoomed_out_tpv){x=J(this.zoom_timer,0,2500)
x=Er(x*Tr)}if(I){var O=yr(S/I)-.5
if(O<this.camera_distance)R=.05*L
if(this.zoomed_out_tpv&&O<4){this.camera_distance=0
this.zoomed_out_tpv=false
this.zoom_timer=0}if(this.zoomed_out_tpv)this.camera_distance=Q(x,2,O)
else this.camera_distance=Q(R,this.camera_distance,O)
this.camera_height_scale=Q(this.camera_distance/Sr,0,Ir)}else{if(this.zoomed_out_tpv)this.camera_distance=Q(x,2,Sr/1.8)
else if(dr(this.camera_distance-or.camera_max_distance)>.03)this.camera_distance=Q(R,this.camera_distance,or.camera_max_distance)
this.camera_height_scale=Q(this.camera_distance/Sr,0,Ir)}i-=8}if(this.camera_distance<2)this.zoomed_in_fpv=true
else if(this.zoomed_in_fpv&&this.camera_distance>4){this.camera_distance=2
this.zoomed_in_fpv=false}if(this.camera_distance<2&&this.zoomed_out_tpv){this.zoomed_out_tpv=false
this.zoom_timer=0}this.handleCharacterSound()
profilerStop()}
e.forceUpdatePos=function forceUpdatePos(){if(!xe().checkNet()){Oe().updateMyPos(this.getNetPos(),this.getNetAnimState(),true)
return true}return false}
e.setFallDamageShield=function setFallDamageShield(e){if(me())this.fall_damage_shield=1e3*e}
e.sitOnBlock=function sitOnBlock(){d(qr,this.pos)
qr[2]-=Math.ceil(this.controller_height)
var e=this.getCardinalFacing()
s(qr,qr,e)
var t=Wt(qr,0,false)
if(!this.on_ground||this.csm.getState()===Ye)nt.chat_ui.addChat(ot.MSG_NOWHERE_TO_SIT)
else if(this.csm.getState()===Ke)nt.chat_ui.addChat(ot.MSG_ALREADY_SAT_DOWN)
else if(t)this.sit()
else this.sit(dirToLookAngle(e))}
e.sitOnChair=function sitOnChair(e,t){e[2]+=this.eye_height
this.setPosAndSmoothCam(this.is_tpv,e)
this.sit(t)}
e.sit=function sit(e){this.csm.addHandlingCB(sitHandler,{new_look_angle:e=e||void 0})}
e.setModeToWalk=function setModeToWalk(){this.csm.addHandlingCB(setModeToWalkHandler)}
e.setModeToFreeCam=function setModeToFreeCam(){this.csm.addHandlingCB(setModeToFreeCamHandler)}
e.useTool=function useTool(e,t){this.csm.addHandlingCB(useToolHandler,{look_angle:e,anim:t})}
e.wave=function wave(){this.csm.addHandlingCB(waveHandler)}
e.load=function load(e){var t=this.follow_user_on_load&&this.updatePosFollowUser(this.follow_user_on_load)
if(!this.follow_user_on_load&&Bt()){var r=kt()
for(var a=0;a<r.length;a++){var i=r[a]
if(this.updatePosFollowUser(i.user_id)){this.follow_user_on_load=i.user_id
t=true
break}}}this.follow_user_on_update=this.follow_user_on_load
this.follow_user_on_load=null
if(!t)this.updatePosFromString(ur.get("pos")||e||Qr,false)
var o=Array.prototype.slice.call(this.getNetPos(),0)
j(6===o.length)
var n={pos:o}
if(Le())n.want_no_ent=true
Yt().send("ent_join",n,function(e){if(e)console.warn("Received error response to ent_join: "+e)})}
e.enterWorldInit=function enterWorldInit(){N(this.vel,k)}
e.setFollowUserOnLoad=function setFollowUserOnLoad(e){this.follow_user_on_load=e}
e.followUserGo=function followUserGo(e){if(this.updatePosFollowUser(e)){this.follow_user_on_update=e
return true}return false}
e.updatePosFollowUser=function updatePosFollowUser(e){if(e===q().loggedIn())return false
if(!ur.followUserAllowed())return false
var t=Re(e)
if(!t)return false
var r=t.data.pos
var a=r[3]
var i=(or.camera_view?U:O)*he
var o=r[0]-Er(a)*x
var n=r[1]-vr(a)*x
var s=r[2]+y
this.updatePosFromString(o+","+n+","+s+","+a*ve+","+i*ve,true)
return true}
e.getNetPos=function getNetPos(){var e=Ut.origin_chunk
var t=this.pos
var r=this.net_pos
r[0]=t[0]+e[0]*ee
r[1]=t[1]+e[1]*ee
r[2]=t[2]-this.eye_height+e[2]*ee
r[3]=-this.head_angle[0]
r[4]=-this.head_angle[1]
r[5]=this.look_angle
if(r[4]>-.1&&r[4]<.2)r[4]=0
return r}
e.updateHistoryFromPos=function updateHistoryFromPos(){var e=this.getPosString()
if(Y())return
if(Rt()&&Kt())return
if(e!==Kr&&H.frame_timestamp-Zr>Xr){Zr=H.frame_timestamp
Kr=e
ur.set("pos",e)
ur.set("pos_adv",me()?1:0)
ur.set("wg",Z.get("wg"))
Z.setMulti({w:nt.omp?Vt.world_id:"",pos:Zt()&&or.live_url?e:""})}}
e.clearPos=function clearPos(){Zr=H.frame_timestamp
Kr=""
Z.set("pos","")}
e.updateHeldTorchFactor=function updateHeldTorchFactor(){var e=pt()
if(!e)return
if(e.type===ne&&(e.need_thumbnail_update||e.thumbnail_updated)){var t=ht(e,vt)
if(t&&t.baked&&t.baked.key){var r=ce(t.baked.key)
if(r)this.lighting_values.torch_factor=r}}}
e.handleCharacterSound=function handleCharacterSound(){if(this.just_jumped){this.just_jumped=false
Qt("jump")}if(this.just_landed){this.just_landed=false
d(Mr,this.pos)
Mr[2]-=Math.ceil(this.controller_height)
var e=Ut.getTileLocal(Mr,0,false)
if(e>=sr&&e<=lr){var t=Ut.andGetProp()
ge("land",null==t?void 0:t.getMaterial())}else ge("land",Ee(e))}if(this.just_toggled_flying){this.just_toggled_flying=false
Qt(this.flying?"character_enter_flying":"character_exit_flying")}if(this.just_stepped_into_water){this.just_stepped_into_water=false
Qt("character_enter_water")}rr(er.O2Attribute,1-Nt()/Ct())
var r=yt()
var a
if(r)a=r.world_pos
else if(r=Xt(bt())){a=g()
se(a,r.pos[0],r.pos[1])}if(r){Ht(Mr,this.pos)
ar($t.DistHorizontal,l(Mr,a)/$r)
ar($t.DistVertical,dr(a[2]-Mr[2])/ea)}if(this.flying){ar($t.IsFlying,1)
rr(er.VelFly,h(this.vel)/zr)
rr(er.VelHorizontal,0)
rr(er.VelVertical,0)}else{ar($t.IsFlying,0)
rr(er.VelFly,0)
rr(er.VelHorizontal,c(this.vel)/Hr)
rr(er.VelVertical,dr(this.vel[2])/Wr)}var i=Tt()
Ht(Mr,this.pos)
var o=ut(Mr)
b(Mr,this.pos,Ut.origin_chunk,ee)
ir(tr.Home,Boolean(Et()))
ir(tr.Night,i<5||i>22)
ir(tr.Underground,Mr[2]<o-15)
ir(tr.Snow,Mr[2]>dt+5)}
e.getPropsOn=function getPropsOn(){return this.feet_check_comp.getPropsOn()}
e.setPropsOnOffset=function setPropsOnOffset(e){return this.feet_check_comp.setPropsOnOffset(e)}
e.updatePropsOn=function updatePropsOn(){return this.feet_check_comp.updatePropsOn()}
e.getCrouched=function getCrouched(){return this.auto_crouch_comp.getCrouched()}
e.getCanCrouch=function getCanCrouch(){return this.auto_crouch_comp.getCanCrouch()}
e.getCrouchEyeHeightOffset=function getCrouchEyeHeightOffset(){return this.auto_crouch_comp.getCrouchEyeHeightOffset()}
e.getCrouchColBounds=function getCrouchColBounds(){return this.auto_crouch_comp.getCrouchColBounds()}
e.getUncrouchColBounds=function getUncrouchColBounds(){return this.auto_crouch_comp.getUncrouchColBounds()}
e.crouch=function crouch(){return this.auto_crouch_comp.crouch()}
e.uncrouch=function uncrouch(){return this.auto_crouch_comp.uncrouch()}
e.addControllerDebugText=function addControllerDebugText(){this.debug_comp.addControllerDebugText()
var e=[]
var t=[]
if(this.on_ground)e.push("On Ground")
if(this.lighting_values)e.push("Torch: "+this.lighting_values.torch_factor.toFixed(3)+"  Sun: "+this.lighting_values.sun_factor.toFixed(3))
var r=this.underwater
for(var a in r)if(r[a])t.push(a+"_underwater")
if(t.length)e.push(t.join(" "))
at.addText(e.join("\n"))}
e.setDebugFloorInfo=function setDebugFloorInfo(){return this.debug_comp.setDebugFloorInfo()}
return CharacterController}(ue)
r.CharacterController=ta},{"../common/globals.js":197,"../common/ids":198,"../common/world_trans.js":213,"../glov/client/engine.js":250,"../glov/client/error_report.js":255,"../glov/client/net.js":279,"../glov/client/settings.js":291,"../glov/client/ui.js":306,"../glov/client/urlhash.js":307,"../glov/common/util.js":330,"../glov/common/vmath.js":332,"./animation_enum.js":8,"./baking.js":17,"./base_controller.js":18,"./build_mode.js":27,"./camera.js":28,"./client_entities":35,"./controller_common.js":40,"./controller_components/auto_crouch_comp.js":41,"./controller_components/debug_comp.js":43,"./controller_components/feet_check_comp.js":44,"./controller_modes/fly_mode.js":46,"./controller_modes/freecam_mode.js":47,"./controller_modes/ladderclimbing_mode.js":48,"./controller_modes/mode_common.js":49,"./controller_modes/sitting_mode.js":51,"./controller_modes/swimming_mode.js":52,"./controller_modes/walk_mode.js":53,"./debug.js":62,"./huds.js":87,"./localization/localization":108,"./main.js":112,"./photo_mode.js":128,"./proc_gen_biomes.js":133,"./proc_gen_constants.js":134,"./props.js":141,"./quickbar.js":142,"./race_ui":144,"./settlement.js":148,"./sky.js":151,"./state_machine.js":155,"./status.js":156,"./tiles.js":162,"./ui_util.js":168,"./user_data.js":170,"./user_party.js":172,"./voxel_data.js":175,"./waygate_ui.js":179,"./world_comm.js":182,"./world_metadata.js":186,"./worlds_sound.js":187,"./worlds_soundscape.js":188,assert:void 0}],31:[function(e,t,r){"use strict"
r.customizationPendingChanges=customizationPendingChanges
r.characterCustomizationMenuStartup=characterCustomizationMenuStartup
r.characterCustomizationMenuInit=characterCustomizationMenuInit
r.saveCostume=saveCostume
r.renamePrompt=renamePrompt
r.cantSavePrompt=cantSavePrompt
r.costumeSetOnPurchase=costumeSetOnPurchase
r.handleBottomButton=handleBottomButton
r.doCharacterCustomization=doCharacterCustomization
var i=e("assert")
var E=e("../glov/client/camera2d")
var y=e("../glov/client/engine")
var g=e("../glov/client/input")
var a=e("../glov/client/net")
var o=a.netDisconnected
var n=a.netSubs
var T=e("../glov/client/scroll_area").scrollAreaCreate
var s=e("../glov/client/sprite_animation").spriteAnimationCreate
var l=e("../glov/client/sprites").spriteCreate
var P=e("../glov/client/ui")
var c=e("../glov/common/util")
var _=c.clone
var O=c.dateToSafeLocaleString
var u=c.deepEqual
var d=c.msToTimeString
var f=e("../glov/common/vmath").vec2
var I=e("../common/entitlements").entitlementForCostume
var S=e("./cosmetic_thumbnails.js").cosmeticGetImage
var v=e("./cosmetics")
var h=v.CosmeticRarities
var p=v.Parts
var k=v.cosmetic_ownerships
var b=v.cosmetics_rarity_info
var A=v.costumeDisplayName
var B=v.costume_dict
var m=v.getCosmeticsAvailability
var w=v.getCosmeticsOwnerships
var U=v.getRarityColors
var L=v.getRarityFromCostumes
var N=v.getRarityStyle
var R=v.getSwapColors
var G=v.isCostume
var C=v.isPart
var F=v.isSwap
var W=v.parts_dict
var x=v.swaps_dict
var M=e("./costume_edit.js")
var D=M.costumeCurrent
var j=M.costumeSet
var H=M.incrementCurCostumeMod
var z=e("./in_app_purchases/iap_client_worlds")
var V=z.iapEnabled
var Y=z.iapMakePurchase
var q=z.iapProductPrice
var K=e("./layout")
var X=K.CORNER_BUTTON_MARGIN
var Q=K.WIDE
var J=K.layoutCameraTallWideMode
var $=e("./localization/localization")
var ee=$.DURATION_ONLY_DAYS
var te=$.L
var re=e("./main")
var ae=e("./main_menu")
var ie=ae.mainMenu
var oe=ae.showCurrentGems
var ne=ae.welcomeScreenInit
var se=e("./menu")
var le=e("./paperdoll").doPaperDoll
var ce=e("./red_dot").redDotSeen
var _e=e("./store")
var ue=_e.gemPurchase
var de=_e.getProductIdGemCost
var fe=e("./styles")
var ve=fe.chat_style_error
var he=fe.color_black_30
var pe=fe.color_transparent
var me=fe.color_white_30
var ge=fe.color_white_50
var Ee=fe.colors_gems
var ye=fe.colors_green
var Te=fe.flavour_text_style
var Ie=fe.menu_header_style
var Se=fe.menu_style
var Ae=fe.white_label_style
var we=e("./ui_util")
var Le=e("./ui_util_2")
var Re=e("./world_comm").myUserCmdParse
var xe;(function(e){e[e["COSTUMES"]=0]="COSTUMES"
e[e["HEADS"]=1]="HEADS"
e[e["TORSOS"]=2]="TORSOS"
e[e["ARMS"]=3]="ARMS"
e[e["LEGS"]=4]="LEGS"
e[e["COLORS"]=5]="COLORS"})(xe=xe||{})
var Oe=xe.COSTUMES
var be=true
var Ne;(function(e){e[e["SKIN"]=0]="SKIN"
e[e["HAIR"]=1]="HAIR"
e[e["EYES"]=2]="EYES"})(Ne=Ne||{})
function getSubmenuFromName(e){return"number"===typeof Ne[e]?Ne[e]:-1}var Ce=false
var Me
var De=[]
var Pe=[]
var ke
var Be=[]
var Ue=[]
var Ge=[]
var Fe=[]
var We=[]
var je=[[],[],[]]
var He=[Be,Ue,Ge,Fe,We]
function customizationPendingChanges(){return Ce}function resetItemLists(){Ce=false
for(var e=0;e<He.length;e++)He[e].length=0
for(var t=0;t<je.length;t++)je[t].length=0}function orderItemsAlphabetically(e,t){var r=e.display_name_key?te.get(e.display_name_key):e.display_name
var a=t.display_name_key?te.get(t.display_name_key):t.display_name
if(!r)r=""
if(!a)a=""
return(r=r.toString().toLowerCase())>a.toString().toLowerCase()?1:-1}function orderItemsOwnership(e,t){if(F(e)){i(F(t))
return Number(k[t.swap_key]||false)-Number(k[e.swap_key]||false)}return Number(k[t.name]||false)-Number(k[e.name]||false)}function orderItemsRarity(e,t){return h[t.rarity||"LEGENDARY"]-h[e.rarity||"LEGENDARY"]}var ze={ALPHABETIC:orderItemsAlphabetically,OWNERSHIP:orderItemsOwnership,RARITY:orderItemsRarity}
function filterItemsAvailable(e){var t
if(F(e))t=k[e.swap_key]||false
else t=k[e.name]||false
return t||e.available}var Ve={AVAILABLE:filterItemsAvailable}
function orderItems(e){var t=[Be,Ue,Ge,Fe,We,je[Ne.SKIN],je[Ne.HAIR],je[Ne.EYES]]
var r=ze[e]
for(var a=0;a<t.length;a++)t[a].sort(r)}function filterItems(e){var t=[Be,Ue,Ge,Fe,We,je[Ne.SKIN],je[Ne.HAIR],je[Ne.EYES]]
var r=Ve[e]
for(var a=0;a<t.length;a++){var i=t[a].filter(r)
for(var o=t[a].length=0;o<i.length;o++)t[a].push(i[o])}}var Ye
var qe=24
var Ke=1.5*qe
var Ze=1920
var Xe=810
var Qe=[]
var Je
var $e
var et
var tt
var rt
var at
var it
function getSprites(){Je=we.sprite
$e=Le.sprite
et=l({url:"img/ui/locked.png",filter_min:gl.LINEAR,filter_mag:gl.LINEAR,origin:f(.5,.5)})
tt=l({url:"img/ui/round_alert.png",filter_min:gl.LINEAR,filter_mag:gl.LINEAR,origin:f(.5,.5)})
rt=l({url:"img/ui/cosmetic_highlighted.png",filter_min:gl.LINEAR,filter_mag:gl.LINEAR,origin:f(.5,.5)})
at=l({name:"clock",ws:[32,32,32,32,32,32,32,32],hs:[32],origin:f(.5,.5)});(it=s({rotate:{frames:[0,1,2,3,4,5,6,7],times:[500,125,125,125,125,125,125,125]}})).setState("rotate")
P.loadUISprite("cosmetic_selected",[40,48,40],[256])
P.loadUISprite("cosmetic_unselected",[40,48,40],[256])
P.loadUISprite("cosmetic_placeholder",[40,48,40],[256])}function getTimeLeftString(e){var t=e-Date.now()
if(t<=0)return""
else if(t<1728e5)return d(t,{hide_ms:true})
else{var r=Math.floor(.001*t)
return""+te.duration(r,ee)}}function getListFromBone(e){if("head"===e.bone)return Ue
else if("torso"===e.bone)return Ge
else if("arm_r"===e.bone)return Fe
else if("leg_r"===e.bone)return We
return null}function getItemByName(e,t){var r
if(!t)return r
var a="string"===typeof t?t:t.name
for(var i=0;i<e.length;i++)if(e[i].name===a)return e[i]
return r}function getCosmetics(){for(var e in B)if("preview"!==e){var t=B[e]
Be.push(t)}for(var r in W){var a=W[r]
var i=getListFromBone(a)
if(i){a.rarity=L(a.costumes||[])
i.push(a)}}for(var o in x){var n=x[o]
var s=getSubmenuFromName(n.type.toUpperCase())
if(-1!==s){n.rarity=n.is_default?h[0]:L(n.costumes||[])
n.color_submenu=s
je[s].push(n)}}}function getCurrentSelectionFromCostume(e){De[xe.COSTUMES]=getItemByName(Be,e.name)
De[xe.HEADS]=getItemByName(Ue,e.parts[p.HEAD])
De[xe.TORSOS]=getItemByName(Ge,e.parts[p.TORSO])
De[xe.ARMS]=getItemByName(Fe,e.parts[p.ARM_R])
De[xe.LEGS]=getItemByName(We,e.parts[p.LEG_R])
var t=e.swaps||{}
Pe[Ne.SKIN]=getItemByName(je[Ne.SKIN],t.skin)
Pe[Ne.HAIR]=getItemByName(je[Ne.HAIR],t.hair)
Pe[Ne.EYES]=getItemByName(je[Ne.EYES],t.eyes)}var ot=false
function getInitialPreview(){var e=D()
var t=B[e.name]
B.preview=_(t)
if(B.preview&&"custom"===B.preview.name){for(var r=0;r<B.preview.parts.length;r++){var a=B.preview.parts[r].name
var i=W[a]
if(i.available_swaps&&i.available_swaps.length>1){var o=0
for(var n=0;n<i.available_swaps.length;n++)if(u(i.available_swaps[n],B.preview.parts[r].swaps)){o=n
break}if(o>0){B.preview.parts[r].name+="_V"+(o+1)
B.preview.attachments[r].name+="_V"+(o+1)
B.preview.attachments[r].variant=i.available_swaps.length}}}B.preview.is_custom=true}getCurrentSelectionFromCostume(B.preview)
ke=De[xe.COSTUMES]
ot=true}function onChannelData(e,t){if(t&&t.startsWith("public.permissions.owned")){characterCustomizationMenuInit(true)
checkSaveEnabled()}else if(t&&t.startsWith("public.costume")){getInitialPreview()
H()}}var nt
function customizationOnLogout(){if(nt){nt.removeListener("channel_data",onChannelData)
nt=null}}function customizationOnLogin(){customizationOnLogout();(nt=n().getMyUserChannel()).on("channel_data",onChannelData)}function characterCustomizationMenuStartup(){n().onLogin(customizationOnLogin)
n().on("logout",customizationOnLogout)
getSprites()
R()}function characterCustomizationMenuInit(e){resetItemLists()
w()
m()
getCosmetics()
filterItems("AVAILABLE")
orderItems("ALPHABETIC")
orderItems("RARITY")
orderItems("OWNERSHIP")
Oe=xe.COSTUMES
if(!e)ot=false
be=true}function itemButton(e,t){var r=P.font
if(G(t))e.hook=["c."+t.name]
var a=P.button(e)
var i=e.bg_offset?e.bg_offset:0
var o=e.x+i
var n=e.y+i
var s=e.x+e.w-i
var l=e.y+e.h-i
var c=e.z
var _=e.x+.5*e.w
if(F(t))P.drawRect(o,n,s,l,c-2,t.color_vec)
else{var u=U(t.rarity||"LEGENDARY")
var d=e.y+.5*e.h
P.drawRect4Color(o,n,s,l,c-2,u.bright_color,u.bright_color,u.base_color,u.base_color)
if("cosmetic_selected"===e.base_name){var f=.72*e.w
var v={x:_,y:d,z:c-2,w:f,h:f,color:me}
rt.draw(v)}P.drawCircle(_,d,c-1,.25*e.w,0,ge)}if(!e.owned){var h=et
var p
var m=e.z+1
var g=.175*e.w
var E=e.x+.8*e.w
var y=e.y+.25*e.h
var T=.9
var I=he
if(G(t)&&t.expire_date){h=at
T=1
p=it.getFrame()
P.drawRect(o,n+.59*e.h,s,l,c-1,he)
var S=32
var A=(""+te.LBL_LIMITED_TIME).toUpperCase()
var w=getTimeLeftString(t.expire_date)
if(w){var L=.5*S
var R=S
var x=n+.61*e.h
P.font.drawSizedAligned(Ae,_,x,c+2,L,r.ALIGN.HCENTER,0,0,A)
r.drawSizedAligned(Ae,_,x+=L,c+2,R,r.ALIGN.HCENTER,0,0,w)}else{var O
var b=true
if(De[xe.COSTUMES]===t)b=false
else if(null!=(O=B.preview)&&O.is_custom)for(var N=0;N<B.preview.parts.length;N++){var C
var M=W[B.preview.parts[N].name]
if(M&&1===(null==(C=M.available_costumes)?void 0:C.length)&&M.available_costumes[0]===t.name&&!k[M.name]){b=false
break}}characterCustomizationMenuInit(b)
checkSaveEnabled()}}else if(F(t)){g=.5*e.w
E=e.x+.5*e.w
y=e.y+.5*e.h
I=me}var D={x:E,y:y,w:g*T,h:g,z:m,color:I,frame:p}
h.draw(D)}return a}function tabButton(e,t,r,a,i,o,n,s){var l=Oe===a
if(P.buttonImage({x:e,y:t,z:l?r+1:r-20,z_bias:l?void 0:{down:20},img:i,frame:o,colors:l?se.tab_colors_selected:se.tab_colors_unselected,disabled:false,base_name:l?"tab":"tab_inactive",tooltip:n})){if((Oe=a)===xe.COLORS)ke=Pe[0]
else ke=De[a]
for(var c=0;c<Qe.length;c++)if(Qe[c])Qe[c].resetScroll()
if(s)s()}var _=false
if(a===xe.COLORS)for(var u=0;u<Pe.length;u++){var d=Pe[u]
if(d&&!k[d.swap_key]){_=true
break}}else{var f=De[a]
if(f&&!k[f.name])_=true}if(_){var v=P.button_height
var h=.75*v
var p={x:e+v-24,y:t+24,w:h,h:h,z:r+2}
tt.draw(p)}}function checkSaveEnabled(){var e=true
var t=B.preview
var r=t.parts
for(var a=0;a<r.length;a++){var i=r[a].name
var o=W[i]
if(!k[o.name]){e=false
break}}if(e){var n=t.swaps
if(n)for(var s in n){var l=s+";"+n[s]
if(!k[l]){e=false
break}}}be=e}function saveCostume(){var e
var t=B.preview
if(t.is_custom){B.custom=_(t)
i(B.custom)
B.custom.name="custom"
for(var r=0;r<B.custom.attachments.length;r++)if(B.custom.attachments[r].variant){var a=B.custom.parts[r].name
B.custom.parts[r].name=a.slice(0,-3)}e={name:B.custom.name,parts:B.custom.parts,swaps:t.swaps}}else e={name:t.name,swaps:t.swaps}
j(e,re.chat_ui.handle_cmd_parse_error)
if(y.stateActive(ie)){se.clear()
y.setState(ne)}else re.toggleMenuPage(se.CHARACTER_CUSTOMIZATION)}var st=30
function renamePrompt(e){P.modalTextEntry({edit_text:e,title:te.DLG_DISPLAY_NAME_TITLE,text:te.DLG_DISPLAY_NAME_MSG,max_len:st,buttons:{OK:function OK(r){var e=r.trim()
if(!n().loggedIn()||o())return void P.modalDialog({title:te.DLG_ERROR_TITLE,text:te.DLG_DISPLAY_NAME_ERROR_MSG,buttons:{OK:null}})
Re("rename "+e,function(e,t){P.modalDialog({title:e?te.DLG_ERROR_TITLE:te.DLG_DISPLAY_NAME_CHANGED_TITLE,text:e||te.$(te.DLG_DISPLAY_NAME_CHANGED_MSG_NEW,r)+"  "+te.$(te.DLG_DISPLAY_NAME_CHANGED_MSG_USERID,n().logged_in_username),buttons:{OK:null}})})},Cancel:null}})}function cantSavePrompt(){var e=""
for(var t=0;t<De.length;t++){var r=De[t]
if(r&&!k[r.name]&&r.display_name_key)e+=te.get(r.display_name_key)+"\n"}for(var a=0;a<Pe.length;a++){var i=Pe[a]
if(i&&!k[i.swap_key])e+=te.get(i.type_key)+" "+te.get(i.display_name_key)+"\n"}return void P.modalDialog({title:te.DLG_CANT_SAVE_COSTUME_TITLE,text:te.addColon(te.DLG_CANT_SAVE_COSTUME_MSG)+"\n\n"+e,buttons:{OK:null}})}function changePreviewPart(e){var t=W[e]
var r=B.preview
var a=r.attachments
for(var i=0;i<a.length;i++)if(r.attachments[i].part_type===t.part_type){r.attachments[i]=t
break}var o=r.parts
for(var n=0;n<o.length;n++)if(W[o[n].name].part_type===t.part_type){o[n].name=e
if(t.swaps)o[n].swaps=t.swaps
else delete o[n].swaps
break}r.name="preview"
r.is_custom=true}function changePreviewSwap(e){var t=x[e]
var r=B.preview
var a=r.swaps||{}
a[t.type]=null==t?void 0:t.name
r.swaps=a
r.name="preview"
r.is_custom=true}function previewItem(e){Me=void 0
Ce=true
if(G(e)){B.preview=_(e)
getCurrentSelectionFromCostume(B.preview)}else if(C(e)){De[xe.COSTUMES]=void 0
changePreviewPart(e.name)
if(e.part_type===p.ARM_R)changePreviewPart(e.name.replace("arm_r","arm_l"))
else if(e.part_type===p.LEG_R)changePreviewPart(e.name.replace("leg_r","leg_l"))}else if(F(e))changePreviewSwap(e.swap_key)
checkSaveEnabled()
H()}function costumeSetOnPurchase(e,t){if(!t)j({name:e},re.chat_ui.handle_cmd_parse_error)}function drawItemInfo(e,t){var r=P.font
var a=8
var i=Ye===Q?t.x:t.x+a
var o=i+a
var n=o
var s=Ye===Q?t.y:t.y
var l=t.z+2
var c=Ye===Q?t.w-2*a:t.w
var _=1.2*qe
s+=a
var u=U(e?e.rarity||"LEGENDARY":"COMMON")
var d=t.x
var f=t.y
var v=t.x+t.w
var h=t.y+_+2*a
P.drawRect4Color(d,f,v,h,l-1,u.bright_color,u.bright_color_transparent,u.bright_color,u.bright_color_transparent)
if(!e){n+=r.drawSizedAligned(Ie,n,s,l,_,r.ALIGN.HLEFT,0,0,te.TLTP_CUSTOM_OUTFIT)
n=o
r.drawSizedWrapped(Se,n,s+=_+2*a,l,c,0,_,te.CUSTOMIZATION_CUSTOM_OUTFIT)}else{var p=e.rarity||"LEGENDARY"
var m=N(p)
var g=b[p].label+" | "
var E=""+te.get(e.type_key)
n+=r.drawSizedAligned(m,n,s,l,_,r.ALIGN.HLEFT,0,0,g)
n+=r.drawSizedAligned(Ie,n,s,l,_,r.ALIGN.HLEFT,0,0,E)
if(e.collection_key)n+=r.drawSizedAligned(Ie,i+t.w,s,l,_,r.ALIGN.HRIGHT,0,0," "+te.get(e.collection_key))
n=o
s+=_+2*a
var y=e.display_name_key?te.get(e.display_name_key):e.display_name
n+=r.drawSizedAligned(Ie,n,s,l,Ke,r.ALIGN.HLEFT,0,0,y||"Unknown item")
if(G(e)&&e.expire_date&&!k[e.name]){var T=new Date(e.expire_date)
var I=O(T,true)
r.drawSizedAligned(ve,i+t.w,s,l,_,r.ALIGN.HRIGHT,0,0,te.$(te.LBL_ENDS_ON,I))}n=o
s+=Ke+1.1*a
if(C(e)||F(e)&&!e.is_default){var S
if(e.costumes&&1===e.costumes.length)S=B[e.costumes[0]]
else if(e.available_costumes&&1===e.available_costumes.length){var A=0
for(var w=0;w<e.costumes.length;w++)if(k[e.costumes[w]])A++
if(!A||1===A&&k[e.available_costumes[0]])S=B[e.available_costumes[0]]}if(S){var L=C(e)?te.addColon(te.TLTP_ITEM_PART_OF):te.addColon(te.TLTP_ITEM_COLOR_OF)
var R=S.display_name_key
n+=r.drawSizedAligned(Se,n,s,l,_,r.ALIGN.HLEFT,0,0,L)
r.drawSizedAligned(Ie,n,s,l,_,r.ALIGN.HLEFT,0,0," "+(R?te.get(R):S.display_name))
n=o
s+=_}}if(G(e)&&e.flavour_text_key){var x=""
if(e.race_key)x="["+te.get(e.race_key)+"] "
x+=""+te.get(e.flavour_text_key)
r.drawSizedWrapped(Te,n,s,l,c,0,_,x)}}}function drawTabs(e,t,r){var a=P.button_height
var i=4
tabButton(e,t,r,xe.COSTUMES,$e,Le.COSTUME,te.TLTP_TAB_COSTUMES)
tabButton(e+=a+i,t,r,xe.HEADS,$e,Le.HEAD,te.TLTP_TAB_HEADS)
tabButton(e+=a+i,t,r,xe.TORSOS,$e,Le.TORSO,te.TLTP_TAB_TORSOS)
tabButton(e+=a+i,t,r,xe.ARMS,$e,Le.ARMS,te.TLTP_TAB_ARMS)
tabButton(e+=a+i,t,r,xe.LEGS,$e,Le.LEGS,te.TLTP_TAB_LEGS)
tabButton(e+=a+i,t,r,xe.COLORS,$e,Le.PAINT,te.TLTP_TAB_COLORING)}function showList(e,t,r,a,i,o,n,s){if(!Qe[e])Qe[e]=T({z:i,background_color:null,auto_hide:true})
var l={x:r,y:a,z:i,w:o,h:n}
Qe[e].begin(l)
var c=8
var _=c
var u=8
var d=12
var f=(o-s*d-Qe[e].barWidth())/s
for(var v=1;v<=t.length;v++){var h=t[v-1]
var p={x:_,y:u,z:i+1,w:f,h:f,left_align:true,shrink:.8,img:P.sprites.white,reddot_pos:"upper_left",reddot_pad:.1*f,reddot_r:.05*f}
var m=void 0
if(F(h))m=Pe[h.color_submenu]
else m=De[Oe]
p.base_name=m&&m.name===h.name?"cosmetic_selected":"cosmetic_unselected"
if(F(h)){p.owned=k[h.swap_key]||false
p.img=P.sprites.white
p.img_color=pe
p.bg_offset=Ye===Q?7:9}else{p.owned=k[h.name]||false
p.img=P.sprites.cosmetic_placeholder
p.z_inc=-1
p.dynamic_snapshot=false
p.peek=true
if(g.mouseOver(p))p.dynamic_snapshot=true
S(p,h)
p.bg_offset=16}if(itemButton(p,h)&&ke!==h){if(F(ke=h))Pe[h.color_submenu]=h
else{if(G(h))ce("c."+h.name)
De[Oe]=h}previewItem(h)}_+=f+d
if(v%s===0){_=c
u+=f+d}}if(t.length%s>0)u+=f+d
Qe[e].end(u)}function doColorsTab(e){var t=8
var r=12
var a=Ye===Q?4:12
var i=e.x
var o=e.y
var n=e.z+1
var s=.5*e.w-t
var l=je[Ne.SKIN]
var c=e.h*(Ye===Q?.35:.45)
var _=e.h*(Ye===Q?.4:.35)
var u=e.h*(Ye===Q?.1:.12)
$e.draw({x:i,y:o-=a,z:n,w:u,h:u,frame:Le.SKIN})
showList(1,l,i,o+=u-a,n,e.w,c,Ye===Q?8:6)
$e.draw({x:i+=r,y:o+=c+t,z:n,w:u,h:u,frame:Le.HAIR})
showList(2,l=je[Ne.HAIR],i-=r,o+=u-a,n,s,_,4)
i+=s+2*t
$e.draw({x:i+=r,y:o-=u-a,z:n,w:u,h:u,frame:Le.EYES})
showList(3,l=je[Ne.EYES],i-=r,o+=u-a,n,s,_,4)}function handleBottomButton(e){var t=e.y*(Ye===Q?1:.9)
if(be){if(P.buttonImage({x:e.x,y:t,z:e.z,w:e.w,h:e.h,img:Je,colors:ye,frame:we.CHECK,tooltip:te.TLTP_SAVE}))saveCostume()}else{var r=ke
var a=.5*P.button_height
if(G(r)&&!k[r.name]){var i
if(Me)i={redirected_from:Me}
var o
var n
var s
var l
var c=I(r.name)
var _=c&&V()&&q(c)
var u=c&&de(c)
var d=_?_.currency+" "+_.price:""
var f=u&&""+u+we.GEM_SYMBOL
var v=A(r.name)
if(_&&u){if(Ye===Q){o=e.x
n=t
s=.5*e.w
l=e.h}else{o=e.x
n=e.y
s=.5*e.w
l=e.h}if(P.buttonText({x:o,y:n,z:e.z,text:d,font_height:a,w:s,h:l,colors:ye}))Y(c,costumeSetOnPurchase.bind(null,r.name))
if(P.buttonText({x:o+=s,y:n,z:e.z,text:f,font_height:a,w:s,h:l,colors:Ee}))ue(c,v,"costume_shop",costumeSetOnPurchase.bind(null,r.name),i)}else if(_||u){var h=_||u
if(P.buttonText({x:e.x,y:t,z:e.z,w:e.w,h:e.h,text:_?d?te.$(te.BTN_GET_NOW_PRICE,d):te.BTN_GET_NOW:u?te.$(te.BTN_GET_NOW_PRICE,f):te.BTN_COMING_SOON,font_height:a,disabled:!h,colors:_?ye:u?Ee:void 0}))if(_)Y(c,costumeSetOnPurchase.bind(null,r.name))
else ue(c,v,"costume_shop",costumeSetOnPurchase.bind(null,r.name),i)}}else if(C(r)&&!k[r.name]||F(r)&&!k[r.swap_key]){var p=r.available_costumes[0]
var m=getItemByName(Be,p)
if(P.buttonText({x:e.x,y:t,z:e.z,w:e.w,h:e.h,text:te.$(te.BTN_GET_COSTUME,""+(null!=m&&m.display_name_key?te.get(m.display_name_key):null==m?void 0:m.display_name)),font_height:a,colors:Ee})){var g=false
if(De[xe.COSTUMES]!==m)g=true
previewItem(ke=m)
Oe=xe.COSTUMES
if(g)Me=r.name}}else if(P.buttonImage({x:e.x,y:t,z:e.z,w:e.w,h:e.h,img:$e,colors:Ee,frame:Le.EXCLAMATION,tooltip:te.TLTP_INFO}))cantSavePrompt()}}var lt=96
function doCharacterCustomization(){it.update(y.getFrameDt())
Ye=J()
if(!ot)getInitialPreview()
var e=0
var t=se.menuX1()
var r=P.button_height
var a=se.menuY1()
var i=Z.UI
var o=t/Ze
var n=(a-r)/Xe
var s=E.x1()-1.35*P.button_height-X
var l=Math.min(t,s)
oe(l,16,i,P.font.ALIGN.HRIGHT,64)
var c=Ye===Q?Xe:.5*Xe
var _={w:(Ye===Q?740:.5*Ze)*o,h:c*n*.8,x:e,y:r,button_h:lt,is_customization:true,save_enabled:be}
le(_)
drawTabs(e,0,i)
var u=P.button_height/2
var d=He[Oe]
var f=Ye===Q?_.w+u:e-2
var v=Ye===Q?r:a-c*n
var h=i+1
var p=Ye===Q?t-(_.w+u):t
var m=Ye===Q?Xe:.5*Xe
m*=n
var g
g={x:Ye===Q?e+.1*_.w:e+_.w,y:Ye===Q?r+.88*_.h:r+16,z:h,w:Ye===Q?.8*_.w:_.w-16,h:.23*_.h}
drawItemInfo(ke,g)
if(Oe===xe.COLORS)doColorsTab({x:f,y:v,z:h,w:p,h:Ye===Q?m:m})
else if(d)showList(0,d,f,v,h,p,m,4)}},{"../common/entitlements":194,"../glov/client/camera2d":241,"../glov/client/engine":250,"../glov/client/input":271,"../glov/client/net":279,"../glov/client/scroll_area":289,"../glov/client/sprite_animation":301,"../glov/client/sprites":302,"../glov/client/ui":306,"../glov/common/util":330,"../glov/common/vmath":332,"./cosmetic_thumbnails.js":54,"./cosmetics":55,"./costume_edit.js":56,"./in_app_purchases/iap_client_worlds":93,"./layout":99,"./localization/localization":108,"./main":112,"./main_menu":113,"./menu":117,"./paperdoll":125,"./red_dot":146,"./store":158,"./styles":160,"./ui_util":168,"./ui_util_2":169,"./world_comm":182,assert:void 0}],32:[function(e,t,r){"use strict"
r.isChatWithTipFloater=isChatWithTipFloater
r.chatFloaterStartup=chatFloaterStartup
r.ChatWithTipFloater=r.ChatFloater=void 0
function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype)
_setPrototypeOf(e.prototype.constructor=e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){e.__proto__=t
return e})(e,t)}var n=e("../glov/client/font.js")
var a=e("../glov/client/font.js").fontStyleAlpha
var o=e("../glov/client/ui.js")
var i=e("../glov/common/util.js").clamp
var l=e("../glov/common/vmath.js").v4clone
var s=e("./floater")
var c=s.CompoundFloater
var _=s.GraphicalFloater
var u=s.PanelledTextFloater
var d=s.TextFloater
var f=e("./styles.js")
var v=f.color_white
var h=f.inventory_style
var p=.4
var m=2-2*p
var g=8
var E=function(o){_inheritsLoose(ChatTextFloater,o)
function ChatTextFloater(e,t){var r
var a=1
var i=t;(r=o.call(this,{size:a,style:i,text:e,min_w:m,max_w:g})||this).setAlign(r.w>r.text_w?n.ALIGN.HCENTERFIT:n.ALIGN.HLEFT|n.ALIGN.HWRAP)
return r}return ChatTextFloater}(d)
var y=h
var T=v
var I=.9
var S=.015
var A=function(o){_inheritsLoose(ChatFloater,o)
function ChatFloater(e,t,r){var a
var i=l(T)
i[3]=I;(a=o.call(this,new E(e,t),{color:i,panel_border:p,pixel_scale:S})||this).timestamp=void 0
a.original_style=void 0
a.timestamp=r
a.original_style=t||y
return a}var e=ChatFloater.prototype
e.getTimestamp=function getTimestamp(){return this.timestamp}
e.setBaseAlpha=function setBaseAlpha(e){this.fp_pairs.text.floater.setStyle(a(this.original_style,e))
this.fp_pairs.panel.floater.setBaseAlpha(I*e)}
return ChatFloater}(u)
r.ChatFloater=A
var w=1.9
var L=function(r){_inheritsLoose(ChatPanelWithTipFloater,r)
function ChatPanelWithTipFloater(e){var t;(t=r.call(this,e=e||{})||this).pixel_scale=void 0
t.h_split=void 0
t.pixel_scale=e.pixel_scale||1
t.h_split=[.5,.5]
return t}var e=ChatPanelWithTipFloater.prototype
e.draw=function draw(e){var t=e.x,r=e.y,a=e.z,i=e.scale
o.drawMultiPartBox({x:t,y:r,z:a,w:this.w*i,h:this.h*i},{widths:[-1,this.h_split[0],-1,this.h_split[1],-1],heights:[-1,1,-1]},o.sprites.chat_panel,this.pixel_scale*i,this.color)}
e.offscreenUpdate=function offscreenUpdate(e,t){var r=e[0]/((this.w-w)*t)
this.h_split=[i(.5-r,0,1),i(.5+r,0,1)]}
return ChatPanelWithTipFloater}(_)
var R=.3
var x=function(s){_inheritsLoose(ChatWithTipFloater,s)
function ChatWithTipFloater(e,t,r){var a
var i=new E(e,t)
var o=l(T)
o[3]=I
var n={text:{floater:i,rel_pos:{x:p,y:p,z:1}},panel:{floater:new L({color:o,pixel_scale:S,w:i.getW()+2*p,h:i.getH()+2*p+R}),rel_pos:{x:0,y:0,z:0}}};(a=s.call(this,n)||this).timestamp=void 0
a.fp_pairs=void 0
a.original_style=void 0
a.fp_pairs=n
a.timestamp=r
a.original_style=t||y
return a}var e=ChatWithTipFloater.prototype
e.getTimestamp=function getTimestamp(){return this.timestamp}
e.getText=function getText(){return this.fp_pairs.text.floater.getText()}
e.offscreenUpdate=function offscreenUpdate(e,t){this.fp_pairs.panel.floater.offscreenUpdate(e,t)}
e.setBaseAlpha=function setBaseAlpha(e){this.fp_pairs.text.floater.setStyle(a(this.original_style,e))
this.fp_pairs.panel.floater.setBaseAlpha(I*e)}
return ChatWithTipFloater}(c)
r.ChatWithTipFloater=x
function isChatWithTipFloater(e){return e instanceof x}function chatFloaterStartup(){o.loadUISprite("chat_panel",[40,2,44,2,40],[40,160,56])}},{"../glov/client/font.js":260,"../glov/client/ui.js":306,"../glov/common/util.js":330,"../glov/common/vmath.js":332,"./floater":84,"./styles.js":160}],33:[function(e,t,r){"use strict"
r.ChunkSearcher=void 0
var i=e("../glov/client/engine.js")
var a=e("../glov/common/vmath")
var o=a.v3addScale
var n=a.v3copy
var s=a.v3dist
var l=a.v3set
var c=a.v3sub
var _=a.vec3
var u=e("../common/globals.js")
var d=u.CHUNK_SIZE
var f=u.ID2
var v=u.ID_FACTOR
var h=e("./voxel_data.js")
var p=Math.floor
var m=_()
var g=function(){function ChunkSearcher(e){this.chunk_walk=[0,0,0]
this.chunk_min=[0,0,0]
this.chunk_max=[1,1,1]
this.done=true
this.last_closest_chunk=null
this.last_closest_dist=Infinity
this.last_closest_offs=_()
this.closest_chunk=null
this.closest_dist=Infinity
this.closest_offs=_()
this.range=0
this.start=_()
this.work_count=0
this.max_work=void 0
this.search_start_time=Infinity
this.max_work=e}var e=ChunkSearcher.prototype
e.setRange=function setRange(e){this.range=e}
e.setStart=function setStart(e){n(this.start,e)}
e.reset=function reset(e){this.done=false
var t=h.origin_chunk
l(this.chunk_min,p((this.start[0]-this.range)/d+t[0]),p((this.start[1]-this.range)/d+t[1]),p((this.start[2]-this.range)/d+t[2]))
l(this.chunk_max,p((this.start[0]+this.range)/d+t[0]),p((this.start[1]+this.range)/d+t[1]),p((this.start[2]+this.range)/d+t[2]))
n(this.chunk_walk,this.chunk_min)
if(e)this.last_closest_chunk=null
this.closest_chunk=null
this.closest_dist=Infinity}
e.addWork=function addWork(e){this.work_count+=e}
e.search=function search(e){this.work_count=0
this.search_start_time=i.hrnow()
do{var t=this.chunk_walk[0]+this.chunk_walk[1]*v+this.chunk_walk[2]*f
var r=h.chunk_map[t]
this.addWork(1)
if(r&&r.did_gen&&r.data){var a=e(r)
if(a){this.closest_chunk=a.closest_chunk
this.closest_dist=a.closest_dist
n(this.closest_offs,a.closest_offs)}}this.walkChunk()}while(!this.done||this.work_count<this.max_work)
if(this.done){this.last_closest_offs=this.closest_offs
this.last_closest_chunk=this.closest_chunk}this.last_closest_dist=Infinity
if(this.last_closest_chunk){c(m,this.last_closest_chunk.pos,h.origin_chunk)
o(m,this.last_closest_offs,m,d)
this.last_closest_dist=s(m,this.start)}}
e.walkChunk=function walkChunk(){this.chunk_walk[0]++
if(this.chunk_walk[0]>this.chunk_max[0]){this.chunk_walk[0]=this.chunk_min[0]
this.chunk_walk[1]++
if(this.chunk_walk[1]>this.chunk_max[1]){this.chunk_walk[1]=this.chunk_min[1]
this.chunk_walk[2]++
if(this.chunk_walk[2]>this.chunk_max[2])this.done=true}}}
return ChunkSearcher}()
r.ChunkSearcher=g},{"../common/globals.js":197,"../glov/client/engine.js":250,"../glov/common/vmath":332,"./voxel_data.js":175}],34:[function(require,module,exports){"use strict"
exports.isElevated=isElevated
exports.waygateToPosStr=waygateToPosStr
exports.waygateGo=waygateGo
var assert=require("assert")
var _glovClientCmds=require("../glov/client/cmds")
var cmd_parse=_glovClientCmds.cmd_parse
var _glovClientEngine=require("../glov/client/engine")
var engine=_glovClientEngine
var _glovClientFscreen=require("../glov/client/fscreen")
var fscreenActive=_glovClientFscreen.fscreenActive
var fscreenAvailable=_glovClientFscreen.fscreenAvailable
var fscreenEnter=_glovClientFscreen.fscreenEnter
var fscreenExit=_glovClientFscreen.fscreenExit
var _glovClientLocalization=require("../glov/client/localization")
var getStringFromLocalizable=_glovClientLocalization.getStringFromLocalizable
var _glovClientNet=require("../glov/client/net")
var netClient=_glovClientNet.netClient
var netDisconnected=_glovClientNet.netDisconnected
var netSubs=_glovClientNet.netSubs
var _glovClientUi=require("../glov/client/ui")
var ui=_glovClientUi
var _glovClientUrlhash=require("../glov/client/urlhash")
var urlhash=_glovClientUrlhash
var md5=require("../glov/common/md5.js")
var _glovCommonUtil=require("../glov/common/util")
var clamp=_glovCommonUtil.clamp
var dateToSafeLocaleString=_glovCommonUtil.dateToSafeLocaleString
var has=_glovCommonUtil.has
var isInteger=_glovCommonUtil.isInteger
var nop=_glovCommonUtil.nop
var plural=_glovCommonUtil.plural
var secondsToFriendlyString=_glovCommonUtil.secondsToFriendlyString
var verify=require("../glov/common/verify")
var _commonEntitlements=require("../common/entitlements")
var entitlements=_commonEntitlements.entitlements
var _commonGlobals=require("../common/globals")
var CHUNK_SIZE=_commonGlobals.CHUNK_SIZE
var ID2=_commonGlobals.ID2
var ID_FACTOR=_commonGlobals.ID_FACTOR
var STACK_SIZE=_commonGlobals.STACK_SIZE
var _commonIds=require("../common/ids")
var INV_ITEM_NAME=_commonIds.INV_ITEM_NAME
var TYPE_BLOCK=_commonIds.TYPE_BLOCK
var TYPE_ITEM=_commonIds.TYPE_ITEM
var _commonMegachunk_common=require("../common/megachunk_common")
var megachunk_common=_commonMegachunk_common
var _commonWaygate_common=require("../common/waygate_common")
var waygate_invalid_regex=_commonWaygate_common.waygate_invalid_regex
var waygate_valid_regex=_commonWaygate_common.waygate_valid_regex
var _commonWorld_constants=require("../common/world_constants")
var ATTRIB_FIXED_MAX=_commonWorld_constants.ATTRIB_FIXED_MAX
var WAYGATE_FLAG_LISTED=_commonWorld_constants.WAYGATE_FLAG_LISTED
var _commonWorld_trans=require("../common/world_trans")
var TransactionSet=_commonWorld_trans.TransactionSet
var decodeChunkPos=_commonWorld_trans.decodeChunkPos
var _build_mode=require("./build_mode")
var doStamina=_build_mode.doStamina
var _editvolume_client=require("./editvolume_client")
var updateEditVolumes=_editvolume_client.updateEditVolumes
var _energy_well=require("./energy_well")
var possiblyApplyWaygateSickness=_energy_well.possiblyApplyWaygateSickness
var _inventory=require("./inventory")
var INV_PLAYER=_inventory.INV_PLAYER
var canFit=_inventory.canFit
var locked=_inventory.locked
var transInvAdd=_inventory.transInvAdd
var _items=require("./items")
var createItem=_items.createItem
var _localizationLocalization=require("./localization/localization")
var L=_localizationLocalization.L
var _main=require("./main")
var main=_main
var _main2=require("./main")
var charControllerPos=_main2.charControllerPos
var _main_menu=require("./main_menu")
var worldInfoCacheClear=_main_menu.worldInfoCacheClear
var _materials=require("./materials")
var INV_MATERIAL_NAME=_materials.INV_MATERIAL_NAME
var MATERIAL_CLASS=_materials.MATERIAL_CLASS
var MATERIAL_NAME=_materials.MATERIAL_NAME
var MaterialClass=_materials.MaterialClass
var _orient=require("./orient")
var orient=_orient
var _proc_gen=require("./proc_gen")
var getFlatOreType=_proc_gen.getFlatOreType
var setFlatOreType=_proc_gen.setFlatOreType
var _race_ui=require("./race_ui")
var possiblyCancelReadyRace=_race_ui.possiblyCancelReadyRace
var _stuck=require("./stuck")
var unstuck=_stuck.unstuck
var unstuckBlocked=_stuck.unstuckBlocked
var _task_sched=require("./task_sched")
var WORKER_MESH=_task_sched.WORKER_MESH
var taskCreate=_task_sched.taskCreate
var _tiles=require("./tiles")
var TILES=_tiles
var _user_data=require("./user_data")
var isPlayAsViewer=_user_data.isPlayAsViewer
var playAsViewerSet=_user_data.playAsViewerSet
var userAttribGet=_user_data.userAttribGet
var userAttribGetFixed=_user_data.userAttribGetFixed
var userAttribModBatched=_user_data.userAttribModBatched
var userAttribs=_user_data.userAttribs
var userDataGet=_user_data.userDataGet
var userDataPredict=_user_data.userDataPredict
var userHomeSettlementID=_user_data.userHomeSettlementID
var userStaminaCur=_user_data.userStaminaCur
var userStaminaMax=_user_data.userStaminaMax
var userStaminaMod=_user_data.userStaminaMod
var waygateEditAllowed=_user_data.waygateEditAllowed
var _voxel_data=require("./voxel_data")
var voxel_data=_voxel_data
var _voxel_data2=require("./voxel_data")
var remeshAll=_voxel_data2.remeshAll
var _world_comm=require("./world_comm")
var getWorldChannel=_world_comm.getWorldChannel
var getWorldID=_world_comm.getWorldID
var worldCmdParse=_world_comm.worldCmdParse
var worldSend=_world_comm.worldSend
var _world_metadata=require("./world_metadata")
var world_metadata=_world_metadata
var _world_metadata2=require("./world_metadata")
var adventureMode=_world_metadata2.adventureMode
var worldMetadata=_world_metadata2.worldMetadata
var worldMetadataFreePos=_world_metadata2.worldMetadataFreePos
var worldMetadataWaygates=_world_metadata2.worldMetadataWaygates
var worldRaceAsVisitor=_world_metadata2.worldRaceAsVisitor
var floor=Math.floor,max=Math.max,round=Math.round
var elevated=false
function isElevated(){return elevated}cmd_parse.register({cmd:"pos",help:"Set or display current position",func:function func(e,t){if(!getWorldID())return void t("Not currently in a world")
var r=main.char_controller
if(e){if(!worldMetadataFreePos()){if(cmd_parse.checkAccess(["sysadmin"])){r.updatePosFromString(e,false)
return void t(null,"Bypassing /world_free_pos as sysadmin")}return void t("This world does not allow free positioning (owner or admin can run /world_free_pos 1 to enable)")}r.updatePosFromString(e,true)}t(null,"Position: "+r.getPosString())}})
var ping_pong_target
var ping_pong_time=5e3
var ping_pong_timeout
function doPingPong(){if(!getWorldID()||netDisconnected())return
var e=main.char_controller
var t=ping_pong_target
ping_pong_target=e.getPosString()
e.updatePosFromString(t,true)
ping_pong_timeout=setTimeout(doPingPong,ping_pong_time)}cmd_parse.register({cmd:"ping_pong_target",help:"Set target for /ping_pong",usage:"Usage: /ping_pong_taget [target_pos [start_pos [seconds]]] (defaults to setting target_pos=current pos)",prefix_usage_with_help:true,access_run:["sysadmin"],func:function func(e,t){if(!getWorldID())return void t("Not currently in a world")
var r=e.split(" ").filter(String)
if(r.length>=1)ping_pong_target=r[0]
else ping_pong_target=main.char_controller.getPosString()
if(r.length>=2)main.char_controller.updatePosFromString(r[1],true)
if(3===r.length)return void cmd_parse.handle(this,"ping_pong "+r[2],t)
t(null,"Target position set: "+ping_pong_target)}})
cmd_parse.register({cmd:"ping_pong",help:"Periodically teleport between current position and position set by /ping_pong_target",usage:"Usage: /ping_pong [seconds] (default 5; 0 to cancel)",prefix_usage_with_help:true,access_run:["sysadmin"],func:function func(e,t){if(ping_pong_timeout){clearTimeout(ping_pong_timeout)
ping_pong_timeout=null}if(e){if(!Number(e))return void t(ping_pong_target=null,"Ping pong cancelled")
ping_pong_time=round(1e3*Number(e))}if(!ping_pong_target)return void t(null,"Run /ping_pong_target first")
ping_pong_timeout=setTimeout(doPingPong,ping_pong_time)
t(null,"Ping pong started")}})
cmd_parse.register({cmd:"pos_chunk",help:"Set or display current position by chunk id",access_show:["sysadmin"],func:function func(e,t){if(e){var r=Number(e)
if(isFinite(r)){var a=megachunk_common.parseChunkId(r).chunk_pos
return void cmd_parse.handle(this,"pos "+(a[0]*CHUNK_SIZE+CHUNK_SIZE/2)+","+(a[1]*CHUNK_SIZE+CHUNK_SIZE/2)+","+(a[2]*CHUNK_SIZE+CHUNK_SIZE/2),t)}}var i=voxel_data.origin_chunk
var o=charControllerPos()
var n=floor(o[0]/CHUNK_SIZE+i[0])
var s=floor(o[0]/CHUNK_SIZE+i[0])
t(null,"Chunk ID: "+(floor(o[0]/CHUNK_SIZE+i[0])*ID2+s*ID_FACTOR+n))}})
cmd_parse.register({cmd:"parse_chunk_id",help:"Parse a chunk ID into component parts",access_show:["sysadmin"],func:function func(e,t){var r=Number(e)
if(!e||!isFinite(r))return void t("Invalid chunk ID")
var a=megachunk_common.parseChunkId(r),i=a.chunk_pos,o=a.mchunk_pos,n=a.local_pos,s=a.mcid
t(null,"Chunk ID = "+r+"\nChunk Pos = "+i+"\nWorld Pos = "+i[0]*CHUNK_SIZE+","+i[1]*CHUNK_SIZE+","+i[2]*CHUNK_SIZE+"\nLocal Pos = "+n+"\nMegaChunk ID = "+s+"\nMegaChunk Pos = "+o+"\nMegaChunk2D ID = "+(o[0]+o[1]*ID_FACTOR)+"\n")}})
cmd_parse.register({cmd:"respawn",help:"Return a user or multiple users to a Waygate",usage:"$HELP\n  Usage: /respawn\n  Usage: /respawn user_id [waygate_id] (world admins only)\n  Usage: /respawn ALL [waygate_id] (world admins only)\n  Usage: /respawn OTHERS [waygate_id] (world admins only)\n  Usage: /respawn (READONLY|AREABUILDER|BUILDER|ADMIN) [waygate_id] (world admins only)\n  Usage: /respawn USER user_id [waygate_id] (world admins only)",func:function func(e,t){if(!getWorldID())return void t("Not currently in a world")
if(!e)cmd_parse.handle(this,"waygate default",t)
else getWorldChannel().cmdParse("world_respawn "+e,t)}})
cmd_parse.register({cmd:"client_assert",help:"(Debug) - Fail an assert on the client",access_show:["sysadmin"],func:function func(e,t){assert(false)}})
cmd_parse.register({cmd:"client_reject_now",help:"(Debug) - Fail an unhandled promise rejection on the client (Error, sync)",access_show:["sysadmin"],func:function func(e,t){new Promise(function(e,t){t(new Error("client_reject_now"))})}})
cmd_parse.register({cmd:"client_reject_now_string",help:"(Debug) - Fail an unhandled promise rejection on the client (string, sync)",access_show:["sysadmin"],func:function func(r,e){new Promise(function(e,t){t(r||"client_reject_now")})}})
cmd_parse.register({cmd:"client_reject_now_object",help:"(Debug) - Fail an unhandled promise rejection on the client (object, sync)",access_show:["sysadmin"],func:function func(e,t){new Promise(function(e,t){t({foo:"bar"})})}})
cmd_parse.register({cmd:"client_reject_now_empty",help:"(Debug) - Fail an unhandled promise rejection on the client (empty, sync)",access_show:["sysadmin"],func:function func(e,t){new Promise(function(e,t){t()})}})
cmd_parse.register({cmd:"client_reject_now_crash",help:"(Debug) - Crash in an unhandled promise on the client (crash, sync)",access_show:["sysadmin"],func:function func(e,t){new Promise(function(e,t){({}).b.c="d"})}})
cmd_parse.register({cmd:"client_reject_now_assert",help:"(Debug) - Assert in an unhandled promise on the client (assert, sync)",access_show:["sysadmin"],func:function func(e,t){new Promise(function(e,t){assert(false)})}})
cmd_parse.register({cmd:"client_reject_later",help:"(Debug) - Fail an unhandled promise rejection on the client (Error, async)",access_show:["sysadmin"],func:function func(e,t){new Promise(function(e,t){setTimeout(function(){t(new Error("client_reject_later"))},100)})}})
cmd_parse.register({cmd:"client_send_bad_data",help:"(Debug) - Send bad data to the server",access_show:["sysadmin"],func:function func(e,t){var r=Number(e)||100
t()
var a=netClient().pak("set_channel_data")
if(1===r)return a.send()
a.writeAnsiString("user."+netSubs().loggedIn())
if(2===r){a.writeInt(-1)
return a.send()}a.writeBool(false)
a.writeAnsiString("public.dummy")
if(3===r){a.writeAnsiString("not_json")
return a.send()}a.writeJSON({foo:"bar"})
var i=a.getBufferLen()
a.getBuffer()[i-1]=0
return a.send()}})
cmd_parse.register({cmd:"client_verify",help:"(Debug) - Fail a verify on the client",access_show:["sysadmin"],func:function func(e,t){verify(false)}})
cmd_parse.register({cmd:"client_crash",help:"(Debug) - Crash on the client",access_show:["sysadmin"],func:function func(e,t){var r
r.bar++}})
cmd_parse.register({cmd:"world_pass",help:"Set or clear password for the current world",usage:"$HELP\n  Usage: /world_pass [CLEAR | password] [WIPE]\n  If WIPE specified, all access from previous password will be removed",access_run:["world_admin"],func:function func(e,t){if(!main.omp||!getWorldID())return void t("Command only available in multiplayer")
var r=e.split(" ")
if(r[0]&&"clear"!==r[0].toLowerCase())r[0]=md5(md5(String(getWorldID()))+r[0])
var a="world_pass_server "+r.join(" ")
netSubs().sendCmdParse(a,t)}})
cmd_parse.register({cmd:"csr_world_undelete",help:"(Admin) Undelete a world",usage:"$HELP\n  Usage: /csr_world_undelete world_id [new_owner_user_id]",access_run:["sysadmin"],func:function func(e,t){var r=e.split(" ")
if(1!==r.length&&2!==r.length)return void t("Invalid parameters")
var a=netClient().pak("world_undelete")
a.writeAnsiString(r[0])
a.writeAnsiString(r[1]||"")
a.send(t)}})
cmd_parse.register({cmd:"csr_world_freeze",help:"(Admin) Freeze or unfreeze a world",usage:"$HELP\n  Usage: /csr_world_freeze world_id [0/1]",access_run:["sysadmin"],func:function func(e,t){var r=e.split(" ")
if(1!==r.length&&2!==r.length)return void t("Invalid parameters")
var a=netClient().pak("world_freeze")
a.writeAnsiString(r[0])
a.writeBool("0"!==r[1])
a.send(t)}})
cmd_parse.register({cmd:"fullscreen",help:"Toggle full-screen mode",func:function func(e,t){if(!fscreenAvailable())return t("Fullscreen not available")
if(fscreenActive())fscreenExit()
else{fscreenEnter()
orient.set(orient.LANDSCAPE)}return t()}})
cmd_parse.register({cmd:"modal",access_show:["sysadmin"],help:"(Hidden) Show a modal dialog for testing",prefix_usage_with_help:true,usage:"/modal TitleWord Messsage text",func:function func(e,t){var r=e.split(" ")
ui.modalDialog({title:r[0]||"Title",text:r.slice(1).join(" ")||"Message",buttons:{OK:null}})
t()}})
cmd_parse.register({cmd:"unlimited",access_show:["sysadmin"],help:"(Hidden) Set or display unlimited mode of the current world",usage:"$HELP\n  Display current state: /unlimited\n  Set: /unlimited 0 or 1",func:function func(e,t){var r="1"===e?1:"0"===e?0:null
if(null===r){if(e)return void t("Usage: /unlimited 0 or 1")}else{main.chat_ui.cmdParse("world_unlimited "+r)
return void t()}t(null,"Unlimited Mode = "+world_metadata.world_data.unlimited)}})
cmd_parse.register({cmd:"dom",access_run:["sysadmin"],access_show:["hidden"],func:function func(str,resp_func){str=str.split(" ")
var elem=document.getElementById(str[0])
if(!elem)return resp_func("Element not found")
return resp_func(null,String(eval("(function(elem){ return elem."+str[1]+"; })")(elem)))}})
var give_lookup
function buildGiveLookup(){if(give_lookup)return
give_lookup={}
function add3(e,t){give_lookup[e.replace(/_/g,"")]=t}function add2(e,t){add3(e,t)
if("S"===e.slice(-1))add3(e.slice(0,-1),t)
else add3(e+"S",t)
var r=e.split("_")
if(r.length>1)if("S"===r[0].slice(-1)){r[0]=r[0].slice(0,-1)
add3(r.join("_"),t)}else{r[0]+="S"
add3(r.join("_"),t)}}function add(e,t){add2(e,t)
add2(e.split("_").reverse().join("_"),t)}for(var e in TILES){var t=TILES[e]
if("number"!==typeof t)continue
var r=TILES.tile_map_default[t]
if(r&&r.allowed_in_inventory){add(e,[TYPE_BLOCK,t])
add(getStringFromLocalizable(L.get("TILES_"+TILES.tile_code_name[t]+"_NAME")).toUpperCase().replace(/ /g,"_"),[TYPE_BLOCK,t])}}for(var a in INV_ITEM_NAME){var i=INV_ITEM_NAME[a]
add(a.replace(/^ITEM_/,""),[TYPE_ITEM,i])}}var USAGE_GIVE="Usage: /give [count] <ID> [material 1] [material 2] [attr3]\n  Examples: /give 10 snow\n    /give hatchet stone dark_wood"
cmd_parse.register({cmd:"give",help:"Grant an item",access_run:["world_areabuilder"],usage:"$HELP\n"+USAGE_GIVE,func:function func(e,t){if(!main.omp)return t(null,"Error: /give is only allowed when in a world")
if(adventureMode()&&!cmd_parse.checkAccess(["sysadmin"])&&!engine.DEBUG)return t("Not allowed in Lost Frontier worlds")
if(locked(INV_PLAYER))return t("Inventory locked")
function usage(e){t((e?"Error: "+e+"\n":"")+USAGE_GIVE)}var r=e.split(" ")
if(!Number(r[0]))r.splice(0,0,"1")
var a=r[0]
var i=r[1]
var o=r[2]
var n=r[3]
var s=r[4]
if(!i)return usage()
var l=i
i=i.toUpperCase().replace(/_/g,"")
buildGiveLookup()
var c=give_lookup[i]
if(!c)return usage('Invalid ID: "'+l+'"')
var _=c[0]
i=c[1]
if(!(a=Number(a))||!isInteger(a)||a<1||a>STACK_SIZE)return usage("COUNT must be an integer between 1 and "+STACK_SIZE)
if(_===TYPE_BLOCK){if(o||n||s)return usage("BLOCKs must not specify materials")
if(i<1||i>=TILES.PROP_BASE)return usage("Invalid BLOCK ID")}else{if(o)if("0"===o)o=0
else if(!(o=INV_MATERIAL_NAME[o.toUpperCase()]))return usage("ATTR1/MATERIAL1 must be one of "+Object.keys(INV_MATERIAL_NAME).join())
if(n)if("0"===n)n=0
else if(!(n=INV_MATERIAL_NAME[n.toUpperCase()]))return usage("ATTR2/MATERIAL2 must be one of "+Object.keys(INV_MATERIAL_NAME).join())
if(s){s=Number(s)
if(!isInteger(s))return usage("ATTR3 must be an integer")}}var u
try{u=createItem({type:_,id:i,count:a,attr1:o,attr2:n,attr3:s})}catch(e){return usage("Invalid ID or not allowed in inventory")}if(!u.isAllowedInInventory())return usage("Invalid ID or not allowed in inventory")
if(u.has_hp)u.setHP(u.hp_max)
if(!canFit(u))return t("Cannot add: inventory full")
transInvAdd(main.getFrameTransaction(),INV_PLAYER,u)
return t(null,"Granted.")}})
cmd_parse.register({cmd:"url",help:"Opens a Worlds FRVR internal URL",func:function func(e,t){setTimeout(function(){profilerStart("/url")
urlhash.go(e)
profilerStop("/url")},1)}})
cmd_parse.register({cmd:"wave",help:"Triggers /me waves",func:function func(){main.chat_ui.cmdParse("me waves")}})
cmd_parse.register({access_show:["hidden"],cmd:"waves",help:"Triggers /me waves",func:function func(){main.chat_ui.cmdParse("me waves")}})
cmd_parse.register({cmd:"sit",help:"Triggers /me sits",func:function func(){main.chat_ui.cmdParse("me sits")}})
var go_usage="Usage: /go WorldID  or  /go WorldID/WaygateID"
cmd_parse.register({cmd:"go",help:"Go to the specified world",usage:"$HELP\n"+go_usage,func:function func(e,t){if(!e)return void t(go_usage)
urlhash.go("w/"+e)}})
cmd_parse.register({cmd:"waygate_list",help:"List Waygates in the current world",access_run:["world_areabuilder"],func:function func(e,t){if(!getWorldID())return void t("Not currently in a world")
var r=worldMetadataWaygates()
var a=waygateEditAllowed()
var i=0
var o=["Waygates in "+getWorldID()+":"]
for(var n in r){var s=r[n]
if(!a&&!(s.flags&WAYGATE_FLAG_LISTED))continue;++i
var l=megachunk_common.parseChunkId(s.pos[0]).chunk_pos
var c=decodeChunkPos(s.pos[1])
var _=l[0]*CHUNK_SIZE+c[0]+","+(l[1]*CHUNK_SIZE+c[1])+","+(l[2]*CHUNK_SIZE+c[2])
o.push("  "+n+": "+_+' - "'+s.name+'"'+(s.flags&WAYGATE_FLAG_LISTED?"":" (unlisted)"))}o.push(i+" "+(a?"total":"listed")+" "+plural(i,"Waygate"))
t(null,o.join("\n"))}})
var rot_to_deg=[0,270,180,90]
function waygateToPosStr(e){var t=megachunk_common.parseChunkId(e.pos[0]).chunk_pos
var r=decodeChunkPos(e.pos[1])
var a=rot_to_deg[e.pos[2]]
return t[0]*CHUNK_SIZE+r[0]+1+","+(t[1]*CHUNK_SIZE+r[1]+1)+","+(t[2]*CHUNK_SIZE+r[2]+1+main.char_controller.eye_height)+","+a+",0,"}function waygateGo(e,t){var r=worldMetadataWaygates()
if(!e.match(waygate_valid_regex)||e.match(waygate_invalid_regex)||!has(r,e))return"Invalid WGID"
var a=r[e]
if(!(a.flags&WAYGATE_FLAG_LISTED)&&t.listed_only)return"Access denied"
if(doStamina()&&e!==userHomeSettlementID())return"You can only travel to your Home Settlement"
possiblyApplyWaygateSickness()
possiblyCancelReadyRace()
main.char_controller.updatePosFromString(waygateToPosStr(a),false)
if(a.flags&WAYGATE_FLAG_LISTED&&!t.from_url)urlhash.set("wg",e)
return null}cmd_parse.register({cmd:"waygate",help:"Warp to specified Waygate",func:function func(e,t){if(!getWorldID())return t("Not currently in a world")
var r={listed_only:true}
if(main.chat_ui.getAccessObj().access.world_admin&&!isPlayAsViewer())r.listed_only=false
var a=waygateGo(e,r)
if(a)return t(a)
return t(null,"'Gating to "+e)}})
cmd_parse.register({cmd:"home",access_show:["sysadmin"],help:"(Hidden) Shows your currently bound Settlement ID",func:function func(e,t){t(null,"Bound Settlement ID = "+(userDataGet("home")||"undefined (default)"))}})
var waygate_set_usage="  Usage: /waygate_set wgid chunk_id pos_idx rot (imgid|NC) (settlement|NC)"
cmd_parse.register({cmd:"waygate_set",access_show:["sysadmin"],help:"(Hidden) Set a Waygate on the world metadata",prefix_usage_with_help:true,usage:waygate_set_usage,func:function func(e,a){if(!getWorldID())return void a("Not currently in a world")
var t=e.split(" ")
var r={wgid:t[0],chunk_id:Number(t[1]),pos_idx:Number(t[2]),rot:Number(t[3])}
if(t[4]&&"NC"!==t[4])r.imgid=Number(t[4])
if(t[5]&&"NC"!==t[5])r.is_settlement="1"===t[5]
worldSend("waygate_set",r,function(e,t){if(e)return void a(e+"\n"+waygate_set_usage)
var r=t.msg
if(t.home){userDataPredict("home",t.home,true)
r+=", home set to "+t.home}a(null,r)})}})
cmd_parse.register({cmd:"world_created",help:"Show when the current world was created",func:function func(e,t){if(!getWorldID())return void t("Not currently in a world")
var r=worldMetadata().created
var a=new Date(r)
var i=max(0,round((Date.now()-r)/1e3))
t(null,"World created at: "+dateToSafeLocaleString(a)+" ("+secondsToFriendlyString(i,true)+" ago)\nTimestamp="+r+" ("+a.toUTCString()+")")}})
cmd_parse.register({cmd:"stuck",help:"Warp someplace random nearby if available Waygates are blocked",access_run:["world_areabuilder"],func:function func(e,t){var r=unstuckBlocked()
if(r)return void t("/stuck not available: "+r)
unstuck()
t()}})
cmd_parse.register({cmd:"csr_grant",access_run:["sysadmin"],help:"(Admin) Grant a specific entitlement to self or a user",usage:"$HELP\n  Usage: /csr_grant EntitlementID [UserID] [REVOKE]\nPossible entitlements: "+Object.keys(entitlements).filter(function(e){return!e.includes("test")}).join(", "),func:function func(e,t){var r=e.split(" ")
if(r.length<1||r.length>3)return void t("Invalid number of arguments")
if(r[2]&&"REVOKE"!==r[2].toUpperCase())return void t('Third parameter must be "REVOKE" or nothing')
if(2===r.length&&"REVOKE"===r[1].toUpperCase()){r[2]=r[1]
r[1]=void 0}var a=r[0]
var i=r[1]||netSubs().loggedIn()
var o=r[2]&&"REVOKE"===r[2].toUpperCase()
if(!entitlements[a])return void t("Invalid EntitlementID")
netSubs().getChannelImmediate("user."+i).send("grant",{id:a,revoke:o},function(e){t(e,!e?(o?"Revoked":"Granted")+" "+a+" "+(o?"from":"to")+" "+i:null)})}})
var elevate_registered_connect
cmd_parse.register({cmd:"elevate",access_run:["sysadmin"],help:"(Admin) Toggle elevated permissions level to override world access",func:function func(e,a){if(!elevate_registered_connect){elevate_registered_connect=true
netSubs().on("connect",function(){elevated=false})}var t=!elevated
netClient().send("elevate",t,function(e,r){if(e)return void a(e)
elevated=t
worldInfoCacheClear()
updateEditVolumes()
if(!getWorldChannel())return void a(e,r)
worldCmdParse("update_access",function(e,t){a(e,r)})})}})
cmd_parse.register({cmd:"play_as_visitor",access_run:["world_areabuilder"],help:"Toggle previewing a world as a read-only Visitor",func:function func(e,t){if(adventureMode()&&!cmd_parse.checkAccess(["sysadmin"])&&!engine.DEBUG)return void t("Not allowed in Lost Frontier worlds")
else if(worldRaceAsVisitor()&&userDataGet("race_data"))return void t("Not allowed during a race in this world.")
playAsViewerSet(!isPlayAsViewer())
t(null,isPlayAsViewer()?"Now playing as a VISITOR":"Now NOT playing as a VISITOR")}})
cmd_parse.register({cmd:"user_attrib",access_run:["sysadmin"],help:"(Admin) Get/set user attribute",usage:"$HELP\n  Usage: /user_attrib [ATTRIB [VALUE|MAX]]\nexample: /user_attrib stamina MAX",func:function func(e,t){if(!(e=e.split(" "))[0]||e.length>2){var r=userAttribs()
var a=["Current attribs:"]
for(var i in r)a.push("  "+i+" = "+r[i])
return void t(null,a.join("\n"))}var o=e,n=o[0],s=o[1]
if(2===e.length){if("max"===s.toLowerCase())s=ATTRIB_FIXED_MAX
else s=Number(s)
if(!isFinite(s))return void t("Invalid VALUE")
var l=s-userAttribGet(n)
if(l)userAttribModBatched(n,l)}t(null,n+" = "+userAttribGet(n)+" ("+userAttribGetFixed(n).toFixed(3)+")")}})
cmd_parse.register({cmd:"energy",access_run:["sysadmin"],help:"(Admin) Get/set ⚡",usage:"$HELP\n  Usage: /energy [VALUE|MAX]",func:function func(e,t){if(e){if("max"===e.toLowerCase())e=Infinity
else e=Number(e)
var r=(e=clamp(e,0,userStaminaMax()))-userStaminaCur()
if(r)userStaminaMod(null,r)}t(null,"⚡ = "+userStaminaCur()+" / "+userStaminaMax())}})
cmd_parse.register({cmd:"quit",help:"Leave current world and return to the main menu",func:function func(e,t){if(!getWorldID())return void t("Not currently in a world")
main.returnToMainMenu()
t()}})
cmd_parse.register({cmd:"flat_ore_type",help:"(Admin) Set ore type for flat worlds",usage:"$HELP\n  Usage: /flat_ore_type [IRON|EMBERYLLIUM|etc]\n  Usage: /flat_ore_type -1 (varies every 16 voxels)",access_run:["sysadmin"],func:function func(e,t){if(e){var r
if("-1"===e)r=-1
else{if(!(r=INV_MATERIAL_NAME[e.toUpperCase()]))return void t('Unknown material "'+e+'"')
if(MATERIAL_CLASS[r]!==MaterialClass.METAL)return void t('"'+e+'" is not a metal')}setFlatOreType(r)
taskCreate({worker:WORKER_MESH,time:0,type:"flat_ore_type",data:r},nop)
remeshAll()}t(null,"Ore type = "+(MATERIAL_NAME[getFlatOreType()]||"Varying"))}})
cmd_parse.register({cmd:"trans_compact_debug",help:"(Admin) Debug a transaction compaction error",access_run:["sysadmin"],func:function func(e,t){e=e||"<paste trans_compact_debug here>"
var r=(new TransactionSet).trans()
r.fromJSON(JSON.parse(e))
r.compact()
t(null,"No error")}})
function cmdFromDefine(t){cmd_parse.registerValue(t,{type:cmd_parse.TYPE_INT,label:t,range:[0,1],get:function get(){return engine.defines[t]?1:0},set:function set(e){return engine.defines[t]=Boolean(e)},access_show:["hidden"]})}["CHUNKMAN","DEBUGHEXOME","DEBUGCURSOR","NOLODS","NOMESHWORKERS","NOPP","NOPROPS","NOSKY","NOSUN","NOWORKERS","SKYEDIT","TRANSDELAY"].forEach(cmdFromDefine)},{"../common/entitlements":194,"../common/globals":197,"../common/ids":198,"../common/megachunk_common":202,"../common/waygate_common":210,"../common/world_constants":212,"../common/world_trans":213,"../glov/client/cmds":244,"../glov/client/engine":250,"../glov/client/fscreen":262,"../glov/client/localization":275,"../glov/client/net":279,"../glov/client/ui":306,"../glov/client/urlhash":307,"../glov/common/md5.js":324,"../glov/common/util":330,"../glov/common/verify":331,"./build_mode":27,"./editvolume_client":72,"./energy_well":73,"./inventory":94,"./items":98,"./localization/localization":108,"./main":112,"./main_menu":113,"./materials":114,"./orient":122,"./proc_gen":132,"./race_ui":144,"./stuck":159,"./task_sched":161,"./tiles":162,"./user_data":170,"./voxel_data":175,"./world_comm":182,"./world_metadata":186,assert:void 0}],35:[function(e,t,r){"use strict"
r.getEntityManager=getEntityManager
r.getEntityPosManager=getEntityPosManager
r.getMyEntID=getMyEntID
r.allocPerEntData=allocPerEntData
r.clientEntitiesJoinWorld=clientEntitiesJoinWorld
r.registerMovingAnim=registerMovingAnim
r.clientEntitiesStartup=clientEntitiesStartup
r.clientEntitiesTick=clientEntitiesTick
r.clientEntitiesTickLate=clientEntitiesTickLate
r.clientEntityForUser=clientEntityForUser
r.adminWantsNoEntity=adminWantsNoEntity
var a=e("assert")
var i=e("../glov/client/cmds").cmd_parse
var o=e("../glov/client/engine").getFrameTimestamp
var n=e("../glov/client/entity_manager_client").clientEntityManagerCreate
var s=e("../glov/client/entity_position_manager")
var l=s.PerEntData
var c=s.entityPositionManagerCreate
var _=e("../glov/common/verify")
var u=e("../common/entity_worlds_common.js")
var d=u.ENT_TOL_POS
var f=u.ENT_TOL_ROT
var v=u.EntityType
var h=e("../common/items_common").sameItem
var p=e("./ai.js").aiTick
var m=e("./entity_worlds_client").EntityWorldsClient
var g=e("./world_comm")
var E=g.getWorldChannel
var y=g.worldCmdParse
var T
var I
function getEntityManager(){return T}function getEntityPosManager(){return I}function getMyEntID(){return T.getMyEntID()}function allocPerEntData(){return new l(I)}function clientEntitiesJoinWorld(e){T.reinit({channel:e})
I.reinit()}function onEntUpdate(e){var t=T.getEnt(e)
a(t)
var r=t.draw_data
if(!r)return
r.last_receive_time=o()
if(r.last_costume!==t.data.costume){r.last_costume=t.data.costume
r.costume_mod++}}var S={}
function registerMovingAnim(e){S[e]=true}function animIsStopped(e){return!S[e]}function entityPositionManagerErrorHandler(e){if("ERR_FAILALL_DISCONNECT"!==e&&"ERR_NO_ENTITY"!==e){console.error(new Error(e))
_(false,e)}}function clientEntitiesStartup(){(T=n({channel_type:"world",EntityCtor:m})).on("ent_update",onEntUpdate)
I=c({entity_manager:T,dim_pos:3,dim_rot:3,tol_pos:d,tol_rot:f,anim_state_defs:{anim:{stopped:animIsStopped},anim_secondary:{stopped:animIsStopped},held_item:{equal:h}},error_handler:entityPositionManagerErrorHandler})}function clientEntitiesTick(){T.tick()
p()}function clientEntitiesTickLate(){T.actionListFlush()}function clientEntityForUser(e){var t=T.entities
for(var r in t){var a=t[r]
if(a.data.type===v.Player&&a.data.user_id===e)return a}return null}var A=false
i.registerValue("admin_entity",{type:i.TYPE_INT,help:"(Admin) Have a player avatar or not (invisible)",access_run:["sysadmin"],range:[0,1],get:function get(){return A?0:1},set:function set(e){A=!e
if(E())y("world_admin_no_ent "+(A?1:0))}})
function adminWantsNoEntity(){return A}},{"../common/entity_worlds_common.js":195,"../common/items_common":200,"../glov/client/cmds":244,"../glov/client/engine":250,"../glov/client/entity_manager_client":252,"../glov/client/entity_position_manager":253,"../glov/common/verify":331,"./ai.js":4,"./entity_worlds_client":74,"./world_comm":182,assert:void 0}],36:[function(e,t,r){"use strict"
r.setThreadName=setThreadName
r.threadName=threadName
var a="main"
function setThreadName(e){a=e}function threadName(){return a}},{}],37:[function(e,t,r){"use strict"
r.continentSeed=continentSeed
r.continentHandleData=continentHandleData
r.continentGetIDs=continentGetIDs
r.continentGetID=continentGetID
r.continentGet=continentGet
r.continentReady=continentReady
var d=e("assert")
var a=e("./continent_serialize.js").continentDeserialize
var i=e("../common/globals.js").ID_FACTOR
var h=Math.abs,o=Math.floor,f=Math.max,p=Math.min,n=Math.round
var s=e("./proc_gen_biomes.js").getContinentIDsForPos
var l=e("./proc_gen_constants.js").HEX_HEIGHT
var c=e("../glov/common/vmath.js").v2set
var _=256
var m=.25
var u
var g=new Uint8Array(_*_)
var E=[[_,1,1-_,-_,-1-_,-1],[_,1+_,1,-_,-1,-1+_]]
function Continent(e,t){this.cid=e
var r=n(e/i)
var a=e-r*i
this.width=_
this.height=_
this.hx=a*_
this.hy=r*_
this.init(t)}Continent.prototype.init=function(e){var t=e.elev,r=e.humidity,a=e.river,i=e.max_elevation,o=e.sea_level,n=e.water_level,s=e.classif
d(t instanceof Uint16Array)
d(r instanceof Uint8Array)
d(a instanceof Uint8Array)
d(s instanceof Uint8Array)
var l=this.total_size=_*_
this.land_range=i-o
this.max_elevation=(i-o)*m
this.water_level_source=n
this.water_level=new Uint16Array(l)
this.elev_source=t
this.elev=new Float32Array(l)
this.humidity=r
this.river=a
this.classif=s
d.equal(l,this.elev.length)
d.equal(l,this.humidity.length)
d.equal(l,this.river.length)
this.coast_distance=new Uint8Array(l)
this.flow=new Uint8Array(l)
this.default_water_level=0
this.calcElevation(o)
this.findCoast()
this.generateDF()
this.calcSlopes()
this.calcFlow()}
Continent.prototype.calcFlow=function(){var e=this.total_size,c=this.flow,_=this.river
function fillStrahler(e,t){var r=_[e]
var a=[]
for(var i=0;i<6;++i)if(i!==t&&r&1<<i)a.push(i)
var o
if(!a.length)o=1
else{var n=E[1&e]
if(1===a.length)o=fillStrahler(e+n[a[0]],(a[0]+3)%6)
else{d.equal(a.length,2)
var s=fillStrahler(e+n[a[0]],(a[0]+3)%6)
var l=fillStrahler(e+n[a[1]],(a[1]+3)%6)
if(s===l)o=s+1
else o=f(s,l)}}c[e]=p(o,31)<<3|t
return o}var t=[]
for(var r=0;r<e;++r){var a=_[r]
if(!a)continue
var i=E[1&r]
var o=false
for(var n=0;n<i.length;++n)if(a&1<<n){var s=r+i[n]
if(!_[s]){d(!o)
o=true
var l=fillStrahler(r,n)
c[s]=l<<3|7}}}for(var u=0;u<t.length;++u)c[t[u]]=7}
Continent.prototype.calcElevation=function(e){var t=this.total_size,r=this.elev_source,a=this.elev,i=this.water_level,o=this.water_level_source
for(var n=0;n<t;++n){a[n]=(r[n]-e)*m+this.default_water_level
var s=o[n]
i[n]=(s?(s-e)*m:0)+this.default_water_level}}
Continent.prototype.findCoast=function(){var e=this.total_size,t=this.elev,r=this.default_water_level
var a=this.coast=[]
for(var i=0;i<e;++i)if(t[i]>=r){var o=E[1&i]
var n=false
for(var s=0;s<o.length;++s)if(t[i+o[s]]<r){n=true
break}if(n)a.push(i)}}
Continent.prototype.generateDF=function(){g.fill(0)
var e=this.coast,t=this.coast_distance,r=this.width,a=this.height
var i=e
var o=0
for(var n=0;n<i.length;++n){var s=i[n]
t[s]=o
g[s]=1}while(i.length){o=p(o+1,255)
var l=[]
for(var c=0;c<i.length;++c){var _=i[c]
var u=E[1&_]
for(var d=0;d<u.length;++d){var f=_+u[d]
if(!g[f]){g[f]=1
t[f]=o
var v=_%r
var h=(_-v)/r
if(!v||!h||v===r-1||h===a-1);else l.push(f)}}}i=l}t[0]=p(t[1]+1,255)
t[this.total_size-1]=p(t[this.total_size-2]+1,255)}
function calcSlope(e,t,r){if(t-e<0&&r-t>0)return 0
return(r-e)/(2*l)}Continent.prototype.calcSlopes=function(){var e=this.total_size,t=this.elev,r=this.width,a=this.height
var i=this.slopes=new Float32Array(4*e)
var o=4/m/this.land_range
for(var n=1;n<a-1;++n)for(var s=1;s<r-1;++s){var l=n*r+s
var c=t[l]
var _=E[1&l]
var u=0
for(var d=0;d<3;++d){var f=t[l+_[d+3]]
var v=t[l+_[d]]
u+=h(f-c)
u+=h(v-c)
i[4*l+d]=calcSlope(f,c,v)}i[4*l+3]=u*o}}
Continent.prototype.getHumidity=function(e){return this.humidity[e]/255}
Continent.prototype.getElevation=function(e){return this.elev[e]}
Continent.prototype.getClassif=function(e){return this.classif[e]}
Continent.prototype.getRiver=function(e){return this.river[e]}
Continent.prototype.getFlowDir=function(e){return 7&this.flow[e]}
Continent.prototype.getFlowAmount=function(e){return this.flow[e]>>3}
Continent.prototype.getWaterLevel=function(e){return this.water_level[e]-1}
Continent.prototype.getCoastDistance=function(e){return this.coast_distance[e]/(this.width+this.height)}
Continent.prototype.getSlopes=function(e){return this.slopes.slice(4*e,4*e+4)}
Continent.prototype.getMinElev=function(e){var t=E[1&e]
var r=this.elev
var a=r[e]
for(var i=0;i<t.length;++i)a=p(r[e+t[i]],a)
return a}
function continentSeed(e){u={}}function continentHandleData(e){for(var t=0;t<e.length;++t){var r=e[t]
d.equal(typeof r.cid,"number")
d(!u[r.cid])
d(r.buffer instanceof Uint8Array)
u[r.cid]=new Continent(r.cid,a(r.buffer))}}Continent.prototype.getMidpointHexomePos=function(e){var t=o(this.width/2)
var r=this.hx+t
var a=o(this.hy+this.height/2+t/2)
return c(e,r,a)}
function continentGetIDs(e,t){t-=o((e+1)/2)
var r=o(e/_)
var a=o(t/_)
return{cid:r+a*i,idx:e-r*_+(t-a*_)*_}}function continentGetID(e,t){t-=o((e+1)/2)
return o(e/_)+o(t/_)*i}function continentGet(e){var t=u[e]
d(t)
return t}var v=[]
function continentReady(e,t){var r=s(v,e,t)
for(var a=0;a<r;++a){var i=v[a]
if(!u[i])return false}return true}},{"../common/globals.js":197,"../glov/common/vmath.js":332,"./continent_serialize.js":39,"./proc_gen_biomes.js":133,"./proc_gen_constants.js":134,assert:void 0}],38:[function(e,t,r){"use strict"
r.continentLoaderProvideC0=continentLoaderProvideC0
r.continentLoadsWaiting=continentLoadsWaiting
r.continentLoaderLeaveWorld=continentLoaderLeaveWorld
r.continentLoaderSeedWorld=continentLoaderSeedWorld
r.continentLoaderReady=continentLoaderReady
r.continentLoaderWhenReady=continentLoaderWhenReady
r.continentLoaderReadyChunkPos=continentLoaderReadyChunkPos
r.continentLoaderWhenReadyChunkPos=continentLoaderWhenReadyChunkPos
var c=e("./localization/localization").L
var _=e("assert")
var a=e("../common/async_dictionary.js").createAsyncDictionary
var i=e("../glov/client/error_report.js").errorReportSetDetails
var u=e("./file_management.js").upload
var o=e("../common/globals.js").CHUNK_SIZE
var d=e("./loading_custom.js").loadingCustomSetMessage
var n=e("../glov/client/net.js"),f=n.netClient,v=n.netSubs
var h=e("./proc_gen_biomes.js").getContinentIDsForPos
var s=e("../glov/common/rand_alea.js").mashString
var l=e("./task_sched.js"),p=l.workerFlush,m=l.taskCreate,g=l.WORKER_GEN
var E=e("./user_data.js").worldReadOnly
var y=e("../glov/common/vmath.js"),T=y.vec2,I=y.v2scale
var S=e("./voxel_gen.js").voxelGenQueueContinentData
var A=e("./world_comm.js"),w=A.whenConnected,L=A.getWorldID,R=A.getWorldChannel
e("not_worker")
var x=0
var O=false
var b
var N
function continentLoaderProvideC0(e){N=e}function onlyOne(r){var a=false
var i=[]
function onDone(){_(a)
if(!i.length){a=false
return}var e=i.splice(0,1)[0]
r.apply(null,e)}return function(){var e=Array.prototype.slice.call(arguments,0)
var t=e[e.length-1]
e[e.length-1]=function(){onDone()
t.apply(void 0,arguments)}
if(a){i.push(e)
return}a=true
r.apply(null,e)}}function continentGen(e,t,r){if(0===e&&N){i("modapi_cdata",1)
return void r(N,true)}m({worker:g,type:"gen_continent",data:{seed:t}},r)
p(g)}function continentSeed(e){return s(b+"_"+e)}var C="ERR_RESET"
function loadContinentData(o,n){var s=L()
_.equal(typeof s,"string")
var l=x
function handleData(e){S({buffer:e,cid:o})
n(null,{})}var t=5
function doAttempt(e){if(l!==x)return void n(C)
if(!--t)throw e
profilerStart("loadContinentData:doAttempt")
console.log("world_id:"+s+", continent:"+o+", loading...")
function doGen(){d(c.CONTINENT_LOADER_NEW)
console.log("world_id:"+s+", continent:"+o+", generating...")
continentGen(o,continentSeed(o),function(a,i){if(l!==x)return void n(C)
if(E()){d(c.CONTINENT_LOADER_COMPLETE,true)
return void handleData(a)}d(c.CONTINENT_LOADER_SYNCING)
console.log("world_id:"+s+", continent:"+o+", uploading...")
u({u8:a,mime_type:"application/x-continent-data"},function(e,t){if(e){console.error("Error uploading continent data to server",e)
return void doAttempt(e)}console.log("world_id:"+s+", continent:"+o+", sending to world...")
var r=f().pak("world_continent_save")
r.writeString(s)
r.writeInt(o)
r.writeInt(t)
r.writeBool(i)
r.send(function(e){if(l!==x)return void n(C)
if(e){console.error("Error setting continent data on world worker",e)
return void doAttempt(e)}console.log("world_id:"+s+", continent:"+o+", generation complete!")
d(c.CONTINENT_LOADER_COMPLETE,true)
handleData(a)})})})}w(function(){if(l!==x)return void n(C)
_.equal(L(),s)
var e=R().pak("world_continent_load")
e.writeInt(o)
e.send(function(e,t){var r
if(t&&"number"===typeof t)r=v().uploadGetFile(t)
if(l!==x)return void n(C)
if(e){console.log("world_id:"+s+", continent:"+o+":",e)
if("ERR_CONTINENT_NEED_GEN"===e)return void doGen()
setTimeout(doAttempt.bind(null,e),250)
return}console.log("world_id:"+s+", continent:"+o+", received file #"+t)
_(!r.err,r.err)
handleData(r.buffer)})})
profilerStop("loadContinentData:doAttempt")}doAttempt()}var M=onlyOne(function(e,t,r){if(e!==x)return void r(C)
loadContinentData(t,r)})
var D=a({loader:function loader(e,t){M(x,e,t)}})
function continentReady(e){if(!O)return true
return Boolean(D.get(e))}function continentLoadsWaiting(){return D.numLoading()}function continentLoaderLeaveWorld(){++x
D.reset()}function continentLoaderSeedWorld(e){O="flat"!==e.world_type
b=e.seed;++x
D.reset()}var P=[]
function continentLoaderReady(e,t){if(!O)return true
var r=h(P,e,t)
for(var a=0;a<r;++a)if(!continentReady(P[a]))return false
return true}function clwrOnReady(e){if(--e.waiting)return
profilerStart("continentLoaderWhenReady:cb")
e.cb()
profilerStop()}var k=[]
function continentLoaderWhenReady(e,t,r){if(!O)return void r()
var a=h(k,e,t)
var i=0
var o
var n
for(var s=0;s<a;++s){var l=k[s]
if(!D.get(l)){i++
if(!o)o=clwrOnReady.bind(null,n={cb:r})
D.get(l,o)}}if(i)n.waiting=i
else r()}var B=T()
function continentLoaderReadyChunkPos(e,t){I(B,e,o)
return continentLoaderReady(B,t)}function continentLoaderWhenReadyChunkPos(e,t,r){I(B,e,o)
continentLoaderWhenReady(B,t,r)}},{"../common/async_dictionary.js":190,"../common/globals.js":197,"../glov/client/error_report.js":255,"../glov/client/net.js":279,"../glov/common/rand_alea.js":327,"../glov/common/vmath.js":332,"./file_management.js":82,"./loading_custom.js":105,"./localization/localization":108,"./proc_gen_biomes.js":133,"./task_sched.js":161,"./user_data.js":170,"./voxel_gen.js":177,"./world_comm.js":182,assert:void 0,not_worker:void 0}],39:[function(e,t,r){"use strict"
r.encodeRLEZeroes=encodeRLEZeroes
r.encodeRLEU2=encodeRLEU2
r.encodeRLEU3=encodeRLEU3
r.encodeRLEDict=encodeRLEDict
r.encodeDeltaPakInt=encodeDeltaPakInt
r.continentSerialize=continentSerialize
r.continentDeserialize=continentDeserialize
var l=e("assert")
var a=e("../glov/common/packet.js"),c=a.packetCreate,_=a.packetFromBuffer,u=a.PACKET_DEBUG
var d=2
var i=1
var o=2
var n=3
var s=4
var f=5
var v=["elev","water_level","humidity","river","classif"]
var h={elev:i,water_level:o,humidity:i,river:n,classif:f}
var p={elev:i,water_level:o,humidity:i,river:n,classif:s}
var m={elev:Uint16Array,water_level:Uint16Array,humidity:Uint8Array,river:Uint8Array,classif:Uint8Array}
function encodeRLEZeroes(e,t){var r=t.length
var a=0
for(var i=0;i<r;++i){var o=t[i]
if(o){if(a){e.writeInt(a)
a=0}e.writeInt(o)}else{if(!a)e.writeInt(o)
a++}}if(a)e.writeInt(a)}function decodeRLEZeroes(e,t){var r=0
while(r<e.length){var a=t.readInt()
var i=1
if(!a)i=t.readInt()
l(r+i<=e.length)
for(var o=0;o<i;++o)e[r++]=a}}function encodeRLEU2(t,e){var r=e[0]
var a=e.length
var i=0
function writecv(){var e=r<<6|i
t.writeU8(e)}for(var o=1;o<a;++o)if(e[o]!==r||63===i){writecv()
i=0
r=e[o]}else i++
writecv()}function encodeRLEU3(t,e){var r=e[0]
var a=e.length
var i=0
function writecv(){var e=r<<5|i
t.writeU8(e)}for(var o=1;o<a;++o)if(e[o]!==r||31===i){writecv()
i=0
r=e[o]}else i++
writecv()}function decodeRLEU2(e,t){var r=0
while(r<e.length){var a=t.readU8()
var i=1+(63&a)
a>>>=6
l(r+i<=e.length)
for(var o=0;o<i;++o)e[r++]=a}}function decodeRLEU3(e,t){var r=0
while(r<e.length){var a=t.readU8()
var i=1+(31&a)
a>>>=5
l(r+i<=e.length)
for(var o=0;o<i;++o)e[r++]=a}}function encodeRLEDict(t,e){var r=e[0]
var a=e.length
var i=0
var o=[]
var n=0
function writecv(){t.writeInt(i)
var e=o[r]
if(void 0!==e)t.writeInt(e)
else{e=o[r]=n++
t.writeInt(e)
t.writeInt(r)}}for(var s=1;s<a;++s)if(e[s]!==r){writecv()
i=0
r=e[s]}else i++
writecv()}function decodeRLEDict(e,t){var r=0
var a=[]
while(r<e.length){var i=t.readInt()+1
var o=t.readInt()
var n=a[o]
if(void 0===n)n=a[o]=t.readInt()
l(r+i<=e.length)
for(var s=0;s<i;++s)e[r++]=n}}function encodeDeltaPakInt(e,t){var r=124
var a=t.length
for(var i=0;i<a;++i){var o=t[i]-r+124
e.writeInt(o)
r=t[i]}}function decodeDeltaPakInt(e,t){var r=e.length
var a=124
for(var i=0;i<r;++i){a+=t.readInt()-124
e[i]=a}}function encodeToPacket(e,t,r){switch(t){case i:encodeDeltaPakInt(e,r)
break
case o:encodeRLEDict(e,r)
break
case n:encodeRLEZeroes(e,r)
break
case s:encodeRLEU2(e,r)
break
case f:encodeRLEU3(e,r)
break
default:l()}}function decodeFromPacket(e,t,r){switch(t){case i:decodeDeltaPakInt(e,r)
break
case o:decodeRLEDict(e,r)
break
case n:decodeRLEZeroes(e,r)
break
case s:decodeRLEU2(e,r)
break
case f:decodeRLEU3(e,r)
break
default:l()}}var g=227
function continentSerialize(t,e){var r=t.sea_level,a=t.max_elevation
var i=t.elev.length
var o=c(e?u:0,4*i)
o.writeFlags()
o.writeInt(d)
o.writeInt(r)
o.writeInt(a)
o.writeInt(i)
v.forEach(function(e){l(t[e]instanceof m[e])
o.writeInt(g)
o.writeInt(h[e])
encodeToPacket(o,h[e],t[e])})
o.makeReadable()
var n=o.getBufferLen()
var s=o.getBuffer().slice(0,n)
o.pool()
return s}function continentDeserialize(e){var i={}
var o=_(e,e.length,false)
o.readFlags()
var n=o.readInt()
i.sea_level=o.readInt()
i.max_elevation=o.readInt()
var s=o.readInt()
l(s<=262144)
v.forEach(function(e){var t=o.readInt()
l.equal(t,g)
var r=m[e]
var a=i[e]=new r(s)
if(n>1)decodeFromPacket(a,o.readInt(),o)
else decodeFromPacket(a,p[e],o)})
return i}},{"../glov/common/packet.js":325,assert:void 0}],40:[function(e,t,r){"use strict"
r.movementShared=movementShared
r.rotationShared=rotationShared
r.updateFacing=updateFacing
r.DOWN=r.UP=void 0
var f=e("../glov/client/camera2d.js")
var a=e("../glov/client/cmds.js").cmd_parse
var v=e("../glov/client/engine.js")
var h=e("../glov/client/input.js")
var i=e("../glov/client/input.js")
var c=i.KEYS
var o=i.PAD
var p=e("../glov/client/ui.js")
var m=e("../glov/common/util.js").defaults
var n=e("../glov/common/vmath.js")
var _=n.v2add
var u=n.v2lengthSq
var d=n.v2scale
var g=n.v2set
var E=n.v2sub
var s=n.v3cross
var l=n.v3iNormalize
var y=n.v3same
var T=n.v3zero
var I=n.vec2
var S=n.vec3
var A=n.zero_vec
var w=e("./base_controller.js")
var L=w.isDoubleJumpToFlyController
var R=w.isFlyingController
var x=w.isJumpingController
var O=e("./layout.js")
var b=O.TC_DPAD_BOT_PAD
var N=O.TC_DPAD_LEFT_PAD
var C=O.TC_DPAD_RADIUS
var M=O.TC_VERTBUTTONS_FH
var D=O.TC_VERTBUTTONS_H
var P=O.TC_VERTBUTTONS_W
var k=O.quickbarOnRight
var B=e("./localization/localization").L
var U=e("./main.js").isQuickbarVisible
var G=e("./main.js")
var F=e("./quickbar.js").quickbarPadLeft
var W=e("./styles.js")
var j=W.color_touch_dpad_border
var H=W.color_touch_dpad_cursor
var z=W.color_touch_sprint_active
var V=W.color_touch_sprint_inactive
var Y=W.touch_jump_button_colors
var q=e("./ui_util.js")
var K=e("./user_data.js").flyingAllowed
var X=e("../glov/client/settings.js")
var Q=Math.abs,J=Math.cos,$=Math.min,ee=Math.round,te=Math.sin,re=Math.sqrt,ae=Math.PI
var ie=S(0,0,1)
r.UP=ie
var oe=S(0,0,-1)
r.DOWN=oe
var ne=S()
var se=S()
var le={in_event_cb:h.pointerLockEnter}
function lockPointerOnMovement(){if(!h.pointerLocked()){h.keyDownEdge(c.W,le)
h.keyDownEdge(c.A,le)
h.keyDownEdge(c.S,le)
h.keyDownEdge(c.D,le)
h.keyDownEdge(c.LEFT,le)
h.keyDownEdge(c.RIGHT,le)
h.keyDownEdge(c.UP,le)
h.keyDownEdge(c.DOWN,le)}}var ce=0
function arrowsDoMovement(){return!ce||ce<v.frame_timestamp-15e3}function handleMovementKeyInput(e,t){lockPointerOnMovement()
e[0]=(h.keyDown(c.D)-h.keyDown(c.A))/t
e[1]=(h.keyDown(c.W)-h.keyDown(c.S))/t
if(e[0]||e[1])ce=v.frame_timestamp
if(arrowsDoMovement())e[1]+=(h.keyDown(c.UP)-h.keyDown(c.DOWN))/t
e[0]*=X.kb_speed
e[1]*=X.kb_speed
h.padGetAxes(ne,0)
e[0]+=ne[0]
e[1]+=ne[1]}function handleSprintInput(e,t){t.sprinting=h.keyDown(c.SHIFT)+h.padButtonDown(o.LT)
if(h.keyDownEdge(c.EQUALS))e.auto_run=!e.auto_run
if(e.auto_run)if(Q(t[0])+Q(t[1])>.1)e.auto_run=false
else{t.sprinting=1
t[1]++}}var _e=96
function touchDPadControls(e,t,r,a,i){if(!v.defines.NOUI)p.drawCircle(r,a,Z.UI,i,.99,j)
var o=h.drag({x:r-i,y:a-i,w:2*i,h:2*i,eat_clicks:true})
var n=false
if(o){E(se,o.cur_pos,[r,a])
d(se,se,1/i)
n=se[1]<-1.5
if(se[1]<-1&&!v.defines.NOUI)p.buttonImage({x:r-_e/2,y:a-2*i,w:_e,h:_e,img:q.sprite,frame:q.SPRINT,shrink:1,draw_only:true,color:n?z:V})
d(se,se,2)
var s=u(se)
if(s>1)d(se,se,1/re(s))
var l=.25*i
var c=i-l
p.drawCircle(r+se[0]*c,a+se[1]*c,Z.UI+1,l,.99,H)
se[1]*=-1}else g(se,0,0)
_(e,e,se)
e.sprinting=(e.sprinting||0)+(n?t:0)}function touchModeMovement(e,t,r,a){var i=R(e)&&e.isAerial()
touchDPadControls(t,r,N+F(),f.h()-b,C)
var o=f.w()-P
if(U()&&k())o-=p.button_height
var n={x:o,y:f.h()-D,w:P,h:D,eat_clicks:true,z:Z.UI,font_height:M,text:(i?B.BTN_UP:B.BTN_JUMP).upper(),colors:Y}
var s=h.drag(n)
if(L(e)&&s&&s.is_down_edge)a.num+=s.is_down_edge
var l
var c=D-10
if(i)l=n.y+(c*=.5)
var _
var u
if(s)if(s.cur_pos[0]>=n.x&&s.cur_pos[0]<=n.x+n.w)if(l&&s.cur_pos[1]>=l){_="down";--t[2]}else if(s.cur_pos[1]>=n.y){u="down"
t[2]+=1}n.h=c
n.w-=10
if(i){var d=m({y:l,text:B.BTN_DOWN.upper()},n)
if(!v.defines.NOUI)p.buttonTextDraw(d,_||"regular",false)}else if(x(e)){n.y+=20
n.h-=40
if(e.jump_time)u="down"
else if(e.jump_ok)u="regular"
else u="disabled"}if(!v.defines.NOUI)p.buttonTextDraw(n,u||"regular",false)
while(L(e)&&(s=h.drag(n)))a.num+=s.is_down_edge}var ue=400
var de=6
function checkDoubleJump(e,t){t.num+=h.keyDownEdge(c.SPACE)+h.padButtonDownEdge(o.A)
if(t.num&&K()){var r=Date.now()
for(var a=0;a<t.num;++a)if(r-e.jump_last_tap_time<ue||v.frame_index-e.jump_last_tap_frame<de){e.flying=!e.flying
e.jump_last_tap_time=e.jump_last_tap_frame=0
e.just_toggled_flying=true}else{e.jump_last_tap_time=r
e.jump_last_tap_frame=v.frame_index}}}function handleVerticalInput(e,t,r){t[2]+=(h.keyDown(c.SPACE)||h.padButtonDown(o.A))/r
if(R(e)&&e.isAerial()){var a
if(X.ctrl_disable)a=(h.keyDown(c.C)?!h.keyDown(c.CTRL)&&h.keyDown(c.C):0)||0
else a=h.keyDown(c.C)+h.keyDown(c.CTRL)
t[2]-=(a+h.padButtonDown(o.B))/r}}var fe=S()
var ve={num:0}
function movementShared(e,t,r){e.user_active=false
T(fe)
if(!r){fe.sprinting=0
e.auto_run=false
return fe}handleMovementKeyInput(fe,t)
handleSprintInput(e,fe)
fe[2]=0
ve.num=0
if(h.touch_mode&&!G.chat_ui.isFocused())touchModeMovement(e,fe,t,ve)
var a=u(fe)
if(a>1)d(fe,fe,1/re(a))
if(L(e))checkDoubleJump(e,ve)
handleVerticalInput(e,fe,t)
if(!y(fe,A))e.user_active=true
return fe}X.register({kb_sensitivity:{label:"Keyboard turn sensitivity",default_value:1,type:a.TYPE_FLOAT,range:[0,10]},kb_speed:{label:"Keyboard movement speed",default_value:1,type:a.TYPE_FLOAT,range:[0,1]},pad_sensitivity:{label:"Gamepad turn sensitivity",default_value:1,type:a.TYPE_FLOAT,range:[0,10]}})
var he=Date.now()
var pe=0
var me=0
var ge=0
var Ee=0
var ye=0
var Te=0
a.registerValue("yaw_log",{type:a.TYPE_INT,range:[0,1],get:function get(){return Te},set:function set(e){return Te=e}})
var Ie=.0025
var Se=.002
var Ae=.003
var we=.001
var Le=I()
var Re=I()
var xe=70
var Oe=xe/2
a.registerValue("drag_edge",{label:"Rotate on edge drag area",help:"Set or display how much of the edge of the screen rotates on touch controls",usage:"Set or display what percentage of the edge of the screen causes rotation\nwhen dragged over on touch controls.  Default = 7.\n  Usage: /drag_edge\n  Usage: /drag_dege [0-25]",type:a.TYPE_INT,range:[0,25],get:function get(){return ee(xe/10)},set:function set(e){Oe=(xe=10*e)/2},store:true})
var be=0
function rotationShared(e,t){g(Re,0,0)
var r=h.drag({peek:true,button:h.touch_mode?h.ANY:h.POINTERLOCK})
if(r){Re[0]+=r.delta[0]*Ie*X.mouse_sensitivity
Re[1]+=r.delta[1]*Ie*X.mouse_sensitivity
if(h.touch_mode){var a=0
if(r.cur_pos[0]<xe){if(1&be)a-=$(1,(xe-r.cur_pos[0])/Oe)}else be|=1
if(r.cur_pos[0]>f.x1()-xe){if(2&be)a+=$(1,(r.cur_pos[0]-(f.x1()-xe))/Oe)}else be|=2
var i=0
if(r.cur_pos[1]<xe){if(4&be)i-=$(1,(xe-r.cur_pos[1])/Oe)}else be|=4
if(r.cur_pos[1]>f.y1()-xe){if(8&be)i+=$(1,(r.cur_pos[1]-(f.y1()-xe))/Oe)}else be|=8
Re[0]+=t*we*a
Re[1]+=t*we*i}}else be=0
var o=Se*X.kb_sensitivity
Re[0]-=o*h.keyDown(c.LEFT)
Re[0]+=o*h.keyDown(c.RIGHT)
if(!arrowsDoMovement()){var n=o*h.keyDown(c.DOWN)-o*h.keyDown(c.UP)
if(n){Re[1]+=n
ce=v.frame_timestamp}}h.padGetAxes(Le,1)
Re[0]+=X.pad_sensitivity*Ae*Le[0]*t
Re[1]+=X.pad_sensitivity*Ae*-Le[1]*t
if(Re[0]||Re[1]){e.user_active=true
_(Re,Re,e.ypr)
e.updateYawPitch(Re)}if(Te){var s=e.ypr[0]-pe
if(s<-ae)s+=2*ae
else if(s>ae)s-=2*ae
var l=Date.now()
t=l-he
he=l
pe=e.ypr[0]
ye+=t
ge+=s
Ee+=h.debugGetMouseMoveX()
if(ge&&ye>250){G.chat_ui.addChat((ge/ye*1e3).toFixed(3)+" yaw/s, "+(Ee/ye).toFixed(3)+" px/ms, "+(v.frame_index-me)+" frames, "+ye+"ms")
ge=ye=Ee=0
me=v.frame_index}}}function updateFacing(e){var t=J(-e.ypr[1])
e.facing[0]=te(e.ypr[0])*t
e.facing[1]=J(e.ypr[0])*t
e.facing[2]=te(-e.ypr[1])
s(e.char_right,e.facing,ie)
l(e.char_right)
s(e.char_up,e.char_right,e.facing)
l(e.char_up)}},{"../glov/client/camera2d.js":241,"../glov/client/cmds.js":244,"../glov/client/engine.js":250,"../glov/client/input.js":271,"../glov/client/settings.js":291,"../glov/client/ui.js":306,"../glov/common/util.js":330,"../glov/common/vmath.js":332,"./base_controller.js":18,"./layout.js":99,"./localization/localization":108,"./main.js":112,"./quickbar.js":142,"./styles.js":160,"./ui_util.js":168,"./user_data.js":170}],41:[function(e,t,r){"use strict"
r.hasAutoCrouchComponent=hasAutoCrouchComponent
r.AutoCrouchComponent=void 0
function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype)
_setPrototypeOf(e.prototype.constructor=e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){e.__proto__=t
return e})(e,t)}var s=e("assert")
var a=e("../../glov/common/vmath.js")
var l=a.v3addScale
var c=a.vec3
var _=a.zaxis
function hasAutoCrouchComponent(e){return Boolean(e.auto_crouch_comp)}var i=function(n){_inheritsLoose(AutoCrouchComponent,n)
function AutoCrouchComponent(e,t,r,a){var i;(i=n.call(this,e)||this).crouchable_states=void 0
i.crouched_size_key=void 0
i.uncrouched_size_key=void 0
i.uncrouch_col_bounds=void 0
i.crouched=false
i.can_crouch=true
var o=i.getOwner().sizes
s(o[r])
s(o[a])
s(t)
i.crouchable_states=t
i.crouched_size_key=r
i.uncrouched_size_key=a
i.uncrouch_col_bounds={min:l(c(),o[a].col_bounds.min,_,-.1),max:l(c(),o[a].col_bounds.max,_,.1)}
return i}var e=AutoCrouchComponent.prototype
e.getCrouched=function getCrouched(){return this.crouched}
e.getCanCrouch=function getCanCrouch(){return this.can_crouch}
e.getCrouchEyeHeightOffset=function getCrouchEyeHeightOffset(){var e=this.getOwner().sizes
return e[this.crouched_size_key].eye_height-e[this.uncrouched_size_key].eye_height}
e.getCrouchColBounds=function getCrouchColBounds(){return this.getOwner().sizes[this.crouched_size_key].col_bounds}
e.getUncrouchColBounds=function getUncrouchColBounds(){return this.uncrouch_col_bounds}
e.crouch=function crouch(){s(this.can_crouch)
this.getOwner().toggleSize(this.crouched_size_key)
this.crouched=true}
e.uncrouch=function uncrouch(){this.getOwner().toggleSize(this.uncrouched_size_key)
this.crouched=false}
e.enterCrouchableState=function enterCrouchableState(){this.can_crouch=true}
e.exitCrouchableState=function exitCrouchableState(){if(this.crouched)this.uncrouch()
this.can_crouch=false}
e.reactTransit=function reactTransit(e,t){if(this.crouchable_states.includes(e.getState())){if(!this.crouchable_states.includes(t))this.exitCrouchableState()}else if(this.crouchable_states.includes(t))this.enterCrouchableState()}
return AutoCrouchComponent}(e("./component.js").Component);(r.AutoCrouchComponent=i).exlcusive={enterCrouchableState:true,exitCrouchableState:true,reactTransit:true}},{"../../glov/common/vmath.js":332,"./component.js":42,assert:void 0}],42:[function(e,t,r){"use strict"
r.Component=void 0
var a=function(){function Component(e){this.owner=void 0
this.owner=e}Component.prototype.getOwner=function getOwner(){return this.owner}
return Component}()
r.Component=a},{}],43:[function(e,t,r){"use strict"
r.DebugComponent=void 0
function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype)
_setPrototypeOf(e.prototype.constructor=e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){e.__proto__=t
return e})(e,t)}var o=e("../../common/globals.js").CHUNK_SIZE
var a=e("../base_controller.js")
var n=a.fdeg
var s=a.fpos
var i=e("../controller_modes/mode_common.js")
var l=i.getFloorInfo
var c=i.getFloorPos
var _=e("../debug.js")
var u=e("../voxel_data.js")
function fvec(e,t,r){return t(e[0],r)+", "+t(e[1],r)+", "+t(e[2],r)}var d=function(i){_inheritsLoose(DebugComponent,i)
function DebugComponent(){var e
for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];(e=i.call.apply(i,[this].concat(r))||this).debug_floor_info=void 0
return e}var e=DebugComponent.prototype
e.addControllerDebugText=function addControllerDebugText(){var e=this.getOwner()
var t=u.origin_chunk
var r=e.pos
var a=o
var i=["Pos: "+fvec(r,s,1),"World Pos: "+fvec([r[0]+t[0]*a,r[1]+t[1]*a,r[2]+t[2]*a],s,1)+" (origin: "+t+")","Velocity: "+fvec(e.vel,s,2),"YPR: "+fvec(e.ypr,n),"Facing: "+fvec(e.facing,s,3)]
if(this.debug_floor_info)i.push("  Floor Z: "+this.debug_floor_info[0],"  FlooInfoX: "+JSON.stringify(this.debug_floor_info[1]).replace(/["{}]/g,""),"  FlooInfoY: "+JSON.stringify(this.debug_floor_info[2]).replace(/["{}]/g,""))
_.addText(i.join("\n"))}
e.setDebugFloorInfo=function setDebugFloorInfo(){var e=this.getOwner()
this.debug_floor_info=[c(e,e.pos),l(e,e.pos,0),l(e,e.pos,1)]}
return DebugComponent}(e("./component.js").Component)
r.DebugComponent=d},{"../../common/globals.js":197,"../base_controller.js":18,"../controller_modes/mode_common.js":49,"../debug.js":62,"../voxel_data.js":175,"./component.js":42}],44:[function(e,t,r){"use strict"
r.makePropsOnOffset=makePropsOnOffset
r.FeetCheckComponent=void 0
function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype)
_setPrototypeOf(e.prototype.constructor=e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){e.__proto__=t
return e})(e,t)}var n=e("assert")
var a=e("../../glov/client/engine.js")
var i=e("../../glov/common/vmath.js")
var s=i.v3add
var l=i.v3iFloor
var o=i.vec3
var c=e("../camera.js").getActiveController
var _=e("../debug.js")
var u=e("../voxel_data.js")
var d=e("./component.js").Component
var f=o()
function makePropsOnOffset(e){var t=e.col_bounds,r=e.eye_height
return[o(t.min[0]/2,t.min[1]/2,-r-.1),o(t.min[0]/2,t.max[1]/2,-r-.1),o(t.max[0]/2,t.min[1]/2,-r-.1),o(t.max[0]/2,t.max[1]/2,-r-.1)]}var v=function(o){_inheritsLoose(FeetCheckComponent,o)
function FeetCheckComponent(e,t,r){var a;(a=o.call(this,e)||this).props_on={}
a.props_on_offs_map=void 0
a.props_on_offs=void 0
var i=t[r]
n(i)
a.props_on_offs_map=t
a.props_on_offs=i
return a}var e=FeetCheckComponent.prototype
e.getPropsOn=function getPropsOn(){return this.props_on}
e.setPropsOnOffset=function setPropsOnOffset(e){var t=this.props_on_offs_map[e]
n(t)
this.props_on_offs=t}
e.updatePropsOn=function updatePropsOn(){this.props_on={}
for(var e=0;e<this.props_on_offs.length;++e){var t=u.getPropLocal(l(s(f,this.getOwner().pos,this.props_on_offs[e])))
if(t)this.props_on[t.uid]=t}if(a.defines.FEET&&c()===this.getOwner())_.addText("Props Underfoot: "+(Object.values(this.props_on).map(function(e){return e.inv.getName()}).join()||"none"))}
return FeetCheckComponent}(d)
r.FeetCheckComponent=v},{"../../glov/client/engine.js":250,"../../glov/common/vmath.js":332,"../camera.js":28,"../debug.js":62,"../voxel_data.js":175,"./component.js":42,assert:void 0}],45:[function(e,t,r){"use strict"
r.tryLadderTransit=tryLadderTransit
r.checkLadderTransit=checkLadderTransit
r.calculateFrameTimes=calculateFrameTimes
r.calculateFlooredTargetPos=calculateFlooredTargetPos
r.snapMovementZAxis=snapMovementZAxis
r.calculateNewWalkTypePos=calculateNewWalkTypePos
r.LADDER_GRAB_DISTANCE_SQ=r.LADDER_OFFSET=void 0
var a=e("../../glov/common/vmath")
var f=a.v2add
var n=a.v3addScale
var v=a.v3angle
var h=a.v3copy
var l=a.v3dist
var p=a.v3distSq
var s=a.v3lengthSq
var m=a.v3mul
var g=a.v3sub
var i=a.vec2
var E=a.vec3
var y=e("../../common/ids").ITEM_LADDER
var T=e("../props").rotToVec
var I=e("../voxel_data").raycast3DLocal
var o=e("./mode_common")
var c=o.LADDERCLIMBING_ID
var _=o.WALK_SHIFT_MULT_SPEED
var u=o.checkCollisions
var d=o.collisionPass
var S=o.getFloorInfo
var A=o.getFloorPos
var w=o.sortVelocityAxis
var L=Math.abs,R=Math.ceil,x=Math.floor,O=Math.max,b=Math.min,N=Math.sqrt,C=Math.PI
var M=.001
var D=[i(1,0),i(1,1),i(1,1),i(0,1)]
r.LADDER_OFFSET=D
function tryLadderTransit(e,t,r,a){f(r,r,D[t.rot])
r[2]=e.pos[2]
if(!d(e.col_bounds,r).is_blocked){e.ladder=t
e.setPosAndSmoothCam(e.is_tpv,r)
e.csm.transit(a,c)
return true}return false}var P=2
r.LADDER_GRAB_DISTANCE_SQ=P
var k=E()
var B=E()
var U=E()
function checkLadderTransit(e,t,r){var a=false
for(var i in e.last_tick_props_collided){var o=e.last_tick_props_collided[i]
if(o.item_id===y){var n=v(t,T(o.rot))
o.getLocalPos(B)
h(U,B)
f(U,U,D[o.rot])
var s=p(e.pos,U)
var l=p(e.feet_pos,U)
if(n>C/2&&(s<P||l<P))a=true
else{var c
var _=E()
var u=true
var d=I(_,E(),E(),B,E(0,0,1),o.size[2])
if(d&&"number"!==typeof d&&(null==(c=d.prop)?void 0:c.item_id)===y)u=false
if(u&&l<P&&n<=C/2){g(k,e.feet_pos,U)
m(k,k,T(o.rot))
if(k[0]<0||k[1]<0)a=true}}if(a&&tryLadderTransit(e,o,B,r))break}}}function calculateFrameTimeSprinting(e,t,r){var a=r/_
if(t>a)return b(1,(t/a-1)/(_-1))*e
return 0}function calculateFrameTimeSwimming(e,t,r){return b(1,t/r)*e}function calculateFrameTimes(e,t,r,a,i){var o=0
var n=0
if(i.sprinting||i.underwater){var s=l(e.pos,r)/t
if(i.sprinting)n=calculateFrameTimeSprinting(t,s,a)
if(i.underwater)o=calculateFrameTimeSwimming(t,s,a)}return{frame_time_sprinting:n,frame_time_swimming:o}}var G=E()
function calculateFlooredTargetPos(e,t){var r=A(e,t)
if(t[2]-e.eye_height<r){var a=1e-4
g(G,t,e.pos)
var i=N(s(G))
if(i<a){e.vel[2]=0
h(t,e.pos)}else{G[2]=r+e.eye_height-e.pos[2]+M
var o=N(s(G))
if(o<a){e.vel[2]=0
h(t,e.pos)}else if(i<o)n(t,e.pos,G,i/o)}}}var F=2.001
var W=E()
var j=E()
function limitHorizontalSlopeMovement(e,t,r){h(j,e.pos)
for(var a=0;a<3;++a){var i=t[a]
if(2===i)continue
if(e.vel[i]){var o=S(e,j,i)
var n=o
if(true){h(W,j)
W[i]=r[i]
n=S(e,W,i)}if(e.vel[i]<0){o.slope1*=-1
o.slope2*=-1
if(o!==n){n.slope1*=-1
n.slope2*=-1}}var s=O(o.slope1,o.slope2)
if(s>=F||o.blocked&&n.blocked){r[i]=j[i]
e.vel[i]=0}else{if((s=O(n.slope1,n.slope2))>=F||n.blocked){if(e.vel[i]>0)r[i]=.5*R(2*j[i])-M
else r[i]=.5*x(2*j[i])+M
e.vel[i]=0}j[i]=r[i]}}}}var H=-.008
function snapMovementZAxis(e,t,r){var a=A(e,r)
if(t<a&&a-t<.5){if(e.vel[2]<H)e.just_landed=true
r[2]=a+e.eye_height
if(e.vel[2]<0)e.vel[2]=0}}var z=E()
var V=E()
function calculateNewWalkTypePos(e,t,r){profilerStart("calculateNewWalkTypePos")
n(z,e.pos,e.vel,t)
var a=w(e.vel)
var i
calculateFlooredTargetPos(e,z)
var o=z[2]-e.eye_height
limitHorizontalSlopeMovement(e,a,z)
snapMovementZAxis(e,o,z)
i=L(z[2]-e.pos[2])
h(V,e.pos)
e.props_collided=u(e,t,a,z,V,i,r)
profilerStop("calculateNewWalkTypePos")
return V}},{"../../common/ids":198,"../../glov/common/vmath":332,"../props":141,"../voxel_data":175,"./mode_common":49}],46:[function(e,t,r){"use strict"
r.FlyMode=void 0
function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype)
_setPrototypeOf(e.prototype.constructor=e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){e.__proto__=t
return e})(e,t)}var a=e("../../glov/common/vmath")
var s=a.v2add
var l=a.v3addScale
var c=a.v3angle
var _=a.v3copy
var u=a.v3distSq
var i=a.vec3
var d=e("../../common/ids").ITEM_LADDER
var n=e("../animation_enum").AnimEnum
var f=e("../props").rotToVec
var o=e("../state_machine").State
var v=e("../user_data").userStaminaCur
var h=e("./char_mode_common")
var p=h.LADDER_GRAB_DISTANCE_SQ
var m=h.LADDER_OFFSET
var g=h.calculateFrameTimes
var E=h.tryLadderTransit
var y=e("./mode_common")
var T=y.FLY_ID
var I=y.FREECAM_ID
var S=y.LADDERCLIMBING_ID
var A=y.SITTING_ID
var w=y.WALK_ID
var L=y.calculateMaxSpeed
var R=y.calculateVelocityFlyingDesired
var x=y.checkCollisions
var O=y.processVelocityFlying
var b=y.sortVelocityAxis
var N=Math.PI
var C=i()
var M=i()
var D=i()
var P=i()
var k=i()
var B=i()
var U=function(o){_inheritsLoose(FlyMode,o)
function FlyMode(){var e
var t
for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];(t=o.call.apply(o,[this].concat(a))||this).id=T
t.allowed_transitions=((e={})[I]=true,e[w]=true,e[S]=true,e[A]=true,e)
return t}var e=FlyMode.prototype
e.enter=function enter(){var e=this.sm.getOwner()
e.anim_secondary=n.JUMP
e.setPropsOnOffset("fly")}
e.exit=function exit(){this.sm.getOwner().setPropsOnOffset("tall")}
e.handle=function handle(e){var t=e.impulse
var r=this.sm.getOwner()
if(!r.flying)r.csm.transit(e,w)
if(r.ladder_cooldown<=0)for(var a in r.last_tick_props_collided){var i=r.last_tick_props_collided[a]
if(i.item_id===d){R(P,r,t,1)
var o=c(P,f(i.rot))
i.getLocalPos(k)
_(B,k)
s(B,B,m[i.rot])
var n=u(r.pos,B)
if(o>N/2&&n<p&&E(r,i,k,e))break}}}
e.update=function update(e){profilerStart("FlyMode:update")
var t=e.dt,r=e.do_stamina,a=e.impulse
var i=this.sm.getOwner()
i.makePositionSafe()
_(M,i.vel)
if(!i.anim_in_grace_time)i.anim=i.anim_secondary
var o=L({sprinting:Boolean(a.sprinting),underwater:i.underwater.body,exhausted:r&&!v(),flying:true})
O(i,t,a,o)
l(C,i.pos,i.vel,t)
var n=b(i.vel)
_(D,i.pos)
i.props_collided=x(i,t,n,C,D,0,M)
var s=g(i,t,D,o,{sprinting:Boolean(a.sprinting),underwater:i.underwater.body})
i.setPos(D)
profilerStop("FlyMode:update")
return s}
return FlyMode}(o)
r.FlyMode=U},{"../../common/ids":198,"../../glov/common/vmath":332,"../animation_enum":8,"../props":141,"../state_machine":155,"../user_data":170,"./char_mode_common":45,"./mode_common":49}],47:[function(e,t,r){"use strict"
r.FreeCamMode=void 0
function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype)
_setPrototypeOf(e.prototype.constructor=e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){e.__proto__=t
return e})(e,t)}var a=e("../../glov/client/cmds").cmd_parse
var i=e("../../glov/common/vmath")
var n=i.v3addScale
var s=i.v3copy
var o=i.vec3
var l=e("../state_machine").State
var c=e("./mode_common")
var _=c.FLY_ID
var u=c.FREECAM_ID
var d=c.WALK_ID
var f=e("../../glov/client/settings.js")
var v=Math.min
f.register({freecam_speed:{default_value:1,type:a.TYPE_FLOAT,range:[0,4],access_run:["sysadmin"]}})
var h=.02
var p=3
var m=100
var g=1e4
var E=o()
var y=function(o){_inheritsLoose(FreeCamMode,o)
function FreeCamMode(){var e
var t
for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];(t=o.call.apply(o,[this].concat(a))||this).id=u
t.allowed_transitions=((e={})[_]=true,e[d]=true,e)
t.shift_down_time=0
return t}var e=FreeCamMode.prototype
e.enter=function enter(){}
e.exit=function exit(){}
e.handle=function handle(){}
e.update=function update(e){var t=e.dt,r=e.impulse
var a=this.sm.getOwner()
var i=t*f.freecam_speed*h
if(r.sprinting){this.shift_down_time+=r.sprinting
i*=v(1,this.shift_down_time/g)*(m-p)+p}else this.shift_down_time=0
s(E,a.pos)
n(E,E,a.char_right,r[0]*i)
n(E,E,a.facing,r[1]*i)
n(E,E,a.char_up,r[2]*i)
if(!r[0]&&!r[1]&&!r[2])this.shift_down_time=0
a.setPos(E)}
return FreeCamMode}(l)
r.FreeCamMode=y},{"../../glov/client/cmds":244,"../../glov/client/settings.js":291,"../../glov/common/vmath":332,"../state_machine":155,"./mode_common":49}],48:[function(e,t,r){"use strict"
r.LadderClimbingMode=void 0
function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype)
_setPrototypeOf(e.prototype.constructor=e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){e.__proto__=t
return e})(e,t)}var a=e("../../glov/common/vmath")
var o=a.v2angle
var n=a.v2scale
var c=a.v3addScale
var _=a.v3copy
var s=a.v3iNormalize
var l=a.v3lengthSq
var u=a.v3sub
var i=a.vec3
var d=e("../../common/ids").ITEM_LADDER
var f=e("../animation_enum").AnimEnum
var v=e("../props").rotToVec
var h=e("../state_machine").State
var p=e("../user_data").userStaminaCur
var m=e("./char_mode_common")
var g=m.calculateFlooredTargetPos
var E=m.calculateFrameTimes
var y=m.snapMovementZAxis
var T=e("./mode_common")
var I=T.FREECAM_ID
var S=T.LADDERCLIMBING_ID
var A=T.SITTING_ID
var w=T.WALK_ACCEL
var L=T.WALK_ID
var R=T.calculateMaxSpeed
var x=T.checkCollisions
var O=T.sortVelocityAxis
var b=Math.abs,N=Math.sqrt,C=Math.PI
function chooseLadderClimbAnimation(e,t){if(b(t[1])>.1)if(e.vel[2]>0)if(t.sprinting)e.anim_secondary=f.LADDER_SPRINT
else e.anim_secondary=f.LADDER_CLIMB
else e.anim_secondary=f.LADDER_SLIDE
else e.anim_secondary=f.LADDER_IDLE
if(!e.anim_in_grace_time)e.anim=e.anim_secondary}function calculateVelocityLadderDesired(e,t,r,a){s(r)
var i=o(v(t.ladder.rot),t.facing)>C/2?1:-1
n(e,t.char_right,0)
e[2]=r[1]*a*i
return e}var M=i()
function calculateVelocityLadderToApply(e,t,r,a){u(M,a,t.vel)
var i=r*w
var o=l(M)
if(o<=i*i)_(e,a)
else c(e,t.vel,M,i/N(o))}function processJumpLadder(e,t){if(t){if(e.jump_ok){e.jumping_off=true
e.dropped_from_ladder=true}}else{e.jump_ok=true
e.jump_time=0}}var D=500
var P=100
var k=i()
var B=i()
var U=i()
var G=i()
var F=i()
var W=function(o){_inheritsLoose(LadderClimbingMode,o)
function LadderClimbingMode(){var e
var t
for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];(t=o.call.apply(o,[this].concat(a))||this).id=S
t.allowed_transitions=((e={})[I]=true,e[L]=true,e[A]=true,e)
return t}var e=LadderClimbingMode.prototype
e.enter=function enter(){var e=this.sm.getOwner()
var t=e.ladder
e.dropped_from_ladder=false
var r=t.rot*(C/2)
if(!isNaN(r))e.head_angle[0]=r
e.head_angle[1]=0
e.look_angle=e.head_angle[0]
e.vel[0]=0
e.vel[1]=0
e.vel[2]=0}
e.exit=function exit(){var e=this.sm.getOwner()
delete e.dropped_from_ladder
delete e.ladder}
e.handle=function handle(e){var t=this.sm.getOwner()
_(G,t.pos)
var r=false
for(var a in t.last_tick_props_collided){var i=t.last_tick_props_collided[a]
if(i.item_id===d&&i.rot===t.ladder.rot)r=true}if(t.dropped_from_ladder||!r){t.ladder_cooldown=t.dropped_from_ladder?D:P
t.dropped_from_ladder=false
t.csm.transit(e,L)}}
e.update=function update(e){var t=e.dt,r=e.do_stamina,a=e.impulse
var i=this.sm.getOwner()
i.makePositionSafe()
_(B,i.vel)
i.dropped_from_ladder=false
var o=R({sprinting:Boolean(a.sprinting),underwater:i.underwater.body,exhausted:r&&!p(),ladder:true})
calculateVelocityLadderDesired(F,i,a,o)
calculateVelocityLadderToApply(i.vel,i,t,F)
processJumpLadder(i,a[2]>0)
chooseLadderClimbAnimation(i,a)
c(k,i.pos,i.vel,t)
var n=O(i.vel)
_(U,i.pos)
g(i,k)
var s=k[2]-i.eye_height
y(i,s,k)
i.props_collided=x(i,t,n,k,U,0,B)
var l=E(i,t,U,o,{sprinting:Boolean(a.sprinting),underwater:i.underwater.body})
if(i.on_ground&&F[2]<0)i.dropped_from_ladder=true
i.setPos(U)
return l}
return LadderClimbingMode}(h)
r.LadderClimbingMode=W},{"../../common/ids":198,"../../glov/common/vmath":332,"../animation_enum":8,"../props":141,"../state_machine":155,"../user_data":170,"./char_mode_common":45,"./mode_common":49}],49:[function(e,t,r){"use strict"
r.calculateMaxSpeed=calculateMaxSpeed
r.calculateVelocityHorizontalDesired=calculateVelocityHorizontalDesired
r.calculateVelocityFlyingDesired=calculateVelocityFlyingDesired
r.calculateVelocityFlyingToApply=calculateVelocityFlyingToApply
r.processVelocityFlying=processVelocityFlying
r.sortVelocityAxis=sortVelocityAxis
r.collisionPass=collisionPass
r.uncrouchPos=uncrouchPos
r.checkCollisions=checkCollisions
r.clampPhotoPosition=clampPhotoPosition
r.getFloorPos=getFloorPos
r.getFloorInfo=getFloorInfo
r.WALK_ACCEL=r.WALK_SHIFT_MULT_SPEED=r.FLY_MULT_MAX_SPEED=r.MAX_SPEED=r.PHTMOVE_ID=r.LADDERCLIMBING_ID=r.FLY_ID=r.WALK_ID=r.SWIMMING_ID=r.SITTING_ID=r.FREECAM_ID=void 0
var a=e("../../common/globals.js").VOXELS_PER_M
var i="freeCam"
r.FREECAM_ID=i
var o="sitting"
r.SITTING_ID=o
var n="swimming"
r.SWIMMING_ID=n
var s="walk"
r.WALK_ID=s
var l="fly"
r.FLY_ID=l
var c="ladderClimbing"
r.LADDERCLIMBING_ID=c
var _="phtMove"
r.PHTMOVE_ID=_
var u=.005*a
r.MAX_SPEED=u
var d=2
r.FLY_MULT_MAX_SPEED=d
var f=2
r.WALK_SHIFT_MULT_SPEED=f
var v=e("../../glov/client/engine.js")
var h=e("../../glov/client/ui.js")
var p=e("../../glov/common/util.js")
var m=p.clamp
var g=p.lerp
var E=p.merge
var y=p.sign
var T=e("../../glov/common/vmath.js")
var I=T.v2addScale
var S=T.v2copy
var A=T.v2floor
var w=T.v2normalize
var L=T.v2scale
var R=T.v2set
var x=T.v3add
var O=T.v3addScale
var b=T.v3copy
var N=T.v3iFloor
var C=T.v3iNormalize
var M=T.v3lengthSq
var D=T.v3scale
var P=T.v3set
var k=T.v3sub
var B=T.vec2
var U=T.vec3
var G=T.zaxis
var F=T.zero_vec
var W=e("../base_controller.js")
var j=W.isFlyingController
var H=W.isJumpingController
var z=e("../controller_components/auto_crouch_comp.js").hasAutoCrouchComponent
var V=e("../localization/localization").L
var Y=e("../photo_mode.js").getPhotoBounds
var q=e("../status.js")
var K=e("../user_data.js").worldReadOnly
var Z=e("../voxel_data.js")
var X=e("../world_metadata.js")
var Q=X.unlimitedMode
var J=X.worldPhotoMove
var $=e("../../glov/client/settings.js")
var ee=Math.abs,te=Math.ceil,re=Math.floor,ae=Math.max,ie=Math.min,oe=Math.random,ne=Math.round,se=Math.sqrt
var le=U(0,0,1)
var ce=U(0,0,-1)
var _e=.001
var ue=U()
var de=U()
var fe=.4
var ve=.6
var he=.3
var pe=.6
function calculateMaxSpeed(e){var t=u
if(e.sprinting)t*=f
if(e.crouching)t*=fe
if(e.underwater)if(e.exhausted)t*=he
else t*=ve
if(e.flying)t*=d
if(e.ladder)t*=pe
return t}var me=B()
function calculateVelocityHorizontalDesired(e,t,r,a){S(me,t.facing)
me[2]=0
w(me,me)
L(e,t.char_right,r[0]*a)
I(e,e,me,r[1]*a)
return e}function calculateVelocityFlyingDesired(e,t,r,a){C(r)
if($.fly_relative){D(e,t.char_right,r[0]*a)
O(e,e,t.facing,r[1]*a)
O(e,e,t.char_up,r[2]*a)}else{calculateVelocityHorizontalDesired(e,t,r,a)
e[2]=r[2]*a}return e}var ge=25e-6*a
r.WALK_ACCEL=ge
function calculateVelocityFlyingToApply(e,t,r,a){k(ue,a,t.vel)
var i=r*ge
var o=M(ue)
if(o<=i*i)b(e,a)
else O(e,t.vel,ue,i/se(o))
return e}var Ee=U()
function processVelocityFlying(e,t,r,a){calculateVelocityFlyingDesired(Ee,e,r,a)
calculateVelocityFlyingToApply(e.vel,e,t,Ee)}function sortVelocityAxis(e){var t=[ee(e[0]),ee(e[1]),ee(e[2])]
var r=[0,1,2]
if(t[0]<t[1]){r[0]=1
r[1]=0}if(t[r[1]]<t[2]){r[2]=r[1]
r[1]=2
if(t[r[0]]<t[2]){r[1]=r[0]
r[0]=2}}return r}function tryToUnblock(e,t,r,a,i,o){var n
var s=e.vel[t]>0
if(s)if(2===t)n=te(r[2])-_e-e.col_bounds.max[2]
else n=te(r[t])-_e-e.col_bounds.max[t]
else if(2===t){if(i&&i[0]!==i[1])a[0]=i[0]?1:-1
if(o&&o[0]!==o[1])a[1]=o[0]?1:-1}else n=re(r[t])+_e-e.col_bounds.min[t]
if(n&&(s?n>e.pos[t]:n<e.pos[t]))return n
else return e.pos[t]}var ye=.0125*a
var Te=2*ge
function checkUnblockPush(e,t,r,a){for(var i=0;i<2;++i)if(a[i]){k(r,r,e.vel)
var o=se(M(r))
if(a[0]&&a[1])o*=.5
var n=ae(o,Te*t)
if(a[i]>0){if(e.vel[i]<ye)e.vel[i]=ie(ye,e.vel[i]+n)}else if(a[i]<0)if(e.vel[i]>-ye)e.vel[i]=ae(-ye,e.vel[i]-n)}}var Ie=U()
var Se=U()
var Ae=4
var we=-ne(Ae/2)
function cast4Up(){var e=2*Ae
if(Z.raycastLocal(Se,Ie,G,e,false))e=ie(Se[2]-Ie[2],e)
Ie[0]++
if(Z.raycastLocal(Se,Ie,G,e,false))e=ie(Se[2]-Ie[2],e)
Ie[1]++
if(Z.raycastLocal(Se,Ie,G,e,false))e=ie(Se[2]-Ie[2],e)
Ie[0]--
if(Z.raycastLocal(Se,Ie,G,e,false))e=ie(Se[2]-Ie[2],e)
Ie[1]--
return e}var Le=U()
var Re=U()
var xe=U(0,0,0)
function findEmptyPosNearEff(e,t,r){var a=te(r)
xe[2]=-t
x(Re,e,xe)
N(Re)
var i=Infinity
var o=0
for(var n=-Ae;n<=Ae;++n){var s=n>=0?n+1:-n
Ie[1]=Re[1]+n
for(var l=-Ae;l<=Ae;++l){var c=l>=0?l+1:-l
Ie[0]=Re[0]+l
for(var _=we;_<=Ae;++_){Ie[2]=Re[2]+_
var u=c+s+ee(_)
if(u>i)continue
if(cast4Up()>=a)if(u<i){i=u
o=1
b(Le,Ie)}else if(u===i){++o
if(oe()*o<1)b(Le,Ie)}}}}if(!isFinite(i))return null
Le[0]+=1
Le[1]+=1
Le[2]+=t
return Le}function handleFinalBlocked(e,t,r){if(v.DEBUG)h.print(null,400,400,1e3,"BLOCKED")
e.blocked_accum+=t
e.blocked_frames++
if(e.blocked_accum>250&&e.blocked_frames>4){if(null===e.blocked_target)e.blocked_target=findEmptyPosNearEff(r,e.eye_height,e.controller_height)||"none"
if("none"===e.blocked_target){if(Z.chunksGenedNear(e.pos)){var a=K()?V.STATUSMSG_STUCK_MENU_OR_LEAVE:V.STATUSMSG_STUCK_DIG_OR_WG
q.get("blocked").setMessage(a).fade()
e.blocked_target=null}}else{k(de,e.blocked_target,r)
C(de)
D(de,de,.01*t)
for(var i=0;i<3;++i)if(y(r[i]+de[i]-e.blocked_target[i])!==y(r[i]-e.blocked_target[i]))r[i]=e.blocked_target[i]
else r[i]+=de[i]}}}function updateBlockedAccum(e,t){if(e.blocked_target){e.blocked_accum=ie(e.blocked_accum-t,500)
if(e.blocked_accum<0){e.blocked_target=null
e.blocked_accum=0
e.blocked_frames=0}}else{e.blocked_target=null
e.blocked_accum=0
e.blocked_frames=0}}var Oe=[U(),U()]
var be=U()
function collisionPass(e,t,r,a,i){a=a||0
P(Oe[0],re(t[0]+e.min[0]),re(t[1]+e.min[1]),re(t[2]+e.min[2]))
P(Oe[1],re(t[0]+e.max[0]),re(t[1]+e.max[1]),re(t[2]+e.max[2]+(2!==r?a:0)))
b(be,F)
var o=false
var n=null
var s=null
be[2]=Oe[1][2]
e:for(var l=Oe[0][1];l<=Oe[1][1];++l){be[1]=l
for(var c=Oe[0][0];c<=Oe[1][0];++c){be[0]=c
var _=Oe[1][2]-Oe[0][2]+1
var u=i?{}:null
if(Z.raycastLocal(ue,be,ce,_,null,u))if(ue[2]>=Oe[0][2])if(2===r&&ue[2]===Oe[0][2]){o=true
if(c!==Oe[1][0])(n=n||[])[0]=true
if(c!==Oe[0][0])(n=n||[])[1]=true
if(l!==Oe[1][1])(s=s||[])[0]=true
if(l!==Oe[0][1])(s=s||[])[1]=true}else{o=true
break e}if(i)E(i,u)}}return{is_blocked:o,blocked_x:n,blocked_y:s}}var Ne={min:U(),max:U()}
function crouchCollisionPass(e,t,r,a,i){b(Ne.min,e.getCrouchColBounds().min)
b(Ne.max,e.getCrouchColBounds().max)
Ne.min[2]+=e.getCrouchEyeHeightOffset()
var o=collisionPass(Ne,t,r,a,i)
Ne.min[2]+=.5
Ne.max[2]+=.5
var n=collisionPass(Ne,t,r,a,i)
return!n.is_blocked?n:o}function crouchPos(e,t,r){b(e,t)
e[2]+=r.getCrouchEyeHeightOffset()}function uncrouchPos(e,t,r){b(e,t)
e[2]-=r.getCrouchEyeHeightOffset()}var Ce=U()
var Me=U()
function checkAxisCollision(e,t,r,a,i,o,n){var s=true
var l=false
var c=i[a]
for(var _=0;s&&_<2;++_){b(Ce,t)
Ce[a]=c
var u=z(e)&&e.getCrouched()?crouchCollisionPass(e,Ce,a,r,n):collisionPass(e.col_bounds,Ce,a,r,n),d=u.is_blocked,f=u.blocked_x,v=u.blocked_y
if(s=d){if(z(e)&&!e.getCrouched()&&e.getCanCrouch()&&e.on_ground){crouchPos(Me,Ce,e)
var h=crouchCollisionPass(e,Me,a,r,n)
if(!h.is_blocked){b(t,Me)
crouchPos(i,i,e)
s=h.is_blocked
f=h.blocked_x
v=h.blocked_y
e.crouch()
continue}}e.vel[a]=0
if(H(e)&&e.jump_time&&2===a)e.jump_time=0
if(0===_)c=tryToUnblock(e,a,Ce,o,f,v)
else l=true}else{if(z(e)&&e.getCrouched()){uncrouchPos(Me,Ce,e)
var p=collisionPass(e.getUncrouchColBounds(),Me,a,r,n)
if(!p.is_blocked){b(t,Me)
uncrouchPos(i,i,e)
s=p.is_blocked
f=p.blocked_x
v=p.blocked_y
e.uncrouch()
continue}}b(t,Ce)}}return l}var De=B()
function checkCollisions(e,t,r,a,i,o,n){R(De,0,0)
var s=false
var l={}
for(var c=0;c<3;++c)if(checkAxisCollision(e,i,o,r[c],a,De,l))s=true
if(!j(e)||!e.isAerial())checkUnblockPush(e,t,n,De)
if(s)handleFinalBlocked(e,t,i)
else updateBlockedAccum(e,t)
for(var _ in l){var u=l[_]
var d=U()
u.getLocalPos(d)
if(d[2]>e.pos[2]+e.col_bounds.max[2]||e.pos[2]-e.eye_height>d[2]+u.size[2])delete l[_]}return l}var Pe=50
function clampPhotoPosition(e,t){var r=Y()
for(var a=0;a<3;++a)if(J())if(Q())e[a]=m(e[a],r[a][0],r[a][1])
else e[a]=m(e[a],ae(r[a][0],t[a]-Pe),ie(r[a][1],t[a]+Pe))
else e[a]=t[a]}var ke=2.001
var Be=U()
var Ue=new Float32Array(5)
var Ge=new Float32Array(4)
var Fe=new Float32Array(9)
var We=[-1,0,1,-1,0,1,-1,0,1]
var je=[-1,-1,-1,0,0,0,1,1,1]
var He=B()
var ze=U()
var Ve=U()
function getCorners(e,t){var r=t[2]-e.eye_height
var a=r+e.getClearanceHeight()
var i=re(r-1)
A(Be,t)
Be[2]=re(a)
R(He,t[0]-Be[0],t[1]-Be[1])
for(var o=0;o<9;++o){P(ze,Be[0]+We[o],Be[1]+je[o],Be[2])
if(Z.raycastLocal(Ve,ze,ce,2*e.getClearanceHeight()))Fe[o]=ae(Ve[2]+1,i)
else Fe[o]=i}Ue[0]=ae(ae(Fe[0],Fe[1]),ae(Fe[3],Fe[4]))
Ue[1]=ae(ae(Fe[1],Fe[2]),ae(Fe[4],Fe[5]))
Ue[2]=ae(ae(Fe[3],Fe[4]),ae(Fe[6],Fe[7]))
Ue[3]=ae(ae(Fe[4],Fe[5]),ae(Fe[7],Fe[8]))
Ue[4]=ie(Ue[0],Ue[1],Ue[2],Ue[3])
if(He[0]<=.5)if(He[1]<=.5){Ge[0]=Ue[0]
Ge[1]=ie(Ue[0],Ue[1])
Ge[2]=ie(Ue[0],Ue[2])
Ge[3]=Ue[4]}else{Ge[0]=ie(Ue[0],Ue[2])
Ge[1]=Ue[4]
Ge[2]=Ue[2]
Ge[3]=ie(Ue[2],Ue[3])}else if(He[1]<=.5){Ge[0]=ie(Ue[0],Ue[1])
Ge[1]=Ue[1]
Ge[2]=Ue[4]
Ge[3]=ie(Ue[1],Ue[3])}else{Ge[0]=Ue[4]
Ge[1]=ie(Ue[1],Ue[3])
Ge[2]=ie(Ue[2],Ue[3])
Ge[3]=Ue[3]}for(var n=0;n<2;++n)if(He[n]<=.5)He[n]*=2
else He[n]=2*He[n]-1
return i}function getFloorPos(e,t){getCorners(e,t)
return g(He[1],g(He[0],Ge[0],Ge[1]),g(He[0],Ge[2],Ge[3]))}function getFloorInfo(e,t,r){var a=te(e.getClearanceHeight())
var i=getCorners(e,t)
var o
var n
if(0===r){o=Ge[1]-Ge[0]
n=Ge[3]-Ge[2]}else{o=Ge[2]-Ge[0]
n=Ge[3]-Ge[1]}var s=ie.apply(void 0,Ge)
var l=ae.apply(void 0,Ge)
var c=false
if(s-(i+1)>ke)c=true
else{P(ze,Be[0],Be[1],l)
if(Z.raycastLocal(Ve,ze,le,a+1))if(Ve[2]-l<a)c=true}return{blocked:c,slope1:o,slope2:n}}},{"../../common/globals.js":197,"../../glov/client/engine.js":250,"../../glov/client/settings.js":291,"../../glov/client/ui.js":306,"../../glov/common/util.js":330,"../../glov/common/vmath.js":332,"../base_controller.js":18,"../controller_components/auto_crouch_comp.js":41,"../localization/localization":108,"../photo_mode.js":128,"../status.js":156,"../user_data.js":170,"../voxel_data.js":175,"../world_metadata.js":186}],50:[function(e,t,r){"use strict"
r.PhotoMoveMode=void 0
function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype)
_setPrototypeOf(e.prototype.constructor=e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){e.__proto__=t
return e})(e,t)}var a=e("../../glov/common/vmath")
var n=a.v3addScale
var s=a.v3copy
var i=a.vec3
var o=e("../state_machine").State
var l=e("./mode_common")
var c=l.PHTMOVE_ID
var _=l.calculateMaxSpeed
var u=l.checkCollisions
var d=l.processVelocityFlying
var f=l.sortVelocityAxis
var v=i()
var h=i()
var p=i()
var m=function(i){_inheritsLoose(PhotoMoveMode,i)
function PhotoMoveMode(){var e
for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];(e=i.call.apply(i,[this].concat(r))||this).id=c
e.allowed_transitions={}
return e}var e=PhotoMoveMode.prototype
e.enter=function enter(){}
e.exit=function exit(){}
e.handle=function handle(){}
e.update=function update(e){var t=e.dt,r=e.impulse
var a=this.sm.getOwner()
a.makePositionSafe()
s(h,a.vel)
var i=_({sprinting:Boolean(r.sprinting),flying:true})
d(a,t,r,i)
n(v,a.pos,a.vel,t)
var o=f(a.vel)
s(p,a.pos)
u(a,t,o,v,p,0,h)
a.setPos(p)}
return PhotoMoveMode}(o)
r.PhotoMoveMode=m},{"../../glov/common/vmath":332,"../state_machine":155,"./mode_common":49}],51:[function(e,t,r){"use strict"
r.SittingMode=void 0
function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype)
_setPrototypeOf(e.prototype.constructor=e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){e.__proto__=t
return e})(e,t)}var a=e("../../glov/common/vmath.js")
var i=a.v3copy
var o=a.vec3
var n=a.zero_vec
var s=e("../animation_enum.js").AnimEnum
var l=e("../controller_common.js").DOWN
var c=e("../state_machine.js").State
var _=e("../voxel_data.js")
var u=e("./mode_common.js")
var d=u.FREECAM_ID
var f=u.SITTING_ID
var v=u.WALK_ID
var h=u.collisionPass
var p=u.uncrouchPos
var m=e("../../glov/client/settings.js")
var g=Math.ceil
var E=o()
var y=o()
var T=o()
var I=function(o){_inheritsLoose(SittingMode,o)
function SittingMode(){var e
var t
for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];(t=o.call.apply(o,[this].concat(a))||this).id=f
t.allowed_transitions=((e={})[d]=true,e[v]=true,e)
return t}var e=SittingMode.prototype
e.enter=function enter(){var e=this.sm.getOwner()
if(!e.getCrouched())e.crouch()
e.anim_secondary=s.SIT
e.anim=s.SIT
e.anim_in_grace_time=true
e.animation_grace_time=0}
e.exit=function exit(){var e=this.sm.getOwner()
p(E,e.pos,e)
if(!h(e.getUncrouchColBounds(),E).is_blocked)e.uncrouch()
if(e.fpv_when_done){m.camera_view=false
e.fpv_when_done=false}if(e.anim===s.SIT)e.anim_in_grace_time=false}
e.handle=function handle(e){var t=e.impulse
var r=this.sm.getOwner()
i(T,r.pos);--T[2]
if(t[0]||t[1]||t[2])r.csm.transit(e,v)
else if(!_.raycastLocal(y,T,l,4,false))r.csm.transit(e,v)
else if(T[2]-y[2]<g(r.controller_height)-1)r.csm.transit(e,v)
else if(T[2]-y[2]>=4)r.csm.transit(e,v)}
e.update=function update(){var e=this.sm.getOwner()
i(e.vel,n)
e.setPos(e.pos)}
return SittingMode}(c)
r.SittingMode=I},{"../../glov/client/settings.js":291,"../../glov/common/vmath.js":332,"../animation_enum.js":8,"../controller_common.js":40,"../state_machine.js":155,"../voxel_data.js":175,"./mode_common.js":49}],52:[function(e,t,r){"use strict"
r.SwimmingMode=void 0
function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype)
_setPrototypeOf(e.prototype.constructor=e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){e.__proto__=t
return e})(e,t)}var a=e("../../glov/common/vmath")
var l=a.v3copy
var i=a.vec3
var o=e("../animation_enum").AnimEnum
var n=e("../state_machine").State
var c=e("../user_data").userStaminaCur
var s=e("./char_mode_common")
var _=s.calculateFrameTimes
var u=s.calculateNewWalkTypePos
var d=s.checkLadderTransit
var f=e("./mode_common")
var v=f.FLY_ID
var h=f.FREECAM_ID
var p=f.LADDERCLIMBING_ID
var m=f.SITTING_ID
var g=f.SWIMMING_ID
var E=f.WALK_ID
var y=f.calculateMaxSpeed
var T=f.calculateVelocityFlyingDesired
var I=f.processVelocityFlying
var S=Math.abs
function chooseSwimmingAnimation(e,t){if(S(t[0])+S(t[1])+S(t[2])<.1||e.anim_in_grace_time)e.anim_secondary=o.SWIM_IDLE
else e.anim_secondary=o.SWIM
if(!e.anim_in_grace_time)e.anim=e.anim_secondary}var A=i()
var w=i()
var L=function(o){_inheritsLoose(SwimmingMode,o)
function SwimmingMode(){var e
var t
for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];(t=o.call.apply(o,[this].concat(a))||this).id=g
t.allowed_transitions=((e={})[v]=true,e[h]=true,e[p]=true,e[m]=true,e[E]=true,e)
return t}var e=SwimmingMode.prototype
e.enter=function enter(){}
e.exit=function exit(e,t){var r=e.impulse
var a=this.sm.getOwner()
if(t===E&&r[2]>0)a.jumping_off=true}
e.handle=function handle(e){var t=this.sm.getOwner()
if(!t.underwater.body)t.csm.transit(e,E)
var r=e.impulse
if(t.flying)t.csm.transit(e,v)
if(t.ladder_cooldown<=0){T(A,t,r,1)
d(t,A,e)}}
e.update=function update(e){var t=e.dt,r=e.impulse,a=e.do_stamina
var i=this.sm.getOwner()
i.makePositionSafe()
l(w,i.vel)
chooseSwimmingAnimation(i,r)
var o=y({sprinting:Boolean(r.sprinting),underwater:true,crouching:i.getCrouched(),exhausted:a&&!c()})
I(i,t,r,o)
var n=u(i,t,w)
var s=_(i,t,n,o,{sprinting:Boolean(r.sprinting),underwater:true})
i.setPos(n)
return s}
return SwimmingMode}(n)
r.SwimmingMode=L},{"../../glov/common/vmath":332,"../animation_enum":8,"../state_machine":155,"../user_data":170,"./char_mode_common":45,"./mode_common":49}],53:[function(e,t,r){"use strict"
r.WalkMode=void 0
function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype)
_setPrototypeOf(e.prototype.constructor=e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){e.__proto__=t
return e})(e,t)}var i=e("../../glov/client/input")
var a=e("../../glov/common/util").arrayToSet
var o=e("../../glov/common/vmath")
var n=o.v2addScale
var s=o.v2copy
var l=o.v2lengthSq
var c=o.v2sub
var _=o.v3copy
var u=o.vec3
var d=e("../../common/globals").VOXELS_PER_M
var f=e("../animation_enum").AnimEnum
var v=e("../state_machine").State
var h=e("../user_data").userStaminaCur
var p=e("./char_mode_common")
var m=p.calculateFrameTimes
var g=p.calculateNewWalkTypePos
var E=p.checkLadderTransit
var y=e("./mode_common")
var T=y.FLY_ID
var I=y.FREECAM_ID
var S=y.LADDERCLIMBING_ID
var A=y.SITTING_ID
var w=y.SWIMMING_ID
var L=y.WALK_ACCEL
var R=y.WALK_ID
var x=y.calculateMaxSpeed
var O=y.calculateVelocityHorizontalDesired
var b=e("../../glov/client/settings.js")
var N=Math.abs,C=Math.max,M=Math.sqrt
var D={regular:{idle:f.IDLE,walk:f.WALK,run:f.RUN},crouch:{idle:f.CROUCH_IDLE,walk:f.CROUCH_WALK,run:f.CROUCH_RUN}}
var P=a([f.IDLE,f.WALK,f.RUN,f.CROUCH_IDLE,f.CROUCH_WALK,f.CROUCH_RUN])
var k=600
function chooseWalkModeAnimation(e,t){var r=e.getCrouched()?D.crouch:D.regular
if(e.vel[2]>0)e.anim_secondary=f.JUMP
else if(e.vel[2]<0&&!P[e.anim_secondary])e.anim_secondary=f.FALL
else if(N(t[0])+N(t[1])>.1){e.anim_secondary=r.walk
if(t.sprinting)e.anim_secondary=r.run}else e.anim_secondary=r.idle
if(e.not_underwater_timer<k)if(e.anim_secondary===r.idle||e.anim_in_grace_time)e.anim_secondary=f.SWIM_IDLE
else e.anim_secondary=f.SWIM
if(!e.anim_in_grace_time)e.anim=e.anim_secondary}var B=u()
function calculateVelocityHorizontalToApply(e,t,r,a){c(B,a,t.vel)
var i=r*L
var o=l(B)
if(o<=i*i)s(e,a)
else n(e,t.vel,B,i/M(o))
return e}var U=.0025*d
var G=300
var F=-9.8*d/1e3/1e3
var W=-.025*d
function processJumpWalk(e,t,r){if(r){if(e.on_ground&&e.jump_ok||e.jumping_off){e.jump_time=G
e.jump_ok=false
e.jumping_off=false
e.just_jumped=true}}else{if(!(i.touch_mode?b.max_jump_tap_touch:b.max_jump_tap_kb))e.jump_time=0
e.jump_ok=true}var a=t
if(e.jump_time&&!e.getCrouched()){e.vel[2]=U
e.on_ground=false
a=0
if(t>e.jump_time){a=t-e.jump_time
e.jump_time=0}else e.jump_time-=t}e.vel[2]=C(W,e.vel[2]+a*F)}var j=u()
var H=u()
var z=u()
var V=function(o){_inheritsLoose(WalkMode,o)
function WalkMode(){var e
var t
for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];(t=o.call.apply(o,[this].concat(a))||this).id=R
t.allowed_transitions=((e={})[T]=true,e[I]=true,e[S]=true,e[A]=true,e[w]=true,e)
return t}var e=WalkMode.prototype
e.enter=function enter(){}
e.exit=function exit(){}
e.handle=function handle(e){var t=e.dt,r=e.impulse
var a=this.sm.getOwner()
if(a.underwater.body)a.csm.transit(e,w)
if(a.flying)a.csm.transit(e,T)
if(a.ladder_cooldown<=0){O(B,a,r,1)
calculateVelocityHorizontalToApply(j,a,t,B)
E(a,j,e)}}
e.update=function update(e){profilerStart("WalkMode:update")
var t=e.dt,r=e.impulse,a=e.do_stamina
var i=this.sm.getOwner()
i.makePositionSafe()
_(H,i.vel)
chooseWalkModeAnimation(i,r)
var o=x({sprinting:Boolean(r.sprinting),crouching:i.getCrouched(),exhausted:a&&!h()})
O(z,i,r,o)
calculateVelocityHorizontalToApply(i.vel,i,t,z)
processJumpWalk(i,t,r[2]>0)
var n=g(i,t,H)
var s=m(i,t,n,o,{sprinting:Boolean(r.sprinting)})
i.setPos(n)
profilerStop("WalkMode:update")
return s}
return WalkMode}(v)
r.WalkMode=V},{"../../common/globals":197,"../../glov/client/input":271,"../../glov/client/settings.js":291,"../../glov/common/util":330,"../../glov/common/vmath":332,"../animation_enum":8,"../state_machine":155,"../user_data":170,"./char_mode_common":45,"./mode_common":49}],54:[function(e,t,r){"use strict"
r.cosmeticGetImage=cosmeticGetImage
function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]
for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))e[a]=r[a]}return e}).apply(this,arguments)}var _=e("assert")
var u=e("../glov/client/engine")
var a=e("../glov/client/quat")
var i=a.qFromYPR
var o=a.quat
var d=e("../glov/client/snapshot").snapshot
var n=e("../glov/common/vmath")
var s=n.vec3
var f=n.zero_vec
var v=e("./animation_enum").AnimEnum
var l=e("./animation_player")
var h=l.animationDrawPlayer
var p=l.drawCostumePrep
var m=e("./client_entities").allocPerEntData
var c=e("./cosmetics")
var g=c.costume_dict
var E=c.isCostume
var y=c.isPart
var T=e("./items").snapshotOverLimit
var I=e("./mobs").EntDrawData
var S=e("./props")
var A=S.restoreGlobalState
var w=S.saveGlobalState
var L=e("./voxel_data")
var R=L.applyBevelParamCharacters
var x=L.applyBevelParamWorld
var O=L.applyBevelValue
var b=Math.PI
var N=128
var C=512
var M=null
var D=0
var P=null
var k=0
var B=i(o(),b,0,0)
var U=s(-.5,-.5,.4)
var G=s(-.5,-.5,0)
var F=s(1,1,3)
var W=s(1,1,1.5)
function costumeFromPart(e){var t={}
if(e.costumes)t=_extends({},g[e.costumes[0]].swaps)
var r=[{name:e.name,swaps:e.swaps}]
if(e.name.includes("arm_r")){var a=e.name.replace("arm_r","arm_l")
r.push({name:a,swaps:e.swaps})}else if(e.name.includes("leg_r")){var i=e.name.replace("leg_r","leg_l")
r.push({name:i,swaps:e.swaps})}return{name:"custom",swaps:t,parts:r}}var j="dynamic"
var H="static"
var z={}
function cosmeticGetImage(e,t){_(y(t)||E(t))
var r=e&&e.dynamic_snapshot?1:0
var a=r||e&&e.force_update
var i=r?j:H
var o=z[t.name]
if(!o)(o=z[t.name]={costume:y(t)?costumeFromPart(t):t,per_ent_data:m(),draw_data:new I}).draw_data.draw_opts={for_snapshot:true,torch_factor:0,sun_factor:1,scale_lights:true}
var n=o
n.per_ent_data.anim_state.anim=y(t)?v.PART_THUMBNAIL:v.IDLE
if(!n[i]||a)if(!p(n.draw_data,n.costume)&&!r);else if(!T(r)){var s=N
if(r){s=C
n[i]=M
if(P!==n||k+1!==u.frame_index){P=n
D=0}D+=.001*u.frame_dt
k=u.frame_index}var l
var c
if(!r)c=function on_unload(){if(n[i]===l)delete n[i]
l.texs[0].destroy()
l.texs[1].destroy()}
l=d({name:"cosmetic_snap_"+(r?"dyn_":"")+t.name,sprite:n[i],w:s,h:s,pos:y(t)?G:U,size:y(t)?W:F,pre:w,post:A,rot:r?D:0,on_unload:c,draw:function draw(){O(1)
R()
h(null==n?void 0:n.draw_data,n.per_ent_data,n.costume,f,B,B)
x()
O()}})
n[i]=l
if(r)M=l}if(n[i])e.img=n[i]}},{"../glov/client/engine":250,"../glov/client/quat":287,"../glov/client/snapshot":295,"../glov/common/vmath":332,"./animation_enum":8,"./animation_player":9,"./client_entities":35,"./cosmetics":55,"./items":98,"./mobs":120,"./props":141,"./voxel_data":175,assert:void 0}],55:[function(e,t,r){"use strict"
r.isCostume=isCostume
r.isPart=isPart
r.isSwap=isSwap
r.getRarityStyle=getRarityStyle
r.getRarityColors=getRarityColors
r.getRarityFromCostumes=getRarityFromCostumes
r.getSwapColors=getSwapColors
r.getCosmeticsOwnerships=getCosmeticsOwnerships
r.getCosmeticsAvailability=getCosmeticsAvailability
r.costumeDisplayName=costumeDisplayName
r.canInitGeomThisFrame=canInitGeomThisFrame
r.attachInit=attachInit
r.instantiateCostumeData=instantiateCostumeData
r.startup=startup
r.costume_dict=r.cosmetics_rarity_info=r.CosmeticRarities=r.CosmeticTypes=r.Parts=r.cosmetic_ownerships=r.bone_list=r.swaps_dict=r.parts_dict=r.DEFAULT_COSTUME=void 0
function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]
for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))e[a]=r[a]}return e}).apply(this,arguments)}var a="villager_1"
r.DEFAULT_COSTUME=a
var y={}
r.parts_dict=y
var T={}
r.swaps_dict=T
var I=[]
r.bone_list=I
var S=e("assert")
var i=e("../glov/client/engine")
var A=i.DEBUG
var n=i.getFrameIndex
var o=e("../glov/client/filewatch").filewatchOn
var s=e("../glov/client/webfs")
var w=s.webFSGetFile
var l=s.webFSGetFileNames
var c=e("../glov/common/enums")
var _=c.isValidNumberEnumKey
var u=c.isValidStringEnumKey
var d=e("../glov/common/util")
var L=d.clone
var f=d.cloneShallow
var R=d.deepEqual
var v=d.empty
var h=d.merge
var p=e("../glov/common/vmath")
var m=p.v3scale
var g=p.v4copy
var E=p.vec3
var x=p.vec4
var O=e("../common/entitlements").entitlements
var b=e("./costume_edit").incrementCurCostumeMod
var N=e("./localization/localization").L
var C=e("./palette")
var M=C.paletteRange
var D=C.paletteSwap
var P=e("./store")
var k=P.canPurchaseProduct
var B=P.canPurchaseProductId
var U=P.getAllProducts
var G=e("./styles")
var F=G.color_cosmetic_base_common
var W=G.color_cosmetic_base_epic
var j=G.color_cosmetic_base_legendary
var H=G.color_cosmetic_base_rare
var z=G.color_cosmetic_bright_common
var V=G.color_cosmetic_bright_epic
var Y=G.color_cosmetic_bright_legendary
var q=G.color_cosmetic_bright_rare
var K=G.customization_common
var Z=G.customization_epic
var X=G.customization_legendary
var Q=G.customization_rare
var J=e("./voxel_data_xraw").loadXRAW
var $=e("./world_comm").getPerm
var ee=0
var te={}
var re=0
var ae=x(1,1,1,1)
var ie={}
r.cosmetic_ownerships=ie
var oe;(function(e){e[e["HEAD"]=0]="HEAD"
e[e["TORSO"]=1]="TORSO"
e[e["ARM_R"]=2]="ARM_R"
e[e["ARM_L"]=3]="ARM_L"
e[e["LEG_R"]=4]="LEG_R"
e[e["LEG_L"]=5]="LEG_L"})((r.Parts=oe)||(r.Parts=oe={}))
var ne;(function(e){e[e["COSTUME"]=0]="COSTUME"
e[e["PART"]=1]="PART"
e[e["SWAP"]=2]="SWAP"})((r.CosmeticTypes=ne)||(r.CosmeticTypes=ne={}))
var se;(function(e){e["COSTUME"]="COSMETIC_TYPE_COSTUME"
e["HEAD"]="COSMETIC_TYPE_HEAD"
e["TORSO"]="COSMETIC_TYPE_TORSO"
e["ARMS"]="COSMETIC_TYPE_ARMS"
e["LEGS"]="COSMETIC_TYPE_LEGS"
e["SWAP_EYES"]="COSMETIC_TYPE_COLOR_EYES"
e["SWAP_HAIR"]="COSMETIC_TYPE_COLOR_HAIR"
e["SWAP_SKIN"]="COSMETIC_TYPE_COLOR_SKIN"})(se=se||{})
var le={head:se.HEAD,torso:se.TORSO,arm_r:se.ARMS,leg_r:se.LEGS}
function getTypeKeyFromBone(e){return le[e]}function getPartTypeFromBone(e){var t=e.toUpperCase()
return _(oe,t)?oe[t]:void 0}function getTypeKeyFromSwap(e){var t="SWAP_"+e.toUpperCase()
return u(se,t)?se[t]:void 0}var ce;(function(e){e[e["COMMON"]=0]="COMMON"
e[e["RARE"]=1]="RARE"
e[e["EPIC"]=2]="EPIC"
e[e["LEGENDARY"]=3]="LEGENDARY"})((r.CosmeticRarities=ce)||(r.CosmeticRarities=ce={}))
function getTransparentColor(e){var t=x()
g(t,e)
t[3]=0
return t}var _e={COMMON:{style:K,label:N.LBL_RARITY_COMMON,colors:{base_color:F,bright_color:z,bright_color_transparent:getTransparentColor(z)}},RARE:{style:Q,label:N.LBL_RARITY_RARE,colors:{base_color:H,bright_color:q,bright_color_transparent:getTransparentColor(q)}},EPIC:{style:Z,label:N.LBL_RARITY_EPIC,colors:{base_color:W,bright_color:V,bright_color_transparent:getTransparentColor(V)}},LEGENDARY:{style:X,label:N.LBL_RARITY_LEGENDARY,colors:{base_color:j,bright_color:Y,bright_color_transparent:getTransparentColor(Y)}}}
r.cosmetics_rarity_info=_e
var ue={preview:{name:"preview",attachments:[],parts:[],cosmetic_type:ne.COSTUME,type_key:se.COSTUME,owned:false}}
r.costume_dict=ue
function isCostume(e){if(e)return e.cosmetic_type===ne.COSTUME
return false}function isPart(e){if(e)return e.cosmetic_type===ne.PART
return false}function isSwap(e){if(e)return e.cosmetic_type===ne.SWAP
return false}function getRarityStyle(e){return _e[e].style}function getRarityColors(e){return _e[e].colors}function getRarityFromCostumes(e){var t=ce.LEGENDARY
for(var r=0;r<e.length;r++){var a=ue[e[r]]
var i=ce[a.rarity||"LEGENDARY"]
if(i<t)t=i}return ce[t]}function swapKey(e){var t=[]
for(var r in e)t.push(r+","+e[r])
t.sort()
return t.join(";")}function getSwapColors(){for(var e in T){var t=T[e]
var r=M(void 0,t.type+"_"+t.name,t.name)
if(r){var a=r[0][1]
t.color_vec=x(a[0],a[1],a[2],1)}}}function getCosmeticsOwnerships(){for(var e in ie)delete ie[e]
for(var t in $("owned")){var r=O[t]
if(r)for(var a=0;a<r.length;++a){var i=r[a]
if("costume"===i.type){var o=ue[i.name]
ie[i.name]=true
o.available=true
for(var n=0;n<o.attachments.length;n++){var s=o.attachments[n]
ie[s.name]=true
for(var l in s.swaps){var c=s.name
if(s.variant)c=s.name.slice(0,-3)
var _=c+";"+l+";"+s.swaps[l]
ie[_]=true}}if(o.swaps)for(var u in o.swaps){var d=u+";"+o.swaps[u]
ie[d]=true}}else if("swap"===i.type)for(var f=0;f<i.values.length;f++){var v=i.key+";"+i.values[f]
ie[v]=true}}}}function getCosmeticsAvailability(){for(var e in ue)ue[e].available=false
var t=U()
for(var r=0;r<t.length;r++){var a=t[r]
if(!k(a))continue
var i=a.items
for(var o=0;o<i.length;o++){var n=O[i[o].id]
if(!n)continue
for(var s=0;s<n.length;++s){var l=n[s]
if("costume"===l.type){var c=ue[l.name]
c.available=true
c.expire_date=a.available_until}}}}for(var _ in y){var u=y[_]
var d=u.costumes
u.available=false
u.available_costumes=[]
for(var f=0;f<d.length;f++){var v=d[f]
if(ue[v].available)u.available_costumes.push(v)}if(u.available_costumes.length)u.available=true}for(var h in T){var p=T[h]
var m=p.costumes
p.available=false
p.available_costumes=[]
for(var g=0;g<m.length;g++){var E=m[g]
if(ue[E].available)p.available_costumes.push(E)}if(p.available_costumes.length)p.available=true}}function costumeDisplayName(e){var t=ue[e]
var r
if(t)r=t.display_name_key?""+N.get(t.display_name_key):t.display_name
return r||""+N.COSTUME_UNKNOWN}function getAttachSwapData(e,t){var r={swap_key:e.swap_key,swaps:e.swaps}
if(t.swaps){r.swaps=_extends({},e.swaps,t.swaps)
var a=swapKey(r.swaps)
r.swap_key=a}return r}function canInitGeomThisFrame(){return ee!==n()}function attachInit(e,t){var r=getAttachSwapData(t,e)
var a=e.geom+":"+r.swap_key
if(te[a]){e.drawable=te[a]
return}ee=n()
var i="character"
if(r.swaps&&!v(r.swaps))i=D(i,r.swaps)
var o=J(e.geom,{origin_offset:m(E(),e.origin,1/7),palette:i,noscale:true})
te[a]=e.drawable=o
if(++re%100===0)console.warn("Cached "+re+" character geometries")}function instantiateCostumeData(e,t){var r=f(e)
r.attachments=r.attachments.slice(0)
if(!v(r.swaps)){if(!v(t.swaps))r.swaps=h(f(r.swaps),t.swaps)}else if(!v(t.swaps))r.swaps=t.swaps
r.swap_key=swapKey(r.swaps)
if(t.parts)for(var a in t.parts){var i=t.parts[a].name
var o=y[i]
if(o){var n=t.parts[a].swaps
var s=a
for(var l=0;l<r.attachments.length;++l)if(s===r.attachments[l].bone){r.attachments[l]=L(o)
if(n)r.attachments[l].swaps=n
break}}}for(var c=0;c<r.attachments.length;++c){var _=f(r.attachments[c])
delete _.drawable
if(_.geom){var u=getAttachSwapData(r,_)
var d=_.geom+":"+u.swap_key
if(te[d])_.drawable=te[d]}r.attachments[c]=_}return r}function costumeLoad(e){var t=w(e,"jsobj")
var r=e.slice("cosmetics/costumes/".length)
if(A)S(t.display_name_key&&N.get(t.display_name_key)||t.display_name)
if(t.swaps)for(var a in t.swaps){var i=t.swaps[a]
var o=a+";"+i
var n=void 0
if(!T[o])n={swap_key:o,type:a,name:i,display_name_key:"COSMETIC_COLOR_"+i.toUpperCase(),available:false,is_default:false,costumes:[],cosmetic_type:ne.SWAP,type_key:getTypeKeyFromSwap(a),color_submenu:-1,color_vec:ae}
else n=T[o]
if(t.display_name_key){var s=n.costumes
if(!s.includes(r))s.push(r)}T[o]=n}if(t.parts){var l=[]
for(var c=0;c<t.parts.length;c++){if("string"===typeof t.parts[c])t.parts[c]={name:t.parts[c]}
var _=t.parts[c].name
if(!_)S(false,'Costume "'+e+'" has parts['+c+"] with no name")
var u=void 0
var d=false
if(!y[_]){(u=w("cosmetics/parts/"+_,"jsobj")).name=_
u.cosmetic_type=ne.PART
u.type_key=getTypeKeyFromBone(u.bone)
u.part_type=getPartTypeFromBone(u.bone)
u.geom+=".vm"
if(!I.includes(u.bone))I.push(u.bone)}else u=y[_]
if(t.parts[c].swaps)if(u.available_swaps){var f=-1
for(var v=0;v<u.available_swaps.length;v++)if(R(u.available_swaps[v],t.parts[c].swaps)){f=v
break}if(f>0){var h=u.name+"_V"+(f+1)
u=y[h]
_=h
t.parts[c].name=h}else if(-1===f){u.available_swaps.push(t.parts[c].swaps)
d=true}}else{u.available_swaps=[t.parts[c].swaps]
u.swaps=t.parts[c].swaps}if(d){var p=L(u)
p.costumes=[r]
p.variant=u.available_swaps.length
p.name=u.name+"_V"+p.variant
p.swaps=L(t.parts[c].swaps)
y[p.name]=p
var m=L(p)
l.push(m)
t.parts[c].name=p.name}else{var g=u.costumes=u.costumes||[]
if(!g.includes(r))g.push(r)
y[_]=u
var E=L(u)
l.push(E)}}t.name=r
t.attachments=l}t.cosmetic_type=ne.COSTUME
t.type_key=se.COSTUME
ue[r]=t}function swapsLoad(){for(var e in O){if("dev"===e)continue
var t=O[e]
if(t){var r=void 0
for(var a=0;a<t.length;++a){var i=t[a]
if("costume"===i.type&&"def"!==e)r=i.name
if("swap"===i.type)for(var o=0;o<i.values.length;o++){var n=i.key+";"+i.values[o]
if(!T[n])T[n]={swap_key:n,type:i.key,name:i.values[o],display_name_key:"COSMETIC_COLOR_"+i.values[o].toUpperCase(),costumes:r?[r]:[],is_default:"def"===e,available:"def"===e||B(e),cosmetic_type:ne.SWAP,type_key:getTypeKeyFromSwap(i.key),color_vec:ae,color_submenu:-1}
else{var s=T[n]
if(!s.is_default)s.is_default="def"===e
if(!s.available)s.available="def"===e||B(e)
if(r)if(!s.costumes.includes(r))s.costumes.push(r)}}}}}}function cosmeticsLoad(){var e=l("cosmetics/costumes/")
for(var t in e)costumeLoad(e[t])}function refreshCurrentCostume(){b()}function costumeReload(e){costumeLoad(e)
refreshCurrentCostume()}function partsReload(e){var t=e.slice("cosmetics/costumes/".length)
var r=w(e,"jsobj")
r.name=t
r.geom+=".vm"
y[t]=r
for(var a in ue){var i=ue[a]
for(var o=0;o<i.parts.length;o++)if(i.parts[o].name===t){costumeLoad("cosmetics/costumes/"+a)
break}}refreshCurrentCostume()}function startup(){cosmeticsLoad()
swapsLoad()
o(/^cosmetics\/costumes\//,costumeReload)
o(/^cosmetics\/parts\//,partsReload)}},{"../common/entitlements":194,"../glov/client/engine":250,"../glov/client/filewatch":259,"../glov/client/webfs":309,"../glov/common/enums":321,"../glov/common/util":330,"../glov/common/vmath":332,"./costume_edit":56,"./localization/localization":108,"./palette":123,"./store":158,"./styles":160,"./voxel_data_xraw":176,"./world_comm":182,assert:void 0}],56:[function(e,t,r){"use strict"
r.incrementCurCostumeMod=incrementCurCostumeMod
r.costumeSet=costumeSet
r.costumePreviewActive=costumePreviewActive
r.costumeCurrent=costumeCurrent
r.costumeCurrentMod=costumeCurrentMod
r.costumeOwned=costumeOwned
r.getCostumeOptions=getCostumeOptions
r.costumeEditStartup=costumeEditStartup
function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]
for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))e[a]=r[a]}return e}).apply(this,arguments)}var a=e("../glov/client/cmds").cmd_parse
var i=e("../glov/client/engine")
var _=e("../glov/client/net").netSubs
var u=e("../glov/client/walltime")
var o=e("../glov/common/util")
var c=o.clone
var d=o.deepEqual
var n=o.empty
var f=e("../common/entitlements").entitlements
var v=e("./client_cmds").isElevated
var h=e("./cosmetics")
var p=h.DEFAULT_COSTUME,s=h.costumeDisplayName
var l=e("./store")
var m=l.canPurchaseProduct
var g=l.getAllProducts
var E=e("./world_comm")
var y=E.getPerm
var T=E.transDelay
var I=-1
var S=null
var A=0
function incrementCurCostumeMod(){++A}function costumeSet(e,t){var r=S;++A
T(function(){_().getMyUserChannel().send("costume_set",e,function(e){if(r===S)S=null
t(e)})})}function costumePreviewActive(){if(i.frame_index>I+1){S=null;++A}I=i.frame_index}function costumePreviewIsActive(){return I===i.frame_index}var w
function costumeCurrent(e){if(S&&costumePreviewIsActive()&&!e)return S
var t=_().getMyUserChannel()
if(!t)return w||{name:p}
var r=t.getChannelData("public.costume")
if(!r||!r.name)r={name:p}
if("custom"===r.name){if(!r.attachments){h.costume_dict.custom=r
var a=h.costume_dict.custom
a.attachments=[]
a.display_name_key="COSMETIC_COSTUME_CUSTOM"
for(var i=0;i<a.parts.length;i++){var o=a.parts[i].name||a.parts[i]
var n=h.parts_dict[o]
if(!n){o=h.costume_dict[p].parts[i].name
n=h.parts_dict[o]
a.parts[i].name=n.name
a.parts[i].swaps=n.swaps}if(a.parts[i].swaps&&n.available_swaps&&n.available_swaps.length>1){var s=0
for(var l=0;l<n.available_swaps.length;l++)if(d(n.available_swaps[l],a.parts[i].swaps)){s=l
break}if(s>0)o+="_V"+(s+1)
a.attachments.push(h.parts_dict[o])}else a.attachments.push(n)}}}else if(!h.costume_dict[r.name])r={name:p}
return w=r}function costumeCurrentMod(){return A}function costumeOwned(e){for(var t in y("owned")){var r=f[t]
if(r)for(var a=0;a<r.length;++a){var i=r[a]
if("costume"===i.type&&(e===i.name||"custom"===e))return true}}return false}function cmpCostumeID(e,t){return s(e)<s(t)?-1:1}var L
var R
function getCostumeOptions(){var e=_().getMyUserChannel()
if(!e)return[]
var t=e.channel_id+"_"+e.channel_data_ver
if(t===R)return L
var i=[]
var o={}
function addEntitlement(e){var t=f[e]
if(t)for(var r=0;r<t.length;++r){var a=t[r]
if("costume"===a.type){if(a.available_until)if(u()>a.available_until)continue
if(!o[a.name]){i.push(a.name)
o[a.name]=true}}}}for(var r in y("owned"))addEntitlement(r)
if(!i.length)return[]
if(costumePreviewIsActive()){var a=g()
for(var n=0;n<a.length;++n){var s=a[n]
if(m(s)){var l=s.items
for(var c=0;c<l.length;++c)addEntitlement(l[c].id)}}}i.sort(cmpCostumeID)
R=t
return L=i}function onChannelData(e,t,r){if(!t||t.startsWith("public.costume"))++A}var x
function costumeOnLogout(){if(x){x.removeListener("channel_data",onChannelData)
x=null}}function costumeOnLogin(){costumeOnLogout();(x=_().getMyUserChannel()).on("channel_data",onChannelData)}function costumeEditStartup(){_().onLogin(costumeOnLogin)
_().on("logout",costumeOnLogout)}function changeCostumePart(e,t,r){var a=c(e)
var i=h.parts_dict[t].bone
if(a.parts)a.parts[i]={name:t}
else{a.parts={}
a.parts[i]={name:t}}if(v())a.override=true
costumeSet(a,r)}function changeCostumePartSwap(e,t,r,a,i){var o
var n=c(e)
if(!n.parts)n.parts={}
if(!n.parts[t]){var s=h.costume_dict[n.name]
for(var l=0;l<s.attachments.length;l++)if(s.attachments[l].bone===t){n.parts[t]={name:s.attachments[l].name,swaps:{}}
break}}n.parts[t].swaps=_extends({},n.parts[t].swaps,((o={})[r]=a,o))
if(v())n.override=true
costumeSet(n,i)}a.register({cmd:"costume",help:"(Hidden) Set costume by name",access_show:["sysadmin"],func:function func(e,t){if(!e)t(null,_().getMyUserChannel().getChannelData("public.costume"))
else{var r={name:e}
if(v())r.override=true
costumeSet(r,t)}}})
a.register({cmd:"costume_set_part",help:"(Hidden) Set  or clear a costume part",usage:"$HELP\n  Usage: /costume_set_part [PartName || PartBone]\nexample: /costume_set_part armor_captain_arm_r\nexample: /costume_set_part arm_r",access_show:["sysadmin"],func:function func(e,t){var r=e.split(" ")
if(1===!r.length)return void t("Invalid number of arguments")
var a=r[0]
if(h.bone_list.includes(a)){var i=costumeCurrent()
if(!i.parts)return void t("Costume not currently using custom parts")
else if(i.parts&&!i.parts[a])return void t('Costume not currently using a custom part for bone "'+a+'"')
else{delete i.parts[a]
costumeSet(i,t)}}else{if(!h.parts_dict[a])return void t("Part does not exist")
changeCostumePart(costumeCurrent(),a,t)}}})
a.register({cmd:"costume_set_part_swap",help:"(Hidden) Set  or clear costume part swaps",usage:"$HELP\n  Usage: /costume_set_part PartBone [SwapName SwapValue]\nexample: /costume_set_part_swap arm_r arms_primary pale_green\nexample: /costume_set_part_swap arm_r",access_show:["sysadmin"],func:function func(e,t){var r=e.split(" ")
if(1!==r.length&&3!==r.length)return void t("Invalid number of arguments")
var a=r[0]
if(!h.bone_list.includes(a))return void t("Invalid bone type")
if(1===r.length){var i=c(costumeCurrent())
if(!i.parts)return void t("No parts to clear")
else if(!i.parts[a]||i.parts[a]&&!i.parts[a].swaps)return void t("No part swaps to clear")
else delete i.parts[a].swaps
if(v())i.override=true
costumeSet(i,t)}else if(3===r.length)changeCostumePartSwap(costumeCurrent(),a,r[1],r[2],t)}})
a.register({cmd:"costume_swap",help:"(Hidden) Set or clear a palette swap on your current costume",usage:"$HELP\n  Usage: /costume_swap key [value]\n  Example: /costume_swap hair brown",access_show:["sysadmin"],func:function func(e,t){var r=e.split(" ")
if(1!==r.length&&2!==r.length)return void t("Usage: /costume_swap key [value]")
var a=c(_().getMyUserChannel().getChannelData("public.costume"))
a.swaps=a.swaps||{}
var i=r[0],o=r[1]
if(!o){if(!a.swaps[i])return void t('Costume does not currently swap "'+i+'"')
delete a.swaps[i]
if(n(a.swaps))delete a.swaps}else a.swaps[i]=o
if(v())a.override=true
costumeSet(a,t)}})},{"../common/entitlements":194,"../glov/client/cmds":244,"../glov/client/engine":250,"../glov/client/net":279,"../glov/client/walltime":308,"../glov/common/util":330,"./client_cmds":34,"./cosmetics":55,"./store":158,"./world_comm":182}],57:[function(e,t,r){"use strict"
r.craftClassMatches=craftClassMatches
r.sourceMatches=sourceMatches
r.canCraft=canCraft
var a=e("../common/ids")
var l=a.TYPE_CRAFT_CLASS
var c=a.TYPE_ITEM
var _=e("../common/materials_common").Mat
var i=e("./inventory")
var s=i.INV_PLAYER
var u=i.inventoryGet
var d=i.inventoryGetSize
function craftClassMatches(e,t){return t.craft_classes&&t.craft_classes[e]}function sourceMatches(e,t,r){if(t>=e.inputs.length)return false
if(!r)return false
var a=e.inputs[t]
var i=a.source
var o=i[1]
var n=i[2]
var s=i[3]||0
if(o===l){if(!craftClassMatches(n,r))return false}else{if(r.type!==o||r.id!==n)return false
if(o===c)if(s!==_.ANY&&(r.attr1||0)!==s)return false}if(a.source_check_cb&&!a.source_check_cb(r))return false
return true}function canCraft(e){var t=[]
for(var r=d(s)-1;r>=0;--r){var a=u(r)
if(a)t.push(a)}for(var i=0;i<e.inputs.length;++i){var o=false
for(var n=0;n<t.length;++n)if(sourceMatches(e,i,t[n])){o=true
break}if(!o)return false}return true}},{"../common/ids":198,"../common/materials_common":201,"./inventory":94}],58:[function(e,t,r){"use strict"
r.RARITY_LABEL=r.CMOD_FORMAT=r.CMOD_NAME=r.CMOD_TABLE=r.CMODS=void 0
var a=e("./localization/localization")
var n=a.DURATION_ONLY_MINUTES
var s=a.DURATION_ONLY_SECONDS
var l=a.L
var i=e("./ui_util.js").STAMINA_SYMBOL
var o=e("assert")
var c=e("../glov/client/engine.js")
var _=Math.round
var u={DURABILITY:"dur",DIG_RATE:"dig",STAMINA_RATE:"stamrate",RARITY:"rar",SPRINTING_STAMINA:"sprint",O2_CAPACITY:"o2cap",STAMINA_CAPACITY:"stamcap",PREVIEW_MOD_COUNT_MIN:"PREVIEW_MOD_COUNT_MIN",PREVIEW_MOD_COUNT_MAX:"PREVIEW_MOD_COUNT_MAX",STAMINA:"stam",STAMINA_DRAIN:"stam_drain",RANGE:"rng",TIMED:"t_",TIMED_STAMINA_SMALL:"t_stam_s",TIMED_STAMINA_MED:"t_stam_m",TIMED_STAMINA_LARGE:"t_stam_l",TIMED_DIG_RATE_SMALL:"t_dig_s",TIMED_DIG_RATE_MED:"t_dig_m",TIMED_DIG_RATE_LARGE:"t_dig_l",TIMED_SPRINTING_STAMINA_LARGE:"t_sprint_l",TIMED_O2_CAPACITY_LARGE:"t_o2cap_l",TIMED_STAM_CAPACITY_WGSICK:"t_stamcap_sick",TIMED_STAM_CAPACITY_WELL1:"t_stamcap_w1",TIMED_STAM_CAPACITY_WELL2:"t_stamcap_w2"}
r.CMODS=u
if(c.DEBUG&&"function"===typeof Proxy)r.CMODS=u=new Proxy(u,{get:function get(e,t){var r=e[t]
o(r)
return r}})
var d=[1,1.05,1.1,1.25,1.5]
var f=[0,400,600,800,1200,1600,2800,4e3,4800]
var v=[0,-800]
var h={};(r.CMOD_TABLE=h)[u.DIG_RATE]=d
h[u.STAMINA_RATE]=d
h[u.DURABILITY]=d
h[u.RANGE]=d
h[u.STAMINA]=f
h[u.STAMINA_DRAIN]=v
h[u.TIMED_STAMINA_SMALL]=10
h[u.TIMED_STAMINA_MED]=50
h[u.TIMED_STAMINA_LARGE]=100
h[u.TIMED_DIG_RATE_SMALL]=d[1]
h[u.TIMED_DIG_RATE_MED]=d[2]
h[u.TIMED_DIG_RATE_LARGE]=d[3]
h[u.TIMED_SPRINTING_STAMINA_LARGE]=2
h[u.TIMED_O2_CAPACITY_LARGE]=2
h[u.TIMED_STAM_CAPACITY_WGSICK]=.5
h[u.TIMED_STAM_CAPACITY_WELL1]=1.25
h[u.TIMED_STAM_CAPACITY_WELL2]=1.5
var p={};(r.CMOD_NAME=p)[u.DIG_RATE]=l.CMODS_DIG_RATE
p[u.STAMINA_RATE]=l.$(l.CMODS_STAMINA_RATE,i)
p[u.DURABILITY]=l.CMODS_DIG_DURABILITY
p[u.RANGE]=l.CMODS_STAMINA_RANGE
p[u.STAMINA]=i
p[u.STAMINA_DRAIN]=l.$(l.CMODS_STAMINA_DRAIN,i)
p[u.TIMED_STAMINA_SMALL]=p[u.TIMED_STAMINA_MED]=p[u.TIMED_STAMINA_LARGE]=l.$(l.CMODS_TIMED_STAMINA,i)
p[u.TIMED_DIG_RATE_SMALL]=p[u.TIMED_DIG_RATE_MED]=p[u.TIMED_DIG_RATE_LARGE]=l.CMODS_TIMED_DIG_RATE
p[u.TIMED_SPRINTING_STAMINA_LARGE]=l.$(l.CMODS_TIMED_SPRINTING_STAMINA,i)
p[u.TIMED_O2_CAPACITY_LARGE]=l.CMODS_O2_CAPACITY
p[u.TIMED_STAM_CAPACITY_WGSICK]=l.$(l.CMODS_TIMED_STAMINA_CAPACITY_WGSICK,i)
p[u.TIMED_STAM_CAPACITY_WELL1]=p[u.TIMED_STAM_CAPACITY_WELL2]=l.$(l.CMODS_STAMINA_CAPACITY,i)
function percent(e){return l.addPercentage(_(100*e))}function plusPercent(e,t){return"+"+percent(h[t][e[t]]-1)+" "+p[t]}function plusValue(e,t){return"+"+h[t][e[t]]+" "+p[t]}function minusValue(e,t){return l.CMODS_NOT_GOOD}function previewModCount(e,t){var r=e[u.PREVIEW_MOD_COUNT_MIN]||0
var a=e[u.PREVIEW_MOD_COUNT_MAX]
return l.$(l.CMODS_RANDOM_BONUSES,r,a)}function timed(e,t,r){var a=t[r]
var i=_(a/60)
var o=i>=8?l.duration(60*i,n):l.duration(a,s)
return l.$(l.CMODS_TIMED,e,p[r],o)}function timedRegen(e,t){return timed("+"+h[t],e,t)}function timedPercent(e,t){var r=h[t]-1
return timed((r<0?"":"+")+percent(r),e,t)}var m={};(r.CMOD_FORMAT=m)[u.DIG_RATE]=plusPercent
m[u.STAMINA_RATE]=plusPercent
m[u.DURABILITY]=plusPercent
m[u.RANGE]=plusPercent
m[u.PREVIEW_MOD_COUNT_MAX]=previewModCount
m[u.STAMINA]=plusValue
m[u.STAMINA_DRAIN]=minusValue
m[u.TIMED_STAMINA_SMALL]=timedRegen
m[u.TIMED_STAMINA_MED]=timedRegen
m[u.TIMED_STAMINA_LARGE]=timedRegen
m[u.TIMED_DIG_RATE_SMALL]=timedPercent
m[u.TIMED_DIG_RATE_MED]=timedPercent
m[u.TIMED_DIG_RATE_LARGE]=timedPercent
m[u.TIMED_SPRINTING_STAMINA_LARGE]=timedPercent
m[u.TIMED_O2_CAPACITY_LARGE]=timedPercent
m[u.TIMED_STAM_CAPACITY_WGSICK]=timedPercent
m[u.TIMED_STAM_CAPACITY_WELL1]=timedPercent
m[u.TIMED_STAM_CAPACITY_WELL2]=timedPercent
var g=[null,l.LBL_RARITY_COMMON,l.LBL_RARITY_UNCOMMON,l.LBL_RARITY_RARE]
r.RARITY_LABEL=g},{"../glov/client/engine.js":250,"./localization/localization":108,"./ui_util.js":168,assert:void 0}],59:[function(e,t,r){"use strict"
r.getCraftCost=getCraftCost
r.getRecipesForFactory=getRecipesForFactory
r.getItemExamples=getItemExamples
r.craftingRecipes=craftingRecipes
r.craftingRecipesLocalizationStartup=craftingRecipesLocalizationStartup
r.craftingRecipesStartup=craftingRecipesStartup
r.recipes=void 0
var a
var R=e("assert")
var x=e("../glov/client/engine")
var O=e("../glov/client/error_report.js").errorReportSetDetails
var i=e("../glov/common/util").defaults
var o=e("../glov/common/vmath").vec3
var n=e("../common/ids")
var s=n.ITEM_ANVIL
var l=n.ITEM_BERRY
var c=n.ITEM_BONFIRE
var _=n.ITEM_BONFIRE_METAL
var u=n.ITEM_BOTTLE
var d=n.ITEM_BREAD
var f=n.ITEM_BUCKET
var v=n.ITEM_CAMPFIRE
var h=n.ITEM_CARROT
var p=n.ITEM_COAL
var m=n.ITEM_CORD
var g=n.ITEM_CORN
var E=n.ITEM_CROISSANT
var y=n.ITEM_DOWSER_ADVANCED
var T=n.ITEM_DOWSER_SIMPLE
var I=n.ITEM_FACTORY_DEBUG
var S=n.ITEM_FIBER
var A=n.ITEM_FLOUR
var w=n.ITEM_FURNACE_GLASS
var L=n.ITEM_FURNACE_ORE
var b=n.ITEM_HATCHET
var N=n.ITEM_HOE
var C=n.ITEM_INGOT
var M=n.ITEM_JUICE
var D=n.ITEM_JUICER
var P=n.ITEM_KILN
var k=n.ITEM_LEFTOVERS
var B=n.ITEM_MILL
var U=n.ITEM_MUSHROOM
var G=n.ITEM_ORE
var F=n.ITEM_OVEN
var W=n.ITEM_PAINT
var j=n.ITEM_PAINT_MIXER
var H=n.ITEM_PICKAX
var z=n.ITEM_PIE
var V=n.ITEM_PUMPKIN
var Y=n.ITEM_ROAST_VEGETABLES
var q=n.ITEM_ROD
var K=n.ITEM_SANDWICH
var Z=n.ITEM_SAWMILL
var X=n.ITEM_SHOVEL
var Q=n.ITEM_SPICE
var J=n.ITEM_STONECUTTER_SIMPLE
var $=n.ITEM_SUGAR
var ee=n.ITEM_SUGAR_CANE
var te=n.ITEM_TOMATO
var re=n.ITEM_TOOL_HEAD
var ae=n.ITEM_TOOL_HEAD_CAST
var ie=n.ITEM_VEINIUM_GRINDER
var oe=n.ITEM_WHEAT
var ne=n.ITEM_WORKBENCH
var se=n.TYPE_BLOCK
var le=n.TYPE_CRAFT_CLASS
var ce=n.TYPE_ITEM
var _e=n.TYPE_RECIPE
var ue=e("../common/materials_common")
var de=ue.CraftClass
var fe=ue.Mat
var ve=e("../common/world_constants").ATTRIB_FIXED_MAX
var he=e("./crafting_mods").CMODS
var pe=e("./items.js")
var me=pe.ITEM_ID_NAME
var ge=pe.TOOL_BASE_HP
var Ee=pe.addItemAdjectives
var ye=pe.craftClassAndMatToItem
var Te=pe.createItem
var Ie=pe.getItemsForCraftClass
var Se=pe.getItemsForMatAny
var Ae=pe.isItem
var we=pe.sameItem
var Le=pe.satisfiesCost
var Re=e("./localization/localization").L
var xe=e("./materials")
var Oe=xe.ALLOYS
var be=xe.CRAFT_CLASS_NAME
var Ne=xe.CRAFT_CLASS_TO_MATERIAL_CLASS
var Ce=xe.MATERIAL_DURABILITY_FACTOR
var Me=xe.MATERIAL_TIER
var De=xe.MaterialClass
var Pe=e("./proc_gen").deepestOreFromWorldPos
var ke=e("./stone_tiers")
var Be=ke.ORE_DISTRO
var Ue=ke.ORE_DROPRATE
var Ge=e("./tiles")
var Fe=e("./tiles")
var We=Fe.TILE_EMPTY
var je=Fe.TILE_WATER
var He=Fe.tile_map_default
var ze=e("./voxel_data").getWorldPosFromChunkID
var Ve=Math.floor,Ye=Math.max,qe=Math.min,Ke=Math.random,Ze=Math.round
var Xe=fe.IRON
var Qe=3/128
var Je=.21875
var $e=[Re.LBL_RECIPE_TAG_CONSUMABLE,Re.LBL_RECIPE_TAG_CRAFTING_MAT,Re.LBL_RECIPE_TAG_FUEL,Re.LBL_RECIPE_TAG_INGREDIENT,Re.LBL_RECIPE_TAG_PLACEABLE]
var et=0
var tt=1
var rt=2
var at=3
var it=4
function outputInput0IgnoreQuality(e){return Te({type:ce,id:this.item_id,attr1:e[0].getMaterial(),attr2:this.material2,attr3:0})}function outputSimple(e){return Te({type:ce,id:this.item_id,attr1:0,attr2:0,attr3:0})}function juiceOutput(e){return Te({type:ce,id:this.item_id,attr1:e[0].attr1,attr2:0,attr3:0})}function outputSpicedFood(e){return Te({type:ce,id:this.item_id,attr1:e[0].attr1,attr2:0,attr3:e[1].attr3})}function outputFromOutputList(e){var t=this.output_list
for(var r=0;r<t.length;++r){var a=t[r]
for(var i=1;i<a.length;i++){var o=a[i]
var n=e[i-1]
if(Le(o,n)){if(i===a.length-1)return Te(a[0])}else break}}return null}var ot=[[z,Q,{id:z,spiced:1,mat:0}],[Y,d,{id:K,mat:0}],[K,Q,{id:K,spiced:1,mat:0}],[Y,Q,{id:Y,spiced:1,mat:0}],[A,l,{id:z,mat:1}],[A,U,{id:z,mat:1}],[E,Q,{id:E,spiced:1}]]
var nt=[[{type:ce,id:d},{type:ce,id:A},{type:ce,id:g}],[{type:ce,id:z,attr1:fe.TOMATO},{type:ce,id:A},{type:ce,id:te}],[{type:ce,id:z,attr1:fe.PUMPKIN},{type:ce,id:A},{type:ce,id:V}],[{type:ce,id:z,attr1:fe.CARROT},{type:ce,id:A},{type:ce,id:h}],[{type:ce,id:E},{type:ce,id:A},{type:ce,id:$}]]
var st=function(){var e={}
for(var t=0;t<ot.length;++t)e[ot[t][2].id]=true
return e}()
function ovenReverse(e){var t=fe.ANY
if(e.id===z&&(e.attr1||t)===t&&!e.attr3)return[Te({type:ce,id:A}),Te({type:le,id:de.PIE_FILLING})]
for(var r=0;r<ot.length;++r){var a=ot[r]
var i=a[2]
if(i.id!==e.id)continue
var o=void 0!==i.spiced
if(Boolean(e.attr3)!==o)continue
var n=[]
var s=[]
var l=[]
if(void 0!==i.mat)n[i.mat]=e.attr1||t
if(o)s[i.spiced]=e.attr3
for(var c=0;c<2;++c)l.push(Te({type:ce,id:a[c],attr1:n[c],attr3:s[c]}))
return l}return null}var lt=o()
function veiniumGrinderOutput(e,t,r){var a=0
if(!t){ze(lt,r.chunk_id,r.pos)
var i=Pe(lt)
var o=0
for(var n=Ye(0,i-4);n<=i;++n)o+=Ue[n]
a=Ve(Ke()*o)
o=0
for(var s=Ye(1,i-4);s<=i;++s)if((o+=Ue[s])>a){a=s
break}}return Te({type:ce,id:this.item_id,attr1:Be[a],attr2:0,attr3:0})}function ovenOutput(e){var t=outputFromOutputList.call(this,e)
if(t)return t
var r=[]
r[0]=e[0]
r[1]=e[1]
for(var a=0;a<ot.length;++a){var i=ot[a]
if(r[0].id===i[0]&&r[1].id===i[1]||r[1].id===i[0]&&r[0].id===i[1]){var o
r[0]=r[0].id===i[0]?e[0]:e[1]
r[1]=r[1].id===i[0]?e[0]:e[1]
var n=i[2]
var s=void 0
if(void 0!==n.spiced)s=r[n.spiced].attr3
var l={type:ce,id:i[2].id,count:1,attr1:(null==(o=r[n.mat])?void 0:o.attr1)||0,attr3:s||0}
return Te(l)}}return Te({type:ce,id:k,count:1})}function timeConstant(t){return function(e){return t}}var ct=10
var _t={at_factory:[ne],inputs:[{name:Re.LBL_RECIPE_INPUT_HEAD,source:[1,ce,re,fe.ANY]},{name:Re.LBL_RECIPE_INPUT_HAFT,source:[1,ce,q,fe.ANY]},{name:Re.LBL_RECIPE_INPUT_BINDING,source:[2,ce,m]}],available_mods:[he.DURABILITY,he.STAMINA_RATE,he.DIG_RATE],output:function output(e,t){var r={hp:ve}
if(t){r[he.PREVIEW_MOD_COUNT_MIN]=1
r[he.PREVIEW_MOD_COUNT_MAX]=4}else{var a=Ke()
var i=1
if(a<Qe){r[he.RARITY]=3
i=4}else if(a<Je)i=r[he.RARITY]=2
else r[he.RARITY]=1
var o=this.available_mods
for(var n=0;n<i;++n){a=Ke()
var s=o[Ve(a*o.length)]
r[s]=(r[s]||0)+1}}return Te({type:ce,id:this.item_id,attr1:e[0].getMaterial(),attr2:e[1].getMaterial(),attr3:0,attribs:r})},time:timeConstant(ct),needs_finish:true}
function outputDowser(e,t){var r={}
if(t)r[he.PREVIEW_MOD_COUNT_MAX]=2
else{var a=Ke()
var i=0
if(a<Qe){r[he.RARITY]=3
i=2}else if(a<Je){r[he.RARITY]=2
i=1}for(var o=0;o<i;++o){var n=he.RANGE
r[n]=(r[n]||0)+1}}return Te({type:ce,id:this.item_id,attr1:e[0].getMaterial(),attr2:e[1].getMaterial(),attr3:0,attribs:r})}function isAlloySource(e){var t=e.getMaterial()
if(Oe[t])return true
for(var r in Oe){var a=Oe[r]
for(var i in a)if(a[i]===t)return false}return true}function getAlloysOutputList(){var e=[]
for(var t in Oe){t=Number(t)
var r=Object.keys(Oe[t])
R.equal(r.length,1)
var a=Number(r[0])
var i=Oe[t][a]
R(i)
e.push([{type:ce,id:C,attr1:i,count:1},{type:ce,id:C,attr1:t,count:1},{type:ce,id:C,attr1:a,count:1},{type:le,id:de.FUEL,count:2}])}e.push([{type:ce,id:C,attr1:fe.MUTTAL,count:1},{type:ce,id:C,attr1:fe.ANY,count:1},{type:ce,id:C,attr1:fe.ANY,count:1},{type:le,id:de.FUEL,count:2}])
return e}function orderInvariant(e){var t=[]
for(var r=0;r<e.length;++r){var a=e[r]
R(a.length>=3)
t.push(a)
var i=(a=a.slice(0))[1]
a[1]=a[2]
a[2]=i
t.push(a)}return t}var ut={cord:{icon:{type:ce,id:m},at_factory:[ne],tags:[tt],inputs:[{source:[2,ce,S]},{name:Re.LBL_RECIPE_INPUT_CATALYST,source:[1,le,de.STONE_RAW]}],output:outputFromOutputList,output_list:[[{type:ce,id:m,count:1},{type:ce,id:S,count:2},{type:le,id:de.STONE_RAW,count:1}]],time:timeConstant(3)},wood_rod:{icon:{type:ce,id:q,attr1:fe.WOOD},at_factory:[Z],tags:[it,tt],inputs:[{name:Re.LBL_RECIPE_INPUT_MATERIAL,source:[3,le,de.WOOD_RAW]}],item_id:q,output:outputInput0IgnoreQuality,time:timeConstant(25)},oven:{icon:{type:ce,id:d},at_factory:[F],tags:[et],inputs:[{name:Re.LBL_RECIPE_INPUT_INGREDIENT,source:[1,le,de.INGREDIENT]},{name:Re.LBL_RECIPE_INPUT_INGREDIENT,source:[1,le,de.INGREDIENT]}],item_ids:st,reverse:ovenReverse,output:ovenOutput,output_list:orderInvariant(nt),time:timeConstant(5)},mill:{icon:{type:ce,id:A},at_factory:[B],tags:[at],inputs:[{name:Re.LBL_RECIPE_INPUT_GRINDABLE,source:[3,le,de.GRINDABLE]}],output:outputFromOutputList,output_list:[[{type:ce,id:A},{type:ce,id:g}],[{type:ce,id:A},{type:ce,id:oe}],[{type:ce,id:$},{type:ce,id:ee}]],time:timeConstant(5)},campfire:{icon:{type:ce,id:Y,attr1:fe.CARROT},at_factory:[v],tags:[et],inputs:[{name:Re.LBL_RECIPE_INPUT_INGREDIENT,source:[1,le,de.INGREDIENT]}],output:outputFromOutputList,output_list:[[{type:ce,id:Y,attr1:fe.TOMATO},{type:ce,id:te}],[{type:ce,id:Y,attr1:fe.PUMPKIN},{type:ce,id:V}],[{type:ce,id:Y,attr1:fe.CARROT},{type:ce,id:h}],[{type:ce,id:Y,attr1:fe.BROWN_MUSHROOM},{type:ce,id:U,attr1:fe.BROWN_MUSHROOM}],[{type:ce,id:Y,attr1:fe.LUMINESCENT_MUSHROOM},{type:ce,id:U,attr1:fe.LUMINESCENT_MUSHROOM}],[{type:ce,id:Y,attr1:fe.RED_MUSHROOM},{type:ce,id:U,attr1:fe.RED_MUSHROOM}],[{type:ce,id:Y,attr1:fe.CORAL_MUSHROOM},{type:ce,id:U,attr1:fe.CORAL_MUSHROOM}],[{type:ce,id:Y,attr1:fe.CORN},{type:ce,id:g}],[{type:ce,id:k},{type:le,id:de.INGREDIENT}],[{type:ce,id:Y,attr1:fe.ANY},{type:le,id:de.VEGETABLE}]],time:timeConstant(5)},juice:{icon:{type:ce,id:M,attr1:fe.RED_BERRY},at_factory:[D],inputs:[{name:Re.LBL_RECIPE_INPUT_BERRY,source:[3,ce,l,fe.ANY]},{name:Re.LBL_RECIPE_INPUT_BOTTLE,source:[1,ce,u]}],item_id:M,output:juiceOutput,time:timeConstant(5)},spicy_juice:{icon:{type:ce,id:M,attr1:fe.RED_BERRY,attr3:fe.SAVORY},at_factory:[D],inputs:[{source:[1,ce,M,fe.ANY]},{source:[1,ce,Q,fe.ANY]}],item_id:M,output:outputSpicedFood,time:timeConstant(5)},metal_rod:{icon:{type:ce,id:q,attr1:Xe},at_factory:[s],tags:[it,tt],inputs:[{name:Re.LBL_RECIPE_INPUT_MATERIAL,source:[1,ce,C,fe.ANY]}],item_id:q,output:outputInput0IgnoreQuality,time:timeConstant(30)},stone_tool_head:{icon:{type:ce,id:re,attr1:fe.STONE},at_factory:[J],tags:[tt],inputs:[{name:Re.LBL_RECIPE_INPUT_HEAD,source:[3,le,de.STONE_RAW]}],output:outputFromOutputList,output_list:[[{type:ce,id:re,attr1:fe.STONE},{type:le,id:de.STONE_RAW,count:3}]],time:timeConstant(20)},metal_tool_head_cast:{icon:{type:ce,id:re,attr1:Xe},at_factory:[ae],tags:[tt],inputs:[{name:Re.LBL_RECIPE_INPUT_HEAD,source:[3,le,de.SCALED_INGOT]},{name:Re.LBL_RECIPE_INPUT_FUEL,source:[1,le,de.FUEL]}],item_id:re,output:outputInput0IgnoreQuality,time:timeConstant(30)},metal_tool_head:{icon:{type:ce,id:re,attr1:Xe},at_factory:[s],tags:[tt],inputs:[{name:Re.LBL_RECIPE_INPUT_HEAD,source:[3,le,de.SCALED_INGOT]}],item_id:re,output:outputInput0IgnoreQuality,time:timeConstant(20)},veinium_grind:{icon:{type:ce,id:G,attr1:Xe},at_factory:[ie],tags:[tt],inputs:[{name:Re.LBL_RECIPE_INPUT_PRIMARY,source:[10,se,Ge.VEINIUM]}],output:veiniumGrinderOutput,time:timeConstant(120),item_id:G},primary_color_paint:{icon:{type:ce,id:W,attr1:fe.RED},at_factory:[j],inputs:[{name:Re.LBL_RECIPE_INPUT_BERRY,source:[1,ce,l,fe.ANY]},{source:[1,ce,S]}],item_id:W,output:outputFromOutputList,output_list:[[{type:ce,id:W,attr1:fe.RED},{type:ce,id:l,attr1:fe.RED_BERRY},{type:ce,id:S}],[{type:ce,id:W,attr1:fe.YELLOW},{type:ce,id:l,attr1:fe.YELLOW_BERRY},{type:ce,id:S}],[{type:ce,id:W,attr1:fe.BLUE},{type:ce,id:l,attr1:fe.BLUE_BERRY},{type:ce,id:S}]],time:timeConstant(5)},mixed_paint:{icon:{type:ce,id:W,attr1:fe.ORANGE},at_factory:[j],inputs:[{source:[1,ce,W,fe.ANY]},{source:[1,ce,W,fe.ANY]}],item_id:W,output:outputFromOutputList,output_list:orderInvariant([[{type:ce,id:W,attr1:fe.PURPLE},{type:ce,id:W,attr1:fe.RED},{type:ce,id:W,attr1:fe.BLUE}],[{type:ce,id:W,attr1:fe.ORANGE},{type:ce,id:W,attr1:fe.RED},{type:ce,id:W,attr1:fe.YELLOW}],[{type:ce,id:W,attr1:fe.GREEN},{type:ce,id:W,attr1:fe.BLUE},{type:ce,id:W,attr1:fe.YELLOW}],[{type:ce,id:W,attr1:fe.RED},{type:ce,id:W,attr1:fe.RED},{type:ce,id:W,attr1:fe.RED}],[{type:ce,id:W,attr1:fe.YELLOW},{type:ce,id:W,attr1:fe.YELLOW},{type:ce,id:W,attr1:fe.YELLOW}],[{type:ce,id:W,attr1:fe.BLUE},{type:ce,id:W,attr1:fe.BLUE},{type:ce,id:W,attr1:fe.BLUE}],[{type:ce,id:W,attr1:fe.GREEN},{type:ce,id:W,attr1:fe.GREEN},{type:ce,id:W,attr1:fe.GREEN}],[{type:ce,id:W,attr1:fe.PURPLE},{type:ce,id:W,attr1:fe.PURPLE},{type:ce,id:W,attr1:fe.PURPLE}],[{type:ce,id:W,attr1:fe.ORANGE},{type:ce,id:W,attr1:fe.ORANGE},{type:ce,id:W,attr1:fe.ORANGE}]]),time:timeConstant(5)},painted_wood:{icon:{type:se,id:Ge.COLORED_HUE2,count:10},at_factory:[j],tags:[it],inputs:[{name:Re.LBL_RECIPE_INPUT_PRIMARY,source:[10,le,de.WOOD_PLANK]},{source:[1,ce,W,fe.ANY]}],output_list:[[{type:se,id:Ge.COLORED_HUE0,count:10},{type:le,id:de.WOOD_PLANK,count:10},{type:ce,id:W,attr1:fe.RED,count:1}],[{type:se,id:Ge.COLORED_HUE1,count:10},{type:le,id:de.WOOD_PLANK,count:10},{type:ce,id:W,attr1:fe.ORANGE,count:1}],[{type:se,id:Ge.COLORED_HUE2,count:10},{type:le,id:de.WOOD_PLANK,count:10},{type:ce,id:W,attr1:fe.YELLOW,count:1}],[{type:se,id:Ge.COLORED_HUE3,count:10},{type:le,id:de.WOOD_PLANK,count:10},{type:ce,id:W,attr1:fe.GREEN,count:1}],[{type:se,id:Ge.COLORED_HUE4,count:10},{type:le,id:de.WOOD_PLANK,count:10},{type:ce,id:W,attr1:fe.BLUE,count:1}],[{type:se,id:Ge.COLORED_HUE5,count:10},{type:le,id:de.WOOD_PLANK,count:10},{type:ce,id:W,attr1:fe.PURPLE,count:1}]],output:outputFromOutputList,time:timeConstant(15)},pickax:i({icon:{type:ce,id:H,attr1:Xe,attr2:fe.WOOD},item_id:H},_t),hatchet:i({icon:{type:ce,id:b,attr1:Xe,attr2:fe.WOOD},item_id:b},_t),shovel:i({icon:{type:ce,id:X,attr1:Xe,attr2:fe.WOOD},item_id:X},_t),hoe:i({icon:{type:ce,id:N,attr1:Xe,attr2:fe.WOOD},item_id:N,available_mods:[he.DURABILITY,he.STAMINA_RATE]},_t),dowser_simple:{icon:{type:ce,id:T,attr1:Xe,attr2:fe.WOOD},at_factory:[ne],inputs:[{name:Re.LBL_RECIPE_INPUT_FOCUS,source:[1,ce,G,fe.ANY]},{source:[2,ce,q,fe.ANY]},{name:Re.LBL_RECIPE_INPUT_BINDING,source:[2,ce,m]}],item_id:T,output:outputDowser,time:timeConstant(ct),needs_finish:true},dowser_advanced:{icon:{type:ce,id:y,attr1:fe.EMBERYLLIUM,attr2:fe.DARK_WOOD},at_factory:[ne],inputs:[{name:Re.LBL_RECIPE_INPUT_FOCUS,source:[1,ce,G,fe.ANY]},{source:[2,ce,q,fe.ANY]},{name:Re.LBL_RECIPE_INPUT_BINDING,source:[2,ce,m]}],item_id:y,output:outputDowser,time:timeConstant(ct),needs_finish:true},wood_bucket:{icon:{type:ce,id:f,attr1:fe.WOOD,attr2:je},at_factory:[ne],inputs:[{name:Re.LBL_RECIPE_INPUT_PRIMARY,source:[20,le,de.WOOD_PLANK]},{name:Re.LBL_RECIPE_INPUT_BINDING,source:[2,ce,m]}],item_id:f,material2:We,output:outputInput0IgnoreQuality,time:timeConstant(15)},metal_bucket:{icon:{type:ce,id:f,attr1:Xe,attr2:je},at_factory:[s],inputs:[{name:Re.LBL_RECIPE_INPUT_PRIMARY,source:[3,ce,C,fe.ANY]},{name:Re.LBL_RECIPE_INPUT_BINDING,source:[2,le,de.WOOD_RAW]}],item_id:f,material2:We,output:outputInput0IgnoreQuality,time:timeConstant(15),reverse:function reverse(e){if(e.getMaterialClass()===De.METAL){var t=this.inputs[0].source
var r=this.inputs[1].source
return[Te({type:t[1],id:t[2],count:t[0],attr1:e.getMaterial()}),Te({type:r[1],id:r[2],count:r[0],attr1:e.getMaterial()})]}return null}},glass:{icon:{type:se,id:Ge.GLASS,count:4},at_factory:[w],tags:[it,tt],inputs:[{name:Re.LBL_RECIPE_INPUT_PRIMARY,source:[3,se,Ge.SAND]},{name:Re.LBL_RECIPE_INPUT_FUEL,source:[1,le,de.FUEL]}],output_list:[[{type:se,id:Ge.GLASS,count:4},{type:se,id:Ge.SAND,count:3},{type:le,id:de.FUEL,count:1}]],output:outputFromOutputList,time:timeConstant(30)},glass_bottle:{icon:{type:ce,id:u},at_factory:[w],tags:[tt],inputs:[{source:[1,se,Ge.GLASS]},{name:Re.LBL_RECIPE_INPUT_FUEL,source:[1,le,de.FUEL]}],item_id:u,output:outputSimple,time:timeConstant(15)},planks:{icon:{type:se,id:Ge.PLANKS_WOOD,count:4},at_factory:[Z],tags:[it,tt],inputs:[{name:Re.LBL_RECIPE_INPUT_PRIMARY,source:[1,le,de.WOOD_RAW]}],output_list:[[{type:se,id:Ge.PLANKS_WOOD,count:4},{type:se,id:Ge.WOOD,count:1}],[{type:se,id:Ge.PLANKS_WOOD_LIGHT,count:4},{type:se,id:Ge.WOOD_LIGHT,count:1}],[{type:se,id:Ge.PLANKS_WOOD_DARK,count:4},{type:se,id:Ge.WOOD_DARK,count:1}],[{type:se,id:Ge.PLANKS_WOOD_RED,count:4},{type:se,id:Ge.WOOD_RED,count:1}]],output:outputFromOutputList,time:timeConstant(12)},stone_bricks:{icon:{type:se,id:Ge.BRICK_STONE},at_factory:[J],tags:[it,tt],inputs:[{name:Re.LBL_RECIPE_INPUT_PRIMARY,source:[4,le,de.STONE_RAW]}],output_list:[[{type:se,id:Ge.BRICK_STONE,count:1},{type:le,id:de.STONE_RAW,count:4}]],output:outputFromOutputList,time:timeConstant(12)},brick_clay:{icon:{type:se,id:Ge.BRICK_CLAY},at_factory:[P],tags:[it],inputs:[{name:Re.LBL_RECIPE_INPUT_PRIMARY,source:[6,se,Ge.DIRT]}],output_list:[[{type:se,id:Ge.BRICK_CLAY,count:1},{type:se,id:Ge.DIRT,count:6}]],output:outputFromOutputList,time:timeConstant(12)},charcoal:{icon:{type:ce,id:p},at_factory:[P],tags:[rt],inputs:[{name:Re.LBL_RECIPE_INPUT_MATERIAL,source:[3,le,de.WOOD_RAW]}],item_id:p,output:outputSimple,time:timeConstant(60)},charcoal_slow:{icon:{type:ce,id:p},at_factory:[c,_],tags:[rt],inputs:[{name:Re.LBL_RECIPE_INPUT_MATERIAL,source:[3,le,de.WOOD_RAW]}],item_id:p,output:outputSimple,time:timeConstant(2600)},ingot:{icon:{type:ce,id:C,attr1:fe.IRON},at_factory:[L],inputs:[{name:Re.LBL_RECIPE_INPUT_PRIMARY,source:[10,ce,G,fe.ANY]},{name:Re.LBL_RECIPE_INPUT_FUEL,source:[1,le,de.FUEL]}],item_id:C,output:outputInput0IgnoreQuality,time:timeConstant(35)},alloy:{icon:{type:ce,id:C,attr1:fe.BRONZE},at_factory:[L],inputs:[{name:Re.LBL_RECIPE_INPUT_METAL,source:[1,ce,C,fe.ANY],source_check_cb:isAlloySource},{name:Re.LBL_RECIPE_INPUT_METAL,source:[1,ce,C,fe.ANY],source_check_cb:isAlloySource},{name:Re.LBL_RECIPE_INPUT_FUEL,source:[2,le,de.FUEL]}],item_id:C,output_list:orderInvariant(getAlloysOutputList()),output:outputFromOutputList,time:timeConstant(45)},tool_repair:{icon:{type:ce,id:H,attr1:fe.MUTTAL,attr2:fe.DARK_WOOD},at_factory:[s],no_unknown_name:true,inputs:[{name:Re.LBL_RECIPE_INPUT_TOOL,source:[1,le,de.REPAIRABLE]},{name:Re.LBL_RECIPE_INPUT_METAL,source:[2,ce,C,fe.ANY]}],output:function output(e){var t=e[0]
if(t.hp_cur>=t.hp_max)return null
var r=1
var a
var i=Me[t.getMaterial()]
var o=e[1].getMaterial()
var n=Me[o]
if(t.getMaterialClass()!==e[1].getMaterialClass()){r=.25
a=Re.RECIPE_TOOL_REPAIR_WARNING_MISMATCH}else if(n<i){r=.5
a=Re.RECIPE_TOOL_REPAIR_WARNING_REDUCED}var s=.5
var l=Ze(Ce[o]*r*ge*s)
var c=Te(t)
var _=qe(c.hp_cur+l,c.hp_max)
if(_===c.hp_max)a=null
if(_-c.hp_cur<.5*l)a=Re.RECIPE_TOOL_REPAIR_WARNING_WASTEFUL
c.setHP(_)
if(a)c.craft_warning=a
return c},time:timeConstant(15)}}
r.recipes=ut
function getRecipeAsCraftCost(e){var t
var r=ut[e]
R(r)
var a=[]
var i=r.inputs
for(var o=0;o<i.length;++o){var n=i[o].source
var s=n[0]
var l=n[1]
var c=n[2]
var _=n[3]
a.push(Te({type:l,id:c,count:s,attr1:_}))}a.at_factory=r.at_factory
a.count=null==(t=r.icon)?void 0:t.count
return a}function getCraftCost(e){var t=He
if(e.type===_e)return getRecipeAsCraftCost(e.attr1)
for(var r in ut){var a=ut[r]
var i=a.output_list
if(i){var o=[]
for(var n=0;n<i.length;++n){var s=i[n]
if(we(e,s[0])){for(var l=1;l<s.length;l++){var c=s[l]
o.push(Te(c))}o.at_factory=a.at_factory
o.count=s[0].count
return o}}}}for(var _ in ut){var u=ut[_]
if(e.type===ce&&(u.item_id===e.id||u.item_ids&&u.item_ids[e.id])){var d=u.inputs,f=u.output
var v=[]
var h=true
if(u.reverse){if(!(v=u.reverse(e)))continue}else{var p=1
for(var m=0;m<d.length;++m){var g=d[m].source
switch(g[1]){case le:var E=g[2]
if(f===outputSimple||E===de.FUEL)v.push(Te({type:le,id:E,count:g[0]}))
else if(E===de.SCALED_INGOT&&e.getMaterialClass()===De.METAL){var y=e["attr"+p++]
v.push(Te({type:ce,id:C,count:g[0],attr1:y}))}else if(E===de.WOOD_PLANK&&e.getMaterialClass()===De.WOOD){var T=e.getMaterial(true)
var I=void 0
if(!T);else I=ye(de.WOOD_PLANK,T,1,true)
if(I)v.push(Te({type:se,id:I,count:g[0]}))
else v.push(Te({type:le,id:de.WOOD_PLANK,count:g[0]}))}else{var S=Ne[E]
if(e.attr1===fe.ANY)v.push(Te({type:le,id:E,count:g[0]}))
else if(S&&e.getMaterialClass()===S){var A=t.material_map[e.getMaterial()]
R(A)
v.push(Te({type:se,id:A,count:g[0]}))}else h=false}break
case se:v.push(Te({type:se,id:g[2],count:g[0]}))
break
case ce:var w=g[3]
if(w===fe.ANY)w=e["attr"+p++]
v.push(Te({type:ce,id:g[2],count:g[0],attr1:w}))
break
default:R(false)}}}if(h){var L
v.at_factory=u.at_factory
v.count=null==(L=u.icon)?void 0:L.count
return v}}}if(x.DEBUG){O("item",JSON.stringify(e))
R(false)}return[]}var dt={}
function getRecipesForFactory(e){if(dt[e])return dt[e]
var t={}
for(var r in ut){var a=ut[r]
if(-1!==a.at_factory.indexOf(e)||e===I){if(a.icon&&!Ae(a.icon))a.icon=Te(a.icon)
t[r]=a}}return dt[e]=t}var ft=((a={})[le]=[],a[ce]=[],a)
function getItemExamples(e,t){var r=ft[e]
if(!r)return[]
else if(r[t])return r[t]
var a=e===ce?Se(t):Ie(t)
return r[t]=a}function craftingRecipes(){return ut}function craftingRecipesLocalizationStartup(){for(var e in ut){var t=ut[e]
t.name=t.name||Re.get("RECIPE_"+e.toUpperCase()+"_NAME")
if(!t.name)if(t.output_list&&1===t.output_list.length){var r=t.output_list[0][0]
t.name=Te(r).getName()}else if(t.item_id)t.name=me[t.item_id]
R(t.name)
t.unknown_name=t.unknown_name||Re.get("RECIPE_"+e.toUpperCase()+"_UNKNOWN_NAME")
if(!t.no_unknown_name)if(!t.unknown_name)if(t.output_list&&1===t.output_list.length){var a=t.output_list[0][0]
t.unknown_name=Te(a).getName()}else if(t.item_id){t.unknown_name=me[t.item_id]
if(t.output!==outputSimple)t.unknown_name=Ee(t.unknown_name,Re.MAT_UNKNOWN)}else t.unknown_name=Ee(t.name,Re.MAT_UNKNOWN)
else t.unknown_name=Ee(t.unknown_name,Re.MAT_UNKNOWN)
t.desc=t.desc||Re.get("RECIPE_"+e.toUpperCase()+"_DESC")
R(t.desc)
if(t.tags&&t.tags.length>0){var i=Re.addParentheses(Re.separateComma(t.tags.map(function(e){return $e[e]})))
t.desc=Re.separateWords(i,t.desc)}for(var o=0;o<t.inputs.length;++o){var n=t.inputs[o]
if(!n.name)if(n.source[1]===le)n.name=be[n.source[2]]
else if(n.source[1]===ce)n.name=me[n.source[2]]
else if(n.source[1]===se)n.name=Ge.tile_name_block[n.source[2]]
else R(false)}}}function craftingRecipesStartup(){craftingRecipesLocalizationStartup()
for(var e in ut){var t=ut[e]
var r=Te(t.icon)
r.has_hp=false
r.name=t.name
r.is_recipe=true
r.recipe=e
r.recipe_item=Te({type:_e,id:-1,attr1:e})
t.icon=r}}},{"../common/ids":198,"../common/materials_common":201,"../common/world_constants":212,"../glov/client/engine":250,"../glov/client/error_report.js":255,"../glov/common/util":330,"../glov/common/vmath":332,"./crafting_mods":58,"./items.js":98,"./localization/localization":108,"./materials":114,"./proc_gen":132,"./stone_tiers":157,"./tiles":162,"./voxel_data":175,assert:void 0}],60:[function(e,t,r){"use strict"
r.createFirstWorld=createFirstWorld
r.createFirstWorldStartup=createFirstWorldStartup
r.createFirstWorldPrompt=createFirstWorldPrompt
var a=e("../glov/client/net.js").netSubs
var i=e("../glov/client/sprites.js").spriteCreate
var p=e("../glov/client/ui.js")
var m=e("../glov/client/ui.js").uiFontStyleModal
var g=e("./analytics.js").logEvent
var o=e("./analytics_ftue.js")
var E=o.FTUE
var y=o.logEventFTUE
var T=e("./localization/localization").L
var n=e("./main_menu")
var s=n.createWorld
var I=n.isDoingWorldOp
var l=e("./menu.js")
var c=e("./prompt.js").showPrompt
var _=e("./styles.js")
var u=_.color_photo_frame_shadow
var d=_.color_rollover_cover
var f=_.color_white
var S=_.menu_header_style
var A=e("./ui_util.js")
var v=Math.floor,h=Math.random
var w=1200/630
var L={unl_photo:"img/create_first_world/unlimited_banner.jpg",lf_photo:"img/create_first_world/lost_frontier_banner.jpg",header:"img/worlds_header_simple.png"}
var R={}
var x=false
function loadCreateFirstWorldImages(){for(var e in L)R[e]=i({url:L[e],wrap_s:gl.CLAMP_TO_EDGE,wrap_t:gl.CLAMP_TO_EDGE})
x=true}var O=980
var b=4
var N=12
var C=270
var M=180
var D=280
var P=D/2
var k=25
var B=40
var U=10
var G=8
var F=35
var W=F
var j=10
function createFirstLF(){var e={log_type:"adventure",name:"New World",reset:true,seed:v(1e4*h()),sized:void 0,unlimited:false,world_mode:"adventure",world_type:"v1"}
s(e,p.modalDialogClear)
g("create_first_world_lf",1,"button")
y(E.MAIN,2,"create_first_world",{world_type:"lf"})}function createFirstUnlimited(){var e={log_type:"generated_v1",name:"New World",reset:true,seed:v(1e4*h()),sized:void 0,unlimited:true,world_mode:"unlimited",world_type:"v1"}
s(e,p.modalDialogClear)
g("create_first_world_unlimited",1,"button")
y(E.MAIN,2,"create_first_world",{world_type:"un"})}function photoFrameButton(e,t,r,a,i,o,n,s){p.drawRect(e+G,t+G,e+G+r,t+G+a,i,u)
p.drawRect(e,t,e+r,t+a,i+.001,f)
var l=p.buttonShared({x:e,y:t,w:r,h:a,disabled:n})
if(l){if(l.ret)s()
if("rollover"===l.state||"disabled"===l.state)p.drawRect(e,t,e+r,t+a,o,d)}}function createFirstWorld(){var v=p.font
var h=Z.MODAL
var e={width:O,color:l.panel_color,y0:75,tick:function tick(e){var t=e.x0,r=e.x,a=e.y,i=e.avail_width,o=e.modal_width,n=e.font_height
if(!x)loadCreateFirstWorldImages()
var s=R
var l=v.getStringWidth(S,2.25*n,T.LBL_WELCOME_TITLE)
var c=r+i/2-(l+D+b+N)/2
s.header.draw({x:c+l+b+N,y:a-k,z:h,w:D,h:P})
v.drawSizedAligned(S,c+N,a+=20,h,2.25*n,v.ALIGN.HLEFT,0,0,T.LBL_WELCOME_TITLE)
a+=2*n
a+=65
a+=v.drawSizedAlignedWrapped(m(),r,a,h,0,n,v.ALIGN.HVCENTER,i,0,T.MSG_WHAT_KIND_OF_WORLD)
var _=(o-3*B)/2
var u=_-2*U
var d=u/w
var f=d+2*U
v.drawSizedAligned(S,t+B,a+=45,h,1.5*n,v.ALIGN.HVCENTER,_,0,T.LBL_LOST_FRONTIER)
v.drawSizedAligned(S,t+2*B+_,a,h,1.5*n,v.ALIGN.HVCENTER,_,0,T.LBL_UNLIMITED)
a+=1.5*n-12
v.drawSizedAlignedWrapped(m(),t+B,a,h,0,n,v.ALIGN.HCENTER,_,0,T.MSG_CREATE_LF_DESC)
a+=v.drawSizedAlignedWrapped(m(),t+2*B+_,a,h,0,n,v.ALIGN.HCENTER,_,0,T.MSG_CREATE_UNL_DESC)
photoFrameButton(t+B,a+=12,_,f,h+1,h+5,I(),createFirstLF)
photoFrameButton(t+B+_+B,a,_,f,h+1,h+5,I(),createFirstUnlimited)
s.lf_photo.draw({x:t+B+U,y:a+U,z:h+3,w:u,h:d})
s.unl_photo.draw({x:t+2*B+_+U,y:a+U,z:h+3,w:u,h:d})
A.sprite.draw({x:t+B+_-U-F-j,y:a+U+d-W-j,z:h+4,w:F,h:W,frame:A.ADVENTURE_MODE})
a+=f+G
if(p.buttonText({x:t+B+_/2-C/2,y:a+=16,z:h+1,h:.5*p.button_height,w:C,text:T.BTN_CREATE_LF,disabled:I()}))createFirstLF()
if(p.buttonText({x:t+2*B+_+_/2-C/2,y:a,z:h+1,h:.5*p.button_height,w:C,text:T.BTN_CREATE_UNL,disabled:I()}))createFirstUnlimited()
a+=.5*p.button_height
a+=65
a+=v.drawSizedAlignedWrapped(m(),r+.25*i,a,h,0,n,v.ALIGN.HVCENTER,.5*i,0,T.MSG_EXPLORE_OTHER_WORLDS_DESC)
if(p.buttonText({x:r+i/2-M/2,y:a+=10,z:h+1,h:.5*p.button_height,w:M,text:T.BTN_EXPLORE_OTHER_WORLDS,disabled:I()})){p.modalDialogClear()
g("create_first_world_skip",1,"button")
y(E.MAIN,2,"create_first_world",{skipped:true})}e.y=a+=20}}
p.modalDialog(e)}function createFirstWorldOnChannelData(e){if(e&&e.public&&!e.public.prompts_seen||!e.public.prompts_seen.create_first_world)loadCreateFirstWorldImages()}function createFirstWorldOnLogin(){a().getMyUserChannel().onceSubscribe(createFirstWorldOnChannelData)}function createFirstWorldStartup(){a().onLogin(createFirstWorldOnLogin)}function createFirstWorldPrompt(){var e=a().getMyUserChannel().getChannelData("public.worlds",{})
if(0===Object.keys(e).length)c("create_first_world",createFirstWorld)}},{"../glov/client/net.js":279,"../glov/client/sprites.js":302,"../glov/client/ui.js":306,"./analytics.js":5,"./analytics_ftue.js":6,"./localization/localization":108,"./main_menu":113,"./menu.js":117,"./prompt.js":139,"./styles.js":160,"./ui_util.js":168}],61:[function(e,t,r){"use strict"
r.doCreditsMenuWide=doCreditsMenuWide
r.doCreditsMenuTall=doCreditsMenuTall
r.doCreditsMenu=doCreditsMenu
var i=e("../glov/client/ui.js")
var a=e("./layout.js")
var o=a.TALL
var n=a.layoutCameraCurX1
var s=a.layoutCameraTallWideMode
var l=e("./styles.js")
var c=l.inventory_style
var _=l.menu_header_style
var u=32
var d=35
function drawRole(e,t,r,a){i.title_font.drawSizedAligned(_,e,t,Z.UI,u,i.font.ALIGN.HVCENTER,r,0,a)}function drawCrew(e,t,r,a){i.font.drawSizedAligned(c,e,t,Z.UI,u,i.font.ALIGN.HVCENTER,r,0,a)}function drawSectionColumn(e,t,r,a){drawRole(e,t,r,a[0])
for(var i=1;i<a.length;++i)drawCrew(e,t+=d,r,a[i])}var f={game_creator:["Game Creator / Lead Engineer","Jimb Esser"],founder:["FRVR Founder","Chris Benjaminsen"],executive_producer:["Head of Studio / Executive Producer","Yasin Jensen"],producer:["Producer","Jonas Aksel Billeskov"],community_manager:["Community Manager","MicChi"],engineering:["Engineering","Beh Yon Chau","Diogo Antunes","Francisco Teotónio","Glen Sargent","Hugo Ferreira","Jorge Galvão"],art:["Art","Cristiana Béjinha","Ricardo Catarino"],leadership:["FRVR Leadership","Brian Meidell","Joshua Chittick","Maiken Fogtmann","Michael Billing"],publishing_marketing:["Publishing / Marketing","Aga Monteiro","Anel Imanbay","Kester Bishop","Mafalda Campos","Mike Stone","Sam Turner"],additional_engineering:["Additional Engineering","Daniel Entrenas","Daniel Monteiro","Diogo Nunes","Dmitrijs Sergejevs"],additional_art:["Additional Art","Anders Bruhn Pedersen","Ellen Grape","Frederik Marius Reinicke Bager","Joachim Brüel Gerber","Niklas Mäckle","Yenz Minnaert"],quality_assurance:["Quality Assurance","Daniel Cutajar","Eduardo Jardim","Miguel Ribeiro"],audio:["Audio","Rasmus Hartvig"],business_intelligence:["Business Intelligence","Daniela Cunha","Hugo Bettencourt","João Monteiro"]}
function drawEngineeringWide(e,t,r){drawRole(e,t,r,f.engineering[0])
drawCrew(e+30,t+=d,r/=2,f.engineering[1])
drawCrew(e+r-30,t,r,f.engineering[2])
drawCrew(e+30,t+=d,r,f.engineering[3])
drawCrew(e+r-30,t,r,f.engineering[4])
drawCrew(e+30,t+=d,r,f.engineering[5])
drawCrew(e+r-30,t,r,f.engineering[6])}function doCreditsMenuWide(e){var t=n()
var r=t/3
drawSectionColumn(100,e+=1.5*d,r,f.game_creator)
drawSectionColumn(r,e,r,f.founder)
drawSectionColumn(2*r-70,e,r,f.executive_producer)
drawSectionColumn(0,e+=3.5*d,r=t/3,f.producer)
drawEngineeringWide(r,e+.5*d,r)
drawSectionColumn(2*r,e+d,r,f.art)
drawSectionColumn(0,e+=3*d,r,f.community_manager)
drawSectionColumn(0,e+=3.5*d,r=t/4,f.leadership)
drawSectionColumn(r,e,r,f.publishing_marketing)
drawSectionColumn(2*r,e,r,f.additional_engineering)
drawSectionColumn(3*r,e+=1.5*d,r,f.additional_art)
drawSectionColumn(0,e+=4.5*d,r=t/4,f.quality_assurance)
drawSectionColumn(2*r,e,r,f.business_intelligence)
drawSectionColumn(r,e+=2*d,r,f.audio)}function doCreditsMenuTall(e){var t=n()
var r=t
drawSectionColumn(0,e+=d,r,f.game_creator)
drawSectionColumn(0,e+=3*d,r,f.founder)
drawSectionColumn(0,e+=3*d,r,f.executive_producer)
drawSectionColumn(0,e+=3*d,r,f.producer)
drawSectionColumn(r=t/5,e+=3*d,r,f.engineering)
drawSectionColumn(3*r,e+.5*d,r,f.community_manager)
drawSectionColumn(3*r,(e+=3*d)+d-.5*d,r,f.art)
drawSectionColumn(r,e+=5*d,r,f.leadership)
drawSectionColumn(3*r,e,r,f.publishing_marketing)
drawSectionColumn(r,e+=6*d,r,f.additional_art)
drawSectionColumn(3*r,e+=2*d,r,f.additional_engineering)
drawSectionColumn(r=t/7,e+=6*d,r,f.quality_assurance)
drawSectionColumn(5*r,e,r,f.business_intelligence)
drawSectionColumn(3*r,e+=d,r,f.audio)}function doCreditsMenu(e){if(s()===o)doCreditsMenuTall(e)
else doCreditsMenuWide(e)}},{"../glov/client/ui.js":306,"./layout.js":99,"./styles.js":160}],62:[function(e,t,r){"use strict"
r.addText=addText
r.draw=draw
var i=e("../glov/client/engine.js")
var a=e("../glov/client/font.js")
var o=e("../glov/client/ui.js")
var n=e("../glov/common/vmath.js").vec4
var s=[]
function addText(e){s.push(e)}var l=18
var c=8
var _=a.style({color:4294967295,outline_width:2,outline_color:255})
var u=n(.1,.1,.1,.8)
function draw(e,t){if(s.length){var r=i.font.drawSizedWrapped(_,e+c,t+c,Z.UI+101,500,0,l,s.join("\n"))
var a=i.font.last_width
o.panel({x:e,y:t,w:a+2*c,h:r+2*c,z:Z.UI+100,color:u})
s.length=0}}},{"../glov/client/engine.js":250,"../glov/client/font.js":260,"../glov/client/ui.js":306,"../glov/common/vmath.js":332}],63:[function(e,t,r){"use strict"
r.blocksNever=blocksNever
r.blocksAlways=blocksAlways
r.surfaceCheckSetParams=surfaceCheckSetParams
r.maxSurfaceClear=maxSurfaceClear
r.tryDeleteProp=tryDeleteProp
r.tryPlaceProp=tryPlaceProp
r.DetailGenBase=DetailGenBase
r.DETAIL_Z0=r.DETAIL_ZOFFS=r.step_pos=r.bounds_z=void 0
var n=new Array(32)
r.bounds_z=n
var s=new Int32Array(3)
r.step_pos=s
var a=16
var i=-(r.DETAIL_ZOFFS=a)
r.DETAIL_Z0=i
var I=e("assert")
var o=e("../common/globals.js"),S=o.CHUNK_SIZE,c=o.CS2
var _=Math.abs,u=Math.ceil,l=Math.floor,A=Math.max,w=Math.min
var d=e("./proc_gen_details.js").i32Alloc
var f=e("./tiles.js"),L=f.TILE_PROP_BASE,v=f.TILE_PROP_MAX
function blocksNever(){return false}function blocksAlways(){return true}var h
var p
var m
function surfaceCheckSetParams(e,t,r){h=t
p=e
m=r}function maxSurfaceClear(e,t,r){var a=e[t]
var i=a.h
if(_(m-i)>3*S)return i
var o=1
if(a.hydro_pen>-4)o=-u(a.hydro_pen+5)
if(i<=h+10){var n=0
var s=e[t-1]
if(s)n=A(n,_(i-s.h))
if(s=e[t+1])n=A(n,_(i-s.h))
if(s=r>0&&p[r-1][t])n=A(n,_(i-s.h))
if(s=r<S-1&&p[r+1][t])n=A(n,_(i-s.h))
var l=A(n,1)+2
if(i<=h+l)o=w(o,-l)}return i+o}var g=new Int32Array(3)
var R
function findProp(e,t,r,a,i){I(t>=L)
if(t>v)return null
if(!e.props)return null
var o=t-L
for(var n=o;n>=0;--n){g[2]=i-n
if(g[2]<0)continue
for(var s=o-n;s>=0;--s){g[1]=a-s
if(g[1]<0)continue
var l=o-n-s
g[0]=r-l
if(g[0]<0)continue
R=(g[2]*S+g[1])*S+g[0]
var c=e.props[R]
if(c&&c.size[0]>l&&c.size[1]>s&&c.size[2]>n)return c}}return null}function findDeletableProp(e,t,r,a,i){var o=findProp(e,t,r,a,i)
if(!o)return null
if(g[0]+o.size[0]>S||g[1]+o.size[1]>S||g[2]+o.size[2]>S)return null
return o}function deleteProp(e,t,r){var a=r.size
delete e.props[t]
for(var i=0;i<a[2];++i)for(var o=0;o<a[1];++o){var n=t+i*c+o*S
for(var s=0;s<a[0];++s,++n){var l=e.data[n]
I.equal(l,L+s+o+i)
e.data[n]=0}}}function tryDeleteProp(e,t,r,a,i){var o=findDeletableProp(e,t,r,a,i)
if(!o)return false
deleteProp(e,R,o)
return true}function tryPlaceProp(e,t,r){if(t[0]<0||t[1]<0||t[0]+r.size[0]>S||t[1]+r.size[1]>S)I(false,"Prop must not cross XY chunk boundaries")
I(t[2]>=-S&&t[2]<S)
var a=e.data
I(a)
var i=A(0,t[2])
var o=w(S,t[2]+r.size[2])
var n=A(0,t[1])
var s=w(S,t[1]+r.size[1])
var l=A(0,t[0])
var c=w(S,t[0]+r.size[0])
var _=[]
for(var u=i;u<o;++u)for(var d=n;d<s;++d)for(var f=l;f<c;++f){var v=a[(u*S+d)*S+f]
if(v>=L){var h=findDeletableProp(e,v,f,d,u)
if(!h)return false
_.push([R,h])}}for(var p=0;p<_.length;++p){var m=_[p]
deleteProp(e,m[0],m[1])}if(t[2]>=0&&t[2]<S){if(!e.props)e.props={}
var g=(t[2]*S+t[1])*S+t[0]
e.props[g]=r}for(var E=i;E<o;++E)for(var y=n;y<s;++y)for(var T=l;T<c;++T)a[(E*S+y)*S+T]=L+(E-t[2])+(y-t[1])+(T-t[0])
return true}var E={bounds_buf:1,bounds_len:1,f32buf:1,bounds_idx:1,last_bits:1,last_use_time:1,cleanup:1,origin_idx:1}
function preserveArrays(e){if(!e||"string"===typeof e)return e
else if(e.length){var t=[]
for(var r=0;r<e.length;++r)t.push(preserveArrays(e[r]))
return t}else if("object"===typeof e){var a={}
for(var i in e)a[i]=preserveArrays(e[i])
return a}return e}function DetailGenBase(e,t,r){}DetailGenBase.prototype.type="DetailGenBase"
DetailGenBase.prototype.priority=100
DetailGenBase.prototype.toJSON=function(){var e={}
var t=this
for(var r in t){var a=t[r]
if(E[r]||"function"===typeof a);else if(a&&a.length>64)e[r]="(length="+a.length+")"
else e[r]=preserveArrays(a)}var i=this.bounds_idx,o=this.bounds_buf,n=this.bounds_len
if(n&&!e.bounds){var s=[]
for(var l=0;l<n;++l){var c=i+6*l
s.push("["+o[c]+","+o[c+2]+","+o[c+4]+"]-["+o[c+1]+","+o[c+3]+","+o[c+5]+"]")}e.bounds=s.join(", ")}if(this.getDebugLines)e.lines=this.getDebugLines()
return e}
DetailGenBase.prototype.cleanup=null
DetailGenBase.prototype.dispose=function(){}
DetailGenBase.prototype.blockable=false
DetailGenBase.prototype.blocked_check=false
DetailGenBase.prototype.blocked=false
DetailGenBase.prototype.blocksOther=blocksNever
DetailGenBase.prototype.boundsAlloc=function(e){var t=d(6*e),r=t[0],a=t[1]
this.bounds_buf=r
this.bounds_idx=a
this.bounds_len=e}
DetailGenBase.prototype.boundsPush=function(e,t,r,a,i,o,n){this.bounds_buf[e++]=l(t)
this.bounds_buf[e++]=l(i+1)
this.bounds_buf[e++]=l(r)
this.bounds_buf[e++]=l(o+1)
this.bounds_buf[e++]=l(a)
this.bounds_buf[e++]=l(n+1)
return e}
var y=new Array(32)
var T=new Array(32)
var x
var O
var b
var N
var C
DetailGenBase.prototype.stepInit=function(e){var t=this.last_bits
C=this.bounds_buf
N=this.bounds_idx
for(var r=O=0;r<this.bounds_len;++r)if(t&1<<r)y[O++]=r
x=e}
DetailGenBase.prototype.stepY=function(e){var t=x[1]+e
for(var r=b=0;r<O;++r){var a=y[r]
var i=N+6*a+2
if(t>=C[i++]&&t<C[i])T[b++]=a}if(!b)return false
s[1]=t
return true}
DetailGenBase.prototype.stepX=function(e){var t=x[0]+e
var r=0
for(var a=0;a<b;++a){var i=T[a]
var o=N+6*i
if(t>=C[o++]&&t<C[o])n[r++]=i}s[0]=t
return r}},{"../common/globals.js":197,"./proc_gen_details.js":136,"./tiles.js":162,assert:void 0}],64:[function(e,t,r){"use strict"
r.renderedDetailGen=renderedDetailGen
var x=e("assert")
var a=e("./detail_gen_base.js"),o=a.DetailGenBase,i=a.blocksNever,n=a.DETAIL_ZOFFS,O=a.tryDeleteProp
var s=e("../common/globals.js"),b=s.CHUNK_SIZE,N=s.CS2
var C=Math.max,M=Math.min
var D=e("./proc_gen.js").renderDetail
var l=e("./tiles.js"),P=l.TILE_AIR,k=l.TILE_PROP_BASE
var c=e("../glov/common/util.js").inherits
var _=e("../glov/common/vmath.js").vec3
function RenderedDetailGen(e){o.call(this)
for(var t in e)switch(t){case"priority":this.priority+=e.priority
break
default:x(!this[t])
this[t]=e[t]}this.rendered=false
this.vd=null
this.boundsAlloc(1)
var r=this.pos_world,a=this.size
this.boundsPush(this.bounds_idx,r[0],r[1],r[2],r[0]+a[0]-1,r[1]+a[1]-1,r[2]+a[2]-1)
if(this.detail_type.unblockable)this.blockable=false
else{this.blocked_origin=_(this.origin[0],this.origin[1],this.origin[2]-n)
var i=this.detail_type.exclusion_calced
if(!i){i=this.detail_type.exclusion
i=this.detail_type.exclusion_calced=_(i[0],i[1],i[2]+n)}this.blocked_size=i
this.blocked_r=-1}}c(RenderedDetailGen,o)
RenderedDetailGen.prototype.type="RenderedDetailGen"
RenderedDetailGen.prototype.priority=150
RenderedDetailGen.prototype.blockable=true
RenderedDetailGen.prototype.blocksOther=i
var u={rendered:1,origin:1,pos_world:1,size:1,detail_type:1,seed:1,hexome:1,owner_mcid:1,vd:1}
RenderedDetailGen.prototype.toJSON=function(){var e={}
for(var t in this)if(!u[t])e[t]=this[t]
e.seed=this.detail_type.name
if(this.vd)e.vd=this.vd.data.length+" bytes"
return o.prototype.toJSON.call(e)}
RenderedDetailGen.prototype.dispose=function(){if(this.rendered){this.vd=null
this.rendered=false}}
RenderedDetailGen.prototype.cleanup=function(){if(this.rendered){this.vd=null
this.rendered=false}}
RenderedDetailGen.prototype.genLocal=function(e){var t=e.vd
if(!this.rendered)D(this)
else x(this.vd)
var r=this.pos_world,a=this.size
var i=t.pos_world
var o=i[2]
var n=o+b
var s=C(o,r[2])
var l=M(n,r[2]+a[2])
if(s>=l)return
var c=C(i[0],r[0])
var _=M(i[0]+b,r[0]+a[0])
if(c>=_)return
var u=C(i[1],r[1])
var d=M(i[1]+b,r[1]+a[1])
if(u>=d)return
var f=this.vd.data
var v=t.data
var h=c-i[0]
for(var p=s;p<l;++p){var m=p-i[2]
var g=m*N
var E=(p-r[2])*this.vd.stride2
for(var y=u;y<d;++y){var T=y-i[1]
var I=g+T*b+h
var S=E+(y-r[1])*this.vd.stride1+c-r[0]
for(var A=c;A<_;++A){var w=f[S]
var L=false
if(w){if(w===P){w=0
t.full=false}if(!v){t.alloc(false)
v=t.data}var R=v[I]
if(R>=k)if(!O(t,R,A-i[0],T,m))L=true
if(!L){v[I]=w
if(t.liquid)t.liquid[I]=0}}if(this.vd.liquid&&!L)if(w=this.vd.liquid[S]){x(f[S])
if(w===P)w=0
if(!t.liquid)t.alloc(true)
t.liquid[I]=w}I++
S++}}}}
function renderedDetailGen(e){return new RenderedDetailGen(e)}},{"../common/globals.js":197,"../glov/common/util.js":330,"../glov/common/vmath.js":332,"./detail_gen_base.js":63,"./proc_gen.js":132,"./tiles.js":162,assert:void 0}],65:[function(e,t,r){"use strict"
r.providerForestedRuin=providerForestedRuin
r.RUIN_SIMPLE=void 0
var a=e("./detail_gen_base.js"),o=a.DetailGenBase,b=a.tryDeleteProp,i=a.DETAIL_Z0
var n=e("../common/globals.js"),N=n.CHUNK_SIZE,C=n.CS2,M=n.TILE_PROP_BASE
var D=Math.floor,P=Math.max,k=Math.min,s=Math.round
var l=e("../glov/client/rand_fast.js"),c=l.randFastCreate,B=l.randSimpleSpatial
var _=e("./tiles.js"),U=_.TILE_BRICK_STONE,G=_.TILE_STONE
var u=e("../glov/common/util.js").inherits
var d=e("../glov/common/vmath.js"),f=d.ivec3,v=d.vec3,F=d.v3sub
var h=c()
var p=30
var m=16
function DetailGenRuin(e,t,r){o.call(this)
h.reseed(e)
var a=this.size_x=8+h.range(p-8)
var i=this.size_y=8+h.range(p-8)
this.origin=t.slice(0)
this.boundsAlloc(1)
this.boundsPush(this.bounds_idx,this.origin[0],this.origin[1],this.origin[2],this.origin[0]+a-1,this.origin[1]+i-1,this.origin[2]+m-1)}u(DetailGenRuin,o)
DetailGenRuin.prototype.type="DetailGenRuin"
DetailGenRuin.prototype.priority=90
DetailGenRuin.prototype.blockable=false
var W=f()
DetailGenRuin.prototype.genLocal=function(e){var t=e.vd,r=e.vs
var a=t.data
var i=t.liquid
var o=this.size_x,n=this.size_y,s=this.origin,l=this.seed
var c=r.map
var _=t.pos_world
F(W,_,s)
var u=P(-W[0],0)
var d=k(o-W[0],N)
var f=P(-W[1],0)
var v=k(n-W[1],N)
for(var h=f;h<v;++h){var p=_[1]+h
var m=c[h]
var g=p===s[1]||p===s[1]+n-1
for(var E=u;E<d;++E){var y=_[0]+E
var T=m[E].h
if(!(g||y===s[0]||y===s[0]+o-1))continue
var I=D(3*B(l,y,p,0))
var S=P(T-_[2],0)
var A=k(T+I-_[2],N)
var w=h*N+E+S*C
if(A>S)if(!a){t.alloc()
a=t.data}for(var L=S;L<A;++L,w+=C){var R=_[2]+L-T
var x=a[w]
if(x>=M)if(!b(t,x,E,h,L))continue
var O=G
if(0===R)O=U
a[w]=O
if(i)i[w]=0}}}}
function detailGenRuin(e,t,r){return new DetailGenRuin(e,t,r)}var g={exclusion:null,bounds:[v(0,0,i),v(p,p,m)],factory:detailGenRuin}
r.RUIN_SIMPLE=g
function providerForestedRuin(e){var t=s(e.pos_world[0])
var r=s(e.pos_world[1])
return[{pos:v(t-p/2,r-p/2,0),type:g}]}},{"../common/globals.js":197,"../glov/client/rand_fast.js":288,"../glov/common/util.js":330,"../glov/common/vmath.js":332,"./detail_gen_base.js":63,"./tiles.js":162}],66:[function(e,t,r){"use strict"
r.advancedDowse=advancedDowse
r.DOWSER_ADVANCED_BASE_LEN=void 0
var E=40
r.DOWSER_ADVANCED_BASE_LEN=E
var y=e("../glov/client/engine.js")
var a=e("../glov/common/util.js").arrayToSet
var i=e("../glov/common/vmath.js")
var T=i.v3addScale
var I=i.v3copy
var S=i.v3iNormalize
var o=i.vec3
var n=e("../common/ids").ITEM_BAG
var A=e("./build_mode.js").oreFromLocalPos
var w=e("./debug.js")
var L=e("./main.js")
var R=e("./main.js").charControllerPos
var s=e("./tiles.js")
var l=s.TILE_COAL
var c=s.TILE_ORE_IN_STONE
var _=s.TILE_ORE_IN_STONE_DARK
var u=s.TILE_ORE_IN_STONE_LIGHT
var d=s.TILE_ORE_IN_STONE_RED
var f=s.TILE_ORE_IN_VEINIUM
var v=s.TILE_PROP_BASE
var h=s.TILE_STONE
var p=s.TILE_STONE_DARK
var m=s.TILE_STONE_LIGHT
var g=s.TILE_STONE_RED
var x=s.TILE_VEINIUM
var O=e("./voxel_data.js")
var b=Math.cos,N=Math.max,C=Math.random,M=Math.sin,D=Math.sqrt,P=Math.PI
var k
var B
var U
var G
var F
var W
var j=a([l,h,p,m,g,c,u,_,d,f,x])
function dowserVoxelCB(e,t){if(e<0)return
if(e===v){var r=O.andGetProp()
if(r&&r.item_id===n)e=0}if(!e){--W
if(!B&&W>=0)return}else B=true
if(e!==U)if(j[e]){++G
if(k[U=e])++F}k[e]=(k[e]||0)+1}var H=5*P/180
var z=o()
var V=o()
function advancedDowse(e){var t=R()
var r=L.char_controller,a=r.facing,i=r.char_up,o=r.char_right
if(1){var n=C()
var s=C()
var l=2*P*n
var c=b(H)
var _=c+(1-c)*s
var u=D(1-_*_)
var d=b(l)*u
var f=M(l)*u
z[0]=i[0]*d+o[0]*f+a[0]*_
z[1]=i[1]*d+o[1]*f+a[1]*_
z[2]=i[2]*d+o[2]*f+a[2]*_
S(z)}else I(z,a)
k={}
B=false
W=10
F=G=U=0
O.raycast3DLocalCB(t,z,e.dowser_range,dowserVoxelCB)
if(y.defines.DOWSER){w.addText("Transition Count: "+G)
w.addText("Transition Back Count: "+F)
var v=0
var h=0
for(var p in k){var m=k[p]
v=N(v,m)
h+=m}w.addText("Max: "+(100*v/h).toFixed(0)+"%")}var g=(.5*((G=N(0,G-1))-F)+F)/10
T(V,t,z,.333*E)
return{intensity:g+.05,ore_type:A(V),blend_time:1e3}}},{"../common/ids":198,"../glov/client/engine.js":250,"../glov/common/util.js":330,"../glov/common/vmath.js":332,"./build_mode.js":27,"./debug.js":62,"./main.js":112,"./tiles.js":162,"./voxel_data.js":175}],67:[function(e,t,r){"use strict"
r.simpleDowse=simpleDowse
r.simpleDowserStartup=simpleDowserStartup
r.DOWSER_SIMPLE_BASE_LEN=void 0
var a=30
r.DOWSER_SIMPLE_BASE_LEN=a
var i=e("../glov/client/engine.js")
var o=e("../glov/common/util.js").arrayToSet
var n=e("../glov/common/vmath.js")
var u=n.v3distSq
var d=n.v3iScale
var f=n.v3set
var v=n.v3sub
var s=n.vec3
var l=e("../common/globals.js")
var h=l.CHUNK_SIZE
var c=l.CS3
var _=e("./chunk_searcher.js").ChunkSearcher
var p=e("./debug.js")
var m=e("./main.js").charControllerPos
var g=e("./proc_gen.js").oreFromChunkPos
var E=e("./tiles.js")
var y=E.TILE_ORE_IN_STONE
var T=E.TILE_ORE_IN_STONE_DARK
var I=E.TILE_ORE_IN_STONE_LIGHT
var S=E.TILE_ORE_IN_STONE_RED
var A=E.TILE_ORE_IN_VEINIUM
var w=e("./voxel_data.js")
var L=Math.max
var R
var x=o([y,I,T,S,A])
function vdHasOre(e,t){if(e.has_ore_ver===e.ver_data)return e.has_ore
t.addWork(10)
e.has_ore_ver=e.ver_data
var r=e.data
for(var a=0;a<c;++a)if(x[r[a]])return e.has_ore=true
return e.has_ore=false}var O=s()
var b=s()
var N=s()
function simpleDowse(e,t){R.setStart(m())
R.setRange(e.dowser_range)
if(t||R.done)R.reset(t)
var l=0
var c=0
var _=0
R.search(function(e){var t=null
c++
if(vdHasOre(e,R)){_++
R.addWork(20)
v(O,e.pos,w.origin_chunk)
d(O,h)
var r=e.data
for(var a=0,i=0;i<h;++i)for(var o=0;o<h;++o)for(var n=0;n<h;++n,++a){l++
if(x[r[a]]){b[0]=O[0]+n
b[1]=O[1]+o
b[2]=O[2]+i
var s=u(R.start,b)
if(s<R.closest_dist){f(N,n,o,i)
t={closest_chunk:e,closest_dist:s,closest_offs:N}}}}}return t})
if(i.defines.DOWSER){p.addText("Checks:")
p.addText("  Chunks Checked: "+c)
p.addText("  Chunks With Ore: "+_)
p.addText("  Voxels Checked: "+l)
p.addText("Time: "+(i.hrnow()-R.search_start_time).toFixed(3))
p.addText("Distance: "+R.last_closest_dist.toFixed(1)+"/"+R.range)
p.addText("Walk: "+R.chunk_walk+" / "+R.done)}if(R.last_closest_chunk)return{intensity:L(1-(R.last_closest_dist-2)/R.range,0),ore_type:g(R.last_closest_chunk.pos),blend_time:500}
else return{intensity:0,ore_type:null,blend_time:500}}var C=50
function simpleDowserStartup(){R=new _(C)}},{"../common/globals.js":197,"../glov/client/engine.js":250,"../glov/common/util.js":330,"../glov/common/vmath.js":332,"./chunk_searcher.js":33,"./debug.js":62,"./main.js":112,"./proc_gen.js":132,"./tiles.js":162,"./voxel_data.js":175}],68:[function(e,t,r){"use strict"
r.dowserUI=dowserUI
var h=e("assert")
var p=e("../glov/client/camera2d.js")
var m=e("../glov/client/engine.js")
var g=e("../glov/client/ui.js")
var E=e("../glov/common/util.js").lerp
var a=e("../glov/common/vmath.js")
var y=a.v3copy
var T=a.v3distSq
var I=a.v3lerp
var S=a.v4copy
var i=a.vec4
var A=e("../common/ids").ITEM_DOWSER_ADVANCED
var w=e("./dowser_advanced.js").advancedDowse
var L=e("./dowser_simple.js").simpleDowse
var R=e("./localization/localization").L
var x=e("./materials").MATERIAL_NAME
var O=e("./styles").label_style
var b=e("./tiles.js").MAT_METAL_TINT
var N=Math.max,C=Math.min
var _=100
var M=.01
var D={unidentified:0,ore_detected:0}
function drawDowserUIText(e,t,r,a,i,o,n){var s=g.font
var l=C(m.frame_dt/_,1)
n=E(l,n,o?1:0)
var c=s.styleAlpha(e,n)
s.drawSizedAligned(c,t,r,a,1.15*g.font_height,s.ALIGN.HVCENTER,0,0,i)
return n}var P
var k
var B=i(.5,.5,.5,1)
var U=i(1,1,1,1)
var G=i(1,1,1,.5)
var F=i(0,0,0,1)
var W=i()
function dowserUI(e){h(e.dowser_range)
var t=p.w()/2
var r=.75*p.h()
var a=Z.UI
var i=600
var o=50
var n=m.frame_index!==P+1
P=m.frame_index
var s
if(e.id===A)s=w(e)
else s=L(e,n)
var l=s,c=l.intensity,_=l.ore_type,u=l.blend_time
S(W,G)
var d=B
var f=_===e.attr1
if(f)if(b[e.attr1]){d=b[e.attr1]
if(T(d,B)<.12&&N(d[0],d[1],d[2])-C(d[0],d[1],d[2])<.05)d=U}c=C(c,1)
if(n){k=c
y(F,d)}else{var v=C(m.frame_dt/u,1)
k=E(v,k,c)
I(F,v,F,d)}D.unidentified=drawDowserUIText(O,t,r+o/2,a+1,R.DOWSERUI_UNIDENTIFIED,!f&&c>=M,D.unidentified)
D.ore_detected=drawDowserUIText(O,t,r+o/2,a+1,R.$(R.DOWSERUI_ORE_DETECTED,x[e.attr1]),f&&c>=M,D.ore_detected)
g.progressBar({x:t-i/2,y:r,z:a,w:i,h:o,progress:k,color:F,color_trough:W,centered:true})}},{"../common/ids":198,"../glov/client/camera2d.js":241,"../glov/client/engine.js":250,"../glov/client/ui.js":306,"../glov/common/util.js":330,"../glov/common/vmath.js":332,"./dowser_advanced.js":66,"./dowser_simple.js":67,"./localization/localization":108,"./materials":114,"./styles":160,"./tiles.js":162,assert:void 0}],69:[function(e,t,r){"use strict"
r.drawLine3D=drawLine3D
var s=e("../glov/client/draw_list.js").opaqueQueue
var l=e("../glov/client/engine.js")
var c=e("../glov/client/geom.js")
var _=e("../glov/client/mat4ScaleRotateTranslate.js")
var u=Math.atan2,d=Math.sqrt
var a=e("../glov/client/quat.js"),i=a.quat,f=a.qFromYPR
var v=e("../glov/client/shaders.js")
var h=v.shadersRequirePrelink
var p=e("../glov/client/textures.js")
var o=e("../glov/common/vmath.js"),n=o.vec3,m=o.v2distSq,g=o.v3copy,E=o.v3distSq,y=o.mat4
var T=e("./voxel_data.js").localPosFromWorldPos
var I=n()
var S=n()
var A=i()
var w
var L
var R
function drawLine3D(e){if(!w){var t=.0125
w=c.createQuads([[v.semantic.POSITION,gl.FLOAT,3,false]],new Float32Array([0,t,t,0,-t,t,1,-t,t,1,t,t,1,t,-t,1,-t,-t,0,-t,-t,0,t,-t,1,t,t,1,t,-t,0,t,-t,0,t,t,0,-t,t,0,-t,-t,1,-t,-t,1,-t,t,1,-t,t,1,-t,-t,1,t,-t,1,t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t]),true)
var r=h(false)
L=v.create("shaders/line_3d.vp")
R=v.create("shaders/line_3d.fp")
h(r)}var a=y()
if(e.local){g(I,e.p0)
g(S,e.p1)}else{T(I,e.p0)
T(S,e.p1)}var i=d(E(I,S))
var o=u(S[1]-I[1],S[0]-I[0])
var n=-u(S[2]-I[2],d(m(I,S)))
f(A,o,0,n)
_(a,1,A,I)
a[0]*=i
a[1]*=i
a[2]*=i
a[3]*=i
s(function(){p.bind(0,p.textures.white)
l.updateMatrices(a)
v.bind(L,R,{color:e.color,color2:e.color2||e.color})
w.draw()})}},{"../glov/client/draw_list.js":246,"../glov/client/engine.js":250,"../glov/client/geom.js":263,"../glov/client/mat4ScaleRotateTranslate.js":277,"../glov/client/quat.js":287,"../glov/client/shaders.js":293,"../glov/client/textures.js":304,"../glov/common/vmath.js":332,"./voxel_data.js":175}],70:[function(e,t,r){"use strict"
r.drawSprite3DStartup=drawSprite3DStartup
r.drawSprite3D=drawSprite3D
var a=e("./camera.js").getCurrentCameraPos
var i=e("../glov/client/engine.js")
var o=e("../glov/client/geom.js")
var n=e("../glov/client/mat4ScaleRotateTranslate.js")
var s=Math.atan2,l=Math.sqrt
var c=e("../glov/client/quat.js"),_=c.quat,u=c.qFromAxisAngle
var d=e("../glov/client/shaders.js")
var f=e("../glov/client/sprites.js")
var v=e("../glov/client/textures.js")
var h=e("../glov/common/vmath.js"),p=h.mat4,m=h.vec3,g=h.v3sub,E=h.v2lengthSq,y=h.unit_vec,T=h.zaxis
var I=p()
var S=_()
var A=m()
var w
var L
function drawSprite3DStartup(){w=o.createQuads([[d.semantic.POSITION,gl.FLOAT,3,false],[d.semantic.TEXCOORD,gl.FLOAT,2,false]],new Float32Array([1,0,1,0,0,1,0,-1,0,1,-1,0,-1,1,1,-1,0,1,1,0]),true)
L=d.create("shaders/billboard.vp")
d.prelink(L,f.sprite_fshader)}function drawSprite3D(e){if(!w)drawSprite3DStartup()
g(A,a(),e.pos)
var t=l(E(A))
u(S,T,-s(A[0]/t,A[1]/t))
n(I,1,S,e.pos)
v.bindArray(e.texs)
i.updateMatrices(I)
d.bind(L,f.sprite_fshader,{size:e.size||y,color:e.color})
w.draw()}},{"../glov/client/engine.js":250,"../glov/client/geom.js":263,"../glov/client/mat4ScaleRotateTranslate.js":277,"../glov/client/quat.js":287,"../glov/client/shaders.js":293,"../glov/client/sprites.js":302,"../glov/client/textures.js":304,"../glov/common/vmath.js":332,"./camera.js":28}],71:[function(e,t,r){"use strict"
r.editVolumeClearContentsInProgress=editVolumeClearContentsInProgress
r.editVolumeClearContentsCancel=editVolumeClearContentsCancel
r.editVolumeClearContentsStart=editVolumeClearContentsStart
r.editVolumeClearContentsTick=editVolumeClearContentsTick
var m=e("../glov/client/camera2d")
var g=e("../glov/client/engine")
var E=e("../glov/client/ui")
var a=e("../glov/common/vmath")
var y=a.unit_vec
var T=a.v3add
var I=a.v3sub
var S=e("../common/editvolume_common").volumeContainsPoint
var i=e("../common/globals")
var A=i.CHUNK_SIZE
var v=i.ID_FACTOR
var w=i.TILE_PROP_BASE
var L=i.TILE_PROP_MAX
var R=e("../common/ids").ITEM_BAG
var x=e("./editvolume_client").editVolumeById
var O=e("./localization/localization").L
var b=e("./main").getFrameTransaction
var N=e("./status")
var C=e("./user_data").worldReadOnly
var M=e("./voxel_data")
var o=e("./voxel_data")
var D=o.getPropRelative
var P=o.transPropRemove
var k=o.transSetTileDirect
var B=e("./world_comm").worldTransactionsInProgress
var U=Math.min
var G
var F
function editVolumeClearContentsInProgress(){return g.frame_index<=G+1}function editVolumeClearContentsCancel(){G=void 0
if(F.resp_func)F.resp_func()
F=void 0}function editVolumeClearContentsStart(e,t){G=g.frame_index
var r=e.bounds,a=e.volume_id
var i=[]
var o=r.min_chunk[0]
var n=r.min_chunk[1]
var s=r.min_chunk[2]
var l=r.max_chunk[0]
var c=r.max_chunk[1]
for(var _=r.max_chunk[2]-1;_>=s;--_)for(var u=n;u<c;++u)for(var d=o;d<l;++d){var f=(_*v+u)*v+d
i.push(f)}F={volume_id:a,done:0,total:i.length,walk:i.length-1,walk_last_done:i.length-1,stalled:0,all_chunks:i,resp_func:t}}var W=new Int32Array(3)
var j=new Int32Array(3)
var H=new Int32Array(3)
function clearChunk(e,t){var r=false
var a=t.liquid,i=t.data,o=t.props
var n
var s={}
if(o)for(var l in o){var c=o[l]
if(!c.mineable()&&c.item_id!==R)continue
T(H,t.pos_world,c.pos)
T(H,H,c.size)
I(H,H,y)
if(S(e,H)){n=n||b()
s[c.uid]=true
P(n,c,r,false)}}if(a||i)for(var _=0,u=0;_<A;++_){W[2]=_
j[2]=_+1
for(var d=0;d<A;++d){W[1]=d
j[1]=d
for(var f=0;f<A;++f,++u){W[0]=f
j[0]=f
if(i){var v=i[u]
if(v&&!(v>=w&&v<=L)){var h=D(t.chunk_id,j)
if(h&&(h.inv.rooted||h.neighborChanged)&&!s[h.uid]);else{n=n||b()
k(n,t,W,0,false,false,v,r)}}}if(a){var p=a[u]
if(p){n=n||b()
k(n,t,W,0,true,false,p,r)}}}}}return Boolean(n)}function editVolumeClearContentsTick(){if(!editVolumeClearContentsInProgress())return
var e=F,a=e.all_chunks,t=e.volume_id
var i=x(t)
if(!i||C()){editVolumeClearContentsCancel()
return}if(!a.length){N.push(O.STATUSMSG_AREA_CLEARED)
editVolumeClearContentsCancel()
return}G=g.frame_index
var r=.75*m.h()
var o=400
var n=m.x0()+(m.w()-o)/2
var s=Z.EDITVOLUME_STATUS
var l=F,c=l.done,_=l.total
var u=24
var d=8
var f=32
var v=r+u
E.font.draw({x:n+u,y:v,z:s,w:o-2*u,h:2*E.font_height,align:E.font.ALIGN.HVCENTER|E.font.ALIGN.HWRAP,color:255,text:F.stalled>=2?O.LBL_AREA_CLEARING_STALLED:O.LBL_AREA_CLEARING})
v+=2*E.font_height+d
if(E.buttonText({x:n+o/4,y:v,z:s,w:o/2,text:O.BTN_CANCEL}))editVolumeClearContentsCancel()
v+=E.button_height+d
E.progressBar({x:n+u,y:v,z:s,w:o-2*u,h:f,progress:c/_,tooltip:O.$(O.FORMAT_FRACTION,c,_)})
v+=f
E.panel({x:n,y:r,w:o,h:(v+=u)-r,z:s-1})
if(!F)return
if(B())return
function tryWalk(){if(F.walk<0)F.walk=a.length-1
var e=F.walk--
if(e===F.walk_last_done)F.stalled++
var t=a[e]
var r=M.chunk_map[t]
if(!r)return false
if(!r.allNeighborsGened())return false
F.done++
a.splice(e,1)
F.walk_last_done=U(e,a.length-1)
F.stalled=0
return clearChunk(i,r)}var h=Date.now()
var p=1e3
while(--p&&Date.now()-h<10)if(tryWalk())break}},{"../common/editvolume_common":193,"../common/globals":197,"../common/ids":198,"../glov/client/camera2d":241,"../glov/client/engine":250,"../glov/client/ui":306,"../glov/common/vmath":332,"./editvolume_client":72,"./localization/localization":108,"./main":112,"./status":156,"./user_data":170,"./voxel_data":175,"./world_comm":182}],72:[function(e,t,r){"use strict"
r.inEditBounds=inEditBounds
r.editVolumeForPos=editVolumeForPos
r.editVolumeDefaultAccess=editVolumeDefaultAccess
r.hasVolumeAdminAccessForPos=hasVolumeAdminAccessForPos
r.manageVolumeAllowedForPos=manageVolumeAllowedForPos
r.waygateEditAllowedForPos=waygateEditAllowedForPos
r.editVolumeById=editVolumeById
r.chunkInEditBounds=chunkInEditBounds
r.settlementEstablishAllowed=settlementEstablishAllowed
r.resetEditVolumes=resetEditVolumes
r.updateEditVolumes=updateEditVolumes
r.editVolumeShift=editVolumeShift
r.editVolumeClearContents=editVolumeClearContents
r.editVolumeAddHereCmd=editVolumeAddHereCmd
var a=e("./client_cmds.js").isElevated
var i=e("../glov/client/cmds.js").cmd_parse
var o=e("../common/editvolume_common.js"),s=o.EDITVOLUME_MAX_SIZE,n=o.volumeContainsPoint,c=o.volumesOverlap
var l=e("./editvolume_clear.js"),_=l.editVolumeClearContentsCancel,u=l.editVolumeClearContentsInProgress,d=l.editVolumeClearContentsStart
var f=e("../common/globals.js").CHUNK_SIZE
var v=Math.abs,h=Math.floor,p=Math.max,m=Math.round
var g=e("./main.js").charControllerPos
var E=e("./megachunk_client.js").megaChunkGetNearbyVolumes
var y=e("../glov/client/net.js").netSubs
var T=e("../glov/client/settings.js")
var I=e("./user_data.js"),S=I.editOutsideVolumeAllowed,A=I.manageVolumesAllowed,w=I.userAccessLevel
var L=e("../glov/common/util.js"),R=L.nop,x=L.toNumber
var O=e("../glov/common/vmath.js"),b=O.unit_vec,N=O.vec3,C=O.v3iAdd,M=O.v3iFloor,D=O.v3iRound,P=O.v3iScale,k=O.v3addScale,B=O.v3copy
var U=e("./voxel_data.js"),G=U.localPosFromWorldPos,F=U.worldPosFromLocalPos
var W=e("../common/waygate_upgrade_common.js").SETTLEMENT_EDITVOLUME_SIZE
var j=e("./world_comm.js"),H=j.getWorldChannel,z=j.getWorldID
var V=e("../common/world_constants.js"),Y=V.ACCESS_ADMIN,q=V.DEFAULT_ACCESS_VOLUME,K=V.THRESHOLD_ACCESS_MODIFY,Z=V.THRESHOLD_ACCESS_MANAGE_VOLUMES,X=V.VOLUME_SETTLEMENT_PREFIX
var Q=e("./world_metadata.js"),J=Q.worldAccessExvolume,$=Q.worldMetadata
var ee
var te
var re=[]
var ae
function setEditVolumes(e,t){if(!re)return
ae=[]
ee=e
te=t
for(var r=0;r<t.length;++r){var a=te[r]
var i=re[r]
if(!i)i=re[r]=[N(),N(),false]
G(i[0],a.min)
G(i[1],a.max)
i[2]=a.effective
a.build_allowed=e?a.effective:!a.effective}re.length=te.length}function inEditBounds(e){if(re.length){var t=e[0]
var r=e[1]
var a=e[2]
for(var i=0;i<re.length;++i){var o=re[i]
if(!o[2])continue
if(t>=o[0][0]&&t<o[1][0]&&r>=o[0][1]&&r<o[1][1]&&a>=o[0][2]&&a<o[1][2])return ee}}return!ee}function editVolumeForPos(e){if(re.length){var t=e[0]
var r=e[1]
var a=e[2]
for(var i=0;i<re.length;++i){var o=re[i]
if(t>=o[0][0]&&t<o[1][0]&&r>=o[0][1]&&r<o[1][1]&&a>=o[0][2]&&a<o[1][2])return te[i]}}return null}function editVolumeDefaultAccess(e){if(e&&e.access){var t=e.access.default_level
if(void 0!==t)return t}return q}function volumeCheckAccess(e,t,r){if(e.access&&e.access.ids&&e.access.ids[t])return e.access.ids[t].level>=r
return editVolumeDefaultAccess(e)>=r}function checkVolumeAccessForPos(e,t){var r=editVolumeForPos(e)
if(r)return volumeCheckAccess(r,y().getUserId(),t)
return null}function editVolumeCheckAccessForPos(e,t,r){var a=checkVolumeAccessForPos(e,t)
if(null!==a){if(!a)return w()>=Z
return a}return w()>=r}function hasVolumeAdminAccessForPos(e){var t=checkVolumeAccessForPos(e,Y)
if(null!==t)return t
return false}function manageVolumeAllowedForPos(e){var t=editVolumeForPos(e)
if(!t)return null
if(T.ignore_volumes)return t
if("small"===t.volume_id)return null
if(volumeCheckAccess(t,y().getUserId(),Z))return t
if(w()>=Z)return t
return null}function waygateEditAllowedForPos(e){if(T.ignore_volumes)return true
var t=$()
return editVolumeCheckAccessForPos(e,t.access_waygate,p(t.access_waygate,J()))}function editVolumeById(e){for(var t=0;t<te.length;++t){var r=te[t]
if(r.volume_id===e)return r}return null}var ie=N()
function chunkInEditBounds(e){var t=ae[e.chunk_id]
if(void 0===t){e.getLocalPos(ie)
t=ae[e.chunk_id]=inEditBounds(ie)}return t}var oe={min:N(),max:N()}
var ne={min:N(),max:N()}
function settlementEstablishAllowed(e,t){if(T.ignore_volumes)return true
if(!te.length)return true
var r=oe.min,a=oe.max
F(r,e)
k(r,r,b,-W/2)
P(r,1/f)
D(r)
P(r,f)
k(a,r,b,W)
var i=ne.min,o=ne.max
B(i,r)
B(o,a)
k(i,i,b,-f)
k(o,o,b,f)
for(var n=0;n<te.length;++n){var s=te[n]
if(t&&s.volume_id===t)continue
var l=s.volume_id.startsWith(X)?ne:oe
if(c(l,s))return false}return true}var se
function volumesThatAllow(e){return volumeCheckAccess(e,se,K)}function volumesThatRestrict(e){return!volumesThatAllow(e)}function filterObjectValues(e,t){var r=[]
for(var a in e){var i=e[a]
i.effective=Boolean(t(i))
r.push(i)}return r}function resetEditVolumes(){setEditVolumes(false,[])}function updateEditVolumes(e){if(!e&&z()){var t=E()
if(a()||T.ignore_volumes||A())setEditVolumes(false,filterObjectValues(t,R))
else{var r=!S()
se=y().getUserId()
if(r)setEditVolumes(true,filterObjectValues(t,volumesThatAllow))
else setEditVolumes(false,filterObjectValues(t,volumesThatRestrict))}}else setEditVolumes(false,[])}function editVolumeShift(e){for(var t=0;t<re.length;++t){var r=re[t]
C(r[0],e)
C(r[1],e)}}var le=N()
function formatVolume(e){return"Id: "+e.volume_id+"    Bounds: ["+e.min+"]-["+e.max+"]"}i.register({cmd:"area_list",help:"(Hidden) List nearby Areas",access_show:["sysadmin"],func:function func(e,t){if(!z())return void t("Not currently in a world")
var r=E()
function format(e){return formatVolume(r[e])}t(null,Object.keys(r).map(format).join("\n")||"No nearby Areas found")}})
function volumeCurrent(){var e=E()
F(le,g())
M(le)
for(var t in e){var r=e[t]
if(n(r,le))return r}return null}i.register({cmd:"area_current",help:"(Hidden) Display the Area you are standing in, if any",access_show:["sysadmin"],func:function func(e,t){if(!z())return void t("Not currently in a world")
var r=volumeCurrent()
if(!r)return void t(null,"Not currently in an Area")
t(null,formatVolume(r))}})
i.register({cmd:"area_delete",help:"Permanently delete the Area you are standing in",access_run:["world_admin"],func:function func(e,t){if(!z())return void t("Not currently in a world")
var r=volumeCurrent()
if(!r)return void t("Not currently in an Area")
H().cmdParse("world_volume_delete "+r.mcid+" "+r.volume_id,t)}})
i.register({cmd:"area_reset",help:"(Hidden) Permanently reset the Area you are standing in to a pristine state",access_run:["world_areabuilder"],access_show:["hidden"],func:function func(e,t){if(!z())return void t("Not currently in a world")
var r=volumeCurrent()
if(!r)return void t("Not currently in an Area")
H().cmdParse("world_volume_reset "+r.mcid+" "+r.volume_id,t)}})
function editVolumeClearContents(e,r){if(u()){_()
return void r(null,"Existing in-progress clear canceled")}if(!z())return void r("Not currently in a world")
H().cmdParse("world_volume_reset_prep "+e.mcid+" "+e.volume_id,function(e,t){if(e)return void r(e)
d(t,r)})}i.register({cmd:"area_delete_contents",access_run:["sysadmin"],help:"(Admin) Clear the contents (blocks, props, etc) of an Area, or the Area you are standing",prefix_usage_with_help:true,usage:"Usage: /area_delete_contents [area_id]",func:function func(e,t){if(!z())return void t("Not currently in a world")
if(e){var r=editVolumeById(e)
if(!r)return void t("Area not found.")
editVolumeClearContents(r,t)}else{var a=volumeCurrent()
if(!a)return void t("Not currently in an Area")
editVolumeClearContents(a,t)}}})
function editVolumeAddHereCmd(e,t){F(le,t||g())
M(le)
e=e||[]
for(var r=0;r<3;++r){var a=e[r]
if(!isFinite(a)||a<f)a=f
e[r]=h(a/f)*f
le[r]=m((le[r]-e[r]/2)/f)*f}return"world_volume_add "+le+" "+e}i.register({cmd:"area_add",help:"Add a new Area where you are standing",usage:"$HELP\n  Usage: /area_add [sizeX sizeY sizeY] (defaults: "+f+")\n  Note: sizes must be a multiple of "+f,access_run:["world_admin"],func:function func(e,t){if(!z())return void t("Not currently in a world")
var r=editVolumeAddHereCmd(e.split(" ").map(x))
H().cmdParse(r,t)}})
i.register({cmd:"area_access",help:"Set or display the access for the Area you are standing in",usage:"$HELP\nDisplay access list: /area_access\nDisplay access: /area_access (user_id|default)\nSet access: /area_access (user_id|default) level\n  Available levels: DEFAULT, READONLY, BUILDER, ADMIN, OWNER",access_run:["world_areabuilder"],func:function func(e,t){if(!z())return void t("Not currently in a world")
var r=volumeCurrent()
if(!r)return void t("Not currently in an Area")
H().cmdParse("world_volume_access "+r.mcid+" "+r.volume_id+" "+e,t)}})
i.register({cmd:"area_size",help:"Set or display the size of the Area you are standing in",usage:"$HELP\n  Usage: /area_size [sizeX sizeY sizeZ]\n  Note: sizes must be a multiple of "+f+" and no greater than "+s,access_run:["world_admin"],func:function func(e,t){if(!z())return void t("Not currently in a world")
var r=volumeCurrent()
if(!r)return void t("Not currently in an Area")
var a=e.split(" ").map(x)
if(3!==a.length)return void t(null,'Area "'+r.volume_id+'": size '+(r.max[0]-r.min[0])+" "+(r.max[1]-r.min[1])+" "+(r.max[2]-r.min[2]))
var i=[]
for(var o=0;o<3;++o){var n=a[o]
if(!isFinite(n)||n<f||n>s||n%f)return void t("Size in each dimension must a positive multiple of "+f+" no greater than "+s)
i[o]=r.min[o]+n}H().cmdParse("world_volume_bounds "+r.mcid+" "+r.volume_id+" "+r.min+" "+i,t)}})
var ce="Usage: /area_shift deltaX deltaY deltaZ"
var _e=256
i.register({cmd:"area_shift",help:"Shift the position of the Area you are standing in",usage:"$HELP\n  "+ce+"\n  Note: positions must be a multiple of "+f,access_run:["world_admin"],func:function func(e,t){if(!z())return void t("Not currently in a world")
var r=volumeCurrent()
if(!r)return void t("Not currently in an Area")
var a=e.split(" ").map(x)
if(3!==a.length)return void t(ce)
var i=[]
var o=[]
for(var n=0;n<3;++n){var s=a[n]
if(!isFinite(s)||s%f||v(s)>_e)return void t("Delta in each dimension must a multiple of "+f+" and a magnitude of "+_e+" or less")
o[n]=r.min[n]+s
i[n]=r.max[n]+s}H().cmdParse("world_volume_bounds "+r.mcid+" "+r.volume_id+" "+o+" "+i,t)}})
i.register({cmd:"settlement_unlock",access_run:["sysadmin"],help:"(Admin) Unlock or reset unlocks on a Settlement",usage:"$HELP\n  Usage: /settlement_unlock - lists current unlocks and available unlocks\n  Usage: /settlement_unlock unlock_id|ALL [RESET] - unlocks or resets unlocks",func:function func(e,t){if(!z())return void t("Not currently in a world")
var r=volumeCurrent()
if(!r)return void t("Not currently in a volume")
if(!r.volume_id.startsWith(X))return void t("Not currently in a Settlement volume")
var a=r.volume_id.slice(X.length)
H().cmdParse("world_settlement_unlock "+r.mcid+" "+a+" "+e,t)}})},{"../common/editvolume_common.js":193,"../common/globals.js":197,"../common/waygate_upgrade_common.js":211,"../common/world_constants.js":212,"../glov/client/cmds.js":244,"../glov/client/net.js":279,"../glov/client/settings.js":291,"../glov/common/util.js":330,"../glov/common/vmath.js":332,"./client_cmds.js":34,"./editvolume_clear.js":71,"./main.js":112,"./megachunk_client.js":116,"./user_data.js":170,"./voxel_data.js":175,"./world_comm.js":182,"./world_metadata.js":186}],73:[function(e,t,r){"use strict"
r.energyWellFixupTimes=energyWellFixupTimes
r.possiblyApplyWaygateSickness=possiblyApplyWaygateSickness
r.energyWellStartup=energyWellStartup
r.energyWellInit=energyWellInit
r.energyWellCharged=energyWellCharged
r.energyWellChargedTime=energyWellChargedTime
r.energyWellReadiness=energyWellReadiness
r.energyWellShouldAutoDrink=energyWellShouldAutoDrink
r.energyWellDrink=energyWellDrink
r.energyWellRun=energyWellRun
r.TIME_REFILL=void 0
var a=300
r.TIME_REFILL=a
var i=3600
var o=28800
var m=e("assert")
var n=e("../glov/client/engine")
var g=e("../glov/client/net").netSubs
var O=e("../glov/client/ui")
var b=e("../glov/client/walltime")
var N=e("../common/ids").ITEM_ENERGY_WELL
var E=e("./analytics").logEvent
var c=e("./build_mode").doStamina
var C=e("./crafting_mods").CMODS
var s=e("./huds")
var M=s.ATTRIB_BAR_H
var l=s.ATTRIB_BAR_W
var y=s.showStaminaMessage
var D=s.staminaBar
var _=e("./layout")
var P=_.layoutCameraCurX1
var k=_.layoutCameraCurY1
var u=e("./localization/localization")
var d=u.DURATION_ONLY_MINUTES
var B=u.DURATION_WITH_MINUTES
var U=u.L
var f=e("./main").getFrameTransaction
var v=e("./settlement")
var G=v.settlementForPos
var F=v.settlementLastBound
var h=e("./styles")
var W=h.color_green
var j=h.color_stamina_bar
var H=h.color_white
var z=h.label_style
var V=h.stamina_style
var Y=h.sublabel_style
var q=e("./ui_util")
var K=e("./ui_util").STAMINA_SYMBOL
var p=e("./user_data")
var X=p.userAttribGet
var T=p.userAttribModBatched
var I=p.userAttribModMaxBatched
var S=p.userAttribModMaxTrans
var A=p.userAttribModTrans
var w=p.userDataSet
var L=p.userDataSetOnNextAttribFlush
var Q=p.userLastEnergyWellTime
var R=p.userLastWaygateTime
var J=p.userStaminaCur
var $=p.userStaminaMax
var x=p.userStaminaMod
var ee=e("./waygate_ui")
var te=ee.FONT_HEIGHT
var re=ee.PAD
var ae=ee.SUBLINE_W
var ie=ee.drawHLine
var oe=e("./waygate_upgrade")
var ne=oe.WAYGATE_SAFE_TIME
var se=oe.WAYGATE_SICKNESS_DURATION
var le=e("./worlds_sound").playSound
var ce=Math.max,_e=Math.min,ue=Math.floor
m(l)
var de=[{time:a,label:U.$(U.LBL_REFILL_ENERGY,K)},{time:i,cmod:C.TIMED_STAM_CAPACITY_WELL1,duration:900,label:U.$(U.LBL_OVERFILL_ENERGY,U.separate("",U.addPercentage(25),K),U.duration(900,d))},{time:o,cmod:C.TIMED_STAM_CAPACITY_WELL2,duration:3600,label:U.$(U.LBL_WELL_RESTED,U.separate("",U.addPercentage(50),K),U.duration(3600,d))}]
function energyWellFixupTimes(){if(!c())return
var a
var e=b.seconds()
var i=e-Q()
function checkMod(e,t){if(a=X(e)){var r=t-i
if(a>r+10){r=ce(0,r)
T(e,-(a-r))}}}for(var t=0;t<de.length;++t){var r=de[t]
if(r.cmod)checkMod(r.cmod,r.duration)}i=e-R()
checkMod(C.TIMED_STAM_CAPACITY_WGSICK,se)}function possiblyApplyWaygateSickness(){if(!c())return
var e=R()
var t=b.seconds()
var r=ce(0,t-e)
var a=ne-r
w("wg_time",t)
if(a>0){var i=_e(se,a)
var o
var n
if(i&&(n=X(C.TIMED_STAM_CAPACITY_WELL1))){var s=_e(n,i)
i-=s
o=o||f()
A(o,C.TIMED_STAM_CAPACITY_WELL1,-s)}if(i&&(n=X(C.TIMED_STAM_CAPACITY_WELL2))){var l=_e(n,i)
i-=l
o=o||f()
A(o,C.TIMED_STAM_CAPACITY_WELL2,-l)}if(i>X(C.TIMED_STAM_CAPACITY_WGSICK)){o=o||f()
S(o,C.TIMED_STAM_CAPACITY_WGSICK,i)}}}var fe
var ve
function energyWellStartup(){fe=O.font
ve=q.sprite}function energyWellInit(){}function energyWellCharged(e){var t=G(e.getLocalPos())
if(!t||t!==F())return false
if(e.item_id===N&&!t.unlocked_ids[N])return false
var r=Q()
var a=b.seconds()
return ce(0,a-r)>=de[0].time}function energyWellChargedTime(e){var t=Q()
var r=b.seconds()
var a=ce(0,r-t)
return ce(de[0].time-a,0)}var he
var pe
function energyWellReadiness(){if(n.frame_index===pe)return he
if(!c())he=2
else{var e=Q()
var t=b.seconds()
var r=ce(0,t-e)
for(var a=he=0;a<de.length;++a)if(r>=de[a].time)he=a+1}pe=n.frame_index
return he}function energyWellShouldAutoDrink(e){return c()&&energyWellCharged(e)&&J()/$()<.25}function energyWellDrink(){var e=b.seconds()
var t=Q()
var r=$()-J()
var a=t?ce(0,e-t):-1
var i=energyWellReadiness()-1
var o=de[i]
m(o)
L("well_time",e)
for(var n=0;n<i;++n){var s=de[n]
if(s.cmod){var l=X(s.cmod)
if(l)T(s.cmod,-l)}}var c=true
if(o.cmod)for(var _=i+1;_<de.length;++_){var u=de[_]
if(u.cmod){var d=X(u.cmod)
if(d)if(d>o.duration)c=false
else T(u.cmod,-d)}}if(o.cmod&&c){var f=o.duration
var v=X(C.TIMED_STAM_CAPACITY_WGSICK)
if(v){var h=_e(f,v)
T(C.TIMED_STAM_CAPACITY_WGSICK,-h)
f-=h}if(f)I(o.cmod,f)}var p=$()-J()
if(p){y(U.$(U.STATUSMSG_ENERGY_WELL_ADD,""+p+K))
x(null,p)}le("energy_well_drink")
g().serverLog("energy_well_drink",{time_since_last_drink:a,delta:p,missing:r})
E("energy_well_drink",a,null,null,{delta:p,missing:r})}var me=100
var ge=.667*me
var Ee=254
var ye=900
function pad2(e){return("0"+e).slice(-2)}function hms(e){var t=ue(e/3600)
var r=ue((e-=60*t*60)/60)
e-=60*r
var a=[]
if(t)a.push(t)
a.push(pad2(r),pad2(e))
return a.join(":")}var Te=ye/2
var Ie=2*M
function energyWellRun(e,t,r,a,i){var o=Z.UI
var n=P()-e
var s=k()-t
var l=e+n/2
var c=t+8
if(!i){var _=r&&G(r.getLocalPos())
if(!_||_!==F()){fe.drawSizedAligned(z,0,t,Z.UI+21,2*O.font_height,fe.ALIGN.HVCENTERFIT,n,s,U.ENERGYWELL_WITHIN_SETTLEMENT)
return}if(r.item_id===N&&!_.unlocked_ids[N]){fe.drawSizedAligned(z,0,t,Z.UI+21,2*O.font_height,fe.ALIGN.HVCENTERFIT,n,s,U.FACTORY_UPGRADE_SETTLEMENT_TO_UNLOCK)
return}}var u=Q()
var d=b.seconds()
var f=ce(0,d-u)
if(u){fe.drawSizedAligned(Y,e,c,o,te,fe.ALIGN.HCENTERFIT,n,0,U.$(U.ENERGYWELL_LAST_DRINK,U.duration(f,B)))
c+=te+re}var v=l-Ee/2
var h=0
var p=true
var m=0
for(var g=0;g<de.length;++g){var E=de[g]
if(!E.text_width)E.text_width=fe.getStringWidth(z,te,E.label)
var y=f>=E.time
var T=l-E.text_width/2-(ge+re)
ve.draw({x:T,y:c,z:o,w:ge,h:ge,frame:y?q.CHECK:q.TIME,color:y?W:H})
if(y){++h
m=E.duration}var I=T+ge+re
fe.drawSizedAligned(y?z:Y,I,c,o,te,fe.ALIGN.HFIT|fe.ALIGN.VCENTER,P()-re-I,ge,E.label)
c+=ge+re
var S=de[g+1]
if(!(S&&f>=S.time)){var A=_e(f/E.time,1)
if(A<.015)A=0
if(!y)A=_e(A,.98)
var w={x:l-Te/2,y:c,z:o,w:Te,h:Ie,progress:A,color:p?j:[.5,.5,.5,1]}
O.progressBar(w)
fe.drawSizedAligned(y?Y:V,w.x,w.y,o+2,y?.5*Ie:.8*Ie,fe.ALIGN.HVCENTERFIT,w.w,w.h,y?U.ENERGYWELL_READY:hms(E.time-f))
c+=Ie+re
if(S)ie(l,c,ae)}p=y}var L=$()
var R=J()
var x=false
if(!h){c+=re
fe.drawSizedAligned(Y,e,c,o,te,fe.ALIGN.HCENTERFIT,n,0,U.ENERGYWELL_RECHARGING)
c+=te+re
x=true}else if(i){c+=re
fe.drawSizedAligned(Y,e,c,o,te,fe.ALIGN.HCENTERFIT,n,0,U.ENERGYWELL_MUST_VISIT)
c+=te+re
x=true}else if(R===L&&(1===h||!u)){c+=re
fe.drawSizedAligned(Y,e,c,o,te,fe.ALIGN.HCENTERFIT,n,0,U.$(U.ENERGYWELL_FULL,K))
c+=te+re
x=true}else if(h>1&&X(C.TIMED_STAM_CAPACITY_WGSICK)){c+=re
if(m>X(C.TIMED_STAM_CAPACITY_WGSICK))fe.drawSizedAligned(Y,e,c,o,te,fe.ALIGN.HCENTERFIT,n,0,U.ENERGYWELL_CANCEL_SICKNESS_SOME)
else fe.drawSizedAligned(Y,e,c,o,te,fe.ALIGN.HCENTERFIT,n,0,U.ENERGYWELL_CANCEL_SICKNESS)
c+=te+re}if(O.buttonText({x:v,y:c,z:o,w:Ee,h:me,font_height:te,disabled:x,text:U.BTN_DRINK}))energyWellDrink()
fe.drawSizedAligned(Y,e,c=850,o,te,fe.ALIGN.HCENTERFIT,n,0,U.$(U.LBL_CURRENT_ENERGY,K))
D({x:l-ye/2,y:c+=te+re,z:o,w:ye,h:2*M,font_height:te,always_show:{stamina:true},verbose:true,attrib_filter:/^t_stamcap/})}},{"../common/ids":198,"../glov/client/engine":250,"../glov/client/net":279,"../glov/client/ui":306,"../glov/client/walltime":308,"./analytics":5,"./build_mode":27,"./crafting_mods":58,"./huds":87,"./layout":99,"./localization/localization":108,"./main":112,"./settlement":148,"./styles":160,"./ui_util":168,"./user_data":170,"./waygate_ui":179,"./waygate_upgrade":180,"./worlds_sound":187,assert:void 0}],74:[function(e,t,r){"use strict"
r.EntityWorldsClient=void 0
function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
return e}function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype)
_setPrototypeOf(e.prototype.constructor=e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){e.__proto__=t
return e})(e,t)}var i=e("assert")
var a=e("../glov/client/entity_base_client").EntityBaseClient
var o=e("../common/entity_worlds_common").entityWorldsCommonClass
var n=e("./ai").resetMoveTime
var s=function(a){_inheritsLoose(EntityWorldsClient,a)
function EntityWorldsClient(e,t){var r;(r=a.call(this,e,t)||this).draw_data=void 0
r.next_move_time=void 0
r.my_activate_time=void 0
r.waiting=void 0
r.home_point=void 0
r.my_activate_time=-Infinity
r.waiting=false
n(_assertThisInitialized(r),true)
return r}var e=EntityWorldsClient.prototype
e.onDelete=function onDelete(e){return 250}
e.applyAIMove=function applyAIMove(e){var t=this
i(!this.waiting)
this.waiting=true
this.applyBatchUpdate({field:EntityWorldsClient.AI_MOVE_FIELD,action_id:"ai_move",data_assignments:{pos:e}},function(e){if(e);t.waiting=false})}
return EntityWorldsClient}(o(a));(r.EntityWorldsClient=s).AI_MOVE_FIELD="seq_ai_move"},{"../common/entity_worlds_common":195,"../glov/client/entity_base_client":251,"./ai":4,assert:void 0}],75:[function(e,t,r){"use strict"
r.ExternalUsersClientApple=void 0
var a=e("../../frvr/client/xplay/signin_with_apple/ios")
var i=a.isAvailable
var n=a.isLogged
var o=a.logout
var s=a.promptLogin
var l=e("../../glov/client/client_config").PLATFORM_IOS
var c=e("../../glov/common/external_users_common").ERR_UNAUTHORIZED
var _=e("../../glov/common/types").isDataObject
var u=e("../../glov/common/util").errorString
var d=e("../../common/external_users/external_users_provider_ids").USERS_PROVIDER_APPLE
var f=function(){function ExternalUsersClientApple(){this.user_id=""
this.user_display_name=""}var e=ExternalUsersClientApple.prototype
e.getProvider=function getProvider(){return d}
e.enabled=function enabled(){return l&&i()}
e.loggedIn=function loggedIn(){return Boolean(this.user_id)}
e.logIn=function logIn(r,a){var i=this
var o=function handleResult(e,t){i.user_display_name=""
if(e){a(u(e))
return}if(!(_(t)&&_(t)&&t.userIdentifier&&"string"===typeof t.userIdentifier&&t.token&&"string"===typeof t.token)){a(c)
return}i.user_id=t.userIdentifier
if(_(t.user)&&"string"===typeof t.user.name)i.user_display_name=t.user.name
a(null,{provider:d,external_id:i.user_id,validation_data:t.token})}
n(function(e,t){if(r&&(e||!t))s(o)
else o(e,t)})}
e.logOut=function logOut(){this.user_id=""
this.user_display_name=""
o()}
e.getCurrentUser=function getCurrentUser(e){e(null,{external_id:this.user_id,name:this.user_display_name})}
return ExternalUsersClientApple}()
r.ExternalUsersClientApple=f},{"../../common/external_users/external_users_provider_ids":196,"../../frvr/client/xplay/signin_with_apple/ios":234,"../../glov/client/client_config":243,"../../glov/common/external_users_common":322,"../../glov/common/types":329,"../../glov/common/util":330}],76:[function(e,t,r){"use strict"
r.ExternalUsersClientFacebookGaming=void 0
var o=e("assert")
var a=e("../../frvr/client/xplay/facebook/facebook")
var n=a.getAuthToken
var i=a.graphAPI
var s=a.isAvailable
var l=a.login
var c=a.logout
var _=e("../../glov/common/external_users_common").ERR_UNAUTHORIZED
var u=e("../../glov/common/types").isDataObject
var d=e("../../glov/common/util").errorString
var f=e("../../common/external_users/external_users_provider_ids").USERS_PROVIDER_FACEBOOK_GAMING
function mapToUserInfo(e){o(u(e))
var t=e.id
o(t&&"string"===typeof t)
var r
if("string"===typeof e.name)r=e.name
var a
var i=u(e.picture)&&u(e.picture.data)&&e.picture.data.url
if("string"===typeof i)a=i
return{external_id:t,name:r,profile_picture_url:a}}var v=function(){function ExternalUsersClientFacebookGaming(){this.user_id=""}var e=ExternalUsersClientFacebookGaming.prototype
e.getProvider=function getProvider(){return f}
e.enabled=function enabled(){return Boolean(s())}
e.loggedIn=function loggedIn(){return Boolean(this.user_id)}
e.logIn=function logIn(r,a){var i=this
var o=function handleResult(e,t){if(e){a(d(e))
return}if(!(u(t)&&t.userID&&"string"===typeof t.userID&&t.token&&"string"===typeof t.token)){a(_)
return}i.user_id=t.userID
a(null,{provider:f,external_id:i.user_id,validation_data:t.token})}
n(function(e,t){if(r&&(e||!t))l(["gaming_profile","email","user_friends"],o)
else o(e,t)})}
e.logOut=function logOut(){this.user_id=""
c()}
e.getCurrentUser=function getCurrentUser(r){i("/me",void 0,{fields:"id,name,picture"},function(e,t){if(e)r(d(e))
else r(null,mapToUserInfo(t))})}
e.getFriends=function getFriends(r){i("/me/friends",void 0,{fields:"id,name,picture"},function(e,t){if(e)r(d(e))
else r(null,u(t)&&Array.isArray(t.data)?t.data.map(mapToUserInfo):[])})}
return ExternalUsersClientFacebookGaming}()
r.ExternalUsersClientFacebookGaming=v},{"../../common/external_users/external_users_provider_ids":196,"../../frvr/client/xplay/facebook/facebook":224,"../../glov/common/external_users_common":322,"../../glov/common/types":329,"../../glov/common/util":330,assert:void 0}],77:[function(e,t,r){"use strict"
r.ExternalUsersClientFacebookInstant=void 0
var i=e("assert")
var o=e("../../glov/client/fbinstant.js")
var a=e("../../glov/common/external_users_common")
var n=a.ERR_NOT_AVAILABLE
var s=a.ERR_UNAUTHORIZED
var l=e("../../glov/common/util").nop
var c=e("../../common/external_users/external_users_provider_ids").USERS_PROVIDER_FACEBOOK_INSTANT
var _="LIVE_MATCH_NOT_FOUND"
function mapToUserInfo(e){var t=e.getID()
i(t)
return{external_id:t,name:e.getName()||void 0,profile_picture_url:e.getPhoto()||void 0}}var u=function(){function ExternalUsersClientFacebookInstant(){this.checked_for_match=false
this.in_match=false}var e=ExternalUsersClientFacebookInstant.prototype
e.getProvider=function getProvider(){return c}
e.enabled=function enabled(){return Boolean(window.FBInstant)}
e.loggedIn=function loggedIn(){return Boolean(window.FBInstant&&FBInstant.player&&FBInstant.player.getID())}
e.logIn=function logIn(e,a){var t=this
if(!this.enabled()){a(s)
return}o.onready(function(){if(!t.checked_for_match)t.getMatch(l)
var r=FBInstant.player.getID()
if(!r){a(s)
return}FBInstant.player.getSignedPlayerInfoAsync().then(function(e){var t=null==e?void 0:e.getSignature()
if(!t){a(s)
return}FBInstant.player.getASIDAsync().then(function(e){if(!e){a(s)
return}a(null,{provider:c,external_id:r,validation_data:JSON.stringify({signed_player_info:t,asid:e})})},a)},a)})}
e.logOut=function logOut(){}
e.getCurrentUser=function getCurrentUser(e){e(null,mapToUserInfo(FBInstant.player))}
e.getFriends=function getFriends(t){FBInstant.player.getConnectedPlayersAsync().then(function(e){t(null,e?e.map(mapToUserInfo):[])},t)}
e.getPartyId=function getPartyId(a){this.getMatch(function(e,t){if(e||!t){a(e,null)
return}var r=t.getContextID()
i(r)
a(null,r)})}
e.getMatch=function getMatch(r){var a=this
if(this.checked_for_match&&!this.in_match){r()
return}FBInstant.room.getCurrentMatchAsync().then(function(e){a.in_match=Boolean(e)
if(!a.checked_for_match&&e){var t=document.getElementById("safearea")
if(t)t.style.margin="40pt 0 0 0"}a.checked_for_match=true
r(null,e)},function(e){if(e&&e.code===_){a.in_match=false
a.checked_for_match=true
r()}else{console.error(e)
r(n)}})}
return ExternalUsersClientFacebookInstant}()
r.ExternalUsersClientFacebookInstant=u},{"../../common/external_users/external_users_provider_ids":196,"../../glov/client/fbinstant.js":257,"../../glov/common/external_users_common":322,"../../glov/common/util":330,assert:void 0}],78:[function(e,t,r){"use strict"
r.externalUsersWorldsStartup=externalUsersWorldsStartup
var a=e("../../glov/client/client_config")
var i=a.PLATFORM_FBINSTANT
var o=a.PLATFORM_IOS
var n=e("../../glov/client/external_users_client").externalUsersSetup
var s=e("./external_users_client_apple").ExternalUsersClientApple
var l=e("./external_users_client_facebook_gaming").ExternalUsersClientFacebookGaming
var c=e("./external_users_client_facebook_instant").ExternalUsersClientFacebookInstant
function externalUsersWorldsStartup(){var e=[]
var t
if(i){var r=new c
e.push(r)
t=r.getProvider()}else{e.push(new l)
if(o)e.push(new s)}n(e,t)}},{"../../glov/client/client_config":243,"../../glov/client/external_users_client":256,"./external_users_client_apple":75,"./external_users_client_facebook_gaming":76,"./external_users_client_facebook_instant":77}],79:[function(e,t,r){"use strict"
r.factoryUIStartup=factoryUIStartup
r.factoryUIInit=factoryUIInit
r.factoryGetProgressEstimator=factoryGetProgressEstimator
r.factoryCraftingInProgress=factoryCraftingInProgress
r.drawZoomed=drawZoomed
r.doFactoryUI=doFactoryUI
r.FACTORY_STALLED=r.FACTORY_ACTIVE=r.FACTORY_PAUSED=r.FACTORY_MAX_OUTPUT=r.FACTORY_MAX_INPUT=void 0
var de=8
r.FACTORY_MAX_INPUT=de
var a=6
r.FACTORY_MAX_OUTPUT=a
var fe=0
r.FACTORY_PAUSED=fe
var ve=1
r.FACTORY_ACTIVE=ve
var he=2
r.FACTORY_STALLED=he
var pe=e("assert")
var _=e("../glov/client/camera2d")
var i=e("../glov/client/cmds").cmd_parse
var me=e("../glov/client/engine")
var G=e("../glov/client/input")
var T=e("../glov/client/net").netSubs
var ge=e("../glov/client/scroll_area").scrollAreaCreate
var Ee=e("../glov/client/settings")
var ye=e("../glov/client/ui")
var o=e("../glov/client/walltime")
var n=e("../glov/common/rand_alea")
var s=n.randCreate
var u=n.shuffleArray
var l=e("../glov/common/util")
var Te=l.clamp
var O=l.easeIn
var h=l.empty
var Ie=l.lerp
var Se=e("../common/globals").STACK_SIZE
var c=e("../common/ids")
var p=c.ITEM_ORE
var d=c.TYPE_CRAFT_CLASS
var f=e("../common/materials_common").CraftClass
var v=e("./build_mode").addToBagSplatter
var m=e("./crafting").sourceMatches
var F=e("./crafting_mods").CMODS
var g=e("./crafting_recipes").getRecipesForFactory
var E=e("./inventory")
var y=e("./inventory")
var I=y.INV_PLAYER
var S=y.canDrop
var W=y.canFit
var Ae=y.canFitPartial
var A=y.inventoryGet
var w=y.inventoryGetSize
var L=y.inventoryGetSizeMax
var R=y.transInvAdd
var x=y.transInvClear
var b=y.transInvDec
var N=e("./inventory_ui")
var C=N.ACCEPT_HIGHLIGHT
var M=N.ACCEPT_NO
var D=N.ACCEPT_OK
var we=N.INVTYPE_CONTAINER
var P=N.INVTYPE_MAIN
var k=N.ITEM_PAD
var B=N.QUICKBAR_VIEW_BORDER_PAD
var Le=N.canEquipFromContainer
var U=N.ctxTrans
var j=N.doInventorySetupContext
var H=N.doInventorySub
var z=N.doInventorySubOneItem
var Re=N.drawItemCount
var xe=N.equipFromContainer
var V=N.inventoryAnimate
var Y=N.inventoryButton
var Oe=N.inventoryButtonPrep
var q=N.inventoryDeselect
var K=N.inventoryMerge
var X=N.inventorySwap
var Q=N.inventoryUIInit
var J=N.inventoryUITick
var be=N.mapInvPos
var Ne=N.quickTransferContainer
var $=e("./item_info_view").itemInfoViewShow
var ee=e("./items")
var Ce=ee.ITEM_CONTEXT_ITEM
var te=ee.createItem
var re=ee.itemFullyMergeable
var ae=ee.itemPartiallyMergeable
var ie=ee.itemPotentiallyMergeable
var Me=ee.sameItem
var oe=e("./layout")
var De=oe.WIDE
var Pe=oe.layoutCameraCurX1
var ke=oe.layoutCameraCurY1
var Be=oe.layoutCameraTallWide
var Ue=oe.layoutCameraTallWideMode
var Ge=e("./localization/localization").L
var ne=e("./main")
var Fe=ne.getFrameTransaction
var se=ne.menuConsumeExit
var We=ne.menuExit
var le=e("./materials").MATERIAL_INGOT_SCALE
var ce=e("./menu")
var _e=ce.PANEL_PAD
var je=ce.menuInteractGetProp
var ue=ce.panel_color
var He=e("./props").PIEB_CHECK_ROOT
var ze=e("./red_dot")
var Ve=ze.redDotIsSeen
var Ye=ze.redDotSeen
var qe=e("./settlement").settlementForPos
var Ke=e("./status")
var Ze=e("./styles")
var Xe=Ze.color_black
var Qe=Ze.color_green
var Je=Ze.color_locked_fade
var $e=Ze.color_red
var et=Ze.color_yellow
var tt=Ze.colors_green
var rt=Ze.colors_red
var at=Ze.inventory_style
var it=Ze.label_style
var ot=Ze.menu_header_style
var nt=Ze.refreshing_style
var st=Ze.style_mode_label
var lt=Ze.style_progress_label
var ct=Ze.style_rarity
var _t=Ze.sublabel_style
var ut=e("./todo_list")
var dt=ut.TODO_TOGGLE
var ft=ut.todoDone
var vt=ut.todoIsInList
var ht=ut.todoListAdd
var pt=ut.todoTooltip
var mt=e("./tutorial").tutorialHook
var gt=e("./ui_util")
var Et=e("./user_data").worldReadOnly
var yt=e("./voxel_data").transPropUpdateField
var Tt=e("./world_metadata")
var It=Tt.adventureMode
var St=Tt.unlimitedMode
var At=Math.ceil,wt=Math.floor,Lt=Math.max,Rt=Math.min,xt=Math.random,Ot=Math.round
var bt
var Nt
var Ct
Ee.register({crafting_time_scale:{default_value:1,type:i.TYPE_FLOAT,range:[0,1e3],access_run:["sysadmin"]}})
function factoryUIStartup(){bt=ye.font
Nt=ye.title_font
Ct=gt.sprite}var Mt=1
var Dt=false
var Pt=0
var kt=1
var Bt
var Ut=0
function factoryUIInit(){Q()
Bt=Pt
Ut=0}function secondsTimeNowInt(){return At(o()/1e3)-1577836800}function secondsTimeNow(){return o()/1e3-1577836800}function isInputScaledCount(e,t){if(e===d)if(t===f.FUEL)return true
else if(t===f.SCALED_INGOT)return true
return false}function inputScaleCount(e,t,r,a){if(t===d)if(r===f.FUEL)e=Rt(e*a.getFuelRate(),Se)
else if(r===f.SCALED_INGOT)e=Ot(e*(le[a.getMaterial()]||1))
return e}function inputCountPer(e,t){pe(e)
pe(t)
var r=e[0]
return inputScaleCount(r,e[1],e[2],t)}function factoryFitsInSlot(e,t,r){return m(e.recipe,t,r)}function acceptsItemFactory(e,t,r){var a
var i
if(t.type===we&&t.idx<de){if(!r.inv){if(!t.inv){for(var o=0;o<w(I);++o)if(factoryFitsInSlot(e,t.idx,A(o)))return C
var n=e.prop
for(var s=de+Mt;s<n.container_size;++s)if(factoryFitsInSlot(e,t.idx,n.contents[s]))return C}return M}a=t
i=r}else if(r.type===we&&r.idx<de){if(!t.inv){if(!Dt&&t.type===we)return M
return D}a=r
i=t}if(a)if(factoryFitsInSlot(e,a.idx,i.inv))return C
else return M
if(!Dt){if(t.type===we&&r.type===P)return M
if(t.type===P&&r.type===we&&t.inv){if(r.inv&&ae(t.inv,r.inv))return D
return M}}return D}function quickTransferFactory(e,t,r,a){var i=e.prop,o=e.recipe
pe(t.type===P||t.type===we&&t.idx>=de)
var n=o.inputs
for(var s=0;s<n.length;++s)if(!i.contents[s]&&m(o,s,r)){if(1===(a=Rt(a,Se)))a=inputCountPer(n[s].source,r)
K(e,{type:we,idx:s},t,a)
return true}for(var l=0;l<n.length;++l){var c=i.contents[l]
if(c)if(ie(c,r)){var _=ae(c,r)
if(_){if(1===a){var u=inputCountPer(n[l].source,c)
var d=c.count%u
_=Rt(_,u-d)}else _=Rt(a,_)
K(e,{type:we,idx:l},t,_)}return true}}if(!isFinite(a))for(var f=0;f<n.length;++f)if(i.contents[f])if(m(o,f,r)){X(e,{type:we,idx:f},t)
return true}return false}function quickTransferFactoryThenContainer(e,t,r,a){if(quickTransferFactory(e,t,r,a))return true
return Ne(e,t,r,a)}function findOutputSlot(e,t){if(!e.contents[de]||re(e.contents[de],t))return de
if(!Me(e.contents[de],t)&&!(t&&t.ignore_take))return-1
for(var r=de;r<e.container_size;++r)if(e.contents[r]&&re(e.contents[r],t))return r
for(var a=de;a<e.container_size;++a)if(!e.contents[a])return a
return-1}function canEject(e){if(S())return true
var t=e.container_size
var r=[]
e:for(var a=0;a<de+Mt;++a){var i=e.contents[a]
if(!i)continue
var o=-1
for(var n=de+Mt;n<t;++n){if(r[n])continue
if(!e.contents[n])o=n
else if(re(e.contents[n],i)){r[n]=true
continue e}}for(var s=0;s<L(I);++s){var l=t+s
if(r[l])continue
var c=A(s)
if(!c)o=l
else if(re(c,i)){r[l]=true
continue e}}if(-1===o)return false
r[o]=true}return true}function factoryPause(e){var t=e.prop
var r=U(e)
yt(r,t,"fs","factory_state",fe)
yt(r,t,"ft","factory_time",0)
delete t.factory_time_high}function factoryStall(e){var t=e.prop
var r=U(e)
yt(r,t,"fs","factory_state",he)
yt(r,t,"ft","factory_time",0)
delete t.factory_time_high}function toItemIDs(e){return e.type+","+e.id+","+(e.attr1||0)+","+(e.attr2||0)+","+(e.att3||0)}function inputsKey(e){return e.map(toItemIDs).join()}function factoryStart(e,t){var r=e.prop
var a=secondsTimeNowInt()
if(r.factory_state!==ve||r.factory_time!==a){var i=U(e)
yt(i,r,"fs","factory_state",ve)
yt(i,r,"ft","factory_time",a)}r.factory_time_high=secondsTimeNow()
r.factory_input_key=inputsKey(t)}function getUnlockedRecipesForFactory(e){var t=g(e.item_id)
var r=e.getLocalPos()
var a=qe(r)
var i={}
var o=0
var n={}
for(var s in t){var l=t[s]
if(!l.is_settlement_locked||a&&a.allowsRecipe(s)||St())i[s]=l
else if(l.is_settlement_locked)if(a&&a.allowsRecipeSoon(s))n[s]=l
else o++}return[i,o,n]}function setRecipe(s,e){var l=s.prop
var c=U(s)
var _=false
function ejectInput(e){var t=l.contents[e]
var r=-1
var a=t.count
for(var i=de+Mt;i<l.container_size;++i){var o=l.contents[i]
if(o){var n=ae(o,t)
if(n){K(s,{type:we,idx:i},{type:we,idx:e},n)
if(!(a-=n))return}}else if(-1===r)r=i}if(-1!==r){X(s,{type:we,idx:e},{type:we,idx:r})
return}pe(t.count===a)
x(c,l,e)
if(W(t))R(c,I,t)
else{v(c,E.getDropPos(),{cost:[t]},true,true)
_=true}}var t=getUnlockedRecipesForFactory(l)[0][e]
pe(t)
yt(c,l,"fr","factory_recipe",e)
factoryPause(s)
for(var r=0;r<de+Mt;++r)if(l.contents[r]&&(r>=t.inputs.length||!m(t,r,l.contents[r])))ejectInput(r)
if(_)Ke.push(Ge.STATUSMSG_SOME_ITEMS_DROPPED)
l.transBusy(c)}function checkInputs(e){var t=e.prop,r=e.recipe
var a=r.inputs
var i=true
var o=[]
var n=Infinity
for(var s=0;s<a.length;++s){var l=a[s].source
var c=t.contents[s]
if(c&&m(r,s,c)){var _=inputCountPer(l,o[s]=c)
var u=wt(c.count/_)
n=Rt(n,u)}else{i=false
n=0}}var d
var f=false
if(i){f=-1!==findOutputSlot(t,d=r.output(o,true,t))
if(me.DEBUG&&d)if(d.id!==p){pe(d.is_crafted)
var v=d.getCraftCost()
pe(v)
pe(v.length)}if(!d)n=0}if(n&&r.needs_finish)n=1
return{all_inputs_satisfied:i,output_preview:d,output_allowed:f,satisfied_inputs:o,count_craftable:n}}var Gt
function factoryCreateOutputs(e,t,r,a){var i=e.prop,o=e.recipe
var n=t.satisfied_inputs,s=t.count_craftable
pe(s)
Gt=null
var l
var c
var _
var u
for(c=0;c<r;++c){var d=o.output(n,false,i)
var f=findOutputSlot(i,d)
if(-1===f)break
_=f
if(!me.defines.NO_CRAFT_OUTPUT){l=l||U(e)
R(l,i,d,f)
if(!u)u=d.toTransLog()}if(!d.isAllowedInInventory())T().serverLog("crafted_illegal_item",{satisfied_inputs:n,output_actual:d,recipe:{name:o.name,at_factory:o.at_factory}})
Gt={item:d,prop:i,idx:f}
if(me.defines.NO_CRAFT_OUTPUT)return true}if(!c)return false
l.opStat("craft_total",c)
l.opStat("craft:"+u,c)
ft(Gt.item,Ce)
if(o.icon)ft(o.icon.recipe_item,Ce)
var v=o.inputs
for(var h=0;h<v.length;++h){var p=v[h].source
var m=p[0]*c
var g=p[1]
var E=p[2]
var y=i.contents[h]
if(y){if(a)V(y,we+","+h,we+","+_)
if(1===(m=inputScaleCount(m,g,E,y))&&!y.stackable)x(l,i,h)
else b(l,i,h,m)}}return c===r}var Ft
function factoryUpdate(e){var t=e.prop,r=e.recipe
if(!r)return
var a=Ft>=me.frame_index-1
Ft=me.frame_index
if(E.locked(t))return
var i=checkInputs(e)
var o=i.satisfied_inputs,n=i.count_craftable,s=i.output_allowed,l=i.output_preview
var c=t.factory_state
if(c===he||c===ve)if(!n||!l||!s){factoryPause(e)
c=t.factory_state}else{var _=inputsKey(o)
if(!t.factory_input_key)t.factory_input_key=_
if(t.factory_input_key!==_)if(a){factoryStart(e,o)
c=t.factory_state}else t.factory_input_key=_}var u=t.factory_time
if(c===he){if(!r.needs_finish)if(factoryCreateOutputs(e,i,1,a))factoryStart(e,o)}else if(c===ve){var d=me.defines.NO_CRAFT_OUTPUT?1:r.time(o)/Ee.crafting_time_scale
var f=Lt(0,secondsTimeNow()-u-Ut)
var v=wt(f/d)
mt("crafting_"+l.type+"_"+l.id)
ft(r.icon.recipe_item,Ce)
if(v)if(r.needs_finish)factoryStall(e)
else if(!factoryCreateOutputs(e,i,Rt(v,n),a))factoryPause(e)
else if(v===n)factoryPause(e)
else{var h=U(e)
yt(h,t,"ft","factory_time",u+d*v)}}else if(c===fe)if(n&&l&&s)factoryStart(e,o)}function estimateProgress(){var e=this
var t=e.factory_time,r=e.needed_time,a=e.base_count,i=e.count_craftable,o=e.output_preview
var n=Lt(0,secondsTimeNow()-t-Ut)/r
var s=wt(n)
var l=n-s
var c=a+i
var _=a+s*o.count
var u=_<c
c=Rt(c,Se)
if((_=Rt(_,c))===c)l=1
return{ready:_,total:c,partial:l,is_running:u}}function estimateProgressStalled(){var e=this.base_count
return{ready:e,total:e,partial:1}}function factoryGetProgressEstimator(e){var t=e.factory_state
var r=0
var a=e.contents[de]
if(a){r=a.count
if(t===fe)return{base_count:r,output_preview:a,estimateProgress:estimateProgressStalled}}if(t===fe)return null
var i=g(e.item_id)
if(!i)return null
var o=i[e.factory_recipe]
if(!o)return null
var n=checkInputs({prop:e,recipe:o})
var s=n.count_craftable,l=n.satisfied_inputs,c=n.output_preview
if(!s)return null
pe(c)
if(t===he)return{base_count:r+1,output_preview:c,estimateProgress:estimateProgressStalled}
pe.equal(t,ve)
return{factory_time:e.factory_time,needed_time:me.defines.NO_CRAFT_OUTPUT?1:o.time(l)/Ee.crafting_time_scale,base_count:r,count_craftable:s*c.count,output_preview:c,estimateProgress:estimateProgress}}function factoryCraftingInProgress(e){return e.factory_state!==fe||e.contents[de]}function drawZoomed(e,t,r,a,i,o,n,s,l,c,_,u){if(String(_)===String(u))e=0
a=bt.styleAlpha(a,Rt(2*e,1))
r=bt.styleAlpha(r,1-e)
var d=O(1-e,2)
var f=1+d
if(l===bt.ALIGN.HWRAP){var v=s
if(u){var h=[]
var p=0
var m=t.wrapLines(a,c,16,s,u,0,function(e,t,r,a){h.push([e,t*s,r])
p=Lt(p,a)})
var g=m*s
var E=p*f
var y=g*f
var T=i-p*d*.5
var I=o-g*d*.5
for(var S=0;S<h.length;++S){var A=h[S]
var w=A[0]/p
var L=A[1]/g
t.drawSized(a,T+w*E,I+L*y,n+1,s*f,A[2])}v=Lt(v,m*s)}if(_)v=Lt(v,t.drawSizedWrapped(r,i,o,n,c,16,s,_))
return v}else{if(e){var R=i-d*c*.5
var x=o-d*s*.5
t.drawSizedAligned(a,R,x,n+1,s*f,l,c*f,0,u)}if(_)t.drawSizedAligned(r,i,o,n,s,l,c,0,_)
return s}}var Wt=8
var jt=36
var Ht=s(wt(4294967295*xt()))
var zt
var Vt
function factoryAnimateFinished(b,N,C,e){Vt=me.frame_index
var M=[]
var t=te(e)
var r=b.attribs||{}
var a=t.attribs=t.attribs||{}
for(var i in a)if(!r[i])delete a[i]
var o=te(t)
for(var n in r){if(n===F.RARITY)continue
var s=a[n]||0
var l=r[n]||0
pe(s<=l)
while(s<l){++s
M.push(n)}}u(Ht,M)
o.attribs=o.attribs||{}
if(r[F.RARITY]){var c=r[F.RARITY]
o.attribs[F.RARITY]=1;--c
var _=M.length
while(c){M.splice(_,0,F.RARITY);--c
_=At(_/2)}}var D=o
var P=o
var k=0
var B=Infinity
var U=false
function run(e){Vt=me.frame_index
if(!Me(N.contents[C],b)&&!me.defines.NO_CRAFT_OUTPUT){zt=null
return}var t=0
if(!U){if((B+=me.frame_dt)>1e3){B=0
if(k===M.length){U=true
D=P}else{D=te(P)
var r=M[k++]
P.attribs[r]=(P.attribs[r]||0)+1
if(M[k]&&M[k]===F.RARITY){r=M[k++]
P.attribs[r]=(P.attribs[r]||0)+1}P=te(P)}}t=B/1e3}var a=Z.MODAL+5
var i=100
var o=1e3-2*i
var n=1e3-1.5*i
var s=i
var l=i/2
var c=l
var _=ye.button_height
var u={x:s+_,y:l-_e+16,z:a-5,w:o-2*_,h:ye.button_height}
Nt.drawSizedAligned(ot,u.x+8,u.y,u.z+2,2*ye.font_height,bt.ALIGN.HVCENTERFIT,u.w-16,u.h,Ge.LBL_CRAFTING_COMPLETE)
ye.drawHBox(u,ye.sprites.tab,ue)
l+=ye.button_height+Wt
var d=200
var f=2*ye.font_height
var v=36
Y({x:s+(o-d)/2,y:l,z:a+2,w:d,h:d,dynamic_snapshot:true,ignore_no_spin:true,draw_only:true,base_name:"inv_info",shrink:.921},P)
l+=d+8
drawZoomed(t,Nt,ct[D.getRarity()],ct[P.getRarity()],s,l,a,f,bt.ALIGN.HCENTERFIT,o,D.getName(),P.getName())
l+=f+4
var h=.382*o
ye.drawLine(s+o/2-h/2,l,s+o/2+h/2,l,a,1,1,Xe)
l+=4
var p=D.getDesc()
var m=P.getDesc()
for(var g=0;g<p.length;++g)if(p[g]===m[g+1])p.splice(g,0,"")
var E=s+.1*o
var y=.8*o
for(var T=0;T<m.length;++T)l+=drawZoomed(t,bt,at,at,E,l,a,v,bt.ALIGN.HWRAP,y,p[T],m[T])+4
l=c+n-ye.button_height-Wt
var I=Le(b),S=I.can_possibly_equip,A=I.can_equip,w=I.should_equip
var L=S?3:2
var R=(o-(L+1)*Wt)/L
var x=s+Wt
function button(e,t){var r=ye.buttonText({x:x,y:l,z:a,w:R,font_height:jt,text:e,disabled:t,base_name:t||U?void 0:"inv_empty"})
x+=R+Wt
return r}if(button(Ge.BTN_OK)||se())zt=null
var O=false
if(button(Ge.BTN_TAKE,!W(b)||w)){Ne(e,{type:we,idx:C},b,1)
zt=null
O=true}if(S)if(button(Ge.BTN_EQUIP,!A)&&!O){xe(e,{type:we,idx:C})
zt=null}if(!U&&G.click()){U=true
D=P=b}ye.panel({x:s-_e,y:c+ye.button_height-_e,z:a-5,w:o+2*_e,h:n-ye.button_height+2*_e,color:ue})
if(G.click())zt=null
if(zt)ye.menuUp()}zt={prop:N,run:run}}var Yt=100
var qt=320
var Kt=.667*Yt
var Zt=1e3-(2*Yt+k)
var Xt=475
var Qt=Zt
var Jt=610
var $t=.618*(Qt-Yt-Wt)
var er=100
var tr=er
var rr=30
var ar=24
var ir=36
var or=4
var nr=8
var sr=36
var lr=2*Yt
var cr=4
var _r
var ur
function doFactoryUI(){var ae=je()
if(!ae||!ae.isFactory()||!ae.inEditBounds(He)){We()
return Ge.LBL_MISSING_PROP}var e=ye.button_height
var t=Pe()
var r=ke()
var ie=Z.UI
var oe=Ue()===De
var ne=E.locked(ae)
if(ne){ye.drawRect(0-B,e-B,t+B,r,Z.UI+20,Je)
bt.drawSizedAligned(nt,0,e,Z.UI+21,2*ye.font_height,bt.ALIGN.HVCENTERFIT,t,r-e,Ge.FACTORY_REFRESHING_CONTENTS)
return Ge.LBL_REFRESHING_FACTORY}if(ae.inv.is_settlement_locked&&It()){var a=qe(ae.getLocalPos())
if(!a||!a.allowsItem(ae.item_id)){bt.drawSizedAligned(it,0,e,Z.UI+21,2*ye.font_height,bt.ALIGN.HVCENTERFIT,t,r-e,a?Ge.FACTORY_UPGRADE_SETTLEMENT_TO_UNLOCK:Ge.MSG_OUT_OF_SETTLEMENT_ALERT)
return ae.inv.getName({no_material:true})}}var i=getUnlockedRecipesForFactory(ae),M=i[0],f=i[1],v=i[2]
if(!M||h(M)){bt.drawSizedAligned(it,0,e,Z.UI+21,2*ye.font_height,bt.ALIGN.HVCENTERFIT,t,r-e,Ge.FACTORY_NO_RECIPES_AVAILABLE)
return ae.inv.getName({no_material:true})}mt("factory_"+ae.item_id)
if((!ae.factory_recipe||!M[ae.factory_recipe])&&Bt===Pt){var o=Object.keys(M)
if(1===o.length&&!Et()){var n=Fe()
yt(n,ae,"fr","factory_recipe",o[0])
ae.transBusy(n)
Bt=Pt}else Bt=kt}var se=M[ae.factory_recipe]
var le=j({prop:ae,recipe:se})
if(zt)if(zt.prop!==ae||Vt!==me.frame_index-1)zt=null
else{_.setAspectFixed(1e3,1e3)
zt.run(le)
Be()}if(!ne)factoryUpdate(le)
var ce=ae.factory_state
var _e=2*ye.font_height
var ue=me.DEBUG&&false
function doInput(e,t,r,a){var i
if(ue)ye.drawRect(e,t,e+r,t+a,ie,[1,0,0,.25])
var o=e
var n=t
Ct.draw({x:o,y:n,z:ie,w:Kt,h:Kt,frame:gt.INPUT})
if(oe)o+=Kt+Wt
else n+=Kt+Wt
var s=false
if(It())for(var l in M)if(!Ve("w_r_"+l)){s=true
break}var c=o
var _=n
o+=Yt+Wt
if(!oe){n=t
o=e+Kt+Wt}var u=se?se.name:Ge.LBL_NO_RECIPE_SELECTED
var d=Nt.drawSized(ot,o,n,ie,_e,Ge.separateColon(Ge.LBL_RECIPE,""))
var f=o+d+_e
if(se&&se.icon){var v={x:o+d,y:n,z:ie,w:_e,h:_e}
Oe(v,se.icon)
v.img.draw(v)}var h=.75*ye.button_height
var p=e+r-h-Wt
Nt.drawSizedAligned(ot,f,n,ie,_e,bt.ALIGN.HFIT,p-f-4,0,u)
var m=G.click({x:o,y:n,w:p-o,h:_e})
if(null!=(i=se.icon)&&i.recipe_item&&ye.buttonImage({x:p,y:n,z:ie,w:h,h:h,img:gt.sprite,frame:vt(se.icon.recipe_item,Ce)?gt.PINNED:gt.PIN,tooltip:pt(se.icon.recipe_item,Ce)}))ht(se.icon.recipe_item,Ce,dt)
n+=_e+4
ye.drawLine(o,n,o+$t,n,ie,1,1,Xe)
n+=16
if(ye.buttonImage({x:c,y:_,z:ie,img:Ct,frame:Ee.split_factory?gt.CRAFTING:gt.SETTINGS,w:Yt,h:Yt,hook:s?"false":void 0})||m)if(canEject(ae))Bt=kt
else Ke.push(Ge.STATUSMSG_CANNOT_CHANGE_RECIPE_NO_SPACE)
o=e
var g=se.inputs
for(var E=0;E<g.length;++E){var y=g[E]
bt.drawSizedAligned(at,o,n,ie+1,rr,bt.ALIGN.HCENTERFIT,r,0,y.name)
n+=rr
var T=(r-er)/2
var I=y.source
var S=I[0]
var A=I[1]
var w=I[2]
var L=I[3]
if(!I.menu_inv_item){I.menu_inv_item=te({type:A,id:w,count:S,attr1:L})
I.menu_inv_item.show_count=true}var R=I.menu_inv_item
var x=false
var O=false
var b=ae.contents[E]
if(b){x=true
S=inputScaleCount(S,A,w,b)
if(b.count<S)O=true}var N={ctx:le,inv_type:we,ii:E,x:o+T,y:n,z:ie+1,slot_w:er,no_quickbar:true,quick_transfer_cb:Ne,accepts_item_cb:acceptsItemFactory,empty_inv:R,allow_empty_select:true,count_override:b?Ge.$(Ge.FORMAT_FRACTION,b.count||0,S):isInputScaledCount(A,w)?Ge.$(Ge.FORMAT_FRACTION,0,Ge.$(Ge.FORMAT_NUMBER_OR_MORE,S)):Ge.$(Ge.FORMAT_FRACTION,0,S),label_style:st}
if(O)N.colors=rt
if(z(N)&&!ae.contents[E])$({x:N.x+N.slot_w+24,y:0,inv:R,context:Ce,auto_close:true})
if(!x||!N.draw_inv_item){N.frame=gt.QUESTION_MARK
N.z=ie+4
N.color=ye.button_last_color
N.w=N.h=N.slot_w
Ct.draw(N)}var C=void 0
if(N.draw_inv_item&&b)C=b.getName()
else C=R.getName()
bt.drawSizedAligned(_t,o,n+er,ie+1,ar,bt.ALIGN.HCENTERFIT,r,0,C)
n+=tr+ar+16}}function doOutput(e,t,r,a){if(ue)ye.drawRect(e,t,e+r,t+a,ie,[0,1,0,.25])
var i=checkInputs(le)
var o=i.satisfied_inputs,n=i.count_craftable,s=i.output_preview,l=i.output_allowed
var c=[]
var _
var u
var d={z:ie+2,w:lr,h:lr}
var f
var v
var h=ae.contents[de]
var p=false
var m=0
var g=0
if(h){p=true
var E=h
u=E.getName()
if(s&&s.getName()===u){var y
if((null==(y=se.icon)?void 0:y.count)>1)u=Ge.$(Ge.LBL_OUTPUT_MULTIPLE,u,se.icon.count)}Oe(d,E)
f=E.getDesc()
v=255
var T=Ae(h)
if(!T)c.push(Ge.FACTORY_FULL_INVENTORY)
if(n&&l){if(ce===fe&&!ne){factoryStart(le,o)
ce=ae.factory_state}g=(m=h.count)+n*s.count}else if(s&&!n){if(Me(s,E));else if(T)c.push(Ge.FACTORY_CRAFTING_COMPLETE)}else if(s&&n&&!l)if(T)c.push(Ge.FACTORY_CRAFTING_COMPLETE)}else if(s){var I
u=s.getName()
if((null==(I=se.icon)?void 0:I.count)>1)u=Ge.$(Ge.LBL_OUTPUT_MULTIPLE,u,se.icon.count)
d.count_override=0
d.force_show_count=true
g=n*s.count
Oe(d,s)
f=s.getDesc()
v=255
if(n&&l){if(ce===fe&&!ne){factoryStart(le,o)
ce=ae.factory_state}}else if(n&&!l)if(se.needs_finish)_=Ge.ERR_CRAFTING_CANNOT_COMPLETE
else _=Ge.ERR_CRAFTING_STALLED
else _=Ge.ERR_INSUFFICIENT_RESOURCES}else{u=se.unknown_name||se.name
if(se.icon){Oe(d,se.icon)
if(se.icon.count>1)u=Ge.$(Ge.LBL_OUTPUT_MULTIPLE,u,se.icon.count)}else{d.img=Ct
d.frame=gt.QUESTION_MARK}f=[se.desc]
v=1077952767
_=n?Ge.ERR_INVALID_INPUT:Ge.ERR_INSUFFICIENT_RESOURCES}var S=0
var A
var w
var L
var R
var x=true
if(ce===ve){var O=me.defines.NO_CRAFT_OUTPUT?1:se.time(o)/Ee.crafting_time_scale
var b=secondsTimeNow()
var N=Lt(0,b-ae.factory_time)
var C=b-ae.factory_time_high
if(C<2)N=Ie(C/2,C,N)
A=O-N
S=Te(N/O,.004,1)
L=c.length?et:Qe}else if(ce===he&&!_){var M
pe(se.needs_finish)
pe(!c.length)
d.count_override=(null==(M=se.icon)?void 0:M.count)||1
L=c.length?et:Qe
_=Ge.FACTORY_PROGRESS_READY
R=true}else if(ce===he)L=et
else if(!p){pe(_)
L=$e}if(_)w=_
else if(g){g=Rt(Se,g)
m=Rt(m,g)
w=Ge.$(Ge.FORMAT_CRAFTING_PROGRESS,Ge.$(Ge.FORMAT_FRACTION,m,g),Ge.addPercentage((100*S).toFixed(0)))}else w=Ge.addPercentage((100*S).toFixed(0))
if(R)x=false
else if(p&&!S)x=false
var D=t
var P=e
Ct.draw({x:P,y:D,z:ie,w:Kt,h:Kt,frame:gt.OUTPUT})
var k=t+.618*(Jt-2*Wt)
if(oe)ye.drawLine(e,t+Kt+Wt,e,k,ie,1,1,Xe)
var B=r-((P+=Kt+Wt)-e+Wt)
Nt.drawSizedAligned(ot,P,D,ie,_e,bt.ALIGN.HFIT,B,0,u)
D+=_e+4
ye.drawLine(P,D,P+.618*(r-(P-e)),D,ie,1,1,Xe)
D+=4
var U=2*cr+sr
var G=e+r-Wt-P
if(x){D+=Wt
ye.progressBar({x:P,y:D,z:ie+1,w:G,h:U,color:L,progress:S})
bt.drawSizedAligned(lt,P,D,ie+3,sr,bt.ALIGN.HVCENTERFIT,G,U,w)
D+=U+Wt}var F=P+lr+8
var W=e+r-F
var j=D
d.x=P
d.y=D
d.img.draw(d)
if(h)Re(h,d)
else if(s)Re(s,d)
else{var H
if((null==(H=se.icon)?void 0:H.count)>1)Re(se.icon,d)
d.frame=gt.QUESTION_MARK
Ct.draw(d)}d.x+=(d.w-er)/2
d.y+=(d.w-er)/2
d.w=er
be(we+","+de,d)
d=null
D+=8
var z=ye.button_height
var V=t+a-z-Wt
if(!ur)ur=ge({z:ie,background_color:null,auto_hide:true})
var Y={x:F,y:D,w:W,h:V-D}
ur.begin(Y)
W-=ur.barWidth()
for(var q=D=0;q<f.length;++q)D+=bt.drawSizedColorWrapped(at,0,D,ie+1,W,16,ir,v,f[q])+or
if(f.length)D+=nr
if(s&&s.craft_warning&&!h)D+=bt.drawSizedColorWrapped(at,0,D,ie+1,W,16,ir,2151678207,s.craft_warning)+nr
ur.end(D)
D=Y.y+Rt(Y.h,D)
D=Lt(D,j+lr+8)
var K=e+r-P
if(c.length)for(var Z=0;Z<c.length;++Z){if(D+ir>=V&&(R||p))break
D+=bt.drawSizedColorWrapped(at,P,D,ie+1,K,16,ir,2147483903,c[Z])+nr}var X=1
var Q=P
function finishButton(e,t){var r=(G-Wt*(X-1))/X
var a=ye.buttonText({x:Q,y:D,z:ie+1,w:r,h:z,text:e,font_height:jt,disabled:t,colors:t?void 0:tt})
Q+=r+Wt
return a}if(R||p){D=Rt(Lt(k-z,D),V)
if(R){if(finishButton(Ge.BTN_FINISH))if(factoryCreateOutputs(le,i,1,true)){factoryStart(le,o)
factoryAnimateFinished(Gt.item,Gt.prop,Gt.idx,s)}}else if(p){var J=Le(h),$=J.can_possibly_equip,ee=J.can_equip,te=J.should_equip
X=$?2:1
var re=false
mt("available_to_take_"+h.type+"_"+h.id)
if(finishButton(Ge.BTN_TAKE,!Ae(h)||te)){re=true
ft(h,Ce)
if(se.icon)ft(se.icon.recipe_item,Ce)
Ne(le,{type:we,idx:de},h)}if($)if(finishButton(Ge.BTN_EQUIP,!ee)&&!re){ft(h,Ce)
if(se.icon)ft(se.icon.recipe_item,Ce)
xe(le,{type:we,idx:de})}D+=z}}else if(L===Qe&&A>5&&D+sr<t+a)bt.drawSizedAligned(it,P,D,ie+3,sr,bt.ALIGN.HVCENTERFIT,G,U,Ge.FACTORY_CRAFTING_IN_PROGRESS)}function doOutputInventory(e,t,r,a){if(ue)ye.drawRect(e,t,e+r,t+a,ie,[0,1,1,.25])
if(!oe)e-=Kt+Wt
var i=Dt
for(var o=de+Mt;o<ae.contents.length;++o)if(ae.contents[o]){i=true
break}if(i)Ct.draw({x:e,y:t,z:ie,w:Kt,h:Kt,frame:gt.CONTAINER})
H({ctx:le,inv_type:we,start_idx:de+Mt,no_quickbar:true,final:false,sortable:false,x0:e+Kt+Wt,y:t,z:ie,scale:1,quick_transfer_cb:quickTransferFactoryThenContainer,accepts_item_cb:acceptsItemFactory,skip_empty:!Dt})}function doInventory(e,t,r,a){if(ue)ye.drawRect(e,t,e+r,t+a,ie,[0,0,1,.25])
Ct.draw({x:e,y:t,z:ie,w:Kt,h:Kt,frame:gt.INVENTORY})
var i=e+Kt+Wt
ye.drawLine(i,t,i+.618*(e+r-i),t,ie,1,1,Xe)
H({ctx:le,inv_type:P,no_quickbar:true,final:true,no_buttons:true,sortable:true,x0:i,y:t+Wt,z:ie,scale:1,quick_transfer_cb:quickTransferFactory,quick_transfer_label:Ge.TLTP_ADD_TO_RECIPE,quick_transfer_label_one:Ge.TLTP_ENOUGH_FOR_ONE,accepts_item_cb:acceptsItemFactory})}function doRecipeList(e,t,r,a){if(ye.buttonText({x:e,y:t,z:ie,text:"←",font_height:.75*Yt,w:Yt,h:Yt,disabled:!ae.factory_recipe})||ae.factory_recipe&&G.keyDownEdge(G.KEYS.BACKSPACE)){q(le)
Bt=Pt}var i=e+Yt+Wt
var o=t
Nt.drawSizedAligned(ot,i,o,ie,_e,bt.ALIGN.HFIT,r-(i-e+Wt),0,Ge.separateColon(ae.inv.getName({no_material:true}),Ge.LBL_SELECT_RECIPE))
o+=_e+4
ye.drawLine(i,o,i+$t,o,ie,1,1,Xe)
o+=4
if(!_r)_r=ge({z:Z.UI,background_color:null,auto_hide:true})
var n=e+1e3-i-qt-Wt-24
if(oe&&!me.DEBUG)n+=600
var s={x:i,y:o,w:r-i,h:a-o}
_r.begin(s)
function drawRecipe(e,t){var r=i
var a={x:r,y:o,z:ie,font_height:sr,w:qt,h:ye.button_height,text:e.name,tooltip:null,hook:t&&It()&&"w_r_"+t,disabled:!t}
if(e.icon){Oe(a,e.icon)
if(e.icon.count>1)Re(e.icon,a)}if(ye.button(a)){if(ae.factory_recipe!==t)if(canEject(ae))setRecipe(le,t)
else Ke.push(Ge.STATUSMSG_CANNOT_CHANGE_RECIPE_NO_SPACE)
q(le)
Bt=Pt}r+=qt+Wt
bt.drawSizedAligned(t?it:_t,r,o,ie,sr,bt.ALIGN.VCENTER|bt.ALIGN.HFIT,n,ye.button_height,t?e.desc:Ge.RECIPELIST_UPGRADE_SETTLEMENT_TO_UNLOCK)
o+=ye.button_height+4}var l=o=i=0
for(var c in M){++l
drawRecipe(M[c],c)}var _=0
for(var u in v){++_
drawRecipe(v[u],null)}if(It()){o+=.75*ye.button_height
if(f){bt.drawSizedAligned(_t,i,o,ie,sr,bt.ALIGN.HCENTERFIT,s.w-s.x,0,h(v)?Ge.RECIPELIST_UNLOCK_MORE_BY_UPGRADING:Ge.RECIPELIST_EVEN_MORE_FROM_LATER_UPGRADES)
o+=sr+4}var d=l+_+f
bt.drawSizedAligned(it,i,o,ie,sr,bt.ALIGN.HCENTERFIT,s.w-s.x,0,l===d?Ge.RECIPELIST_ALL_UNLOCKED_FOR_STATION:Ge.RECIPELIST_AMOUNT_UNLOCKED.$({val:l,total:d}))
o+=sr+4
o+=.75*ye.button_height}_r.end(o)
o=s.y+s.h}if(Bt===Pt){Ye("w_r_"+ae.factory_recipe)
if(oe){doInput(0,e,Qt,Jt)
doOutput(Qt,e,Zt,Xt)
doOutputInventory(Qt,e+Xt,Zt,Jt-Xt)
var s=e+Jt
doInventory(0,s,t,r-s)}else{doInput(0,e,Qt,Jt)
var l=e+Jt
doOutput(0,l,Zt,Xt)
doOutputInventory(Zt,l,t-Zt,Xt)
var c=l+Xt
doInventory(0,c,t,r-c)}}else if(Bt===kt)doRecipeList(0,e,t,r)
if(le.trans){factoryUpdate(le)
le.trans.silent_error=true
le.trans.onComplete(function(e){if(e)Ut+=.5
else Ut=0})}J()
return ae.inv.getName({no_material:true})}},{"../common/globals":197,"../common/ids":198,"../common/materials_common":201,"../glov/client/camera2d":241,"../glov/client/cmds":244,"../glov/client/engine":250,"../glov/client/input":271,"../glov/client/net":279,"../glov/client/scroll_area":289,"../glov/client/settings":291,"../glov/client/ui":306,"../glov/client/walltime":308,"../glov/common/rand_alea":327,"../glov/common/util":330,"./build_mode":27,"./crafting":57,"./crafting_mods":58,"./crafting_recipes":59,"./inventory":94,"./inventory_ui":95,"./item_info_view":97,"./items":98,"./layout":99,"./localization/localization":108,"./main":112,"./materials":114,"./menu":117,"./props":141,"./red_dot":146,"./settlement":148,"./status":156,"./styles":160,"./todo_list":165,"./tutorial":166,"./ui_util":168,"./user_data":170,"./voxel_data":175,"./world_metadata":186,assert:void 0}],80:[function(e,t,r){"use strict"
r.fbShareWorldLink=fbShareWorldLink
r.fbShareWorld=fbShareWorld
r.fbPostPassiveToContext=fbPostPassiveToContext
r.fbInviteAsync=fbInviteAsync
r.fbInviteCreateAsync=fbInviteCreateAsync
r.fbShareBlueprintLink=fbShareBlueprintLink
r.fbShareBlueprint=fbShareBlueprint
r.fbSharePhoto=fbSharePhoto
r.fbSharePhotoLink=fbSharePhotoLink
r.fbRegisterScreenshotProvider=fbRegisterScreenshotProvider
r.fbCreateRaceTournament=fbCreateRaceTournament
r.fbPostSessionScoreAsync=fbPostSessionScoreAsync
r.fbLeaveWorldsTournament=fbLeaveWorldsTournament
r.fbFollowOfficialPage=fbFollowOfficialPage
r.fbJoinOfficialGroup=fbJoinOfficialGroup
r.fbGetABSplitGroup=fbGetABSplitGroup
r.fbWorldsInit=fbWorldsInit
var a=e("assert")
var o=e("../glov/client/environments").getExternalTextureURL
var s=e("../glov/client/fbinstant.js")
var l=e("../glov/client/localization.js").getStringFromLocalizable
var n=e("../glov/client/net.js").netSubs
var i=e("../glov/client/settings.js")
var c=e("../glov/client/social.js").getExternalUserInfos
var _=e("../glov/client/ui.js")
var u=e("../glov/client/urlhash.js")
var d=e("../glov/common/enums.js").ID_PROVIDER_FB_INSTANT
var f=e("../glov/common/rand_alea.js").mashString
var v=e("../glov/common/util.js")
var h=v.merge
var p=v.nop
var m=v.once
var g=e("../common/waygate_common.js").waygateImagePath
var E=e("./analytics.js")
var y=E.analyticsAddFieldFunction
var T=E.logEvent
var I=e("./blueprint.js").blueprintGetDef
var S=e("./file_management.js").getCanvasFromURL
var A=e("./localization/localization").L
var w=e("./main_menu.js").getWorldInfoAsync
var L=e("./photo_mode.js")
var R=L.DEFAULT_JPEG_QUALITY
var x=L.provideGlobalScreenshot
function loadWorldImage(e,t,r){var a=g(e,"full",t)
var i=true
function onImageLoad(e,t){if(e)if(i){i=false
S(g(null,"full"),onImageLoad)}else return void r(A.ERR_LOAD_WORLD_IMAGE)
else return void r(void 0,t)}S(o(a),onImageLoad)}function clearModalDialogAfter(e){var t=e.success_cb,r=e.failure_cb
t=t?m(t):p
r=r?m(r):p
e.promise.then(function(){t()
_.modalDialogClear()},function(){r()
_.modalDialogClear()})}function wrapModalDialog(e,t){_.modalDialog(e)
clearModalDialogAfter(t)}function fbShareWorldLink(a,i){T("share_link_fb",1,"show",String(a),{wgid:i})
_.modalDialog({title:A.DLG_SHARING_WORLD_TITLE,text:A.MSG_PLEASE_WAIT})
w(a,function(e,r){if(e){console.error(e)
_.modalDialogClear()}else loadWorldImage(r,i,function(e,t){if(e)return void _.modalDialogClear()
clearModalDialogAfter({promise:FBInstant.shareLinkAsync({data:{querystring:{w:a,wg:i}},image:t.toDataURL("image/jpeg",.92),text:l(A.$(A.FBINSTANT_SHARE_WORLD,r.name))}),success_cb:function success_cb(){T("share_link_fb",1,"succ",String(a),{wgid:i})}})})})}function fbShareWorld(a,i){T("share_world_fb",1,"show",String(a),{wgid:i})
_.modalDialog({title:A.DLG_SHARING_WORLD_TITLE,text:A.MSG_PLEASE_WAIT})
w(a,function(e,r){if(e){console.error(e)
_.modalDialogClear()}else loadWorldImage(r,i,function(e,t){if(e)return void _.modalDialogClear()
clearModalDialogAfter({promise:FBInstant.shareAsync({data:{querystring:{w:a,wg:i,referrer:n().getUserId()}},image:t.toDataURL("image/jpeg",.92),text:l(A.$(A.FBINSTANT_SHARE_WORLD,r.name))}),success_cb:function success_cb(){T("share_world_fb",1,"succ",String(a),{wgid:i})
T("referral_message_sent",1)}})})})}function fbShareCurrentWorldToChannel(a,i,o){var n=u.get("w")
var s=u.get("wg")||"default"
w(n,function(e,r){if(e){console.error(e)
if(o)return void o()}else loadWorldImage(r,s,function(e,t){if(e)if(o)return void o()
else return
FBInstant.updateAsync({action:"CUSTOM",cta:l(A.$(A.DLG_SHARE_WORLD_CURRENT_JOIN,FBInstant.player.getName())),image:t.toDataURL(),text:[l(A.$(A.DLG_SHARE_WORLD_FRIEND_INVITING_MSG,FBInstant.player.getName(),r.name)),l(A.$(A.DLG_SHARE_WORLD_FRIEND_JUST_PLAYED_MSG,FBInstant.player.getName(),r.name))][a],strategy:i||"IMMEDIATE",notification:"PUSH",template:"join_multiplayer_game",data:{querystring:{w:n,wg:s}}}).then(function(){console.log("Success")},function(e){console.error("Failure to save instant share image > "+e.message,e)})})})}function fbPostPassiveToContext(){fbShareCurrentWorldToChannel(1,"LAST")}function updateSessionData(e){if("object"!==typeof e||null===e){console.warn("[FBInstant] data provided to updateSessionData is null or not an object but "+typeof e)
return false}if(window.FBInstant&&window.FBInstant.setSessionData)FBInstant.setSessionData(e)
else{console.warn("[FBInstant] setSessionData not called as function was not available")
return false}return true}function fbInviteAsync(e,t){if(!window.FBInstant)return
updateSessionData({contextSwitch:true})
var a=u.get("w")
var i=u.get("wg")||"default"
T("fbInviteAsync",1,"show")
_.modalDialog({title:A.DLG_INVITING_TITLE,text:A.MSG_PLEASE_WAIT})
w(e,function(e,r){if(e){console.error(e)
_.modalDialogClear()}else loadWorldImage(r,void 0,function(e,t){if(e){console.error(e)
return void _.modalDialogClear()}else clearModalDialogAfter({promise:FBInstant.inviteAsync({text:l(A.$(A.DLG_SHARE_WORLD_FRIEND_INVITING_MSG,FBInstant.player.getName(),r.name)),image:t.toDataURL("image/jpeg",.92),data:{querystring:{w:a,wg:i,referrer:n().getUserId()}}}),success_cb:function success_cb(){T("fbInviteAsync",1,"succ")
T("referral_message_sent",1)}})})})}function fbInviteCreateAsync(e){var t
if(!window.FBInstant)return
var r=null==(t=c(e))?void 0:t[d]
if(!r)return
updateSessionData({contextSwitch:true})
T("fbInviteCreateAsync",1,"show")
wrapModalDialog({title:A.DLG_INVITING_TITLE,text:A.MSG_PLEASE_WAIT},{promise:FBInstant.context.createAsync(r.external_id),success_cb:function success_cb(){T("fbInviteCreateAsync",1,"succ")
fbShareCurrentWorldToChannel(0)
console.warn("Successfully changed context")
updateSessionData({contextSwitch:false})},failure_cb:function failure_cb(){updateSessionData({contextSwitch:false})}})}function getDefaultBlueprintImage(){return"img/placeholder_blueprint.png"}function getBlueprintImage(e){return e.img_url||getDefaultBlueprintImage()}function loadBlueprintImage(r,a){var e=getBlueprintImage(r)
var i=true
function onImageLoad(e,t){if(e)if(i){i=false
S(getDefaultBlueprintImage(r),onImageLoad)}else return void a(A.ERR_LOAD_BLUEPRINT_IMAGE)
else return void a(void 0,t)}S(o(e),onImageLoad)}function fbShareBlueprintLink(r){_.modalDialog({title:A.DLG_SHARING_BLUEPRINT_TITLE,text:A.MSG_PLEASE_WAIT})
var a=I(r)
loadBlueprintImage(a,function(e,t){if(e)return void _.modalDialogClear()
clearModalDialogAfter({promise:FBInstant.shareLinkAsync({data:{querystring:{blueprint:r}},image:t.toDataURL("image/jpeg",.92),text:l(A.$(A.DLG_SHARE_BLUEPRINT_MSG,a.name))})})})}function fbShareBlueprint(r){_.modalDialog({title:A.DLG_SHARING_BLUEPRINT_TITLE,text:A.MSG_PLEASE_WAIT})
var a=I(r)
loadBlueprintImage(a,function(e,t){if(e)return void _.modalDialogClear()
clearModalDialogAfter({promise:FBInstant.shareAsync({data:{querystring:{blueprint:r}},image:t.toDataURL("image/jpeg",.92),text:l(A.$(A.DLG_SHARE_BLUEPRINT_MSG,a.name))})})})}function fbSharePhoto(r,e){_.modalDialog({title:A.DLG_SHARING_PHOTO_TITLE,text:A.MSG_PLEASE_WAIT})
S(e,function(e,t){if(e)return void _.modalDialog({title:A.DLG_ERROR_GETTING_PHOTO_TITLE,text:String(e),buttons:{OK:null}})
clearModalDialogAfter({promise:FBInstant.shareAsync({data:{querystring:{photo:r}},image:t.toDataURL("image/jpeg",.92),text:l(A.FBINSTANT_SHARE_PHOTO)})})})}function fbSharePhotoLink(r,e){_.modalDialog({title:A.DLG_SHARING_PHOTO_TITLE,text:A.MSG_PLEASE_WAIT})
S(e,function(e,t){if(e)return void _.modalDialog({title:A.DLG_ERROR_GETTING_PHOTO_TITLE,text:String(e),buttons:{OK:null}})
clearModalDialogAfter({promise:FBInstant.shareLinkAsync({data:{querystring:{photo:r}},image:t.toDataURL("image/jpeg",.92),text:l(A.FBINSTANT_SHARE_PHOTO)})})})}function fbRegisterScreenshotProvider(){s.onready(function(){FBInstant.registerScreenshotProvider(function(a){if(!_.isMenuUp())x(function(e,t){var r=e.toDataURL("image/jpeg",R)
a({image:r,data:{context:t},text:l(A.FBINSTANT_TAKE_SCREENSHOT)})})})})}function fbCreateWorldsTournament(a,i,o,n){function errorCreatingTournament(e){_.modalDialog({title:A.DLG_ERROR_TOURNAMENT_CREATING_TITLE,text:e,buttons:{OK:null}})}_.modalDialog({title:A.DLG_TOURNAMENT_CREATING_TITLE,text:A.MSG_PLEASE_WAIT})
w(a,function(e,t){if(e){console.error(e)
return void errorCreatingTournament(e)}loadWorldImage(t,null,function(e,t){var r={}
if(e)console.error(e)
else r.image=t.toDataURL("image/jpeg",.92)
s.fbCreateTournament({initialScore:i,data:h({querystring:{w:a}},n),config:h(r,o)},_.modalDialogClear,function(e){if("USER_INPUT"===e.code)_.modalDialogClear()
else{console.error(e)
errorCreatingTournament(e.code)}})})})}function fbCreateRaceTournament(e,t,r){fbCreateWorldsTournament(e,t,{title:r.buzzer_id,sortOrder:"LOWER_IS_BETTER",scoreFormat:"TIME"},{world_id:e,buzzer_id:r.buzzer_id,chunk_id:r.chunk_id,pos_idx:r.pos_idx})}function fbPostSessionScoreAsync(e){_.modalDialog({title:A.DLG_TOURNAMENT_SUBMITTING_TITLE,text:A.MSG_PLEASE_WAIT})
FBInstant.postSessionScoreAsync(e).then(_.modalDialogClear,function(e){console.error(e)
_.modalDialog({title:A.DLG_ERROR_TOURNAMENT_SUBMITTING_TITLE,text:e.code,buttons:{OK:null}})})}function fbLeaveWorldsTournament(e){var t=e?m(e):p
_.modalDialog({title:A.DLG_TOURNAMENT_LEAVING_TITLE,text:A.MSG_PLEASE_WAIT})
s.fbLeaveTournament(function(){_.modalDialogClear()
t()},function(e){_.modalDialog({title:A.DLG_ERROR_TOURNAMENT_LEAVING_TITLE,text:e.code,buttons:{OK:null}})})}function fbFollowOfficialPage(){wrapModalDialog({title:A.DLG_OFFICIAL_PAGE_TITLE,text:A.MSG_PLEASE_WAIT},{promise:FBInstant.community.followOfficialPageAsync()})}function fbJoinOfficialGroup(){wrapModalDialog({title:A.DLG_OFFICIAL_GROUP_TITLE,text:A.MSG_PLEASE_WAIT},{promise:FBInstant.community.joinOfficialGroupAsync()})}function fbGetABSplitGroup(e,t){var r=f(e+":"+FBInstant.player.getID())
FBInstant.logEvent("ab_"+e+"_"+t[r%t.length])
return t[r%t.length]}function handleEntryPointAsync(e){var r={}
r.facebook_context_type=(FBInstant.context.getType()||"unspecified").toLowerCase()
r.facebook_player_id=FBInstant.player.getID()
var t=FBInstant.getEntryPointData()||{}
r.facebook_referral_player_id=t.previous_player_id
r.utm_source=t.utm_source||(t.fb_instant_game_ad_id?"instant":null)
r.utm_medium=t.utm_medium||(t.fb_instant_game_ad_id?"paid":null)
r.utm_campaign=t.utm_campaign||(t.fb_instant_game_ad_id?t.fb_instant_game_ad_id:null)
if(t.utm){var a=t.utm||{}
r.utm_string=[a.utm_source||"none",a.utm_medium||"none",a.utm_campaign||"none"].join("_")
r.utm_source=a.utm_source
r.utm_medium=a.utm_medium
r.utm_campaign=a.utm_campaign}r.facebook_campaign=t
r.facebook_entrypoint=e
y("fb_entry_point",function(e){for(var t in r)e[t]=r[t]})
T("entry_point")}function fbWorldsInit(){if(window.FBInstant){fbRegisterScreenshotProvider()
s.onready(function(){switch(fbGetABSplitGroup("camera_view",["1st","3rd"])){case"1st":i.runTimeDefault("camera_view",0)
break
case"3rd":i.runTimeDefault("camera_view",1)
break
default:a(false)}if(window.FBInstant.getEntryPointAsync)window.FBInstant.getEntryPointAsync().then(function(e){handleEntryPointAsync(e)})})}}},{"../common/waygate_common.js":210,"../glov/client/environments":254,"../glov/client/fbinstant.js":257,"../glov/client/localization.js":275,"../glov/client/net.js":279,"../glov/client/settings.js":291,"../glov/client/social.js":296,"../glov/client/ui.js":306,"../glov/client/urlhash.js":307,"../glov/common/enums.js":321,"../glov/common/rand_alea.js":327,"../glov/common/util.js":330,"./analytics.js":5,"./blueprint.js":24,"./file_management.js":82,"./localization/localization":108,"./main_menu.js":113,"./photo_mode.js":128,assert:void 0}],81:[function(e,t,r){"use strict"
r.feedbackShow=feedbackShow
var a=e("../glov/client/client_config")
var i=a.PLATFORM_FBINSTANT
var o=a.PLATFORM_YANDEX
var n=e("../glov/client/engine")
var s=e("../glov/client/net").netClient
var l=e("./localization/localization").L
var c=e("./main_menu").URL_DISCORD
var _=e("./status")
var u=document.getElementById("debug")
var d=document.getElementById("feedback")
var f=document.getElementById("feedbacklabel")
var v=document.getElementById("feedbacktext")
var h=document.getElementById("feedbackfrm")
var p=document.getElementById("feedbacksubmit")
var m=document.getElementById("feedbackcancel")
var g=document.getElementById("feedbackcancel2")
var E=document.getElementById("feedbackdescription")
function feedbackHide(){d.style.display="none"
n.disableRender(false)}function feedbackShow(){f.innerText=l.addColon(l.LBL_FEEDBACK_TEXT).toLocalString()
p.value=l.BTN_SUBMIT.toLocalString()
m.value=l.BTN_CANCEL.toLocalString()
E.innerHTML="<ul><li>"+l.FEEDBACK_DESC_GENERIC+"</li><li>"+l.FEEDBACK_DESC_ACCOUNT_DELETE.$({text:"PLEASE DELETE MY ACCOUNT"})+"</li><li>"+(i?l.FEEDBACK_DESC_FACEBOOK:o?l.FEEDBACK_DESC_YANDEX:l.$(l.FEEDBACK_DESC_DISCORD,'<a target="_blank" href="'+c+'" class="noglov">'+c+"</a>"))+"</li></ul>"
d.style.display="block"
v.focus()
n.disableRender(true)
if(u){var e=u.innerText
if(e){window.debugmsg("",true)
v.value=l.FEEDBACK_ERROR_WHAT_CAUSED+"\n\n"+l.addColon(l.LBL_ERROR_DETAILS)+"\n"+e}}var r=false
function feedbackOnsubmit(e){if(e)e.preventDefault()
var t=(v.value||"").trim()
if(t&&!r)if(!s().connected)_.push(l.STATUSMSG_FEEDBACK_SUBMIT_ERROR)
else s().send("feedback",{feedback:t},function(e){if(e)_.push(l.STATUSMSG_FEEDBACK_SUBMIT_ERROR)
else{v.value=""
_.push(l.STATUSMSG_FEEDBACK_SUBMITTED)}})
r=true
feedbackHide()
return false}h.onsubmit=feedbackOnsubmit
p.onclick=feedbackOnsubmit
m.onclick=feedbackHide
g.onclick=feedbackHide}},{"../glov/client/client_config":243,"../glov/client/engine":250,"../glov/client/net":279,"./localization/localization":108,"./main_menu":113,"./status":156}],82:[function(e,t,r){"use strict"
r.uploadInProgress=uploadInProgress
r.upload=upload
r.imageToBinary=imageToBinary
r.uploadImageSet=uploadImageSet
r.getCanvasFromURL=getCanvasFromURL
var s=e("./localization/localization").L
var i=e("assert")
var a=e("glov-async").asyncSeries
var o=e("../glov/common/base64.js").base64Decode
var n=e("../glov/common/chunked_send.js").chunkedSend
var l=e("./main.js").blockImageUpload
var c=e("../glov/client/net.js")
var _=e("../glov/client/urlhash.js")
var u=false
function uploadInProgress(){return u}var d=3
function upload(e,r){var t=e.u8,a=e.mime_type
i(!uploadInProgress(),"Upload already in progress")
u=true
n({client:c.client,buffer:t,mime_type:a,max_in_flight:d},function(e,t){u=false
r(e,t)})}var f=/^data:(image\/[^;]+);base64,/
function imageToBinary(e){var t=e.match(f)
if(!t)return{err:s.$(s.ERR_INVALID_DATA_HEADER,e.slice(0,30))}
var r=t[1]
var a=e.slice(t[0].length)
var i=o(a,function(e){return{u8:new Uint8Array(e)}})
i.mime_type=r
return i}function uploadImageSet(i,e,t){if(e&&l())return void t(s.ERR_CUSTOM_TEXTURES_NOT_ALLOWED)
var r=[]
var o={}
var n
Object.keys(i).forEach(function(a){var e=imageToBinary(i[a].data)
if(e.err){n=e.err
return}r.push(function(r){upload(e,function(e,t){o[a]={id:t,w:i[a].w,h:i[a].h}
r(e)})})})
if(n)return void t(n)
a(r,function(e){t(e,o)})}function getCanvasFromURL(e,t){var r=new Image
r.setAttribute("crossOrigin","anonymous")
r.onload=function(){var e=document.createElement("canvas")
e.width=this.width
e.height=this.height
e.getContext("2d").drawImage(this,0,0)
t(void 0,e)}
r.onerror=function(e){console.warn(e)
t(e,void 0)}
if(!e.match(/^.{2,7}:/))e=""+_.getURLBase()+e
r.src=e}},{"../glov/client/net.js":279,"../glov/client/urlhash.js":307,"../glov/common/base64.js":315,"../glov/common/chunked_send.js":316,"./localization/localization":108,"./main.js":112,assert:void 0,"glov-async":void 0}],83:[function(e,t,r){"use strict"
r.createFixedOctree=createFixedOctree
var c=e("assert")
var n=16
function FixedOctreeNode(){this.split=false
this.children=[]
this.num_children=0}var I=new Int32Array(3)
function nodeSplit(e,t){var r=e.children,a=e.num_children
e.split=true
e.children=new Array(8)
for(var i=e.num_children=0;i<a;++i){var o=r[i]
var n=0
if(o.pos[0]>=I[0])n+=1
if(o.pos[1]>=I[1])n+=2
if(o.pos[2]>=I[2])n+=4
var s=e.children[n]
if(!s){s=e.children[n]=new FixedOctreeNode;++e.num_children}s.children[s.num_children++]=o}}function nodeAdd(e,t,r){if(e.split){var a=0
var i=t>>1
if(r.pos[0]>=I[0]){I[0]+=i
a+=1}else I[0]-=i
if(r.pos[1]>=I[1]){a+=2
I[1]+=i}else I[1]-=i
if(r.pos[2]>=I[2]){a+=4
I[2]+=i}else I[2]-=i
var o=e.children[a]
if(!o){o=e.children[a]=new FixedOctreeNode;++e.num_children}nodeAdd(o,i,r)}else{e.children[e.num_children++]=r
if(e.num_children>n)nodeSplit(e,t)}}function nodeRemove(e,t,r){var a=e.children
if(e.split){var i=0
var o=t>>1
if(r.pos[0]>=I[0]){I[0]+=o
i+=1}else I[0]-=o
if(r.pos[1]>=I[1]){i+=2
I[1]+=o}else I[1]-=o
if(r.pos[2]>=I[2]){i+=4
I[2]+=o}else I[2]-=o
if(nodeRemove(e.children[i],o,r)){e.children[i]=null
if(!--e.num_children)return true}}else{var n=-1
var s=e.num_children
for(var l=0;l<s;++l)if(r===a[l]){n=l
break}c(-1!==n)
if(n!==--s)a[n]=a[s]
delete a[s]
if(!(e.num_children=s))return true}return false}function FixedOctree(e){this.count=0
var t=this.r=e.size>>1
this.center=new Int32Array([e.pos[0]+t,e.pos[1]+t,e.pos[2]+t])
FixedOctreeNode.call(this)}FixedOctree.prototype.add=function(e){++this.count
I[0]=this.center[0]
I[1]=this.center[1]
I[2]=this.center[2]
nodeAdd(this,this.r,e)}
FixedOctree.prototype.remove=function(e){--this.count
I[0]=this.center[0]
I[1]=this.center[1]
I[2]=this.center[2]
nodeRemove(this,this.r,e)}
FixedOctree.prototype.clear=function(){}
FixedOctree.prototype.getNumLeaves=function(){return this.count}
var S
var A
function getAllNodes(e){var t=e.children
if(e.split){for(var r=0;r<8;++r)if(t[r])getAllNodes(t[r])}else{var a=e.num_children
for(var i=0;i<a;++i)A[S++]=t[i]}}var w=Math.sqrt(3)
var L=.5*w
function getVisibleNodes2(e,t,r){var a=r.length
var i,o
var n,s,l,c
if(e.num_children>(e.split?1:2)){s=I[n=0]
l=I[1]
c=I[2]
var _=t*w
var u=true
var d=true
do{if((o=(i=r[n])[0]*s+i[1]*l+i[2]*c)<i[3]-_){u=false
break}if(d)if(o<i[3]+_)d=false
n++}while(n<a)
if(!u)return
if(d){getAllNodes(e)
return}}var f=e.children
if(e.split){var v=t>>1
s=I[0]
l=I[1]
c=I[2]
for(var h=0;h<8;++h){var p=f[h]
if(p){I[0]=1&h?s+v:s-v
I[1]=2&h?l+v:l-v
I[2]=4&h?c+v:c-v
getVisibleNodes2(p,v,r)}}}else{var m=e.num_children
var g,E
for(var y=0;y<m;++y){s=(g=(E=f[y]).pos)[0]+.5
l=g[1]+.5
c=g[2]+.5
var T=true
n=0
do{if((o=(i=r[n])[0]*s+i[1]*l+i[2]*c)<i[3]-L){T=false
break}n++}while(n<a)
if(T)A[S++]=E}}}FixedOctree.prototype.getVisibleNodes=function(e,t,r){if(!this.count)return r
A=t
S=r
I[0]=this.center[0]
I[1]=this.center[1]
I[2]=this.center[2]
getVisibleNodes2(this,this.r,e)
return S}
function createFixedOctree(e){return new FixedOctree(e)}},{assert:void 0}],84:[function(e,t,r){"use strict"
r.drawFloaterSimple=drawFloaterSimple
r.drawFloaterStack=drawFloaterStack
r.PanelledTextFloater=r.PanelFloater=r.ProgressBarFloater=r.SpriteFloater=r.GraphicalFloater=r.TextFloater=r.CompoundFloater=r.DEF_COMP_FLT_SCALE=r.DEF_FLT_SCALE=void 0
function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype)
_setPrototypeOf(e.prototype.constructor=e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){e.__proto__=t
return e})(e,t)}var p=e("assert")
var m=e("../glov/client/camera2d.js")
var g=e("../glov/client/engine.js")
var i=e("../glov/client/font.js")
var s=e("../glov/client/ui.js")
var a=e("../glov/common/util.js")
var E=a.clamp
var l=a.merge
var o=e("../glov/common/vmath.js")
var A=o.v2copy
var y=o.v3copy
var T=o.v3distSq
var n=o.v3dot
var I=o.v3perspectiveProject
var c=o.v3sub
var _=o.v4copy
var u=o.vec2
var d=o.vec3
var f=o.vec4
var w=o.zero_vec
var v=e("./camera.js")
var S=v.getActiveController
var h=v.getCurrentViewMatrix
var L=e("./photo_mode.js").photoModeActive
var R=e("./styles.js")
var x=R.color_white
var O=R.floater_style_default
var b=e("../glov/client/input.js")
var N=Math.abs,C=Math.max,M=Math.min,D=Math.sqrt
var P=.333
r.DEF_FLT_SCALE=P
var k=.125
r.DEF_COMP_FLT_SCALE=k
var B=function(){function Floater(e){this.w=void 0
this.h=void 0
this.interact_dist=void 0
this.handleInteract=void 0
this.w=(e=e||{}).w||0
this.h=e.h||0
if(this.interact){this.interact_dist=this.interact_dist||-1
this.handleInteract=handleFloaterInteraction}}var e=Floater.prototype
e.getW=function getW(){return this.w}
e.getH=function getH(){return this.h}
e.setInteractDist=function setInteractDist(e){this.interact_dist=e}
return Floater}();(function(i){_inheritsLoose(InteractableFloater,i)
function InteractableFloater(){var e
for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];(e=i.call.apply(i,[this].concat(r))||this).interact=void 0
e.interact_dist=void 0
e.handleInteract=void 0
return e}})(B)
function isInteractableFloater(e){return Boolean(e.interact)}var U=4
var G=4
var F=f(1,1,1,.5)
function floaterInteraction(e,t){var r=e.x,a=e.y,i=e.w,o=e.h
var n={x:r-U,y:a-U,w:i+2*U,h:o+2*G,z:Z.FLOATER_INTERACT,button:0,color:F,allow_pointerlock:true}
if(b.click(n))t.interact({x:r,y:a,w:i,h:o})
else if(b.mouseOver(l(n,{peek_touch:true})))s.drawRect2(n)}function handleFloaterInteraction(e,t,r,a){if(isInteractableFloater(e))if(-1===e.interact_dist||r<e.interact_dist)floaterInteraction(t,e)}var W=1e-4
var j=function(_){_inheritsLoose(CompoundFloater,_)
function CompoundFloater(e,t){var r;(r=_.call(this,t=t||{})||this).fp_pairs=void 0
var a=Infinity
var i=Infinity
for(var o in r.fp_pairs=e){p(e[o].rel_pos.x>=0)
p(e[o].rel_pos.y>=0)
p(e[o].rel_pos.z>=0)
if(e[o].rel_pos.x<a)a=e[o].rel_pos.x
if(e[o].rel_pos.y<i)i=e[o].rel_pos.y}for(var n in e){var s=e[n],l=s.rel_pos,c=s.floater
if(l.x-a+c.getW()>r.w)r.w=l.x-a+c.getW()
if(l.y-i+c.getH()>r.h)r.h=l.y-i+c.getH()}if(!r.interact)r.handleInteract=handleCompoundFloaterInteraction
return r}var e=CompoundFloater.prototype
e.getFPPairs=function getFPPairs(){return this.fp_pairs}
e.draw=function draw(e){var t=e.x,r=e.y,a=e.z,i=e.scale
for(var o in this.fp_pairs)this.fp_pairs[o].floater.draw({x:t+this.fp_pairs[o].rel_pos.x*i,y:r+this.fp_pairs[o].rel_pos.y*i,z:a+this.fp_pairs[o].rel_pos.z*W,scale:i})}
e.updateAlpha=function updateAlpha(e){for(var t in this.fp_pairs)this.fp_pairs[t].floater.updateAlpha(e)}
e.updateSize=function updateSize(){var e=0
var t=0
var r=Infinity
var a=Infinity
for(var i in this.fp_pairs){if(this.fp_pairs[i].rel_pos.x<r)r=this.fp_pairs[i].rel_pos.x
if(this.fp_pairs[i].rel_pos.y<a)a=this.fp_pairs[i].rel_pos.y}for(var o in this.fp_pairs){var n=this.fp_pairs[o],s=n.rel_pos,l=n.floater
if(s.x-r+l.getW()>e)e=s.x-r+l.getW()
if(s.y-a+l.getH()>t)t=s.y-a+l.getH()}this.w=e
this.h=t}
return CompoundFloater}(B)
r.CompoundFloater=j
function isCompoundFloater(e){return Boolean(e.getFPPairs)}function handleCompoundFloaterInteraction(e,t,r,a){p(isCompoundFloater(e))
for(var i in e.getFPPairs()){var o=e.getFPPairs()[i],n=o.rel_pos,s=o.floater
if(isInteractableFloater(s))if(-1===s.interact_dist||r<s.interact_dist){var l={x:t.x+n.x*a,y:t.y+n.y*a,w:s.getW()*a,h:s.getH()*a}
s.handleInteract(s,l,r,a)}}}var H=1e-4
var z=function(a){_inheritsLoose(TextFloater,a)
function TextFloater(e){var t;(t=a.call(this,e=e||{})||this).text=void 0
t.size=void 0
t.base_style=void 0
t.style=void 0
t.fixed_w=void 0
t.align=void 0
t.text_w=void 0
t.resize_to_w=void 0
t.max_size=void 0
t.min_size=void 0
t.max_w=void 0
t.min_w=void 0
t.text=e.text||""
t.size=e.size||1
t.base_style=e.style||O
t.style=t.base_style
t.fixed_w=void 0!==e.w
var r=g.font.getStringWidth(t.style,1,t.text)
if(void 0!==e.w){t.w=e.w
t.resize_to_w=e.resize_to_w
if(e.resize_to_w){p(!e.size)
t.max_size=e.max_size||Infinity
t.min_size=e.min_size||H
t.size=r?E((t.w-H)*(1/r),t.min_size,t.max_size):1}}else{t.max_w=e.max_w
t.min_w=e.min_w
if(t.max_w&&t.min_w)p(t.max_w>=t.min_w)}t.updateWidth(r)
t.align=void 0===e.align?i.ALIGN.HCENTERFIT:e.align
t.updateHeight()
return t}var e=TextFloater.prototype
e.getText=function getText(){return this.text}
e.draw=function draw(e){var t=e.x,r=e.y,a=e.z,i=e.scale
p(void 0!==t&&void 0!==r&&void 0!==a&&void 0!==i)
g.font.drawSizedAligned(this.style,t,r,a,this.size*i,this.align,this.w*i,this.h*i,this.text)}
e.updateAlpha=function updateAlpha(e){this.style=g.font.styleAlpha(this.base_style,e)}
e.updateWidth=function updateWidth(e){this.text_w=this.size*e
if(!this.fixed_w){this.w=this.text_w+H
if(this.max_w)this.w=M(this.w,this.max_w)
if(this.min_w)this.w=C(this.w,this.min_w)}}
e.updateHeight=function updateHeight(){if(this.align&i.ALIGN.HWRAP)this.h=this.size*g.font.numLines(this.style,this.w,0,this.size,this.text)
else this.h=this.size}
e.updateSize=function updateSize(){var e=g.font.getStringWidth(this.style,1,this.text)
if(this.fixed_w&&this.resize_to_w)this.size=e?E((this.w-H)*(1/e),this.min_size,this.max_size):1
this.updateWidth(e)
this.updateHeight()}
e.setAlign=function setAlign(e){this.align=e
this.updateHeight()}
e.setText=function setText(e){this.text=e
this.updateSize()}
e.setStyle=function setStyle(e){this.base_style=e
this.updateSize()}
return TextFloater}(B)
r.TextFloater=z
var V=function(r){_inheritsLoose(GraphicalFloater,r)
function GraphicalFloater(e){var t;(t=r.call(this,e=e||{})||this).base_color=void 0
t.color=void 0
t.base_color=f()
t.color=f()
_(t.base_color,e.color||x)
_(t.color,t.base_color)
return t}var e=GraphicalFloater.prototype
e.setColor=function setColor(e){_(this.base_color,e)}
e.setBaseAlpha=function setBaseAlpha(e){this.base_color[3]=e}
e.updateAlpha=function updateAlpha(e){_(this.color,this.base_color)
this.color[3]*=e}
return GraphicalFloater}(B)
var Y=function(r){_inheritsLoose(SpriteFloater,r)
function SpriteFloater(e){var t;(t=r.call(this,e)||this).sprite=void 0
t.sprite_params=void 0
t.sprite=e.sprite
t.sprite_params=e.sprite_params||{}
return t}SpriteFloater.prototype.draw=function draw(e){var t=e.x,r=e.y,a=e.z,i=e.scale
this.sprite.draw(l({x:t,y:r,z:a,w:this.w*i,h:this.h*i,color:this.color},this.sprite_params))}
return SpriteFloater}(r.GraphicalFloater=V)
r.SpriteFloater=Y
var q=function(r){_inheritsLoose(ProgressBarFloater,r)
function ProgressBarFloater(e){var t;(t=r.call(this,e=e||{})||this).progress=void 0
t.progress=e.progress||0
return t}var e=ProgressBarFloater.prototype
e.draw=function draw(e){var t=e.x,r=e.y,a=e.z,i=e.scale
s.progressBar({x:t,y:r,z:a,w:this.w*i,h:this.h*i,progress:this.progress,color:this.color})}
e.setProgress=function setProgress(e){this.progress=e}
return ProgressBarFloater}(V)
r.ProgressBarFloater=q
var K=function(r){_inheritsLoose(PanelFloater,r)
function PanelFloater(e){var t;(t=r.call(this,e=e||{})||this).pixel_scale=void 0
t.pixel_scale=e.pixel_scale||1
return t}var e=PanelFloater.prototype
e.draw=function draw(e){var t=e.x,r=e.y,a=e.z,i=e.scale
s.panel({x:t,y:r,z:a,w:this.w*i,h:this.h*i,pixel_scale:this.pixel_scale*i,color:this.color,eat_clicks:false})}
e.setW=function setW(e){this.w=e}
e.setH=function setH(e){this.h=e}
return PanelFloater}(V)
r.PanelFloater=K
var X=function(s){_inheritsLoose(PanelledTextFloater,s)
function PanelledTextFloater(e,t){var r
var a=(t=t||{}).pixel_scale||.01
var i=t.panel_border||.4
var o=t.color||x
var n={text:{floater:e,rel_pos:{x:i,y:i,z:1}},panel:{floater:new K({color:o,pixel_scale:a,w:e.getW()+2*i,h:e.getH()+2*i}),rel_pos:{x:0,y:0,z:0}}};(r=s.call(this,n)||this).panel_border=void 0
r.fp_pairs=void 0
r.fp_pairs=n
r.panel_border=i
return r}var e=PanelledTextFloater.prototype
e.updatePanelSize=function updatePanelSize(){var e=this.fp_pairs.panel.floater
var t=this.fp_pairs.text.floater
e.setW(t.getW()+2*this.panel_border)
e.setH(t.getH()+2*this.panel_border)
this.w=e.getW()
this.h=e.getH()}
e.setText=function setText(e){this.fp_pairs.text.floater.setText(e)
this.updatePanelSize()}
e.setStyle=function setStyle(e){this.fp_pairs.text.floater.setStyle(e)
this.updatePanelSize()}
e.setColor=function setColor(e){this.fp_pairs.panel.floater.setColor(e)}
return PanelledTextFloater}(j)
r.PanelledTextFloater=X
function calculateOffscreenScaleFactor(e){return C(e[0]-1,-e[0],e[1]-1,-e[1],.5-e[2],0)}var Q=d()
var J=d()
function adjustOffscreenScreenPos(e,t){c(Q,t,S().pos)
var r=h()
var a=n(Q,[r[2],r[6],r[10]])
y(J,e)
if(a>0){J[0]=1-J[0]
J[1]=1-J[1]}if(N(a)<4)J[1]=(J[1]-.5)*N(a)/4+.5
if(J[0]>=.35&&J[0]<=.65&&J[2]>1&&J[1]<.5)J[0]=E(J[0],0,1)
else if(J[1]>.8||J[2]<0)J[0]=J[0]<.5?0:1
else J[0]=E(J[0],0,1)
J[1]=E(J[1],0,.8)
return J}function calculateFloaterScreenPos(e,t,r){var a=calculateOffscreenScaleFactor(t)
var i
if(r&&(t[0]<-.1||t[0]>1.1||t[1]<-.1||t[1]>1||t[2]<.5)){var o=adjustOffscreenScreenPos(t,e)
p(isFinite(o[0]))
p(isFinite(o[1]))
p(isFinite(o[2]))
i=o}else{p(isFinite(t[0]))
p(isFinite(t[1]))
p(isFinite(t[2]))
i=t}return{offscreen_scale_factor:a,screen_pos:i}}var $=u()
function offscreenOffsetCalculate(e){var t=e.x,r=e.y,a=e.w
A($,w)
if(t<m.x0())$[0]=m.x0()-t
else if(t+a>m.x1())$[0]=-(t+a-m.x1())
if(r<0)$[1]=-r
return $}var ee=Infinity
var te=.2
function calculateFloaterAlpha(e,t,r){t=void 0===t?ee:t
r=void 0===r?te:r
var a=isFinite(t)?t*r:0
var i=1
if(a&&e>t-a)i=C((t-e)/a,0)
return i}function unitLengthAtZ(e,t){t=t||H
return e[5]/t*.5}var re=9
var ae=96
var ie=.15
var oe=d()
function commonDrawFloaterSetup(e,t,r,a,i){var o=i.min_scale||re
var n=i.max_scale||ae
var s=void 0===i.vert_offset_scale?ie:i.vert_offset_scale
var l=void 0===i.downscale_if_offscreen?true:i.downscale_if_offscreen
var c=calculateFloaterScreenPos(r,t,e)
var _=c.offscreen_scale_factor
y(oe,c.screen_pos)
var u=oe[0]*m.wReal()+m.x0Real()
var d=oe[1]*m.hReal()+m.y0Real()
var f=S().pos
var v=D(T(r,f))
if(!isFinite(v))p(false,r+", "+f)
var h=unitLengthAtZ(g.mat_projection,C(.8*v,oe[2]))*m.hReal()
d-=s*(a=E(a*=h,o,C(n/2,n-(l?_:0)*n/2)))
p(isFinite(a))
p(isFinite(u))
p(isFinite(d))
return{screen_x:u,screen_y:d,scale:a,dist:v}}var ne=.001
function calculateFloaterZ(e){return C(Z.FLOATERS_MIN,Z.FLOATERS_MAX-ne*e)}var se=u()
var le=d()
function drawFloaterSimple(e,t,r,a){if(L()&&!e.draw_in_photos)return
var i=e.floater
p(i)
var o=e.show_offscreen||false
p(isFinite(t[0])&&isFinite(t[1])&&isFinite(t[2]))
I(le,t,g.mat_vp)
p(isFinite(le[0])&&isFinite(le[1])&&isFinite(le[2]))
var n=le[2]>=.5
if(o||n){var s=commonDrawFloaterSetup(o,le,t,r,a=a||{}),l=s.screen_x,c=s.screen_y,_=s.scale,u=s.dist
var d=calculateFloaterAlpha(u,e.max_dist,e.fade_dist)
if(d>0){i.updateAlpha(d)
var f=i.getW()*_
var v=i.getH()*_
var h={x:l-f/2,y:c-v,w:f,h:v}
if(o){A(se,offscreenOffsetCalculate(h))
if(i.offscreenUpdate)i.offscreenUpdate(se,_)}else A(se,w)
h.x+=se[0]
h.y+=se[1]
i.draw({x:h.x,y:h.y,z:calculateFloaterZ(u),scale:_})
if(i.handleInteract)i.handleInteract(i,h,u,_)}}}function drawFloaterStackSub(e,t,r,a,i){var o=[]
var n=[]
if(e.length>0)if((t=t||false)||le[2]>=.5){var s=commonDrawFloaterSetup(t,le,r,a,i),l=s.screen_x,c=s.screen_y,_=s.scale,u=s.dist
var d=0
for(var f=0;f<e.length;f++){if(L()&&!e[f].draw_in_photos)continue
var v=e[f]
var h=calculateFloaterAlpha(u,v.max_dist,v.fade_dist)
e[f].floater.updateAlpha(h)
if(h>0){var p=e[f].floater.getW()*_
var m=e[f].floater.getH()*_
var g={x:l-p/2,y:c-m+d,z:calculateFloaterZ(u),w:p,h:m}
d-=m
n.push(e[f].floater)
o.push(g)}}for(var E=0;E<o.length;E++){var y=n[E]
if(t){A(se,offscreenOffsetCalculate(o[E]))
if(y.offscreenUpdate)y.offscreenUpdate(se,_)}else A(se,w)
o[E].x+=se[0]
for(var T=0;T<o.length;T++)o[T].y+=se[1]}for(var I=0;I<o.length;I++){var S=n[I]
S.draw({x:o[I].x,y:o[I].y,z:o[I].z,scale:_})
if(S.handleInteract)S.handleInteract(S,o[I],u,_)}}}function drawFloaterStack(e,t,r,a){if(1===e.length)drawFloaterSimple(e[0],t,r,a)
else{a=a||{}
I(le,t,g.mat_vp)
var i={off_adjusted:[],not_off_adjusted:[]}
if(le[0]<0||le[0]>1||le[1]<0||le[1]>1||le[2]<.5)for(var o=0;o<e.length;o++)if(e[o].show_offscreen)i.off_adjusted.push(e[o])
else i.not_off_adjusted.push(e[o])
else i.off_adjusted=e
drawFloaterStackSub(i.off_adjusted,true,t,r,a)
drawFloaterStackSub(i.not_off_adjusted,false,t,r,a)}}},{"../glov/client/camera2d.js":241,"../glov/client/engine.js":250,"../glov/client/font.js":260,"../glov/client/input.js":271,"../glov/client/ui.js":306,"../glov/common/util.js":330,"../glov/common/vmath.js":332,"./camera.js":28,"./photo_mode.js":128,"./styles.js":160,assert:void 0}],85:[function(e,t,r){"use strict"
r.ALL_PLANTS=r.WILD_CROP_TO_MODEL=r.WILD_CROP_TO_CROP=r.WILD_CROP_TO_CROP_SEED=r.WILD_SUGAR_CANE=r.WILD_CARROT=r.WILD_WHEAT=r.WILD_PUMPKIN=r.WILD_CORN=r.WILD_TOMATO=r.DEBUG_FLOWERS=r.FLOWERS=r.CORAL_MUSHROOMS=r.LUMINESCENT_MUSHROOMS=r.BROWN_MUSHROOMS=r.RED_MUSHROOMS=r.ORANGE_FLOWERS=r.RED_FLOWERS=r.PURPLE_FLOWERS=r.YELLOW_FLOWERS=r.BLUE_FLOWERS=void 0
var a=e("../common/ids")
var i=a.ITEM_CARROT
var o=a.ITEM_CORN
var n=a.ITEM_PUMPKIN
var s=a.ITEM_SEEDS_CARROT
var l=a.ITEM_SEEDS_CORN
var c=a.ITEM_SEEDS_PUMPKIN
var _=a.ITEM_SEEDS_SUGAR_CANE
var u=a.ITEM_SEEDS_TOMATO
var d=a.ITEM_SEEDS_WHEAT
var f=a.ITEM_SUGAR_CANE
var v=a.ITEM_TOMATO
var h=a.ITEM_WHEAT
var p=e("../common/materials_common").Mat
function generateSimpleWeighted(e,t){var r=[]
for(var a=0;a<e.length;a++)for(var i=0;i<t[a];i++)r.push(e[a])
return r}var m=[4,6,25,26,27]
var g={name_key:"FLOWERS_BLUE",key:m,weighted:generateSimpleWeighted(m,[3,3,1,1,1])}
r.BLUE_FLOWERS=g
var E={name_key:"FLOWERS_YELLOW",key:[1,7]}
r.YELLOW_FLOWERS=E
var y=[2,3,19,20,21,22,23,24]
var T={name_key:"FLOWERS_PURPLE",key:y,weighted:generateSimpleWeighted(y,[6,6,1,1,1,1,1,1])}
r.PURPLE_FLOWERS=T
var I={name_key:"FLOWERS_RED",key:[5,8]}
r.RED_FLOWERS=I
var S={name_key:"FLOWERS_ORANGE",key:[13,14,15,16,17,18]}
r.ORANGE_FLOWERS=S
var A={name_key:"MUSHROOMS_RED",key:[28,29],attr1:p.RED_MUSHROOM}
r.RED_MUSHROOMS=A
var w={name_key:"MUSHROOMS_BROWN",key:[30,31,32,33],attr1:p.BROWN_MUSHROOM}
r.BROWN_MUSHROOMS=w
var L={name_key:"MUSHROOMS_LUMINESCENT",key:[34,35,36],attr1:p.LUMINESCENT_MUSHROOM}
r.LUMINESCENT_MUSHROOMS=L
var R={name_key:"MUSHROOMS_CORAL",key:[37,38],attr1:p.CORAL_MUSHROOM}
r.CORAL_MUSHROOMS=R
var x=[g,E,T,I,S,A,w,L]
r.FLOWERS=x
var O=[R]
r.DEBUG_FLOWERS=O
var b=0
r.WILD_TOMATO=b
var N=1
r.WILD_CORN=N
var C=2
r.WILD_PUMPKIN=C
var M=3
r.WILD_WHEAT=M
var D=4
r.WILD_CARROT=D
var P=5
r.WILD_SUGAR_CANE=P
var k=[u,l,c,d,s,_]
r.WILD_CROP_TO_CROP_SEED=k
var B=[v,o,n,h,i,f]
r.WILD_CROP_TO_CROP=B
var U=["tomato","corn","pumpkin","wheat","carrot","sugarcane"]
r.WILD_CROP_TO_MODEL=U
function getPlantArrayFromTypes(e){var t=[]
for(var r=0;r<e.length;r++){var a=e.weighted||e[r].key
for(var i=0;i<a.length;i++)t.push(a[i])}return t}var G=getPlantArrayFromTypes([g,E,T,I,S])
r.ALL_PLANTS=G},{"../common/ids":198,"../common/materials_common":201}],86:[function(e,t,r){"use strict"
r.fxUtilGradient=fxUtilGradient
r.fxUtilGlow=fxUtilGlow
var n=Math.sqrt,a=Math.round
var s=e("../glov/client/textures.js")
var l=e("../glov/common/util.js").clamp
var i=64
var o
function fxUtilGradient(){if(!o){var e=new Uint8Array(4*i)
e.fill(255)
for(var t=0;t<i;++t)e[4*t+3]=a(255*t/i)
o=[s.load({name:"gradient",width:i,height:1,nozoom:true,format:s.format.RGBA8,data:e,wrap_s:gl.CLAMP_TO_EDGE,wrap_t:gl.REPEAT})]}return o}var c=32
var _
function fxUtilGlow(){if(!_){var e=new Uint8Array(c*c*4)
e.fill(255)
var t=(c-1)/2
for(var r=0;r<c;r++)for(var a=0;a<c;a++){var i=n((a-t)*(a-t)+(r-t)*(r-t))/t
var o=l(1-i,0,1)
e[4*(a+r*c)+3]=255*o}_=[s.load({url:"fx_util_circle",width:c,height:c,format:s.format.RGBA8,nozoom:true,data:e,filter_min:gl.LINEAR,filter_max:gl.LINEAR,wrap_s:gl.CLAMP_TO_EDGE,wrap_t:gl.CLAMP_TO_EDGE})]}return _}},{"../glov/client/textures.js":304,"../glov/common/util.js":330}],87:[function(e,t,r){"use strict"
r.gemsHUD=gemsHUD
r.staminaBar=staminaBar
r.showStaminaMessage=showStaminaMessage
r.showStaminaDamage=showStaminaDamage
r.settlementBoundsShouldDraw=settlementBoundsShouldDraw
r.settlementVolumeBoundsShouldDraw=settlementVolumeBoundsShouldDraw
r.adventureHUD=adventureHUD
r.socialHUD=socialHUD
r.initHUDs=initHUDs
r.ATTRIB_BAR_H=r.ATTRIB_BAR_W=void 0
var a=e("assert")
var i=e("./layout.js")
var g=i.QUICKBAR_BORDER_PAD
var E=i.QUICKBAR_BOX_SIZE
a(E)
var y=400
r.ATTRIB_BAR_W=y
var T=(E-8)/3
r.ATTRIB_BAR_H=T
var I=e("../glov/client/camera2d")
var o=e("../glov/client/cmds").cmd_parse
var R=e("../glov/client/engine")
var n=e("../glov/client/settings")
var S=e("../glov/client/sound").soundPlayStreaming
var x=e("../glov/client/ui")
var s=e("../glov/common/util")
var l=s.clamp
var A=s.easeIn
var O=s.easeInOut
var c=s.easeOut
var _=s.lerp
var u=e("../glov/common/vmath").vec4
var d=e("../common/ids")
var f=d.ITEM_ACCESS_CONTROL
var v=d.ITEM_WAYGATE
var h=d.TYPE_ITEM
var w=e("../common/world_constants").WORLD_ACCESS_NONE
var p=e("./build_mode")
var m=p.doStamina
var L=p.unlimitedMode
var b=e("./crafting_mods")
var N=b.CMODS
var C=b.CMOD_FORMAT
var M=b.CMOD_NAME
var D=e("./energy_well").TIME_REFILL
var P=e("./layout")
var k=P.layoutCameraFull
var B=P.menuUpperLeft
var U=P.quickbarOnTop
var G=e("./localization/localization").L
var F=e("./main")
var W=e("./main_menu").getWorldInfo
var j=e("./quickbar")
var H=j.quickbarGetSelected
var z=j.selectLightingInstructions
var V=e("./race_ui").isRacePanelInColumn
var Y=e("./settlement")
var q=Y.settlementCurrent
var K=Y.settlementLastBound
var X=e("./share_menu").isShareButtonInColumn
var Q=e("./sky").skyGetSunBrightness
var J=e("./status")
var $=e("./styles")
var ee=$.color_gray80
var te=$.color_o2_bar
var re=$.color_stamina_bar
var ae=$.color_white
var ie=$.floater_style
var oe=$.stamina_style
var ne=$.style_gems
var se=e("./ui_util")
var le=e("./ui_util")
var ce=le.GEM_SYMBOL
var _e=le.STAMINA_SYMBOL
var ue=e("./user_data")
var de=ue.STAMINA_BASE_MAX
var fe=ue.stamina_mods_table
var ve=ue.userAttribs
var he=ue.userDataGemsFound
var pe=ue.userDataGet
var me=ue.userO2Cur
var ge=ue.userO2Max
var Ee=ue.userStaminaCur
var ye=ue.userStaminaMax
var Te=ue.worldReadOnly
var Ie=e("./world_comm").getWorldID
var Se=e("./world_info_view")
var Ae=Se.numberFormat
var we=Se.toggleLiked
var Le=e("./world_metadata")
var Re=Le.adventureMode
var xe=Le.worldHasGems
var Oe=Math.max,be=Math.min,Ne=Math.round
var Ce
n.register({energy_verbose:{label:"Verbose ⚡ damage numbers",default_value:0,type:o.TYPE_INT,range:[0,1]}})
var Me=0
function gemsHUD(){k()
if(Te()&&xe()&&!R.defines.NOUI){var e=I.w()/2
var t=8
var r=36
var a=he()
var i=xe()
if(a===i){if(!Me)Me=R.frame_timestamp
var o=R.frame_timestamp-Me
var n=1-l((o-3e3)/2e3,0,1)
if(n)Ce.drawSizedAligned(Ce.styleAlpha(ne,n),e,t,Z.GEMS_HUD,r,Ce.ALIGN.HCENTER,0,0,1===i?G.$(G.HUDS_GEM_FOUND_ONE,ce):G.$(G.HUDS_GEM_FOUND_ALL,""+i+ce))}else{Ce.drawSizedAligned(ie,e,t,Z.GEMS_HUD,r,Ce.ALIGN.HCENTER,0,0,G.HUDS_GEM_HIDDEN.$({gems:i}))
Ce.drawSizedAligned(ne,e,t+=r+2,Z.GEMS_HUD,1.5*r,Ce.ALIGN.HCENTER,0,0,G.$(G.FORMAT_FRACTION,""+a+ce,""+i+ce))}}}function blendingValue(a){var i=0
var o=0
var n=0
return function(e,t){if(t){i=e
n=0}if(i!==e){o=i
n=R.frame_timestamp
i=e}if(n){var r=R.frame_timestamp-n
if(r<a)return _(c(r/a,2),o,e)
else n=0}return e}}function FadingBar(e){this.color=e.color.slice(0)
this.getCur=e.getCur
this.getMax=e.getMax
this.label=e.label
this.style=e.style
this.key=e.key
this.oversize_max=e.oversize_max
this.fade=0
this.last_value=0
this.last_change_time=0
this.displayPercentileBar=blendingValue(250)
this.displayPercentileLabel=blendingValue(250)
this.displayWidth=blendingValue(250)
this.last_frame=null}FadingBar.prototype.updateAndDraw=function(e,t){var r=t.w,a=t.h,i=t.x,o=t.z,n=t.always_show,s=t.verbose,l=t.oversize
n=null==n?void 0:n[this.key]
l=null==l?void 0:l[this.key]
var c=this.getMax()
var _=be(this.getCur(),c)
var u=_/c
var d=u<1||n
var f=this.last_frame<R.frame_index-2
if(f){this.fade=d?1:0
this.last_change_time=R.frame_timestamp
this.last_value=u}this.last_frame=R.frame_index
var v=1
var h=1
if(this.oversize_max)h=c/this.oversize_max
if(l){v=h
var p=this.displayWidth(r*v,f)
i-=(p-r)/2
r=p}if(this.last_value!==u){this.last_value=u
this.last_change_time=R.frame_timestamp}var m=this.displayPercentileBar(u,f)
var g=this.displayPercentileLabel(u*h,f)
var E=R.frame_timestamp-this.last_change_time
var y=d&&(u<.25||E<15e3)
if(n)this.fade=1
else if(y)this.fade=be(1,this.fade+R.frame_dt/1e3)
else this.fade=Oe(0,this.fade-R.frame_dt/1e3)
if(this.fade>0){this.color[3]=O(this.fade,2)
var T=G.$(G.FORMAT_FRACTION,Ne(_),G.separateWords(c,this.label))
var I=Ne(100*g)
if(g<v)I=be(I,Ne(100*v)-1)
if(g>0)I=Oe(I,1)
var S=G.separateWords(G.addPercentage(I),this.label)
if(s){var A=S
S=T
T=A}var w={x:i,y:e,z:o,w:r,h:a,progress:m,tooltip:T,color:this.color}
x.progressBar(w)
var L=this.style
if(this.fade<1)L=Ce.styleAlpha(L,this.color[3])
Ce.drawSizedAligned(L,w.x,w.y,o+2,.8*a,Ce.ALIGN.HVCENTERFIT,w.w,w.h,S)
e+=w.h+4}return e}
var De=new FadingBar({key:"stamina",color:re,label:_e,style:oe,getCur:Ee,getMax:ye,oversize_max:de})
var Pe=new FadingBar({key:"o2",color:te,label:"O2",style:oe,getCur:me,getMax:ge})
function drawModOrAttrib(e,t,r){var a=e.x,i=e.z,o=e.w,n=e.font_height
var s=1
if(!s)return t
var l=ie
if(s<1)l=Ce.styleAlpha(l,s)
Ce.drawSizedAligned(l,a,t,i,n,Ce.ALIGN.HCENTERFIT,o,0,r)
return t+n}function staminaBar(e){if(!m()||R.defines.NOUI)return e.y
var t=e.y,r=e.attrib_filter
t=De.updateAndDraw(t,e)
if(!r)t=Pe.updateAndDraw(t,e)
var a=ve()
for(var i in a)if(C[i]&&(!r||i.match(r)))t=drawModOrAttrib(e,t,""+C[i](a,i))
if(!r)for(var o=0;o<fe.length;o++){var n=fe[o]
if(n[2])t=drawModOrAttrib(e,t,G.$(G.STATUSMSG_STAMINA_MODS,G.addColon(n[0]),G.addPercentage(100*n[1]),M[N.STAMINA_RATE]))}return t}function showStaminaMessage(e){J.push(e)}var ke=0
function showStaminaDamage(e,t){if(!n.energy_verbose){e=Oe(Ne(100*e/de),1)
e=G.addPercentage(e)}showStaminaMessage(G.$(G.STATUSMSG_STAMINA_DAMAGE,""+e+_e,t))
ke=R.frame_timestamp}var Be=0
var Ue=5e3
function isInTheDark(){var e=F.char_controller.lighting_values,t=e.torch_factor,r=e.sun_factor
if(!((Q()<.1||r<.02)&&t<.05)){Be=0
return false}if(!Be)Be=R.frame_timestamp
if(R.frame_timestamp-Be>Ue)return true
return false}var Ge=u(.5,0,0,1)
var Fe=0
var We=0
var je=""
var He
var ze=false
var Ve=25e3
var Ye=500
function settlementBoundsShouldDraw(){var e=H()
if(!e||!e.is_settlement_locked)return false
return true}function settlementVolumeBoundsShouldDraw(){var e=H()
if(!e)return false
if(e.type===h&&(e.id===v||e.id===f))return true
return false}function adventureHUD(){k()
var e=I.w()/2-y/2
var t=(U()?g+E+4:0)+8
var r=Z.UI
var a=y
var i=T
var o=x.font_height
t=staminaBar({x:e,y:t,w:a,h:i,z:r,font_height:o,oversize:{stamina:true}})
if(Re()){var n=q(false)
var s=!n
if(!n)n=q(true)
var l=n?s?G.$(G.HUDS_IN_OUTSKIRTS_OF,n.name):G.$(G.HUDS_IN_SETTLEMENT,n.name):G.HUDS_IN_THE_WILDS
var c=n&&!s&&n===K()
var _=He===R.frame_index-1
if(!_)Fe=0
if((l=String(l))!==je){ze=false
if(_)if(Fe>1e4)ze=true
Fe=0
je=l}if(c){if(We&&_)if(R.frame_timestamp-We>1e3*D)S("fanfares/sapling_scenario",1,true)
We=R.frame_timestamp}He=R.frame_index
Fe+=R.frame_dt
var u=be(1,Fe/Ye)
var d=Oe(0,be(1,(Ve-Fe)/Ye))
var f=be(ze?1:u,d)
if(f&&!R.defines.NOUI){f=O(f,2)
var v=o
if(ze&&u<1)v*=2-A(u,2)
var h=Ce.styleAlpha(ie,f)
Ce.drawSizedAligned(h,e,t,r,v,Ce.ALIGN.HCENTERFIT,a,0,l)
t+=o
if(!Te()&&n&&!n.buildAllowed()){Ce.drawSizedAligned(h,e,t,r,o,Ce.ALIGN.HCENTERFIT,a,0,G.STATUSMSG_SETTLEMENT_NO_ACCESS)
t+=o}}}if(ke){var p=1-(R.frame_timestamp-ke)/300
if(p<0)ke=0
else{p=A(p,2)
I.push()
I.setNormalized()
Ge[3]=p
x.drawHollowRect(0,0,1,1,.1,.25,0,Ge)
I.pop()}}if(isInTheDark()&&!R.defines.NOUI){var m=z()
if(m)J.get("dark").setMessage(G.$(G.STATUSMSG_ITS_DARK,m)).fade()}}function socialHUD(){if(R.defines.NOUI)return
var e=W(Ie(),true)
if(!e)return
var t=e.stats,r=e.access_public,a=e.access_modify
if(!r)return
if(!L()&&!Te())return
t=t||{}
var i=64
var o=1.5*x.font_height
var n=B()?16:I.w()-16-i
var s=B()?n+i+8:n-8
var l=10+x.button_height
if(X())l+=x.button_height+10
if(V())l+=x.button_height+10
var c=(i-o)/2
var _=Z.MENUBUTTON
var u=B()?Ce.ALIGN.HLEFT:Ce.ALIGN.HRIGHT
var d=t.like||0
var f={x:n,y:l,z:_,w:i,h:i,pad_focusable:false}
var v=a===w&&!Te()
if(d||!v){var h=pe("liked")
f.tooltip=h?G.TLTP_WORLD_LIKED:G.TLTP_WORLD_CLICK_TO_LIKE
var p=x.buttonShared(f),m=p.ret
var g="regular"!==p.state
f.color=g?ee:ae
f.frame=h?se.LIKE_ACTIVE:se.LIKE
if(m)we(t)
se.sprite.draw(f)
Ce.drawSizedAligned(ie,s,l+c,_,o,u,0,0,Ae(d))
l+=i+8}var E=t.visit_count||0
if(E){f.y=l
f.color=ae
f.frame=se.VIEWS
f.tooltip=G.TLTP_WORLD_TIMES_VIEWED.$({views:E})
f.text=""
se.sprite.draw(f)
x.label(f)
Ce.drawSizedAligned(ie,s,l+c,_,o,u,0,0,Ae(E))}}function initHUDs(){Fe=ke=Me=0
We=R.frame_timestamp
Ce=x.font}},{"../common/ids":198,"../common/world_constants":212,"../glov/client/camera2d":241,"../glov/client/cmds":244,"../glov/client/engine":250,"../glov/client/settings":291,"../glov/client/sound":297,"../glov/client/ui":306,"../glov/common/util":330,"../glov/common/vmath":332,"./build_mode":27,"./crafting_mods":58,"./energy_well":73,"./layout":99,"./layout.js":99,"./localization/localization":108,"./main":112,"./main_menu":113,"./quickbar":142,"./race_ui":144,"./settlement":148,"./share_menu":150,"./sky":151,"./status":156,"./styles":160,"./ui_util":168,"./user_data":170,"./world_comm":182,"./world_info_view":184,"./world_metadata":186,assert:void 0}],88:[function(e,t,r){"use strict"
r.dmcaShow=r.dmcaHide=r.gdprShow=r.gdprHide=r.termsOfServiceShow=r.termsOfServiceHide=r.privacyPolicyShow=r.privacyPolicyHide=r.changelogShow=r.changelogHide=void 0
var a=e("./localization/localization").L
var i=e("./main_menu")
var o=i.URL_DMCA
var n=i.URL_GDPR
var s=i.URL_PRIVACY
var l=i.URL_TOS
var c=e("../glov/client/engine.js")
var _=e("../glov/client/urlhash.js")
function buildIframeContentHandlers(r,e){var a=e.urlhashKey,t=e.customPageTitle,i=e.customRoute
function hide(e){if(!e)_.set(a,"")
document.getElementById("iframecontainer").style.display="none"
document.getElementById("iframe").src="about:blank"
c.disableRender(false)}function show(e){if(!document.getElementById("iframecontainer"))return
if(!e)_.set(a,"1")
document.getElementById("iframecontainer").style.display="block"
var t=document.getElementById("iframe")
if(t.src!==r)t.src=r
document.getElementById("iframecancel").onclick=hide.bind(null,false)
c.disableRender(true)}_.register({key:a,title:function title(){return t},push:true,route_only:true,change:function change(e){if(e)show(true)
else hide(true)}})
if(i)_.routeFixed(i,a)
return{hide:hide,show:show}}var u=buildIframeContentHandlers(_.getURLBase()+"changelog.html",{urlhashKey:"cl",customPageTitle:a.PAGETITLE_UPDATES,customRoute:"changelog.html"}),d=u.hide,f=u.show
r.changelogShow=f
r.changelogHide=d
window.changelogHide=d
var v=buildIframeContentHandlers(s,{urlhashKey:"pp",customPageTitle:a.PAGETITLE_PRIVACY_POLICY}),h=v.hide,p=v.show
r.privacyPolicyShow=p
r.privacyPolicyHide=h
var m=buildIframeContentHandlers(l,{urlhashKey:"tos",customPageTitle:a.PAGETITLE_TERMS_OF_SERVICE}),g=m.hide,E=m.show
r.termsOfServiceShow=E
r.termsOfServiceHide=g
var y=buildIframeContentHandlers(n,{urlhashKey:"gdpr",customPageTitle:a.PAGETITLE_GDPR}),T=y.hide,I=y.show
r.gdprShow=I
r.gdprHide=T
var S=buildIframeContentHandlers(o,{urlhashKey:"dmca",customPageTitle:a.PAGETITLE_DMCA}),A=S.hide,w=S.show
r.dmcaShow=w
r.dmcaHide=A},{"../glov/client/engine.js":250,"../glov/client/urlhash.js":307,"./localization/localization":108,"./main_menu":113}],89:[function(e,t,r){t.exports={font_size:24,imageW:1024,imageH:1024,spread:6,channels:1,char_infos:[{c:1,xpad:3.92578,sc:.833333},{c:2,xpad:3.92578,sc:.833333},{c:3,xpad:3.92578,sc:.833333},{c:4,xpad:3.92578,sc:.833333},{c:5,xpad:3.92578,sc:.833333},{c:6,xpad:3.92578,sc:.833333},{c:7,xpad:3.92578,sc:.833333},{c:8,xpad:3.92578,sc:.833333},{c:9,xpad:3.92578,sc:.833333},{c:10,xpad:3.92578,sc:.833333},{c:11,xpad:3.92578,sc:.833333},{c:12,xpad:3.92578,sc:.833333},{c:13,xpad:3.92578,sc:.833333},{c:14,xpad:3.92578,sc:.833333},{c:15,xpad:3.92578,sc:.833333},{c:16,xpad:3.92578,sc:.833333},{c:17,xpad:3.92578,sc:.833333},{c:18,xpad:3.92578,sc:.833333},{c:19,xpad:3.92578,sc:.833333},{c:20,xpad:3.92578,sc:.833333},{c:21,xpad:3.92578,sc:.833333},{c:22,xpad:3.92578,sc:.833333},{c:23,xpad:3.92578,sc:.833333},{c:24,xpad:3.92578,sc:.833333},{c:25,xpad:3.92578,sc:.833333},{c:26,xpad:3.92578,sc:.833333},{c:27,xpad:3.92578,sc:.833333},{c:28,xpad:3.92578,sc:.833333},{c:29,xpad:3.92578,sc:.833333},{c:30,xpad:3.92578,sc:.833333},{c:31,xpad:3.92578,sc:.833333},{c:32,xpad:5.20898},{c:33,x0:92,y0:198,yoffs:4,xpad:1.48047,w:5,h:16},{c:34,x0:796,y0:928,yoffs:4,xpad:.40625,w:10,h:8},{c:35,x0:701,y0:814,yoffs:9,w:15,h:11},{c:36,x0:6,y0:6,yoffs:1,xpad:1.07813,w:12,h:23},{c:37,x0:151,y0:42,yoffs:2,xpad:.419922,w:20,h:20},{c:38,x0:110,y0:198,yoffs:4,xpad:.671875,w:23,h:16},{c:39,x0:819,y0:928,yoffs:4,xpad:.695313,w:5,h:8},{c:40,x0:31,y0:6,yoffs:1,xpad:.621094,w:9,h:23},{c:41,x0:53,y0:6,yoffs:1,xpad:.621094,w:9,h:23},{c:42,x0:744,y0:663,yoffs:4,xpad:.0371094,w:13,h:12},{c:43,x0:193,y0:870,yoffs:9,w:10,h:9},{c:44,x0:216,y0:870,yoffs:16,xpad:.908203,w:6,h:9},{c:45,x0:335,y0:977,yoffs:12,xpad:.585938,w:9,h:3},{c:46,x0:840,y0:949,yoffs:16,xpad:1.27539,w:5,h:4},{c:47,x0:220,y0:6,yoffs:1,w:7,h:22},{c:48,x0:146,y0:198,yoffs:4,xpad:.626953,w:12,h:16},{c:49,x0:171,y0:197,yoffs:4,xpad:.626953,w:12,h:16},{c:50,x0:196,y0:197,yoffs:4,xpad:.626953,w:12,h:16},{c:51,x0:221,y0:197,yoffs:4,xpad:.626953,w:12,h:16},{c:52,x0:246,y0:196,yoffs:4,xpad:.626953,w:12,h:16},{c:53,x0:271,y0:196,yoffs:4,xpad:.626953,w:12,h:16},{c:54,x0:296,y0:195,yoffs:4,xpad:.626953,w:12,h:16},{c:55,x0:321,y0:195,yoffs:4,xpad:.626953,w:12,h:16},{c:56,x0:346,y0:195,yoffs:4,xpad:.626953,w:12,h:16},{c:57,x0:371,y0:195,yoffs:4,xpad:.626953,w:12,h:16},{c:58,x0:729,y0:814,yoffs:9,xpad:1.27539,w:5,h:11},{c:59,x0:396,y0:195,yoffs:9,xpad:.908203,w:6,h:16},{c:60,x0:235,y0:870,yoffs:9,w:9,h:9},{c:61,x0:436,y0:956,yoffs:11,w:10,h:5},{c:62,x0:839,y0:838,yoffs:9,w:9,h:10},{c:63,x0:415,y0:195,yoffs:4,xpad:.322266,w:9,h:16},{c:64,x0:31,y0:42,yoffs:4,xpad:.634766,w:25,h:21},{c:65,x0:437,y0:194,yoffs:4,w:18,h:16},{c:66,x0:468,y0:194,yoffs:4,xpad:.794922,w:14,h:16},{c:67,x0:495,y0:194,yoffs:4,xpad:.451172,w:15,h:16},{c:68,x0:523,y0:194,yoffs:4,xpad:.851563,w:16,h:16},{c:69,x0:552,y0:194,yoffs:4,xpad:1.26367,w:14,h:16},{c:70,x0:579,y0:194,yoffs:4,xpad:.513672,w:14,h:16},{c:71,x0:606,y0:194,yoffs:4,xpad:.244141,w:17,h:16},{c:72,x0:636,y0:194,yoffs:4,xpad:.0644531,w:18,h:16},{c:73,x0:667,y0:194,yoffs:4,xpad:.349609,w:8,h:16},{c:74,x0:69,y0:42,yoffs:4,xpad:.015625,w:8,h:21},{c:75,x0:688,y0:194,yoffs:4,w:17,h:16},{c:76,x0:718,y0:194,yoffs:4,xpad:.742188,w:14,h:16},{c:77,x0:745,y0:194,yoffs:4,xpad:.572266,w:20,h:16},{c:78,x0:778,y0:193,yoffs:4,xpad:.517578,w:16,h:16},{c:79,x0:807,y0:193,yoffs:4,xpad:.601563,w:17,h:16},{c:80,x0:837,y0:193,yoffs:4,xpad:.648438,w:14,h:16},{c:81,x0:90,y0:42,yoffs:4,w:20,h:21},{c:82,x0:864,y0:193,yoffs:4,w:16,h:16},{c:83,x0:893,y0:193,yoffs:4,xpad:1.07813,w:12,h:16},{c:84,x0:918,y0:193,yoffs:4,xpad:.638672,w:15,h:16},{c:85,x0:946,y0:193,yoffs:4,w:17,h:16},{c:86,x0:976,y0:193,yoffs:4,w:18,h:16},{c:87,x0:6,y0:229,yoffs:4,w:24,h:16},{c:88,x0:43,y0:229,yoffs:4,xpad:.40625,w:16,h:16},{c:89,x0:72,y0:229,yoffs:4,w:17,h:16},{c:90,x0:102,y0:227,yoffs:4,xpad:.759766,w:14,h:16},{c:91,x0:75,y0:6,yoffs:1,xpad:.126953,w:8,h:23},{c:92,x0:240,y0:6,yoffs:1,w:7,h:22},{c:93,x0:96,y0:6,yoffs:1,xpad:1.12695,w:7,h:23},{c:94,x0:861,y0:836,yoffs:5,xpad:.490234,w:11,h:10},{c:95,x0:878,y0:965,yoffs:21,xpad:.492188,w:9,h:2},{c:96,x0:459,y0:955,yoffs:2,xpad:.0957031,w:7,h:5},{c:97,x0:747,y0:814,yoffs:9,w:12,h:11},{c:98,x0:117,y0:107,yoffs:3,xpad:.359375,w:13,h:17},{c:99,x0:772,y0:814,yoffs:9,xpad:.636719,w:11,h:11},{c:100,x0:143,y0:107,yoffs:3,xpad:.359375,w:13,h:17},{c:101,x0:796,y0:814,yoffs:9,xpad:1.14063,w:11,h:11},{c:102,x0:694,y0:41,yoffs:2,w:11,h:18},{c:103,x0:129,y0:227,yoffs:9,w:12,h:16},{c:104,x0:169,y0:107,yoffs:3,xpad:.248047,w:13,h:17},{c:105,x0:195,y0:106,yoffs:3,xpad:.417969,w:7,h:17},{c:106,x0:260,y0:6,yoffs:3,xpad:1.13672,w:6,h:22},{c:107,x0:215,y0:106,yoffs:3,xpad:.207031,w:13,h:17},{c:108,x0:241,y0:106,yoffs:3,xpad:.0429688,w:7,h:17},{c:109,x0:820,y0:814,yoffs:9,w:20,h:11},{c:110,x0:853,y0:812,yoffs:9,w:14,h:11},{c:111,x0:880,y0:812,yoffs:9,xpad:.720703,w:12,h:11},{c:112,x0:154,y0:227,yoffs:9,xpad:.916016,w:13,h:16},{c:113,x0:180,y0:226,yoffs:9,w:14,h:16},{c:114,x0:905,y0:812,yoffs:9,w:11,h:11},{c:115,x0:929,y0:812,yoffs:9,xpad:.441406,w:10,h:11},{c:116,x0:655,y0:339,yoffs:5,w:9,h:15},{c:117,x0:952,y0:812,yoffs:9,xpad:.207031,w:13,h:11},{c:118,x0:978,y0:812,yoffs:9,w:12,h:11},{c:119,x0:6,y0:846,yoffs:9,xpad:.226563,w:17,h:11},{c:120,x0:36,y0:846,yoffs:9,w:12,h:11},{c:121,x0:207,y0:226,yoffs:9,w:12,h:16},{c:122,x0:61,y0:846,yoffs:9,xpad:.677734,w:11,h:11},{c:123,x0:116,y0:6,yoffs:1,xpad:1.26367,w:8,h:23},{c:124,x0:137,y0:6,yoffs:1,xpad:1.9668,w:5,h:23},{c:125,x0:155,y0:6,yoffs:1,xpad:.263672,w:9,h:23},{c:126,x0:479,y0:955,yoffs:11,xpad:.771484,w:11,h:5},{c:160,xpad:5.20898},{c:161,x0:232,y0:226,yoffs:9,xpad:.445313,w:6,h:16},{c:162,x0:365,y0:41,yoffs:5,xpad:.636719,w:11,h:19},{c:163,x0:251,y0:225,yoffs:4,xpad:.470703,w:13,h:16},{c:164,x0:277,y0:225,yoffs:4,xpad:.722656,w:16,h:16},{c:165,x0:306,y0:224,yoffs:4,w:17,h:16},{c:166,x0:177,y0:6,yoffs:1,xpad:1.9668,w:5,h:23},{c:167,x0:940,y0:503,yoffs:3,xpad:.898438,sc:.833333,w:10,h:15},{c:168,x0:642,y0:986,yoffs:3,xpad:1.32617,sc:.833333,w:8,h:3},{c:169,x0:769,y0:661,yoffs:3,xpad:.991211,sc:.833333,w:15,h:14},{c:170,x0:899,y0:964,yoffs:6,xpad:1.62305,sc:.833333,w:7,h:4},{c:171,x0:322,y0:957,yoffs:8,xpad:.849609,sc:.833333,w:10,h:8},{c:172,x0:356,y0:976,yoffs:10,xpad:.999023,sc:.833333,w:8,h:5},{c:173,x0:661,y0:985,yoffs:10,xpad:.988281,sc:.833333,w:7,h:3},{c:174,x0:795,y0:661,yoffs:3,xpad:.834961,sc:.833333,w:15,h:14},{c:175,x0:32,y0:1011,yoffs:3,xpad:.34082,sc:.833333,w:9,h:2},{c:176,x0:857,y0:947,yoffs:2,xpad:.708984,sc:.833333,w:6,h:6},{c:177,x0:256,y0:869,yoffs:7,xpad:.310547,sc:.833333,w:8,h:11},{c:178,x0:502,y0:954,yoffs:3,sc:.833333,w:8,h:7},{c:179,x0:836,y0:927,yoffs:3,xpad:.236328,sc:.833333,w:7,h:10},{c:180,x0:917,y0:962,yoffs:2,sc:.833333,w:6,h:4},{c:181,x0:821,y0:661,yoffs:7,sc:.833333,w:11,h:14},{c:182,x0:335,y0:223,yoffs:3,xpad:.046875,sc:.833333,w:13,h:18},{c:183,x0:934,y0:962,yoffs:10,xpad:.229492,sc:.833333,w:5,h:4},{c:184,x0:521,y0:954,yoffs:14,xpad:1.34082,sc:.833333,w:8,h:7},{c:185,x0:540,y0:954,yoffs:3,xpad:.645508,sc:.833333,w:6,h:7},{c:186,x0:950,y0:962,yoffs:6,xpad:1.31152,sc:.833333,w:8,h:4},{c:187,x0:343,y0:957,yoffs:8,sc:.833333,w:11,h:8},{c:188,x0:717,y0:40,sc:.833333,w:17,h:20},{c:189,x0:745,y0:40,sc:.833333,w:18,h:20},{c:190,x0:774,y0:40,sc:.833333,w:17,h:20},{c:191,x0:360,y0:224,yoffs:9,w:9,h:16},{c:192,x0:279,y0:6,yoffs:-2,w:18,h:22},{c:193,x0:310,y0:6,yoffs:-2,w:18,h:22},{c:194,x0:341,y0:6,yoffs:-2,w:18,h:22},{c:195,x0:372,y0:6,yoffs:-2,w:18,h:22},{c:196,x0:403,y0:6,yoffs:-2,w:18,h:22},{c:197,x0:434,y0:6,yoffs:-2,w:18,h:22},{c:198,x0:382,y0:224,yoffs:4,w:21,h:16},{c:199,x0:123,y0:42,yoffs:4,xpad:.451172,w:15,h:21},{c:200,x0:465,y0:6,yoffs:-2,xpad:1.26367,w:14,h:22},{c:201,x0:492,y0:6,yoffs:-2,xpad:1.26367,w:14,h:22},{c:202,x0:519,y0:6,yoffs:-2,xpad:1.26367,w:14,h:22},{c:203,x0:546,y0:6,yoffs:-2,xpad:1.26367,w:14,h:22},{c:204,x0:573,y0:6,yoffs:-2,xpad:.349609,w:8,h:22},{c:205,x0:594,y0:6,yoffs:-2,w:9,h:22},{c:206,x0:616,y0:6,yoffs:-2,w:10,h:22},{c:207,x0:184,y0:42,xpad:.349609,w:8,h:20},{c:208,x0:416,y0:224,yoffs:4,xpad:.851563,w:16,h:16},{c:209,x0:639,y0:6,yoffs:-2,xpad:.517578,w:16,h:22},{c:210,x0:668,y0:6,yoffs:-2,xpad:.601563,w:17,h:22},{c:211,x0:698,y0:6,yoffs:-2,xpad:.601563,w:17,h:22},{c:212,x0:728,y0:6,yoffs:-2,xpad:.601563,w:17,h:22},{c:213,x0:758,y0:6,yoffs:-2,xpad:.601563,w:17,h:22},{c:214,x0:788,y0:6,yoffs:-2,xpad:.601563,w:17,h:22},{c:215,x0:276,y0:870,yoffs:9,xpad:.65625,w:9,h:9},{c:216,x0:818,y0:6,yoffs:1,xpad:.601563,w:17,h:22},{c:217,x0:848,y0:6,yoffs:-2,w:17,h:22},{c:218,x0:878,y0:6,yoffs:-2,w:17,h:22},{c:219,x0:908,y0:6,yoffs:-2,w:17,h:22},{c:220,x0:938,y0:6,yoffs:-2,w:17,h:22},{c:221,x0:968,y0:6,yoffs:-2,w:17,h:22},{c:222,x0:445,y0:223,yoffs:4,xpad:.554688,w:14,h:16},{c:223,x0:803,y0:41,yoffs:2,xpad:.835938,w:14,h:18},{c:224,x0:830,y0:41,yoffs:2,w:12,h:18},{c:225,x0:855,y0:41,yoffs:2,w:12,h:18},{c:226,x0:880,y0:41,yoffs:2,w:12,h:18},{c:227,x0:905,y0:41,yoffs:2,w:12,h:18},{c:228,x0:261,y0:105,yoffs:3,w:12,h:17},{c:229,x0:930,y0:41,yoffs:2,w:12,h:18},{c:230,x0:85,y0:846,yoffs:9,xpad:.355469,w:17,h:11},{c:231,x0:472,y0:223,yoffs:9,xpad:.636719,w:11,h:16},{c:232,x0:955,y0:41,yoffs:2,xpad:1.14063,w:11,h:18},{c:233,x0:979,y0:41,yoffs:2,xpad:1.14063,w:11,h:18},{c:234,x0:1003,y0:41,yoffs:2,xpad:1.14063,w:11,h:18},{c:235,x0:286,y0:105,yoffs:3,xpad:1.14063,w:11,h:17},{c:236,x0:6,y0:77,yoffs:2,w:8,h:18},{c:237,x0:27,y0:77,yoffs:2,w:8,h:18},{c:238,x0:48,y0:76,yoffs:2,w:10,h:18},{c:239,x0:310,y0:105,yoffs:3,w:9,h:17},{c:240,x0:71,y0:76,yoffs:2,xpad:.533203,w:12,h:18},{c:241,x0:96,y0:76,yoffs:2,w:14,h:18},{c:242,x0:123,y0:76,yoffs:2,xpad:.720703,w:12,h:18},{c:243,x0:148,y0:76,yoffs:2,xpad:.720703,w:12,h:18},{c:244,x0:173,y0:75,yoffs:2,xpad:.720703,w:12,h:18},{c:245,x0:198,y0:75,yoffs:2,xpad:.720703,w:12,h:18},{c:246,x0:332,y0:105,yoffs:3,xpad:.720703,w:12,h:17},{c:247,x0:844,y0:662,yoffs:8,w:10,h:12},{c:248,x0:357,y0:105,yoffs:6,xpad:.720703,w:12,h:17},{c:249,x0:223,y0:75,yoffs:2,xpad:.207031,w:13,h:18},{c:250,x0:249,y0:74,yoffs:2,xpad:.207031,w:13,h:18},{c:251,x0:275,y0:74,yoffs:2,xpad:.207031,w:13,h:18},{c:252,x0:382,y0:105,yoffs:3,xpad:.207031,w:13,h:17},{c:253,x0:195,y0:6,yoffs:2,w:12,h:23},{c:254,x0:998,y0:6,yoffs:3,xpad:.523438,w:13,h:22},{c:255,x0:6,y0:42,yoffs:3,w:12,h:22},{c:256,x0:495,y0:222,yoffs:-1,sc:.833333,w:15,h:18},{c:257,x0:866,y0:661,yoffs:3,sc:.833333,w:10,h:14},{c:258,x0:407,y0:103,yoffs:-2,sc:.833333,w:15,h:19},{c:259,x0:961,y0:503,yoffs:2,sc:.833333,w:10,h:15},{c:260,x0:521,y0:222,yoffs:3,sc:.833333,w:15,h:18},{c:261,x0:887,y0:661,yoffs:7,sc:.833333,w:10,h:14},{c:262,x0:433,y0:103,yoffs:-2,sc:.833333,w:13,h:19},{c:263,x0:982,y0:503,yoffs:2,xpad:.697266,sc:.833333,w:9,h:15},{c:264,x0:547,y0:222,yoffs:-1,xpad:.416016,sc:.833333,w:11,h:18},{c:265,x0:1002,y0:503,yoffs:2,xpad:.213867,sc:.833333,w:9,h:15},{c:266,x0:457,y0:103,yoffs:-2,sc:.833333,w:13,h:19},{c:267,x0:5,y0:539,yoffs:2,xpad:.697266,sc:.833333,w:9,h:15},{c:268,x0:481,y0:103,yoffs:-2,sc:.833333,w:13,h:19},{c:269,x0:25,y0:539,yoffs:2,xpad:.697266,sc:.833333,w:9,h:15},{c:270,x0:505,y0:103,yoffs:-2,xpad:.0429688,sc:.833333,w:14,h:19},{c:271,x0:45,y0:539,yoffs:2,sc:.833333,w:14,h:15},{c:272,x0:908,y0:661,yoffs:3,xpad:.0429688,sc:.833333,w:14,h:14},{c:273,x0:70,y0:539,yoffs:2,sc:.833333,w:12,h:15},{c:274,x0:569,y0:222,yoffs:-1,xpad:.719727,sc:.833333,w:12,h:18},{c:275,x0:933,y0:661,yoffs:3,xpad:.117188,sc:.833333,w:10,h:14},{c:276,x0:592,y0:222,yoffs:-1,xpad:1.03906,sc:.833333,w:9,h:18},{c:277,x0:93,y0:539,yoffs:2,xpad:.59082,sc:.833333,w:10,h:15},{c:278,x0:530,y0:103,yoffs:-2,xpad:.719727,sc:.833333,w:12,h:19},{c:279,x0:114,y0:539,yoffs:2,xpad:.117188,sc:.833333,w:10,h:15},{c:280,x0:612,y0:222,yoffs:3,xpad:.719727,sc:.833333,w:12,h:18},{c:281,x0:954,y0:660,yoffs:7,xpad:.117188,sc:.833333,w:10,h:14},{c:282,x0:553,y0:103,yoffs:-2,xpad:.719727,sc:.833333,w:12,h:19},{c:283,x0:135,y0:539,yoffs:2,xpad:.117188,sc:.833333,w:10,h:15},{c:284,x0:635,y0:222,yoffs:-1,xpad:.978516,sc:.833333,w:12,h:18},{c:285,x0:576,y0:103,yoffs:2,xpad:1.34766,sc:.833333,w:10,h:19},{c:286,x0:597,y0:103,yoffs:-2,xpad:.370117,sc:.833333,w:14,h:19},{c:287,x0:622,y0:103,yoffs:2,sc:.833333,w:10,h:19},{c:288,x0:643,y0:103,yoffs:-2,xpad:.370117,sc:.833333,w:14,h:19},{c:289,x0:668,y0:103,yoffs:2,sc:.833333,w:10,h:19},{c:290,x0:658,y0:222,yoffs:3,xpad:.370117,sc:.833333,w:14,h:18},{c:291,x0:300,y0:73,yoffs:1,sc:.833333,w:10,h:20},{c:292,x0:683,y0:222,yoffs:-1,xpad:.710938,sc:.833333,w:13,h:18},{c:293,x0:689,y0:103,yoffs:-2,sc:.833333,w:13,h:19},{c:294,x0:975,y0:660,yoffs:3,sc:.833333,w:16,h:14},{c:295,x0:156,y0:539,yoffs:2,xpad:.0400391,sc:.833333,w:11,h:15},{c:296,x0:707,y0:222,yoffs:-1,sc:.833333,w:8,h:18},{c:297,x0:341,y0:453,yoffs:1,sc:.833333,w:9,h:16},{c:298,x0:726,y0:222,yoffs:-1,sc:.833333,w:9,h:18},{c:299,x0:1002,y0:659,yoffs:3,sc:.833333,w:8,h:14},{c:300,x0:746,y0:222,yoffs:-1,sc:.833333,w:7,h:18},{c:301,x0:178,y0:539,yoffs:2,sc:.833333,w:8,h:15},{c:302,x0:764,y0:222,yoffs:3,sc:.833333,w:7,h:18},{c:303,x0:713,y0:103,yoffs:2,xpad:.181641,sc:.833333,w:6,h:19},{c:304,x0:730,y0:102,yoffs:-2,sc:.833333,w:7,h:19},{c:305,x0:854,y0:926,yoffs:7,xpad:.181641,sc:.833333,w:6,h:10},{c:306,x0:782,y0:221,yoffs:3,xpad:.637695,sc:.833333,w:13,h:18},{c:307,x0:748,y0:102,yoffs:2,xpad:1.12891,sc:.833333,w:11,h:19},{c:308,x0:388,y0:40,yoffs:-1,sc:.833333,w:9,h:21},{c:309,x0:770,y0:102,yoffs:2,sc:.833333,w:9,h:19},{c:310,x0:806,y0:221,yoffs:3,sc:.833333,w:14,h:18},{c:311,x0:790,y0:102,yoffs:2,xpad:.00585938,sc:.833333,w:11,h:19},{c:312,x0:297,y0:869,yoffs:6,sc:.833333,w:12,h:11},{c:313,x0:812,y0:102,yoffs:-2,xpad:.285156,sc:.833333,w:12,h:19},{c:314,x0:321,y0:73,yoffs:-3,sc:.833333,w:7,h:20},{c:315,x0:831,y0:221,yoffs:3,xpad:.285156,sc:.833333,w:12,h:18},{c:316,x0:835,y0:102,yoffs:2,sc:.833333,w:6,h:19},{c:317,x0:5,y0:695,yoffs:3,xpad:.285156,sc:.833333,w:12,h:14},{c:318,x0:197,y0:539,yoffs:2,sc:.833333,w:8,h:15},{c:319,x0:28,y0:695,yoffs:3,xpad:.285156,sc:.833333,w:12,h:14},{c:320,x0:216,y0:539,yoffs:2,sc:.833333,w:9,h:15},{c:321,x0:51,y0:695,yoffs:3,xpad:.207031,sc:.833333,w:12,h:14},{c:322,x0:236,y0:537,yoffs:2,sc:.833333,w:8,h:15},{c:323,x0:852,y0:102,yoffs:-2,sc:.833333,w:14,h:19},{c:324,x0:255,y0:536,yoffs:2,sc:.833333,w:12,h:15},{c:325,x0:854,y0:221,yoffs:3,sc:.833333,w:14,h:18},{c:326,x0:74,y0:695,yoffs:7,sc:.833333,w:12,h:14},{c:327,x0:877,y0:102,yoffs:-2,sc:.833333,w:14,h:19},{c:328,x0:278,y0:536,yoffs:2,sc:.833333,w:12,h:15},{c:329,x0:97,y0:695,yoffs:3,xpad:.803711,sc:.833333,w:13,h:14},{c:330,x0:879,y0:221,yoffs:3,sc:.833333,w:14,h:18},{c:331,x0:121,y0:695,yoffs:7,xpad:1.33301,sc:.833333,w:10,h:14},{c:332,x0:904,y0:221,yoffs:-1,xpad:.667969,sc:.833333,w:14,h:18},{c:333,x0:142,y0:695,yoffs:3,xpad:.600586,sc:.833333,w:10,h:14},{c:334,x0:929,y0:221,yoffs:-1,xpad:.31543,sc:.833333,w:13,h:18},{c:335,x0:361,y0:453,yoffs:1,sc:.833333,w:11,h:16},{c:336,x0:902,y0:102,yoffs:-2,xpad:.667969,sc:.833333,w:14,h:19},{c:337,x0:301,y0:536,yoffs:2,sc:.833333,w:11,h:15},{c:338,x0:163,y0:695,yoffs:3,xpad:1.30664,sc:.833333,w:18,h:14},{c:339,x0:871,y0:926,yoffs:7,xpad:.336914,sc:.833333,w:15,h:10},{c:340,x0:927,y0:102,yoffs:-2,sc:.833333,w:13,h:19},{c:341,x0:323,y0:536,yoffs:2,sc:.833333,w:9,h:15},{c:342,x0:953,y0:221,yoffs:3,sc:.833333,w:13,h:18},{c:343,x0:192,y0:695,yoffs:7,sc:.833333,w:9,h:14},{c:344,x0:951,y0:102,yoffs:-2,sc:.833333,w:13,h:19},{c:345,x0:343,y0:536,yoffs:2,sc:.833333,w:9,h:15},{c:346,x0:975,y0:102,yoffs:-2,xpad:.898438,sc:.833333,w:10,h:19},{c:347,x0:363,y0:536,yoffs:2,xpad:.701172,sc:.833333,w:8,h:15},{c:348,x0:977,y0:221,yoffs:-1,sc:.833333,w:10,h:18},{c:349,x0:382,y0:536,yoffs:2,sc:.833333,w:9,h:15},{c:350,x0:998,y0:221,yoffs:3,xpad:.898438,sc:.833333,w:10,h:18},{c:351,x0:212,y0:695,yoffs:7,xpad:.701172,sc:.833333,w:8,h:14},{c:352,x0:996,y0:102,yoffs:-2,xpad:.898438,sc:.833333,w:10,h:19},{c:353,x0:402,y0:534,yoffs:2,sc:.833333,w:9,h:15},{c:354,x0:5,y0:257,yoffs:3,xpad:.0322266,sc:.833333,w:13,h:18},{c:355,x0:676,y0:338,yoffs:4,sc:.833333,w:8,h:17},{c:356,x0:5,y0:138,yoffs:-2,xpad:.0322266,sc:.833333,w:13,h:19},{c:357,x0:422,y0:534,yoffs:2,sc:.833333,w:8,h:15},{c:358,x0:231,y0:695,yoffs:3,xpad:.0322266,sc:.833333,w:13,h:14},{c:359,x0:114,y0:845,yoffs:4,sc:.833333,w:8,h:13},{c:360,x0:29,y0:257,yoffs:-1,xpad:.93457,sc:.833333,w:12,h:18},{c:361,x0:383,y0:453,yoffs:1,xpad:1.01563,sc:.833333,w:10,h:16},{c:362,x0:52,y0:257,yoffs:-1,sc:.833333,w:14,h:18},{c:363,x0:255,y0:695,yoffs:3,xpad:.00585938,sc:.833333,w:11,h:14},{c:364,x0:77,y0:257,yoffs:-1,xpad:.93457,sc:.833333,w:12,h:18},{c:365,x0:404,y0:453,yoffs:1,xpad:1.01563,sc:.833333,w:10,h:16},{c:366,x0:29,y0:138,yoffs:-2,sc:.833333,w:14,h:19},{c:367,x0:441,y0:534,yoffs:2,xpad:.00585938,sc:.833333,w:11,h:15},{c:368,x0:54,y0:137,yoffs:-2,sc:.833333,w:14,h:19},{c:369,x0:463,y0:533,yoffs:2,xpad:.00585938,sc:.833333,w:11,h:15},{c:370,x0:100,y0:257,yoffs:3,sc:.833333,w:14,h:18},{c:371,x0:277,y0:695,yoffs:7,xpad:.00585938,sc:.833333,w:11,h:14},{c:372,x0:79,y0:137,yoffs:-2,sc:.833333,w:21,h:19},{c:373,x0:485,y0:533,yoffs:2,xpad:.355469,sc:.833333,w:14,h:15},{c:374,x0:111,y0:137,yoffs:-2,sc:.833333,w:14,h:19},{c:375,x0:136,y0:136,yoffs:2,sc:.833333,w:10,h:19},{c:376,x0:125,y0:255,yoffs:-1,sc:.833333,w:14,h:18},{c:377,x0:157,y0:136,yoffs:-2,xpad:.299805,sc:.833333,w:12,h:19},{c:378,x0:510,y0:533,yoffs:2,xpad:.731445,sc:.833333,w:9,h:15},{c:379,x0:180,y0:136,yoffs:-2,xpad:.299805,sc:.833333,w:12,h:19},{c:380,x0:530,y0:533,yoffs:2,xpad:.731445,sc:.833333,w:9,h:15},{c:381,x0:203,y0:135,yoffs:-2,xpad:.299805,sc:.833333,w:12,h:19},{c:382,x0:550,y0:533,yoffs:2,xpad:.731445,sc:.833333,w:9,h:15},{c:383,x0:570,y0:532,yoffs:2,sc:.833333,w:9,h:15},{c:384,x0:590,y0:532,yoffs:2,xpad:.347656,sc:.833333,w:11,h:15},{c:385,x0:299,y0:693,yoffs:3,xpad:.233398,sc:.833333,w:14,h:14},{c:386,x0:324,y0:692,yoffs:3,xpad:.435547,sc:.833333,w:11,h:14},{c:387,x0:612,y0:532,yoffs:2,xpad:.347656,sc:.833333,w:11,h:15},{c:388,x0:346,y0:692,yoffs:3,sc:.833333,w:12,h:14},{c:389,x0:634,y0:532,yoffs:2,xpad:.362305,sc:.833333,w:11,h:15},{c:390,x0:369,y0:692,yoffs:3,xpad:.416016,sc:.833333,w:11,h:14},{c:391,x0:695,y0:338,sc:.833333,w:13,h:17},{c:392,x0:656,y0:532,yoffs:2,sc:.833333,w:11,h:15},{c:393,x0:391,y0:692,yoffs:3,xpad:.261719,sc:.833333,w:13,h:14},{c:394,x0:415,y0:692,yoffs:3,xpad:.449219,sc:.833333,w:15,h:14},{c:395,x0:441,y0:692,yoffs:3,xpad:1.43555,sc:.833333,w:10,h:14},{c:396,x0:678,y0:532,yoffs:2,xpad:1.34766,sc:.833333,w:10,h:15},{c:397,x0:699,y0:531,yoffs:6,xpad:.09375,sc:.833333,w:11,h:15},{c:398,x0:462,y0:690,yoffs:3,xpad:1.03906,sc:.833333,w:9,h:14},{c:399,x0:482,y0:690,yoffs:3,xpad:.643555,sc:.833333,w:14,h:14},{c:400,x0:507,y0:689,yoffs:3,xpad:.616211,sc:.833333,w:11,h:14},{c:401,x0:150,y0:255,yoffs:3,xpad:.161133,sc:.833333,w:10,h:18},{c:402,x0:171,y0:255,yoffs:3,xpad:.790039,sc:.833333,w:9,h:18},{c:403,x0:719,y0:338,sc:.833333,w:14,h:17},{c:404,x0:191,y0:254,yoffs:3,sc:.833333,w:12,h:18},{c:405,x0:721,y0:531,yoffs:2,xpad:.69043,sc:.833333,w:17,h:15},{c:406,x0:529,y0:689,yoffs:3,sc:.833333,w:8,h:14},{c:407,x0:548,y0:689,yoffs:3,sc:.833333,w:7,h:14},{c:408,x0:566,y0:689,yoffs:3,sc:.833333,w:12,h:14},{c:409,x0:749,y0:531,yoffs:2,sc:.833333,w:12,h:15},{c:410,x0:772,y0:531,yoffs:2,sc:.833333,w:6,h:15},{c:411,x0:789,y0:531,yoffs:2,xpad:.0205078,sc:.833333,w:11,h:15},{c:412,x0:589,y0:689,yoffs:3,xpad:1.5498,sc:.833333,w:17,h:14},{c:413,x0:214,y0:254,yoffs:3,xpad:.892578,sc:.833333,w:14,h:18},{c:414,x0:811,y0:531,yoffs:6,xpad:.777344,sc:.833333,w:11,h:15},{c:415,x0:617,y0:688,yoffs:3,xpad:.267578,sc:.833333,w:14,h:14},{c:416,x0:744,y0:338,xpad:.31543,sc:.833333,w:13,h:17},{c:417,x0:833,y0:531,yoffs:2,sc:.833333,w:11,h:15},{c:418,x0:642,y0:688,yoffs:3,xpad:1.27344,sc:.833333,w:19,h:14},{c:419,x0:855,y0:531,yoffs:6,xpad:.650391,sc:.833333,w:16,h:15},{c:420,x0:672,y0:688,yoffs:3,xpad:.442383,sc:.833333,w:13,h:14},{c:421,x0:226,y0:135,yoffs:2,xpad:.347656,sc:.833333,w:11,h:19},{c:422,x0:882,y0:531,yoffs:3,sc:.833333,w:12,h:15},{c:423,x0:696,y0:688,yoffs:3,sc:.833333,w:10,h:14},{c:424,x0:320,y0:869,yoffs:6,sc:.833333,w:9,h:11},{c:425,x0:717,y0:688,yoffs:3,sc:.833333,w:11,h:14},{c:426,x0:248,y0:135,yoffs:2,sc:.833333,w:10,h:19},{c:427,x0:768,y0:338,yoffs:4,sc:.833333,w:8,h:17},{c:428,x0:739,y0:688,yoffs:3,xpad:.0742188,sc:.833333,w:11,h:14},{c:429,x0:905,y0:530,yoffs:2,sc:.833333,w:8,h:15},{c:430,x0:239,y0:254,yoffs:3,sc:.833333,w:11,h:18},{c:431,x0:261,y0:253,yoffs:-1,sc:.833333,w:14,h:18},{c:432,x0:924,y0:530,yoffs:2,sc:.833333,w:12,h:15},{c:433,x0:761,y0:687,yoffs:3,xpad:.0869141,sc:.833333,w:14,h:14},{c:434,x0:786,y0:686,yoffs:3,xpad:.549805,sc:.833333,w:13,h:14},{c:435,x0:810,y0:686,yoffs:3,sc:.833333,w:12,h:14},{c:436,x0:947,y0:529,yoffs:6,xpad:.0205078,sc:.833333,w:11,h:15},{c:437,x0:833,y0:686,yoffs:3,xpad:.375977,sc:.833333,w:10,h:14},{c:438,x0:340,y0:869,yoffs:6,sc:.833333,w:9,h:11},{c:439,x0:854,y0:686,yoffs:3,xpad:.59082,sc:.833333,w:10,h:14},{c:440,x0:875,y0:686,yoffs:3,sc:.833333,w:11,h:14},{c:441,x0:969,y0:529,yoffs:6,xpad:.415039,sc:.833333,w:10,h:15},{c:442,x0:990,y0:529,yoffs:6,xpad:.415039,sc:.833333,w:10,h:15},{c:443,x0:5,y0:565,yoffs:2,xpad:.214844,sc:.833333,w:10,h:15},{c:444,x0:897,y0:686,yoffs:3,xpad:.361328,sc:.833333,w:10,h:14},{c:445,x0:360,y0:867,yoffs:6,sc:.833333,w:10,h:11},{c:446,x0:133,y0:845,yoffs:4,sc:.833333,w:9,h:13},{c:447,x0:26,y0:565,yoffs:6,xpad:.347656,sc:.833333,w:11,h:15},{c:448,x0:48,y0:565,yoffs:2,xpad:1.21484,sc:.833333,w:4,h:15},{c:449,x0:63,y0:565,yoffs:2,xpad:.873047,sc:.833333,w:9,h:15},{c:450,x0:83,y0:565,yoffs:2,xpad:.248047,sc:.833333,w:9,h:15},{c:451,x0:918,y0:686,yoffs:3,xpad:.126953,sc:.833333,w:5,h:14},{c:452,x0:286,y0:253,yoffs:-1,sc:.833333,w:24,h:18},{c:453,x0:103,y0:565,yoffs:2,xpad:.0117188,sc:.833333,w:22,h:15},{c:454,x0:136,y0:565,yoffs:2,xpad:.0927734,sc:.833333,w:20,h:15},{c:455,x0:787,y0:338,yoffs:3,xpad:1.05957,sc:.833333,w:15,h:17},{c:456,x0:269,y0:134,yoffs:2,xpad:.595703,sc:.833333,w:15,h:19},{c:457,x0:295,y0:134,yoffs:2,xpad:.932617,sc:.833333,w:10,h:19},{c:458,x0:813,y0:337,yoffs:3,xpad:1.50781,sc:.833333,w:19,h:17},{c:459,x0:316,y0:134,yoffs:2,xpad:1.03906,sc:.833333,w:19,h:19},{c:460,x0:346,y0:134,yoffs:2,xpad:1.24121,sc:.833333,w:16,h:19},{c:461,x0:321,y0:252,yoffs:-1,sc:.833333,w:13,h:18},{c:462,x0:425,y0:452,yoffs:1,xpad:1.21973,sc:.833333,w:9,h:16},{c:463,x0:345,y0:252,yoffs:-1,sc:.833333,w:8,h:18},{c:464,x0:445,y0:452,yoffs:1,sc:.833333,w:8,h:16},{c:465,x0:364,y0:252,yoffs:-1,xpad:.31543,sc:.833333,w:13,h:18},{c:466,x0:464,y0:452,yoffs:1,sc:.833333,w:11,h:16},{c:467,x0:388,y0:252,yoffs:-1,xpad:.93457,sc:.833333,w:12,h:18},{c:468,x0:486,y0:452,yoffs:1,xpad:1.01563,sc:.833333,w:10,h:16},{c:469,x0:339,y0:73,yoffs:-3,xpad:.93457,sc:.833333,w:12,h:20},{c:470,x0:843,y0:337,xpad:1.01563,sc:.833333,w:10,h:17},{c:471,x0:408,y0:40,yoffs:-4,xpad:.93457,sc:.833333,w:12,h:21},{c:472,x0:411,y0:252,yoffs:-1,xpad:1.01563,sc:.833333,w:10,h:18},{c:473,x0:431,y0:40,yoffs:-4,xpad:.93457,sc:.833333,w:12,h:21},{c:474,x0:432,y0:252,yoffs:-1,xpad:1.01563,sc:.833333,w:10,h:18},{c:475,x0:454,y0:40,yoffs:-4,xpad:.93457,sc:.833333,w:12,h:21},{c:476,x0:453,y0:251,yoffs:-1,xpad:1.01563,sc:.833333,w:10,h:18},{c:477,x0:381,y0:867,yoffs:6,xpad:.59082,sc:.833333,w:10,h:11},{c:478,x0:362,y0:73,yoffs:-3,sc:.833333,w:13,h:20},{c:479,x0:864,y0:337,xpad:.825195,sc:.833333,w:10,h:17},{c:480,x0:386,y0:72,yoffs:-3,sc:.833333,w:13,h:20},{c:481,x0:885,y0:337,xpad:.825195,sc:.833333,w:10,h:17},{c:482,x0:906,y0:337,xpad:.0654297,sc:.833333,w:17,h:17},{c:483,x0:934,y0:686,yoffs:3,xpad:.435547,sc:.833333,w:16,h:14},{c:484,x0:961,y0:685,yoffs:3,sc:.833333,w:13,h:14},{c:485,x0:167,y0:565,yoffs:6,sc:.833333,w:12,h:15},{c:486,x0:474,y0:251,yoffs:-1,xpad:.978516,sc:.833333,w:12,h:18},{c:487,x0:373,y0:134,yoffs:2,xpad:1.34766,sc:.833333,w:10,h:19},{c:488,x0:497,y0:251,yoffs:-1,sc:.833333,w:12,h:18},{c:489,x0:394,y0:134,yoffs:-2,sc:.833333,w:13,h:19},{c:490,x0:520,y0:251,yoffs:3,xpad:.267578,sc:.833333,w:14,h:18},{c:491,x0:190,y0:565,yoffs:6,xpad:.09375,sc:.833333,w:11,h:15},{c:492,x0:477,y0:40,xpad:.267578,sc:.833333,w:14,h:21},{c:493,x0:545,y0:251,yoffs:3,xpad:.09375,sc:.833333,w:11,h:18},{c:494,x0:567,y0:251,yoffs:-1,xpad:.59082,sc:.833333,w:10,h:18},{c:495,x0:418,y0:133,yoffs:2,xpad:.415039,sc:.833333,w:10,h:19},{c:496,x0:439,y0:133,yoffs:2,sc:.833333,w:9,h:19},{c:497,x0:985,y0:685,yoffs:3,sc:.833333,w:24,h:14},{c:498,x0:5,y0:720,yoffs:3,xpad:.0117188,sc:.833333,w:22,h:14},{c:499,x0:212,y0:565,yoffs:2,xpad:.0927734,sc:.833333,w:20,h:15},{c:500,x0:588,y0:251,yoffs:-1,xpad:.978516,sc:.833333,w:12,h:18},{c:501,x0:459,y0:133,yoffs:2,xpad:1.34766,sc:.833333,w:10,h:19},{c:502,x0:38,y0:720,yoffs:3,xpad:.78418,sc:.833333,w:18,h:14},{c:503,x0:611,y0:251,yoffs:3,xpad:.114258,sc:.833333,w:12,h:18},{c:504,x0:480,y0:133,yoffs:-2,xpad:.954102,sc:.833333,w:12,h:19},{c:505,x0:934,y0:337,xpad:1.08398,sc:.833333,w:10,h:17},{c:506,x0:634,y0:251,yoffs:-1,sc:.833333,w:13,h:18},{c:507,x0:658,y0:251,yoffs:-1,xpad:.825195,sc:.833333,w:10,h:18},{c:508,x0:679,y0:251,yoffs:-1,xpad:.0654297,sc:.833333,w:17,h:18},{c:509,x0:243,y0:563,yoffs:2,xpad:.435547,sc:.833333,w:16,h:15},{c:510,x0:707,y0:251,yoffs:-1,xpad:.267578,sc:.833333,w:14,h:18},{c:511,x0:270,y0:562,yoffs:2,xpad:.09375,sc:.833333,w:11,h:15},{c:512,x0:732,y0:251,yoffs:-1,sc:.833333,w:13,h:18},{c:513,x0:292,y0:562,yoffs:2,xpad:.825195,sc:.833333,w:10,h:15},{c:514,x0:756,y0:251,yoffs:-1,sc:.833333,w:13,h:18},{c:515,x0:313,y0:562,yoffs:2,xpad:.825195,sc:.833333,w:10,h:15},{c:516,x0:780,y0:251,yoffs:-1,xpad:1.03906,sc:.833333,w:9,h:18},{c:517,x0:334,y0:562,yoffs:2,xpad:.59082,sc:.833333,w:10,h:15},{c:518,x0:800,y0:250,yoffs:-1,xpad:1.03906,sc:.833333,w:9,h:18},{c:519,x0:355,y0:562,yoffs:2,xpad:.59082,sc:.833333,w:10,h:15},{c:520,x0:820,y0:250,yoffs:-1,sc:.833333,w:9,h:18},{c:521,x0:376,y0:562,yoffs:2,sc:.833333,w:9,h:15},{c:522,x0:840,y0:250,yoffs:-1,sc:.833333,w:7,h:18},{c:523,x0:396,y0:562,yoffs:2,sc:.833333,w:8,h:15},{c:524,x0:858,y0:250,yoffs:-1,xpad:.267578,sc:.833333,w:14,h:18},{c:525,x0:415,y0:560,yoffs:2,xpad:.09375,sc:.833333,w:11,h:15},{c:526,x0:883,y0:250,yoffs:-1,xpad:.267578,sc:.833333,w:14,h:18},{c:527,x0:437,y0:560,yoffs:2,xpad:.09375,sc:.833333,w:11,h:15},{c:528,x0:908,y0:250,yoffs:-1,sc:.833333,w:12,h:18},{c:529,x0:459,y0:560,yoffs:2,sc:.833333,w:9,h:15},{c:530,x0:931,y0:250,yoffs:-1,sc:.833333,w:12,h:18},{c:531,x0:479,y0:559,yoffs:2,xpad:.134766,sc:.833333,w:8,h:15},{c:532,x0:954,y0:250,yoffs:-1,xpad:.549805,sc:.833333,w:13,h:18},{c:533,x0:498,y0:559,yoffs:2,xpad:.777344,sc:.833333,w:11,h:15},{c:534,x0:978,y0:250,yoffs:-1,xpad:.549805,sc:.833333,w:13,h:18},{c:535,x0:520,y0:559,yoffs:2,xpad:.777344,sc:.833333,w:11,h:15},{c:536,x0:1002,y0:250,yoffs:3,xpad:.898438,sc:.833333,w:10,h:18},{c:537,x0:67,y0:720,yoffs:7,xpad:.701172,sc:.833333,w:8,h:14},{c:538,x0:5,y0:286,yoffs:3,xpad:.0322266,sc:.833333,w:13,h:18},{c:539,x0:955,y0:337,yoffs:4,sc:.833333,w:8,h:17},{c:540,x0:974,y0:337,yoffs:3,xpad:.274414,sc:.833333,w:11,h:17},{c:541,x0:542,y0:559,yoffs:6,xpad:.0673828,sc:.833333,w:9,h:15},{c:542,x0:29,y0:286,yoffs:-1,xpad:.710938,sc:.833333,w:13,h:18},{c:543,x0:503,y0:133,yoffs:-2,xpad:.763672,sc:.833333,w:12,h:19},{c:544,x0:53,y0:286,yoffs:3,xpad:.637695,sc:.833333,w:13,h:18},{c:545,x0:996,y0:337,yoffs:2,sc:.833333,w:16,h:17},{c:546,x0:86,y0:720,yoffs:3,xpad:.730469,sc:.833333,w:13,h:14},{c:547,x0:562,y0:559,yoffs:2,xpad:.274414,sc:.833333,w:11,h:15},{c:548,x0:77,y0:286,yoffs:3,xpad:.375977,sc:.833333,w:10,h:18},{c:549,x0:584,y0:558,yoffs:6,sc:.833333,w:9,h:15},{c:550,x0:98,y0:286,yoffs:-1,sc:.833333,w:13,h:18},{c:551,x0:604,y0:558,yoffs:2,xpad:.825195,sc:.833333,w:10,h:15},{c:552,x0:122,y0:286,yoffs:3,xpad:1.03906,sc:.833333,w:9,h:18},{c:553,x0:625,y0:558,yoffs:6,xpad:.59082,sc:.833333,w:10,h:15},{c:554,x0:410,y0:72,yoffs:-3,xpad:.267578,sc:.833333,w:14,h:20},{c:555,x0:5,y0:373,xpad:.09375,sc:.833333,w:11,h:17},{c:556,x0:435,y0:72,yoffs:-3,xpad:.267578,sc:.833333,w:14,h:20},{c:557,x0:27,y0:373,xpad:.09375,sc:.833333,w:11,h:17},{c:558,x0:142,y0:284,yoffs:-1,xpad:.267578,sc:.833333,w:14,h:18},{c:559,x0:646,y0:558,yoffs:2,xpad:.09375,sc:.833333,w:11,h:15},{c:560,x0:460,y0:72,yoffs:-3,xpad:.267578,sc:.833333,w:14,h:20},{c:561,x0:49,y0:373,xpad:.09375,sc:.833333,w:11,h:17},{c:562,x0:71,y0:373,sc:.833333,w:12,h:17},{c:563,x0:167,y0:284,yoffs:3,sc:.833333,w:11,h:18},{c:564,x0:668,y0:558,yoffs:2,sc:.833333,w:8,h:15},{c:565,x0:402,y0:867,yoffs:6,sc:.833333,w:14,h:11},{c:566,x0:153,y0:845,yoffs:4,sc:.833333,w:9,h:13},{c:567,x0:110,y0:720,yoffs:7,xpad:.947266,sc:.833333,w:5,h:14},{c:568,x0:687,y0:558,yoffs:2,xpad:.226563,sc:.833333,w:17,h:15},{c:569,x0:715,y0:557,yoffs:6,xpad:.226563,sc:.833333,w:17,h:15},{c:570,x0:507,y0:452,yoffs:2,sc:.833333,w:13,h:16},{c:571,x0:531,y0:451,yoffs:2,xpad:.416016,sc:.833333,w:11,h:16},{c:572,x0:189,y0:284,yoffs:2,sc:.833333,w:10,h:18},{c:573,x0:126,y0:720,yoffs:3,xpad:.126953,sc:.833333,w:10,h:14},{c:574,x0:553,y0:451,yoffs:2,sc:.833333,w:11,h:16},{c:575,x0:743,y0:557,yoffs:6,sc:.833333,w:9,h:15},{c:576,x0:763,y0:557,yoffs:6,sc:.833333,w:9,h:15},{c:577,x0:147,y0:720,yoffs:3,sc:.833333,w:9,h:14},{c:578,x0:427,y0:866,yoffs:6,sc:.833333,w:9,h:11},{c:579,x0:167,y0:720,yoffs:3,xpad:.0458984,sc:.833333,w:12,h:14},{c:580,x0:190,y0:720,yoffs:3,sc:.833333,w:14,h:14},{c:581,x0:215,y0:720,yoffs:3,sc:.833333,w:12,h:14},{c:582,x0:575,y0:451,yoffs:2,xpad:1.03906,sc:.833333,w:9,h:16},{c:583,x0:210,y0:283,yoffs:2,xpad:.59082,sc:.833333,w:10,h:18},{c:584,x0:94,y0:373,yoffs:3,sc:.833333,w:8,h:17},{c:585,x0:526,y0:133,yoffs:2,sc:.833333,w:8,h:19},{c:586,x0:231,y0:283,yoffs:3,sc:.833333,w:15,h:18},{c:587,x0:783,y0:557,yoffs:6,sc:.833333,w:12,h:15},{c:588,x0:238,y0:720,yoffs:3,sc:.833333,w:12,h:14},{c:589,x0:447,y0:866,yoffs:6,xpad:.134766,sc:.833333,w:8,h:11},{c:590,x0:261,y0:720,yoffs:3,sc:.833333,w:12,h:14},{c:591,x0:806,y0:557,yoffs:6,sc:.833333,w:11,h:15},{c:592,x0:466,y0:866,yoffs:6,sc:.833333,w:11,h:11},{c:593,x0:488,y0:866,yoffs:6,xpad:1.1377,sc:.833333,w:10,h:11},{c:594,x0:509,y0:866,yoffs:6,xpad:.347656,sc:.833333,w:11,h:11},{c:595,x0:828,y0:557,yoffs:2,xpad:.347656,sc:.833333,w:11,h:15},{c:596,x0:531,y0:866,yoffs:6,xpad:.213867,sc:.833333,w:9,h:11},{c:597,x0:884,y0:835,yoffs:6,sc:.833333,w:10,h:12},{c:598,x0:545,y0:133,yoffs:2,sc:.833333,w:12,h:19},{c:599,x0:850,y0:557,yoffs:2,sc:.833333,w:12,h:15},{c:600,x0:551,y0:864,yoffs:6,xpad:.59082,sc:.833333,w:10,h:11},{c:601,x0:381,y0:867,yoffs:6,xpad:.59082,sc:.833333,w:10,h:11},{c:602,x0:572,y0:864,yoffs:6,sc:.833333,w:16,h:11},{c:603,x0:599,y0:863,yoffs:6,sc:.833333,w:10,h:11},{c:604,x0:620,y0:863,yoffs:6,sc:.833333,w:10,h:11},{c:605,x0:641,y0:863,yoffs:6,sc:.833333,w:15,h:11},{c:606,x0:667,y0:863,yoffs:6,xpad:.274414,sc:.833333,w:11,h:11},{c:607,x0:873,y0:557,yoffs:6,sc:.833333,w:8,h:15},{c:608,x0:568,y0:133,yoffs:2,sc:.833333,w:12,h:19},{c:609,x0:892,y0:557,yoffs:6,xpad:1.30859,sc:.833333,w:10,h:15},{c:610,x0:689,y0:863,yoffs:6,xpad:.737305,sc:.833333,w:10,h:11},{c:611,x0:913,y0:556,yoffs:6,sc:.833333,w:11,h:15},{c:612,x0:710,y0:861,yoffs:6,sc:.833333,w:11,h:11},{c:613,x0:935,y0:556,yoffs:6,xpad:.777344,sc:.833333,w:11,h:15},{c:614,x0:957,y0:555,yoffs:2,xpad:.777344,sc:.833333,w:11,h:15},{c:615,x0:591,y0:133,yoffs:2,xpad:.777344,sc:.833333,w:11,h:19},{c:616,x0:979,y0:555,yoffs:2,sc:.833333,w:6,h:15},{c:617,x0:732,y0:861,yoffs:6,xpad:.294922,sc:.833333,w:7,h:11},{c:618,x0:750,y0:861,yoffs:6,sc:.833333,w:7,h:11},{c:619,x0:996,y0:555,yoffs:2,sc:.833333,w:8,h:15},{c:620,x0:5,y0:591,yoffs:2,sc:.833333,w:9,h:15},{c:621,x0:613,y0:133,yoffs:2,sc:.833333,w:7,h:19},{c:622,x0:631,y0:133,yoffs:2,xpad:.623047,sc:.833333,w:13,h:19},{c:623,x0:768,y0:861,yoffs:6,xpad:.602539,sc:.833333,w:17,h:11},{c:624,x0:25,y0:591,yoffs:6,xpad:.602539,sc:.833333,w:17,h:15},{c:625,x0:53,y0:591,yoffs:6,xpad:.602539,sc:.833333,w:17,h:15},{c:626,x0:81,y0:591,yoffs:6,xpad:.314453,sc:.833333,w:12,h:15},{c:627,x0:104,y0:591,yoffs:6,sc:.833333,w:13,h:15},{c:628,x0:796,y0:861,yoffs:6,xpad:.905273,sc:.833333,w:12,h:11},{c:629,x0:819,y0:861,yoffs:6,xpad:.09375,sc:.833333,w:11,h:11},{c:630,x0:841,y0:860,yoffs:6,xpad:.629883,sc:.833333,w:15,h:11},{c:631,x0:867,y0:858,yoffs:6,sc:.833333,w:15,h:11},{c:632,x0:655,y0:133,yoffs:2,xpad:.589844,sc:.833333,w:14,h:19},{c:633,x0:893,y0:858,yoffs:6,xpad:1.13477,sc:.833333,w:7,h:11},{c:634,x0:128,y0:591,yoffs:2,xpad:1.13477,sc:.833333,w:7,h:15},{c:635,x0:146,y0:591,yoffs:6,sc:.833333,w:9,h:15},{c:636,x0:166,y0:591,yoffs:6,xpad:.134766,sc:.833333,w:8,h:15},{c:637,x0:185,y0:591,yoffs:6,xpad:.134766,sc:.833333,w:8,h:15},{c:638,x0:911,y0:858,yoffs:6,xpad:.133789,sc:.833333,w:7,h:11},{c:639,x0:204,y0:591,yoffs:6,xpad:1.13379,sc:.833333,w:6,h:15},{c:640,x0:929,y0:858,yoffs:6,sc:.833333,w:11,h:11},{c:641,x0:951,y0:858,yoffs:6,sc:.833333,w:11,h:11},{c:642,x0:221,y0:591,yoffs:6,sc:.833333,w:9,h:15},{c:643,x0:680,y0:133,yoffs:2,sc:.833333,w:8,h:19},{c:644,x0:699,y0:133,yoffs:2,sc:.833333,w:8,h:19},{c:645,x0:241,y0:591,yoffs:6,sc:.833333,w:8,h:15},{c:646,x0:718,y0:133,yoffs:2,sc:.833333,w:9,h:19},{c:647,x0:173,y0:845,yoffs:6,sc:.833333,w:8,h:13},{c:648,x0:113,y0:373,yoffs:4,sc:.833333,w:8,h:17},{c:649,x0:973,y0:858,yoffs:6,sc:.833333,w:12,h:11},{c:650,x0:996,y0:858,yoffs:6,sc:.833333,w:12,h:11},{c:651,x0:5,y0:892,yoffs:6,xpad:1.00684,sc:.833333,w:11,h:11},{c:652,x0:27,y0:892,yoffs:6,sc:.833333,w:11,h:11},{c:653,x0:49,y0:892,yoffs:6,sc:.833333,w:16,h:11},{c:654,x0:260,y0:589,yoffs:2,sc:.833333,w:11,h:15},{c:655,x0:76,y0:892,yoffs:6,sc:.833333,w:11,h:11},{c:656,x0:282,y0:588,yoffs:6,sc:.833333,w:10,h:15},{c:657,x0:905,y0:835,yoffs:6,sc:.833333,w:11,h:12},{c:658,x0:303,y0:588,yoffs:6,xpad:.415039,sc:.833333,w:10,h:15},{c:659,x0:324,y0:588,yoffs:6,xpad:.415039,sc:.833333,w:10,h:15},{c:660,x0:345,y0:588,yoffs:2,sc:.833333,w:9,h:15},{c:661,x0:365,y0:588,yoffs:2,sc:.833333,w:9,h:15},{c:662,x0:385,y0:588,yoffs:2,sc:.833333,w:9,h:15},{c:663,x0:405,y0:588,yoffs:6,xpad:.213867,sc:.833333,w:9,h:15},{c:664,x0:284,y0:720,yoffs:3,xpad:.267578,sc:.833333,w:14,h:14},{c:665,x0:98,y0:892,yoffs:6,xpad:.274414,sc:.833333,w:11,h:11},{c:666,x0:120,y0:892,yoffs:6,xpad:.274414,sc:.833333,w:11,h:11},{c:667,x0:425,y0:586,yoffs:2,sc:.833333,w:12,h:15},{c:668,x0:142,y0:892,yoffs:6,xpad:.865234,sc:.833333,w:11,h:11},{c:669,x0:738,y0:132,yoffs:2,sc:.833333,w:8,h:19},{c:670,x0:448,y0:586,yoffs:6,xpad:1.11328,sc:.833333,w:10,h:15},{c:671,x0:164,y0:892,yoffs:6,sc:.833333,w:9,h:11},{c:672,x0:757,y0:132,yoffs:2,sc:.833333,w:12,h:19},{c:673,x0:469,y0:586,yoffs:2,sc:.833333,w:9,h:15},{c:674,x0:489,y0:585,yoffs:2,sc:.833333,w:9,h:15},{c:675,x0:509,y0:585,yoffs:2,xpad:.0322266,sc:.833333,w:18,h:15},{c:676,x0:780,y0:132,yoffs:2,xpad:.125977,sc:.833333,w:19,h:19},{c:677,x0:595,y0:451,yoffs:2,sc:.833333,w:20,h:16},{c:678,x0:192,y0:845,yoffs:4,xpad:.624023,sc:.833333,w:14,h:13},{c:679,x0:810,y0:132,yoffs:2,sc:.833333,w:12,h:19},{c:680,x0:217,y0:845,yoffs:4,xpad:.489258,sc:.833333,w:16,h:13},{c:681,x0:833,y0:132,yoffs:2,xpad:1.24121,sc:.833333,w:16,h:19},{c:682,x0:538,y0:585,yoffs:2,sc:.833333,w:13,h:15},{c:683,x0:562,y0:585,yoffs:2,xpad:.15332,sc:.833333,w:12,h:15},{c:684,x0:309,y0:718,yoffs:3,sc:.833333,w:10,h:14},{c:685,x0:330,y0:717,yoffs:3,xpad:.859375,sc:.833333,w:10,h:14},{c:686,x0:585,y0:584,yoffs:6,xpad:.133789,sc:.833333,w:12,h:15},{c:687,x0:608,y0:584,yoffs:6,sc:.833333,w:14,h:15},{c:802,x0:874,y0:947,yoffs:15,sc:.833333,w:4,h:6},{c:856,x0:969,y0:962,yoffs:2,sc:.833333,w:5,h:4},{c:880,x0:351,y0:717,yoffs:3,xpad:.671875,sc:.833333,w:8,h:14},{c:881,x0:184,y0:892,yoffs:6,sc:.833333,w:8,h:11},{c:882,x0:370,y0:717,yoffs:3,sc:.833333,w:13,h:14},{c:883,x0:633,y0:584,yoffs:2,sc:.833333,w:11,h:15},{c:884,x0:985,y0:962,yoffs:3,sc:.833333,w:5,h:4},{c:885,x0:1001,y0:962,yoffs:17,sc:.833333,w:5,h:4},{c:886,x0:394,y0:717,yoffs:3,xpad:.750977,sc:.833333,w:14,h:14},{c:887,x0:203,y0:891,yoffs:6,xpad:.905273,sc:.833333,w:12,h:11},{c:890,x0:5,y0:996,yoffs:17,xpad:2.3418,sc:.833333,w:8,h:4},{c:891,x0:531,y0:866,yoffs:6,xpad:.213867,sc:.833333,w:9,h:11},{c:892,x0:226,y0:891,yoffs:6,xpad:.213867,sc:.833333,w:9,h:11},{c:893,x0:246,y0:891,yoffs:6,xpad:.213867,sc:.833333,w:9,h:11},{c:894,x0:244,y0:845,yoffs:6,xpad:.195313,sc:.833333,w:5,h:13},{c:895,x0:132,y0:373,yoffs:3,xpad:.260742,sc:.833333,w:7,h:17},{c:900,x0:375,y0:976,yoffs:1,xpad:2.3418,sc:.833333,w:8,h:5},{c:901,x0:394,y0:976,yoffs:1,xpad:1.3418,sc:.833333,w:9,h:5},{c:902,x0:655,y0:584,yoffs:2,sc:.833333,w:13,h:15},{c:903,x0:24,y0:996,yoffs:6,xpad:.107422,sc:.833333,w:5,h:4},{c:904,x0:679,y0:584,yoffs:2,xpad:.0996094,sc:.833333,w:12,h:15},{c:905,x0:702,y0:584,yoffs:2,xpad:.771484,sc:.833333,w:15,h:15},{c:906,x0:728,y0:583,yoffs:2,sc:.833333,w:10,h:15},{c:908,x0:749,y0:583,yoffs:2,xpad:.361328,sc:.833333,w:15,h:15},{c:910,x0:775,y0:583,yoffs:2,sc:.833333,w:15,h:15},{c:911,x0:801,y0:583,yoffs:2,sc:.833333,w:16,h:15},{c:912,x0:626,y0:451,yoffs:1,sc:.833333,w:8,h:16},{c:913,x0:419,y0:717,yoffs:3,sc:.833333,w:13,h:14},{c:914,x0:443,y0:717,yoffs:3,sc:.833333,w:12,h:14},{c:915,x0:466,y0:715,yoffs:3,xpad:.0976563,sc:.833333,w:10,h:14},{c:916,x0:487,y0:715,yoffs:3,xpad:.530273,sc:.833333,w:13,h:14},{c:917,x0:511,y0:714,yoffs:3,xpad:.634766,sc:.833333,w:10,h:14},{c:918,x0:532,y0:714,yoffs:3,xpad:.600586,sc:.833333,w:10,h:14},{c:919,x0:553,y0:714,yoffs:3,xpad:1.09082,sc:.833333,w:12,h:14},{c:920,x0:576,y0:714,yoffs:3,xpad:.31543,sc:.833333,w:13,h:14},{c:921,x0:600,y0:714,yoffs:3,xpad:.708008,sc:.833333,w:5,h:14},{c:922,x0:616,y0:714,yoffs:3,sc:.833333,w:12,h:14},{c:923,x0:639,y0:713,yoffs:3,sc:.833333,w:12,h:14},{c:924,x0:662,y0:713,yoffs:3,xpad:.770508,sc:.833333,w:14,h:14},{c:925,x0:687,y0:713,yoffs:3,xpad:.954102,sc:.833333,w:12,h:14},{c:926,x0:710,y0:713,yoffs:3,xpad:1.00098,sc:.833333,w:10,h:14},{c:927,x0:731,y0:713,yoffs:3,xpad:.31543,sc:.833333,w:13,h:14},{c:928,x0:755,y0:713,yoffs:3,xpad:.900391,sc:.833333,w:12,h:14},{c:929,x0:778,y0:712,yoffs:3,xpad:.533203,sc:.833333,w:11,h:14},{c:931,x0:800,y0:711,yoffs:3,sc:.833333,w:11,h:14},{c:932,x0:822,y0:711,yoffs:3,sc:.833333,w:11,h:14},{c:933,x0:844,y0:711,yoffs:3,sc:.833333,w:12,h:14},{c:934,x0:828,y0:583,yoffs:2,xpad:.702148,sc:.833333,w:14,h:15},{c:935,x0:867,y0:711,yoffs:3,sc:.833333,w:11,h:14},{c:936,x0:889,y0:711,yoffs:3,xpad:.477539,sc:.833333,w:14,h:14},{c:937,x0:914,y0:711,yoffs:3,xpad:.697266,sc:.833333,w:14,h:14},{c:938,x0:257,y0:283,yoffs:-1,sc:.833333,w:7,h:18},{c:939,x0:275,y0:282,yoffs:-1,sc:.833333,w:12,h:18},{c:940,x0:645,y0:451,yoffs:1,sc:.833333,w:12,h:16},{c:941,x0:668,y0:451,yoffs:1,sc:.833333,w:10,h:16},{c:942,x0:485,y0:72,yoffs:1,xpad:.777344,sc:.833333,w:11,h:20},{c:943,x0:689,y0:450,yoffs:1,xpad:.294922,sc:.833333,w:7,h:16},{c:944,x0:707,y0:450,yoffs:1,xpad:.5625,sc:.833333,w:11,h:16},{c:945,x0:266,y0:891,yoffs:6,sc:.833333,w:12,h:11},{c:946,x0:298,y0:282,yoffs:2,xpad:.586914,sc:.833333,w:11,h:18},{c:947,x0:939,y0:711,yoffs:6,xpad:.185547,sc:.833333,w:10,h:14},{c:948,x0:853,y0:583,yoffs:2,xpad:.654297,sc:.833333,w:10,h:15},{c:949,x0:289,y0:891,yoffs:6,xpad:.130859,sc:.833333,w:9,h:11},{c:950,x0:320,y0:282,yoffs:2,sc:.833333,w:9,h:18},{c:951,x0:960,y0:711,yoffs:6,xpad:.913086,sc:.833333,w:10,h:14},{c:952,x0:874,y0:583,yoffs:2,xpad:.634766,sc:.833333,w:10,h:15},{c:953,x0:309,y0:891,yoffs:6,sc:.833333,w:6,h:11},{c:954,x0:326,y0:891,yoffs:6,sc:.833333,w:11,h:11},{c:955,x0:895,y0:583,yoffs:2,sc:.833333,w:11,h:15},{c:956,x0:981,y0:710,yoffs:7,sc:.833333,w:11,h:14},{c:957,x0:348,y0:891,yoffs:6,sc:.833333,w:10,h:11},{c:958,x0:340,y0:281,yoffs:2,xpad:.00878906,sc:.833333,w:9,h:18},{c:959,x0:369,y0:889,yoffs:6,xpad:.756836,sc:.833333,w:10,h:11},{c:960,x0:897,y0:924,yoffs:7,xpad:.236328,sc:.833333,w:12,h:10},{c:961,x0:1003,y0:710,yoffs:6,xpad:.0498047,sc:.833333,w:11,h:14},{c:962,x0:5,y0:745,yoffs:6,sc:.833333,w:9,h:14},{c:963,x0:390,y0:889,yoffs:6,xpad:.103516,sc:.833333,w:11,h:11},{c:964,x0:412,y0:889,yoffs:6,xpad:.477539,sc:.833333,w:9,h:11},{c:965,x0:432,y0:888,yoffs:6,xpad:.307617,sc:.833333,w:10,h:11},{c:966,x0:150,y0:373,yoffs:3,xpad:.165039,sc:.833333,w:14,h:17},{c:967,x0:25,y0:745,yoffs:6,sc:.833333,w:11,h:14},{c:968,x0:175,y0:371,yoffs:3,xpad:.404297,sc:.833333,w:14,h:17},{c:969,x0:453,y0:888,yoffs:6,xpad:.404297,sc:.833333,w:14,h:11},{c:970,x0:917,y0:582,yoffs:2,sc:.833333,w:8,h:15},{c:971,x0:936,y0:582,yoffs:2,xpad:.5625,sc:.833333,w:11,h:15},{c:972,x0:729,y0:450,yoffs:1,xpad:.09375,sc:.833333,w:11,h:16},{c:973,x0:751,y0:450,yoffs:1,xpad:.5625,sc:.833333,w:11,h:16},{c:974,x0:773,y0:450,yoffs:1,xpad:.46875,sc:.833333,w:15,h:16},{c:975,x0:360,y0:281,yoffs:3,sc:.833333,w:12,h:18},{c:976,x0:958,y0:581,yoffs:2,xpad:.147461,sc:.833333,w:11,h:15},{c:977,x0:980,y0:581,yoffs:2,xpad:.120117,sc:.833333,w:13,h:15},{c:978,x0:47,y0:745,yoffs:3,sc:.833333,w:12,h:14},{c:979,x0:5,y0:617,yoffs:2,sc:.833333,w:16,h:15},{c:980,x0:383,y0:281,yoffs:-1,sc:.833333,w:12,h:18},{c:981,x0:655,y0:133,yoffs:2,xpad:.589844,sc:.833333,w:14,h:19},{c:982,x0:478,y0:888,yoffs:6,sc:.833333,w:18,h:11},{c:983,x0:32,y0:617,yoffs:6,sc:.833333,w:13,h:15},{c:984,x0:70,y0:745,yoffs:3,xpad:.267578,sc:.833333,w:14,h:14},{c:985,x0:56,y0:617,yoffs:6,xpad:.09375,sc:.833333,w:11,h:15},{c:986,x0:95,y0:745,yoffs:3,xpad:.416016,sc:.833333,w:11,h:14},{c:987,x0:117,y0:745,yoffs:6,sc:.833333,w:10,h:14},{c:988,x0:138,y0:745,yoffs:3,sc:.833333,w:10,h:14},{c:989,x0:78,y0:617,yoffs:6,xpad:.301758,sc:.833333,w:9,h:15},{c:990,x0:159,y0:745,yoffs:3,sc:.833333,w:10,h:14},{c:991,x0:860,y0:132,yoffs:2,sc:.833333,w:10,h:19},{c:992,x0:180,y0:745,yoffs:3,xpad:976563e-9,sc:.833333,w:11,h:14},{c:993,x0:881,y0:132,yoffs:2,sc:.833333,w:11,h:19},{c:1008,x0:507,y0:888,yoffs:6,sc:.833333,w:13,h:11},{c:1009,x0:98,y0:617,yoffs:6,xpad:.09375,sc:.833333,w:11,h:15},{c:1010,x0:531,y0:888,yoffs:6,xpad:.213867,sc:.833333,w:9,h:11},{c:1011,x0:903,y0:132,yoffs:2,sc:.833333,w:7,h:19},{c:1012,x0:617,y0:688,yoffs:3,xpad:.267578,sc:.833333,w:14,h:14},{c:1013,x0:551,y0:886,yoffs:6,xpad:.389648,sc:.833333,w:9,h:11},{c:1014,x0:571,y0:886,yoffs:6,xpad:.174805,sc:.833333,w:9,h:11},{c:1015,x0:202,y0:745,yoffs:3,xpad:.254883,sc:.833333,w:11,h:14},{c:1016,x0:921,y0:132,yoffs:2,xpad:.347656,sc:.833333,w:11,h:19},{c:1017,x0:224,y0:745,yoffs:3,xpad:.416016,sc:.833333,w:11,h:14},{c:1018,x0:246,y0:745,yoffs:3,xpad:.904297,sc:.833333,w:16,h:14},{c:1019,x0:120,y0:617,yoffs:6,xpad:.731445,sc:.833333,w:14,h:15},{c:1020,x0:145,y0:617,yoffs:6,xpad:.0742188,sc:.833333,w:11,h:15},{c:1021,x0:369,y0:692,yoffs:3,xpad:.416016,sc:.833333,w:11,h:14},{c:1022,x0:273,y0:745,yoffs:3,xpad:.416016,sc:.833333,w:11,h:14},{c:1023,x0:295,y0:745,yoffs:3,xpad:.416016,sc:.833333,w:11,h:14},{c:1024,x0:406,y0:281,yoffs:-1,xpad:1.03906,sc:.833333,w:9,h:18},{c:1025,x0:426,y0:281,yoffs:-1,xpad:.634766,sc:.833333,w:10,h:18},{c:1026,x0:317,y0:743,yoffs:3,xpad:.428711,sc:.833333,w:14,h:14},{c:1027,x0:447,y0:281,yoffs:-1,xpad:.0537109,sc:.833333,w:10,h:18},{c:1028,x0:342,y0:742,yoffs:3,xpad:.133789,sc:.833333,w:12,h:14},{c:1029,x0:365,y0:742,yoffs:3,sc:.833333,w:10,h:14},{c:1030,x0:386,y0:742,yoffs:3,sc:.833333,w:7,h:14},{c:1031,x0:257,y0:283,yoffs:-1,sc:.833333,w:7,h:18},{c:1032,x0:132,y0:373,yoffs:3,xpad:.260742,sc:.833333,w:7,h:17},{c:1033,x0:404,y0:742,yoffs:3,sc:.833333,w:18,h:14},{c:1034,x0:433,y0:742,yoffs:3,sc:.833333,w:18,h:14},{c:1035,x0:462,y0:742,yoffs:3,xpad:.428711,sc:.833333,w:14,h:14},{c:1036,x0:468,y0:280,yoffs:-1,sc:.833333,w:13,h:18},{c:1037,x0:492,y0:280,yoffs:-1,xpad:.750977,sc:.833333,w:14,h:18},{c:1038,x0:517,y0:280,yoffs:-1,sc:.833333,w:12,h:18},{c:1039,x0:200,y0:371,yoffs:3,xpad:1.35449,sc:.833333,w:12,h:17},{c:1040,x0:419,y0:717,yoffs:3,sc:.833333,w:13,h:14},{c:1041,x0:487,y0:740,yoffs:3,xpad:.674805,sc:.833333,w:11,h:14},{c:1042,x0:443,y0:717,yoffs:3,sc:.833333,w:12,h:14},{c:1043,x0:466,y0:715,yoffs:3,xpad:.0976563,sc:.833333,w:10,h:14},{c:1044,x0:223,y0:370,yoffs:3,sc:.833333,w:13,h:17},{c:1045,x0:511,y0:714,yoffs:3,xpad:.634766,sc:.833333,w:10,h:14},{c:1046,x0:509,y0:740,yoffs:3,sc:.833333,w:17,h:14},{c:1047,x0:537,y0:739,yoffs:3,xpad:.015625,sc:.833333,w:11,h:14},{c:1048,x0:559,y0:739,yoffs:3,xpad:1.15918,sc:.833333,w:12,h:14},{c:1049,x0:540,y0:280,yoffs:-1,xpad:1.15918,sc:.833333,w:12,h:18},{c:1050,x0:582,y0:739,yoffs:3,sc:.833333,w:12,h:14},{c:1051,x0:605,y0:739,yoffs:3,sc:.833333,w:13,h:14},{c:1052,x0:662,y0:713,yoffs:3,xpad:.770508,sc:.833333,w:14,h:14},{c:1053,x0:553,y0:714,yoffs:3,xpad:1.09082,sc:.833333,w:12,h:14},{c:1054,x0:731,y0:713,yoffs:3,xpad:.31543,sc:.833333,w:13,h:14},{c:1055,x0:755,y0:713,yoffs:3,xpad:.900391,sc:.833333,w:12,h:14},{c:1056,x0:778,y0:712,yoffs:3,xpad:.533203,sc:.833333,w:11,h:14},{c:1057,x0:629,y0:739,yoffs:3,xpad:.362305,sc:.833333,w:11,h:14},{c:1058,x0:822,y0:711,yoffs:3,sc:.833333,w:11,h:14},{c:1059,x0:651,y0:738,yoffs:3,sc:.833333,w:11,h:14},{c:1060,x0:673,y0:738,yoffs:3,xpad:.804688,sc:.833333,w:14,h:14},{c:1061,x0:867,y0:711,yoffs:3,sc:.833333,w:11,h:14},{c:1062,x0:247,y0:370,yoffs:3,sc:.833333,w:13,h:17},{c:1063,x0:698,y0:738,yoffs:3,xpad:1.17285,sc:.833333,w:11,h:14},{c:1064,x0:720,y0:738,yoffs:3,xpad:.62207,sc:.833333,w:17,h:14},{c:1065,x0:271,y0:370,yoffs:3,sc:.833333,w:18,h:17},{c:1066,x0:748,y0:738,yoffs:3,xpad:.267578,sc:.833333,w:14,h:14},{c:1067,x0:773,y0:738,yoffs:3,xpad:1.43066,sc:.833333,w:15,h:14},{c:1068,x0:799,y0:737,yoffs:3,xpad:.674805,sc:.833333,w:11,h:14},{c:1069,x0:821,y0:736,yoffs:3,xpad:.362305,sc:.833333,w:11,h:14},{c:1070,x0:843,y0:736,yoffs:3,xpad:.417969,sc:.833333,w:18,h:14},{c:1071,x0:872,y0:736,yoffs:3,xpad:.899414,sc:.833333,w:11,h:14},{c:1072,x0:591,y0:886,yoffs:6,xpad:1.21973,sc:.833333,w:9,h:11},{c:1073,x0:799,y0:450,yoffs:1,sc:.833333,w:11,h:16},{c:1074,x0:611,y0:885,yoffs:6,xpad:.253906,sc:.833333,w:10,h:11},{c:1075,x0:632,y0:885,yoffs:6,xpad:.354492,sc:.833333,w:8,h:11},{c:1076,x0:894,y0:736,yoffs:6,xpad:.186523,sc:.833333,w:11,h:14},{c:1077,x0:651,y0:885,yoffs:6,xpad:.0488281,sc:.833333,w:10,h:11},{c:1078,x0:672,y0:885,yoffs:6,sc:.833333,w:15,h:11},{c:1079,x0:698,y0:885,yoffs:6,xpad:.233398,sc:.833333,w:9,h:11},{c:1080,x0:718,y0:883,yoffs:6,xpad:1.32813,sc:.833333,w:10,h:11},{c:1081,x0:821,y0:450,yoffs:1,xpad:1.32813,sc:.833333,w:10,h:16},{c:1082,x0:739,y0:883,yoffs:6,sc:.833333,w:11,h:11},{c:1083,x0:761,y0:883,yoffs:6,xpad:1.01563,sc:.833333,w:10,h:11},{c:1084,x0:782,y0:883,yoffs:6,xpad:.797852,sc:.833333,w:12,h:11},{c:1085,x0:805,y0:883,yoffs:6,xpad:1.30859,sc:.833333,w:10,h:11},{c:1086,x0:826,y0:883,yoffs:6,sc:.833333,w:11,h:11},{c:1087,x0:848,y0:882,yoffs:6,xpad:1.15234,sc:.833333,w:10,h:11},{c:1088,x0:916,y0:736,yoffs:6,xpad:.137695,sc:.833333,w:11,h:14},{c:1089,x0:869,y0:880,yoffs:6,xpad:.111328,sc:.833333,w:9,h:11},{c:1090,x0:889,y0:880,yoffs:6,xpad:.477539,sc:.833333,w:9,h:11},{c:1091,x0:167,y0:617,yoffs:6,sc:.833333,w:10,h:15},{c:1092,x0:563,y0:280,yoffs:2,xpad:.0292969,sc:.833333,w:15,h:18},{c:1093,x0:909,y0:880,yoffs:6,sc:.833333,w:10,h:11},{c:1094,x0:938,y0:736,yoffs:6,sc:.833333,w:12,h:14},{c:1095,x0:930,y0:880,yoffs:6,xpad:.585938,sc:.833333,w:10,h:11},{c:1096,x0:951,y0:880,yoffs:6,xpad:.478516,sc:.833333,w:15,h:11},{c:1097,x0:961,y0:736,yoffs:6,sc:.833333,w:16,h:14},{c:1098,x0:977,y0:880,yoffs:6,xpad:.0898438,sc:.833333,w:12,h:11},{c:1099,x0:1e3,y0:880,yoffs:6,xpad:1.16504,sc:.833333,w:13,h:11},{c:1100,x0:5,y0:914,yoffs:6,sc:.833333,w:10,h:11},{c:1101,x0:26,y0:914,yoffs:6,xpad:.111328,sc:.833333,w:9,h:11},{c:1102,x0:46,y0:914,yoffs:6,xpad:.00976563,sc:.833333,w:15,h:11},{c:1103,x0:72,y0:914,yoffs:6,xpad:.512695,sc:.833333,w:10,h:11},{c:1104,x0:188,y0:617,yoffs:2,xpad:.59082,sc:.833333,w:10,h:15},{c:1105,x0:209,y0:617,yoffs:2,xpad:.0488281,sc:.833333,w:10,h:15},{c:1106,x0:943,y0:132,yoffs:2,xpad:.777344,sc:.833333,w:11,h:19},{c:1107,x0:230,y0:617,yoffs:2,sc:.833333,w:9,h:15},{c:1108,x0:551,y0:886,yoffs:6,xpad:.389648,sc:.833333,w:9,h:11},{c:1109,x0:93,y0:914,yoffs:6,sc:.833333,w:9,h:11},{c:1110,x0:250,y0:617,yoffs:2,xpad:.463867,sc:.833333,w:5,h:15},{c:1111,x0:266,y0:615,yoffs:2,sc:.833333,w:7,h:15},{c:1112,x0:903,y0:132,yoffs:2,sc:.833333,w:7,h:19},{c:1113,x0:113,y0:914,yoffs:6,sc:.833333,w:16,h:11},{c:1114,x0:140,y0:914,yoffs:6,sc:.833333,w:16,h:11},{c:1115,x0:284,y0:614,yoffs:2,xpad:.777344,sc:.833333,w:11,h:15},{c:1116,x0:306,y0:614,yoffs:2,sc:.833333,w:12,h:15},{c:1117,x0:329,y0:614,yoffs:2,xpad:.905273,sc:.833333,w:12,h:15},{c:1118,x0:965,y0:132,yoffs:2,sc:.833333,w:11,h:19},{c:1119,x0:988,y0:735,yoffs:6,xpad:1.0459,sc:.833333,w:11,h:14},{c:1120,x0:5,y0:770,yoffs:3,xpad:.0800781,sc:.833333,w:17,h:14},{c:1121,x0:167,y0:914,yoffs:6,sc:.833333,w:16,h:11},{c:1122,x0:33,y0:770,yoffs:3,xpad:.0605469,sc:.833333,w:12,h:14},{c:1123,x0:260,y0:845,yoffs:4,sc:.833333,w:12,h:13},{c:1124,x0:56,y0:770,yoffs:3,xpad:.0263672,sc:.833333,w:17,h:14},{c:1125,x0:194,y0:914,yoffs:6,xpad:.34082,sc:.833333,w:14,h:11},{c:1126,x0:84,y0:770,yoffs:3,sc:.833333,w:14,h:14},{c:1127,x0:219,y0:913,yoffs:6,sc:.833333,w:12,h:11},{c:1128,x0:109,y0:770,yoffs:3,sc:.833333,w:19,h:14},{c:1129,x0:242,y0:913,yoffs:6,sc:.833333,w:17,h:11},{c:1130,x0:139,y0:770,yoffs:3,sc:.833333,w:15,h:14},{c:1131,x0:270,y0:913,yoffs:6,xpad:.166992,sc:.833333,w:11,h:11},{c:1132,x0:165,y0:770,yoffs:3,xpad:.233398,sc:.833333,w:19,h:14},{c:1133,x0:292,y0:913,yoffs:6,sc:.833333,w:16,h:11},{c:1134,x0:502,y0:40,xpad:.328125,sc:.833333,w:11,h:21},{c:1135,x0:300,y0:370,yoffs:4,sc:.833333,w:10,h:17},{c:1136,x0:195,y0:770,yoffs:3,xpad:.703125,sc:.833333,w:15,h:14},{c:1137,x0:987,y0:132,yoffs:2,xpad:.00488281,sc:.833333,w:15,h:19},{c:1138,x0:617,y0:688,yoffs:3,xpad:.267578,sc:.833333,w:14,h:14},{c:1139,x0:819,y0:861,yoffs:6,xpad:.09375,sc:.833333,w:11,h:11},{c:1140,x0:221,y0:770,yoffs:3,sc:.833333,w:13,h:14},{c:1141,x0:319,y0:913,yoffs:6,sc:.833333,w:11,h:11},{c:1142,x0:589,y0:280,yoffs:-1,sc:.833333,w:13,h:18},{c:1143,x0:352,y0:614,yoffs:2,sc:.833333,w:11,h:15},{c:1144,x0:613,y0:280,yoffs:3,sc:.833333,w:24,h:18},{c:1145,x0:374,y0:614,yoffs:6,sc:.833333,w:21,h:15},{c:1146,x0:842,y0:450,yoffs:2,xpad:.985352,sc:.833333,w:14,h:16},{c:1147,x0:283,y0:845,yoffs:5,xpad:.167969,sc:.833333,w:12,h:13},{c:1148,x0:507,y0:72,yoffs:-3,xpad:.501953,sc:.833333,w:19,h:20},{c:1149,x0:648,y0:280,yoffs:-1,xpad:.172852,sc:.833333,w:17,h:18},{c:1150,x0:321,y0:369,xpad:.0800781,sc:.833333,w:17,h:17},{c:1151,x0:245,y0:770,yoffs:3,sc:.833333,w:16,h:14},{c:1152,x0:676,y0:280,yoffs:3,xpad:.133789,sc:.833333,w:12,h:18},{c:1153,x0:406,y0:614,yoffs:6,xpad:.389648,sc:.833333,w:9,h:15},{c:1154,x0:306,y0:845,yoffs:4,sc:.833333,w:11,h:13},{c:1160,x0:349,y0:369,yoffs:3,sc:.833333,w:18,h:17},{c:1161,x0:378,y0:368,yoffs:3,xpad:.133789,sc:.833333,w:17,h:17},{c:1162,x0:524,y0:40,yoffs:-1,sc:.833333,w:17,h:21},{c:1163,x0:699,y0:280,yoffs:2,sc:.833333,w:15,h:18},{c:1164,x0:272,y0:770,yoffs:3,xpad:.435547,sc:.833333,w:11,h:14},{c:1165,x0:426,y0:612,yoffs:2,xpad:.00585938,sc:.833333,w:11,h:15},{c:1166,x0:294,y0:770,yoffs:3,xpad:.254883,sc:.833333,w:11,h:14},{c:1167,x0:448,y0:612,yoffs:6,xpad:.347656,sc:.833333,w:11,h:15},{c:1168,x0:406,y0:368,sc:.833333,w:11,h:17},{c:1169,x0:316,y0:770,yoffs:3,xpad:.174805,sc:.833333,w:9,h:14},{c:1170,x0:336,y0:768,yoffs:3,xpad:.0195313,sc:.833333,w:10,h:14},{c:1171,x0:341,y0:913,yoffs:6,sc:.833333,w:9,h:11},{c:1172,x0:725,y0:280,yoffs:3,xpad:.154297,sc:.833333,w:13,h:18},{c:1173,x0:470,y0:612,yoffs:6,sc:.833333,w:11,h:15},{c:1174,x0:428,y0:368,yoffs:3,sc:.833333,w:19,h:17},{c:1175,x0:357,y0:767,yoffs:6,sc:.833333,w:17,h:14},{c:1176,x0:749,y0:280,yoffs:3,xpad:.616211,sc:.833333,w:11,h:18},{c:1177,x0:492,y0:611,yoffs:6,sc:.833333,w:10,h:15},{c:1178,x0:458,y0:368,yoffs:3,sc:.833333,w:14,h:17},{c:1179,x0:385,y0:767,yoffs:6,sc:.833333,w:12,h:14},{c:1180,x0:408,y0:767,yoffs:3,sc:.833333,w:13,h:14},{c:1181,x0:361,y0:913,yoffs:6,sc:.833333,w:12,h:11},{c:1182,x0:432,y0:767,yoffs:3,xpad:.0458984,sc:.833333,w:12,h:14},{c:1183,x0:513,y0:611,yoffs:2,sc:.833333,w:12,h:15},{c:1184,x0:455,y0:767,yoffs:3,sc:.833333,w:14,h:14},{c:1185,x0:384,y0:911,yoffs:6,sc:.833333,w:13,h:11},{c:1186,x0:483,y0:368,yoffs:3,xpad:.0732422,sc:.833333,w:15,h:17},{c:1187,x0:480,y0:767,yoffs:6,xpad:.31543,sc:.833333,w:13,h:14},{c:1188,x0:504,y0:765,yoffs:3,sc:.833333,w:15,h:14},{c:1189,x0:408,y0:911,yoffs:6,sc:.833333,w:14,h:11},{c:1190,x0:771,y0:280,yoffs:3,xpad:.166016,sc:.833333,w:20,h:18},{c:1191,x0:536,y0:611,yoffs:6,sc:.833333,w:16,h:15},{c:1192,x0:530,y0:765,yoffs:3,sc:.833333,w:14,h:14},{c:1193,x0:433,y0:910,yoffs:6,sc:.833333,w:12,h:11},{c:1194,x0:802,y0:279,yoffs:3,xpad:.416016,sc:.833333,w:11,h:18},{c:1195,x0:563,y0:611,yoffs:6,xpad:.213867,sc:.833333,w:9,h:15},{c:1196,x0:509,y0:367,yoffs:3,sc:.833333,w:11,h:17},{c:1197,x0:555,y0:764,yoffs:6,sc:.833333,w:10,h:14},{c:1198,x0:576,y0:764,yoffs:3,sc:.833333,w:12,h:14},{c:1199,x0:583,y0:611,yoffs:6,sc:.833333,w:11,h:15},{c:1200,x0:599,y0:764,yoffs:3,sc:.833333,w:12,h:14},{c:1201,x0:605,y0:610,yoffs:6,sc:.833333,w:11,h:15},{c:1202,x0:531,y0:367,yoffs:3,xpad:.31543,sc:.833333,w:13,h:17},{c:1203,x0:622,y0:764,yoffs:6,sc:.833333,w:12,h:14},{c:1204,x0:555,y0:367,yoffs:3,sc:.833333,w:17,h:17},{c:1205,x0:645,y0:764,yoffs:6,xpad:.179688,sc:.833333,w:14,h:14},{c:1206,x0:583,y0:367,yoffs:3,sc:.833333,w:15,h:17},{c:1207,x0:670,y0:763,yoffs:6,xpad:.0126953,sc:.833333,w:13,h:14},{c:1208,x0:694,y0:763,yoffs:3,xpad:1.04688,sc:.833333,w:12,h:14},{c:1209,x0:456,y0:910,yoffs:6,xpad:.757813,sc:.833333,w:11,h:11},{c:1210,x0:717,y0:763,yoffs:3,xpad:.046875,sc:.833333,w:13,h:14},{c:1211,x0:627,y0:610,yoffs:2,xpad:.777344,sc:.833333,w:11,h:15},{c:1212,x0:741,y0:763,yoffs:3,xpad:.992188,sc:.833333,w:16,h:14},{c:1213,x0:478,y0:910,yoffs:6,sc:.833333,w:13,h:11},{c:1214,x0:609,y0:367,yoffs:3,xpad:.992188,sc:.833333,w:16,h:17},{c:1215,x0:768,y0:763,yoffs:6,sc:.833333,w:13,h:14},{c:1216,x0:386,y0:742,yoffs:3,sc:.833333,w:7,h:14},{c:1217,x0:824,y0:279,yoffs:-1,sc:.833333,w:17,h:18},{c:1218,x0:649,y0:610,yoffs:2,sc:.833333,w:16,h:15},{c:1219,x0:852,y0:279,yoffs:3,xpad:.623047,sc:.833333,w:13,h:18},{c:1220,x0:676,y0:610,yoffs:6,xpad:.704102,sc:.833333,w:11,h:15},{c:1221,x0:636,y0:367,yoffs:3,xpad:.0195313,sc:.833333,w:15,h:17},{c:1222,x0:792,y0:763,yoffs:6,xpad:.0322266,sc:.833333,w:13,h:14},{c:1223,x0:876,y0:279,yoffs:3,xpad:.710938,sc:.833333,w:13,h:18},{c:1224,x0:698,y0:610,yoffs:6,xpad:.865234,sc:.833333,w:11,h:15},{c:1225,x0:662,y0:366,yoffs:3,sc:.833333,w:16,h:17},{c:1226,x0:816,y0:762,yoffs:6,sc:.833333,w:14,h:14},{c:1227,x0:689,y0:366,yoffs:3,xpad:1.04688,sc:.833333,w:12,h:17},{c:1228,x0:841,y0:761,yoffs:6,xpad:.757813,sc:.833333,w:11,h:14},{c:1229,x0:712,y0:366,yoffs:3,sc:.833333,w:19,h:17},{c:1230,x0:863,y0:761,yoffs:6,sc:.833333,w:17,h:14},{c:1231,x0:386,y0:742,yoffs:3,sc:.833333,w:7,h:14},{c:1232,x0:900,y0:279,yoffs:-1,sc:.833333,w:13,h:18},{c:1233,x0:720,y0:610,yoffs:2,xpad:.825195,sc:.833333,w:10,h:15},{c:1234,x0:924,y0:279,yoffs:-1,sc:.833333,w:13,h:18},{c:1235,x0:741,y0:609,yoffs:2,xpad:.825195,sc:.833333,w:10,h:15},{c:1236,x0:891,y0:761,yoffs:3,xpad:.0654297,sc:.833333,w:17,h:14},{c:1237,x0:502,y0:910,yoffs:6,xpad:.435547,sc:.833333,w:16,h:11},{c:1238,x0:948,y0:279,yoffs:-1,xpad:.0390625,sc:.833333,w:10,h:18},{c:1239,x0:762,y0:609,yoffs:2,xpad:.59082,sc:.833333,w:10,h:15},{c:1240,x0:482,y0:690,yoffs:3,xpad:.643555,sc:.833333,w:14,h:14},{c:1241,x0:381,y0:867,yoffs:6,xpad:.59082,sc:.833333,w:10,h:11},{c:1242,x0:969,y0:279,yoffs:-1,xpad:.643555,sc:.833333,w:14,h:18},{c:1243,x0:783,y0:609,yoffs:2,xpad:.59082,sc:.833333,w:10,h:15},{c:1244,x0:994,y0:279,yoffs:-1,sc:.833333,w:17,h:18},{c:1245,x0:804,y0:609,yoffs:2,sc:.833333,w:16,h:15},{c:1246,x0:5,y0:315,yoffs:-1,xpad:.616211,sc:.833333,w:11,h:18},{c:1247,x0:831,y0:609,yoffs:2,sc:.833333,w:10,h:15},{c:1248,x0:854,y0:686,yoffs:3,xpad:.59082,sc:.833333,w:10,h:14},{c:1249,x0:303,y0:588,yoffs:6,xpad:.415039,sc:.833333,w:10,h:15},{c:1250,x0:742,y0:366,xpad:.750977,sc:.833333,w:14,h:17},{c:1251,x0:919,y0:761,yoffs:3,xpad:.905273,sc:.833333,w:12,h:14},{c:1252,x0:27,y0:315,yoffs:-1,xpad:.750977,sc:.833333,w:14,h:18},{c:1253,x0:852,y0:609,yoffs:2,xpad:.905273,sc:.833333,w:12,h:15},{c:1254,x0:52,y0:315,yoffs:-1,xpad:.267578,sc:.833333,w:14,h:18},{c:1255,x0:875,y0:609,yoffs:2,xpad:.09375,sc:.833333,w:11,h:15},{c:1256,x0:617,y0:688,yoffs:3,xpad:.267578,sc:.833333,w:14,h:14},{c:1257,x0:819,y0:861,yoffs:6,xpad:.09375,sc:.833333,w:11,h:11},{c:1258,x0:77,y0:315,yoffs:-1,xpad:.267578,sc:.833333,w:14,h:18},{c:1259,x0:897,y0:609,yoffs:2,xpad:.09375,sc:.833333,w:11,h:15},{c:1260,x0:102,y0:315,yoffs:-1,xpad:.884766,sc:.833333,w:11,h:18},{c:1261,x0:919,y0:608,yoffs:2,xpad:.174805,sc:.833333,w:9,h:15},{c:1262,x0:767,y0:366,sc:.833333,w:12,h:17},{c:1263,x0:167,y0:284,yoffs:3,sc:.833333,w:11,h:18},{c:1264,x0:124,y0:315,yoffs:-1,sc:.833333,w:12,h:18},{c:1265,x0:5,y0:168,yoffs:2,sc:.833333,w:11,h:19},{c:1266,x0:147,y0:313,yoffs:-1,sc:.833333,w:12,h:18},{c:1267,x0:27,y0:168,yoffs:2,sc:.833333,w:11,h:19},{c:1268,x0:170,y0:313,yoffs:-1,xpad:1.04688,sc:.833333,w:12,h:18},{c:1269,x0:939,y0:608,yoffs:2,xpad:.757813,sc:.833333,w:11,h:15},{c:1270,x0:790,y0:366,yoffs:3,xpad:.0537109,sc:.833333,w:10,h:17},{c:1271,x0:942,y0:761,yoffs:6,sc:.833333,w:9,h:14},{c:1272,x0:193,y0:313,yoffs:-1,xpad:1.24023,sc:.833333,w:15,h:18},{c:1273,x0:961,y0:607,yoffs:2,xpad:1.23438,sc:.833333,w:14,h:15},{c:1274,x0:219,y0:312,yoffs:3,xpad:.0195313,sc:.833333,w:10,h:18},{c:1275,x0:986,y0:607,yoffs:6,sc:.833333,w:9,h:15},{c:1276,x0:240,y0:312,yoffs:3,xpad:.120117,sc:.833333,w:13,h:18},{c:1277,x0:1006,y0:581,yoffs:6,xpad:.5625,sc:.833333,w:11,h:15},{c:1278,x0:962,y0:761,yoffs:3,sc:.833333,w:12,h:14},{c:1279,x0:529,y0:910,yoffs:6,sc:.833333,w:11,h:11},{c:7424,x0:551,y0:908,yoffs:6,xpad:.0537109,sc:.833333,w:10,h:11},{c:7425,x0:572,y0:908,yoffs:6,xpad:.696289,sc:.833333,w:13,h:11},{c:7426,x0:596,y0:908,yoffs:6,xpad:.435547,sc:.833333,w:16,h:11},{c:7427,x0:623,y0:907,yoffs:6,sc:.833333,w:12,h:11},{c:7428,x0:646,y0:907,yoffs:6,xpad:.301758,sc:.833333,w:9,h:11},{c:7429,x0:666,y0:907,yoffs:6,xpad:.913086,sc:.833333,w:10,h:11},{c:7430,x0:687,y0:907,yoffs:6,xpad:.913086,sc:.833333,w:10,h:11},{c:7431,x0:708,y0:907,yoffs:6,xpad:.349609,sc:.833333,w:8,h:11},{c:7432,x0:727,y0:905,yoffs:6,sc:.833333,w:10,h:11},{c:7433,x0:5,y0:643,yoffs:6,xpad:.463867,sc:.833333,w:5,h:15},{c:7434,x0:748,y0:905,yoffs:6,xpad:.757813,sc:.833333,w:6,h:11},{c:7435,x0:765,y0:905,yoffs:6,sc:.833333,w:10,h:11},{c:7436,x0:786,y0:905,yoffs:6,xpad:.369141,sc:.833333,w:8,h:11},{c:7437,x0:805,y0:905,yoffs:6,xpad:.78418,sc:.833333,w:13,h:11},{c:7438,x0:829,y0:905,yoffs:6,xpad:.953125,sc:.833333,w:11,h:11},{c:7439,x0:851,y0:904,yoffs:6,xpad:.650391,sc:.833333,w:11,h:11},{c:7440,x0:873,y0:902,yoffs:6,xpad:.321289,sc:.833333,w:9,h:11},{c:7441,x0:893,y0:902,yoffs:6,xpad:.757813,sc:.833333,w:11,h:11},{c:7442,x0:240,y0:957,yoffs:7,xpad:.757813,sc:.833333,w:11,h:9},{c:7443,x0:915,y0:902,yoffs:6,sc:.833333,w:12,h:11},{c:7444,x0:938,y0:902,yoffs:6,xpad:.529297,sc:.833333,w:17,h:11},{c:7445,x0:966,y0:902,yoffs:6,xpad:.449219,sc:.833333,w:10,h:11},{c:7446,x0:889,y0:947,yoffs:6,xpad:.09375,sc:.833333,w:11,h:6},{c:7447,x0:911,y0:945,yoffs:11,xpad:.09375,sc:.833333,w:11,h:6},{c:7448,x0:987,y0:902,yoffs:6,xpad:.389648,sc:.833333,w:9,h:11},{c:7449,x0:1007,y0:902,yoffs:6,xpad:.931641,sc:.833333,w:9,h:11},{c:7450,x0:5,y0:936,yoffs:6,xpad:.931641,sc:.833333,w:9,h:11},{c:7451,x0:25,y0:936,yoffs:6,xpad:.334961,sc:.833333,w:8,h:11},{c:7452,x0:44,y0:936,yoffs:6,xpad:.68457,sc:.833333,w:11,h:11},{c:7453,x0:920,y0:924,yoffs:6,xpad:.240234,sc:.833333,w:11,h:10},{c:7454,x0:942,y0:924,yoffs:6,sc:.833333,w:15,h:10},{c:7455,x0:867,y0:449,yoffs:3,xpad:.240234,sc:.833333,w:11,h:16},{c:7456,x0:66,y0:936,yoffs:6,xpad:.0527344,sc:.833333,w:9,h:11},{c:7457,x0:86,y0:936,yoffs:6,sc:.833333,w:15,h:11},{c:7458,x0:112,y0:936,yoffs:6,sc:.833333,w:9,h:11},{c:7459,x0:132,y0:936,yoffs:6,xpad:.78418,sc:.833333,w:8,h:11},{c:7460,x0:151,y0:936,yoffs:6,xpad:.349609,sc:.833333,w:8,h:11},{c:7461,x0:170,y0:936,yoffs:6,xpad:.228516,sc:.833333,w:9,h:11},{c:7462,x0:190,y0:936,yoffs:6,xpad:.422852,sc:.833333,w:8,h:11},{c:7463,x0:209,y0:936,yoffs:6,sc:.833333,w:10,h:11},{c:7464,x0:230,y0:935,yoffs:6,xpad:1.02051,sc:.833333,w:10,h:11},{c:7465,x0:987,y0:902,yoffs:6,xpad:.389648,sc:.833333,w:9,h:11},{c:7466,x0:251,y0:935,yoffs:6,xpad:.709961,sc:.833333,w:12,h:11},{c:7467,x0:274,y0:935,yoffs:6,xpad:.913086,sc:.833333,w:10,h:11},{c:7468,x0:40,y0:996,yoffs:8,xpad:3.04688,sc:.833333,w:5,h:4},{c:7469,x0:56,y0:996,yoffs:8,xpad:4.09375,sc:.833333,w:7,h:4},{c:7470,x0:74,y0:996,yoffs:8,xpad:2.83203,sc:.833333,w:5,h:4},{c:7471,x0:262,y0:957,yoffs:3,sc:.833333,w:8,h:9},{c:7472,x0:90,y0:996,yoffs:8,xpad:2.61816,sc:.833333,w:6,h:4},{c:7473,x0:107,y0:996,yoffs:8,xpad:2.52344,sc:.833333,w:4,h:4},{c:7474,x0:122,y0:996,yoffs:8,xpad:2.52344,sc:.833333,w:4,h:4},{c:7475,x0:137,y0:996,yoffs:8,xpad:3.44238,sc:.833333,w:5,h:4},{c:7476,x0:153,y0:996,yoffs:8,xpad:2.90625,sc:.833333,w:6,h:4},{c:7477,x0:170,y0:996,yoffs:8,xpad:1.53125,sc:.833333,w:3,h:4},{c:7478,x0:933,y0:945,yoffs:8,xpad:1.85254,sc:.833333,w:2,h:6},{c:7479,x0:184,y0:996,yoffs:8,xpad:2.74414,sc:.833333,w:5,h:4},{c:7480,x0:200,y0:996,yoffs:8,xpad:4.57715,sc:.833333,w:2,h:4},{c:7481,x0:213,y0:996,yoffs:8,xpad:3.98633,sc:.833333,w:7,h:4},{c:7482,x0:231,y0:996,yoffs:8,xpad:3.46289,sc:.833333,w:6,h:4},{c:7483,x0:281,y0:957,yoffs:3,xpad:.462891,sc:.833333,w:9,h:9},{c:7484,x0:248,y0:994,yoffs:8,xpad:3.26758,sc:.833333,w:6,h:4},{c:7485,x0:265,y0:994,yoffs:8,xpad:2.92578,sc:.833333,w:6,h:4},{c:7486,x0:282,y0:994,yoffs:8,xpad:2.30957,sc:.833333,w:5,h:4},{c:7487,x0:298,y0:994,yoffs:8,xpad:2.69043,sc:.833333,w:5,h:4},{c:7488,x0:314,y0:994,yoffs:8,xpad:1.73828,sc:.833333,w:5,h:4},{c:7489,x0:330,y0:994,yoffs:8,xpad:2.79883,sc:.833333,w:6,h:4},{c:7490,x0:347,y0:992,yoffs:8,xpad:3.27441,sc:.833333,w:8,h:4},{c:7491,x0:679,y0:985,yoffs:9,xpad:3.04102,sc:.833333,w:4,h:3},{c:7492,x0:694,y0:985,yoffs:9,xpad:2.04102,sc:.833333,w:5,h:3},{c:7493,x0:710,y0:985,yoffs:9,xpad:2.36328,sc:.833333,w:5,h:3},{c:7494,x0:726,y0:985,yoffs:9,xpad:3.68359,sc:.833333,w:7,h:3},{c:7495,x0:366,y0:992,yoffs:8,xpad:2.36328,sc:.833333,w:5,h:4},{c:7496,x0:382,y0:992,yoffs:8,xpad:2.36328,sc:.833333,w:5,h:4},{c:7497,x0:744,y0:985,yoffs:9,xpad:1.87988,sc:.833333,w:5,h:3},{c:7498,x0:760,y0:983,yoffs:9,xpad:1.87988,sc:.833333,w:5,h:3},{c:7499,x0:776,y0:983,yoffs:9,xpad:2.46973,sc:.833333,w:4,h:3},{c:7500,x0:791,y0:983,yoffs:9,xpad:2.20117,sc:.833333,w:4,h:3},{c:7501,x0:414,y0:974,yoffs:9,xpad:2.36328,sc:.833333,w:5,h:5},{c:7502,x0:430,y0:974,yoffs:9,xpad:1.54492,sc:.833333,w:2,h:5},{c:7503,x0:398,y0:992,yoffs:8,xpad:2.22168,sc:.833333,w:5,h:4},{c:7504,x0:806,y0:983,yoffs:9,xpad:4.43555,sc:.833333,w:7,h:3},{c:7505,x0:443,y0:973,yoffs:9,xpad:2.65137,sc:.833333,w:5,h:5},{c:7506,x0:824,y0:982,yoffs:9,xpad:2.20215,sc:.833333,w:5,h:3},{c:7507,x0:840,y0:982,yoffs:9,xpad:1.98633,sc:.833333,w:4,h:3},{c:7508,xpad:7.20215,sc:.833333},{c:7509,xpad:7.20215,sc:.833333},{c:7510,x0:459,y0:972,yoffs:9,xpad:2.36328,sc:.833333,w:5,h:5},{c:7511,x0:414,y0:990,yoffs:8,xpad:2.05371,sc:.833333,w:3,h:4},{c:7512,x0:855,y0:981,yoffs:9,xpad:2.65137,sc:.833333,w:5,h:3},{c:7513,x0:52,y0:1011,yoffs:9,xpad:2.30957,sc:.833333,w:5,h:2},{c:7514,x0:871,y0:981,yoffs:9,xpad:4.43555,sc:.833333,w:7,h:3},{c:7515,x0:889,y0:979,yoffs:9,xpad:1.63086,sc:.833333,w:5,h:3},{c:7516,x0:905,y0:979,yoffs:9,xpad:2.00098,sc:.833333,w:4,h:3},{c:7517,x0:946,y0:945,yoffs:8,xpad:2.69043,sc:.833333,w:5,h:6},{c:7518,x0:475,y0:972,yoffs:9,xpad:1.61133,sc:.833333,w:5,h:5},{c:7519,x0:428,y0:990,yoffs:8,xpad:2.20215,sc:.833333,w:5,h:4},{c:7520,x0:491,y0:972,yoffs:9,xpad:3.22852,sc:.833333,w:6,h:5},{c:7521,x0:508,y0:972,yoffs:9,xpad:1.89941,sc:.833333,w:5,h:5},{c:7522,x0:962,y0:945,yoffs:12,xpad:1.54492,sc:.833333,w:2,h:6},{c:7523,x0:524,y0:972,yoffs:13,xpad:1.28809,sc:.833333,w:4,h:5},{c:7524,x0:539,y0:972,yoffs:13,xpad:2.65137,sc:.833333,w:5,h:5},{c:7525,x0:555,y0:972,yoffs:13,xpad:1.63086,sc:.833333,w:5,h:5},{c:7526,x0:557,y0:954,yoffs:12,xpad:2.69043,sc:.833333,w:5,h:7},{c:7527,x0:975,y0:945,yoffs:13,xpad:1.61133,sc:.833333,w:5,h:6},{c:7528,x0:991,y0:945,yoffs:13,xpad:2.20215,sc:.833333,w:5,h:6},{c:7529,x0:1007,y0:945,yoffs:13,xpad:3.22852,sc:.833333,w:6,h:6},{c:7530,x0:5,y0:979,yoffs:13,xpad:1.0752,sc:.833333,w:6,h:6},{c:7531,x0:295,y0:935,yoffs:6,xpad:.368164,sc:.833333,w:17,h:11},{c:7532,x0:21,y0:643,yoffs:2,sc:.833333,w:13,h:15},{c:7533,x0:45,y0:643,yoffs:2,sc:.833333,w:13,h:15},{c:7534,x0:69,y0:643,yoffs:2,sc:.833333,w:9,h:15},{c:7535,x0:323,y0:935,yoffs:6,sc:.833333,w:20,h:11},{c:7536,x0:354,y0:935,yoffs:6,sc:.833333,w:14,h:11},{c:7537,x0:89,y0:643,yoffs:6,sc:.833333,w:13,h:15},{c:7538,x0:379,y0:935,yoffs:6,sc:.833333,w:10,h:11},{c:7539,x0:400,y0:933,yoffs:6,sc:.833333,w:9,h:11},{c:7540,x0:420,y0:933,yoffs:6,sc:.833333,w:11,h:11},{c:7541,x0:328,y0:845,yoffs:4,sc:.833333,w:9,h:13},{c:7542,x0:442,y0:932,yoffs:6,sc:.833333,w:9,h:11},{c:7543,x0:113,y0:643,yoffs:2,xpad:.347656,sc:.833333,w:11,h:15},{c:7544,x0:920,y0:977,yoffs:9,xpad:2.70508,sc:.833333,w:5,h:3},{c:7545,x0:135,y0:643,yoffs:6,xpad:.146484,sc:.833333,w:10,h:15},{c:7546,x0:889,y0:449,yoffs:2,xpad:.555664,sc:.833333,w:19,h:16},{c:7547,x0:462,y0:932,yoffs:6,sc:.833333,w:7,h:11},{c:7548,x0:480,y0:932,yoffs:6,xpad:.294922,sc:.833333,w:7,h:11},{c:7549,x0:156,y0:643,yoffs:6,sc:.833333,w:12,h:15},{c:7550,x0:498,y0:932,yoffs:6,sc:.833333,w:12,h:11},{c:7551,x0:521,y0:932,yoffs:6,sc:.833333,w:12,h:11},{c:7680,x0:49,y0:168,yoffs:3,sc:.833333,w:13,h:19},{c:7681,x0:919,y0:449,yoffs:6,xpad:.825195,sc:.833333,w:10,h:16},{c:7682,x0:264,y0:312,yoffs:-1,xpad:.0458984,sc:.833333,w:12,h:18},{c:7683,x0:179,y0:643,yoffs:2,xpad:.347656,sc:.833333,w:11,h:15},{c:7684,x0:811,y0:366,yoffs:3,xpad:.0458984,sc:.833333,w:12,h:17},{c:7685,x0:287,y0:311,yoffs:2,xpad:.347656,sc:.833333,w:11,h:18},{c:7686,x0:834,y0:365,yoffs:3,xpad:.0458984,sc:.833333,w:12,h:17},{c:7687,x0:309,y0:311,yoffs:2,xpad:.347656,sc:.833333,w:11,h:18},{c:7688,x0:204,y0:41,yoffs:-1,xpad:.416016,sc:.833333,w:11,h:22},{c:7689,x0:73,y0:167,yoffs:2,xpad:.213867,sc:.833333,w:9,h:19},{c:7690,x0:331,y0:311,yoffs:-1,xpad:.261719,sc:.833333,w:13,h:18},{c:7691,x0:201,y0:643,yoffs:2,xpad:1.34766,sc:.833333,w:10,h:15},{c:7692,x0:857,y0:365,yoffs:3,xpad:.261719,sc:.833333,w:13,h:17},{c:7693,x0:355,y0:310,yoffs:2,xpad:1.34766,sc:.833333,w:10,h:18},{c:7694,x0:881,y0:365,yoffs:3,xpad:.261719,sc:.833333,w:13,h:17},{c:7695,x0:376,y0:310,yoffs:2,xpad:1.34766,sc:.833333,w:10,h:18},{c:7696,x0:397,y0:310,yoffs:3,xpad:.261719,sc:.833333,w:13,h:18},{c:7697,x0:93,y0:167,yoffs:2,xpad:1.34766,sc:.833333,w:10,h:19},{c:7698,x0:905,y0:365,yoffs:3,xpad:.261719,sc:.833333,w:13,h:17},{c:7699,x0:421,y0:310,yoffs:2,xpad:1.34766,sc:.833333,w:10,h:18},{c:7700,x0:537,y0:72,yoffs:-3,xpad:1.03906,sc:.833333,w:9,h:20},{c:7701,x0:929,y0:365,xpad:.59082,sc:.833333,w:10,h:17},{c:7702,x0:557,y0:72,yoffs:-3,xpad:1.03906,sc:.833333,w:9,h:20},{c:7703,x0:950,y0:365,xpad:.59082,sc:.833333,w:10,h:17},{c:7704,x0:971,y0:365,yoffs:3,xpad:.0390625,sc:.833333,w:10,h:17},{c:7705,x0:985,y0:761,yoffs:6,xpad:.59082,sc:.833333,w:10,h:14},{c:7706,x0:992,y0:365,yoffs:3,xpad:1.03906,sc:.833333,w:9,h:17},{c:7707,x0:1006,y0:760,yoffs:6,xpad:.59082,sc:.833333,w:10,h:14},{c:7708,x0:226,y0:40,yoffs:-1,xpad:1.03906,sc:.833333,w:9,h:22},{c:7709,x0:114,y0:167,yoffs:2,xpad:.59082,sc:.833333,w:10,h:19},{c:7710,x0:442,y0:310,yoffs:-1,xpad:.838867,sc:.833333,w:9,h:18},{c:7711,x0:462,y0:310,yoffs:-1,sc:.833333,w:8,h:18},{c:7712,x0:5,y0:401,xpad:.978516,sc:.833333,w:12,h:17},{c:7713,x0:481,y0:309,yoffs:3,xpad:1.34766,sc:.833333,w:10,h:18},{c:7714,x0:502,y0:309,yoffs:-1,xpad:.710938,sc:.833333,w:13,h:18},{c:7715,x0:135,y0:167,yoffs:-2,xpad:.777344,sc:.833333,w:11,h:19},{c:7716,x0:28,y0:401,yoffs:3,xpad:.710938,sc:.833333,w:13,h:17},{c:7717,x0:526,y0:309,yoffs:2,xpad:.777344,sc:.833333,w:11,h:18},{c:7718,x0:548,y0:309,yoffs:-1,xpad:.710938,sc:.833333,w:13,h:18},{c:7719,x0:157,y0:166,yoffs:-2,xpad:.0117188,sc:.833333,w:12,h:19},{c:7720,x0:572,y0:309,yoffs:3,xpad:.710938,sc:.833333,w:13,h:18},{c:7721,x0:180,y0:166,yoffs:2,xpad:.777344,sc:.833333,w:11,h:19},{c:7722,x0:596,y0:309,yoffs:3,xpad:.710938,sc:.833333,w:13,h:18},{c:7723,x0:202,y0:166,yoffs:2,xpad:.777344,sc:.833333,w:11,h:19},{c:7724,x0:52,y0:401,yoffs:3,sc:.833333,w:9,h:17},{c:7725,x0:620,y0:309,yoffs:2,sc:.833333,w:8,h:18},{c:7726,x0:577,y0:72,yoffs:-3,sc:.833333,w:7,h:20},{c:7727,x0:72,y0:401,sc:.833333,w:8,h:17},{c:7728,x0:639,y0:309,yoffs:-1,sc:.833333,w:12,h:18},{c:7729,x0:224,y0:165,yoffs:-2,sc:.833333,w:12,h:19},{c:7730,x0:91,y0:401,yoffs:3,sc:.833333,w:12,h:17},{c:7731,x0:662,y0:309,yoffs:2,sc:.833333,w:12,h:18},{c:7732,x0:114,y0:401,yoffs:3,sc:.833333,w:12,h:17},{c:7733,x0:685,y0:309,yoffs:2,sc:.833333,w:12,h:18},{c:7734,x0:137,y0:401,yoffs:3,xpad:.126953,sc:.833333,w:10,h:17},{c:7735,x0:708,y0:309,yoffs:2,xpad:.463867,sc:.833333,w:5,h:18},{c:7736,x0:595,y0:72,sc:.833333,w:11,h:20},{c:7737,x0:552,y0:40,yoffs:-1,sc:.833333,w:7,h:21},{c:7738,x0:158,y0:401,yoffs:3,xpad:.126953,sc:.833333,w:10,h:17},{c:7739,x0:724,y0:309,yoffs:2,sc:.833333,w:7,h:18},{c:7740,x0:179,y0:399,yoffs:3,xpad:.126953,sc:.833333,w:10,h:17},{c:7741,x0:742,y0:309,yoffs:2,sc:.833333,w:9,h:18},{c:7742,x0:247,y0:165,yoffs:-2,xpad:.770508,sc:.833333,w:14,h:19},{c:7743,x0:200,y0:399,xpad:.669922,sc:.833333,w:16,h:17},{c:7744,x0:762,y0:309,yoffs:-1,xpad:.904297,sc:.833333,w:16,h:18},{c:7745,x0:222,y0:643,yoffs:2,xpad:.602539,sc:.833333,w:17,h:15},{c:7746,x0:227,y0:398,yoffs:3,xpad:.904297,sc:.833333,w:16,h:17},{c:7747,x0:5,y0:795,yoffs:6,xpad:.602539,sc:.833333,w:17,h:14},{c:7748,x0:789,y0:309,yoffs:-1,xpad:1.57031,sc:.833333,w:13,h:18},{c:7749,x0:250,y0:643,yoffs:2,xpad:.777344,sc:.833333,w:11,h:15},{c:7750,x0:254,y0:398,yoffs:3,xpad:1.57031,sc:.833333,w:13,h:17},{c:7751,x0:33,y0:795,yoffs:6,xpad:.777344,sc:.833333,w:11,h:14},{c:7752,x0:278,y0:398,yoffs:3,xpad:1.57031,sc:.833333,w:13,h:17},{c:7753,x0:55,y0:795,yoffs:6,xpad:.777344,sc:.833333,w:11,h:14},{c:7754,x0:302,y0:398,yoffs:3,xpad:1.57031,sc:.833333,w:13,h:17},{c:7755,x0:77,y0:795,yoffs:6,xpad:.777344,sc:.833333,w:11,h:14},{c:7756,x0:617,y0:72,yoffs:-3,xpad:.267578,sc:.833333,w:14,h:20},{c:7757,x0:326,y0:397,xpad:.09375,sc:.833333,w:11,h:17},{c:7758,x0:642,y0:72,yoffs:-3,xpad:.267578,sc:.833333,w:14,h:20},{c:7759,x0:348,y0:397,xpad:.09375,sc:.833333,w:11,h:17},{c:7760,x0:667,y0:72,yoffs:-3,xpad:.267578,sc:.833333,w:14,h:20},{c:7761,x0:370,y0:397,xpad:.09375,sc:.833333,w:11,h:17},{c:7762,x0:692,y0:72,yoffs:-3,xpad:.267578,sc:.833333,w:14,h:20},{c:7763,x0:392,y0:396,xpad:.09375,sc:.833333,w:11,h:17},{c:7764,x0:813,y0:308,yoffs:-1,xpad:.254883,sc:.833333,w:11,h:18},{c:7765,x0:272,y0:164,yoffs:2,xpad:.347656,sc:.833333,w:11,h:19},{c:7766,x0:835,y0:308,yoffs:-1,xpad:.254883,sc:.833333,w:11,h:18},{c:7767,x0:294,y0:164,yoffs:2,xpad:.347656,sc:.833333,w:11,h:19},{c:7768,x0:857,y0:308,yoffs:-1,sc:.833333,w:12,h:18},{c:7769,x0:272,y0:641,yoffs:2,xpad:.134766,sc:.833333,w:8,h:15},{c:7770,x0:414,y0:396,yoffs:3,sc:.833333,w:12,h:17},{c:7771,x0:99,y0:795,yoffs:6,xpad:.134766,sc:.833333,w:8,h:14},{c:7772,x0:717,y0:71,sc:.833333,w:12,h:20},{c:7773,x0:437,y0:396,yoffs:3,xpad:.134766,sc:.833333,w:8,h:17},{c:7774,x0:456,y0:396,yoffs:3,sc:.833333,w:12,h:17},{c:7775,x0:118,y0:795,yoffs:6,xpad:.134766,sc:.833333,w:8,h:14},{c:7776,x0:880,y0:308,yoffs:-1,sc:.833333,w:10,h:18},{c:7777,x0:291,y0:640,yoffs:2,sc:.833333,w:9,h:15},{c:7778,x0:479,y0:396,yoffs:3,sc:.833333,w:10,h:17},{c:7779,x0:137,y0:795,yoffs:6,sc:.833333,w:9,h:14},{c:7780,x0:901,y0:308,yoffs:-1,sc:.833333,w:10,h:18},{c:7781,x0:311,y0:640,yoffs:2,sc:.833333,w:9,h:15},{c:7782,x0:740,y0:71,yoffs:-3,sc:.833333,w:10,h:20},{c:7783,x0:500,y0:396,sc:.833333,w:9,h:17},{c:7784,x0:570,y0:40,yoffs:-1,sc:.833333,w:10,h:21},{c:7785,x0:922,y0:308,yoffs:2,sc:.833333,w:9,h:18},{c:7786,x0:942,y0:308,yoffs:-1,sc:.833333,w:11,h:18},{c:7787,x0:520,y0:395,sc:.833333,w:8,h:17},{c:7788,x0:539,y0:395,yoffs:3,sc:.833333,w:11,h:17},{c:7789,x0:940,y0:449,yoffs:4,sc:.833333,w:8,h:16},{c:7790,x0:561,y0:395,yoffs:3,sc:.833333,w:11,h:17},{c:7791,x0:959,y0:449,yoffs:4,sc:.833333,w:8,h:16},{c:7792,x0:583,y0:395,yoffs:3,sc:.833333,w:11,h:17},{c:7793,x0:605,y0:395,yoffs:4,sc:.833333,w:9,h:17},{c:7794,x0:964,y0:308,yoffs:-1,xpad:.549805,sc:.833333,w:13,h:18},{c:7795,x0:331,y0:640,yoffs:2,xpad:.777344,sc:.833333,w:11,h:15},{c:7796,x0:988,y0:308,yoffs:-1,xpad:.549805,sc:.833333,w:13,h:18},{c:7797,x0:353,y0:640,yoffs:2,xpad:.777344,sc:.833333,w:11,h:15},{c:7798,x0:625,y0:395,yoffs:3,xpad:.549805,sc:.833333,w:13,h:17},{c:7799,x0:375,y0:640,yoffs:6,xpad:.777344,sc:.833333,w:11,h:15},{c:7800,x0:761,y0:71,yoffs:-3,xpad:.549805,sc:.833333,w:13,h:20},{c:7801,x0:649,y0:395,xpad:.777344,sc:.833333,w:11,h:17},{c:7802,x0:785,y0:71,yoffs:-3,xpad:.549805,sc:.833333,w:13,h:20},{c:7803,x0:671,y0:394,xpad:.777344,sc:.833333,w:11,h:17},{c:7804,x0:5,y0:344,yoffs:-1,sc:.833333,w:12,h:18},{c:7805,x0:397,y0:640,yoffs:2,sc:.833333,w:11,h:15},{c:7806,x0:693,y0:394,yoffs:3,sc:.833333,w:12,h:17},{c:7807,x0:157,y0:795,yoffs:6,sc:.833333,w:11,h:14},{c:7808,x0:316,y0:164,yoffs:-2,sc:.833333,w:21,h:19},{c:7809,x0:419,y0:640,yoffs:2,xpad:.355469,sc:.833333,w:14,h:15},{c:7810,x0:348,y0:164,yoffs:-2,sc:.833333,w:21,h:19},{c:7811,x0:444,y0:638,yoffs:2,xpad:.355469,sc:.833333,w:14,h:15},{c:7812,x0:28,y0:344,yoffs:-1,sc:.833333,w:21,h:18},{c:7813,x0:469,y0:638,yoffs:2,xpad:.355469,sc:.833333,w:14,h:15},{c:7814,x0:60,y0:344,yoffs:-1,sc:.833333,w:18,h:18},{c:7815,x0:494,y0:637,yoffs:2,sc:.833333,w:16,h:15},{c:7816,x0:716,y0:394,yoffs:3,sc:.833333,w:18,h:17},{c:7817,x0:179,y0:795,yoffs:6,sc:.833333,w:16,h:14},{c:7818,x0:89,y0:344,yoffs:-1,sc:.833333,w:12,h:18},{c:7819,x0:521,y0:637,yoffs:2,sc:.833333,w:11,h:15},{c:7820,x0:112,y0:344,yoffs:-1,sc:.833333,w:12,h:18},{c:7821,x0:543,y0:637,yoffs:2,sc:.833333,w:11,h:15},{c:7822,x0:135,y0:344,yoffs:-1,sc:.833333,w:12,h:18},{c:7823,x0:380,y0:164,yoffs:2,sc:.833333,w:11,h:19},{c:7824,x0:158,y0:342,yoffs:-1,xpad:.375977,sc:.833333,w:10,h:18},{c:7825,x0:565,y0:637,yoffs:2,sc:.833333,w:9,h:15},{c:7826,x0:745,y0:394,yoffs:3,xpad:.375977,sc:.833333,w:10,h:17},{c:7827,x0:206,y0:795,yoffs:6,sc:.833333,w:9,h:14},{c:7828,x0:766,y0:394,yoffs:3,xpad:.375977,sc:.833333,w:10,h:17},{c:7829,x0:226,y0:795,yoffs:6,sc:.833333,w:9,h:14},{c:7830,x0:179,y0:342,yoffs:2,xpad:.777344,sc:.833333,w:11,h:18},{c:7831,x0:787,y0:394,sc:.833333,w:8,h:17},{c:7832,x0:978,y0:449,yoffs:1,sc:.833333,w:16,h:16},{c:7833,x0:809,y0:71,yoffs:1,sc:.833333,w:11,h:20},{c:7834,x0:1005,y0:449,yoffs:1,xpad:.825195,sc:.833333,w:10,h:16},{c:7835,x0:201,y0:342,yoffs:-1,sc:.833333,w:8,h:18},{c:7836,x0:585,y0:637,yoffs:2,sc:.833333,w:9,h:15},{c:7837,x0:605,y0:636,yoffs:2,sc:.833333,w:8,h:15},{c:7838,x0:246,y0:795,yoffs:3,xpad:.150391,sc:.833333,w:14,h:14},{c:7839,x0:624,y0:636,yoffs:2,xpad:.09375,sc:.833333,w:11,h:15},{c:7840,x0:220,y0:341,yoffs:3,sc:.833333,w:13,h:18},{c:7841,x0:646,y0:636,yoffs:6,xpad:1.21973,sc:.833333,w:9,h:15},{c:7842,x0:402,y0:164,yoffs:-2,sc:.833333,w:13,h:19},{c:7843,x0:806,y0:394,xpad:1.21973,sc:.833333,w:9,h:17},{c:7844,x0:426,y0:163,yoffs:-2,sc:.833333,w:13,h:19},{c:7845,x0:826,y0:394,sc:.833333,w:11,h:17},{c:7846,x0:450,y0:163,yoffs:-2,sc:.833333,w:13,h:19},{c:7847,x0:848,y0:393,xpad:1.21973,sc:.833333,w:9,h:17},{c:7848,x0:474,y0:163,yoffs:-2,sc:.833333,w:13,h:19},{c:7849,x0:868,y0:393,sc:.833333,w:11,h:17},{c:7850,x0:831,y0:71,yoffs:-3,sc:.833333,w:13,h:20},{c:7851,x0:244,y0:341,yoffs:-1,xpad:1.21973,sc:.833333,w:9,h:18},{c:7852,x0:246,y0:40,yoffs:-1,sc:.833333,w:13,h:22},{c:7853,x0:855,y0:71,yoffs:1,xpad:1.21973,sc:.833333,w:9,h:20},{c:7854,x0:875,y0:71,yoffs:-3,sc:.833333,w:13,h:20},{c:7855,x0:264,y0:341,yoffs:-1,xpad:1.21973,sc:.833333,w:9,h:18},{c:7856,x0:899,y0:71,yoffs:-3,sc:.833333,w:13,h:20},{c:7857,x0:284,y0:341,yoffs:-1,xpad:1.21973,sc:.833333,w:9,h:18},{c:7858,x0:923,y0:71,yoffs:-3,sc:.833333,w:13,h:20},{c:7859,x0:498,y0:163,yoffs:-2,xpad:1.21973,sc:.833333,w:9,h:19},{c:7860,x0:947,y0:71,yoffs:-3,sc:.833333,w:13,h:20},{c:7861,x0:304,y0:340,yoffs:-1,xpad:1.21973,sc:.833333,w:9,h:18},{c:7862,x0:270,y0:40,yoffs:-1,sc:.833333,w:13,h:22},{c:7863,x0:971,y0:71,yoffs:1,xpad:1.21973,sc:.833333,w:9,h:20},{c:7864,x0:324,y0:340,yoffs:3,xpad:.634766,sc:.833333,w:10,h:18},{c:7865,x0:666,y0:636,yoffs:6,xpad:.0488281,sc:.833333,w:10,h:15},{c:7866,x0:518,y0:163,yoffs:-2,xpad:.634766,sc:.833333,w:10,h:19},{c:7867,x0:890,y0:393,xpad:.0488281,sc:.833333,w:10,h:17},{c:7868,x0:345,y0:340,yoffs:-1,xpad:.634766,sc:.833333,w:10,h:18},{c:7869,x0:5,y0:485,yoffs:1,xpad:.0488281,sc:.833333,w:10,h:16},{c:7870,x0:539,y0:163,yoffs:-2,sc:.833333,w:11,h:19},{c:7871,x0:911,y0:393,sc:.833333,w:11,h:17},{c:7872,x0:561,y0:163,yoffs:-2,xpad:.634766,sc:.833333,w:10,h:19},{c:7873,x0:933,y0:393,sc:.833333,w:11,h:17},{c:7874,x0:582,y0:163,yoffs:-2,sc:.833333,w:11,h:19},{c:7875,x0:955,y0:393,sc:.833333,w:11,h:17},{c:7876,x0:991,y0:71,yoffs:-3,xpad:.634766,sc:.833333,w:10,h:20},{c:7877,x0:366,y0:339,yoffs:-1,xpad:.0488281,sc:.833333,w:10,h:18},{c:7878,x0:294,y0:40,yoffs:-1,xpad:.634766,sc:.833333,w:10,h:22},{c:7879,x0:5,y0:107,yoffs:1,xpad:.0488281,sc:.833333,w:10,h:20},{c:7880,x0:604,y0:163,yoffs:-2,xpad:.708008,sc:.833333,w:5,h:19},{c:7881,x0:977,y0:393,xpad:.253906,sc:.833333,w:5,h:17},{c:7882,x0:387,y0:339,yoffs:3,xpad:.708008,sc:.833333,w:5,h:18},{c:7883,x0:620,y0:163,yoffs:2,xpad:.253906,sc:.833333,w:5,h:19},{c:7884,x0:403,y0:339,yoffs:3,xpad:.31543,sc:.833333,w:13,h:18},{c:7885,x0:687,y0:636,yoffs:6,sc:.833333,w:11,h:15},{c:7886,x0:636,y0:163,yoffs:-2,xpad:.31543,sc:.833333,w:13,h:19},{c:7887,x0:993,y0:393,sc:.833333,w:11,h:17},{c:7888,x0:660,y0:163,yoffs:-2,xpad:.31543,sc:.833333,w:13,h:19},{c:7889,x0:5,y0:429,sc:.833333,w:11,h:17},{c:7890,x0:684,y0:163,yoffs:-2,xpad:.31543,sc:.833333,w:13,h:19},{c:7891,x0:27,y0:429,sc:.833333,w:11,h:17},{c:7892,x0:708,y0:163,yoffs:-2,xpad:.31543,sc:.833333,w:13,h:19},{c:7893,x0:49,y0:429,sc:.833333,w:11,h:17},{c:7894,x0:26,y0:107,yoffs:-3,xpad:.31543,sc:.833333,w:13,h:20},{c:7895,x0:427,y0:339,yoffs:-1,sc:.833333,w:11,h:18},{c:7896,x0:315,y0:40,yoffs:-1,xpad:.31543,sc:.833333,w:13,h:22},{c:7897,x0:50,y0:106,yoffs:1,sc:.833333,w:11,h:20},{c:7898,x0:732,y0:163,yoffs:-2,xpad:.31543,sc:.833333,w:13,h:19},{c:7899,x0:71,y0:429,sc:.833333,w:11,h:17},{c:7900,x0:756,y0:162,yoffs:-2,xpad:.31543,sc:.833333,w:13,h:19},{c:7901,x0:93,y0:429,sc:.833333,w:11,h:17},{c:7902,x0:780,y0:162,yoffs:-2,xpad:.31543,sc:.833333,w:13,h:19},{c:7903,x0:115,y0:429,sc:.833333,w:11,h:17},{c:7904,x0:449,y0:339,yoffs:-1,xpad:.31543,sc:.833333,w:13,h:18},{c:7905,x0:26,y0:485,yoffs:1,sc:.833333,w:11,h:16},{c:7906,x0:591,y0:40,xpad:.31543,sc:.833333,w:13,h:21},{c:7907,x0:804,y0:162,yoffs:2,sc:.833333,w:11,h:19},{c:7908,x0:473,y0:339,yoffs:3,xpad:.93457,sc:.833333,w:12,h:18},{c:7909,x0:709,y0:636,yoffs:6,xpad:1.01563,sc:.833333,w:10,h:15},{c:7910,x0:826,y0:162,yoffs:-2,xpad:.93457,sc:.833333,w:12,h:19},{c:7911,x0:137,y0:429,xpad:1.01563,sc:.833333,w:10,h:17},{c:7912,x0:849,y0:162,yoffs:-2,sc:.833333,w:14,h:19},{c:7913,x0:158,y0:429,sc:.833333,w:12,h:17},{c:7914,x0:874,y0:162,yoffs:-2,sc:.833333,w:14,h:19},{c:7915,x0:181,y0:427,sc:.833333,w:12,h:17},{c:7916,x0:899,y0:162,yoffs:-2,sc:.833333,w:14,h:19},{c:7917,x0:204,y0:427,sc:.833333,w:12,h:17},{c:7918,x0:496,y0:338,yoffs:-1,sc:.833333,w:14,h:18},{c:7919,x0:48,y0:485,yoffs:1,sc:.833333,w:12,h:16},{c:7920,x0:339,y0:40,yoffs:-1,sc:.833333,w:14,h:22},{c:7921,x0:924,y0:162,yoffs:2,sc:.833333,w:12,h:19},{c:7922,x0:947,y0:162,yoffs:-2,sc:.833333,w:14,h:19},{c:7923,x0:972,y0:162,yoffs:2,sc:.833333,w:10,h:19},{c:7924,x0:521,y0:338,yoffs:3,sc:.833333,w:12,h:18},{c:7925,x0:730,y0:636,yoffs:6,sc:.833333,w:10,h:15},{c:7926,x0:993,y0:162,yoffs:-2,sc:.833333,w:12,h:19},{c:7927,x0:615,y0:40,sc:.833333,w:10,h:21},{c:7928,x0:544,y0:338,yoffs:-1,sc:.833333,w:12,h:18},{c:7929,x0:72,y0:106,yoffs:1,sc:.833333,w:10,h:20},{c:7930,x0:271,y0:795,yoffs:3,xpad:.415039,sc:.833333,w:15,h:14},{c:7931,x0:751,y0:635,yoffs:2,sc:.833333,w:11,h:15},{c:7932,x0:297,y0:795,yoffs:3,xpad:.408203,sc:.833333,w:13,h:14},{c:7933,x0:773,y0:635,yoffs:2,sc:.833333,w:11,h:15},{c:7934,x0:321,y0:795,yoffs:3,sc:.833333,w:12,h:14},{c:7935,x0:795,y0:635,yoffs:6,sc:.833333,w:12,h:15},{c:8192,xpad:8.95996,sc:.833333},{c:8193,xpad:17.9248,sc:.833333},{c:8194,xpad:8.64746,sc:.833333},{c:8195,xpad:17.2949,sc:.833333},{c:8196,xpad:5.9668,sc:.833333},{c:8197,xpad:4.47754,sc:.833333},{c:8198,xpad:2.99316,sc:.833333},{c:8199,xpad:10.2539,sc:.833333},{c:8200,xpad:5.10742,sc:.833333},{c:8201,xpad:3.58398,sc:.833333},{c:8202,xpad:1.79199,sc:.833333},{c:8203,xpad:.00488281,sc:.833333},{c:8204,xpad:.00488281,sc:.833333},{c:8205,xpad:.00488281,sc:.833333},{c:8208,x0:68,y0:1011,yoffs:9,xpad:6.29492,sc:.833333,w:11,h:2},{c:8209,x0:936,y0:977,yoffs:10,xpad:.396484,sc:.833333,w:6,h:3},{c:8210,x0:953,y0:977,yoffs:10,xpad:.423828,sc:.833333,w:9,h:3},{c:8211,x0:90,y0:1011,yoffs:10,xpad:.347656,sc:.833333,w:11,h:2},{c:8212,x0:112,y0:1011,yoffs:10,xpad:.254883,sc:.833333,w:16,h:2},{c:8213,x0:139,y0:1011,yoffs:9,xpad:.294922,sc:.833333,w:17,h:2},{c:8214,x0:5,y0:198,xpad:6.29492,sc:.833333,w:11,h:19},{c:8215,x0:571,y0:972,yoffs:16,sc:.833333,w:9,h:5},{c:8216,x0:573,y0:952,yoffs:3,xpad:.683594,sc:.833333,w:5,h:7},{c:8217,x0:589,y0:952,yoffs:3,xpad:.756836,sc:.833333,w:5,h:7},{c:8218,x0:365,y0:957,yoffs:13,xpad:.683594,sc:.833333,w:5,h:8},{c:8219,x0:591,y0:970,yoffs:3,sc:.833333,w:4,h:5},{c:8220,x0:605,y0:952,yoffs:3,xpad:.0390625,sc:.833333,w:10,h:7},{c:8221,x0:626,y0:952,yoffs:3,xpad:1.11719,sc:.833333,w:9,h:7},{c:8222,x0:381,y0:957,yoffs:13,xpad:1.03906,sc:.833333,w:9,h:8},{c:8223,x0:606,y0:970,yoffs:3,sc:.833333,w:8,h:5},{c:8224,x0:27,y0:198,yoffs:2,xpad:.214844,sc:.833333,w:10,h:19},{c:8225,x0:48,y0:198,yoffs:2,xpad:.288086,sc:.833333,w:10,h:19},{c:8226,x0:22,y0:979,yoffs:9,xpad:1.4375,sc:.833333,w:7,h:6},{c:8227,x0:646,y0:951,yoffs:6,sc:.833333,w:7,h:7},{c:8228,x0:444,y0:989,yoffs:13,xpad:1.95996,sc:.833333,w:7,h:4},{c:8229,x0:462,y0:988,yoffs:8,xpad:2.29492,sc:.833333,w:15,h:4},{c:8230,x0:488,y0:988,yoffs:13,xpad:2.18066,sc:.833333,w:18,h:4},{c:8231,x0:517,y0:988,yoffs:8,xpad:6.29492,sc:.833333,w:11,h:4},{c:8232,xpad:10.752,sc:.833333},{c:8233,xpad:10.752,sc:.833333},{c:8239,xpad:3.58398,sc:.833333},{c:8240,x0:567,y0:338,yoffs:1,xpad:.518555,sc:.833333,w:26,h:18},{c:8241,x0:344,y0:793,yoffs:3,sc:.833333,w:30,h:14},{c:8242,x0:40,y0:979,yoffs:3,xpad:.489258,sc:.833333,w:6,h:6},{c:8243,x0:57,y0:979,yoffs:3,sc:.833333,w:11,h:6},{c:8244,x0:79,y0:979,yoffs:3,sc:.833333,w:15,h:6},{c:8245,x0:539,y0:988,yoffs:-1,xpad:6.29492,sc:.833333,w:11,h:4},{c:8246,x0:105,y0:979,yoffs:3,xpad:1.52344,sc:.833333,w:10,h:6},{c:8247,x0:126,y0:979,yoffs:3,xpad:1.48828,sc:.833333,w:14,h:6},{c:8248,x0:664,y0:951,yoffs:14,xpad:.167969,sc:.833333,w:7,h:7},{c:8249,x0:401,y0:955,yoffs:8,xpad:.567383,sc:.833333,w:6,h:8},{c:8250,x0:418,y0:955,yoffs:8,xpad:.567383,sc:.833333,w:6,h:8},{c:8251,x0:348,y0:843,yoffs:3,xpad:2.29492,sc:.833333,w:15,h:13},{c:8252,x0:385,y0:792,yoffs:3,xpad:.708984,sc:.833333,w:11,h:14},{c:8253,x0:407,y0:792,yoffs:3,sc:.833333,w:9,h:14},{c:8254,x0:973,y0:977,sc:.833333,w:11,h:3},{c:8255,x0:625,y0:970,yoffs:16,sc:.833333,w:11,h:5},{c:8256,x0:561,y0:988,yoffs:2,sc:.833333,w:11,h:4},{c:8257,x0:927,y0:835,yoffs:9,sc:.833333,w:8,h:12},{c:8258,x0:636,y0:40,xpad:.882813,sc:.833333,w:24,h:21},{c:8259,x0:995,y0:977,yoffs:10,sc:.833333,w:6,h:3},{c:8260,x0:93,y0:106,sc:.833333,w:12,h:20},{c:8261,x0:227,y0:426,yoffs:3,sc:.833333,w:6,h:17},{c:8262,x0:244,y0:426,yoffs:3,xpad:.932617,sc:.833333,w:5,h:17},{c:8263,x0:818,y0:635,yoffs:2,xpad:.826172,sc:.833333,w:16,h:15},{c:8264,x0:845,y0:635,yoffs:2,xpad:1.35547,sc:.833333,w:13,h:15},{c:8265,x0:869,y0:635,yoffs:2,xpad:.355469,sc:.833333,w:14,h:15},{c:8266,x0:544,y0:932,yoffs:6,xpad:.751953,sc:.833333,w:10,h:11},{c:8267,x0:260,y0:426,yoffs:2,xpad:.738281,sc:.833333,w:11,h:17},{c:8268,x0:968,y0:924,yoffs:6,xpad:.738281,sc:.833333,w:11,h:10},{c:8269,x0:990,y0:924,yoffs:6,xpad:.738281,sc:.833333,w:11,h:10},{c:8270,x0:301,y0:957,yoffs:11,sc:.833333,w:10,h:9},{c:8271,x0:374,y0:843,yoffs:6,xpad:.107422,sc:.833333,w:5,h:13},{c:8272,x0:69,y0:198,yoffs:2,sc:.833333,w:11,h:19},{c:8273,x0:671,y0:40,sc:.833333,w:11,h:21},{c:8274,x0:427,y0:792,yoffs:3,sc:.833333,w:8,h:14},{c:8275,x0:583,y0:988,yoffs:9,sc:.833333,w:18,h:4},{c:8276,x0:647,y0:969,yoffs:16,sc:.833333,w:11,h:5},{c:8277,x0:565,y0:930,yoffs:6,xpad:.694336,sc:.833333,w:11,h:11},{c:8278,x0:446,y0:792,yoffs:3,xpad:.375977,sc:.833333,w:10,h:14},{c:8279,x0:151,y0:979,yoffs:3,xpad:.213867,sc:.833333,w:19,h:6},{c:8280,x0:467,y0:792,yoffs:3,xpad:.649414,sc:.833333,w:15,h:14},{c:8281,x0:493,y0:792,yoffs:3,xpad:.649414,sc:.833333,w:15,h:14},{c:8282,x0:519,y0:790,yoffs:3,xpad:.107422,sc:.833333,w:5,h:14},{c:8283,x0:894,y0:635,yoffs:2,xpad:.421875,sc:.833333,w:12,h:15},{c:8284,x0:917,y0:635,yoffs:2,xpad:.288086,sc:.833333,w:15,h:15},{c:8285,x0:943,y0:634,yoffs:2,xpad:.107422,sc:.833333,w:5,h:15},{c:8286,x0:535,y0:790,yoffs:3,xpad:.107422,sc:.833333,w:5,h:14},{c:8287,xpad:10.752,sc:.833333},{c:8288,xpad:10.752,sc:.833333},{c:8289,xpad:10.752,sc:.833333},{c:8290,xpad:10.752,sc:.833333},{c:8291,xpad:10.752,sc:.833333},{c:8292,xpad:10.752,sc:.833333},{c:8294,xpad:.00488281,sc:.833333},{c:8295,xpad:.00488281,sc:.833333},{c:8296,xpad:.00488281,sc:.833333},{c:8297,xpad:.00488281,sc:.833333},{c:8304,x0:682,y0:951,yoffs:3,xpad:.902344,sc:.833333,w:9,h:7},{c:8305,x0:612,y0:986,yoffs:8,xpad:1.54492,sc:.833333,w:2,h:4},{c:8308,x0:5,y0:958,yoffs:3,sc:.833333,w:9,h:10},{c:8309,x0:587,y0:930,yoffs:2,xpad:1.28125,sc:.833333,w:7,h:11},{c:8310,x0:25,y0:958,xpad:.541016,sc:.833333,w:9,h:10},{c:8311,x0:45,y0:958,yoffs:3,xpad:.544922,sc:.833333,w:8,h:10},{c:8312,x0:64,y0:958,xpad:.462891,sc:.833333,w:9,h:10},{c:8313,x0:84,y0:958,yoffs:3,xpad:.389648,sc:.833333,w:9,h:10},{c:8314,x0:181,y0:979,yoffs:5,xpad:.435547,sc:.833333,w:6,h:6},{c:8315,x0:167,y0:1011,yoffs:7,xpad:.435547,sc:.833333,w:6,h:2},{c:8316,x0:625,y0:986,yoffs:6,xpad:.435547,sc:.833333,w:6,h:4},{c:8317,x0:605,y0:930,yoffs:2,xpad:.335938,sc:.833333,w:4,h:11},{c:8318,x0:620,y0:930,yoffs:2,xpad:.335938,sc:.833333,w:4,h:11},{c:8319,x0:1012,y0:977,yoffs:9,xpad:2.65137,sc:.833333,w:5,h:3},{c:8320,x0:702,y0:951,yoffs:11,xpad:.902344,sc:.833333,w:9,h:7},{c:8321,x0:722,y0:951,yoffs:11,xpad:.132813,sc:.833333,w:6,h:7},{c:8322,x0:739,y0:949,yoffs:11,sc:.833333,w:8,h:7},{c:8323,x0:104,y0:958,yoffs:11,xpad:.236328,sc:.833333,w:7,h:10},{c:8324,x0:122,y0:958,yoffs:10,sc:.833333,w:9,h:10},{c:8325,x0:635,y0:929,yoffs:10,xpad:1.28125,sc:.833333,w:7,h:11},{c:8326,x0:653,y0:929,yoffs:7,xpad:.541016,sc:.833333,w:9,h:11},{c:8327,x0:673,y0:929,yoffs:10,xpad:.544922,sc:.833333,w:8,h:11},{c:8328,x0:692,y0:929,yoffs:7,xpad:.462891,sc:.833333,w:9,h:11},{c:8329,x0:142,y0:958,yoffs:11,xpad:.389648,sc:.833333,w:9,h:10},{c:8330,x0:198,y0:979,yoffs:13,xpad:.435547,sc:.833333,w:6,h:6},{c:8331,x0:184,y0:1011,yoffs:15,xpad:.435547,sc:.833333,w:6,h:2},{c:8332,x0:669,y0:969,yoffs:13,xpad:.435547,sc:.833333,w:6,h:5},{c:8333,x0:712,y0:929,yoffs:9,xpad:.335938,sc:.833333,w:4,h:11},{c:8334,x0:727,y0:927,yoffs:9,xpad:.335938,sc:.833333,w:4,h:11},{c:8336,x0:686,y0:969,yoffs:13,xpad:3.04102,sc:.833333,w:4,h:5},{c:8337,x0:701,y0:969,yoffs:13,xpad:1.87988,sc:.833333,w:5,h:5},{c:8338,x0:717,y0:969,yoffs:13,xpad:2.20215,sc:.833333,w:5,h:5},{c:8339,x0:733,y0:969,yoffs:13,xpad:1.73828,sc:.833333,w:5,h:5},{c:8340,x0:749,y0:967,yoffs:13,xpad:1.87988,sc:.833333,w:5,h:5},{c:8341,x0:215,y0:979,yoffs:12,xpad:2.65137,sc:.833333,w:5,h:6},{c:8342,x0:231,y0:979,yoffs:12,xpad:2.22168,sc:.833333,w:5,h:6},{c:8343,x0:247,y0:977,yoffs:12,xpad:1.54492,sc:.833333,w:2,h:6},{c:8344,x0:765,y0:967,yoffs:13,xpad:4.43555,sc:.833333,w:7,h:5},{c:8345,x0:783,y0:967,yoffs:13,xpad:2.65137,sc:.833333,w:5,h:5},{c:8346,x0:260,y0:977,yoffs:13,xpad:2.36328,sc:.833333,w:5,h:6},{c:8347,x0:799,y0:967,yoffs:13,xpad:1.78613,sc:.833333,w:4,h:5},{c:8348,x0:276,y0:977,yoffs:12,xpad:1.05371,sc:.833333,w:4,h:6},{c:8352,x0:551,y0:790,yoffs:3,xpad:.253906,sc:.833333,w:10,h:14},{c:8353,x0:71,y0:485,yoffs:2,sc:.833333,w:11,h:16},{c:8354,x0:572,y0:789,yoffs:3,xpad:.253906,sc:.833333,w:10,h:14},{c:8355,x0:593,y0:789,yoffs:3,xpad:.253906,sc:.833333,w:10,h:14},{c:8356,x0:614,y0:789,yoffs:3,xpad:.253906,sc:.833333,w:10,h:14},{c:8357,x0:959,y0:634,yoffs:4,xpad:.602539,sc:.833333,w:17,h:15},{c:8358,x0:635,y0:789,yoffs:3,sc:.833333,w:11,h:14},{c:8359,x0:657,y0:789,yoffs:3,sc:.833333,w:16,h:14},{c:8360,x0:684,y0:788,yoffs:3,xpad:.420898,sc:.833333,w:16,h:14},{c:8361,x0:711,y0:788,yoffs:3,sc:.833333,w:12,h:14},{c:8362,x0:734,y0:788,yoffs:3,xpad:1.47461,sc:.833333,w:15,h:14},{c:8363,x0:760,y0:788,yoffs:3,xpad:.185547,sc:.833333,w:10,h:14},{c:8364,x0:781,y0:788,yoffs:3,sc:.833333,w:15,h:14},{c:8365,x0:807,y0:788,yoffs:3,sc:.833333,w:11,h:14},{c:8366,x0:829,y0:787,yoffs:3,xpad:.253906,sc:.833333,w:10,h:14},{c:8367,x0:604,y0:338,yoffs:3,xpad:.105469,sc:.833333,w:18,h:18},{c:8368,x0:633,y0:338,yoffs:3,xpad:.932617,sc:.833333,w:10,h:18},{c:8369,x0:850,y0:786,yoffs:3,sc:.833333,w:11,h:14},{c:8370,x0:93,y0:485,yoffs:2,xpad:1.1543,sc:.833333,w:12,h:16},{c:8371,x0:872,y0:786,yoffs:3,sc:.833333,w:12,h:14},{c:8372,x0:895,y0:786,yoffs:3,sc:.833333,w:11,h:14},{c:8373,x0:116,y0:485,yoffs:2,xpad:.416016,sc:.833333,w:11,h:16},{c:8374,x0:390,y0:843,yoffs:4,xpad:.475586,sc:.833333,w:12,h:13},{c:8375,x0:987,y0:633,yoffs:3,xpad:.100586,sc:.833333,w:13,h:15},{c:8376,x0:917,y0:786,yoffs:3,sc:.833333,w:11,h:14},{c:8377,x0:939,y0:786,yoffs:3,xpad:.649414,sc:.833333,w:10,h:14},{c:8378,x0:960,y0:786,yoffs:3,xpad:.253906,sc:.833333,w:10,h:14},{c:8379,x0:981,y0:786,yoffs:3,sc:.833333,w:15,h:14},{c:8380,x0:5,y0:820,yoffs:3,xpad:.664063,sc:.833333,w:15,h:14},{c:8381,x0:31,y0:820,yoffs:3,sc:.833333,w:11,h:14},{c:8382,x0:138,y0:485,yoffs:1,xpad:.274414,sc:.833333,w:11,h:16},{c:8383,x0:282,y0:426,yoffs:1,xpad:.253906,sc:.833333,w:10,h:17},{c:8482,x0:291,y0:977,yoffs:3,xpad:.518555,sc:.833333,w:16,h:6},{c:8592,x0:758,y0:949,yoffs:7,xpad:.801758,sc:.833333,w:16,h:7},{c:8593,x0:160,y0:485,yoffs:2,xpad:4.80176,sc:.833333,w:12,h:16},{c:8594,x0:785,y0:949,yoffs:7,sc:.833333,w:17,h:7},{c:8595,x0:183,y0:485,yoffs:2,xpad:4.80176,sc:.833333,w:12,h:16},{c:8734,x0:813,y0:948,yoffs:8,xpad:.649414,sc:.833333,w:15,h:7},{c:12353,x0:53,y0:820,yoffs:4,xpad:2.29492,sc:.833333,w:15,h:14},{c:12354,x0:206,y0:483,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:16},{c:12355,x0:742,y0:927,yoffs:6,xpad:1.29492,sc:.833333,w:16,h:11},{c:12356,x0:79,y0:820,yoffs:3,xpad:.294922,sc:.833333,w:17,h:14},{c:12357,x0:107,y0:820,yoffs:4,xpad:3.29492,sc:.833333,w:14,h:14},{c:12358,x0:233,y0:482,yoffs:2,xpad:2.29492,sc:.833333,w:15,h:16},{c:12359,x0:132,y0:820,yoffs:4,xpad:2.29492,sc:.833333,w:15,h:14},{c:12360,x0:259,y0:482,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:16},{c:12361,x0:413,y0:842,yoffs:5,xpad:1.29492,sc:.833333,w:16,h:13},{c:12362,x0:5,y0:669,yoffs:2,xpad:.294922,sc:.833333,w:17,h:15},{c:12363,x0:33,y0:669,yoffs:2,xpad:.294922,sc:.833333,w:17,h:15},{c:12364,x0:303,y0:426,yoffs:1,xpad:.294922,sc:.833333,w:17,h:17},{c:12365,x0:286,y0:482,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:16},{c:12366,x0:331,y0:425,yoffs:1,xpad:.294922,sc:.833333,w:17,h:17},{c:12367,x0:313,y0:482,yoffs:2,xpad:3.29492,sc:.833333,w:14,h:16},{c:12368,x0:338,y0:482,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:16},{c:12369,x0:365,y0:480,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:16},{c:12370,x0:359,y0:425,yoffs:1,sc:.833333,w:18,h:17},{c:12371,x0:158,y0:820,yoffs:3,xpad:2.29492,sc:.833333,w:15,h:14},{c:12372,x0:388,y0:425,yoffs:1,xpad:.294922,sc:.833333,w:17,h:17},{c:12373,x0:392,y0:480,yoffs:2,xpad:2.29492,sc:.833333,w:15,h:16},{c:12374,x0:416,y0:424,yoffs:1,xpad:.294922,sc:.833333,w:17,h:17},{c:12375,x0:418,y0:480,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:16},{c:12376,x0:445,y0:479,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:16},{c:12377,x0:472,y0:479,yoffs:2,xpad:.294922,sc:.833333,w:17,h:16},{c:12378,x0:444,y0:424,yoffs:1,xpad:.294922,sc:.833333,w:17,h:17},{c:12379,x0:61,y0:669,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:15},{c:12380,x0:500,y0:479,yoffs:2,xpad:.294922,sc:.833333,w:17,h:16},{c:12381,x0:528,y0:479,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:16},{c:12382,x0:555,y0:478,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:16},{c:12383,x0:88,y0:669,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:15},{c:12384,x0:582,y0:478,yoffs:2,xpad:.294922,sc:.833333,w:17,h:16},{c:12385,x0:610,y0:478,yoffs:2,xpad:2.29492,sc:.833333,w:15,h:16},{c:12386,x0:472,y0:424,yoffs:1,xpad:.294922,sc:.833333,w:17,h:17},{c:12387,x0:162,y0:958,yoffs:7,xpad:1.29492,sc:.833333,w:16,h:10},{c:12388,x0:440,y0:842,yoffs:4,xpad:1.29492,sc:.833333,w:16,h:13},{c:12389,x0:636,y0:478,yoffs:1,xpad:.294922,sc:.833333,w:17,h:16},{c:12390,x0:184,y0:820,yoffs:3,xpad:1.29492,sc:.833333,w:16,h:14},{c:12391,x0:211,y0:820,yoffs:3,xpad:.294922,sc:.833333,w:17,h:14},{c:12392,x0:115,y0:669,yoffs:2,xpad:2.29492,sc:.833333,w:15,h:15},{c:12393,x0:500,y0:424,yoffs:1,xpad:.294922,sc:.833333,w:17,h:17},{c:12394,x0:664,y0:478,yoffs:2,xpad:.294922,sc:.833333,w:17,h:16},{c:12395,x0:141,y0:669,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:15},{c:12396,x0:168,y0:669,yoffs:2,xpad:.294922,sc:.833333,w:17,h:15},{c:12397,x0:196,y0:669,yoffs:2,xpad:.294922,sc:.833333,w:17,h:15},{c:12398,x0:239,y0:820,yoffs:3,xpad:1.29492,sc:.833333,w:16,h:14},{c:12399,x0:224,y0:669,yoffs:2,xpad:.294922,sc:.833333,w:17,h:15},{c:12400,x0:528,y0:423,yoffs:1,xpad:.294922,sc:.833333,w:17,h:17},{c:12401,x0:556,y0:423,yoffs:1,sc:.833333,w:18,h:17},{c:12402,x0:252,y0:669,yoffs:3,xpad:.294922,sc:.833333,w:17,h:15},{c:12403,x0:585,y0:423,yoffs:1,xpad:.294922,sc:.833333,w:17,h:17},{c:12404,x0:613,y0:423,yoffs:1,sc:.833333,w:18,h:17},{c:12405,x0:280,y0:667,yoffs:2,xpad:.294922,sc:.833333,w:17,h:15},{c:12406,x0:692,y0:477,yoffs:2,xpad:.294922,sc:.833333,w:17,h:16},{c:12407,x0:720,y0:477,yoffs:2,xpad:.294922,sc:.833333,w:17,h:16},{c:12408,x0:946,y0:835,yoffs:4,xpad:.294922,sc:.833333,w:17,h:12},{c:12409,x0:266,y0:820,yoffs:3,xpad:.294922,sc:.833333,w:17,h:14},{c:12410,x0:294,y0:820,yoffs:3,xpad:.294922,sc:.833333,w:17,h:14},{c:12411,x0:308,y0:666,yoffs:2,xpad:.294922,sc:.833333,w:17,h:15},{c:12412,x0:642,y0:423,yoffs:1,sc:.833333,w:18,h:17},{c:12413,x0:671,y0:422,yoffs:1,sc:.833333,w:18,h:17},{c:12414,x0:748,y0:477,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:16},{c:12415,x0:775,y0:477,yoffs:2,xpad:.294922,sc:.833333,w:17,h:16},{c:12416,x0:803,y0:477,yoffs:2,xpad:.294922,sc:.833333,w:17,h:16},{c:12417,x0:831,y0:477,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:16},{c:12418,x0:858,y0:477,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:16},{c:12419,x0:322,y0:820,yoffs:4,xpad:2.29492,sc:.833333,w:15,h:14},{c:12420,x0:700,y0:422,yoffs:1,xpad:.294922,sc:.833333,w:17,h:17},{c:12421,x0:467,y0:842,yoffs:5,xpad:2.29492,sc:.833333,w:15,h:13},{c:12422,x0:885,y0:476,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:16},{c:12423,x0:493,y0:842,yoffs:5,xpad:3.29492,sc:.833333,w:14,h:13},{c:12424,x0:912,y0:476,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:16},{c:12425,x0:939,y0:476,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:16},{c:12426,x0:966,y0:476,yoffs:2,xpad:2.29492,sc:.833333,w:15,h:16},{c:12427,x0:992,y0:476,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:16},{c:12428,x0:336,y0:666,yoffs:2,xpad:.294922,sc:.833333,w:17,h:15},{c:12429,x0:5,y0:512,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:16},{c:12430,x0:518,y0:842,yoffs:4,xpad:1.29492,sc:.833333,w:16,h:13},{c:12431,x0:364,y0:666,yoffs:2,xpad:.294922,sc:.833333,w:17,h:15},{c:12432,x0:32,y0:512,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:16},{c:12433,x0:59,y0:512,yoffs:2,xpad:.294922,sc:.833333,w:17,h:16},{c:12434,x0:87,y0:512,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:16},{c:12435,x0:114,y0:512,yoffs:2,xpad:.294922,sc:.833333,w:17,h:16},{c:12436,x0:142,y0:512,yoffs:2,xpad:.294922,sc:.833333,w:17,h:16},{c:12437,x0:545,y0:840,yoffs:5,xpad:1.29492,sc:.833333,w:16,h:13},{c:12438,x0:572,y0:840,yoffs:5,xpad:1.29492,sc:.833333,w:16,h:13},{c:12441,x0:814,y0:966,yoffs:1,xpad:11.2949,sc:.833333,w:6,h:5},{c:12442,x0:318,y0:977,yoffs:1,xpad:12.2949,sc:.833333,w:5,h:6},{c:12443,x0:814,y0:966,yoffs:1,xpad:11.2949,sc:.833333,w:6,h:5},{c:12444,x0:318,y0:977,yoffs:1,xpad:12.2949,sc:.833333,w:5,h:6},{c:12445,x0:974,y0:835,yoffs:4,xpad:3.29492,sc:.833333,w:14,h:12},{c:12446,x0:599,y0:839,yoffs:3,xpad:2.29492,sc:.833333,w:15,h:13},{c:12447,x0:728,y0:422,yoffs:1,xpad:1.29492,sc:.833333,w:16,h:17},{c:12448,x0:831,y0:966,yoffs:7,xpad:4.29492,sc:.833333,w:13,h:5},{c:12449,x0:999,y0:835,yoffs:6,xpad:1.29492,sc:.833333,w:16,h:12},{c:12450,x0:392,y0:666,yoffs:3,xpad:.294922,sc:.833333,w:17,h:15},{c:12451,x0:625,y0:839,yoffs:5,xpad:2.29492,sc:.833333,w:15,h:13},{c:12452,x0:420,y0:666,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:15},{c:12453,x0:651,y0:839,yoffs:5,xpad:2.29492,sc:.833333,w:15,h:13},{c:12454,x0:170,y0:512,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:16},{c:12455,x0:769,y0:927,yoffs:6,xpad:2.29492,sc:.833333,w:15,h:11},{c:12456,x0:5,y0:869,yoffs:4,xpad:1.29492,sc:.833333,w:16,h:12},{c:12457,x0:677,y0:839,yoffs:5,xpad:1.29492,sc:.833333,w:16,h:13},{c:12458,x0:447,y0:664,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:15},{c:12459,x0:474,y0:664,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:15},{c:12460,x0:755,y0:422,yoffs:1,xpad:.294922,sc:.833333,w:17,h:17},{c:12461,x0:197,y0:512,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:16},{c:12462,x0:783,y0:422,yoffs:1,xpad:.294922,sc:.833333,w:17,h:17},{c:12463,x0:811,y0:422,yoffs:1,xpad:1.29492,sc:.833333,w:16,h:17},{c:12464,x0:838,y0:422,yoffs:1,xpad:.294922,sc:.833333,w:17,h:17},{c:12465,x0:224,y0:510,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:16},{c:12466,x0:866,y0:421,yoffs:1,xpad:.294922,sc:.833333,w:17,h:17},{c:12467,x0:348,y0:818,yoffs:3,xpad:1.29492,sc:.833333,w:16,h:14},{c:12468,x0:894,y0:421,yoffs:1,xpad:.294922,sc:.833333,w:17,h:17},{c:12469,x0:251,y0:509,yoffs:2,xpad:.294922,sc:.833333,w:17,h:16},{c:12470,x0:279,y0:509,yoffs:2,xpad:.294922,sc:.833333,w:17,h:16},{c:12471,x0:307,y0:509,yoffs:2,xpad:.294922,sc:.833333,w:17,h:16},{c:12472,x0:335,y0:509,yoffs:2,xpad:.294922,sc:.833333,w:17,h:16},{c:12473,x0:375,y0:818,yoffs:3,xpad:1.29492,sc:.833333,w:16,h:14},{c:12474,x0:922,y0:421,yoffs:1,xpad:.294922,sc:.833333,w:17,h:17},{c:12475,x0:501,y0:663,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:15},{c:12476,x0:950,y0:421,yoffs:1,xpad:.294922,sc:.833333,w:17,h:17},{c:12477,x0:402,y0:817,yoffs:3,xpad:1.29492,sc:.833333,w:16,h:14},{c:12478,x0:978,y0:421,yoffs:1,xpad:.294922,sc:.833333,w:17,h:17},{c:12479,x0:5,y0:457,yoffs:1,xpad:1.29492,sc:.833333,w:16,h:17},{c:12480,x0:32,y0:457,yoffs:1,xpad:.294922,sc:.833333,w:17,h:17},{c:12481,x0:363,y0:509,yoffs:2,xpad:.294922,sc:.833333,w:17,h:16},{c:12482,x0:391,y0:507,yoffs:2,xpad:.294922,sc:.833333,w:17,h:16},{c:12483,x0:704,y0:837,yoffs:5,xpad:1.29492,sc:.833333,w:16,h:13},{c:12484,x0:419,y0:507,yoffs:2,xpad:.294922,sc:.833333,w:17,h:16},{c:12485,x0:60,y0:457,yoffs:1,xpad:.294922,sc:.833333,w:17,h:17},{c:12486,x0:447,y0:506,yoffs:2,xpad:.294922,sc:.833333,w:17,h:16},{c:12487,x0:88,y0:457,yoffs:1,sc:.833333,w:18,h:17},{c:12488,x0:528,y0:663,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:15},{c:12489,x0:475,y0:506,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:16},{c:12490,x0:502,y0:506,yoffs:2,xpad:.294922,sc:.833333,w:17,h:16},{c:12491,x0:32,y0:869,yoffs:4,xpad:1.29492,sc:.833333,w:16,h:12},{c:12492,x0:555,y0:663,yoffs:3,xpad:2.29492,sc:.833333,w:15,h:15},{c:12493,x0:530,y0:506,yoffs:2,xpad:.294922,sc:.833333,w:17,h:16},{c:12494,x0:581,y0:663,yoffs:2,xpad:2.29492,sc:.833333,w:15,h:15},{c:12495,x0:429,y0:817,yoffs:3,xpad:.294922,sc:.833333,w:17,h:14},{c:12496,x0:558,y0:505,yoffs:1,xpad:.294922,sc:.833333,w:17,h:16},{c:12497,x0:586,y0:505,yoffs:1,xpad:.294922,sc:.833333,w:17,h:16},{c:12498,x0:607,y0:662,yoffs:2,xpad:2.29492,sc:.833333,w:15,h:15},{c:12499,x0:614,y0:505,yoffs:1,xpad:.294922,sc:.833333,w:17,h:16},{c:12500,x0:642,y0:505,yoffs:1,xpad:.294922,sc:.833333,w:17,h:16},{c:12501,x0:457,y0:817,yoffs:3,xpad:1.29492,sc:.833333,w:16,h:14},{c:12502,x0:117,y0:457,yoffs:1,xpad:.294922,sc:.833333,w:17,h:17},{c:12503,x0:145,y0:457,yoffs:1,xpad:.294922,sc:.833333,w:17,h:17},{c:12504,x0:59,y0:869,yoffs:4,xpad:.294922,sc:.833333,w:17,h:12},{c:12505,x0:484,y0:817,yoffs:3,xpad:.294922,sc:.833333,w:17,h:14},{c:12506,x0:512,y0:817,yoffs:3,xpad:.294922,sc:.833333,w:17,h:14},{c:12507,x0:670,y0:505,yoffs:2,xpad:.294922,sc:.833333,w:17,h:16},{c:12508,x0:173,y0:457,yoffs:1,xpad:.294922,sc:.833333,w:17,h:17},{c:12509,x0:201,y0:455,yoffs:1,xpad:.294922,sc:.833333,w:17,h:17},{c:12510,x0:633,y0:662,yoffs:3,xpad:.294922,sc:.833333,w:17,h:15},{c:12511,x0:698,y0:504,yoffs:2,xpad:2.29492,sc:.833333,w:15,h:16},{c:12512,x0:661,y0:662,yoffs:2,xpad:.294922,sc:.833333,w:17,h:15},{c:12513,x0:724,y0:504,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:16},{c:12514,x0:540,y0:815,yoffs:3,xpad:1.29492,sc:.833333,w:16,h:14},{c:12515,x0:731,y0:837,yoffs:5,xpad:1.29492,sc:.833333,w:16,h:13},{c:12516,x0:751,y0:504,yoffs:2,xpad:.294922,sc:.833333,w:17,h:16},{c:12517,x0:189,y0:958,yoffs:7,xpad:2.29492,sc:.833333,w:15,h:10},{c:12518,x0:87,y0:869,yoffs:4,xpad:.294922,sc:.833333,w:17,h:12},{c:12519,x0:115,y0:869,yoffs:6,xpad:3.29492,sc:.833333,w:14,h:12},{c:12520,x0:567,y0:815,yoffs:3,xpad:2.29492,sc:.833333,w:15,h:14},{c:12521,x0:779,y0:504,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:16},{c:12522,x0:806,y0:504,yoffs:2,xpad:3.29492,sc:.833333,w:14,h:16},{c:12523,x0:831,y0:504,yoffs:2,xpad:.294922,sc:.833333,w:17,h:16},{c:12524,x0:593,y0:814,yoffs:3,xpad:.294922,sc:.833333,w:17,h:14},{c:12525,x0:621,y0:814,yoffs:3,xpad:1.29492,sc:.833333,w:16,h:14},{c:12526,x0:140,y0:869,yoffs:6,xpad:2.29492,sc:.833333,w:15,h:12},{c:12527,x0:689,y0:662,yoffs:3,xpad:1.29492,sc:.833333,w:16,h:15},{c:12528,x0:859,y0:504,yoffs:2,xpad:.294922,sc:.833333,w:17,h:16},{c:12529,x0:758,y0:837,yoffs:3,xpad:.294922,sc:.833333,w:17,h:13},{c:12530,x0:716,y0:662,yoffs:3,xpad:1.29492,sc:.833333,w:16,h:15},{c:12531,x0:648,y0:814,yoffs:3,xpad:.294922,sc:.833333,w:17,h:14},{c:12532,x0:229,y0:454,yoffs:1,xpad:.294922,sc:.833333,w:17,h:17},{c:12533,x0:786,y0:837,yoffs:5,xpad:2.29492,sc:.833333,w:15,h:13},{c:12534,x0:812,y0:837,yoffs:5,xpad:2.29492,sc:.833333,w:15,h:13},{c:12535,x0:257,y0:454,yoffs:1,xpad:.294922,sc:.833333,w:17,h:17},{c:12536,x0:285,y0:454,yoffs:1,xpad:.294922,sc:.833333,w:17,h:17},{c:12537,x0:887,y0:503,yoffs:1,xpad:.294922,sc:.833333,w:17,h:16},{c:12538,x0:313,y0:454,yoffs:1,xpad:.294922,sc:.833333,w:17,h:17},{c:12539,x0:855,y0:965,yoffs:7,xpad:6.29492,sc:.833333,w:11,h:5},{c:12540,x0:5,y0:1011,yoffs:8,xpad:1.29492,sc:.833333,w:16,h:3},{c:12541,x0:215,y0:958,yoffs:5,xpad:3.29492,sc:.833333,w:14,h:10},{c:12542,x0:166,y0:869,yoffs:3,xpad:2.29492,sc:.833333,w:15,h:12},{c:12543,x0:915,y0:503,yoffs:2,xpad:3.29492,sc:.833333,w:14,h:16},{c:65024,xpad:.00488281,sc:.833333},{c:65533,x0:676,y0:814,yoffs:3,sc:.833333,w:13,h:14}]}},{}],90:[function(e,t,r){t.exports={font_size:32,imageW:1024,imageH:1024,spread:8,channels:1,char_infos:[{c:1,xpad:3.92578,sc:.625},{c:2,xpad:3.92578,sc:.625},{c:3,xpad:3.92578,sc:.625},{c:4,xpad:3.92578,sc:.625},{c:5,xpad:3.92578,sc:.625},{c:6,xpad:3.92578,sc:.625},{c:7,xpad:3.92578,sc:.625},{c:8},{c:9,xpad:5.75781},{c:10,xpad:3.92578,sc:.625},{c:11,xpad:3.92578,sc:.625},{c:12,xpad:3.92578,sc:.625},{c:13,xpad:5.75781},{c:14,xpad:3.92578,sc:.625},{c:15,xpad:3.92578,sc:.625},{c:16,xpad:3.92578,sc:.625},{c:17,xpad:3.92578,sc:.625},{c:18,xpad:3.92578,sc:.625},{c:19,xpad:3.92578,sc:.625},{c:20,xpad:3.92578,sc:.625},{c:21,xpad:3.92578,sc:.625},{c:22,xpad:3.92578,sc:.625},{c:23,xpad:3.92578,sc:.625},{c:24,xpad:3.92578,sc:.625},{c:25,xpad:3.92578,sc:.625},{c:26,xpad:3.92578,sc:.625},{c:27,xpad:3.92578,sc:.625},{c:28,xpad:3.92578,sc:.625},{c:29},{c:30,xpad:3.92578,sc:.625},{c:31,xpad:3.92578,sc:.625},{c:32,xpad:5.75781},{c:33,x0:675,y0:94,yoffs:5,xpad:1.76563,w:6,h:22},{c:34,x0:8,y0:617,yoffs:3,xpad:1.16406,w:10,h:9},{c:35,x0:289,y0:138,yoffs:5,xpad:.75,w:16,h:21},{c:36,x0:42,y0:55,yoffs:3,xpad:.703125,w:12,h:27},{c:37,x0:698,y0:94,yoffs:5,xpad:1.05469,w:18,h:22},{c:38,x0:8,y0:100,yoffs:4,xpad:.09375,w:15,h:23},{c:39,x0:35,y0:617,yoffs:3,xpad:1.55469,w:5,h:9},{c:40,x0:8,y0:8,yoffs:2,w:9,h:30},{c:41,x0:34,y0:8,yoffs:2,xpad:1.42188,w:7,h:30},{c:42,x0:512,y0:499,yoffs:5,xpad:.429688,w:11,h:10},{c:43,x0:863,y0:263,yoffs:11,xpad:.703125,w:12,h:12},{c:44,x0:57,y0:617,yoffs:22,xpad:1.85156,w:5,h:9},{c:45,x0:724,y0:952,yoffs:15,w:7,h:4},{c:46,x0:378,y0:894,yoffs:22,xpad:.851563,w:6,h:5},{c:47,x0:58,y0:8,yoffs:2,w:10,h:30},{c:48,x0:40,y0:100,yoffs:4,xpad:.703125,w:12,h:23},{c:49,x0:322,y0:136,yoffs:5,xpad:3.70313,w:9,h:21},{c:50,x0:733,y0:94,yoffs:4,xpad:1.70313,w:11,h:22},{c:51,x0:69,y0:99,yoffs:4,xpad:1.70313,w:11,h:23},{c:52,x0:348,y0:136,yoffs:5,xpad:.703125,w:12,h:21},{c:53,x0:761,y0:94,yoffs:5,xpad:1.70313,w:11,h:22},{c:54,x0:789,y0:94,yoffs:5,xpad:.703125,w:12,h:22},{c:55,x0:377,y0:136,yoffs:5,xpad:.703125,w:12,h:21},{c:56,x0:97,y0:99,yoffs:4,xpad:.703125,w:12,h:23},{c:57,x0:818,y0:94,yoffs:4,xpad:.703125,w:12,h:22},{c:58,x0:187,y0:178,yoffs:10,xpad:.851563,w:6,h:17},{c:59,x0:406,y0:136,yoffs:10,xpad:.851563,w:6,h:21},{c:60,x0:945,y0:171,yoffs:10,xpad:.703125,w:12,h:14},{c:61,x0:79,y0:617,yoffs:13,xpad:.703125,w:12,h:9},{c:62,x0:974,y0:171,yoffs:10,xpad:.703125,w:12,h:14},{c:63,x0:126,y0:99,yoffs:4,xpad:.101563,w:10,h:23},{c:64,x0:71,y0:55,yoffs:4,xpad:1.34375,w:23,h:27},{c:65,x0:429,y0:136,yoffs:5,w:15,h:21},{c:66,x0:847,y0:94,yoffs:5,xpad:.390625,w:15,h:22},{c:67,x0:153,y0:99,yoffs:4,w:14,h:23},{c:68,x0:879,y0:94,yoffs:5,xpad:1.01563,w:16,h:22},{c:69,x0:461,y0:136,yoffs:5,xpad:.46875,w:13,h:21},{c:70,x0:491,y0:136,yoffs:5,xpad:.585938,w:12,h:21},{c:71,x0:184,y0:99,yoffs:4,xpad:1.50781,w:14,h:23},{c:72,x0:520,y0:136,yoffs:5,xpad:2.01563,w:15,h:21},{c:73,x0:552,y0:135,yoffs:5,xpad:1.61719,w:6,h:21},{c:74,x0:912,y0:94,yoffs:5,xpad:1.67188,w:10,h:22},{c:75,x0:575,y0:134,yoffs:5,xpad:.21875,w:15,h:21},{c:76,x0:607,y0:134,yoffs:5,xpad:.320313,w:12,h:21},{c:77,x0:636,y0:134,yoffs:5,xpad:1.45313,w:20,h:21},{c:78,x0:673,y0:134,yoffs:5,xpad:2.16406,w:15,h:21},{c:79,x0:215,y0:99,yoffs:4,xpad:.875,w:17,h:23},{c:80,x0:705,y0:133,yoffs:5,xpad:.328125,w:14,h:21},{c:81,x0:510,y0:8,yoffs:4,xpad:.875,w:17,h:28},{c:82,x0:736,y0:133,yoffs:5,xpad:.1875,w:15,h:21},{c:83,x0:249,y0:99,yoffs:4,w:12,h:23},{c:84,x0:768,y0:133,yoffs:5,w:13,h:21},{c:85,x0:939,y0:94,yoffs:5,xpad:2.21875,w:14,h:22},{c:86,x0:798,y0:133,yoffs:5,w:15,h:21},{c:87,x0:830,y0:133,yoffs:5,xpad:.335938,w:22,h:21},{c:88,x0:869,y0:133,yoffs:5,w:14,h:21},{c:89,x0:900,y0:133,yoffs:5,w:14,h:21},{c:90,x0:931,y0:133,yoffs:5,xpad:.765625,w:12,h:21},{c:91,x0:85,y0:8,yoffs:2,w:9,h:30},{c:92,x0:111,y0:8,yoffs:2,w:10,h:30},{c:93,x0:138,y0:8,yoffs:2,xpad:2.29688,w:6,h:30},{c:94,x0:892,y0:263,yoffs:5,xpad:.703125,w:12,h:12},{c:95,x0:8,y0:984,yoffs:29,w:12,h:3},{c:96,x0:963,y0:831,yoffs:2,xpad:2.27344,w:7,h:7},{c:97,x0:210,y0:178,yoffs:10,xpad:1.82031,w:11,h:17},{c:98,x0:564,y0:53,yoffs:3,xpad:.796875,w:13,h:24},{c:99,x0:238,y0:178,yoffs:10,xpad:.429688,w:10,h:17},{c:100,x0:594,y0:53,yoffs:3,xpad:1.79688,w:12,h:24},{c:101,x0:265,y0:178,yoffs:10,xpad:.882813,w:12,h:17},{c:102,x0:278,y0:98,yoffs:3,w:10,h:23},{c:103,x0:970,y0:94,yoffs:10,xpad:1.79688,w:12,h:22},{c:104,x0:305,y0:96,yoffs:3,xpad:1.24219,w:13,h:23},{c:105,x0:999,y0:94,yoffs:4,xpad:1.14844,w:6,h:22},{c:106,x0:544,y0:8,yoffs:4,xpad:1.14844,w:7,h:28},{c:107,x0:335,y0:96,yoffs:3,w:13,h:23},{c:108,x0:623,y0:53,yoffs:3,xpad:.179688,w:7,h:24},{c:109,x0:416,y0:174,yoffs:10,xpad:1.625,w:19,h:16},{c:110,x0:452,y0:174,yoffs:10,xpad:1.24219,w:13,h:16},{c:111,x0:294,y0:176,yoffs:10,xpad:.679688,w:13,h:17},{c:112,x0:8,y0:140,yoffs:10,xpad:.796875,w:13,h:22},{c:113,x0:38,y0:140,yoffs:10,xpad:1.79688,w:12,h:22},{c:114,x0:482,y0:174,yoffs:10,w:10,h:16},{c:115,x0:324,y0:174,yoffs:10,xpad:.0703125,w:10,h:17},{c:116,x0:67,y0:140,yoffs:5,w:10,h:22},{c:117,x0:351,y0:174,yoffs:10,xpad:2.17969,w:12,h:17},{c:118,x0:509,y0:174,yoffs:10,w:12,h:16},{c:119,x0:538,y0:174,yoffs:10,w:17,h:16},{c:120,x0:572,y0:173,yoffs:10,w:12,h:16},{c:121,x0:94,y0:139,yoffs:10,w:12,h:22},{c:122,x0:601,y0:172,yoffs:10,xpad:.515625,w:10,h:16},{c:123,x0:161,y0:8,yoffs:2,w:8,h:30},{c:124,x0:186,y0:8,yoffs:2,xpad:1.94531,w:6,h:30},{c:125,x0:209,y0:8,yoffs:2,xpad:.859375,w:7,h:30},{c:126,x0:986,y0:855,yoffs:14,xpad:.703125,w:12,h:6},{c:160,xpad:5.75781},{c:161,x0:123,y0:139,yoffs:10,xpad:1.76563,w:6,h:22},{c:162,x0:647,y0:53,yoffs:5,xpad:1.70313,w:11,h:24},{c:163,x0:960,y0:133,yoffs:5,xpad:.703125,w:12,h:21},{c:164,x0:788,y0:171,yoffs:8,xpad:.703125,w:12,h:15},{c:165,x0:989,y0:133,yoffs:5,w:13,h:21},{c:166,x0:233,y0:8,yoffs:2,xpad:1.94531,w:6,h:30},{c:167,x0:537,y0:495,yoffs:3,xpad:.387695,sc:.625,w:7,h:16},{c:168,x0:710,y0:1003,yoffs:2,sc:.625,w:6,h:3},{c:169,x0:959,y0:675,yoffs:3,xpad:1.12988,sc:.625,w:12,h:14},{c:170,x0:212,y0:981,yoffs:3,xpad:.854492,sc:.625,w:5,h:8},{c:171,x0:745,y0:947,yoffs:6,xpad:.364258,sc:.625,w:8,h:10},{c:172,x0:577,y0:975,yoffs:8,xpad:.939453,sc:.625,w:7,h:6},{c:173,x0:727,y0:1003,yoffs:9,xpad:.301758,sc:.625,w:4,h:3},{c:174,x0:982,y0:675,yoffs:3,xpad:1.12988,sc:.625,w:12,h:14},{c:175,x0:929,y0:1011,yoffs:3,xpad:.795898,sc:.625,w:5,h:2},{c:176,x0:987,y0:964,yoffs:2,xpad:.317383,sc:.625,w:5,h:5},{c:177,x0:764,y0:947,yoffs:7,sc:.625,w:8,h:10},{c:178,x0:228,y0:981,yoffs:3,xpad:.170898,sc:.625,w:5,h:8},{c:179,x0:244,y0:981,yoffs:3,xpad:.170898,sc:.625,w:5,h:8},{c:180,x0:1003,y0:964,yoffs:1,sc:.625,w:6,h:5},{c:181,x0:1005,y0:675,yoffs:6,xpad:1.00879,sc:.625,w:8,h:14},{c:182,x0:484,y0:383,yoffs:3,xpad:1.78516,sc:.625,w:8,h:17},{c:183,x0:742,y0:1002,yoffs:9,xpad:.189453,sc:.625,w:4,h:3},{c:184,x0:5,y0:1001,yoffs:15,xpad:.795898,sc:.625,w:5,h:5},{c:185,x0:260,y0:981,yoffs:3,xpad:1.1709,sc:.625,w:4,h:8},{c:186,x0:275,y0:981,yoffs:3,xpad:.71875,sc:.625,w:6,h:8},{c:187,x0:783,y0:946,yoffs:6,xpad:.364258,sc:.625,w:8,h:10},{c:188,x0:5,y0:718,yoffs:3,xpad:.0371094,sc:.625,w:13,h:14},{c:189,x0:29,y0:718,yoffs:3,xpad:.0371094,sc:.625,w:13,h:14},{c:190,x0:53,y0:718,yoffs:3,xpad:.0371094,sc:.625,w:13,h:14},{c:191,x0:146,y0:139,yoffs:10,xpad:.101563,w:10,h:22},{c:192,x0:568,y0:8,yoffs:-2,w:15,h:28},{c:193,x0:600,y0:8,yoffs:-2,w:15,h:28},{c:194,x0:632,y0:8,yoffs:-2,w:15,h:28},{c:195,x0:111,y0:55,yoffs:-1,w:15,h:27},{c:196,x0:143,y0:55,yoffs:-1,w:15,h:27},{c:197,x0:300,y0:54,yoffs:1,w:15,h:25},{c:198,x0:8,y0:179,yoffs:5,xpad:.539063,w:21,h:21},{c:199,x0:664,y0:8,yoffs:4,w:14,h:28},{c:200,x0:695,y0:8,yoffs:-2,xpad:.46875,w:13,h:28},{c:201,x0:725,y0:8,yoffs:-2,xpad:.46875,w:13,h:28},{c:202,x0:755,y0:8,yoffs:-2,xpad:.46875,w:13,h:28},{c:203,x0:175,y0:55,yoffs:-1,xpad:.46875,w:13,h:27},{c:204,x0:785,y0:8,yoffs:-2,xpad:1.61719,w:6,h:28},{c:205,x0:808,y0:8,yoffs:-2,w:8,h:28},{c:206,x0:833,y0:8,yoffs:-2,w:8,h:28},{c:207,x0:205,y0:55,yoffs:-1,w:9,h:27},{c:208,x0:173,y0:139,yoffs:5,xpad:1.01563,w:16,h:22},{c:209,x0:231,y0:55,yoffs:-1,xpad:2.16406,w:15,h:27},{c:210,x0:285,y0:8,yoffs:-2,xpad:.875,w:17,h:29},{c:211,x0:319,y0:8,yoffs:-2,xpad:.875,w:17,h:29},{c:212,x0:353,y0:8,yoffs:-2,xpad:.875,w:17,h:29},{c:213,x0:858,y0:8,yoffs:-1,xpad:.875,w:17,h:28},{c:214,x0:892,y0:8,yoffs:-1,xpad:.875,w:17,h:28},{c:215,x0:558,y0:498,yoffs:12,xpad:.703125,w:12,h:10},{c:216,x0:365,y0:96,yoffs:4,xpad:.875,w:17,h:23},{c:217,x0:387,y0:8,yoffs:-2,xpad:2.21875,w:14,h:29},{c:218,x0:418,y0:8,yoffs:-2,xpad:2.21875,w:14,h:29},{c:219,x0:449,y0:8,yoffs:-2,xpad:2.21875,w:14,h:29},{c:220,x0:926,y0:8,yoffs:-1,xpad:2.21875,w:14,h:28},{c:221,x0:957,y0:8,yoffs:-2,w:14,h:28},{c:222,x0:46,y0:179,yoffs:5,xpad:.359375,w:14,h:21},{c:223,x0:675,y0:53,yoffs:3,xpad:.390625,w:14,h:24},{c:224,x0:332,y0:54,yoffs:2,xpad:1.82031,w:11,h:25},{c:225,x0:360,y0:54,yoffs:2,xpad:1.82031,w:11,h:25},{c:226,x0:706,y0:53,yoffs:3,xpad:1.82031,w:11,h:24},{c:227,x0:399,y0:96,yoffs:4,xpad:1.82031,w:11,h:23},{c:228,x0:427,y0:96,yoffs:4,xpad:1.82031,w:11,h:23},{c:229,x0:734,y0:53,yoffs:3,xpad:1.82031,w:11,h:24},{c:230,x0:380,y0:174,yoffs:10,xpad:.585938,w:19,h:17},{c:231,x0:206,y0:139,yoffs:10,xpad:.429688,w:10,h:22},{c:232,x0:388,y0:54,yoffs:2,xpad:.882813,w:12,h:25},{c:233,x0:417,y0:54,yoffs:2,xpad:.882813,w:12,h:25},{c:234,x0:762,y0:53,yoffs:3,xpad:.882813,w:12,h:24},{c:235,x0:455,y0:96,yoffs:4,xpad:.882813,w:12,h:23},{c:236,x0:791,y0:53,yoffs:2,xpad:1.14844,w:6,h:24},{c:237,x0:814,y0:53,yoffs:2,w:8,h:24},{c:238,x0:484,y0:96,yoffs:3,xpad:.148438,w:7,h:23},{c:239,x0:233,y0:139,yoffs:4,w:9,h:22},{c:240,x0:839,y0:53,yoffs:3,xpad:.617188,w:13,h:24},{c:241,x0:259,y0:139,yoffs:4,xpad:1.24219,w:13,h:22},{c:242,x0:446,y0:54,yoffs:2,xpad:.679688,w:13,h:25},{c:243,x0:476,y0:54,yoffs:2,xpad:.679688,w:13,h:25},{c:244,x0:869,y0:53,yoffs:3,xpad:.679688,w:13,h:24},{c:245,x0:508,y0:96,yoffs:4,xpad:.679688,w:13,h:23},{c:246,x0:538,y0:95,yoffs:4,xpad:.679688,w:13,h:23},{c:247,x0:1003,y0:171,yoffs:10,xpad:.703125,w:12,h:14},{c:248,x0:157,y0:178,yoffs:9,xpad:.679688,w:13,h:18},{c:249,x0:506,y0:54,yoffs:2,xpad:2.17969,w:12,h:25},{c:250,x0:535,y0:53,yoffs:2,xpad:2.17969,w:12,h:25},{c:251,x0:899,y0:53,yoffs:3,xpad:2.17969,w:12,h:24},{c:252,x0:568,y0:94,yoffs:4,xpad:2.17969,w:12,h:23},{c:253,x0:256,y0:8,yoffs:2,w:12,h:30},{c:254,x0:480,y0:8,yoffs:3,xpad:.796875,w:13,h:29},{c:255,x0:988,y0:8,yoffs:4,w:12,h:28},{c:256,x0:503,y0:382,xpad:.287109,sc:.625,w:9,h:17},{c:257,x0:77,y0:718,yoffs:3,xpad:1.0127,sc:.625,w:7,h:14},{c:258,x0:918,y0:260,yoffs:-1,xpad:.287109,sc:.625,w:9,h:18},{c:259,x0:105,y0:614,yoffs:2,xpad:1.0127,sc:.625,w:7,h:15},{c:260,x0:523,y0:382,yoffs:3,xpad:.287109,sc:.625,w:9,h:17},{c:261,x0:95,y0:718,yoffs:6,xpad:1.0127,sc:.625,w:7,h:14},{c:262,x0:938,y0:260,yoffs:-1,sc:.625,w:9,h:18},{c:263,x0:584,y0:494,yoffs:1,sc:.625,w:7,h:16},{c:264,x0:958,y0:260,yoffs:-1,sc:.625,w:9,h:18},{c:265,x0:123,y0:614,yoffs:2,sc:.625,w:7,h:15},{c:266,x0:978,y0:259,yoffs:-1,sc:.625,w:9,h:18},{c:267,x0:141,y0:614,yoffs:2,sc:.625,w:7,h:15},{c:268,x0:998,y0:259,yoffs:-1,sc:.625,w:9,h:18},{c:269,x0:159,y0:614,yoffs:2,sc:.625,w:7,h:15},{c:270,x0:5,y0:305,yoffs:-1,xpad:.634766,sc:.625,w:10,h:18},{c:271,x0:602,y0:494,yoffs:1,sc:.625,w:10,h:16},{c:272,x0:113,y0:718,yoffs:3,xpad:.634766,sc:.625,w:10,h:14},{c:273,x0:623,y0:494,yoffs:1,sc:.625,w:9,h:16},{c:274,x0:543,y0:382,xpad:.417969,sc:.625,w:8,h:17},{c:275,x0:134,y0:718,yoffs:3,xpad:.0517578,sc:.625,w:8,h:14},{c:276,x0:26,y0:305,yoffs:-1,xpad:.417969,sc:.625,w:8,h:18},{c:277,x0:177,y0:614,yoffs:2,xpad:.0517578,sc:.625,w:8,h:15},{c:278,x0:45,y0:305,yoffs:-1,xpad:.417969,sc:.625,w:8,h:18},{c:279,x0:196,y0:614,yoffs:2,xpad:.0517578,sc:.625,w:8,h:15},{c:280,x0:562,y0:382,yoffs:3,xpad:.417969,sc:.625,w:8,h:17},{c:281,x0:153,y0:718,yoffs:6,xpad:.0517578,sc:.625,w:8,h:14},{c:282,x0:64,y0:305,yoffs:-1,xpad:.417969,sc:.625,w:8,h:18},{c:283,x0:215,y0:614,yoffs:2,xpad:.0517578,sc:.625,w:8,h:15},{c:284,x0:83,y0:305,yoffs:-1,xpad:.692383,sc:.625,w:9,h:18},{c:285,x0:103,y0:305,yoffs:2,xpad:.623047,sc:.625,w:8,h:18},{c:286,x0:122,y0:305,yoffs:-1,xpad:.692383,sc:.625,w:9,h:18},{c:287,x0:142,y0:304,yoffs:2,xpad:.623047,sc:.625,w:8,h:18},{c:288,x0:161,y0:304,yoffs:-1,xpad:.692383,sc:.625,w:9,h:18},{c:289,x0:181,y0:304,yoffs:2,xpad:.623047,sc:.625,w:8,h:18},{c:290,x0:581,y0:382,yoffs:3,xpad:.692383,sc:.625,w:9,h:17},{c:291,x0:662,y0:202,yoffs:1,xpad:.623047,sc:.625,w:8,h:19},{c:292,x0:200,y0:301,yoffs:-1,xpad:.634766,sc:.625,w:10,h:18},{c:293,x0:681,y0:202,yoffs:-2,xpad:.901367,sc:.625,w:8,h:19},{c:294,x0:172,y0:718,yoffs:3,sc:.625,w:11,h:14},{c:295,x0:643,y0:494,yoffs:1,xpad:.901367,sc:.625,w:8,h:16},{c:296,x0:221,y0:300,yoffs:-1,sc:.625,w:5,h:18},{c:297,x0:234,y0:613,yoffs:2,sc:.625,w:6,h:15},{c:298,x0:601,y0:382,sc:.625,w:5,h:17},{c:299,x0:194,y0:718,yoffs:3,sc:.625,w:5,h:14},{c:300,x0:237,y0:300,yoffs:-1,sc:.625,w:5,h:18},{c:301,x0:251,y0:613,yoffs:2,sc:.625,w:5,h:15},{c:302,x0:617,y0:382,yoffs:3,xpad:.760742,sc:.625,w:4,h:17},{c:303,x0:253,y0:300,yoffs:2,xpad:.467773,sc:.625,w:4,h:18},{c:304,x0:268,y0:300,yoffs:-1,xpad:.760742,sc:.625,w:4,h:18},{c:305,x0:398,y0:888,yoffs:6,xpad:.467773,sc:.625,w:4,h:11},{c:306,x0:210,y0:718,yoffs:3,xpad:1.06055,sc:.625,w:11,h:14},{c:307,x0:283,y0:300,yoffs:2,xpad:.935547,sc:.625,w:8,h:18},{c:308,x0:302,y0:300,yoffs:-1,sc:.625,w:8,h:18},{c:309,x0:321,y0:300,yoffs:2,sc:.625,w:6,h:18},{c:310,x0:632,y0:382,yoffs:3,sc:.625,w:10,h:17},{c:311,x0:700,y0:202,yoffs:1,sc:.625,w:8,h:19},{c:312,x0:413,y0:888,yoffs:6,sc:.625,w:8,h:11},{c:313,x0:338,y0:298,yoffs:-1,sc:.625,w:8,h:18},{c:314,x0:719,y0:201,yoffs:-2,sc:.625,w:5,h:19},{c:315,x0:653,y0:380,yoffs:3,sc:.625,w:8,h:17},{c:316,x0:735,y0:201,yoffs:1,sc:.625,w:5,h:19},{c:317,x0:232,y0:718,yoffs:3,sc:.625,w:8,h:14},{c:318,x0:662,y0:494,yoffs:1,sc:.625,w:6,h:16},{c:319,x0:251,y0:718,yoffs:3,sc:.625,w:8,h:14},{c:320,x0:679,y0:494,yoffs:1,sc:.625,w:7,h:16},{c:321,x0:270,y0:718,yoffs:3,sc:.625,w:8,h:14},{c:322,x0:697,y0:492,yoffs:1,sc:.625,w:6,h:16},{c:323,x0:357,y0:296,yoffs:-1,xpad:.727539,sc:.625,w:10,h:18},{c:324,x0:714,y0:492,yoffs:1,xpad:.901367,sc:.625,w:8,h:16},{c:325,x0:672,y0:380,yoffs:3,xpad:.727539,sc:.625,w:10,h:17},{c:326,x0:289,y0:717,yoffs:6,xpad:.901367,sc:.625,w:8,h:14},{c:327,x0:378,y0:296,yoffs:-1,xpad:.727539,sc:.625,w:10,h:18},{c:328,x0:267,y0:613,yoffs:2,xpad:.901367,sc:.625,w:8,h:15},{c:329,x0:733,y0:492,yoffs:1,xpad:.901367,sc:.625,w:8,h:16},{c:330,x0:693,y0:380,yoffs:3,xpad:.727539,sc:.625,w:10,h:17},{c:331,x0:308,y0:717,yoffs:6,xpad:.901367,sc:.625,w:8,h:14},{c:332,x0:714,y0:380,xpad:.171875,sc:.625,w:11,h:17},{c:333,x0:327,y0:717,yoffs:3,xpad:.549805,sc:.625,w:8,h:14},{c:334,x0:399,y0:296,yoffs:-1,xpad:.171875,sc:.625,w:11,h:18},{c:335,x0:286,y0:613,yoffs:2,xpad:.549805,sc:.625,w:8,h:15},{c:336,x0:751,y0:201,yoffs:-2,xpad:.171875,sc:.625,w:11,h:19},{c:337,x0:752,y0:491,yoffs:1,xpad:.549805,sc:.625,w:8,h:16},{c:338,x0:346,y0:714,yoffs:3,sc:.625,w:14,h:14},{c:339,x0:432,y0:888,yoffs:6,xpad:.168945,sc:.625,w:13,h:11},{c:340,x0:421,y0:296,yoffs:-1,xpad:.492188,sc:.625,w:9,h:18},{c:341,x0:771,y0:491,yoffs:1,xpad:.0546875,sc:.625,w:6,h:16},{c:342,x0:736,y0:379,yoffs:3,xpad:.492188,sc:.625,w:9,h:17},{c:343,x0:371,y0:714,yoffs:6,xpad:.0546875,sc:.625,w:6,h:14},{c:344,x0:441,y0:296,yoffs:-1,xpad:.492188,sc:.625,w:9,h:18},{c:345,x0:305,y0:610,yoffs:2,xpad:.0546875,sc:.625,w:6,h:15},{c:346,x0:461,y0:295,yoffs:-1,xpad:.387695,sc:.625,w:7,h:18},{c:347,x0:788,y0:491,yoffs:1,xpad:.293945,sc:.625,w:6,h:16},{c:348,x0:479,y0:295,yoffs:-1,xpad:.387695,sc:.625,w:7,h:18},{c:349,x0:322,y0:610,yoffs:2,xpad:.293945,sc:.625,w:6,h:15},{c:350,x0:756,y0:379,yoffs:3,xpad:.387695,sc:.625,w:7,h:17},{c:351,x0:388,y0:714,yoffs:6,xpad:.293945,sc:.625,w:6,h:14},{c:352,x0:497,y0:295,yoffs:-1,xpad:.387695,sc:.625,w:7,h:18},{c:353,x0:339,y0:610,yoffs:2,xpad:.293945,sc:.625,w:6,h:15},{c:354,x0:774,y0:378,yoffs:3,sc:.625,w:8,h:17},{c:355,x0:793,y0:378,yoffs:3,sc:.625,w:6,h:17},{c:356,x0:515,y0:295,yoffs:-1,sc:.625,w:8,h:18},{c:357,x0:805,y0:490,yoffs:1,sc:.625,w:6,h:16},{c:358,x0:405,y0:714,yoffs:3,sc:.625,w:8,h:14},{c:359,x0:424,y0:713,yoffs:3,xpad:.479492,sc:.625,w:6,h:14},{c:360,x0:534,y0:295,yoffs:-1,xpad:1.13672,sc:.625,w:9,h:18},{c:361,x0:356,y0:610,yoffs:2,xpad:.862305,sc:.625,w:8,h:15},{c:362,x0:810,y0:378,xpad:1.13672,sc:.625,w:9,h:17},{c:363,x0:441,y0:713,yoffs:3,xpad:.862305,sc:.625,w:8,h:14},{c:364,x0:554,y0:295,yoffs:-1,xpad:1.13672,sc:.625,w:9,h:18},{c:365,x0:375,y0:609,yoffs:2,xpad:.862305,sc:.625,w:8,h:15},{c:366,x0:574,y0:295,yoffs:-1,xpad:1.13672,sc:.625,w:9,h:18},{c:367,x0:394,y0:609,yoffs:2,xpad:.862305,sc:.625,w:8,h:15},{c:368,x0:773,y0:201,yoffs:-2,xpad:1.13672,sc:.625,w:9,h:19},{c:369,x0:822,y0:490,yoffs:1,xpad:.862305,sc:.625,w:8,h:16},{c:370,x0:830,y0:378,yoffs:3,xpad:1.13672,sc:.625,w:9,h:17},{c:371,x0:460,y0:713,yoffs:6,xpad:.862305,sc:.625,w:8,h:14},{c:372,x0:594,y0:295,yoffs:-1,sc:.625,w:14,h:18},{c:373,x0:413,y0:609,yoffs:2,sc:.625,w:11,h:15},{c:374,x0:619,y0:293,yoffs:-1,sc:.625,w:9,h:18},{c:375,x0:639,y0:293,yoffs:2,sc:.625,w:8,h:18},{c:376,x0:658,y0:293,yoffs:-1,sc:.625,w:9,h:18},{c:377,x0:678,y0:293,yoffs:-1,sc:.625,w:8,h:18},{c:378,x0:841,y0:490,yoffs:1,sc:.625,w:7,h:16},{c:379,x0:697,y0:293,yoffs:-1,sc:.625,w:8,h:18},{c:380,x0:435,y0:607,yoffs:2,sc:.625,w:7,h:15},{c:381,x0:716,y0:292,yoffs:-1,sc:.625,w:8,h:18},{c:382,x0:453,y0:607,yoffs:2,sc:.625,w:7,h:15},{c:383,x0:859,y0:490,yoffs:1,sc:.625,w:6,h:16},{c:384,x0:876,y0:490,yoffs:1,xpad:.623047,sc:.625,w:8,h:16},{c:385,x0:479,y0:711,yoffs:3,xpad:.620117,sc:.625,w:10,h:14},{c:386,x0:500,y0:711,yoffs:3,xpad:.25293,sc:.625,w:9,h:14},{c:387,x0:895,y0:489,yoffs:1,xpad:.623047,sc:.625,w:8,h:16},{c:388,x0:914,y0:489,yoffs:1,xpad:.623047,sc:.625,w:8,h:16},{c:389,x0:520,y0:711,yoffs:3,xpad:.0478516,sc:.625,w:9,h:14},{c:390,x0:540,y0:709,yoffs:3,xpad:.496094,sc:.625,w:8,h:14},{c:391,x0:933,y0:489,yoffs:1,sc:.625,w:11,h:16},{c:392,x0:984,y0:827,yoffs:4,sc:.625,w:9,h:13},{c:393,x0:113,y0:718,yoffs:3,xpad:.634766,sc:.625,w:10,h:14},{c:394,x0:559,y0:709,yoffs:3,xpad:.669922,sc:.625,w:11,h:14},{c:395,x0:581,y0:709,yoffs:3,xpad:1.25293,sc:.625,w:8,h:14},{c:396,x0:955,y0:489,yoffs:1,xpad:.623047,sc:.625,w:8,h:16},{c:397,x0:600,y0:709,yoffs:6,xpad:.642578,sc:.625,w:8,h:14},{c:398,x0:619,y0:708,yoffs:3,xpad:1.41797,sc:.625,w:7,h:14},{c:399,x0:637,y0:707,yoffs:3,xpad:.858398,sc:.625,w:9,h:14},{c:400,x0:657,y0:707,yoffs:3,sc:.625,w:8,h:14},{c:401,x0:850,y0:377,yoffs:3,sc:.625,w:9,h:17},{c:402,x0:793,y0:200,yoffs:1,xpad:.939453,sc:.625,w:7,h:19},{c:403,x0:974,y0:488,yoffs:1,sc:.625,w:11,h:16},{c:404,x0:870,y0:377,yoffs:3,sc:.625,w:10,h:17},{c:405,x0:996,y0:488,yoffs:1,xpad:.701172,sc:.625,w:13,h:16},{c:406,x0:676,y0:706,yoffs:3,sc:.625,w:6,h:14},{c:407,x0:693,y0:706,yoffs:3,sc:.625,w:6,h:14},{c:408,x0:710,y0:706,yoffs:3,sc:.625,w:10,h:14},{c:409,x0:5,y0:533,yoffs:1,sc:.625,w:8,h:16},{c:410,x0:24,y0:533,yoffs:1,sc:.625,w:5,h:16},{c:411,x0:40,y0:533,yoffs:1,sc:.625,w:8,h:16},{c:412,x0:731,y0:706,yoffs:3,xpad:1.25781,sc:.625,w:13,h:14},{c:413,x0:891,y0:377,yoffs:3,xpad:.0791016,sc:.625,w:11,h:17},{c:414,x0:755,y0:706,yoffs:6,xpad:.901367,sc:.625,w:8,h:14},{c:415,x0:774,y0:704,yoffs:3,xpad:.171875,sc:.625,w:11,h:14},{c:416,x0:59,y0:533,yoffs:1,xpad:.171875,sc:.625,w:11,h:16},{c:417,x0:1004,y0:827,yoffs:4,sc:.625,w:9,h:13},{c:418,x0:796,y0:704,yoffs:3,xpad:1.43945,sc:.625,w:14,h:14},{c:419,x0:821,y0:704,yoffs:6,xpad:.558594,sc:.625,w:12,h:14},{c:420,x0:844,y0:704,yoffs:3,sc:.625,w:10,h:14},{c:421,x0:811,y0:200,yoffs:1,xpad:.623047,sc:.625,w:8,h:19},{c:422,x0:735,y0:292,yoffs:1,sc:.625,w:10,h:18},{c:423,x0:865,y0:703,yoffs:3,xpad:.275391,sc:.625,w:7,h:14},{c:424,x0:456,y0:888,yoffs:6,xpad:.352539,sc:.625,w:6,h:11},{c:425,x0:883,y0:703,yoffs:3,sc:.625,w:8,h:14},{c:426,x0:830,y0:200,yoffs:1,sc:.625,w:7,h:19},{c:427,x0:913,y0:376,yoffs:3,sc:.625,w:6,h:17},{c:428,x0:902,y0:703,yoffs:3,sc:.625,w:9,h:14},{c:429,x0:81,y0:533,yoffs:1,sc:.625,w:6,h:16},{c:430,x0:930,y0:376,yoffs:3,sc:.625,w:8,h:17},{c:431,x0:98,y0:533,yoffs:1,sc:.625,w:11,h:16},{c:432,x0:5,y0:868,yoffs:4,sc:.625,w:10,h:13},{c:433,x0:922,y0:702,yoffs:3,xpad:.28418,sc:.625,w:11,h:14},{c:434,x0:944,y0:702,yoffs:3,xpad:.175781,sc:.625,w:10,h:14},{c:435,x0:965,y0:700,yoffs:3,sc:.625,w:11,h:14},{c:436,x0:987,y0:700,yoffs:6,sc:.625,w:9,h:14},{c:437,x0:1007,y0:700,yoffs:3,sc:.625,w:8,h:14},{c:438,x0:473,y0:888,yoffs:6,sc:.625,w:7,h:11},{c:439,x0:5,y0:743,yoffs:3,xpad:.441406,sc:.625,w:7,h:14},{c:440,x0:23,y0:743,yoffs:3,sc:.625,w:8,h:14},{c:441,x0:42,y0:743,yoffs:6,sc:.625,w:7,h:14},{c:442,x0:60,y0:743,yoffs:6,xpad:.738281,sc:.625,w:6,h:14},{c:443,x0:77,y0:743,yoffs:3,xpad:1.07129,sc:.625,w:7,h:14},{c:444,x0:95,y0:743,yoffs:3,xpad:.421875,sc:.625,w:7,h:14},{c:445,x0:491,y0:888,yoffs:6,xpad:.757813,sc:.625,w:6,h:11},{c:446,x0:113,y0:743,yoffs:3,xpad:.665039,sc:.625,w:6,h:14},{c:447,x0:130,y0:743,yoffs:6,xpad:.496094,sc:.625,w:8,h:14},{c:448,x0:848,y0:200,yoffs:1,xpad:.96582,sc:.625,w:4,h:19},{c:449,x0:863,y0:200,yoffs:1,xpad:1.25195,sc:.625,w:7,h:19},{c:450,x0:881,y0:200,yoffs:1,xpad:.217773,sc:.625,w:8,h:19},{c:451,x0:149,y0:743,yoffs:3,xpad:.853516,sc:.625,w:4,h:14},{c:452,x0:756,y0:291,yoffs:-1,xpad:.466797,sc:.625,w:18,h:18},{c:453,x0:471,y0:605,yoffs:2,xpad:.0654297,sc:.625,w:17,h:15},{c:454,x0:120,y0:533,yoffs:1,xpad:.473633,sc:.625,w:15,h:16},{c:455,x0:164,y0:743,yoffs:3,xpad:1.36621,sc:.625,w:14,h:14},{c:456,x0:785,y0:291,yoffs:2,xpad:1.16797,sc:.625,w:11,h:18},{c:457,x0:900,y0:200,yoffs:1,xpad:.955078,sc:.625,w:8,h:19},{c:458,x0:189,y0:743,yoffs:3,xpad:1.00781,sc:.625,w:17,h:14},{c:459,x0:807,y0:291,yoffs:2,xpad:1.18066,sc:.625,w:14,h:18},{c:460,x0:832,y0:290,yoffs:2,xpad:.369141,sc:.625,w:13,h:18},{c:461,x0:856,y0:290,yoffs:-1,xpad:.287109,sc:.625,w:9,h:18},{c:462,x0:499,y0:605,yoffs:2,xpad:1.0127,sc:.625,w:7,h:15},{c:463,x0:876,y0:289,yoffs:-1,sc:.625,w:5,h:18},{c:464,x0:517,y0:605,yoffs:2,sc:.625,w:5,h:15},{c:465,x0:892,y0:289,yoffs:-1,xpad:.171875,sc:.625,w:11,h:18},{c:466,x0:533,y0:605,yoffs:2,xpad:.549805,sc:.625,w:8,h:15},{c:467,x0:914,y0:289,yoffs:-1,xpad:1.13672,sc:.625,w:9,h:18},{c:468,x0:552,y0:605,yoffs:2,xpad:.862305,sc:.625,w:8,h:15},{c:469,x0:919,y0:200,yoffs:-2,xpad:1.13672,sc:.625,w:9,h:19},{c:470,x0:146,y0:533,yoffs:1,xpad:.862305,sc:.625,w:8,h:16},{c:471,x0:939,y0:200,yoffs:-2,xpad:1.13672,sc:.625,w:9,h:19},{c:472,x0:934,y0:289,yoffs:-1,xpad:.862305,sc:.625,w:8,h:18},{c:473,x0:959,y0:199,yoffs:-2,xpad:1.13672,sc:.625,w:9,h:19},{c:474,x0:949,y0:376,xpad:.862305,sc:.625,w:8,h:17},{c:475,x0:979,y0:199,yoffs:-2,xpad:1.13672,sc:.625,w:9,h:19},{c:476,x0:953,y0:289,yoffs:-1,xpad:.862305,sc:.625,w:8,h:18},{c:477,x0:508,y0:888,yoffs:6,xpad:.0517578,sc:.625,w:8,h:11},{c:478,x0:999,y0:199,yoffs:-2,xpad:.287109,sc:.625,w:9,h:19},{c:479,x0:165,y0:533,yoffs:1,xpad:1.0127,sc:.625,w:7,h:16},{c:480,x0:5,y0:245,yoffs:-2,xpad:.287109,sc:.625,w:9,h:19},{c:481,x0:183,y0:533,yoffs:1,xpad:1.0127,sc:.625,w:7,h:16},{c:482,x0:968,y0:376,xpad:.461914,sc:.625,w:13,h:17},{c:483,x0:217,y0:743,yoffs:3,xpad:.241211,sc:.625,w:12,h:14},{c:484,x0:240,y0:743,yoffs:3,sc:.625,w:10,h:14},{c:485,x0:261,y0:743,yoffs:6,sc:.625,w:9,h:14},{c:486,x0:972,y0:289,yoffs:-1,xpad:.692383,sc:.625,w:9,h:18},{c:487,x0:992,y0:288,yoffs:2,xpad:.623047,sc:.625,w:8,h:18},{c:488,x0:5,y0:334,yoffs:-1,sc:.625,w:10,h:18},{c:489,x0:25,y0:245,yoffs:-2,sc:.625,w:8,h:19},{c:490,x0:992,y0:376,yoffs:3,xpad:.171875,sc:.625,w:11,h:17},{c:491,x0:281,y0:743,yoffs:6,xpad:.549805,sc:.625,w:8,h:14},{c:492,x0:5,y0:214,xpad:.171875,sc:.625,w:11,h:20},{c:493,x0:5,y0:421,yoffs:3,xpad:.549805,sc:.625,w:8,h:17},{c:494,x0:26,y0:334,yoffs:-1,xpad:.441406,sc:.625,w:7,h:18},{c:495,x0:44,y0:334,yoffs:2,sc:.625,w:7,h:18},{c:496,x0:62,y0:334,yoffs:2,sc:.625,w:6,h:18},{c:497,x0:300,y0:742,yoffs:3,xpad:.466797,sc:.625,w:18,h:14},{c:498,x0:329,y0:742,yoffs:3,xpad:.250977,sc:.625,w:17,h:14},{c:499,x0:201,y0:532,yoffs:1,xpad:.234375,sc:.625,w:15,h:16},{c:500,x0:44,y0:245,yoffs:-2,xpad:.692383,sc:.625,w:9,h:19},{c:501,x0:64,y0:245,yoffs:1,xpad:.623047,sc:.625,w:8,h:19},{c:502,x0:357,y0:739,yoffs:3,xpad:.566406,sc:.625,w:15,h:14},{c:503,x0:24,y0:421,yoffs:3,xpad:.619141,sc:.625,w:9,h:17},{c:504,x0:83,y0:245,yoffs:-2,xpad:.727539,sc:.625,w:10,h:19},{c:505,x0:227,y0:532,yoffs:1,xpad:.901367,sc:.625,w:8,h:16},{c:506,x0:104,y0:245,yoffs:-2,xpad:.287109,sc:.625,w:9,h:19},{c:507,x0:79,y0:334,yoffs:-1,xpad:1.0127,sc:.625,w:7,h:18},{c:508,x0:124,y0:244,yoffs:-2,xpad:.461914,sc:.625,w:13,h:19},{c:509,x0:246,y0:532,yoffs:1,xpad:.241211,sc:.625,w:12,h:16},{c:510,x0:97,y0:334,yoffs:-1,xpad:.171875,sc:.625,w:11,h:18},{c:511,x0:269,y0:532,yoffs:1,xpad:.549805,sc:.625,w:8,h:16},{c:512,x0:148,y0:244,yoffs:-2,xpad:.287109,sc:.625,w:9,h:19},{c:513,x0:288,y0:529,yoffs:1,xpad:1.0127,sc:.625,w:7,h:16},{c:514,x0:119,y0:334,yoffs:-1,xpad:.287109,sc:.625,w:9,h:18},{c:515,x0:571,y0:604,yoffs:2,xpad:1.0127,sc:.625,w:7,h:15},{c:516,x0:168,y0:241,yoffs:-2,xpad:.417969,sc:.625,w:8,h:19},{c:517,x0:306,y0:529,yoffs:1,xpad:.0517578,sc:.625,w:8,h:16},{c:518,x0:139,y0:334,yoffs:-1,xpad:.417969,sc:.625,w:8,h:18},{c:519,x0:589,y0:603,yoffs:2,xpad:.0517578,sc:.625,w:8,h:15},{c:520,x0:187,y0:240,yoffs:-2,sc:.625,w:7,h:19},{c:521,x0:325,y0:529,yoffs:1,sc:.625,w:7,h:16},{c:522,x0:158,y0:333,yoffs:-1,sc:.625,w:5,h:18},{c:523,x0:608,y0:603,yoffs:2,sc:.625,w:5,h:15},{c:524,x0:205,y0:240,yoffs:-2,xpad:.171875,sc:.625,w:11,h:19},{c:525,x0:343,y0:528,yoffs:1,xpad:.549805,sc:.625,w:8,h:16},{c:526,x0:174,y0:333,yoffs:-1,xpad:.171875,sc:.625,w:11,h:18},{c:527,x0:624,y0:602,yoffs:2,xpad:.549805,sc:.625,w:8,h:15},{c:528,x0:227,y0:240,yoffs:-2,xpad:.492188,sc:.625,w:9,h:19},{c:529,x0:362,y0:528,yoffs:1,xpad:.0546875,sc:.625,w:6,h:16},{c:530,x0:196,y0:333,yoffs:-1,xpad:.492188,sc:.625,w:9,h:18},{c:531,x0:643,y0:602,yoffs:2,xpad:.0546875,sc:.625,w:6,h:15},{c:532,x0:247,y0:240,yoffs:-2,xpad:1.13672,sc:.625,w:9,h:19},{c:533,x0:379,y0:528,yoffs:1,xpad:.862305,sc:.625,w:8,h:16},{c:534,x0:216,y0:330,yoffs:-1,xpad:1.13672,sc:.625,w:9,h:18},{c:535,x0:660,y0:602,yoffs:2,xpad:.862305,sc:.625,w:8,h:15},{c:536,x0:44,y0:421,yoffs:3,xpad:.387695,sc:.625,w:7,h:17},{c:537,x0:383,y0:739,yoffs:6,xpad:.293945,sc:.625,w:6,h:14},{c:538,x0:62,y0:421,yoffs:3,sc:.625,w:8,h:17},{c:539,x0:81,y0:421,yoffs:3,sc:.625,w:6,h:17},{c:540,x0:98,y0:421,yoffs:3,xpad:.734375,sc:.625,w:7,h:17},{c:541,x0:400,y0:739,yoffs:6,xpad:.518555,sc:.625,w:6,h:14},{c:542,x0:236,y0:329,yoffs:-1,xpad:.634766,sc:.625,w:10,h:18},{c:543,x0:267,y0:240,yoffs:-2,xpad:.901367,sc:.625,w:8,h:19},{c:544,x0:116,y0:421,yoffs:3,xpad:1.20996,sc:.625,w:9,h:17},{c:545,x0:286,y0:240,yoffs:1,sc:.625,w:11,h:19},{c:546,x0:417,y0:739,yoffs:3,xpad:.858398,sc:.625,w:9,h:14},{c:547,x0:398,y0:526,yoffs:1,xpad:.769531,sc:.625,w:8,h:16},{c:548,x0:136,y0:421,yoffs:3,sc:.625,w:8,h:17},{c:549,x0:437,y0:738,yoffs:6,sc:.625,w:7,h:14},{c:550,x0:257,y0:329,yoffs:-1,xpad:.287109,sc:.625,w:9,h:18},{c:551,x0:679,y0:602,yoffs:2,xpad:1.0127,sc:.625,w:7,h:15},{c:552,x0:155,y0:421,yoffs:3,xpad:.417969,sc:.625,w:8,h:17},{c:553,x0:455,y0:738,yoffs:6,xpad:.0517578,sc:.625,w:8,h:14},{c:554,x0:308,y0:238,yoffs:-2,xpad:.171875,sc:.625,w:11,h:19},{c:555,x0:417,y0:526,yoffs:1,xpad:.549805,sc:.625,w:8,h:16},{c:556,x0:330,y0:236,yoffs:-2,xpad:.171875,sc:.625,w:11,h:19},{c:557,x0:436,y0:524,yoffs:1,xpad:.549805,sc:.625,w:8,h:16},{c:558,x0:277,y0:329,yoffs:-1,xpad:.171875,sc:.625,w:11,h:18},{c:559,x0:697,y0:602,yoffs:2,xpad:.549805,sc:.625,w:8,h:15},{c:560,x0:352,y0:236,yoffs:-2,xpad:.171875,sc:.625,w:11,h:19},{c:561,x0:455,y0:524,yoffs:1,xpad:.549805,sc:.625,w:8,h:16},{c:562,x0:174,y0:420,sc:.625,w:9,h:17},{c:563,x0:194,y0:420,yoffs:3,sc:.625,w:8,h:17},{c:564,x0:374,y0:236,yoffs:1,sc:.625,w:8,h:19},{c:565,x0:474,y0:738,yoffs:6,sc:.625,w:11,h:14},{c:566,x0:213,y0:420,yoffs:3,sc:.625,w:8,h:17},{c:567,x0:496,y0:736,yoffs:6,xpad:.0927734,sc:.625,w:5,h:14},{c:568,x0:474,y0:524,yoffs:1,xpad:.744141,sc:.625,w:12,h:16},{c:569,x0:512,y0:736,yoffs:6,xpad:.744141,sc:.625,w:12,h:14},{c:570,x0:299,y0:329,yoffs:1,xpad:.287109,sc:.625,w:9,h:18},{c:571,x0:232,y0:420,yoffs:1,sc:.625,w:9,h:17},{c:572,x0:535,y0:736,yoffs:4,sc:.625,w:7,h:14},{c:573,x0:553,y0:734,yoffs:3,sc:.625,w:8,h:14},{c:574,x0:716,y0:602,yoffs:2,sc:.625,w:9,h:15},{c:575,x0:572,y0:734,yoffs:6,xpad:.293945,sc:.625,w:6,h:14},{c:576,x0:589,y0:734,yoffs:6,sc:.625,w:7,h:14},{c:577,x0:607,y0:734,yoffs:3,xpad:.0556641,sc:.625,w:7,h:14},{c:578,x0:527,y0:887,yoffs:6,sc:.625,w:6,h:11},{c:579,x0:625,y0:733,yoffs:3,xpad:.638672,sc:.625,w:9,h:14},{c:580,x0:645,y0:732,yoffs:3,xpad:.136719,sc:.625,w:10,h:14},{c:581,x0:666,y0:732,yoffs:3,xpad:.179688,sc:.625,w:9,h:14},{c:582,x0:252,y0:417,yoffs:2,sc:.625,w:9,h:17},{c:583,x0:686,y0:731,yoffs:4,xpad:.0517578,sc:.625,w:8,h:14},{c:584,x0:705,y0:731,yoffs:3,sc:.625,w:8,h:14},{c:585,x0:319,y0:329,yoffs:2,sc:.625,w:6,h:18},{c:586,x0:272,y0:417,yoffs:3,sc:.625,w:13,h:17},{c:587,x0:724,y0:731,yoffs:6,sc:.625,w:10,h:14},{c:588,x0:745,y0:731,yoffs:3,xpad:.604492,sc:.625,w:9,h:14},{c:589,x0:544,y0:887,yoffs:6,xpad:.0546875,sc:.625,w:6,h:11},{c:590,x0:765,y0:731,yoffs:3,sc:.625,w:9,h:14},{c:591,x0:785,y0:729,yoffs:6,sc:.625,w:8,h:14},{c:592,x0:561,y0:885,yoffs:6,sc:.625,w:11,h:11},{c:593,x0:583,y0:885,yoffs:6,xpad:1.1377,sc:.625,w:10,h:11},{c:594,x0:604,y0:885,yoffs:6,xpad:.347656,sc:.625,w:11,h:11},{c:595,x0:736,y0:600,yoffs:2,xpad:.347656,sc:.625,w:11,h:15},{c:596,x0:626,y0:883,yoffs:6,xpad:.213867,sc:.625,w:9,h:11},{c:597,x0:5,y0:892,yoffs:6,sc:.625,w:10,h:12},{c:598,x0:393,y0:236,yoffs:2,sc:.625,w:12,h:19},{c:599,x0:758,y0:600,yoffs:2,sc:.625,w:12,h:15},{c:600,x0:646,y0:883,yoffs:6,xpad:.59082,sc:.625,w:10,h:11},{c:601,x0:667,y0:883,yoffs:6,xpad:.59082,sc:.625,w:10,h:11},{c:602,x0:688,y0:883,yoffs:6,sc:.625,w:16,h:11},{c:603,x0:715,y0:881,yoffs:6,sc:.625,w:10,h:11},{c:604,x0:736,y0:881,yoffs:6,sc:.625,w:10,h:11},{c:605,x0:757,y0:880,yoffs:6,sc:.625,w:15,h:11},{c:606,x0:783,y0:880,yoffs:6,xpad:.274414,sc:.625,w:11,h:11},{c:607,x0:781,y0:600,yoffs:6,sc:.625,w:8,h:15},{c:608,x0:416,y0:236,yoffs:2,sc:.625,w:12,h:19},{c:609,x0:800,y0:600,yoffs:6,xpad:1.30859,sc:.625,w:10,h:15},{c:610,x0:805,y0:880,yoffs:6,xpad:.737305,sc:.625,w:10,h:11},{c:611,x0:821,y0:599,yoffs:6,sc:.625,w:11,h:15},{c:612,x0:826,y0:878,yoffs:6,sc:.625,w:11,h:11},{c:613,x0:843,y0:599,yoffs:6,xpad:.777344,sc:.625,w:11,h:15},{c:614,x0:865,y0:598,yoffs:2,xpad:.777344,sc:.625,w:11,h:15},{c:615,x0:439,y0:235,yoffs:2,xpad:.777344,sc:.625,w:11,h:19},{c:616,x0:887,y0:598,yoffs:2,sc:.625,w:6,h:15},{c:617,x0:848,y0:878,yoffs:6,xpad:.294922,sc:.625,w:7,h:11},{c:618,x0:866,y0:878,yoffs:6,sc:.625,w:7,h:11},{c:619,x0:904,y0:598,yoffs:2,sc:.625,w:8,h:15},{c:620,x0:923,y0:598,yoffs:2,sc:.625,w:9,h:15},{c:621,x0:461,y0:235,yoffs:2,sc:.625,w:7,h:19},{c:622,x0:479,y0:235,yoffs:2,xpad:.623047,sc:.625,w:13,h:19},{c:623,x0:884,y0:878,yoffs:6,xpad:.602539,sc:.625,w:17,h:11},{c:624,x0:943,y0:597,yoffs:6,xpad:.602539,sc:.625,w:17,h:15},{c:625,x0:971,y0:597,yoffs:6,xpad:.602539,sc:.625,w:17,h:15},{c:626,x0:999,y0:597,yoffs:6,xpad:.314453,sc:.625,w:12,h:15},{c:627,x0:5,y0:640,yoffs:6,sc:.625,w:13,h:15},{c:628,x0:912,y0:878,yoffs:6,xpad:.905273,sc:.625,w:12,h:11},{c:629,x0:935,y0:878,yoffs:6,xpad:.09375,sc:.625,w:11,h:11},{c:630,x0:957,y0:877,yoffs:6,xpad:.629883,sc:.625,w:15,h:11},{c:631,x0:983,y0:875,yoffs:6,sc:.625,w:15,h:11},{c:632,x0:503,y0:235,yoffs:2,xpad:.589844,sc:.625,w:14,h:19},{c:633,x0:1009,y0:875,yoffs:6,xpad:1.13477,sc:.625,w:7,h:11},{c:634,x0:29,y0:640,yoffs:2,xpad:1.13477,sc:.625,w:7,h:15},{c:635,x0:47,y0:640,yoffs:6,sc:.625,w:9,h:15},{c:636,x0:67,y0:640,yoffs:6,xpad:.134766,sc:.625,w:8,h:15},{c:637,x0:86,y0:640,yoffs:6,xpad:.134766,sc:.625,w:8,h:15},{c:638,x0:5,y0:915,yoffs:6,xpad:.133789,sc:.625,w:7,h:11},{c:639,x0:105,y0:640,yoffs:6,xpad:1.13379,sc:.625,w:6,h:15},{c:640,x0:23,y0:915,yoffs:6,sc:.625,w:11,h:11},{c:641,x0:45,y0:915,yoffs:6,sc:.625,w:11,h:11},{c:642,x0:122,y0:640,yoffs:6,sc:.625,w:9,h:15},{c:643,x0:528,y0:235,yoffs:2,sc:.625,w:8,h:19},{c:644,x0:547,y0:235,yoffs:2,sc:.625,w:8,h:19},{c:645,x0:142,y0:640,yoffs:6,sc:.625,w:8,h:15},{c:646,x0:566,y0:235,yoffs:2,sc:.625,w:9,h:19},{c:647,x0:26,y0:868,yoffs:6,sc:.625,w:8,h:13},{c:648,x0:296,y0:416,yoffs:4,sc:.625,w:8,h:17},{c:649,x0:67,y0:915,yoffs:6,sc:.625,w:12,h:11},{c:650,x0:90,y0:915,yoffs:6,sc:.625,w:12,h:11},{c:651,x0:113,y0:915,yoffs:6,xpad:1.00684,sc:.625,w:11,h:11},{c:652,x0:135,y0:915,yoffs:6,sc:.625,w:11,h:11},{c:653,x0:157,y0:915,yoffs:6,sc:.625,w:16,h:11},{c:654,x0:161,y0:640,yoffs:2,sc:.625,w:11,h:15},{c:655,x0:184,y0:915,yoffs:6,sc:.625,w:11,h:11},{c:656,x0:183,y0:640,yoffs:6,sc:.625,w:10,h:15},{c:657,x0:26,y0:892,yoffs:6,sc:.625,w:11,h:12},{c:658,x0:804,y0:729,yoffs:6,sc:.625,w:7,h:14},{c:659,x0:204,y0:640,yoffs:6,xpad:.415039,sc:.625,w:10,h:15},{c:660,x0:225,y0:640,yoffs:2,sc:.625,w:9,h:15},{c:661,x0:245,y0:639,yoffs:2,sc:.625,w:9,h:15},{c:662,x0:265,y0:639,yoffs:2,sc:.625,w:9,h:15},{c:663,x0:285,y0:639,yoffs:6,xpad:.213867,sc:.625,w:9,h:15},{c:664,x0:822,y0:729,yoffs:3,xpad:.267578,sc:.625,w:14,h:14},{c:665,x0:206,y0:915,yoffs:6,xpad:.274414,sc:.625,w:11,h:11},{c:666,x0:228,y0:915,yoffs:6,xpad:.274414,sc:.625,w:11,h:11},{c:667,x0:305,y0:636,yoffs:2,sc:.625,w:12,h:15},{c:668,x0:250,y0:915,yoffs:6,xpad:.865234,sc:.625,w:11,h:11},{c:669,x0:586,y0:234,yoffs:2,sc:.625,w:8,h:19},{c:670,x0:328,y0:636,yoffs:6,xpad:1.11328,sc:.625,w:10,h:15},{c:671,x0:272,y0:915,yoffs:6,sc:.625,w:9,h:11},{c:672,x0:605,y0:233,yoffs:2,sc:.625,w:12,h:19},{c:673,x0:349,y0:636,yoffs:2,sc:.625,w:9,h:15},{c:674,x0:369,y0:636,yoffs:2,sc:.625,w:9,h:15},{c:675,x0:389,y0:635,yoffs:2,xpad:.0322266,sc:.625,w:18,h:15},{c:676,x0:628,y0:233,yoffs:2,xpad:.125977,sc:.625,w:19,h:19},{c:677,x0:497,y0:524,yoffs:2,sc:.625,w:20,h:16},{c:678,x0:45,y0:868,yoffs:4,xpad:.624023,sc:.625,w:14,h:13},{c:679,x0:658,y0:233,yoffs:2,sc:.625,w:12,h:19},{c:680,x0:70,y0:868,yoffs:4,xpad:.489258,sc:.625,w:16,h:13},{c:681,x0:681,y0:232,yoffs:2,xpad:1.24121,sc:.625,w:16,h:19},{c:682,x0:418,y0:635,yoffs:2,sc:.625,w:13,h:15},{c:683,x0:442,y0:633,yoffs:2,xpad:.15332,sc:.625,w:12,h:15},{c:684,x0:847,y0:729,yoffs:3,sc:.625,w:10,h:14},{c:685,x0:868,y0:728,yoffs:3,xpad:.859375,sc:.625,w:10,h:14},{c:686,x0:465,y0:633,yoffs:6,xpad:.133789,sc:.625,w:12,h:15},{c:687,x0:488,y0:631,yoffs:6,sc:.625,w:14,h:15},{c:785,x0:757,y0:1e3,yoffs:2,sc:.625,w:6,h:3},{c:802,x0:595,y0:975,yoffs:15,sc:.625,w:4,h:6},{c:856,x0:635,y0:990,yoffs:2,sc:.625,w:5,h:4},{c:880,x0:889,y0:728,yoffs:3,xpad:.671875,sc:.625,w:8,h:14},{c:881,x0:292,y0:915,yoffs:6,sc:.625,w:8,h:11},{c:882,x0:908,y0:728,yoffs:3,sc:.625,w:13,h:14},{c:883,x0:513,y0:631,yoffs:2,sc:.625,w:11,h:15},{c:884,x0:651,y0:990,yoffs:3,sc:.625,w:5,h:4},{c:885,x0:667,y0:990,yoffs:17,sc:.625,w:5,h:4},{c:886,x0:932,y0:727,yoffs:3,xpad:.750977,sc:.625,w:14,h:14},{c:887,x0:311,y0:915,yoffs:6,xpad:.905273,sc:.625,w:12,h:11},{c:890,x0:683,y0:988,yoffs:17,xpad:2.3418,sc:.625,w:8,h:4},{c:891,x0:626,y0:883,yoffs:6,xpad:.213867,sc:.625,w:9,h:11},{c:892,x0:334,y0:915,yoffs:6,xpad:.213867,sc:.625,w:9,h:11},{c:893,x0:354,y0:914,yoffs:6,xpad:.213867,sc:.625,w:9,h:11},{c:894,x0:97,y0:868,yoffs:6,xpad:.195313,sc:.625,w:5,h:13},{c:895,x0:315,y0:416,yoffs:3,xpad:.260742,sc:.625,w:7,h:17},{c:900,x0:21,y0:1001,yoffs:1,sc:.625,w:6,h:5},{c:901,x0:38,y0:1001,yoffs:1,sc:.625,w:8,h:5},{c:902,x0:957,y0:727,yoffs:3,xpad:.287109,sc:.625,w:9,h:14},{c:903,x0:702,y0:988,yoffs:6,xpad:.107422,sc:.625,w:5,h:4},{c:904,x0:977,y0:725,yoffs:3,xpad:.0634766,sc:.625,w:10,h:14},{c:905,x0:998,y0:725,yoffs:3,xpad:.280273,sc:.625,w:12,h:14},{c:906,x0:5,y0:768,yoffs:3,xpad:.40625,sc:.625,w:6,h:14},{c:908,x0:22,y0:768,yoffs:3,xpad:.22168,sc:.625,w:12,h:14},{c:910,x0:45,y0:768,yoffs:3,sc:.625,w:12,h:14},{c:911,x0:68,y0:768,yoffs:3,xpad:.314453,sc:.625,w:12,h:14},{c:912,x0:528,y0:523,yoffs:1,sc:.625,w:8,h:16},{c:913,x0:91,y0:768,yoffs:3,xpad:.287109,sc:.625,w:9,h:14},{c:914,x0:111,y0:768,yoffs:3,xpad:.619141,sc:.625,w:9,h:14},{c:915,x0:131,y0:768,yoffs:3,sc:.625,w:8,h:14},{c:916,x0:150,y0:768,yoffs:3,sc:.625,w:10,h:14},{c:917,x0:171,y0:768,yoffs:3,xpad:.417969,sc:.625,w:8,h:14},{c:918,x0:190,y0:768,yoffs:3,sc:.625,w:8,h:14},{c:919,x0:209,y0:768,yoffs:3,xpad:.634766,sc:.625,w:10,h:14},{c:920,x0:230,y0:768,yoffs:3,xpad:.171875,sc:.625,w:11,h:14},{c:921,x0:252,y0:768,yoffs:3,xpad:.760742,sc:.625,w:4,h:14},{c:922,x0:267,y0:768,yoffs:3,sc:.625,w:10,h:14},{c:923,x0:666,y0:732,yoffs:3,xpad:.179688,sc:.625,w:9,h:14},{c:924,x0:288,y0:768,yoffs:3,xpad:.408203,sc:.625,w:13,h:14},{c:925,x0:312,y0:767,yoffs:3,xpad:.727539,sc:.625,w:10,h:14},{c:926,x0:333,y0:767,yoffs:3,xpad:.310547,sc:.625,w:8,h:14},{c:927,x0:352,y0:767,yoffs:3,xpad:.171875,sc:.625,w:11,h:14},{c:928,x0:374,y0:764,yoffs:3,xpad:1.39551,sc:.625,w:9,h:14},{c:929,x0:394,y0:764,yoffs:3,sc:.625,w:9,h:14},{c:931,x0:883,y0:703,yoffs:3,sc:.625,w:8,h:14},{c:932,x0:414,y0:764,yoffs:3,sc:.625,w:8,h:14},{c:933,x0:433,y0:764,yoffs:3,sc:.625,w:9,h:14},{c:934,x0:535,y0:631,yoffs:2,xpad:.0751953,sc:.625,w:12,h:15},{c:935,x0:453,y0:763,yoffs:3,sc:.625,w:9,h:14},{c:936,x0:473,y0:763,yoffs:3,xpad:.430664,sc:.625,w:11,h:14},{c:937,x0:495,y0:763,yoffs:3,xpad:.28418,sc:.625,w:11,h:14},{c:938,x0:336,y0:329,yoffs:-1,sc:.625,w:7,h:18},{c:939,x0:354,y0:327,yoffs:-1,sc:.625,w:9,h:18},{c:940,x0:547,y0:522,yoffs:1,sc:.625,w:9,h:16},{c:941,x0:567,y0:522,yoffs:1,xpad:.128906,sc:.625,w:7,h:16},{c:942,x0:708,y0:232,yoffs:1,xpad:.901367,sc:.625,w:8,h:19},{c:943,x0:585,y0:521,yoffs:1,sc:.625,w:5,h:16},{c:944,x0:601,y0:521,yoffs:1,xpad:.955078,sc:.625,w:8,h:16},{c:945,x0:374,y0:914,yoffs:6,sc:.625,w:9,h:11},{c:946,x0:727,y0:231,yoffs:1,xpad:.140625,sc:.625,w:9,h:19},{c:947,x0:517,y0:761,yoffs:6,xpad:.402344,sc:.625,w:7,h:14},{c:948,x0:620,y0:521,yoffs:1,xpad:.603516,sc:.625,w:8,h:16},{c:949,x0:394,y0:913,yoffs:6,xpad:.128906,sc:.625,w:7,h:11},{c:950,x0:374,y0:325,yoffs:2,xpad:.0166016,sc:.625,w:7,h:18},{c:951,x0:535,y0:761,yoffs:6,xpad:.901367,sc:.625,w:8,h:14},{c:952,x0:639,y0:521,yoffs:1,xpad:.0869141,sc:.625,w:9,h:16},{c:953,x0:412,y0:910,yoffs:6,sc:.625,w:5,h:11},{c:954,x0:413,y0:888,yoffs:6,sc:.625,w:8,h:11},{c:955,x0:659,y0:521,yoffs:1,sc:.625,w:8,h:16},{c:956,x0:1005,y0:675,yoffs:6,xpad:1.00879,sc:.625,w:8,h:14},{c:957,x0:428,y0:910,yoffs:6,sc:.625,w:8,h:11},{c:958,x0:747,y0:231,yoffs:1,xpad:.0166016,sc:.625,w:7,h:19},{c:959,x0:447,y0:910,yoffs:6,xpad:.549805,sc:.625,w:8,h:11},{c:960,x0:466,y0:910,yoffs:6,xpad:.842773,sc:.625,w:8,h:11},{c:961,x0:554,y0:759,yoffs:6,xpad:.662109,sc:.625,w:8,h:14},{c:962,x0:573,y0:759,yoffs:6,sc:.625,w:7,h:14},{c:963,x0:485,y0:910,yoffs:6,sc:.625,w:9,h:11},{c:964,x0:505,y0:910,yoffs:6,xpad:.352539,sc:.625,w:6,h:11},{c:965,x0:522,y0:910,yoffs:6,xpad:.955078,sc:.625,w:8,h:11},{c:966,x0:591,y0:759,yoffs:6,xpad:.0986328,sc:.625,w:11,h:14},{c:967,x0:541,y0:909,yoffs:6,xpad:.236328,sc:.625,w:7,h:11},{c:968,x0:613,y0:759,yoffs:6,xpad:.411133,sc:.625,w:11,h:14},{c:969,x0:559,y0:909,yoffs:6,xpad:.982422,sc:.625,w:11,h:11},{c:970,x0:558,y0:631,yoffs:2,sc:.625,w:6,h:15},{c:971,x0:575,y0:630,yoffs:2,xpad:.955078,sc:.625,w:8,h:15},{c:972,x0:678,y0:521,yoffs:1,xpad:.549805,sc:.625,w:8,h:16},{c:973,x0:697,y0:519,yoffs:1,xpad:.955078,sc:.625,w:8,h:16},{c:974,x0:716,y0:519,yoffs:1,xpad:.982422,sc:.625,w:11,h:16},{c:975,x0:392,y0:325,yoffs:3,sc:.625,w:12,h:18},{c:976,x0:594,y0:629,yoffs:2,xpad:.147461,sc:.625,w:11,h:15},{c:977,x0:616,y0:629,yoffs:2,xpad:.120117,sc:.625,w:13,h:15},{c:978,x0:635,y0:758,yoffs:3,sc:.625,w:12,h:14},{c:979,x0:640,y0:628,yoffs:2,sc:.625,w:16,h:15},{c:980,x0:415,y0:325,yoffs:-1,sc:.625,w:12,h:18},{c:981,x0:503,y0:235,yoffs:2,xpad:.589844,sc:.625,w:14,h:19},{c:982,x0:581,y0:907,yoffs:6,sc:.625,w:18,h:11},{c:983,x0:667,y0:628,yoffs:6,sc:.625,w:13,h:15},{c:984,x0:658,y0:757,yoffs:3,xpad:.267578,sc:.625,w:14,h:14},{c:985,x0:691,y0:628,yoffs:6,xpad:.09375,sc:.625,w:11,h:15},{c:986,x0:683,y0:757,yoffs:3,xpad:.416016,sc:.625,w:11,h:14},{c:987,x0:705,y0:756,yoffs:6,sc:.625,w:10,h:14},{c:988,x0:726,y0:756,yoffs:3,sc:.625,w:10,h:14},{c:989,x0:713,y0:628,yoffs:6,xpad:.301758,sc:.625,w:9,h:15},{c:990,x0:747,y0:756,yoffs:3,sc:.625,w:10,h:14},{c:991,x0:765,y0:231,yoffs:2,sc:.625,w:10,h:19},{c:992,x0:768,y0:756,yoffs:3,xpad:976563e-9,sc:.625,w:11,h:14},{c:993,x0:786,y0:231,yoffs:2,sc:.625,w:11,h:19},{c:1008,x0:610,y0:907,yoffs:6,sc:.625,w:13,h:11},{c:1009,x0:733,y0:628,yoffs:6,xpad:.09375,sc:.625,w:11,h:15},{c:1010,x0:634,y0:905,yoffs:6,xpad:.213867,sc:.625,w:9,h:11},{c:1011,x0:808,y0:230,yoffs:2,sc:.625,w:7,h:19},{c:1012,x0:790,y0:754,yoffs:3,xpad:.267578,sc:.625,w:14,h:14},{c:1013,x0:654,y0:905,yoffs:6,xpad:.389648,sc:.625,w:9,h:11},{c:1014,x0:674,y0:905,yoffs:6,xpad:.174805,sc:.625,w:9,h:11},{c:1015,x0:815,y0:754,yoffs:3,xpad:.254883,sc:.625,w:11,h:14},{c:1016,x0:826,y0:230,yoffs:2,xpad:.347656,sc:.625,w:11,h:19},{c:1017,x0:837,y0:754,yoffs:3,xpad:.416016,sc:.625,w:11,h:14},{c:1018,x0:859,y0:754,yoffs:3,xpad:.904297,sc:.625,w:16,h:14},{c:1019,x0:755,y0:626,yoffs:6,xpad:.731445,sc:.625,w:14,h:15},{c:1020,x0:780,y0:626,yoffs:6,xpad:.0742188,sc:.625,w:11,h:15},{c:1021,x0:886,y0:753,yoffs:3,xpad:.416016,sc:.625,w:11,h:14},{c:1022,x0:908,y0:753,yoffs:3,xpad:.416016,sc:.625,w:11,h:14},{c:1023,x0:930,y0:753,yoffs:3,xpad:.416016,sc:.625,w:11,h:14},{c:1024,x0:438,y0:325,yoffs:-1,xpad:.417969,sc:.625,w:8,h:18},{c:1025,x0:457,y0:325,yoffs:-1,xpad:.417969,sc:.625,w:8,h:18},{c:1026,x0:952,y0:752,yoffs:3,sc:.625,w:11,h:14},{c:1027,x0:476,y0:324,yoffs:-1,sc:.625,w:8,h:18},{c:1028,x0:974,y0:752,yoffs:3,sc:.625,w:9,h:14},{c:1029,x0:994,y0:750,yoffs:3,xpad:.387695,sc:.625,w:7,h:14},{c:1030,x0:252,y0:768,yoffs:3,xpad:.760742,sc:.625,w:4,h:14},{c:1031,x0:495,y0:324,yoffs:-1,sc:.625,w:6,h:18},{c:1032,x0:1012,y0:750,yoffs:3,xpad:1.29492,sc:.625,w:6,h:14},{c:1033,x0:5,y0:793,yoffs:3,xpad:.0146484,sc:.625,w:15,h:14},{c:1034,x0:31,y0:793,yoffs:3,sc:.625,w:15,h:14},{c:1035,x0:57,y0:793,yoffs:3,xpad:.966797,sc:.625,w:10,h:14},{c:1036,x0:512,y0:324,yoffs:-1,sc:.625,w:10,h:18},{c:1037,x0:533,y0:324,yoffs:-1,xpad:.727539,sc:.625,w:10,h:18},{c:1038,x0:554,y0:324,yoffs:-1,sc:.625,w:9,h:18},{c:1039,x0:333,y0:416,yoffs:3,xpad:1.37598,sc:.625,w:9,h:17},{c:1040,x0:91,y0:768,yoffs:3,xpad:.287109,sc:.625,w:9,h:14},{c:1041,x0:500,y0:711,yoffs:3,xpad:.25293,sc:.625,w:9,h:14},{c:1042,x0:111,y0:768,yoffs:3,xpad:.619141,sc:.625,w:9,h:14},{c:1043,x0:131,y0:768,yoffs:3,sc:.625,w:8,h:14},{c:1044,x0:353,y0:416,yoffs:3,sc:.625,w:11,h:17},{c:1045,x0:171,y0:768,yoffs:3,xpad:.417969,sc:.625,w:8,h:14},{c:1046,x0:78,y0:793,yoffs:3,sc:.625,w:12,h:14},{c:1047,x0:101,y0:793,yoffs:3,sc:.625,w:8,h:14},{c:1048,x0:120,y0:793,yoffs:3,xpad:.727539,sc:.625,w:10,h:14},{c:1049,x0:574,y0:324,yoffs:-1,xpad:.727539,sc:.625,w:10,h:18},{c:1050,x0:267,y0:768,yoffs:3,sc:.625,w:10,h:14},{c:1051,x0:141,y0:793,yoffs:3,xpad:.693359,sc:.625,w:10,h:14},{c:1052,x0:288,y0:768,yoffs:3,xpad:.408203,sc:.625,w:13,h:14},{c:1053,x0:209,y0:768,yoffs:3,xpad:.634766,sc:.625,w:10,h:14},{c:1054,x0:352,y0:767,yoffs:3,xpad:.171875,sc:.625,w:11,h:14},{c:1055,x0:374,y0:764,yoffs:3,xpad:1.39551,sc:.625,w:9,h:14},{c:1056,x0:394,y0:764,yoffs:3,sc:.625,w:9,h:14},{c:1057,x0:162,y0:793,yoffs:3,sc:.625,w:9,h:14},{c:1058,x0:414,y0:764,yoffs:3,sc:.625,w:8,h:14},{c:1059,x0:182,y0:793,yoffs:3,sc:.625,w:9,h:14},{c:1060,x0:535,y0:631,yoffs:2,xpad:.0751953,sc:.625,w:12,h:15},{c:1061,x0:453,y0:763,yoffs:3,sc:.625,w:9,h:14},{c:1062,x0:375,y0:414,yoffs:3,sc:.625,w:11,h:17},{c:1063,x0:202,y0:793,yoffs:3,xpad:1.43359,sc:.625,w:8,h:14},{c:1064,x0:221,y0:793,yoffs:3,xpad:1.27734,sc:.625,w:13,h:14},{c:1065,x0:397,y0:412,yoffs:3,xpad:.49707,sc:.625,w:14,h:17},{c:1066,x0:245,y0:793,yoffs:3,xpad:.0634766,sc:.625,w:10,h:14},{c:1067,x0:266,y0:793,yoffs:3,xpad:.852539,sc:.625,w:13,h:14},{c:1068,x0:290,y0:793,yoffs:3,xpad:.0478516,sc:.625,w:9,h:14},{c:1069,x0:310,y0:793,yoffs:3,xpad:.828125,sc:.625,w:8,h:14},{c:1070,x0:329,y0:792,yoffs:3,xpad:.292969,sc:.625,w:15,h:14},{c:1071,x0:355,y0:792,yoffs:3,xpad:1.49219,sc:.625,w:8,h:14},{c:1072,x0:694,y0:905,yoffs:6,xpad:1.0127,sc:.625,w:7,h:11},{c:1073,x0:738,y0:519,yoffs:1,xpad:.71582,sc:.625,w:8,h:16},{c:1074,x0:712,y0:905,yoffs:6,xpad:.476563,sc:.625,w:8,h:11},{c:1075,x0:731,y0:903,yoffs:6,xpad:.113281,sc:.625,w:6,h:11},{c:1076,x0:113,y0:868,yoffs:6,sc:.625,w:9,h:13},{c:1077,x0:748,y0:903,yoffs:6,xpad:.0517578,sc:.625,w:8,h:11},{c:1078,x0:767,y0:902,yoffs:6,sc:.625,w:10,h:11},{c:1079,x0:788,y0:902,yoffs:6,sc:.625,w:7,h:11},{c:1080,x0:806,y0:902,yoffs:6,xpad:1.02832,sc:.625,w:8,h:11},{c:1081,x0:802,y0:626,yoffs:2,xpad:1.02832,sc:.625,w:8,h:15},{c:1082,x0:413,y0:888,yoffs:6,sc:.625,w:8,h:11},{c:1083,x0:825,y0:902,yoffs:6,xpad:1.17969,sc:.625,w:8,h:11},{c:1084,x0:844,y0:900,yoffs:6,xpad:1.26465,sc:.625,w:10,h:11},{c:1085,x0:865,y0:900,yoffs:6,xpad:1.12109,sc:.625,w:8,h:11},{c:1086,x0:447,y0:910,yoffs:6,xpad:.549805,sc:.625,w:8,h:11},{c:1087,x0:466,y0:910,yoffs:6,xpad:.842773,sc:.625,w:8,h:11},{c:1088,x0:374,y0:789,yoffs:6,xpad:.623047,sc:.625,w:8,h:14},{c:1089,x0:884,y0:900,yoffs:6,sc:.625,w:7,h:11},{c:1090,x0:902,y0:900,yoffs:6,sc:.625,w:7,h:11},{c:1091,x0:393,y0:789,yoffs:6,sc:.625,w:8,h:14},{c:1092,x0:848,y0:230,yoffs:1,sc:.625,w:11,h:19},{c:1093,x0:541,y0:909,yoffs:6,xpad:.236328,sc:.625,w:7,h:11},{c:1094,x0:133,y0:868,yoffs:6,sc:.625,w:9,h:13},{c:1095,x0:920,y0:900,yoffs:6,xpad:1.33008,sc:.625,w:7,h:11},{c:1096,x0:938,y0:900,yoffs:6,xpad:.705078,sc:.625,w:12,h:11},{c:1097,x0:153,y0:868,yoffs:6,sc:.625,w:13,h:13},{c:1098,x0:961,y0:899,yoffs:6,xpad:.4375,sc:.625,w:8,h:11},{c:1099,x0:980,y0:899,yoffs:6,xpad:1.41211,sc:.625,w:11,h:11},{c:1100,x0:1002,y0:897,yoffs:6,sc:.625,w:8,h:11},{c:1101,x0:5,y0:937,yoffs:6,xpad:.0556641,sc:.625,w:7,h:11},{c:1102,x0:23,y0:937,yoffs:6,xpad:.114258,sc:.625,w:12,h:11},{c:1103,x0:46,y0:937,yoffs:6,xpad:1.15918,sc:.625,w:7,h:11},{c:1104,x0:757,y0:518,yoffs:1,xpad:.0517578,sc:.625,w:8,h:16},{c:1105,x0:821,y0:625,yoffs:2,xpad:.0517578,sc:.625,w:8,h:15},{c:1106,x0:870,y0:230,yoffs:1,xpad:.696289,sc:.625,w:8,h:19},{c:1107,x0:776,y0:518,yoffs:1,xpad:.113281,sc:.625,w:6,h:16},{c:1108,x0:64,y0:937,yoffs:6,xpad:.0703125,sc:.625,w:7,h:11},{c:1109,x0:82,y0:937,yoffs:6,xpad:.293945,sc:.625,w:6,h:11},{c:1110,x0:840,y0:625,yoffs:2,xpad:.467773,sc:.625,w:4,h:15},{c:1111,x0:855,y0:625,yoffs:2,sc:.625,w:6,h:15},{c:1112,x0:595,y0:324,yoffs:2,xpad:.0927734,sc:.625,w:5,h:18},{c:1113,x0:99,y0:937,yoffs:6,sc:.625,w:13,h:11},{c:1114,x0:123,y0:937,yoffs:6,xpad:.5,sc:.625,w:12,h:11},{c:1115,x0:643,y0:494,yoffs:1,xpad:.901367,sc:.625,w:8,h:16},{c:1116,x0:793,y0:518,yoffs:1,sc:.625,w:8,h:16},{c:1117,x0:812,y0:517,yoffs:1,xpad:1.02832,sc:.625,w:8,h:16},{c:1118,x0:393,y0:789,yoffs:6,sc:.625,w:8,h:14},{c:1119,x0:177,y0:868,yoffs:6,xpad:.842773,sc:.625,w:8,h:13},{c:1120,x0:412,y0:789,yoffs:3,xpad:.0800781,sc:.625,w:17,h:14},{c:1121,x0:146,y0:937,yoffs:6,sc:.625,w:16,h:11},{c:1122,x0:872,y0:624,yoffs:2,xpad:.175781,sc:.625,w:10,h:15},{c:1123,x0:831,y0:517,yoffs:1,sc:.625,w:9,h:16},{c:1124,x0:440,y0:789,yoffs:3,xpad:.0263672,sc:.625,w:17,h:14},{c:1125,x0:173,y0:937,yoffs:6,xpad:.34082,sc:.625,w:14,h:11},{c:1126,x0:468,y0:788,yoffs:3,sc:.625,w:14,h:14},{c:1127,x0:198,y0:937,yoffs:6,sc:.625,w:12,h:11},{c:1128,x0:493,y0:788,yoffs:3,sc:.625,w:19,h:14},{c:1129,x0:221,y0:937,yoffs:6,sc:.625,w:17,h:11},{c:1130,x0:523,y0:786,yoffs:3,sc:.625,w:15,h:14},{c:1131,x0:249,y0:937,yoffs:6,xpad:.166992,sc:.625,w:11,h:11},{c:1132,x0:549,y0:786,yoffs:3,xpad:.233398,sc:.625,w:19,h:14},{c:1133,x0:271,y0:937,yoffs:6,sc:.625,w:16,h:11},{c:1134,x0:814,y0:168,xpad:.328125,sc:.625,w:11,h:21},{c:1135,x0:422,y0:412,yoffs:4,sc:.625,w:10,h:17},{c:1136,x0:579,y0:784,yoffs:3,xpad:.703125,sc:.625,w:15,h:14},{c:1137,x0:889,y0:230,yoffs:2,xpad:.00488281,sc:.625,w:15,h:19},{c:1138,x0:605,y0:784,yoffs:3,xpad:.171875,sc:.625,w:11,h:14},{c:1139,x0:298,y0:937,yoffs:6,xpad:.549805,sc:.625,w:8,h:11},{c:1140,x0:627,y0:784,yoffs:3,sc:.625,w:11,h:14},{c:1141,x0:317,y0:937,yoffs:6,sc:.625,w:9,h:11},{c:1142,x0:611,y0:324,yoffs:-1,sc:.625,w:13,h:18},{c:1143,x0:893,y0:624,yoffs:2,sc:.625,w:11,h:15},{c:1144,x0:635,y0:322,yoffs:3,sc:.625,w:24,h:18},{c:1145,x0:915,y0:624,yoffs:6,sc:.625,w:21,h:15},{c:1146,x0:851,y0:517,yoffs:2,xpad:.985352,sc:.625,w:14,h:16},{c:1147,x0:196,y0:868,yoffs:5,xpad:.167969,sc:.625,w:12,h:13},{c:1148,x0:27,y0:214,yoffs:-3,xpad:.501953,sc:.625,w:19,h:20},{c:1149,x0:670,y0:322,yoffs:-1,xpad:.172852,sc:.625,w:17,h:18},{c:1150,x0:443,y0:412,xpad:.0800781,sc:.625,w:17,h:17},{c:1151,x0:649,y0:783,yoffs:3,sc:.625,w:16,h:14},{c:1152,x0:698,y0:322,yoffs:3,xpad:.133789,sc:.625,w:12,h:18},{c:1153,x0:947,y0:623,yoffs:6,xpad:.389648,sc:.625,w:9,h:15},{c:1154,x0:219,y0:868,yoffs:4,sc:.625,w:11,h:13},{c:1160,x0:471,y0:412,yoffs:3,sc:.625,w:18,h:17},{c:1161,x0:500,y0:411,yoffs:3,xpad:.133789,sc:.625,w:17,h:17},{c:1162,x0:836,y0:168,yoffs:-1,sc:.625,w:11,h:21},{c:1163,x0:721,y0:321,yoffs:2,xpad:.0283203,sc:.625,w:9,h:18},{c:1164,x0:676,y0:782,yoffs:3,xpad:.101563,sc:.625,w:9,h:14},{c:1165,x0:337,y0:937,yoffs:6,sc:.625,w:8,h:11},{c:1166,x0:696,y0:782,yoffs:3,sc:.625,w:9,h:14},{c:1167,x0:716,y0:781,yoffs:6,xpad:.623047,sc:.625,w:8,h:14},{c:1168,x0:528,y0:410,sc:.625,w:8,h:17},{c:1169,x0:241,y0:868,yoffs:4,xpad:.206055,sc:.625,w:6,h:13},{c:1170,x0:735,y0:781,yoffs:3,sc:.625,w:8,h:14},{c:1171,x0:356,y0:936,yoffs:6,xpad:.147461,sc:.625,w:6,h:11},{c:1172,x0:547,y0:410,yoffs:3,xpad:.267578,sc:.625,w:9,h:17},{c:1173,x0:754,y0:781,yoffs:6,xpad:.144531,sc:.625,w:8,h:14},{c:1174,x0:567,y0:410,yoffs:3,xpad:.168945,sc:.625,w:13,h:17},{c:1175,x0:258,y0:868,yoffs:6,xpad:.0253906,sc:.625,w:11,h:13},{c:1176,x0:591,y0:410,yoffs:3,xpad:.53418,sc:.625,w:7,h:17},{c:1177,x0:773,y0:781,yoffs:6,sc:.625,w:7,h:14},{c:1178,x0:609,y0:410,yoffs:3,xpad:.136719,sc:.625,w:10,h:17},{c:1179,x0:280,y0:868,yoffs:6,sc:.625,w:9,h:13},{c:1180,x0:791,y0:779,yoffs:3,xpad:.268555,sc:.625,w:10,h:14},{c:1181,x0:373,y0:936,yoffs:6,sc:.625,w:9,h:11},{c:1182,x0:812,y0:779,yoffs:3,sc:.625,w:10,h:14},{c:1183,x0:48,y0:892,yoffs:5,sc:.625,w:8,h:12},{c:1184,x0:833,y0:779,yoffs:3,sc:.625,w:11,h:14},{c:1185,x0:393,y0:936,yoffs:6,sc:.625,w:9,h:11},{c:1186,x0:630,y0:410,yoffs:3,sc:.625,w:11,h:17},{c:1187,x0:300,y0:868,yoffs:6,sc:.625,w:9,h:13},{c:1188,x0:855,y0:779,yoffs:3,sc:.625,w:12,h:14},{c:1189,x0:413,y0:932,yoffs:6,sc:.625,w:10,h:11},{c:1190,x0:652,y0:410,yoffs:3,sc:.625,w:15,h:17},{c:1191,x0:878,y0:779,yoffs:6,xpad:.412109,sc:.625,w:12,h:14},{c:1192,x0:678,y0:408,yoffs:3,xpad:.411133,sc:.625,w:11,h:17},{c:1193,x0:320,y0:868,yoffs:6,sc:.625,w:9,h:13},{c:1194,x0:700,y0:408,yoffs:3,sc:.625,w:9,h:17},{c:1195,x0:901,y0:778,yoffs:6,sc:.625,w:7,h:14},{c:1196,x0:720,y0:408,yoffs:3,sc:.625,w:8,h:17},{c:1197,x0:340,y0:867,yoffs:6,sc:.625,w:7,h:13},{c:1198,x0:433,y0:764,yoffs:3,sc:.625,w:9,h:14},{c:1199,x0:919,y0:778,yoffs:6,xpad:.22168,sc:.625,w:7,h:14},{c:1200,x0:937,y0:778,yoffs:3,sc:.625,w:9,h:14},{c:1201,x0:957,y0:777,yoffs:6,sc:.625,w:8,h:14},{c:1202,x0:739,y0:407,yoffs:3,sc:.625,w:10,h:17},{c:1203,x0:358,y0:867,yoffs:6,sc:.625,w:8,h:13},{c:1204,x0:760,y0:407,yoffs:3,sc:.625,w:12,h:17},{c:1205,x0:377,y0:867,yoffs:6,sc:.625,w:10,h:13},{c:1206,x0:783,y0:406,yoffs:3,sc:.625,w:10,h:17},{c:1207,x0:398,y0:864,yoffs:6,sc:.625,w:9,h:13},{c:1208,x0:976,y0:777,yoffs:3,xpad:1.43359,sc:.625,w:8,h:14},{c:1209,x0:434,y0:932,yoffs:6,xpad:1.125,sc:.625,w:7,h:11},{c:1210,x0:995,y0:775,yoffs:3,xpad:.604492,sc:.625,w:9,h:14},{c:1211,x0:876,y0:517,yoffs:1,xpad:.901367,sc:.625,w:8,h:16},{c:1212,x0:5,y0:818,yoffs:3,xpad:.728516,sc:.625,w:11,h:14},{c:1213,x0:452,y0:932,yoffs:6,xpad:.658203,sc:.625,w:9,h:11},{c:1214,x0:804,y0:406,yoffs:3,xpad:.728516,sc:.625,w:11,h:17},{c:1215,x0:418,y0:864,yoffs:6,xpad:.658203,sc:.625,w:9,h:13},{c:1216,x0:252,y0:768,yoffs:3,xpad:.760742,sc:.625,w:4,h:14},{c:1217,x0:741,y0:321,yoffs:-1,sc:.625,w:12,h:18},{c:1218,x0:967,y0:623,yoffs:2,sc:.625,w:10,h:15},{c:1219,x0:826,y0:406,yoffs:3,xpad:.692383,sc:.625,w:9,h:17},{c:1220,x0:27,y0:818,yoffs:6,xpad:.271484,sc:.625,w:8,h:14},{c:1221,x0:846,y0:406,yoffs:3,sc:.625,w:11,h:17},{c:1222,x0:46,y0:818,yoffs:6,xpad:.160156,sc:.625,w:9,h:14},{c:1223,x0:868,y0:405,yoffs:3,xpad:.634766,sc:.625,w:10,h:17},{c:1224,x0:66,y0:818,yoffs:6,xpad:1.02832,sc:.625,w:8,h:14},{c:1225,x0:889,y0:405,yoffs:3,sc:.625,w:11,h:17},{c:1226,x0:85,y0:818,yoffs:6,sc:.625,w:9,h:14},{c:1227,x0:911,y0:405,yoffs:3,xpad:1.43359,sc:.625,w:8,h:17},{c:1228,x0:438,y0:864,yoffs:6,xpad:1.33008,sc:.625,w:7,h:13},{c:1229,x0:930,y0:404,yoffs:3,sc:.625,w:14,h:17},{c:1230,x0:105,y0:818,yoffs:6,sc:.625,w:12,h:14},{c:1231,x0:252,y0:768,yoffs:3,xpad:.760742,sc:.625,w:4,h:14},{c:1232,x0:764,y0:320,yoffs:-1,xpad:.287109,sc:.625,w:9,h:18},{c:1233,x0:988,y0:623,yoffs:2,xpad:1.0127,sc:.625,w:7,h:15},{c:1234,x0:784,y0:320,yoffs:-1,xpad:.287109,sc:.625,w:9,h:18},{c:1235,x0:1006,y0:623,yoffs:2,xpad:1.0127,sc:.625,w:7,h:15},{c:1236,x0:128,y0:818,yoffs:3,xpad:.461914,sc:.625,w:13,h:14},{c:1237,x0:472,y0:932,yoffs:6,xpad:.241211,sc:.625,w:12,h:11},{c:1238,x0:804,y0:320,yoffs:-1,xpad:.417969,sc:.625,w:8,h:18},{c:1239,x0:5,y0:666,yoffs:2,xpad:.0517578,sc:.625,w:8,h:15},{c:1240,x0:637,y0:707,yoffs:3,xpad:.858398,sc:.625,w:9,h:14},{c:1241,x0:495,y0:932,yoffs:6,xpad:.0517578,sc:.625,w:8,h:11},{c:1242,x0:823,y0:320,yoffs:-1,xpad:.858398,sc:.625,w:9,h:18},{c:1243,x0:24,y0:666,yoffs:2,xpad:.0517578,sc:.625,w:8,h:15},{c:1244,x0:843,y0:319,yoffs:-1,sc:.625,w:12,h:18},{c:1245,x0:43,y0:666,yoffs:2,sc:.625,w:10,h:15},{c:1246,x0:866,y0:319,yoffs:-1,sc:.625,w:8,h:18},{c:1247,x0:64,y0:666,yoffs:2,sc:.625,w:7,h:15},{c:1248,x0:5,y0:743,yoffs:3,xpad:.441406,sc:.625,w:7,h:14},{c:1249,x0:804,y0:729,yoffs:6,sc:.625,w:7,h:14},{c:1250,x0:955,y0:404,xpad:.727539,sc:.625,w:10,h:17},{c:1251,x0:152,y0:818,yoffs:3,xpad:1.02832,sc:.625,w:8,h:14},{c:1252,x0:885,y0:318,yoffs:-1,xpad:.727539,sc:.625,w:10,h:18},{c:1253,x0:82,y0:666,yoffs:2,xpad:1.02832,sc:.625,w:8,h:15},{c:1254,x0:906,y0:318,yoffs:-1,xpad:.171875,sc:.625,w:11,h:18},{c:1255,x0:101,y0:666,yoffs:2,xpad:.549805,sc:.625,w:8,h:15},{c:1256,x0:774,y0:704,yoffs:3,xpad:.171875,sc:.625,w:11,h:14},{c:1257,x0:514,y0:932,yoffs:6,xpad:.549805,sc:.625,w:8,h:11},{c:1258,x0:928,y0:318,yoffs:-1,xpad:.171875,sc:.625,w:11,h:18},{c:1259,x0:120,y0:666,yoffs:2,xpad:.549805,sc:.625,w:8,h:15},{c:1260,x0:950,y0:318,yoffs:-1,xpad:.828125,sc:.625,w:8,h:18},{c:1261,x0:139,y0:666,yoffs:2,xpad:.0556641,sc:.625,w:7,h:15},{c:1262,x0:976,y0:404,sc:.625,w:9,h:17},{c:1263,x0:194,y0:420,yoffs:3,sc:.625,w:8,h:17},{c:1264,x0:969,y0:318,yoffs:-1,sc:.625,w:9,h:18},{c:1265,x0:989,y0:318,yoffs:2,sc:.625,w:8,h:18},{c:1266,x0:915,y0:230,yoffs:-2,sc:.625,w:9,h:19},{c:1267,x0:935,y0:230,yoffs:1,sc:.625,w:8,h:19},{c:1268,x0:1008,y0:317,yoffs:-1,xpad:1.43359,sc:.625,w:8,h:18},{c:1269,x0:157,y0:666,yoffs:2,xpad:1.33008,sc:.625,w:7,h:15},{c:1270,x0:996,y0:404,yoffs:3,sc:.625,w:8,h:17},{c:1271,x0:456,y0:864,yoffs:6,xpad:.09375,sc:.625,w:6,h:13},{c:1272,x0:5,y0:363,yoffs:-1,xpad:.852539,sc:.625,w:13,h:18},{c:1273,x0:175,y0:666,yoffs:2,xpad:1.41211,sc:.625,w:11,h:15},{c:1274,x0:29,y0:363,yoffs:3,xpad:.0195313,sc:.625,w:10,h:18},{c:1275,x0:197,y0:666,yoffs:6,sc:.625,w:9,h:15},{c:1276,x0:50,y0:363,yoffs:3,xpad:.120117,sc:.625,w:13,h:18},{c:1277,x0:217,y0:666,yoffs:6,xpad:.5625,sc:.625,w:11,h:15},{c:1278,x0:171,y0:818,yoffs:3,sc:.625,w:12,h:14},{c:1279,x0:533,y0:932,yoffs:6,sc:.625,w:11,h:11},{c:7424,x0:555,y0:931,yoffs:6,xpad:.0537109,sc:.625,w:10,h:11},{c:7425,x0:576,y0:931,yoffs:6,xpad:.696289,sc:.625,w:13,h:11},{c:7426,x0:600,y0:929,yoffs:6,xpad:.435547,sc:.625,w:16,h:11},{c:7427,x0:627,y0:929,yoffs:6,sc:.625,w:12,h:11},{c:7428,x0:650,y0:927,yoffs:6,xpad:.301758,sc:.625,w:9,h:11},{c:7429,x0:670,y0:927,yoffs:6,xpad:.913086,sc:.625,w:10,h:11},{c:7430,x0:691,y0:927,yoffs:6,xpad:.913086,sc:.625,w:10,h:11},{c:7431,x0:712,y0:927,yoffs:6,xpad:.349609,sc:.625,w:8,h:11},{c:7432,x0:731,y0:925,yoffs:6,sc:.625,w:10,h:11},{c:7433,x0:239,y0:666,yoffs:6,xpad:.463867,sc:.625,w:5,h:15},{c:7434,x0:752,y0:925,yoffs:6,xpad:.757813,sc:.625,w:6,h:11},{c:7435,x0:769,y0:924,yoffs:6,sc:.625,w:10,h:11},{c:7436,x0:790,y0:924,yoffs:6,xpad:.369141,sc:.625,w:8,h:11},{c:7437,x0:809,y0:924,yoffs:6,xpad:.78418,sc:.625,w:13,h:11},{c:7438,x0:833,y0:924,yoffs:6,xpad:.953125,sc:.625,w:11,h:11},{c:7439,x0:855,y0:922,yoffs:6,xpad:.650391,sc:.625,w:11,h:11},{c:7440,x0:877,y0:922,yoffs:6,xpad:.321289,sc:.625,w:9,h:11},{c:7441,x0:897,y0:922,yoffs:6,xpad:.757813,sc:.625,w:11,h:11},{c:7442,x0:34,y0:981,yoffs:7,xpad:.757813,sc:.625,w:11,h:9},{c:7443,x0:919,y0:922,yoffs:6,sc:.625,w:12,h:11},{c:7444,x0:942,y0:922,yoffs:6,xpad:.529297,sc:.625,w:17,h:11},{c:7445,x0:970,y0:921,yoffs:6,xpad:.449219,sc:.625,w:10,h:11},{c:7446,x0:610,y0:973,yoffs:6,xpad:.09375,sc:.625,w:11,h:6},{c:7447,x0:632,y0:973,yoffs:11,xpad:.09375,sc:.625,w:11,h:6},{c:7448,x0:991,y0:921,yoffs:6,xpad:.389648,sc:.625,w:9,h:11},{c:7449,x0:5,y0:959,yoffs:6,xpad:.931641,sc:.625,w:9,h:11},{c:7450,x0:25,y0:959,yoffs:6,xpad:.931641,sc:.625,w:9,h:11},{c:7451,x0:45,y0:959,yoffs:6,xpad:.334961,sc:.625,w:8,h:11},{c:7452,x0:64,y0:959,yoffs:6,xpad:.68457,sc:.625,w:11,h:11},{c:7453,x0:802,y0:946,yoffs:6,xpad:.240234,sc:.625,w:11,h:10},{c:7454,x0:824,y0:946,yoffs:6,sc:.625,w:15,h:10},{c:7455,x0:895,y0:516,yoffs:3,xpad:.240234,sc:.625,w:11,h:16},{c:7456,x0:86,y0:959,yoffs:6,xpad:.0527344,sc:.625,w:9,h:11},{c:7457,x0:106,y0:959,yoffs:6,sc:.625,w:15,h:11},{c:7458,x0:132,y0:959,yoffs:6,sc:.625,w:9,h:11},{c:7459,x0:152,y0:959,yoffs:6,xpad:.78418,sc:.625,w:8,h:11},{c:7460,x0:171,y0:959,yoffs:6,xpad:.349609,sc:.625,w:8,h:11},{c:7461,x0:190,y0:959,yoffs:6,xpad:.228516,sc:.625,w:9,h:11},{c:7462,x0:210,y0:959,yoffs:6,xpad:.422852,sc:.625,w:8,h:11},{c:7463,x0:229,y0:959,yoffs:6,sc:.625,w:10,h:11},{c:7464,x0:250,y0:959,yoffs:6,xpad:1.02051,sc:.625,w:10,h:11},{c:7465,x0:991,y0:921,yoffs:6,xpad:.389648,sc:.625,w:9,h:11},{c:7466,x0:271,y0:959,yoffs:6,xpad:.709961,sc:.625,w:12,h:11},{c:7467,x0:294,y0:959,yoffs:6,xpad:.913086,sc:.625,w:10,h:11},{c:7468,x0:718,y0:988,yoffs:8,xpad:3.04688,sc:.625,w:5,h:4},{c:7469,x0:734,y0:987,yoffs:8,xpad:4.09375,sc:.625,w:7,h:4},{c:7470,x0:752,y0:985,yoffs:8,xpad:2.83203,sc:.625,w:5,h:4},{c:7471,x0:56,y0:981,yoffs:3,sc:.625,w:8,h:9},{c:7472,x0:768,y0:985,yoffs:8,xpad:2.61816,sc:.625,w:6,h:4},{c:7473,x0:785,y0:985,yoffs:8,xpad:2.52344,sc:.625,w:4,h:4},{c:7474,x0:800,y0:984,yoffs:8,xpad:2.52344,sc:.625,w:4,h:4},{c:7475,x0:815,y0:984,yoffs:8,xpad:3.44238,sc:.625,w:5,h:4},{c:7476,x0:831,y0:984,yoffs:8,xpad:2.90625,sc:.625,w:6,h:4},{c:7477,x0:848,y0:984,yoffs:8,xpad:1.53125,sc:.625,w:3,h:4},{c:7478,x0:654,y0:973,yoffs:8,xpad:1.85254,sc:.625,w:2,h:6},{c:7479,x0:862,y0:984,yoffs:8,xpad:2.74414,sc:.625,w:5,h:4},{c:7480,x0:878,y0:982,yoffs:8,xpad:4.57715,sc:.625,w:2,h:4},{c:7481,x0:891,y0:982,yoffs:8,xpad:3.98633,sc:.625,w:7,h:4},{c:7482,x0:909,y0:982,yoffs:8,xpad:3.46289,sc:.625,w:6,h:4},{c:7483,x0:75,y0:981,yoffs:3,xpad:.462891,sc:.625,w:9,h:9},{c:7484,x0:926,y0:982,yoffs:8,xpad:3.26758,sc:.625,w:6,h:4},{c:7485,x0:943,y0:982,yoffs:8,xpad:2.92578,sc:.625,w:6,h:4},{c:7486,x0:960,y0:982,yoffs:8,xpad:2.30957,sc:.625,w:5,h:4},{c:7487,x0:976,y0:982,yoffs:8,xpad:2.69043,sc:.625,w:5,h:4},{c:7488,x0:992,y0:980,yoffs:8,xpad:1.73828,sc:.625,w:5,h:4},{c:7489,x0:1008,y0:980,yoffs:8,xpad:2.79883,sc:.625,w:6,h:4},{c:7490,x0:444,y0:1011,yoffs:8,xpad:3.27441,sc:.625,w:8,h:4},{c:7491,x0:774,y0:1e3,yoffs:9,xpad:3.04102,sc:.625,w:4,h:3},{c:7492,x0:789,y0:1e3,yoffs:9,xpad:2.04102,sc:.625,w:5,h:3},{c:7493,x0:805,y0:999,yoffs:9,xpad:2.36328,sc:.625,w:5,h:3},{c:7494,x0:821,y0:999,yoffs:9,xpad:3.68359,sc:.625,w:7,h:3},{c:7495,x0:463,y0:1011,yoffs:8,xpad:2.36328,sc:.625,w:5,h:4},{c:7496,x0:479,y0:1010,yoffs:8,xpad:2.36328,sc:.625,w:5,h:4},{c:7497,x0:839,y0:999,yoffs:9,xpad:1.87988,sc:.625,w:5,h:3},{c:7498,x0:855,y0:999,yoffs:9,xpad:1.87988,sc:.625,w:5,h:3},{c:7499,x0:871,y0:999,yoffs:9,xpad:2.46973,sc:.625,w:4,h:3},{c:7500,x0:886,y0:997,yoffs:9,xpad:2.20117,sc:.625,w:4,h:3},{c:7501,x0:57,y0:1001,yoffs:9,xpad:2.36328,sc:.625,w:5,h:5},{c:7502,x0:73,y0:1001,yoffs:9,xpad:1.54492,sc:.625,w:2,h:5},{c:7503,x0:495,y0:1010,yoffs:8,xpad:2.22168,sc:.625,w:5,h:4},{c:7504,x0:901,y0:997,yoffs:9,xpad:4.43555,sc:.625,w:7,h:3},{c:7505,x0:86,y0:1001,yoffs:9,xpad:2.65137,sc:.625,w:5,h:5},{c:7506,x0:919,y0:997,yoffs:9,xpad:2.20215,sc:.625,w:5,h:3},{c:7507,x0:935,y0:997,yoffs:9,xpad:1.98633,sc:.625,w:4,h:3},{c:7508,xpad:7.20215,sc:.625},{c:7509,xpad:7.20215,sc:.625},{c:7510,x0:102,y0:1001,yoffs:9,xpad:2.36328,sc:.625,w:5,h:5},{c:7511,x0:511,y0:1010,yoffs:8,xpad:2.05371,sc:.625,w:3,h:4},{c:7512,x0:950,y0:997,yoffs:9,xpad:2.65137,sc:.625,w:5,h:3},{c:7513,x0:945,y0:1011,yoffs:9,xpad:2.30957,sc:.625,w:5,h:2},{c:7514,x0:966,y0:997,yoffs:9,xpad:4.43555,sc:.625,w:7,h:3},{c:7515,x0:984,y0:997,yoffs:9,xpad:1.63086,sc:.625,w:5,h:3},{c:7516,x0:1e3,y0:995,yoffs:9,xpad:2.00098,sc:.625,w:4,h:3},{c:7517,x0:667,y0:973,yoffs:8,xpad:2.69043,sc:.625,w:5,h:6},{c:7518,x0:118,y0:1001,yoffs:9,xpad:1.61133,sc:.625,w:5,h:5},{c:7519,x0:525,y0:1010,yoffs:8,xpad:2.20215,sc:.625,w:5,h:4},{c:7520,x0:134,y0:1001,yoffs:9,xpad:3.22852,sc:.625,w:6,h:5},{c:7521,x0:151,y0:1001,yoffs:9,xpad:1.89941,sc:.625,w:5,h:5},{c:7522,x0:683,y0:971,yoffs:12,xpad:1.54492,sc:.625,w:2,h:6},{c:7523,x0:167,y0:1001,yoffs:13,xpad:1.28809,sc:.625,w:4,h:5},{c:7524,x0:182,y0:1001,yoffs:13,xpad:2.65137,sc:.625,w:5,h:5},{c:7525,x0:198,y0:1001,yoffs:13,xpad:1.63086,sc:.625,w:5,h:5},{c:7526,x0:467,y0:976,yoffs:12,xpad:2.69043,sc:.625,w:5,h:7},{c:7527,x0:696,y0:971,yoffs:13,xpad:1.61133,sc:.625,w:5,h:6},{c:7528,x0:712,y0:971,yoffs:13,xpad:2.20215,sc:.625,w:5,h:6},{c:7529,x0:728,y0:970,yoffs:13,xpad:3.22852,sc:.625,w:6,h:6},{c:7530,x0:745,y0:968,yoffs:13,xpad:1.0752,sc:.625,w:6,h:6},{c:7531,x0:315,y0:959,yoffs:6,xpad:.368164,sc:.625,w:17,h:11},{c:7532,x0:255,y0:665,yoffs:2,sc:.625,w:13,h:15},{c:7533,x0:279,y0:665,yoffs:2,sc:.625,w:13,h:15},{c:7534,x0:303,y0:665,yoffs:2,sc:.625,w:9,h:15},{c:7535,x0:343,y0:959,yoffs:6,sc:.625,w:20,h:11},{c:7536,x0:374,y0:958,yoffs:6,sc:.625,w:14,h:11},{c:7537,x0:323,y0:662,yoffs:6,sc:.625,w:13,h:15},{c:7538,x0:399,y0:958,yoffs:6,sc:.625,w:10,h:11},{c:7539,x0:420,y0:954,yoffs:6,sc:.625,w:9,h:11},{c:7540,x0:440,y0:954,yoffs:6,sc:.625,w:11,h:11},{c:7541,x0:473,y0:864,yoffs:4,sc:.625,w:9,h:13},{c:7542,x0:462,y0:954,yoffs:6,sc:.625,w:9,h:11},{c:7543,x0:347,y0:662,yoffs:2,xpad:.347656,sc:.625,w:11,h:15},{c:7544,x0:405,y0:1015,yoffs:9,xpad:2.70508,sc:.625,w:5,h:3},{c:7545,x0:369,y0:662,yoffs:6,xpad:.146484,sc:.625,w:10,h:15},{c:7546,x0:917,y0:516,yoffs:2,xpad:.555664,sc:.625,w:19,h:16},{c:7547,x0:482,y0:954,yoffs:6,sc:.625,w:7,h:11},{c:7548,x0:500,y0:954,yoffs:6,xpad:.294922,sc:.625,w:7,h:11},{c:7549,x0:390,y0:661,yoffs:6,sc:.625,w:12,h:15},{c:7550,x0:518,y0:954,yoffs:6,sc:.625,w:12,h:11},{c:7551,x0:541,y0:954,yoffs:6,sc:.625,w:12,h:11},{c:7680,x0:954,y0:230,yoffs:3,sc:.625,w:13,h:19},{c:7681,x0:947,y0:516,yoffs:6,xpad:.825195,sc:.625,w:10,h:16},{c:7682,x0:74,y0:363,yoffs:-1,xpad:.0458984,sc:.625,w:12,h:18},{c:7683,x0:413,y0:661,yoffs:2,xpad:.347656,sc:.625,w:11,h:15},{c:7684,x0:5,y0:449,yoffs:3,xpad:.0458984,sc:.625,w:12,h:17},{c:7685,x0:97,y0:363,yoffs:2,xpad:.347656,sc:.625,w:11,h:18},{c:7686,x0:28,y0:449,yoffs:3,xpad:.0458984,sc:.625,w:12,h:17},{c:7687,x0:119,y0:363,yoffs:2,xpad:.347656,sc:.625,w:11,h:18},{c:7688,x0:625,y0:169,yoffs:-1,xpad:.416016,sc:.625,w:11,h:22},{c:7689,x0:978,y0:229,yoffs:2,xpad:.213867,sc:.625,w:9,h:19},{c:7690,x0:141,y0:363,yoffs:-1,xpad:.261719,sc:.625,w:13,h:18},{c:7691,x0:435,y0:661,yoffs:2,xpad:1.34766,sc:.625,w:10,h:15},{c:7692,x0:51,y0:449,yoffs:3,xpad:.261719,sc:.625,w:13,h:17},{c:7693,x0:165,y0:362,yoffs:2,xpad:1.34766,sc:.625,w:10,h:18},{c:7694,x0:75,y0:449,yoffs:3,xpad:.261719,sc:.625,w:13,h:17},{c:7695,x0:186,y0:362,yoffs:2,xpad:1.34766,sc:.625,w:10,h:18},{c:7696,x0:207,y0:362,yoffs:3,xpad:.261719,sc:.625,w:13,h:18},{c:7697,x0:998,y0:229,yoffs:2,xpad:1.34766,sc:.625,w:10,h:19},{c:7698,x0:99,y0:449,yoffs:3,xpad:.261719,sc:.625,w:13,h:17},{c:7699,x0:231,y0:359,yoffs:2,xpad:1.34766,sc:.625,w:10,h:18},{c:7700,x0:57,y0:214,yoffs:-3,xpad:1.03906,sc:.625,w:9,h:20},{c:7701,x0:123,y0:449,xpad:.59082,sc:.625,w:10,h:17},{c:7702,x0:77,y0:214,yoffs:-3,xpad:1.03906,sc:.625,w:9,h:20},{c:7703,x0:144,y0:449,xpad:.59082,sc:.625,w:10,h:17},{c:7704,x0:165,y0:449,yoffs:3,xpad:.0390625,sc:.625,w:10,h:17},{c:7705,x0:194,y0:818,yoffs:6,xpad:.59082,sc:.625,w:10,h:14},{c:7706,x0:186,y0:448,yoffs:3,xpad:1.03906,sc:.625,w:9,h:17},{c:7707,x0:215,y0:818,yoffs:6,xpad:.59082,sc:.625,w:10,h:14},{c:7708,x0:647,y0:169,yoffs:-1,xpad:1.03906,sc:.625,w:9,h:22},{c:7709,x0:5,y0:275,yoffs:2,xpad:.59082,sc:.625,w:10,h:19},{c:7710,x0:252,y0:358,yoffs:-1,xpad:.838867,sc:.625,w:9,h:18},{c:7711,x0:272,y0:358,yoffs:-1,sc:.625,w:8,h:18},{c:7712,x0:206,y0:448,xpad:.978516,sc:.625,w:12,h:17},{c:7713,x0:291,y0:358,yoffs:3,xpad:1.34766,sc:.625,w:10,h:18},{c:7714,x0:312,y0:358,yoffs:-1,xpad:.710938,sc:.625,w:13,h:18},{c:7715,x0:26,y0:275,yoffs:-2,xpad:.777344,sc:.625,w:11,h:19},{c:7716,x0:229,y0:448,yoffs:3,xpad:.710938,sc:.625,w:13,h:17},{c:7717,x0:336,y0:358,yoffs:2,xpad:.777344,sc:.625,w:11,h:18},{c:7718,x0:358,y0:356,yoffs:-1,xpad:.710938,sc:.625,w:13,h:18},{c:7719,x0:48,y0:275,yoffs:-2,xpad:.0117188,sc:.625,w:12,h:19},{c:7720,x0:382,y0:354,yoffs:3,xpad:.710938,sc:.625,w:13,h:18},{c:7721,x0:71,y0:275,yoffs:2,xpad:.777344,sc:.625,w:11,h:19},{c:7722,x0:406,y0:354,yoffs:3,xpad:.710938,sc:.625,w:13,h:18},{c:7723,x0:93,y0:275,yoffs:2,xpad:.777344,sc:.625,w:11,h:19},{c:7724,x0:253,y0:445,yoffs:3,sc:.625,w:9,h:17},{c:7725,x0:430,y0:354,yoffs:2,sc:.625,w:8,h:18},{c:7726,x0:97,y0:214,yoffs:-3,sc:.625,w:7,h:20},{c:7727,x0:273,y0:445,sc:.625,w:8,h:17},{c:7728,x0:449,y0:354,yoffs:-1,sc:.625,w:12,h:18},{c:7729,x0:115,y0:275,yoffs:-2,sc:.625,w:12,h:19},{c:7730,x0:292,y0:445,yoffs:3,sc:.625,w:12,h:17},{c:7731,x0:472,y0:354,yoffs:2,sc:.625,w:12,h:18},{c:7732,x0:315,y0:444,yoffs:3,sc:.625,w:12,h:17},{c:7733,x0:495,y0:353,yoffs:2,sc:.625,w:12,h:18},{c:7734,x0:338,y0:444,yoffs:3,xpad:.126953,sc:.625,w:10,h:17},{c:7735,x0:518,y0:353,yoffs:2,xpad:.463867,sc:.625,w:5,h:18},{c:7736,x0:115,y0:213,sc:.625,w:11,h:20},{c:7737,x0:858,y0:168,yoffs:-1,sc:.625,w:7,h:21},{c:7738,x0:359,y0:444,yoffs:3,xpad:.126953,sc:.625,w:10,h:17},{c:7739,x0:534,y0:353,yoffs:2,sc:.625,w:7,h:18},{c:7740,x0:380,y0:442,yoffs:3,xpad:.126953,sc:.625,w:10,h:17},{c:7741,x0:552,y0:353,yoffs:2,sc:.625,w:9,h:18},{c:7742,x0:138,y0:274,yoffs:-2,xpad:.770508,sc:.625,w:14,h:19},{c:7743,x0:401,y0:440,xpad:.669922,sc:.625,w:16,h:17},{c:7744,x0:572,y0:353,yoffs:-1,xpad:.904297,sc:.625,w:16,h:18},{c:7745,x0:456,y0:659,yoffs:2,xpad:.602539,sc:.625,w:17,h:15},{c:7746,x0:428,y0:440,yoffs:3,xpad:.904297,sc:.625,w:16,h:17},{c:7747,x0:236,y0:818,yoffs:6,xpad:.602539,sc:.625,w:17,h:14},{c:7748,x0:599,y0:353,yoffs:-1,xpad:1.57031,sc:.625,w:13,h:18},{c:7749,x0:484,y0:659,yoffs:2,xpad:.777344,sc:.625,w:11,h:15},{c:7750,x0:455,y0:440,yoffs:3,xpad:1.57031,sc:.625,w:13,h:17},{c:7751,x0:264,y0:818,yoffs:6,xpad:.777344,sc:.625,w:11,h:14},{c:7752,x0:479,y0:440,yoffs:3,xpad:1.57031,sc:.625,w:13,h:17},{c:7753,x0:286,y0:818,yoffs:6,xpad:.777344,sc:.625,w:11,h:14},{c:7754,x0:503,y0:439,yoffs:3,xpad:1.57031,sc:.625,w:13,h:17},{c:7755,x0:308,y0:818,yoffs:6,xpad:.777344,sc:.625,w:11,h:14},{c:7756,x0:137,y0:213,yoffs:-3,xpad:.267578,sc:.625,w:14,h:20},{c:7757,x0:527,y0:439,xpad:.09375,sc:.625,w:11,h:17},{c:7758,x0:162,y0:210,yoffs:-3,xpad:.267578,sc:.625,w:14,h:20},{c:7759,x0:549,y0:438,xpad:.09375,sc:.625,w:11,h:17},{c:7760,x0:187,y0:209,yoffs:-3,xpad:.267578,sc:.625,w:14,h:20},{c:7761,x0:571,y0:438,xpad:.09375,sc:.625,w:11,h:17},{c:7762,x0:212,y0:209,yoffs:-3,xpad:.267578,sc:.625,w:14,h:20},{c:7763,x0:593,y0:438,xpad:.09375,sc:.625,w:11,h:17},{c:7764,x0:623,y0:353,yoffs:-1,xpad:.254883,sc:.625,w:11,h:18},{c:7765,x0:163,y0:274,yoffs:2,xpad:.347656,sc:.625,w:11,h:19},{c:7766,x0:645,y0:351,yoffs:-1,xpad:.254883,sc:.625,w:11,h:18},{c:7767,x0:185,y0:271,yoffs:2,xpad:.347656,sc:.625,w:11,h:19},{c:7768,x0:667,y0:351,yoffs:-1,sc:.625,w:12,h:18},{c:7769,x0:506,y0:657,yoffs:2,xpad:.134766,sc:.625,w:8,h:15},{c:7770,x0:615,y0:438,yoffs:3,sc:.625,w:12,h:17},{c:7771,x0:330,y0:817,yoffs:6,xpad:.134766,sc:.625,w:8,h:14},{c:7772,x0:237,y0:209,sc:.625,w:12,h:20},{c:7773,x0:638,y0:438,yoffs:3,xpad:.134766,sc:.625,w:8,h:17},{c:7774,x0:657,y0:438,yoffs:3,sc:.625,w:12,h:17},{c:7775,x0:349,y0:817,yoffs:6,xpad:.134766,sc:.625,w:8,h:14},{c:7776,x0:690,y0:351,yoffs:-1,sc:.625,w:10,h:18},{c:7777,x0:525,y0:657,yoffs:2,sc:.625,w:9,h:15},{c:7778,x0:680,y0:436,yoffs:3,sc:.625,w:10,h:17},{c:7779,x0:368,y0:817,yoffs:6,sc:.625,w:9,h:14},{c:7780,x0:711,y0:351,yoffs:-1,sc:.625,w:10,h:18},{c:7781,x0:545,y0:657,yoffs:2,sc:.625,w:9,h:15},{c:7782,x0:260,y0:209,yoffs:-3,sc:.625,w:10,h:20},{c:7783,x0:701,y0:436,sc:.625,w:9,h:17},{c:7784,x0:876,y0:168,yoffs:-1,sc:.625,w:10,h:21},{c:7785,x0:732,y0:350,yoffs:2,sc:.625,w:9,h:18},{c:7786,x0:752,y0:350,yoffs:-1,sc:.625,w:11,h:18},{c:7787,x0:721,y0:436,sc:.625,w:8,h:17},{c:7788,x0:740,y0:435,yoffs:3,sc:.625,w:11,h:17},{c:7789,x0:968,y0:516,yoffs:4,sc:.625,w:8,h:16},{c:7790,x0:762,y0:435,yoffs:3,sc:.625,w:11,h:17},{c:7791,x0:987,y0:515,yoffs:4,sc:.625,w:8,h:16},{c:7792,x0:784,y0:434,yoffs:3,sc:.625,w:11,h:17},{c:7793,x0:806,y0:434,yoffs:4,sc:.625,w:9,h:17},{c:7794,x0:774,y0:349,yoffs:-1,xpad:.549805,sc:.625,w:13,h:18},{c:7795,x0:565,y0:657,yoffs:2,xpad:.777344,sc:.625,w:11,h:15},{c:7796,x0:798,y0:349,yoffs:-1,xpad:.549805,sc:.625,w:13,h:18},{c:7797,x0:587,y0:656,yoffs:2,xpad:.777344,sc:.625,w:11,h:15},{c:7798,x0:826,y0:434,yoffs:3,xpad:.549805,sc:.625,w:13,h:17},{c:7799,x0:609,y0:655,yoffs:6,xpad:.777344,sc:.625,w:11,h:15},{c:7800,x0:281,y0:209,yoffs:-3,xpad:.549805,sc:.625,w:13,h:20},{c:7801,x0:850,y0:434,xpad:.777344,sc:.625,w:11,h:17},{c:7802,x0:305,y0:207,yoffs:-3,xpad:.549805,sc:.625,w:13,h:20},{c:7803,x0:872,y0:433,xpad:.777344,sc:.625,w:11,h:17},{c:7804,x0:822,y0:349,yoffs:-1,sc:.625,w:12,h:18},{c:7805,x0:631,y0:655,yoffs:2,sc:.625,w:11,h:15},{c:7806,x0:894,y0:433,yoffs:3,sc:.625,w:12,h:17},{c:7807,x0:388,y0:814,yoffs:6,sc:.625,w:11,h:14},{c:7808,x0:845,y0:348,yoffs:-1,sc:.625,w:14,h:18},{c:7809,x0:1006,y0:515,yoffs:1,sc:.625,w:11,h:16},{c:7810,x0:870,y0:348,yoffs:-1,sc:.625,w:14,h:18},{c:7811,x0:5,y0:560,yoffs:1,sc:.625,w:11,h:16},{c:7812,x0:895,y0:347,yoffs:-1,sc:.625,w:14,h:18},{c:7813,x0:653,y0:654,yoffs:2,sc:.625,w:11,h:15},{c:7814,x0:920,y0:347,yoffs:-1,sc:.625,w:18,h:18},{c:7815,x0:675,y0:654,yoffs:2,sc:.625,w:16,h:15},{c:7816,x0:917,y0:433,yoffs:3,sc:.625,w:18,h:17},{c:7817,x0:410,y0:814,yoffs:6,sc:.625,w:16,h:14},{c:7818,x0:949,y0:347,yoffs:-1,sc:.625,w:12,h:18},{c:7819,x0:702,y0:654,yoffs:2,sc:.625,w:11,h:15},{c:7820,x0:972,y0:347,yoffs:-1,sc:.625,w:12,h:18},{c:7821,x0:724,y0:654,yoffs:2,sc:.625,w:11,h:15},{c:7822,x0:995,y0:347,yoffs:-1,sc:.625,w:12,h:18},{c:7823,x0:207,y0:270,yoffs:2,sc:.625,w:11,h:19},{c:7824,x0:5,y0:392,yoffs:-1,xpad:.375977,sc:.625,w:10,h:18},{c:7825,x0:746,y0:654,yoffs:2,sc:.625,w:9,h:15},{c:7826,x0:946,y0:432,yoffs:3,xpad:.375977,sc:.625,w:10,h:17},{c:7827,x0:437,y0:814,yoffs:6,sc:.625,w:9,h:14},{c:7828,x0:967,y0:432,yoffs:3,xpad:.375977,sc:.625,w:10,h:17},{c:7829,x0:457,y0:814,yoffs:6,sc:.625,w:9,h:14},{c:7830,x0:26,y0:392,yoffs:2,xpad:.777344,sc:.625,w:11,h:18},{c:7831,x0:988,y0:432,sc:.625,w:8,h:17},{c:7832,x0:27,y0:560,yoffs:1,sc:.625,w:16,h:16},{c:7833,x0:329,y0:205,yoffs:1,sc:.625,w:11,h:20},{c:7834,x0:54,y0:560,yoffs:1,xpad:.825195,sc:.625,w:10,h:16},{c:7835,x0:48,y0:392,yoffs:-1,sc:.625,w:8,h:18},{c:7836,x0:766,y0:652,yoffs:2,sc:.625,w:9,h:15},{c:7837,x0:786,y0:652,yoffs:2,sc:.625,w:8,h:15},{c:7838,x0:477,y0:813,yoffs:3,sc:.625,w:14,h:14},{c:7839,x0:805,y0:652,yoffs:2,xpad:.09375,sc:.625,w:11,h:15},{c:7840,x0:67,y0:392,yoffs:3,sc:.625,w:13,h:18},{c:7841,x0:827,y0:651,yoffs:6,xpad:1.21973,sc:.625,w:9,h:15},{c:7842,x0:229,y0:270,yoffs:-2,sc:.625,w:13,h:19},{c:7843,x0:1007,y0:432,xpad:1.21973,sc:.625,w:9,h:17},{c:7844,x0:253,y0:270,yoffs:-2,sc:.625,w:13,h:19},{c:7845,x0:5,y0:477,sc:.625,w:11,h:17},{c:7846,x0:277,y0:270,yoffs:-2,sc:.625,w:13,h:19},{c:7847,x0:27,y0:477,xpad:1.21973,sc:.625,w:9,h:17},{c:7848,x0:301,y0:270,yoffs:-2,sc:.625,w:13,h:19},{c:7849,x0:47,y0:477,sc:.625,w:11,h:17},{c:7850,x0:351,y0:205,yoffs:-3,sc:.625,w:13,h:20},{c:7851,x0:91,y0:392,yoffs:-1,xpad:1.21973,sc:.625,w:9,h:18},{c:7852,x0:667,y0:169,yoffs:-1,sc:.625,w:13,h:22},{c:7853,x0:375,y0:205,yoffs:1,xpad:1.21973,sc:.625,w:9,h:20},{c:7854,x0:395,y0:205,yoffs:-3,sc:.625,w:13,h:20},{c:7855,x0:111,y0:392,yoffs:-1,xpad:1.21973,sc:.625,w:9,h:18},{c:7856,x0:419,y0:204,yoffs:-3,sc:.625,w:13,h:20},{c:7857,x0:131,y0:392,yoffs:-1,xpad:1.21973,sc:.625,w:9,h:18},{c:7858,x0:443,y0:204,yoffs:-3,sc:.625,w:13,h:20},{c:7859,x0:325,y0:268,yoffs:-2,xpad:1.21973,sc:.625,w:9,h:19},{c:7860,x0:467,y0:204,yoffs:-3,sc:.625,w:13,h:20},{c:7861,x0:151,y0:392,yoffs:-1,xpad:1.21973,sc:.625,w:9,h:18},{c:7862,x0:691,y0:169,yoffs:-1,sc:.625,w:13,h:22},{c:7863,x0:491,y0:204,yoffs:1,xpad:1.21973,sc:.625,w:9,h:20},{c:7864,x0:171,y0:391,yoffs:3,xpad:.634766,sc:.625,w:10,h:18},{c:7865,x0:847,y0:651,yoffs:6,xpad:.0488281,sc:.625,w:10,h:15},{c:7866,x0:345,y0:266,yoffs:-2,xpad:.634766,sc:.625,w:10,h:19},{c:7867,x0:69,y0:477,xpad:.0488281,sc:.625,w:10,h:17},{c:7868,x0:192,y0:391,yoffs:-1,xpad:.634766,sc:.625,w:10,h:18},{c:7869,x0:75,y0:560,yoffs:1,xpad:.0488281,sc:.625,w:10,h:16},{c:7870,x0:366,y0:266,yoffs:-2,sc:.625,w:11,h:19},{c:7871,x0:90,y0:477,sc:.625,w:11,h:17},{c:7872,x0:388,y0:266,yoffs:-2,xpad:.634766,sc:.625,w:10,h:19},{c:7873,x0:112,y0:477,sc:.625,w:11,h:17},{c:7874,x0:409,y0:266,yoffs:-2,sc:.625,w:11,h:19},{c:7875,x0:134,y0:477,sc:.625,w:11,h:17},{c:7876,x0:511,y0:204,yoffs:-3,xpad:.634766,sc:.625,w:10,h:20},{c:7877,x0:213,y0:391,yoffs:-1,xpad:.0488281,sc:.625,w:10,h:18},{c:7878,x0:715,y0:168,yoffs:-1,xpad:.634766,sc:.625,w:10,h:22},{c:7879,x0:532,y0:204,yoffs:1,xpad:.0488281,sc:.625,w:10,h:20},{c:7880,x0:431,y0:266,yoffs:-2,xpad:.708008,sc:.625,w:5,h:19},{c:7881,x0:156,y0:477,xpad:.253906,sc:.625,w:5,h:17},{c:7882,x0:234,y0:388,yoffs:3,xpad:.708008,sc:.625,w:5,h:18},{c:7883,x0:447,y0:265,yoffs:2,xpad:.253906,sc:.625,w:5,h:19},{c:7884,x0:250,y0:388,yoffs:3,xpad:.31543,sc:.625,w:13,h:18},{c:7885,x0:868,y0:651,yoffs:6,sc:.625,w:11,h:15},{c:7886,x0:463,y0:265,yoffs:-2,xpad:.31543,sc:.625,w:13,h:19},{c:7887,x0:172,y0:477,sc:.625,w:11,h:17},{c:7888,x0:487,y0:265,yoffs:-2,xpad:.31543,sc:.625,w:13,h:19},{c:7889,x0:194,y0:476,sc:.625,w:11,h:17},{c:7890,x0:511,y0:265,yoffs:-2,xpad:.31543,sc:.625,w:13,h:19},{c:7891,x0:216,y0:476,sc:.625,w:11,h:17},{c:7892,x0:535,y0:265,yoffs:-2,xpad:.31543,sc:.625,w:13,h:19},{c:7893,x0:238,y0:476,sc:.625,w:11,h:17},{c:7894,x0:553,y0:204,yoffs:-3,xpad:.31543,sc:.625,w:13,h:20},{c:7895,x0:274,y0:387,yoffs:-1,sc:.625,w:11,h:18},{c:7896,x0:736,y0:168,yoffs:-1,xpad:.31543,sc:.625,w:13,h:22},{c:7897,x0:577,y0:203,yoffs:1,sc:.625,w:11,h:20},{c:7898,x0:559,y0:265,yoffs:-2,xpad:.31543,sc:.625,w:13,h:19},{c:7899,x0:260,y0:473,sc:.625,w:11,h:17},{c:7900,x0:583,y0:265,yoffs:-2,xpad:.31543,sc:.625,w:13,h:19},{c:7901,x0:282,y0:473,sc:.625,w:11,h:17},{c:7902,x0:607,y0:263,yoffs:-2,xpad:.31543,sc:.625,w:13,h:19},{c:7903,x0:304,y0:473,sc:.625,w:11,h:17},{c:7904,x0:296,y0:387,yoffs:-1,xpad:.31543,sc:.625,w:13,h:18},{c:7905,x0:96,y0:560,yoffs:1,sc:.625,w:11,h:16},{c:7906,x0:897,y0:168,xpad:.31543,sc:.625,w:13,h:21},{c:7907,x0:631,y0:263,yoffs:2,sc:.625,w:11,h:19},{c:7908,x0:320,y0:387,yoffs:3,xpad:.93457,sc:.625,w:12,h:18},{c:7909,x0:890,y0:650,yoffs:6,xpad:1.01563,sc:.625,w:10,h:15},{c:7910,x0:653,y0:263,yoffs:-2,xpad:.93457,sc:.625,w:12,h:19},{c:7911,x0:326,y0:472,xpad:1.01563,sc:.625,w:10,h:17},{c:7912,x0:676,y0:263,yoffs:-2,sc:.625,w:14,h:19},{c:7913,x0:347,y0:472,sc:.625,w:12,h:17},{c:7914,x0:701,y0:262,yoffs:-2,sc:.625,w:14,h:19},{c:7915,x0:370,y0:472,sc:.625,w:12,h:17},{c:7916,x0:726,y0:262,yoffs:-2,sc:.625,w:14,h:19},{c:7917,x0:393,y0:470,sc:.625,w:12,h:17},{c:7918,x0:343,y0:387,yoffs:-1,sc:.625,w:14,h:18},{c:7919,x0:118,y0:560,yoffs:1,sc:.625,w:12,h:16},{c:7920,x0:760,y0:168,yoffs:-1,sc:.625,w:14,h:22},{c:7921,x0:751,y0:261,yoffs:2,sc:.625,w:12,h:19},{c:7922,x0:368,y0:385,yoffs:-1,sc:.625,w:9,h:18},{c:7923,x0:774,y0:261,yoffs:1,sc:.625,w:8,h:19},{c:7924,x0:388,y0:383,yoffs:3,sc:.625,w:12,h:18},{c:7925,x0:911,y0:650,yoffs:6,sc:.625,w:10,h:15},{c:7926,x0:793,y0:261,yoffs:-2,sc:.625,w:12,h:19},{c:7927,x0:921,y0:168,sc:.625,w:10,h:21},{c:7928,x0:411,y0:383,yoffs:-1,sc:.625,w:12,h:18},{c:7929,x0:599,y0:202,yoffs:1,sc:.625,w:10,h:20},{c:7930,x0:502,y0:813,yoffs:3,xpad:.415039,sc:.625,w:15,h:14},{c:7931,x0:932,y0:650,yoffs:2,sc:.625,w:11,h:15},{c:7932,x0:528,y0:811,yoffs:3,xpad:.408203,sc:.625,w:13,h:14},{c:7933,x0:954,y0:649,yoffs:2,sc:.625,w:11,h:15},{c:7934,x0:552,y0:811,yoffs:3,sc:.625,w:12,h:14},{c:7935,x0:976,y0:649,yoffs:6,sc:.625,w:12,h:15},{c:8192,xpad:8.95996,sc:.625},{c:8193,xpad:17.9248,sc:.625},{c:8194,xpad:8.64746,sc:.625},{c:8195,xpad:17.2949,sc:.625},{c:8196,xpad:5.9668,sc:.625},{c:8197,xpad:4.47754,sc:.625},{c:8198,xpad:2.99316,sc:.625},{c:8199,xpad:10.2539,sc:.625},{c:8200,xpad:5.10742,sc:.625},{c:8201,xpad:3.58398,sc:.625},{c:8202,xpad:1.79199,sc:.625},{c:8203,sc:.625},{c:8208,x0:961,y0:1011,yoffs:9,xpad:6.29492,sc:.625,w:11,h:2},{c:8209,x0:421,y0:1015,yoffs:10,xpad:.396484,sc:.625,w:6,h:3},{c:8210,x0:757,y0:1014,yoffs:10,xpad:.423828,sc:.625,w:9,h:3},{c:8211,x0:777,y0:1014,yoffs:9,sc:.625,w:8,h:3},{c:8212,x0:796,y0:1014,yoffs:9,sc:.625,w:15,h:3},{c:8213,x0:796,y0:1014,yoffs:9,sc:.625,w:15,h:3},{c:8214,x0:816,y0:260,xpad:6.29492,sc:.625,w:11,h:19},{c:8215,x0:214,y0:1e3,yoffs:16,sc:.625,w:9,h:5},{c:8216,x0:234,y0:1e3,yoffs:2,xpad:.116211,sc:.625,w:4,h:5},{c:8217,x0:249,y0:1e3,yoffs:2,xpad:.116211,sc:.625,w:4,h:5},{c:8218,x0:264,y0:1e3,yoffs:14,xpad:1.11621,sc:.625,w:3,h:5},{c:8219,x0:278,y0:1e3,yoffs:3,sc:.625,w:4,h:5},{c:8220,x0:293,y0:1e3,yoffs:2,xpad:.236328,sc:.625,w:7,h:5},{c:8221,x0:311,y0:1e3,yoffs:2,xpad:.22168,sc:.625,w:7,h:5},{c:8222,x0:329,y0:1e3,yoffs:14,xpad:.22168,sc:.625,w:7,h:5},{c:8223,x0:347,y0:1e3,yoffs:3,sc:.625,w:8,h:5},{c:8224,x0:141,y0:560,yoffs:3,xpad:.0898438,sc:.625,w:7,h:16},{c:8225,x0:159,y0:560,yoffs:3,xpad:.0898438,sc:.625,w:7,h:16},{c:8226,x0:366,y0:1e3,yoffs:7,xpad:.0546875,sc:.625,w:6,h:5},{c:8227,x0:483,y0:976,yoffs:6,sc:.625,w:7,h:7},{c:8228,x0:541,y0:1010,yoffs:13,xpad:1.95996,sc:.625,w:7,h:4},{c:8229,x0:559,y0:1010,yoffs:8,xpad:2.29492,sc:.625,w:15,h:4},{c:8230,x0:822,y0:1013,yoffs:14,xpad:1.08789,sc:.625,w:14,h:3},{c:8231,x0:585,y0:1010,yoffs:8,xpad:6.29492,sc:.625,w:11,h:4},{c:8232,xpad:10.752,sc:.625},{c:8233,xpad:10.752,sc:.625},{c:8239,xpad:3.58398,sc:.625},{c:8240,x0:575,y0:811,yoffs:3,sc:.625,w:17,h:14},{c:8241,x0:603,y0:809,yoffs:3,sc:.625,w:30,h:14},{c:8242,x0:501,y0:976,yoffs:2,xpad:.620117,sc:.625,w:5,h:7},{c:8243,x0:517,y0:976,yoffs:2,xpad:.941406,sc:.625,w:9,h:7},{c:8244,x0:762,y0:968,yoffs:3,sc:.625,w:14,h:6},{c:8245,x0:607,y0:1008,yoffs:-1,xpad:6.29492,sc:.625,w:11,h:4},{c:8246,x0:787,y0:967,yoffs:3,xpad:1.52344,sc:.625,w:10,h:6},{c:8247,x0:808,y0:967,yoffs:3,xpad:1.48828,sc:.625,w:14,h:6},{c:8248,x0:537,y0:976,yoffs:14,xpad:.167969,sc:.625,w:7,h:7},{c:8249,x0:850,y0:946,yoffs:6,sc:.625,w:5,h:10},{c:8250,x0:866,y0:944,yoffs:6,sc:.625,w:5,h:10},{c:8251,x0:493,y0:864,yoffs:3,xpad:2.29492,sc:.625,w:15,h:13},{c:8252,x0:644,y0:809,yoffs:3,xpad:.708984,sc:.625,w:11,h:14},{c:8253,x0:666,y0:808,yoffs:3,sc:.625,w:9,h:14},{c:8254,x0:847,y0:1013,sc:.625,w:11,h:3},{c:8255,x0:383,y0:1e3,yoffs:16,sc:.625,w:11,h:5},{c:8256,x0:629,y0:1006,yoffs:2,sc:.625,w:11,h:4},{c:8257,x0:67,y0:892,yoffs:9,sc:.625,w:8,h:12},{c:8258,x0:999,y0:649,yoffs:2,xpad:1.29492,sc:.625,w:16,h:15},{c:8259,x0:869,y0:1013,yoffs:10,sc:.625,w:6,h:3},{c:8260,x0:686,y0:807,yoffs:3,sc:.625,w:8,h:14},{c:8261,x0:416,y0:468,yoffs:3,sc:.625,w:6,h:17},{c:8262,x0:433,y0:468,yoffs:3,xpad:.932617,sc:.625,w:5,h:17},{c:8263,x0:5,y0:692,yoffs:2,xpad:.826172,sc:.625,w:16,h:15},{c:8264,x0:32,y0:692,yoffs:2,xpad:1.35547,sc:.625,w:13,h:15},{c:8265,x0:56,y0:692,yoffs:2,xpad:.355469,sc:.625,w:14,h:15},{c:8266,x0:564,y0:953,yoffs:6,xpad:.751953,sc:.625,w:10,h:11},{c:8267,x0:449,y0:468,yoffs:2,xpad:.738281,sc:.625,w:11,h:17},{c:8268,x0:882,y0:944,yoffs:6,xpad:.738281,sc:.625,w:11,h:10},{c:8269,x0:904,y0:944,yoffs:6,xpad:.738281,sc:.625,w:11,h:10},{c:8270,x0:95,y0:981,yoffs:11,sc:.625,w:10,h:9},{c:8271,x0:519,y0:863,yoffs:6,xpad:.107422,sc:.625,w:5,h:13},{c:8272,x0:838,y0:260,yoffs:2,sc:.625,w:11,h:19},{c:8273,x0:81,y0:692,yoffs:2,xpad:5.29492,sc:.625,w:12,h:15},{c:8274,x0:705,y0:807,yoffs:3,sc:.625,w:8,h:14},{c:8275,x0:651,y0:1005,yoffs:9,sc:.625,w:18,h:4},{c:8276,x0:405,y0:999,yoffs:16,sc:.625,w:11,h:5},{c:8277,x0:926,y0:944,yoffs:7,xpad:.0390625,sc:.625,w:10,h:10},{c:8278,x0:724,y0:806,yoffs:3,xpad:.375977,sc:.625,w:10,h:14},{c:8279,x0:833,y0:967,yoffs:3,xpad:1.33496,sc:.625,w:17,h:6},{c:8280,x0:745,y0:806,yoffs:3,xpad:.649414,sc:.625,w:15,h:14},{c:8281,x0:771,y0:806,yoffs:3,xpad:.649414,sc:.625,w:15,h:14},{c:8282,x0:797,y0:804,yoffs:3,xpad:.107422,sc:.625,w:5,h:14},{c:8283,x0:104,y0:692,yoffs:2,xpad:.421875,sc:.625,w:12,h:15},{c:8284,x0:127,y0:692,yoffs:2,xpad:.288086,sc:.625,w:15,h:15},{c:8285,x0:153,y0:692,yoffs:2,xpad:.107422,sc:.625,w:5,h:15},{c:8286,x0:813,y0:804,yoffs:3,xpad:.107422,sc:.625,w:5,h:14},{c:8287,xpad:10.752,sc:.625},{c:8288,xpad:10.752,sc:.625},{c:8289,xpad:10.752,sc:.625},{c:8290,xpad:10.752,sc:.625},{c:8291,xpad:10.752,sc:.625},{c:8292,xpad:10.752,sc:.625},{c:8294,sc:.625},{c:8295,sc:.625},{c:8296,sc:.625},{c:8297,sc:.625},{c:8304,x0:292,y0:981,yoffs:3,xpad:.170898,sc:.625,w:5,h:8},{c:8305,x0:680,y0:1005,yoffs:8,xpad:1.54492,sc:.625,w:2,h:4},{c:8308,x0:308,y0:981,yoffs:3,xpad:.170898,sc:.625,w:5,h:8},{c:8309,x0:324,y0:981,yoffs:3,xpad:.170898,sc:.625,w:5,h:8},{c:8310,x0:340,y0:981,yoffs:3,xpad:.170898,sc:.625,w:5,h:8},{c:8311,x0:356,y0:981,yoffs:3,xpad:.170898,sc:.625,w:5,h:8},{c:8312,x0:372,y0:981,yoffs:3,xpad:.170898,sc:.625,w:5,h:8},{c:8313,x0:388,y0:980,yoffs:3,xpad:.170898,sc:.625,w:5,h:8},{c:8314,x0:861,y0:967,yoffs:5,xpad:.435547,sc:.625,w:6,h:6},{c:8315,x0:983,y0:1011,yoffs:7,xpad:.435547,sc:.625,w:6,h:2},{c:8316,x0:693,y0:1003,yoffs:6,xpad:.435547,sc:.625,w:6,h:4},{c:8317,x0:585,y0:953,yoffs:2,xpad:.335938,sc:.625,w:4,h:11},{c:8318,x0:600,y0:951,yoffs:2,xpad:.335938,sc:.625,w:4,h:11},{c:8319,x0:886,y0:1011,yoffs:9,xpad:2.65137,sc:.625,w:5,h:3},{c:8320,x0:116,y0:981,yoffs:8,xpad:.170898,sc:.625,w:5,h:9},{c:8321,x0:404,y0:980,yoffs:9,xpad:1.1709,sc:.625,w:4,h:8},{c:8322,x0:132,y0:981,yoffs:8,xpad:.170898,sc:.625,w:5,h:9},{c:8323,x0:148,y0:981,yoffs:8,xpad:.170898,sc:.625,w:5,h:9},{c:8324,x0:419,y0:980,yoffs:9,xpad:.170898,sc:.625,w:5,h:8},{c:8325,x0:435,y0:976,yoffs:9,xpad:.170898,sc:.625,w:5,h:8},{c:8326,x0:164,y0:981,yoffs:8,xpad:.170898,sc:.625,w:5,h:9},{c:8327,x0:451,y0:976,yoffs:9,xpad:.170898,sc:.625,w:5,h:8},{c:8328,x0:180,y0:981,yoffs:8,xpad:.170898,sc:.625,w:5,h:9},{c:8329,x0:196,y0:981,yoffs:8,xpad:.170898,sc:.625,w:5,h:9},{c:8330,x0:878,y0:965,yoffs:13,xpad:.435547,sc:.625,w:6,h:6},{c:8331,x0:1e3,y0:1009,yoffs:15,xpad:.435547,sc:.625,w:6,h:2},{c:8332,x0:427,y0:999,yoffs:13,xpad:.435547,sc:.625,w:6,h:5},{c:8333,x0:615,y0:951,yoffs:9,xpad:.335938,sc:.625,w:4,h:11},{c:8334,x0:630,y0:951,yoffs:9,xpad:.335938,sc:.625,w:4,h:11},{c:8336,x0:444,y0:995,yoffs:13,xpad:3.04102,sc:.625,w:4,h:5},{c:8337,x0:459,y0:995,yoffs:13,xpad:1.87988,sc:.625,w:5,h:5},{c:8338,x0:475,y0:994,yoffs:13,xpad:2.20215,sc:.625,w:5,h:5},{c:8339,x0:491,y0:994,yoffs:13,xpad:1.73828,sc:.625,w:5,h:5},{c:8340,x0:507,y0:994,yoffs:13,xpad:1.87988,sc:.625,w:5,h:5},{c:8341,x0:895,y0:965,yoffs:12,xpad:2.65137,sc:.625,w:5,h:6},{c:8342,x0:911,y0:965,yoffs:12,xpad:2.22168,sc:.625,w:5,h:6},{c:8343,x0:927,y0:965,yoffs:12,xpad:1.54492,sc:.625,w:2,h:6},{c:8344,x0:523,y0:994,yoffs:13,xpad:4.43555,sc:.625,w:7,h:5},{c:8345,x0:541,y0:994,yoffs:13,xpad:2.65137,sc:.625,w:5,h:5},{c:8346,x0:940,y0:965,yoffs:13,xpad:2.36328,sc:.625,w:5,h:6},{c:8347,x0:557,y0:994,yoffs:13,xpad:1.78613,sc:.625,w:4,h:5},{c:8348,x0:956,y0:965,yoffs:12,xpad:1.05371,sc:.625,w:4,h:6},{c:8352,x0:829,y0:804,yoffs:3,xpad:.253906,sc:.625,w:10,h:14},{c:8353,x0:177,y0:560,yoffs:2,sc:.625,w:11,h:16},{c:8354,x0:850,y0:804,yoffs:3,xpad:.253906,sc:.625,w:10,h:14},{c:8355,x0:871,y0:804,yoffs:3,xpad:.253906,sc:.625,w:10,h:14},{c:8356,x0:892,y0:804,yoffs:3,xpad:.253906,sc:.625,w:10,h:14},{c:8357,x0:169,y0:692,yoffs:4,xpad:.602539,sc:.625,w:17,h:15},{c:8358,x0:913,y0:803,yoffs:3,sc:.625,w:11,h:14},{c:8359,x0:935,y0:803,yoffs:3,sc:.625,w:16,h:14},{c:8360,x0:962,y0:802,yoffs:3,xpad:.420898,sc:.625,w:16,h:14},{c:8361,x0:989,y0:802,yoffs:3,sc:.625,w:12,h:14},{c:8362,x0:5,y0:843,yoffs:3,xpad:1.47461,sc:.625,w:15,h:14},{c:8363,x0:31,y0:843,yoffs:3,xpad:.185547,sc:.625,w:10,h:14},{c:8364,x0:52,y0:843,yoffs:3,sc:.625,w:8,h:14},{c:8365,x0:71,y0:843,yoffs:3,sc:.625,w:11,h:14},{c:8366,x0:93,y0:843,yoffs:3,sc:.625,w:8,h:14},{c:8367,x0:434,y0:383,yoffs:3,xpad:.105469,sc:.625,w:18,h:18},{c:8368,x0:463,y0:383,yoffs:3,xpad:.932617,sc:.625,w:10,h:18},{c:8369,x0:112,y0:843,yoffs:3,sc:.625,w:11,h:14},{c:8370,x0:199,y0:560,yoffs:2,xpad:1.1543,sc:.625,w:12,h:16},{c:8371,x0:134,y0:843,yoffs:3,sc:.625,w:12,h:14},{c:8372,x0:157,y0:843,yoffs:3,sc:.625,w:8,h:14},{c:8373,x0:222,y0:559,yoffs:2,xpad:.416016,sc:.625,w:11,h:16},{c:8374,x0:535,y0:863,yoffs:4,xpad:.475586,sc:.625,w:12,h:13},{c:8375,x0:197,y0:692,yoffs:3,xpad:.100586,sc:.625,w:13,h:15},{c:8376,x0:176,y0:843,yoffs:3,sc:.625,w:11,h:14},{c:8377,x0:198,y0:843,yoffs:3,sc:.625,w:9,h:14},{c:8378,x0:218,y0:843,yoffs:3,xpad:.253906,sc:.625,w:10,h:14},{c:8379,x0:239,y0:843,yoffs:3,sc:.625,w:15,h:14},{c:8380,x0:265,y0:843,yoffs:3,xpad:.664063,sc:.625,w:15,h:14},{c:8381,x0:291,y0:843,yoffs:3,sc:.625,w:11,h:14},{c:8382,x0:244,y0:559,yoffs:1,xpad:.274414,sc:.625,w:11,h:16},{c:8383,x0:471,y0:468,yoffs:1,xpad:.253906,sc:.625,w:10,h:17},{c:8482,x0:555,y0:976,yoffs:3,xpad:.577148,sc:.625,w:11,h:7},{c:8592,x0:597,y0:94,yoffs:4,w:22,h:23},{c:8593,x0:77,y0:179,yoffs:5,w:23,h:21},{c:8594,x0:636,y0:94,yoffs:4,w:22,h:23},{c:8595,x0:117,y0:178,yoffs:5,w:23,h:21},{c:8734,x0:623,y0:205,yoffs:11,xpad:.6875,w:25,h:14},{c:9654,x0:86,y0:892,yoffs:4,sc:.625,w:11,h:12},{c:9660,x0:645,y0:951,yoffs:4,sc:.625,w:12,h:11},{c:9733,x0:266,y0:559,yoffs:2,xpad:.294922,sc:.625,w:17,h:16},{c:9742,x0:928,y0:53,yoffs:4,w:31,h:24},{c:9743,x0:976,y0:53,yoffs:4,w:31,h:24},{c:9830,x0:8,y0:55,yoffs:2,w:17,h:28},{c:9889,x0:263,y0:55,yoffs:3,w:20,h:26},{c:12353,x0:313,y0:843,yoffs:4,xpad:2.29492,sc:.625,w:15,h:14},{c:12354,x0:294,y0:556,yoffs:2,xpad:1.29492,sc:.625,w:16,h:16},{c:12355,x0:668,y0:949,yoffs:6,xpad:1.29492,sc:.625,w:16,h:11},{c:12356,x0:339,y0:842,yoffs:3,xpad:.294922,sc:.625,w:17,h:14},{c:12357,x0:367,y0:842,yoffs:4,xpad:3.29492,sc:.625,w:14,h:14},{c:12358,x0:321,y0:556,yoffs:2,xpad:2.29492,sc:.625,w:15,h:16},{c:12359,x0:392,y0:839,yoffs:4,xpad:2.29492,sc:.625,w:15,h:14},{c:12360,x0:347,y0:555,yoffs:2,xpad:1.29492,sc:.625,w:16,h:16},{c:12361,x0:558,y0:861,yoffs:5,xpad:1.29492,sc:.625,w:16,h:13},{c:12362,x0:221,y0:692,yoffs:2,xpad:.294922,sc:.625,w:17,h:15},{c:12363,x0:249,y0:692,yoffs:2,xpad:.294922,sc:.625,w:17,h:15},{c:12364,x0:492,y0:468,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:12365,x0:374,y0:555,yoffs:2,xpad:1.29492,sc:.625,w:16,h:16},{c:12366,x0:520,y0:467,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:12367,x0:401,y0:553,yoffs:2,xpad:3.29492,sc:.625,w:14,h:16},{c:12368,x0:426,y0:553,yoffs:2,xpad:1.29492,sc:.625,w:16,h:16},{c:12369,x0:453,y0:551,yoffs:2,xpad:1.29492,sc:.625,w:16,h:16},{c:12370,x0:548,y0:467,yoffs:1,sc:.625,w:18,h:17},{c:12371,x0:418,y0:839,yoffs:3,xpad:2.29492,sc:.625,w:15,h:14},{c:12372,x0:577,y0:466,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:12373,x0:480,y0:551,yoffs:2,xpad:2.29492,sc:.625,w:15,h:16},{c:12374,x0:605,y0:466,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:12375,x0:506,y0:551,yoffs:2,xpad:1.29492,sc:.625,w:16,h:16},{c:12376,x0:533,y0:550,yoffs:2,xpad:1.29492,sc:.625,w:16,h:16},{c:12377,x0:560,y0:549,yoffs:2,xpad:.294922,sc:.625,w:17,h:16},{c:12378,x0:633,y0:466,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:12379,x0:277,y0:691,yoffs:2,xpad:1.29492,sc:.625,w:16,h:15},{c:12380,x0:588,y0:548,yoffs:2,xpad:.294922,sc:.625,w:17,h:16},{c:12381,x0:616,y0:548,yoffs:2,xpad:1.29492,sc:.625,w:16,h:16},{c:12382,x0:643,y0:548,yoffs:2,xpad:1.29492,sc:.625,w:16,h:16},{c:12383,x0:304,y0:691,yoffs:2,xpad:1.29492,sc:.625,w:16,h:15},{c:12384,x0:670,y0:548,yoffs:2,xpad:.294922,sc:.625,w:17,h:16},{c:12385,x0:698,y0:546,yoffs:2,xpad:2.29492,sc:.625,w:15,h:16},{c:12386,x0:661,y0:466,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:12387,x0:947,y0:944,yoffs:7,xpad:1.29492,sc:.625,w:16,h:10},{c:12388,x0:585,y0:861,yoffs:4,xpad:1.29492,sc:.625,w:16,h:13},{c:12389,x0:724,y0:546,yoffs:1,xpad:.294922,sc:.625,w:17,h:16},{c:12390,x0:444,y0:839,yoffs:3,xpad:1.29492,sc:.625,w:16,h:14},{c:12391,x0:471,y0:839,yoffs:3,xpad:.294922,sc:.625,w:17,h:14},{c:12392,x0:331,y0:688,yoffs:2,xpad:2.29492,sc:.625,w:15,h:15},{c:12393,x0:689,y0:464,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:12394,x0:752,y0:546,yoffs:2,xpad:.294922,sc:.625,w:17,h:16},{c:12395,x0:357,y0:688,yoffs:2,xpad:1.29492,sc:.625,w:16,h:15},{c:12396,x0:384,y0:688,yoffs:2,xpad:.294922,sc:.625,w:17,h:15},{c:12397,x0:412,y0:687,yoffs:2,xpad:.294922,sc:.625,w:17,h:15},{c:12398,x0:499,y0:838,yoffs:3,xpad:1.29492,sc:.625,w:16,h:14},{c:12399,x0:440,y0:687,yoffs:2,xpad:.294922,sc:.625,w:17,h:15},{c:12400,x0:717,y0:464,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:12401,x0:745,y0:463,yoffs:1,sc:.625,w:18,h:17},{c:12402,x0:468,y0:685,yoffs:3,xpad:.294922,sc:.625,w:17,h:15},{c:12403,x0:774,y0:463,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:12404,x0:802,y0:462,yoffs:1,sc:.625,w:18,h:17},{c:12405,x0:496,y0:685,yoffs:2,xpad:.294922,sc:.625,w:17,h:15},{c:12406,x0:780,y0:545,yoffs:2,xpad:.294922,sc:.625,w:17,h:16},{c:12407,x0:808,y0:545,yoffs:2,xpad:.294922,sc:.625,w:17,h:16},{c:12408,x0:108,y0:892,yoffs:4,xpad:.294922,sc:.625,w:17,h:12},{c:12409,x0:526,y0:838,yoffs:3,xpad:.294922,sc:.625,w:17,h:14},{c:12410,x0:554,y0:836,yoffs:3,xpad:.294922,sc:.625,w:17,h:14},{c:12411,x0:524,y0:683,yoffs:2,xpad:.294922,sc:.625,w:17,h:15},{c:12412,x0:831,y0:462,yoffs:1,sc:.625,w:18,h:17},{c:12413,x0:860,y0:462,yoffs:1,sc:.625,w:18,h:17},{c:12414,x0:836,y0:544,yoffs:2,xpad:1.29492,sc:.625,w:16,h:16},{c:12415,x0:863,y0:544,yoffs:2,xpad:.294922,sc:.625,w:17,h:16},{c:12416,x0:891,y0:544,yoffs:2,xpad:.294922,sc:.625,w:17,h:16},{c:12417,x0:919,y0:543,yoffs:2,xpad:1.29492,sc:.625,w:16,h:16},{c:12418,x0:946,y0:543,yoffs:2,xpad:1.29492,sc:.625,w:16,h:16},{c:12419,x0:582,y0:836,yoffs:4,xpad:2.29492,sc:.625,w:15,h:14},{c:12420,x0:889,y0:461,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:12421,x0:612,y0:859,yoffs:5,xpad:2.29492,sc:.625,w:15,h:13},{c:12422,x0:973,y0:543,yoffs:2,xpad:1.29492,sc:.625,w:16,h:16},{c:12423,x0:638,y0:859,yoffs:5,xpad:3.29492,sc:.625,w:14,h:13},{c:12424,x0:1e3,y0:542,yoffs:2,xpad:1.29492,sc:.625,w:16,h:16},{c:12425,x0:5,y0:587,yoffs:2,xpad:1.29492,sc:.625,w:16,h:16},{c:12426,x0:32,y0:587,yoffs:2,xpad:2.29492,sc:.625,w:15,h:16},{c:12427,x0:58,y0:587,yoffs:2,xpad:1.29492,sc:.625,w:16,h:16},{c:12428,x0:552,y0:683,yoffs:2,xpad:.294922,sc:.625,w:17,h:15},{c:12429,x0:85,y0:587,yoffs:2,xpad:1.29492,sc:.625,w:16,h:16},{c:12430,x0:663,y0:859,yoffs:4,xpad:1.29492,sc:.625,w:16,h:13},{c:12431,x0:580,y0:683,yoffs:2,xpad:.294922,sc:.625,w:17,h:15},{c:12432,x0:112,y0:587,yoffs:2,xpad:1.29492,sc:.625,w:16,h:16},{c:12433,x0:139,y0:587,yoffs:2,xpad:.294922,sc:.625,w:17,h:16},{c:12434,x0:167,y0:587,yoffs:2,xpad:1.29492,sc:.625,w:16,h:16},{c:12435,x0:194,y0:587,yoffs:2,xpad:.294922,sc:.625,w:17,h:16},{c:12436,x0:222,y0:586,yoffs:2,xpad:.294922,sc:.625,w:17,h:16},{c:12437,x0:690,y0:857,yoffs:5,xpad:1.29492,sc:.625,w:16,h:13},{c:12438,x0:717,y0:857,yoffs:5,xpad:1.29492,sc:.625,w:16,h:13},{c:12441,x0:572,y0:994,yoffs:1,xpad:11.2949,sc:.625,w:6,h:5},{c:12442,x0:971,y0:965,yoffs:1,xpad:12.2949,sc:.625,w:5,h:6},{c:12443,x0:572,y0:994,yoffs:1,xpad:11.2949,sc:.625,w:6,h:5},{c:12444,x0:971,y0:965,yoffs:1,xpad:12.2949,sc:.625,w:5,h:6},{c:12445,x0:136,y0:892,yoffs:4,xpad:3.29492,sc:.625,w:14,h:12},{c:12446,x0:744,y0:856,yoffs:3,xpad:2.29492,sc:.625,w:15,h:13},{c:12447,x0:917,y0:461,yoffs:1,xpad:1.29492,sc:.625,w:16,h:17},{c:12448,x0:589,y0:992,yoffs:7,xpad:4.29492,sc:.625,w:13,h:5},{c:12449,x0:161,y0:892,yoffs:6,xpad:1.29492,sc:.625,w:16,h:12},{c:12450,x0:608,y0:682,yoffs:3,xpad:.294922,sc:.625,w:17,h:15},{c:12451,x0:770,y0:856,yoffs:5,xpad:2.29492,sc:.625,w:15,h:13},{c:12452,x0:636,y0:681,yoffs:2,xpad:1.29492,sc:.625,w:16,h:15},{c:12453,x0:796,y0:856,yoffs:5,xpad:2.29492,sc:.625,w:15,h:13},{c:12454,x0:250,y0:586,yoffs:2,xpad:1.29492,sc:.625,w:16,h:16},{c:12455,x0:695,y0:949,yoffs:6,xpad:2.29492,sc:.625,w:15,h:11},{c:12456,x0:188,y0:892,yoffs:4,xpad:1.29492,sc:.625,w:16,h:12},{c:12457,x0:822,y0:854,yoffs:5,xpad:1.29492,sc:.625,w:16,h:13},{c:12458,x0:663,y0:680,yoffs:2,xpad:1.29492,sc:.625,w:16,h:15},{c:12459,x0:690,y0:680,yoffs:2,xpad:1.29492,sc:.625,w:16,h:15},{c:12460,x0:944,y0:461,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:12461,x0:277,y0:586,yoffs:2,xpad:1.29492,sc:.625,w:16,h:16},{c:12462,x0:972,y0:460,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:12463,x0:1e3,y0:460,yoffs:1,xpad:1.29492,sc:.625,w:16,h:17},{c:12464,x0:5,y0:505,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:12465,x0:304,y0:583,yoffs:2,xpad:1.29492,sc:.625,w:16,h:16},{c:12466,x0:33,y0:505,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:12467,x0:608,y0:834,yoffs:3,xpad:1.29492,sc:.625,w:16,h:14},{c:12468,x0:61,y0:505,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:12469,x0:331,y0:583,yoffs:2,xpad:.294922,sc:.625,w:17,h:16},{c:12470,x0:359,y0:582,yoffs:2,xpad:.294922,sc:.625,w:17,h:16},{c:12471,x0:387,y0:582,yoffs:2,xpad:.294922,sc:.625,w:17,h:16},{c:12472,x0:415,y0:580,yoffs:2,xpad:.294922,sc:.625,w:17,h:16},{c:12473,x0:635,y0:834,yoffs:3,xpad:1.29492,sc:.625,w:16,h:14},{c:12474,x0:89,y0:505,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:12475,x0:717,y0:680,yoffs:2,xpad:1.29492,sc:.625,w:16,h:15},{c:12476,x0:117,y0:505,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:12477,x0:662,y0:834,yoffs:3,xpad:1.29492,sc:.625,w:16,h:14},{c:12478,x0:145,y0:505,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:12479,x0:173,y0:505,yoffs:1,xpad:1.29492,sc:.625,w:16,h:17},{c:12480,x0:200,y0:504,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:12481,x0:443,y0:580,yoffs:2,xpad:.294922,sc:.625,w:17,h:16},{c:12482,x0:471,y0:578,yoffs:2,xpad:.294922,sc:.625,w:17,h:16},{c:12483,x0:849,y0:854,yoffs:5,xpad:1.29492,sc:.625,w:16,h:13},{c:12484,x0:499,y0:578,yoffs:2,xpad:.294922,sc:.625,w:17,h:16},{c:12485,x0:228,y0:504,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:12486,x0:527,y0:578,yoffs:2,xpad:.294922,sc:.625,w:17,h:16},{c:12487,x0:256,y0:504,yoffs:1,sc:.625,w:18,h:17},{c:12488,x0:744,y0:680,yoffs:2,xpad:1.29492,sc:.625,w:16,h:15},{c:12489,x0:555,y0:577,yoffs:2,xpad:1.29492,sc:.625,w:16,h:16},{c:12490,x0:582,y0:576,yoffs:2,xpad:.294922,sc:.625,w:17,h:16},{c:12491,x0:215,y0:892,yoffs:4,xpad:1.29492,sc:.625,w:16,h:12},{c:12492,x0:771,y0:678,yoffs:3,xpad:2.29492,sc:.625,w:15,h:15},{c:12493,x0:610,y0:575,yoffs:2,xpad:.294922,sc:.625,w:17,h:16},{c:12494,x0:797,y0:678,yoffs:2,xpad:2.29492,sc:.625,w:15,h:15},{c:12495,x0:689,y0:832,yoffs:3,xpad:.294922,sc:.625,w:17,h:14},{c:12496,x0:638,y0:575,yoffs:1,xpad:.294922,sc:.625,w:17,h:16},{c:12497,x0:666,y0:575,yoffs:1,xpad:.294922,sc:.625,w:17,h:16},{c:12498,x0:823,y0:678,yoffs:2,xpad:2.29492,sc:.625,w:15,h:15},{c:12499,x0:694,y0:575,yoffs:1,xpad:.294922,sc:.625,w:17,h:16},{c:12500,x0:722,y0:573,yoffs:1,xpad:.294922,sc:.625,w:17,h:16},{c:12501,x0:717,y0:832,yoffs:3,xpad:1.29492,sc:.625,w:16,h:14},{c:12502,x0:285,y0:501,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:12503,x0:313,y0:501,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:12504,x0:242,y0:892,yoffs:4,xpad:.294922,sc:.625,w:17,h:12},{c:12505,x0:744,y0:831,yoffs:3,xpad:.294922,sc:.625,w:17,h:14},{c:12506,x0:772,y0:831,yoffs:3,xpad:.294922,sc:.625,w:17,h:14},{c:12507,x0:750,y0:573,yoffs:2,xpad:.294922,sc:.625,w:17,h:16},{c:12508,x0:341,y0:500,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:12509,x0:369,y0:500,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:12510,x0:849,y0:677,yoffs:3,xpad:.294922,sc:.625,w:17,h:15},{c:12511,x0:778,y0:573,yoffs:2,xpad:2.29492,sc:.625,w:15,h:16},{c:12512,x0:877,y0:677,yoffs:2,xpad:.294922,sc:.625,w:17,h:15},{c:12513,x0:804,y0:572,yoffs:2,xpad:1.29492,sc:.625,w:16,h:16},{c:12514,x0:800,y0:829,yoffs:3,xpad:1.29492,sc:.625,w:16,h:14},{c:12515,x0:876,y0:854,yoffs:5,xpad:1.29492,sc:.625,w:16,h:13},{c:12516,x0:831,y0:572,yoffs:2,xpad:.294922,sc:.625,w:17,h:16},{c:12517,x0:974,y0:943,yoffs:7,xpad:2.29492,sc:.625,w:15,h:10},{c:12518,x0:270,y0:892,yoffs:4,xpad:.294922,sc:.625,w:17,h:12},{c:12519,x0:298,y0:892,yoffs:6,xpad:3.29492,sc:.625,w:14,h:12},{c:12520,x0:827,y0:829,yoffs:3,xpad:2.29492,sc:.625,w:15,h:14},{c:12521,x0:859,y0:571,yoffs:2,xpad:1.29492,sc:.625,w:16,h:16},{c:12522,x0:886,y0:571,yoffs:2,xpad:3.29492,sc:.625,w:14,h:16},{c:12523,x0:911,y0:571,yoffs:2,xpad:.294922,sc:.625,w:17,h:16},{c:12524,x0:853,y0:829,yoffs:3,xpad:.294922,sc:.625,w:17,h:14},{c:12525,x0:881,y0:829,yoffs:3,xpad:1.29492,sc:.625,w:16,h:14},{c:12526,x0:323,y0:892,yoffs:6,xpad:2.29492,sc:.625,w:15,h:12},{c:12527,x0:905,y0:676,yoffs:3,xpad:1.29492,sc:.625,w:16,h:15},{c:12528,x0:939,y0:570,yoffs:2,xpad:.294922,sc:.625,w:17,h:16},{c:12529,x0:903,y0:854,yoffs:3,xpad:.294922,sc:.625,w:17,h:13},{c:12530,x0:932,y0:676,yoffs:3,xpad:1.29492,sc:.625,w:16,h:15},{c:12531,x0:908,y0:829,yoffs:3,xpad:.294922,sc:.625,w:17,h:14},{c:12532,x0:397,y0:498,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:12533,x0:931,y0:854,yoffs:5,xpad:2.29492,sc:.625,w:15,h:13},{c:12534,x0:957,y0:853,yoffs:5,xpad:2.29492,sc:.625,w:15,h:13},{c:12535,x0:425,y0:496,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:12536,x0:453,y0:496,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:12537,x0:967,y0:570,yoffs:1,xpad:.294922,sc:.625,w:17,h:16},{c:12538,x0:481,y0:496,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:12539,x0:613,y0:990,yoffs:7,xpad:6.29492,sc:.625,w:11,h:5},{c:12540,x0:902,y0:1011,yoffs:8,xpad:1.29492,sc:.625,w:16,h:3},{c:12541,x0:1e3,y0:943,yoffs:5,xpad:3.29492,sc:.625,w:14,h:10},{c:12542,x0:349,y0:891,yoffs:3,xpad:2.29492,sc:.625,w:15,h:12},{c:12543,x0:995,y0:570,yoffs:2,xpad:3.29492,sc:.625,w:14,h:16},{c:65024,sc:.625},{c:65533,x0:936,y0:828,yoffs:3,sc:.625,w:13,h:14}]}},{}],91:[function(e,t,r){"use strict"
r.iapEnabled=iapEnabled
r.iapAnyProviderEnabled=iapAnyProviderEnabled
r.iapProductPrice=iapProductPrice
r.iapStartPurchase=iapStartPurchase
r.iapConsumePurchase=iapConsumePurchase
r.iapSyncPurchases=iapSyncPurchases
r.iapSetupProvider=iapSetupProvider
r.iapClearSetupProviders=iapClearSetupProviders
r.iapSetup=iapSetup
var a=e("assert")
var o=e("../../common/in_app_purchases/iap_common").IAP_PROVIDER_FAKE
var i=function(){function IapClientFake(){}var e=IapClientFake.prototype
e.getProvider=function getProvider(){return o}
e.enabled=function enabled(){return true}
e.getProductPrice=function getProductPrice(e){return{price:"0",currency:"USD"}}
e.startPurchase=function startPurchase(e,t,r){var a=Date.now()
var i=(""+a+Math.random()).replace(/[^0-9A-Za-z]/g,"")
r(null,{provider:o,product_id:e,purchase_id:i,validation_data:JSON.stringify({product_id:e,purchase_id:i,timestamp:a,developer_payload:t})})}
e.consumePurchase=function consumePurchase(e,t,r){if(r)r()}
e.syncPurchases=function syncPurchases(e){e(null,[])}
return IapClientFake}()
var n={}
function getClient(e){var t=n[e]
a(t)
return t}function iapEnabled(e){var t=n[e]
return t&&t.enabled()||false}function iapAnyProviderEnabled(){for(var e in n){var t=n[e]
if(t&&t.enabled())return e}return}function iapProductPrice(e,t){return getClient(e).getProductPrice(t)}function iapStartPurchase(e,t,r,a){getClient(e).startPurchase(t,r,a)}function iapConsumePurchase(e,t,r,a){getClient(e).consumePurchase(t,r,a)}function iapSyncPurchases(e,t){getClient(e).syncPurchases(t)}function iapSetupProvider(e){n[e.getProvider()]=e}function iapClearSetupProviders(){n={}}function iapSetup(e,t){if(void 0===t)t=false
e.forEach(iapSetupProvider)
if(t&&!n[o])n[o]=new i}},{"../../common/in_app_purchases/iap_common":199,assert:void 0}],92:[function(e,t,r){"use strict"
r.IapClientFacebookInstant=r.IAP_PROVIDER_FACEBOOK_INSTANT=void 0
var o=e("assert")
var a=e("../../glov/common/util")
var i=a.callEach
var n=a.errorString
var s=e("../../common/in_app_purchases/iap_common")
var l=s.ERR_IAP_USER_CANCELED
var c=s.ERR_NOT_AVAILABLE
var _="fbi"
r.IAP_PROVIDER_FACEBOOK_INSTANT=_
var u=function(){function IapClientFacebookInstant(){var t=this
this.is_enabled=false
this.catalog={}
this.on_setup_cbs=[]
if(!window.FBInstant||-1===FBInstant.getSupportedAPIs().indexOf("payments.purchaseAsync")){this.on_setup_cbs=void 0
return}FBInstant.payments.onReady(function(){FBInstant.payments.getCatalogAsync().then(function(e){if(e&&e.length){e.forEach(function(e){return t.catalog[e.productID]=e})
t.is_enabled=true}i(t.on_setup_cbs,t.on_setup_cbs=void 0)},function(e){i(t.on_setup_cbs,t.on_setup_cbs=void 0)})})}var e=IapClientFacebookInstant.prototype
e.onSetupComplete=function onSetupComplete(e){if(this.on_setup_cbs)this.on_setup_cbs.push(e)
else e()}
e.parseApiError=function parseApiError(e){return"USER_INPUT"===e.code?l:e.message||n(e)}
e.getProvider=function getProvider(){return _}
e.enabled=function enabled(){return this.is_enabled}
e.getProductPrice=function getProductPrice(e){var t=this.catalog[e]
return t&&{price:t.price,currency:t.priceCurrencyCode}}
e.startPurchase=function startPurchase(e,t,r){var a=this
if(!this.is_enabled)return void r(c)
FBInstant.payments.purchaseAsync({productID:e,developerPayload:t}).then(function(e){return r(null,{provider:_,product_id:e.productID,purchase_id:e.paymentID,validation_data:e.signedRequest,consume_purchase_data:e.purchaseToken})},function(e){return r(a.parseApiError(e))})}
e.consumePurchase=function consumePurchase(e,t,r){var a=this
o(this.is_enabled)
o(t)
var i=FBInstant.payments.consumePurchaseAsync(t)
if(r)i.then(function(){return r()},function(e){return r(a.parseApiError(e))})}
e.syncPurchases=function syncPurchases(t){var r=this
this.onSetupComplete(function(){if(!r.is_enabled)return void t(c)
FBInstant.payments.getPurchasesAsync().then(function(e){return t(null,(e||[]).map(function(e){return{provider:_,product_id:e.productID,purchase_id:e.paymentID,validation_data:e.signedRequest,consume_purchase_data:e.purchaseToken}}))},function(e){return t(r.parseApiError(e))})})}
return IapClientFacebookInstant}()
r.IapClientFacebookInstant=u},{"../../common/in_app_purchases/iap_common":199,"../../glov/common/util":330,assert:void 0}],93:[function(e,t,r){"use strict"
r.iapEnabled=iapEnabled
r.iapProductPrice=iapProductPrice
r.iapMakePurchase=iapMakePurchase
r.iapWorldsStartup=iapWorldsStartup
var o=e("assert")
var a=e("../../glov/client/client_config").PLATFORM_FBINSTANT
var i=e("../../glov/client/cmds").cmd_parse
var n=e("../../glov/client/net").netSubs
var s=e("../../glov/client/ui")
var l=e("../../glov/common/util").nop
var c=e("../../common/globals").FAKE_PURCHASES
var _=e("../../common/in_app_purchases/iap_common")
var u=_.ERR_IAP_USER_CANCELED
var d=_.IAP_PROVIDER_FAKE
var f=e("../analytics").logEvent
var v=e("../localization/localization").L
var h=e("../worlds_sound").playSound
var p=e("./iap_client")
var m=p.iapAnyProviderEnabled
var g=p.iapClearSetupProviders
var E=p.iapConsumePurchase
var y=p.iapEnabled
var T=p.iapProductPrice
var I=p.iapSetup
var S=p.iapStartPurchase
var A=p.iapSyncPurchases
var w=e("./iap_client_facebook_instant").IapClientFacebookInstant
function chooseProvider(e){return c?d:e||m()}function applyPurchase(r,a){if(!n().loggedIn()){a(v.ERR_FB_PURCHASE_NOT_LOGGED.toString())
return}var e=n().getMyUserChannel()
var t={provider:r.provider,validation_data:r.validation_data}
e.send("purchase_external",t,function(e,t){if(e){a(e)
return}o(t)
E(r.provider,r.purchase_id,r.consume_purchase_data,a)})}function iapEnabled(e){e=chooseProvider(e)
return Boolean(e&&y(e))}function iapProductPrice(e,t){return void 0===(t=chooseProvider(t))?void 0:T(t,e)}function iapMakePurchase(r,e,a){var i=e||l
if(!n().loggedIn())return void i(v.ERR_FB_PURCHASE_NOT_LOGGED.toString())
if(!(a=chooseProvider(a))||!y(a))return void i(v.ERR_FB_PURCHASE_NOT_READY.toString())
s.modalDialog({title:v.DLG_INITIALIZING_PURCHASE_TITLE,text:v.MSG_PLEASE_WAIT})
f("purchase_"+a,1,r,"show")
S(a,r,void 0,function(e,t){if(e){s.modalDialogClear()
if(e!==u)s.modalDialog({title:v.DLG_ERROR_TITLE,text:v.DLG_PURCHASE_FAILED_PROCESS_MSG.$({error:e}),buttons:{ok:null}})
i(e)
return}o(t)
f("purchase_"+a,1,r,"succ")
applyPurchase(t,function(e){s.modalDialogClear()
if(!e)h("purchase")
s.modalDialog({title:e?v.DLG_ERROR_TITLE:v.DLG_PURCHASE_SUCCESSFUL_TITLE,text:e?v.DLG_PURCHASE_FAILED_SYNC_MSG.$({error:e}):v.DLG_PURCHASE_SUCCESSFUL_MSG,buttons:{ok:null}})
i(e,t)})})}function handleSyncPurchases(e,t){function logError(e){if(e)console.error("Error syncing purchases: "+e)}if(e){logError(e)
return}o(t)
for(var r=0;r<t.length;r++)applyPurchase(t[r],logError)}function setupClients(){g()
if(c)I([],true)
else{var e=[]
if(a)e.push(new w)
I(e,false)
e.forEach(function(e){return A(e.getProvider(),handleSyncPurchases)})}}function iapWorldsStartup(){if(n().loggedIn())setupClients()
n().onLogin(setupClients)}i.register({cmd:"make_purchase",access_show:["sysadmin"],help:"Trigger a Facebook purchase",func:function func(e,r){iapMakePurchase(e||"ctest",function(e,t){return r(e)})}})},{"../../common/globals":197,"../../common/in_app_purchases/iap_common":199,"../../glov/client/client_config":243,"../../glov/client/cmds":244,"../../glov/client/net":279,"../../glov/client/ui":306,"../../glov/common/util":330,"../analytics":5,"../localization/localization":108,"../worlds_sound":187,"./iap_client":91,"./iap_client_facebook_instant":92,assert:void 0}],94:[function(e,t,r){"use strict"
r.locked=locked
r.setLock=setLock
r.inventoryGetVer=inventoryGetVer
r.reload=reload
r.inventoryLoad=inventoryLoad
r.debugTools=debugTools
r.debugMaterials=debugMaterials
r.debugBlocks=debugBlocks
r.startup=startup
r.inventoryGetSizeMax=inventoryGetSizeMax
r.inventoryGetSize=inventoryGetSize
r.inventoryGet=inventoryGet
r.inventoryGetArr=inventoryGetArr
r.findAddIdxList=findAddIdxList
r.inventoryOverlap=inventoryOverlap
r.itemListCompact=itemListCompact
r.canDrop=canDrop
r.inventoryEmpty=inventoryEmpty
r.canFit=canFit
r.canFitPartial=canFitPartial
r.canSplit=canSplit
r.transInvAdd=transInvAdd
r.transInvClear=transInvClear
r.inventoryTransAttribMod=inventoryTransAttribMod
r.inventoryTransHPMod=inventoryTransHPMod
r.transDrop=transDrop
r.transSwap=transSwap
r.transMerge=transMerge
r.transInvDec=transInvDec
r.transSplit=transSplit
r.consumeEx=consumeEx
r.consume=consume
r.transBucketConsume=transBucketConsume
r.transBucketFill=transBucketFill
r.transSort=transSort
r.undoTransactionOp=undoTransactionOp
r.applyTransactionOp=applyTransactionOp
r.countAvailableEx=countAvailableEx
r.countAvailable=countAvailable
r.findAvailableEx=findAvailableEx
r.findAvailable=findAvailable
r.findAvailableBroken=findAvailableBroken
r.payCostEx=payCostEx
r.payCost=payCost
r.inventoryGetFallback=inventoryGetFallback
r.inventoryGetAccountMapped=inventoryGetAccountMapped
r.inventoryGetMaterialCostMapped=inventoryGetMaterialCostMapped
r.equipFitsInSlot=equipFitsInSlot
r.anythingEquipped=anythingEquipped
r.findEquipAddIdx=findEquipAddIdx
r.inventoryReset=inventoryReset
r.getDropPos=r.EQUIP_SLOTS=r.INV_EQUIP=r.INV_PLAYER=void 0
var a=e("../common/ids")
var i=e("../common/ids")
var o=i.ITEM_BAG
var _=i.ITEM_BUCKET
var n=i.ITEM_HATCHET
var s=i.ITEM_PICKAX
var l=i.ITEM_SHOVEL
var c=i.TYPE_BLOCK
var u=i.TYPE_ITEM
var d=e("./localization/localization").L
var f=e("./ui_util")
var h={data_ver:1,contents:[]}
r.INV_PLAYER=h
var p={data_ver:1,contents:[]}
r.INV_EQUIP=p
var v=[{item_id:s,label:d.INVENTORY_ITEM_LABEL_PICKAX,frame:f.SLOT_PICKAX},{item_id:n,label:d.INVENTORY_ITEM_LABEL_HATCHET,frame:f.SLOT_HATCHET},{item_id:l,label:d.INVENTORY_ITEM_LABEL_SHOVEL,frame:f.SLOT_SHOVEL}]
r.EQUIP_SLOTS=v
var E=e("assert")
var m=e("../glov/client/cmds").cmd_parse
var g=e("../glov/client/ui")
var y=e("../glov/common/util")
var T=y.clone
var I=y.empty
var S=y.ridx
var A=e("../glov/common/verify")
var w=e("../glov/common/vmath")
var L=w.unit_vec
var R=w.v3addScale
var x=w.v3floor
var O=w.v3same
var b=w.vec3
var N=e("../common/globals").STACK_SIZE
var C=e("../common/materials_common").Mat
var M=e("../common/voxel_data_common")
var D=M.ANIM_STYLE_BEAM
var P=M.ANIM_TYPE_PLAYER
var k=M.ANIM_TYPE_POS
var B=M.TRANS_INV_EQUIP
var U=M.TRANS_INV_PLAYER
var G=e("../common/world_trans").createTransSet
var F=e("./blueprint").blueprintGetDef
var W=e("./build_mode")
var j=e("./editvolume_client").inEditBounds
var H=e("./item_anims").setLastModProp
var z=e("./items")
var V=z.createItem
var Y=z.itemEqual
var q=z.itemFromJSON
var K=z.itemIsAccountLocked
var Z=z.itemIsBlueprint
var X=z.itemIsUnlimited
var Q=z.itemPartiallyMergeable
var J=z.itemPotentiallyMergeable
var $=z.sameItem
var ee=z.satisfiesCost
var te=e("./main")
var re=e("./materials")
var ae=re.INV_MATERIAL_NAME
var ie=re.MATERIAL_CLASS
var oe=re.MATERIAL_TIER
var ne=e("./props")
var se=e("./quickbar")
var le=e("./status")
var ce=e("./tiles")
var _e=e("./tiles_ui").TILES_UI_SORT
var ue=e("./user_data")
var de=e("./user_data").worldReadOnly
var fe=e("./voxel_data")
var ve=e("./voxel_data").ensurePristineSendProp
var he=e("./world_comm").transact
var pe=e("./world_metadata").unlimitedMode
var me=e("./worlds_sound").playSound
var ge=Math.floor,Ee=Math.max,ye=Math.min
h.user_inv_type=U
p.user_inv_type=B
var Te
var Ie
var Se=ce.tile_map_default
E(Se)
function locked(e){E(e)
return e.prediction_locked}function setLock(e,t){e.prediction_locked=t}function inventoryGetVer(e){E(e===h)
return e.data_ver}var Ae
var we=false
function autoGrant(o){if(de())return
var n=false;[h,p].forEach(function(e){var t=e.contents
var r=inventoryGetSize(e)
for(var a=0;a<r;++a){var i=t[a]
if(i&&i.type===o.type&&i.id===o.id&&i.attr1===(o.attr1||0)){if(!o.remove){n=true
return}transInvClear(Ae=Ae||te.getFrameTransaction(),e,a)
le.push(d.$(d.STATUSMSG_ITEM_REMOVED,i.getName()))}}})
if(o.remove||n)return
var e=V(o)
if(e.has_hp)e.setHP(e.hp_max)
var t=findEquipAddIdx(e)
if(-1!==t){transInvAdd(Ae=Ae||te.getFrameTransaction(),p,e,t,true)
if(!we)le.push(d.$(d.STATUSMSG_ITEM_AUTO_EQUIP,e.getName()))}else if(!canFit(e)){if(!we)le.get("ifull").setMessage(d.MSG_INVENTORY_FULL)}else{transInvAdd(Ae=Ae||te.getFrameTransaction(),h,e,void 0,true)
if(!we)le.push(d.$(d.STATUSMSG_ITEM_AUTO_GRANT,e.getName()))}}function reload(e,t){var r=false
E(t)
E(t.items)
E(t.size)
e.container_size=t.size
e.contents=t.items.map(q)
e.prediction_locked=false;++e.data_ver
return r}function removeInvalidItems(){if(de())return
var i;[h,p].forEach(function(e){var t=e.contents
for(var r=0;r<t.length;++r){var a=t[r]
if(a&&!a.isAllowedInInventory())transInvClear(i=i||te.getFrameTransaction(),e,r)}})}function inventoryLoad(){reload(h,ue.get("inventory"))
reload(p,ue.get("equip"))
E.equal(p.container_size,v.length)
removeInvalidItems()
if(pe())debugTools(null,true)}function debugTools(e,t){if(locked(h)){le.push(d.STATUSMSG_CANT_GRANT_INVENTORY_LOCKED)
return}Ae=e||null
we=t
autoGrant({type:u,id:s,attr1:C.REGULAR,attr2:C.WOOD,equip:true})
autoGrant({type:u,id:n,attr1:C.REGULAR,attr2:C.WOOD,equip:true})
autoGrant({type:u,id:l,attr1:C.REGULAR,attr2:C.WOOD,equip:true})
autoGrant({type:u,id:s,attr1:C.FAST,attr2:C.RED_WOOD})
autoGrant({type:u,id:n,attr1:C.FAST,attr2:C.RED_WOOD})
autoGrant({type:u,id:l,attr1:C.FAST,attr2:C.RED_WOOD})
autoGrant({type:u,id:s,attr1:C.SUPER,attr2:C.DARK_WOOD})
autoGrant({type:u,id:n,attr1:C.SUPER,attr2:C.DARK_WOOD})
autoGrant({type:u,id:l,attr1:C.SUPER,attr2:C.DARK_WOOD})
we=false}function debugMaterials(){if(locked(h)){le.push(d.STATUSMSG_CANT_GRANT_INVENTORY_LOCKED)
return}Ae=null
autoGrant({type:c,id:ce.WOOD,count:100})
autoGrant({type:u,id:a.ITEM_FIBER,count:100})
autoGrant({type:c,id:ce.STONE,count:100})}function debugMetals(){if(locked(h)){le.push(d.STATUSMSG_CANT_GRANT_INVENTORY_LOCKED)
return}Ae=null
autoGrant({type:u,id:a.ITEM_COAL,count:10})
autoGrant({type:u,id:a.ITEM_ORE,count:10,attr1:C.COPPER})
autoGrant({type:u,id:a.ITEM_ORE,count:10,attr1:C.IRON})
autoGrant({type:u,id:a.ITEM_ORE,count:10,attr1:C.TIN})
autoGrant({type:u,id:a.ITEM_ORE,count:10,attr1:C.SILVER})
autoGrant({type:u,id:a.ITEM_ORE,count:10,attr1:C.EMBERYLLIUM})
autoGrant({type:u,id:a.ITEM_ORE,count:10,attr1:C.GOLD})
autoGrant({type:u,id:a.ITEM_ORE,count:10,attr1:C.COBALT})
autoGrant({type:u,id:a.ITEM_ORE,count:10,attr1:C.MYTHRIL})
autoGrant({type:u,id:a.ITEM_ORE,count:10,attr1:C.AETHERSTONE})
autoGrant({type:u,id:a.ITEM_INGOT,count:10,attr1:C.COPPER})
autoGrant({type:u,id:a.ITEM_INGOT,count:10,attr1:C.IRON})
autoGrant({type:u,id:a.ITEM_INGOT,count:10,attr1:C.TIN})
autoGrant({type:u,id:a.ITEM_INGOT,count:10,attr1:C.BRONZE})
autoGrant({type:u,id:a.ITEM_INGOT,count:10,attr1:C.SILVER})
autoGrant({type:u,id:a.ITEM_INGOT,count:10,attr1:C.EMBERYLLIUM})
autoGrant({type:u,id:a.ITEM_INGOT,count:10,attr1:C.GOLD})
autoGrant({type:u,id:a.ITEM_INGOT,count:10,attr1:C.BRIGHTSTEEL})
autoGrant({type:u,id:a.ITEM_INGOT,count:10,attr1:C.COBALT})
autoGrant({type:u,id:a.ITEM_INGOT,count:10,attr1:C.MYTHRIL})
autoGrant({type:u,id:a.ITEM_INGOT,count:10,attr1:C.AETHERSTEEL})
autoGrant({type:u,id:a.ITEM_INGOT,count:10,attr1:C.MUTTAL})
autoGrant({type:u,id:s,attr1:C.COPPER,attr2:C.WOOD})
autoGrant({type:u,id:s,attr1:C.IRON,attr2:C.WOOD})
autoGrant({type:u,id:s,attr1:C.BRONZE,attr2:C.WOOD})
autoGrant({type:u,id:s,attr1:C.SILVER,attr2:C.WOOD})
autoGrant({type:u,id:s,attr1:C.EMBERYLLIUM,attr2:C.WOOD})
autoGrant({type:u,id:s,attr1:C.BRIGHTSTEEL,attr2:C.WOOD})
autoGrant({type:u,id:s,attr1:C.COBALT,attr2:C.WOOD})
autoGrant({type:u,id:s,attr1:C.MYTHRIL,attr2:C.WOOD})
autoGrant({type:u,id:s,attr1:C.AETHERSTEEL,attr2:C.WOOD})
autoGrant({type:u,id:s,attr1:C.MUTTAL,attr2:C.WOOD})
autoGrant({type:c,id:ce.COAL,count:1})
autoGrant({type:c,id:ce.COPPER,count:1})
autoGrant({type:c,id:ce.IRON,count:1})
autoGrant({type:c,id:ce.TIN,count:1})
autoGrant({type:c,id:ce.SILVER,count:1})
autoGrant({type:c,id:ce.EMBERYLLIUM,count:1})
autoGrant({type:c,id:ce.GOLD,count:1})
autoGrant({type:c,id:ce.COBALT,count:1})
autoGrant({type:c,id:ce.MYTHRIL,count:1})
autoGrant({type:c,id:ce.AETHERSTONE,count:1})
autoGrant({type:c,id:ce.ORE_IN_STONE_LIGHT,count:1})
autoGrant({type:c,id:ce.ORE_IN_STONE,count:1})
autoGrant({type:c,id:ce.ORE_IN_STONE_DARK,count:1})
autoGrant({type:c,id:ce.ORE_IN_STONE_RED,count:1})
autoGrant({type:c,id:ce.VEINIUM,count:1})
autoGrant({type:c,id:ce.ORE_IN_VEINIUM,count:1})}m.register({cmd:"metal_test",help:"Grants a bunch of ores, bars, and metal tools, for testing",func:function func(e,t){m.handle(this,"inventory_size 48",function(e){if(e)return void t(e)
debugMetals()
t()})},access_run:["sysadmin"]})
function debugBlocks(){if(locked(h)){le.push(d.STATUSMSG_CANT_GRANT_INVENTORY_LOCKED)
return}Ae=null
autoGrant({type:c,id:ce.DIRT,count:100})
autoGrant({type:c,id:ce.STONE,count:100})
autoGrant({type:c,id:ce.STONE_DARK,count:100})
autoGrant({type:c,id:ce.STONE_LIGHT,count:100})
autoGrant({type:c,id:ce.STONE_RED,count:100})
autoGrant({type:c,id:ce.WOOD,count:100})
autoGrant({type:c,id:ce.WOOD_LIGHT,count:100})
autoGrant({type:c,id:ce.WOOD_RED,count:100})
autoGrant({type:c,id:ce.WOOD_DARK,count:100})
autoGrant({type:c,id:ce.SAND,count:100})}function dirty(e){if(!e.user_inv_type)e.updateDrawable()
else++e.data_ver}function startup(){Ie=te.char_controller
Te=fe.transItemAnim}function inventoryGetSizeMax(e){var t=e.container_size
if(e===h)--t
return t}function inventoryGetSize(e){var t=inventoryGetSizeMax(e)
return ye(t,e.contents.length)}function inventoryGet(e){return h.contents[e]}function inventoryGetArr(){return h.contents}function findAddIdxList(e,t,r,a){var i=ye(t.count,r)
E(i)
var o=[]
var n=e.contents
var s=inventoryGetSizeMax(e)
if(t.stackable)for(var l=0;i&&l<ye(n.length,s);++l){var c=n[l]
var _=ye(Q(c,t),i)
if(_){i-=_
o.push(l,_)}}for(var u=0;i&&u<s;++u)if(!n[u]){var d=ye(N,i)
i-=d
o.push(u,d)}if(!o.length||a&&i)return null
return o}function inventoryOverlap(e,t){var r=[]
for(var a=e.length-1;a>=0;--a){var i=e[a]
for(var o=t.length-1;o>=0;--o){var n=t[o]
if(Y(i,n,"hp")){r.push(i)
S(e,a)
S(t,o)}else if(J(i,n))if(i.count===n.count){r.push(i)
S(e,a)
S(t,o)
break}else if(i.count<n.count){r.push(i)
S(e,a)
n.count-=i.count
break}else{r.push(n)
S(t,o)
i.count-=n.count}}}return r.length?r:null}function itemListCompact(e){var t=e
for(var r=t.length-1;r>=0;--r)if(!t[r]){if(t===e)t=e.map(q)
S(t,r)}for(var a=0;a<t.length;++a)for(var i=t.length-1;i>a;--i)if(J(t[a],t[i])){if(t===e)t=e.map(q)
t[a].count+=t[i].count
S(t,i)}return t}var Le=new Int32Array(3)
function canDrop(){if(locked(h))return false
x(Le,Ie.getRootPos())
if(!j(Le))return false
var e=fe.getTileLocal(Le,0)
if(e>=ce.PROP_BASE&&e<=ce.PROP_MAX){var t=fe.getPropLocal(Le)
if(t&&t.item_id===o)return true}return!e}function full(e,t){var r=e.contents
var a=inventoryGetSizeMax(e)
for(var i=t||0;i<a;++i)if(!r[i])return false
return true}function inventoryEmpty(e){var t=e.contents
var r=inventoryGetSize(e)
for(var a=0;a<r;++a)if(t[a])return false
return true}function canFit(e){if(locked(h))return false
return Boolean(findAddIdxList(h,e,Infinity,true))}function canFitPartial(e){if(locked(h))return false
return Boolean(findAddIdxList(h,e,Infinity,false))}function canSplit(e,t,r){E(e)
if(locked(e))return false
var a=e.contents[t]
if(!a||!a.stackable||a.count<=1)return false
return!full(e,r)}function matCompare(e,t){if(e===t)return 0
if(!e){if(!t)return 0
return-1}else if(!t)return 1
var r=(ie[e]||0)-(ie[t]||0)
if(r)return r
if(r=(oe[e]||0)-(oe[t]||0))return r
return e-t}function itemCompare(e,t){if(e.type!==t.type)return t.type-e.type
if(e.type===c){var r=Se[e.id]
var a=r&&_e[r.tile_code]||e.id
var i=Se[t.id]
return a-(i&&_e[i.tile_code]||t.id)}if(e.id!==t.id)return e.id-t.id
var o=matCompare(e.attr1,t.attr1)
if(o)return o
if(o=matCompare(e.attr2,t.attr2))return o
if(o=(e.attr3||0)-(t.attr3||0))return o
return t.count-e.count}function sort(e){var t=false
for(var r=0;r<e.length;++r){var a=e[r]
for(var i=r+1;i<e.length;++i){var o=e[i]
if(!a&&o){e[r]=a=o
e[i]=null
t=true}else if(!o);else{var n=Q(a,o)
if(n){a.count+=n
o.count-=n
if(!o.count)e[i]=null
t=true}else if(itemCompare(a,o)>0){e[i]=a
e[r]=a=o
t=true}}}}while(e.length&&!e[e.length-1])e.pop()
if(!t)e.reverse()}function uiOnAdd(e){var t=le.get("pickup_"+e.type+"_"+e.id+"_"+e.attr1+"_"+e.attr2+"_"+e.attr3)
t.count=(t.count||0)+e.count
var r=0
var a=h.contents
var i=ye(a.length,h.container_size-1)
for(var o=0;o<i;++o)if($(a[o],e))r+=a[o].count
a=p.contents
for(var n=0;n<a.length;++n)if($(a[n],e))r+=a[n].count
if(t.count>r)t.count=r
me("pickup")
t.setMessage(d.$(d.STATUSMSG_ITEM_ADD,t.count,e.getName(),r))}function transInvAdd(e,t,r,a,i,o){if(void 0===o)o=r.count
E(o)
if(!t.user_inv_type)ve(e,t)
E(!locked(t))
var n=t.contents
var s
if(void 0===a){s=findAddIdxList(t,r,o,true)
E(s)}else{E(-1!==a)
s=[a,o]}var l=0
for(var c=0;c<s.length;){var _=s[c++]
var u=s[c++]
l+=u
var d=n[_]
E(u+(d&&d.count||0)<=N)
var f=!d
var v={idx:_,prop:t,item:r.toJSON(null,true),pred:true}
if(f){v.add=true
v.item.count=u}else{delete v.item.count
v.delta=u}if(f)n[_]=V(v.item)
else n[_].count+=u
e.opInvMod(v)}if(t.user_inv_type&&!i){var h=T(r.toJSON())
h.count=l
e.onComplete(function(e){if(!e)uiOnAdd(V(h))})}dirty(t)}function transInvClear(e,t,r){var a=t.contents[r]
E(a)
transInvDec(e,t,r,a.count)}function inventoryTransAttribMod(e,t,r,a,i){var o=t.contents[r]
if(!o.attribs)o.attribs={}
o.attribs[a]=(o.attribs[a]||0)+i
if(!o.attribs[a]){delete o.attribs[a]
if(I(o.attribs))delete o.attribs}e.opInvAttrib({prop:t,idx:r,attrib:a,delta:i})
dirty(t)}function inventoryTransHPMod(e,t,r,a){var i=t.contents[r]
i.hp_cur=Ee(0,i.hp_cur+a)
inventoryTransAttribMod(e,t,r,"hp",i.hpToAttrib(i.hp_cur)-(i.attribs&&i.attribs.hp||0))}var Re=function(){var t=b()
var r=b()
var a=b()
var i=b()
return function getDropPosFn(){R(t,Ie.pos,Ie.facing,-1)
var e=fe.raycast3DLocal(r,a,i,t,Ie.facing,3,false)?a:r
if(fe.getTileLocal(e,1,false)||!j(e))return null
return e}}()
r.getDropPos=Re
function transDrop(e,t,r,a){E(!locked(t))
var i=t.contents[r]
E(i)
transInvClear(e,t,r)
ne.bagAddTrans(e,{target_pos:a,item:i,src_pos:Ie.pos,src_is_self:true,no_pickup:true})}var xe=b()
function transSwap(e,t,r,a,i){E(!locked(t))
E(!locked(a))
E(t!==a||r!==i)
var o=t.contents
var n=a.contents
E(!t.destroy_on_empty)
E(!a.destroy_on_empty)
var s=o[r]
var l=n[i]
E(l||s)
var c=t.user_inv_type===U&&r===h.container_size-1||a.user_inv_type===U&&i===h.container_size-1
if(s)transInvClear(e,t,r)
if(l){transInvClear(e,a,i)
transInvAdd(e,t,l,r,!(t.user_inv_type&&!a.user_inv_type)||c)}if(s)transInvAdd(e,a,s,i,!(a.user_inv_type&&!t.user_inv_type)||c)
var _=!t.user_inv_type
var u=!a.user_inv_type
if(_!==u&&!c){(!t.user_inv_type?t:a).getLocalPos(xe)
if(s&&_||l&&u)Te(e,{style:D,src_type:k,src:xe,target_type:P,items:[_?s:l]})
if(s&&!_||l&&!u)Te(e,{style:D,src_type:P,target_type:k,target:xe,items:[_?l:s]})}}function transMerge(e,t,r,a,i,o){E(!locked(t))
E(!locked(a))
var n=t.contents
var s=a.contents
var l=n[r]
var c=s[i]
if(l){var _=Q(l,c)
E(_)
E(o<=_)}E(r!==i||n!==s)
if((o=ye(o,c.count))<c.count)(c=V(c)).count=o
var u=!t.user_inv_type!==!a.user_inv_type
transInvAdd(e,t,c,r,!u,o)
transInvDec(e,a,i,o)
if(u){(!t.user_inv_type?t:a).getLocalPos(xe)
var d={style:D,items:[c]}
if(!t.user_inv_type){d.src_type=P
d.target_type=k
d.target=xe}else{d.src_type=k
d.src=xe
d.target_type=P}Te(e,d)}}function decForTransInternal(e,t,r){E(!locked(e))
var a=e.contents
var i=a[t]
E(i)
E(r)
E(i.count>=r)
var o={idx:t,prop:e,delta:-r,item:i.toJSON(),pred:true}
delete o.item.count
var n=i.count-r
if(!n)a[t]=null
else i.count=n
dirty(e)
return o}function transInvDec(e,t,r,a){if(!t.user_inv_type)ve(e,t)
e.opInvMod(decForTransInternal(t,r,a))}function transSplit(e,t,r,a){E(!locked(t))
var i=t.contents
var o=inventoryGetSize(t)
var n=i[r]
var s=ge(n.count/2)
var l=n.count-s
var c=-1
for(var _=a||0;_<o;++_)if(!i[_]){c=_
break}if(-1===c)c=o
transInvDec(e,t,r,l)
transInvAdd(e,t,n,c,true,l)}function consumeEx(e,t,r,a){a=a||1
var i=t.contents[r]
if(!i)return e
if(!i.stackable){E(i.placeable)
E.equal(i.count,1)}if(i.count<a)return e
transInvDec(e=e||te.getFrameTransaction(),t,r,a)
i.consume(e)
return e}function consume(e,t,r){return consumeEx(e,h,t,r)}function bucketMergeSlot(e,t,r){var a=h.contents[e]
E(a)
var i=V({type:u,id:_,count:r,attr1:a.attr1,attr2:t,attr3:a.attr3})
var o=findAddIdxList(h,i,r,true)
if(o)return[o,i]
if(r===a.count)return[[e,r],i]
le.get("ifull").setMessage(d.MSG_INVENTORY_FULL)
return null}function transBucketConsume(e,t,r){var a=h.contents[t]
E(a)
E.equal(a.type,u)
E.equal(a.id,_)
E(a.attr2)
E(a.count&&a.count>=r)
var i=bucketMergeSlot(t,ce.EMPTY,r)
if(!i)return null
e=e||te.getFrameTransaction()
var o=i[0],n=i[1]
transInvDec(e,h,t,r)
for(var s=0;s<o.length;){var l=o[s++]
var c=o[s++]
transInvAdd(e,h,n,l,false,c)}return e}function transBucketFill(e,t){var r=1
var a=h.contents[e]
E(a)
E.equal(a.type,u)
E.equal(a.id,_)
E(!a.attr2)
E(a.count&&a.count>=r)
var i=bucketMergeSlot(e,t,r)
if(!i)return null
var o=i[0],n=i[1]
E.equal(o.length,2)
E.equal(o[1],1)
E.equal(n.count,1)
var s=te.getFrameTransaction()
transInvDec(s,h,e,r)
transInvAdd(s,h,n,o[0],false)
return s}function transSort(e){E(!locked(e))
var t=e.contents
var r=inventoryGetSizeMax(e)
if(t.length>r)t=t.slice(0,r)
var a=T(t).map(q)
sort(a)
var i
for(var o=0;o<t.length;++o){var n=t[o]
var s=a[o]
if(Y(n,s))continue
i=i||te.getFrameTransaction()
if(n)transInvClear(i,e,o)
if(s)transInvAdd(i,e,s,o,true)}}function undoTransactionOp(e){E(e.pred)
var t=e.idx,r=e.item,a=e.delta,i=e.add,o=e.prop_chunk_id,n=e.user_inv_type,s=e.prop
E.equal(o,void 0)
if(!s)if(n===U)s=h
else if(n===B)s=p
else E(false,n)
var l=s.contents
var c=l[t]
if(!c){E(a<0);(c=l[t]=V(r)).count=-a}else{E.equal(c.type,r.type)
E.equal(c.id,r.id)
if(i){E.equal(c.count,r.count)
l[t]=null}else c.count-=a}E(s.user_inv_type);++s.data_ver}function applyTransactionOp(e,t){var r=e.idx,a=e.item,i=e.delta,o=e.add,n=e.prop_destroy_on_empty,s=e.prop_chunk_id,l=e.prop_pos,c=e.prop_version,_=e.user_inv_type
var u
if(void 0!==s){if(!(u=fe.getPropDirect(s,l)))return
H(u)}else if(_===U)u=h
else if(_===B)u=p
else E(false,_)
if(t){u.version=c
return}var d=u.contents
if(!d){console.warn("Transaction on non-container, cid:"+s+",pos:"+l.join(",")+",uit:"+_+",tpv:"+c+",lpv:"+u.version+",lpid:"+u.item_id+", ignoring...")
return}var f=d[r]
if(o){if(!f);E(!i)
d[r]=V(a)}else{E(i)
if(!f)if(i>0){d[r]=f=V(a)
f.count=i
return}else return
E(f)
if(f.type!==a.type||f.id!==a.id)return
f.count+=i
if(!f.count)d[r]=null
while(d.length&&!d[d.length-1])d.pop()
if(!d.length&&n){var v=fe.chunk_map[s]
E(v&&v.did_gen)
E(O(u.size,L))
if(v.get(l,false)===ce.PROP_BASE)v.set(l,0,false)
v.setProp(l,null)}}if(!u.user_inv_type)u.version=c
dirty(u)}function countAvailableEx(e,t,r,a){if(!t)return 0
if(t.unlimited_only&&!W.unlimitedMode()&&e.user_inv_type)return 0
if(t.from_mini)return Infinity
if(X(t))return Infinity
var i=Z(t)
var o
var n=true
if(i){E(e.user_inv_type)
var s=t.getBID()
E(s)
if(!(o=F(s)).loaded)return 0
if(r)return countAvailableEx(e,t.cost[0],true,a)
var l="avail_count_bp_"+e.user_inv_type+"_"+(a?1:0)+"_ver"
if(o.ver!==t[l]){n=false
t[l]=o.ver}}var c
var _
if(e.user_inv_type&&!t.dynamic_cost)if(t[_=(c="avail_count_"+e.user_inv_type+"_"+(a?1:0))+"_ver"]===e.data_ver&&n)return t[c]
var u=t.cost
if(a)(u=[V(t)])[0].count=1
else if(t.dynamic_cost)u=t.dynamic_cost()
else if(!u&&!t.placeable)(u=[V(t)])[0].count=1
else if(i)u=o.cost
if(!A(u))return 0
var d=e.contents
var f=inventoryGetSize(e)
var v=Infinity
for(var h=0;h<u.length;++h){var p=u[h]
E(p.count)
var m=0
for(var g=0;g<f;++g)if(ee(p,d[g]))m+=d[g].count
v=ye(v,ge(m/p.count))}if(c){t[c]=v
t[_]=e.data_ver}return v}function countAvailable(e,t,r){return countAvailableEx(h,e,t,r)+countAvailableEx(p,e,t,r)}function findAvailableEx(e,t){var r=e.contents
var a=inventoryGetSize(e)
for(var i=0;i<a;++i)if(ee(t,r[i]))return r[i]
return null}function findAvailable(e){return findAvailableEx(p,e)||findAvailableEx(h,e)}function findAvailableBrokenEx(e,t){var r=e.contents
var a=inventoryGetSize(e)
for(var i=0;i<a;++i)if($(t,r[i],"hp"))return r[i]
return null}function findAvailableBroken(e){return findAvailableBrokenEx(p,e)||findAvailableBrokenEx(h,e)}function payCostEx(e,t,r){E(t)
E(e||t.user_inv_type)
E(countAvailableEx(t,r,true))
var a=[]
if(W.unlimitedMode())return a
var i=r.cost
if(r.dynamic_cost)i=r.dynamic_cost()
var o=t.contents
var n=inventoryGetSize(t)
for(var s=0;s<i.length;++s){var l=i[s]
var c=l.count
E(c)
for(var _=0;c&&_<n;++_)if(ee(l,o[_])){var u=ye(c,o[_].count)
var d=decForTransInternal(t,_,u||1)
a.push(d)
if(e)e.opInvMod(d)
c-=u}E(!c)}return a}function payCost(e){if(!countAvailableEx(h,e,true))return null
return payCostEx(null,h,e)}function inventoryGetCached(e,t,r){var a=h
var i=t+"_"+a.user_inv_type
var o=i+"_ver"
if(e[o]===a.data_ver)return e[i]
var n=r(a,{type:e.type,id:e.id,attr1:e.attr1,attr2:e.attr2,attr3:e.attr3})
e[i]=n
e[o]=a.data_ver
return n}function inventoryGetFallback(e){if(!e)return e
return inventoryGetCached(e,"fallback",function(e,t){var r=V(t)
r.fallback=true
return r})}function inventoryGetAccountMapped(e){return e&&K(e)?inventoryGetFallback(e):e}function inventoryGetMaterialCostMapped(d){if(!d||!d.cost_mat_map)return d
return inventoryGetCached(d,"mat_mapped",function(e,t){var r=e.contents
var a=inventoryGetSize(e)
for(var i in d.cost_mat_map){var o=d.cost_mat_map[i]
var n=o.cost_idx,s=o.def
var l=d.cost[n]
var c=false
for(var _=0;_<a;++_){var u=r[_]
if(ee(l,u)){c=true
t[i]=u.getMaterial()
break}}if(!c){t[i]=ae[s]
E(t[i],"Material cost mapping referencing unknown material "+s)}}return V(t)})}function equipFitsInSlot(e,t){if(!t)return false
if(t.type===u&&t.id===v[e].item_id){if(t.has_hp&&!t.hp_cur)return false
return true}return false}function anythingEquipped(){for(var e=0;e<v.length;++e)if(v[e])return true
return false}function findEquipAddIdx(e){if(!locked(p))for(var t=0;t<v.length;++t)if(!p.contents[t]&&equipFitsInSlot(t,e))return t
return-1}function inventoryReset(){var e=G()
var r=e.trans();[h,p].forEach(function(e){if(locked(e))g.modalDialog({title:d.DLG_ERROR_INVENTORY_RESET_TITLE,text:d.DLG_ERROR_INVENTORY_RESET_MSG,buttons:{OK:null}})
else for(var t=0;t<e.contents.length;++t)if(e.contents[t])transInvClear(r,e,t)})
se.reset(true)
if(pe())debugTools(r,false)
if(r.ops.length)he(e)}m.register({cmd:"inventory_reset",help:"Resets inventory and quickbar to blank state",func:function func(e,t){inventoryReset()
t()},access_run:["world_areabuilder"]})
m.register({cmd:"repair_all",help:"(Admin) Repairs all items in inventory",func:function func(e,t){var r=G()
var a=r.trans();[h,p].forEach(function(e){for(var t=0;t<e.contents.length;++t){var r=e.contents[t]
if(r&&r.has_hp&&r.hp_cur<r.hp_max)inventoryTransHPMod(a,e,t,r.hp_max-r.hp_cur)}})
if(a.ops.length){he(r)
t(null,"Repaired.")}else t(null,"Nothing needed repair")},access_run:["sysadmin"]})},{"../common/globals":197,"../common/ids":198,"../common/materials_common":201,"../common/voxel_data_common":209,"../common/world_trans":213,"../glov/client/cmds":244,"../glov/client/ui":306,"../glov/common/util":330,"../glov/common/verify":331,"../glov/common/vmath":332,"./blueprint":24,"./build_mode":27,"./editvolume_client":72,"./item_anims":96,"./items":98,"./localization/localization":108,"./main":112,"./materials":114,"./props":141,"./quickbar":142,"./status":156,"./tiles":162,"./tiles_ui":164,"./ui_util":168,"./user_data":170,"./voxel_data":175,"./world_comm":182,"./world_metadata":186,"./worlds_sound":187,assert:void 0}],95:[function(e,t,r){"use strict"
r.inventoryUIStartup=inventoryUIStartup
r.inventoryUIInit=inventoryUIInit
r.inventoryAnimate=inventoryAnimate
r.mapInvPos=mapInvPos
r.inventoryButtonPrep=inventoryButtonPrep
r.drawItemCount=drawItemCount
r.itemHPColor=itemHPColor
r.itemHPStyle=itemHPStyle
r.drawItemHP=drawItemHP
r.inventoryButton=inventoryButton
r.getDroppedItem=getDroppedItem
r.setMouseoverItem=setMouseoverItem
r.getMouseoverItem=getMouseoverItem
r.setSelectedItem=setSelectedItem
r.getSelectedItem=getSelectedItem
r.doInventorySetupContext=doInventorySetupContext
r.ctxTrans=ctxTrans
r.inventorySwap=inventorySwap
r.inventoryDeselect=inventoryDeselect
r.inventoryMerge=inventoryMerge
r.canEquipFromContainer=canEquipFromContainer
r.equipFromContainer=equipFromContainer
r.equipDragDroppedItem=equipDragDroppedItem
r.inventoryUITick=inventoryUITick
r.doInventorySubOneItem=doInventorySubOneItem
r.doInventorySub=doInventorySub
r.doPaperDollInventoryOverlay=doPaperDollInventoryOverlay
r.handlePaperdollDragAndDrop=handlePaperdollDragAndDrop
r.doInventory=doInventory
r.quickTransferContainer=quickTransferContainer
r.doContainer=doContainer
r.QUICKBAR_VIEW_BORDER_PAD=r.ITEM_PAD=r.ACCEPT_HIGHLIGHT=r.ACCEPT_OK=r.ACCEPT_NO=r.INVTYPE_EQUIP=r.INVTYPE_CONTAINER=r.INVTYPE_MAIN=void 0
var ae=0
r.INVTYPE_MAIN=ae
var ie=1
r.INVTYPE_CONTAINER=ie
var oe=2
r.INVTYPE_EQUIP=oe
var ne=0
r.ACCEPT_NO=ne
var se=1
r.ACCEPT_OK=se
var le=2
r.ACCEPT_HIGHLIGHT=le
var X=14
r.ITEM_PAD=X
var Q=8
r.QUICKBAR_VIEW_BORDER_PAD=Q
var ce=e("assert")
var a=e("../glov/client/cmds").cmd_parse
var _e=e("../glov/client/engine")
var ue=e("../glov/client/input")
var de=e("../glov/client/net").netSubs
var fe=e("../glov/client/settings")
var ve=e("../glov/client/ui")
var he=e("../glov/client/ui").buttonWasFocused
var i=e("../glov/common/util")
var pe=i.defaults
var u=i.lerp
var d=i.ridx
var l=e("../glov/common/verify")
var o=e("../glov/common/vmath")
var v=o.unit_vec
var c=o.v2distSq
var J=o.v2set
var s=o.v3copy
var n=o.vec2
var _=o.vec4
var L=e("../common/globals").STACK_SIZE
var f=e("../common/materials_common").Mat
var h=e("./build_mode")
var R=h.MAX_INTERACT_DIST
var me=h.MIN_DRAG_DISTANCE
var ge=h.unlimitedMode
var p=e("./huds").staminaBar
var m=e("./inventory")
var Ee=m.EQUIP_SLOTS
var g=m.INV_EQUIP
var ye=m.INV_PLAYER
var Te=m.equipFitsInSlot
var $=m.findAddIdxList
var E=m.findAvailable
var y=m.findAvailableBroken
var ee=m.inventoryEmpty
var x=m.inventoryGetArr
var T=m.inventoryGetFallback
var te=m.inventoryGetSize
var I=m.inventoryGetSizeMax
var Ie=m.transInvClear
var Se=e("./inventory")
var S=e("./item_info_view")
var re=S.ITEM_INFO_VIEW_W
var Ae=S.itemInfoViewShow
var A=e("./items")
var we=A.ITEM_CONTEXT_ITEM
var w=A.createItem
var O=A.isItem
var b=A.itemGetGfx
var Le=A.itemPartiallyMergeable
var N=A.sameItem
var C=e("./layout")
var M=C.TALL
var D=C.layoutCameraTallWideMode
var Re=e("./localization/localization").L
var xe=e("./main").getFrameTransaction
var Oe=e("./main")
var P=e("./menu")
var be=P.PANEL_PAD
var k=P.menuInteractGetProp
var Ne=P.menuPanelX0
var Ce=P.menuX1
var Me=P.menuY1
var De=P.prefixShortcutKey
var B=e("./paperdoll")
var U=B.doPaperDoll
var G=B.resetRotation
var F=e("./quickbar")
var Pe=F.quickbarOnEquipChange
var W=F.quickbarSetLastGatherTool
var ke=e("./quickbar")
var Be=e("./status")
var j=e("./styles")
var H=j.color_hp_high
var z=j.color_hp_low
var V=j.color_hp_med
var Y=j.color_hp_none
var Ue=j.color_locked_fade
var q=j.color_rarity
var Ge=j.inventory_style
var Fe=j.refreshing_style
var K=j.style_hp_label_high
var We=j.style_hp_label_low
var je=j.style_hp_label_med
var He=j.style_hp_label_none
var ze=j.style_mode_label
var Ve=j.style_mode_label_disabled
var Ye=j.style_rarity
var qe=e("./tutorial").tutorialPosHook
var Ke=e("./ui_util").INFINITY_SYMBOL
var Ze=e("./ui_util")
var Xe=e("./user_data").worldReadOnly
var Qe=e("./voxel_data")
var Je=e("./worlds_sound").playSound
var $e=Math.ceil,et=Math.floor,tt=Math.max,rt=Math.min,at=Math.PI,it=Math.sin,ot=Math.sqrt
var nt
var st
var lt
var ct=_(1,1,1,.5)
var _t=_(1,1,1,.5)
var ut=v
var dt=_(0,1,0,1)
var ft=550
var vt=730
var ht=80
var pt={type:ae,idx:-1}
function inventoryUIStartup(){nt=Oe.char_controller
st=Ze.sprite
lt=ve.font}function inventoryUIInit(){pt={type:ae,idx:-1}
G()}var mt={}
var gt={}
var Et=[]
var yt
var Tt=300
var It=.5
var St={}
St[oe+",0"]="qb_gather"
St[oe+",1"]="qb_gather"
St[oe+",2"]="qb_gather"
function inventoryAnimate(e,t,r,a){var i=gt[t]
if(!i||i[3]<_e.frame_index-1)i=mt[t]
if(!i||i[3]<_e.frame_index-1)i=mt[St[t]]||i
var o=mt[r]
if(!o||o[3]<_e.frame_index-1)o=mt[St[r]]||o
if(!l(i&&o))return
var n=ot(c(i,o))
var s=n*It
if(s<8)return
Et.push({start:_e.frame_timestamp,inv:e,time:rt(Tt,s),dist:n,p0:i,p1:o,suppress:a?r:null})}function animationSuppresses(e){for(var t=0;t<Et.length;++t)if(Et[t].suppress===e)return true
return false}function mapInvPos(e,t){ce.equal(typeof e,"string")
var r=t.key_is_src?gt:mt
var a=r[e]
if(!a||a[3]!==_e.frame_index)r[e]=[t.x,t.y,t.w,_e.frame_index]}function inventoryButtonPrep(e,t){if(!e.h)e.h=e.w
if(e.dynamic_snapshot_on_mouseover){e.dynamic_snapshot=false
if(t&&!t.no_spin)if(ue.mouseOver({x:e.x,y:e.y,w:e.w,h:e.h,peek:true}))e.dynamic_snapshot=true}var r=b(t,e)
e.color=r.color
e.img=r.img
e.uvs=e.frame=r.frame
if("inv_empty"===e.base_name)e.rollover_quiet=true
if(void 0===e.count_override&&e.auto_count&&t){var a=Se.countAvailable(t)
e.count_override_int=a}else delete e.count_override_int
if(t&&!e.tooltip&&null!==e.tooltip)e.tooltip=t.getBuildName()
e.tooltip_width=e.tooltip_width||600
if(e.key&&!e.no_key_mapping)mapInvPos(e.key,e)}function drawItemCount(e,t){if(e&&(e.getShowCount()||t.force_show_count)&&!t.hide_count){var r=void 0!==t.count_override_int?t.count_override_int:void 0!==t.count_override?t.count_override:e.count
var a=Infinity===r?Ke:r<0?Re.$(Re.INVENTORYUI_AMOUNT_INSUFFICIENT,-r):""+r
if(a!==Ke){var i=t.label_style||("inv_empty"===t.base_name?Ve:lt.styleAlpha(ze,ve.button_last_color[3]))
lt.drawSizedAligned(i,t.x+.12*t.h,t.y,t.z+1,.25*t.h,lt.ALIGN.HRIGHT|lt.ALIGN.HFIT|lt.ALIGN.VBOTTOM,.76*t.h,.88*t.h,a)}}}function itemHPColor(e){return!e?Y:e<.1?z:e<.5?V:H}function itemHPStyle(e){return!e?He:e<.1?We:e<.5?je:K}var At=_()
function drawItemHP(e,t){if(!e||!e.has_hp)return
var r=e.hp_cur
if(t.auto_hp){var a=E(e)
if(!a&&!y(e))return
r=a&&a.hp_cur||0}var i=r/e.hp_max
if(1===i)return
var o=itemHPColor(i)
s(At,o)
At[3]=ve.button_last_color[3]
ve.progressBar({x:t.x+.1*t.h,w:.8*t.w,y:t.y+.8*t.h,h:.1*t.h,z:t.z+.9,progress:i,color:At})
if(!r){var n=.1
At[0]=At[1]=At[2]=1
st.draw({x:t.x+t.w*n,y:t.y+t.h*n,w:t.w*(1-2*n),h:t.h*(1-2*n),z:t.z+.5,frame:Ze.BROKEN,color:At})}}function drawItemRarity(e,t){var r=e&&e.getRarity()
var a=q[r]
if(!a)return
ve.drawCircle(t.x+t.w/2,t.y+t.h/2,t.z+.001,.2*t.w,0,a)}function inventoryButton(e,t){profilerStart("inventoryButton")
if(e.key&&animationSuppresses(e.key)){t=null
e.base_name="inv_empty"}inventoryButtonPrep(e,t)
var r=ve.buttonImage(e)
drawItemRarity(t,e)
drawItemCount(t,e)
drawItemHP(t,e)
if(!r&&e.extra_w)if(r=ue.click({x:e.x,y:e.y,w:e.extra_w,h:e.h,button:0}))Je("button_click")
profilerStop("inventoryButton")
return r}function filterIsQuickDepositTarget(e){return e.isQuickDepositTarget()}function quickDeposit(){var e=Qe.gatherProps(filterIsQuickDepositTarget,nt.center_pos,R)
if(!e.length){Be.get("quick_deposit").setMessage(Re.STATUSMSG_QUICK_DEPOSIT_FAIL_NO_CONTAINERS)
return}var t=new Array(e.length)
var r=x()
var a=te(ye)
var i=false
var o=0
var n
for(var s=0;s<a;++s){var l=r[s]
if(!l)continue
var c=l.count
ce(c)
ce(c<=L)
if(l.stackable)e:for(var _=0;_<e.length;++_){var u=e[_]
var d=u.contents
for(var f=0;f<u.container_size;++f){var v=d[f]
var h=rt(Le(v,l),c)
if(h){n=n||xe()
Se.transMerge(n,u,f,ye,s,h)
c-=h
o+=h
t[_]=true
if(!c)break e}}}var p=false
for(var m=0;c&&m<e.length;++m){var g=e[m]
var E=g.contents
var y=-1
var T=false
for(var I=0;I<g.container_size;++I){var S=E[I]
if(!S){if(-1===y)y=I}else if(N(l,S))p=T=true}if(T&&-1!==y){n=n||xe()
Se.transMerge(n,g,y,ye,s,c)
t[m]=true
o+=c
c=0
break}}if(p&&c)i=l}var A=0
for(var w=0;w<e.length;++w)if(t[w])++A
if(i)if(o)Be.get("quick_deposit_err").setMessage(Re.STATUSMSG_QUICK_DEPOSIT_FAIL_PARTIAL)
else Be.get("quick_deposit_err").setMessage(Re.STATUSMSG_QUICK_DEPOSIT_FAIL_FULL)
else if(!o)Be.get("quick_deposit_err").setMessage(Re.STATUSMSG_QUICK_DEPOSIT_FAIL_NO_MATCH)
if(n)n.onComplete(function(){Be.get("quick_deposit").setMessage(Re.STATUSMSG_QUICK_DEPOSIT_SUCCESS.$({items:o,containers:A}))})}var wt=[Re.INVENTORYUI_INVENTORY,Re.INVENTORYUI_CONTAINER]
function getDroppedItem(e){var t=ue.dragDrop(e)
if(t&&t.drag_payload&&O(t.drag_payload))return t.drag_payload
return null}var Lt
var Rt
function setMouseoverItem(e){Lt=e
Rt=_e.frame_index}function getMouseoverItem(){ce(_e.frame_index!==Rt)
if(Lt&&Rt===_e.frame_index-1)return Lt
return null}var xt
var Ot
function setSelectedItem(e){xt=e
Ot=_e.frame_index}function getSelectedItem(){ce(_e.frame_index!==Ot)
if(xt&&Ot===_e.frame_index-1)return xt
return null}function canUnequip(e){return Se.canFit(e)}var bt
function canEquip(e){bt=-1
for(var t=0;t<Ee.length;++t)if(Te(t,e)){bt=t
return true}return false}var Nt
var Ct
var Mt
function doInventorySetupContext(e){var t=e.prop,r=e.recipe,a=e.wgctx
var i=[ye.contents,t&&t.contents||[],g.contents]
var o=[ye,t,g]
var n=[ye.container_size,t&&t.container_size||0,g.container_size]
var s=false
for(var l=0;l<o.length;++l)if(o[l]&&Se.locked(o[l]))s=true
var c
if(Ct>=_e.frame_index-1)c=Nt
var _=Boolean(t)
if(_&&pt.type===oe)pt={type:ae,idx:-1}
return{prop:t,has_container:_,recipe:r,wgctx:a,each_data:i,each_target:o,each_size:n,any_locked:s,prev_dragged:c}}function ctxTrans(e){if(!e.trans)e.trans=xe()
return e.trans}function inventorySwap(e,t,r){ce(t.type!==r.type||t.idx!==r.idx)
var a=e.each_target,i=e.each_data
var o=i[t.type][t.idx]
if(o)inventoryAnimate(o,t.type+","+t.idx,r.type+","+r.idx,true)
if(o=i[r.type][r.idx])inventoryAnimate(o,r.type+","+r.idx,t.type+","+t.idx,true)
var n=ctxTrans(e)
Se.transSwap(n,a[t.type],t.idx,a[r.type],r.idx)
if(t.type===oe&&i[oe][t.idx])W(i[oe][t.idx])
else if(r.type===oe&&i[oe][r.idx])W(i[oe][r.idx])
else if(t.type===oe||r.type===oe)Pe()}fe.register({inventory_sets_quickbar:{usage:"Sets whether or not inventory selection affects quickbar selection",default_value:0,type:a.TYPE_INT,range:[0,1]}})
function inventorySelect(e,t){var r=e.each_data[(pt=t).type][t.idx]
if(t.type===ae){if(r)if(fe.inventory_sets_quickbar)ke.selectByItem(r)}else if(t.type===oe)if(r&&fe.inventory_sets_quickbar){W(r)
ke.selectGatheringTools()}}function inventoryDeselect(e){e.prev_dragged=null
Nt=null
inventorySelect(e,{type:ae,idx:-1})}function inventoryMerge(e,t,r,a){a=a||L
ce(t.type!==r.type||t.idx!==r.idx)
var i=e.each_data,o=e.each_target
var n=i[r.type][r.idx]
ce(n)
var s=i[t.type][t.idx]
if(s){a=rt(a,L-s.count)
ce(a)}else a=rt(a,L)
if(n.count>a)(n=w(n)).count=a
inventoryAnimate(n,r.type+","+r.idx,t.type+","+t.idx,!s)
var l=ctxTrans(e)
Se.transMerge(l,o[t.type],t.idx,o[r.type],r.idx,n.count)}function quickTransfer(e,t,r){var a=e.each_data,i=e.each_target
var o=a[t.type][t.idx]
if(!r)r=o.count
var n=t.type===oe?ae:t.type===ae?ie:t.type===ie?ae:ce(false)
var s=$(i[n],o,r,false)
if(!s)Be.push(Re.$(Re.STATUSMSG_QUICK_STORE_FAIL_FULL,wt[n]))
else{for(var l=0;l<s.length;){var c=s[l++]
var _=s[l++]
inventoryMerge(e,{type:n,idx:c},t,_)
r-=_}if(!r)inventoryDeselect(e)}}function unequip(e,t){quickTransfer(e,t)
Pe()}function canEquipFromContainer(e){var t=canEquip(e)
var r=false
var a=false
if(!t)return{can_possibly_equip:t,can_equip:r,should_equip:a}
var i=g.contents[bt]
if(!i&&e.attr1===f.STONE)a=true
if(!i||canUnequip(i))r=true
return{can_possibly_equip:t,can_equip:r,should_equip:a}}function equipFromContainer(e,t){ce(-1!==bt)
var r=g.contents[bt]
var a={type:oe,idx:bt}
if(r)unequip(e,a)
inventorySwap(e,t,a)
inventoryDeselect(e)}function equipDragDroppedItem(e){if(!Nt)return
var t=Mt
var r=t.each_data[Nt.type][Nt.idx]
if(r!==e)return
if(Nt.type===oe)return
var a=canEquipFromContainer(r),i=a.can_possibly_equip,o=a.can_equip
if(!i)return
if(Nt.type===ae){inventorySwap(t,Nt,{type:oe,idx:bt})
inventoryDeselect(t)}else if(Nt.type===ie){if(!o)return
equipFromContainer(t,Nt)}else ce(false)}function acceptsItemEquip(e,t,r){var a
var i
if(t.type===oe){if(!r.inv)return ne
a=t
i=r}else if(r.type===oe&&t.type===ae){if(!t.inv)return se
a=r
i=t}if(a)if(Te(a.idx,i.inv))return le
else return ne
return se}function inventoryUITick(){if(yt!==_e.frame_index-1){Et=[]
yt=_e.frame_index
return}yt=_e.frame_index
for(var e=Et.length-1;e>=0;--e){var t=Et[e]
var r=t.p0,a=t.p1,i=t.start,o=t.inv,n=t.time,s=t.dist
var l=(_e.frame_timestamp-i)/n
if(l>=1){d(Et,e)
continue}var c=a[1]-r[1]
var _=r[1]+l*c-rt(.2*s,.5*r[2])*it(l*at)
inventoryButton({x:u(l,r[0],a[0]),y:_,z:Z.UI+100,w:r[2],base_name:"inv_active",draw_only:true},o)}}function doInventorySubOneItem(e,t){var r=e.ctx,a=e.inv_type,i=e.ii,o=e.x,n=e.y,s=e.z,l=e.slot_w,c=e.no_quickbar,_=e.disabled,u=e.quick_transfer_cb,d=e.accepts_item_cb,f=e.split_cb,v=e.quick_transfer_label,h=e.swap_cb,p=e.quick_transfer_label_one,m=e.empty_inv,g=e.colors,E=e.count_override,y=e.allow_empty_select,T=e.label_style,I=e.equip_is_visible,S=e.start_idx,A=e.sortable,w=e.is_trash
if(t){r=r||t.ctx
u=u||t.quick_transfer_cb
d=d||t.accepts_item_cb
I=I||t.equip_is_visible
v=v||t.quick_transfer_label
p=p||t.quick_transfer_label_one
h=h||t.swap_cb
y=y||t.allow_empty_select
c=c||t.no_quickbar
l=l||t.slot_w
S=S||t.start_idx
A=A||t.sortable}p=p||Re.INVENTORYUI_AMOUNT_ONE
var L=r,R=L.any_locked,x=L.each_data,O=L.each_target,b=L.prev_dragged
var N=x[pt.type][pt.idx]
var C=x[a][i]
var M=a===pt.type&&i===pt.idx
if(C&&!R&&!C.isAllowedInInventory()&&!Xe()){de().serverLog("removed_illegal_item_from_inv",{inv:C,unlimited:ge()})
Ie(ctxTrans(r),O[a],i)
C=null}var D=false
if(!M&&N&&w&&C){D=true
C=null}var P={x:o,y:n,z:s+2,w:l,h:l,disabled:!C&&!N&&!y||R||_,drag_target:true,key:a+","+i,label_style:T}
var k=true
if(C&&!R){inventoryButtonPrep(P,C)
var B=ue.drag(pe({payload:C,min_dist:me},P))
if(B){inventoryButton(pe({disabled:true,x:B.cur_pos[0]-l/2,y:B.cur_pos[1]-l/2,z:Z.DRAG,base_name:"inv_active",draw_only:true,key_is_src:true},P),C)
N=C
pt.type=a
pt.idx=i
M=true
k=false
P.tooltip=null
Nt={type:a,idx:i}
Ct=_e.frame_index
Mt=r}}if(k){P.colors=g
P.count_override=E}e.draw_inv_item=k
P.base_name=M&&k?"inv_selected":C&&k?"inv_active":"inv_empty"
var U=k&&C||m
if(U)if(w)P.tooltip=Re.$(Re.TLTP_ITEM_IN_TRASH,U.getName())
else if(c)P.tooltip=U.getName()
else P.tooltip=U.getName()+"\n"+De("2-"+(fe.split_build?7:8),Re.TLTP_PLACE_IN_QB)
var G={type:a,idx:i,inv:C}
var F=se
if(d&&!P.disabled)F=d(r,G,{type:pt.type,idx:pt.idx,inv:N})
if(F===le&&(!M||!k)){P.color=dt
P.base_name="inv_highlight"
if(!N&&m)F=ne}else if(F===ne&&b){P.base_name=C||a===ie?"inv_disabled":"inv_empty"
P.disabled=true}if(w){var W=.7
st.draw({x:o+(1-W)*l/2,y:n+(1-W)*l/2,z:s+5,w:l*W,h:l*W,frame:Ze.TRASH,color:C?_t:ut})
P.colors=ke.quickbar_colors_empty}if(a===oe){P.disabled_mouseover=true
if(!C||!k){P.tooltip=Re.$(Re.TLTP_EQUIPMENT_SLOT,Ee[i].label)
P.tooltip+="\n\n"+(ge()?Re.TLTP_EQUIPMENT_SLOT_DEFAULT_TOOLS:Re.TLTP_EQUIPMENT_SLOT_DEFAULT_CRUDE_TOOLS)
var j=.7
st.draw({x:o+(1-j)*l/2,y:n+(1-j)*l/2,z:s+3,w:l*j,h:l*j,frame:Ee[i].frame,color:ct})}else{P.tooltip=C.getName()+"\n\n"+Re.$(Re.TLTP_EQUIPMENT_SLOT,Ee[i].label)
if(canUnequip(C)){var H=ue.touch_mode?Re.INPUT_TAP_DOUBLE:Re.INPUT_KEY_SHIFT_CLICK
P.tooltip+="\n"+De(H,Re.TLTP_EQUIPMENT_UNEQUIP)}}}else{if(b&&b.type===oe&&C&&!Te(b.idx,C)){P.base_name="inv_disabled"
P.disabled=true}if(!b&&C&&k&&!w){var z=v||Re.LBL_TRANSFER
if(I){if(canEquip(C)){var V=ue.touch_mode?Re.INPUT_TAP_DOUBLE:Re.INPUT_KEY_SHIFT_CLICK
P.tooltip+="\n\n"+De(V,Re.TLTP_EQUIPMENT_EQUIP)}}else if(u){P.tooltip+="\n"
if(F===le)P.tooltip+="\n"+De(Re.INPUT_CLICK,z)
if(C.count>1)P.tooltip+="\n"+De(Re.INPUT_KEY_SHIFT_CLICK,Re.$(Re.TLTP_STACK,z))+"\n"+De(Re.INPUT_KEY_CTRL_CLICK,Re.separateWords(z,p))
else P.tooltip+="\n"+De(Re.INPUT_KEY_SHIFT_CLICK,z)}if(C.count>1&&f&&Se.canSplit(O[a],i,S))P.tooltip+="\n"+De(Re.INPUT_CLICK_RIGHT,Re.TLTP_EQUIPMENT_SPLIT_STACK)}}var Y=!R&&M&&C&&!Xe()
if(Y&&k)P.tooltip+=w?"\n"+De(Re.INPUT_KEY_DEL,Re.TLTP_TRASH_EMPTY):"\n"+De(Re.INPUT_KEY_DEL,Re.TLTP_TRASH)
if(f)P.button_long_press=true
var q=false
if(A&&ue.click({x:P.x,y:P.y,w:P.w,h:P.h,button:1})){Se.transSort(O[a])
q=true}P.dynamic_snapshot_on_mouseover=Boolean(k&&C)
var K=false
var X=inventoryButton(P,k&&C||m)
if(X&&!q){var Q=ue.keyDown(ue.KEYS.CTRL)||ue.padButtonDown(ue.PAD.RT)
var J=ue.keyDown(ue.KEYS.SHIFT)||ue.padButtonDown(ue.PAD.LT)||!Q&&ve.button_click&&0===ve.button_click.button&&ve.button_click.was_double_click
var $=ve.button_click&&(2===ve.button_click.button||ve.button_click.long_press)
var ee=C&&$e(C.count/2)
var te
if(C&&J&&$&&u&&u(r,G,C,ee))inventoryDeselect(r)
else if(C&&J&&u&&u(r,G,C,Infinity))inventoryDeselect(r)
else if(C&&Q&&u&&u(r,G,C,1))inventoryDeselect(r)
else if(C&&f&&$)f(r,G)
else if(M)inventoryDeselect(r)
else if(C&&N&&(te=Le(C,N))&&F!==ne){inventoryMerge(r,G,pt,te)
inventoryDeselect(r)}else if(!C&&N&&F!==ne){if(!(h&&h(r,pt,G))){if(D)Ie(ctxTrans(r),O[a],i)
inventorySwap(r,pt,G)}inventoryDeselect(r)}else if(X.drag_drop&&N&&F!==ne){if(!(h&&h(r,pt,G))){if(D)Ie(ctxTrans(r),O[a],i)
inventorySwap(r,pt,G)}inventoryDeselect(r)}else if(F===le){if(!(h&&h(r,pt,G))){ce(!D)
inventorySwap(r,pt,G)}inventoryDeselect(r)}else{inventorySelect(r,G)
K=true}Nt=null}else if(Y&&!q)if(ue.keyDownEdge(ue.KEYS.DEL)){if(w)Ie(ctxTrans(r),O[a],i)
else if(O[ae]){var re=ye.container_size-1
if(ye.contents[re])Ie(ctxTrans(r),O[ae],re)
inventorySwap(r,{type:ae,idx:re},G)}else Ie(ctxTrans(r),O[a],i)
inventoryDeselect(r)}if(he()&&!w)setMouseoverItem(C)
return K}function splitItem(e,t,r){var a=t.each_target
if(Se.canSplit(a[r.type],r.idx,e)){var i=ctxTrans(t)
Se.transSplit(i,a[r.type],r.idx,e)
return true}return false}var Dt=n()
function doInventorySub(e){var d=e.ctx,t=e.inv_type,r=e.no_quickbar,a=e.final,i=e.x0,s=e.scale,o=e.info_x,n=e.info_y,l=e.no_buttons,c=e.skip_empty,_=e.hide_trash
var u=e.start_idx||0
var f=d.has_container,v=d.any_locked,h=d.each_data,p=d.each_target
var m=d.each_size[t]
var g=t===ae
if(g)--m
var E=g&&!_
var y=e.z||Z.UI
var T
function drop(e){var t=Se.getDropPos()
if(!t)Be.push(Re.STATUSMSG_CANNOT_DROP)
else{T=T||xe()
Se.transDrop(T,p[e.type],e.idx,t)
if(e.type===oe)Pe()}}function takeAll(e,t){var r=false
var a=h[t]
var i=te(p[t])
for(var o=0;o<i;++o){var n=a[o]
if(!n)continue
var s={type:t,idx:o}
var l=$(p[e],n,n.count,false)
if(l)for(var c=0;c<l.length;){var _=l[c++]
var u=l[c++]
inventoryMerge(d,{type:e,idx:_},s,u)}if(h[t][o])if(!r){r=true
Be.push(e?Re.$(Re.STATUSMSG_CANNOT_PUT,wt[e]):Re.$(Re.STATUSMSG_CANNOT_TAKE,wt[e]))}}}var I=e.y
var S=Ce()
var A=ve.button_height*s
var w=A
var L=i
if(!r)ke.quickbarScrollView()
var R=Se.locked(p[e.inv_type])
var x=splitItem.bind(null,u)
var O=w+X*s
var b=I
for(var N=u;N<m;++N){if(c&&!h[t][N]){inventoryButtonPrep({x:L,y:I,z:y,w:w,key:t+","+N})
continue}doInventorySubOneItem({x:L,y:I,z:y,inv_type:t,ii:N,split_cb:x,slot_w:w},e)
L+=O
if(N!==m-1&&(L+w>S||t===oe)){L=i
I+=O}}J(Dt,i,b+(I+w-b)/2)
qe("inventory_slots",Dt)
if(E){var C=I
if(L+w>S)C+=O
doInventorySubOneItem({x:et((S-w-i)/O)*O+i,y:C,z:y,inv_type:t,ii:m,slot_w:w,is_trash:true},e)}L=i
I+=w+X*s
if(R){ve.drawRect(i-Q,e.y-Q,S+Q,I,Z.UI+20,Ue)
lt.drawSizedAligned(Fe,i,e.y,Z.UI+21,2*ve.font_height,lt.ALIGN.HVCENTERFIT,S-i,I-e.y,Re.INVENTORYUI_REFRESHING_CONTENTS)}I+=be*s
var M=2*w
var D=.8
var P=i
var k=A*D
function ctxButton(e,t,r,a,i){var o=(r||M)*D
var n=ve.buttonText({x:L,y:I,w:o,h:k,font_height:.5*k,text:e,disabled:t,drag_target:true,tooltip:a,in_event_cb:i&&!ue.touch_mode?ue.pointerLockEnter:null})
if((L+=o+be*s)+M>=S){L=P
I+=k+be*s}return n}var B=h[pt.type][pt.idx]
var U=pt.type===ae&&pt.idx===ye.container_size-1
if(a&&!l){if(void 0!==o){L=P=o
I=n}var G=2*ve.font_height*s
var F=ve.font_height*s
if(B){var W=L+20*s
lt.drawSizedAligned(Ye[B.getRarity()],W,I,y,G,lt.ALIGN.HFIT,S-W,0,B.getName()+(B.stackable?" ("+B.count+")":""))
I+=G
var j=B.getDesc()
var H=L+40*s
for(var z=0;z<j.length;++z)I+=lt.drawSizedWrapped(Ge,H,I,y,S-H,16*s,F,j[z])}I+=be
if(B){if(f)if(ctxButton([Re.BTN_PUT,Re.BTN_TAKE][pt.type],v)){quickTransfer(d,pt)
B=null}if(ctxButton(Re.BTN_DROP,!Se.canDrop()||R)&&B){drop(pt)
B=null
inventoryDeselect(d)}if(!U&&ctxButton(Re.BTN_SPLIT,!Se.canSplit(p[pt.type],pt.idx,u)||R)&&B){T=T||xe()
Se.transSplit(T,p[pt.type],pt.idx,u)}if(!U&&B&&B.consumable)if(ctxButton(Re.BTN_CONSUME,R)){T=T||xe()
Se.consumeEx(T,p[pt.type],pt.idx,1)}if(ctxButton(Re.BTN_INFO,R)&&B)Ae({x:ft-re,y:ve.button_height,auto_close:true,inv:B,context:we})
if(f&&canEquip(B))if(canEquip(B))if(ctxButton(Re.BTN_EQUIP,v)){var V={type:oe,idx:bt}
inventorySwap(d,pt,V)
inventorySelect(d,V)}if(!f&&B&&B.tool_page)if(ctxButton(Re.BTN_USE,R,null,Re.TLTP_ADD_QUICKBAR,true)){ke.selectByItem(B)
Oe.menuExit()}}else{var Y=f?1.5*A/D:1.5*w
if(ctxButton(Re.BTN_SORT,R,Y,""+De(Re.INPUT_CLICK_MIDDLE,Re.TLTP_SORT_AND_STACK)))Se.transSort(ye)
if(f){if(ctxButton(Re.BTN_TAKE_ALL,v||ee(p[ie])))takeAll(ae,ie)
if(ctxButton(Re.BTN_PUT_ALL,v||ee(p[ae])))takeAll(ie,ae)}else if(ctxButton(Re.BTN_QUICK_DEPOSIT,R,3*w,Re.TLTP_DEPOSIT_ALL_NEARBY))quickDeposit()}L=i
I+=k+be*s}if(a){var q={x:Ne(),y:ve.button_height,w:Ce()-Ne(),h:Me()-ve.button_height,button:0}
if(ue.click(q)){B=null
inventoryDeselect(d)}q.button=1
if(ue.click(q))Se.transSort(p[t])
if(B){q.button=0
ue.dragDrop(q)
ue.dragOver(q)
var K
if(Se.canDrop())if(ue.dragDrop({x:-Infinity,y:-Infinity,w:Infinity,h:Infinity})){drop(pt)
B=null
inventoryDeselect(d)}else if(K=ue.dragOver({x:-Infinity,y:-Infinity,w:Infinity,h:Infinity}))ve.drawTooltip({x:K.cur_pos[0],y:K.cur_pos[1]+20,tooltip:Re.TLTP_DROP,tooltip_width:100})
setSelectedItem(B)}}e.y=I}function doPaperDollInventoryOverlay(e,t){var r=e.x,a=e.y,i=e.w,o=e.button_h
var n=Z.PAPERDOLL+1
var s=48*o/64
var l=a+8
doInventorySub({ctx:t.ctx,quick_transfer_cb:t.quick_transfer_cb,accepts_item_cb:t.accepts_item_cb,split_cb:t.split_cb,allow_empty_select:true,x0:r+i-ve.button_height*t.scale-8,inv_type:oe,y:l+s+24,z:n,final:false,sortable:false,scale:t.scale})
var c=.5*i
p({x:r+(i-c)/2,y:l+s+4,z:n,w:c,h:.5*o,font_height:.5*s,always_show:{stamina:true},verbose:true})}function handlePaperdollDragAndDrop(e){var t=e.x,r=e.y,a=e.w,i=e.h
var o=!(Se.locked(ye)||Se.locked(g))&&getDroppedItem({x:t,y:r,w:a,h:i})
if(o)if(o.is_gather)equipDragDroppedItem(o)
else if(o.consumable){var n=Mt.each_target
Se.consumeEx(xe(),n[pt.type],pt.idx,1)}}function quickTransferEquip(e,t,r,a){if(t.type!==oe&&canEquip(r)){var i={type:oe,idx:bt}
inventorySwap(e,t,i)
inventorySelect(e,i)
return true}else if(t.type===oe&&canUnequip(r)){unequip(e,t)
return true}return false}function doInventory(e){var t={ctx:doInventorySetupContext({}),x0:0,inv_type:ae,y:e,final:false,scale:1.15,quick_transfer_cb:quickTransferEquip,accepts_item_cb:acceptsItemEquip,equip_is_visible:true,sortable:true,no_quickbar:fe.split_build&&!fe.quickbar_force_show}
var r={x:0,y:e,w:ft,h:vt,button_h:ht}
if(D()===M){t.y=e+vt+8
t.info_x=ft+8
t.info_y=e}else t.x0=ft+8
U(r,t)
if(!Xe()){t.final=true
doInventorySub(t)}inventoryUITick()}var Pt=6
function computeScale(e,t,r){var a=8
var i=e+Pt
var o=Me()-Pt-i
var n=Pt
var s=Ce()-Pt-n
var l=0
var c=Ce()-l
var _=ve.button_height
for(var u=et((s-(1.5*_+a)+X)/(_+X));;u++){var d=s/(1.5*_+a+u*(_+X)-X)
d=rt(d,1)
var f=$e(t/u)
var v=et((c/d+X)/(_+X))
var h=$e(r/v)
if(d*tt((_+X)*f+be,1.5*_+2*a+_+be)+d*((_+X)*h+be)+d*(6*ve.font_height+be)+d*(_+be)<=o)return d}}function quickTransferContainer(e,t,r,a){quickTransfer(e,t,a)
return true}function doContainer(e){var t=Z.UI
var r=Ce()
var a=k()
if(!a){Oe.menuExit()
return Re.INVENTORYUI_MISSING_CONTAINER}var i=Pt
var o=e+Pt
var n=a.toItem()
n=a.fallback?T(n):n
var s=computeScale(e,a.container_size,I(a))
var l=8*s
var c=ve.button_height*s
var _=1.5*c
var u={x:i,y:o,w:_,z:t+2}
inventoryButtonPrep(u,n)
u.img.draw(u)
var d={ctx:doInventorySetupContext({prop:a}),x0:i,inv_type:ie,y:o,no_quickbar:true,sortable:true,scale:s,quick_transfer_cb:quickTransferContainer}
var f=.8*c
if(ve.buttonText({x:i,y:o+=_+l,w:_,h:f,font_height:.5*f,text:Re.BTN_SORT,tooltip:""+De(Re.INPUT_CLICK_MIDDLE,Re.TLTP_SORT_AND_STACK),disabled:Se.locked(a),drag_target:false}))Se.transSort(a)
o+=c+l+be*s
d.x0=i+=_+l
doInventorySub(d)
d.y=tt(d.y,o)
ve.drawBox({x:0,y:e,w:r,h:d.y-e-be*s+Pt,z:t},ve.sprites.section_border,.5,v)
d.x0=0
d.inv_type=ae
d.final=true
doInventorySub(d)
inventoryUITick()
return n.getName()}},{"../common/globals":197,"../common/materials_common":201,"../glov/client/cmds":244,"../glov/client/engine":250,"../glov/client/input":271,"../glov/client/net":279,"../glov/client/settings":291,"../glov/client/ui":306,"../glov/common/util":330,"../glov/common/verify":331,"../glov/common/vmath":332,"./build_mode":27,"./huds":87,"./inventory":94,"./item_info_view":97,"./items":98,"./layout":99,"./localization/localization":108,"./main":112,"./menu":117,"./paperdoll":125,"./quickbar":142,"./status":156,"./styles":160,"./tutorial":166,"./ui_util":168,"./user_data":170,"./voxel_data":175,"./worlds_sound":187,assert:void 0}],96:[function(e,t,r){"use strict"
r.setLastModProp=setLastModProp
r.startup=startup
r.shift=shift
r.removeIncoming=removeIncoming
r.tickItemAnims=tickItemAnims
r.add=add
var v=e("assert")
var a=e("../glov/client/engine")
var i=e("../glov/client/quat")
var o=i.createQuat
var _=i.qRotateZ
var u=i.qSlerp
var n=e("../glov/common/util")
var s=n.clamp
var d=n.easeIn
var l=n.empty
var c=n.isInteger
var h=n.ridx
var f=n.sign
var p=e("../glov/common/vmath")
var m=p.unit_vec
var g=p.v3add
var E=p.v3addScale
var y=p.v3copy
var T=p.v3iAdd
var I=p.v3iFloor
var S=p.v3lerp
var A=p.v3same
var w=p.v3scale
var L=p.v3sub
var R=p.v4copy
var x=p.vec3
var O=e("../common/globals")
var b=O.CHUNK_SIZE
var N=O.CS2
var C=e("../common/ids").ITEM_BAG
var M=e("../common/voxel_data_common")
var D=M.ANIM_STYLE_BEAM
var P=M.ANIM_TYPE_PLAYER
var k=M.ANIM_TYPE_POS
var B=e("./inventory").inventoryOverlap
var U=e("./items")
var G=U.createItem
var F=U.itemEqualLoose
var W=U.itemPotentiallyMergeable
var j=e("./mobs").getEntityAnimPos
var H=e("./props")
var z=H.PROP_GRAVITY
var V=H.PROP_TERMINAL_VELOCITY
var Y=H.bagCalcDrawOffs
var q=H.bagDraw
var K=e("./voxel_data")
var Z=K.chunkIdFromLocalFloatPos
var X=K.getPropLighting
var Q=K.getPropLocalExact
var J=Math.min,$=Math.exp,ee=Math.random
var te=[]
var re={}
v(V)
var ae=z/V
var ie=250
var oe=null
function setLastModProp(e){oe=e}function startup(){}function shift(e){for(var t=0;t<te.length;++t){var r=te[t]
T(r.src_pos,e)
if(r.src_type===k)T(r.src_int_pos,e)
if(r.target_type===k){T(r.target_pos,e)
T(r.target_int_pos,e)}T(r.pos,e)}}function animRemove(e,t){if(void 0!==t)v.equal(te[t],e)
var r=re[e.chunk_id]
var a=r[e.pos_idx]
v(a)
h(a,a.indexOf(e))
if(!a.length){delete r[e.pos_idx]
if(l(r))delete re[e.chunk_id]}if(void 0!==t)h(te,t)}var ne=x()
function animAdd(e,t){e.chunk_id=Z(ne,e.target_pos)
I(ne)
e.pos_idx=ne[0]+ne[1]*b+ne[2]*N
var r=re[e.chunk_id]
if(!r)r=re[e.chunk_id]={}
var a=r[e.pos_idx]
if(!a)a=r[e.pos_idx]=[]
a.push(e)
if(!t)te.push(e)}function animUpdatePos(e){var t=Z(ne,e.target_pos)
I(ne)
var r=ne[0]+ne[1]*b+ne[2]*N
if(t===e.chunk_id&&r===e.pos_idx)return
if(t!==e.chunk_id){animRemove(e)
e.chunk_id=t
e.pos_idx=r
animAdd(e,true)}else{var a=re[e.chunk_id]
var i=a[e.pos_idx]
h(i,i.indexOf(e))
if(!i.length)delete a[e.pos_idx]
e.pos_idx=r
if(!(i=a[e.pos_idx]))i=a[e.pos_idx]=[]
i.push(e)}}function removeIncoming(e,t,r,a){var i=re[t]
if(!i)return e
var o=i[r]
if(!o)return e
v(o.length)
var n=e
for(var s=0;s<o.length;++s){var l=o[s]
l.target_quat=a
for(var c=0;c<l.contents.length;++c){var _=l.contents[c]
var u=_.count
for(var d=n.length-1;d>=0;--d){var f=n[d]
if(F(_,f)){if(n===e)n=e.map(G)
h(n,d)
break}else if(W(_,f)){if(n===e)n=e.map(G)
if(u===f.count){h(n,d)
break}else if(u<f.count){n[d].count-=u
break}else if(u>f.count){h(n,d)
u-=f.count}}}}}if(!n.length){o[0].driving_animation=true
R(a,o[0].quat)}return n}function v3IsInteger(e){return c(e[0])&&c(e[1])&&c(e[2])}var se=x(0,0,.005)
function addDrawOffs(e,t){var r=Q(t)
var a
if(r&&!A(r.size,m)){var i=.4
E(e,t,m,i)
e[0]+=ee()*(r.size[0]-2*i)
e[1]+=ee()*(r.size[1]-2*i)
e[2]+=ee()*(r.size[1]-2*i)-i
a=.002*ee()-.001}else{var o=(15&t[0])+(15&t[1])*b+(15&t[2])*N
a=Y(o,se)
g(e,t,se)}return a}function ItemAnim(e){v(e)
v(e.style)
v(e.target_type)
v(e.target)
v(e.src_type)
v(e.src)
v(e.item||e.items)
this.style=e.style
this.valid=true
this.rot_speed=0
this.target_type=e.target_type
if(this.target_type===P){this.target_id=e.target
this.target_pos=x()}else{this.target_int_pos=e.target.slice(0)
v(v3IsInteger(this.target_int_pos))
this.target_pos=x()
this.rot_speed=addDrawOffs(this.target_pos,e.target)}this.src_type=e.src_type
if(this.src_type===P){this.src_pos=j(e.src)
if(!this.src_pos){this.valid=false
return}this.src_pos=this.src_pos.slice(0)}else{this.src_int_pos=e.src.slice(0)
v(v3IsInteger(this.src_int_pos))
this.src_pos=x()
var t=addDrawOffs(this.src_pos,e.src)
if(!this.rot_speed)this.rot_speed=t
if(e.from_center)this.src_pos[2]+=.5}this.pos=this.src_pos.slice(0)
if(e.item){v(!e.items)
e.items=[e.item]}this.contents=e.items.map(G)
this.counter=0
this.quat=o()
this.target_quat=null
this.draw_opts={}}var le=x()
ItemAnim.prototype.launch=function(){if(this.style===D);else{this.t=0
L(le,this.target_pos,this.src_pos)
this.vel=w(x(),le,1.25*ae)
var e=le[2]+.5
this.vel[2]=.0015+.006*s(e,-1,1)}}
ItemAnim.prototype.tick=function(e){if(this.target_type===P){var t=j(this.target_id)
if(!t)return true
y(this.target_pos,t)
animUpdatePos(this)}var r=false
this.counter+=e
if(this.style===D){if(this.counter>=ie)r=true
var a=d(J(this.counter/ie,1),2)
S(this.pos,a,this.src_pos,this.target_pos)
if(this.target_quat)u(this.quat,a,this.quat,this.target_quat)}else{this.t+=e
var i=$(-this.t*ae)
var o=false
for(var n=0;n<2;++n)if(this.vel[n]){this.pos[n]=this.src_pos[n]+this.vel[n]/ae*(1-i)
if(f(this.vel[n])===f(this.pos[n]-this.target_pos[n])){this.vel[n]=0
this.pos[n]=this.target_pos[n]}else o=true}else this.pos[n]=this.target_pos[n]
if(this.vel[2]){this.pos[2]=this.src_pos[2]+(this.vel[2]-V)/ae*(1-i)+V*this.t
var s=this.vel[2]*i+V*(1-i)
if(this.pos[2]<this.target_pos[2]&&s<0){this.pos[2]=this.target_pos[2]
this.vel[2]=0}else o=true}else this.pos[2]=this.target_pos[2]
if(!o)r=true
if(this.target_quat)if(this.driving_animation){_(this.quat,this.quat,e*this.rot_speed)
this.driving_animation=false}else u(this.quat,J(1,this.t/500),this.quat,this.target_quat)}var l=this.draw_opts.sun_factor
var c=this.draw_opts.torch_factor
X(this.draw_opts,this.target_pos)
if(!this.draw_opts.sun_factor)this.draw_opts.sun_factor=l||0
if(!this.draw_opts.torch_factor)this.draw_opts.torch_factor=c||0
q(this.pos,this,true)
return r}
function tickItemAnims(){if(!te.length)return
var e=a.frame_dt
for(var t=te.length-1;t>=0;--t){var r=te[t]
if(r.tick(e))animRemove(r,t)}}function add(e){var t=new ItemAnim(e)
if(!t.valid)return
if(t.src_type===k)for(var r=te.length-1;r>=0;--r){var a=te[r]
if(a.target_type===k&&A(a.target_int_pos,t.src_int_pos)){var i=B(t.contents,a.contents)
if(i){v(i.length)
if(!a.contents.length)animRemove(a,r)
e.item=null
e.items=[]
var o=new ItemAnim(e)
o.contents=i
y(o.src_pos,a.pos)
y(o.pos,a.pos)
R(o.quat,a.quat)
o.launch()
animAdd(o)}}}if(t.contents.length){if(t.src_type===k){var n=Q(t.src_int_pos)||oe
if(n&&n.item_id===C)R(t.quat,n.quat)}t.launch()
animAdd(t)}}},{"../common/globals":197,"../common/ids":198,"../common/voxel_data_common":209,"../glov/client/engine":250,"../glov/client/quat":287,"../glov/common/util":330,"../glov/common/vmath":332,"./inventory":94,"./items":98,"./mobs":120,"./props":141,"./voxel_data":175,assert:void 0}],97:[function(e,t,r){"use strict"
r.itemInfoViewClear=itemInfoViewClear
r.itemInfoViewing=itemInfoViewing
r.itemInfoViewShow=itemInfoViewShow
r.itemInfoViewPush=itemInfoViewPush
r.itemInfoViewDraw=itemInfoViewDraw
r.itemInfoViewTick=itemInfoViewTick
r.ITEM_INFO_VIEW_H=r.ITEM_INFO_VIEW_W=void 0
var A=450
r.ITEM_INFO_VIEW_W=A
var w=700
r.ITEM_INFO_VIEW_H=w
var K=e("assert")
var L=e("../glov/client/camera2d")
var R=e("../glov/client/engine")
var a=e("../glov/client/input")
var x=a.mouseDownAnywhere
var O=a.mouseDownOverBounds
var X=e("../glov/client/input")
var Q=e("../glov/client/scroll_area").scrollAreaCreate
var J=e("../glov/client/ui")
var i=e("../glov/common/vmath")
var c=i.vec2
var o=i.vec4
var n=e("../common/ids")
var s=n.ITEM_INGOT
var $=n.TYPE_CRAFT_CLASS
var ee=n.TYPE_ITEM
var te=n.TYPE_RECIPE
var re=n.TYPE_SETTLEMENT_UPGRADE
var l=e("../common/materials_common")
var ae=l.CraftClass
var ie=l.Mat
var oe=e("./blueprint").blueprintGetDef
var ne=e("./blueprint_manage").blueprintMetaEdit
var _=e("./crafting_recipes")
var se=_.craftingRecipes
var le=_.getItemExamples
var ce=e("./factory_ui").drawZoomed
var _e=e("./inventory").countAvailable
var u=e("./inventory_ui")
var ue=u.inventoryButton
var de=u.inventoryButtonPrep
var d=e("./items")
var fe=d.ITEM_CONTEXT_BUILD
var ve=d.ITEM_CONTEXT_ITEM
var he=d.ITEM_CONTEXT_SETTLEMENT_UPGRADE
var pe=d.createItem
var f=d.createItemLite
var me=d.isItem
var ge=d.itemIsBlueprint
var v=d.itemIsPlaceable
var Ee=d.itemIsSettlementLocked
var ye=d.itemIsUnlimited
var h=d.sameItem
var b=e("./layout").layoutCameraTallWide
var Te=e("./localization/localization").L
var N=e("./main")
var C=e("./menu")
var p=e("./styles")
var Ie=p.inventory_style
var Se=p.inventory_style_warn
var Ae=p.label_style
var we=p.menu_header_style
var m=e("./todo_list")
var M=m.TODO_TOGGLE
var D=m.todoIsInList
var P=m.todoListAdd
var k=m.todoTooltip
var Le=e("./ui_util")
var Re=e("./world_metadata").unlimitedMode
var xe=Math.ceil,Oe=Math.max,be=Math.floor
var Ne=null
var g=null
var Ce={}
var E=f({type:$,id:ae.FUEL})
function isFuelCraftClass(e){return h(e,E)}function itemInfoViewClear(){g=Ne
Ne=null}var y
function itemInfoMap(e,t){if(e.recipe_item)e=e.recipe_item
if(!v(e))t=ve
if(e.type===$&&e.id===ae.SCALED_INGOT)e=y=y||pe({type:ee,id:s,attr1:ie.ANY})
if(e.has_hp&&e.hp_cur<e.hp_max)(e=pe(e)).hp_cur=e.hp_max
return{inv:e,context:t}}function itemInfoViewing(e,t){var r=itemInfoMap(e,t),a=r.inv,i=r.context
return Ne&&h(Ne.inv,a)&&Ne.context===i||g&&g.last_frame>=R.frame_index-1&&h(g.inv,a)}function itemInfoViewShow(e){var t=e.x,r=e.y,a=e.auto_close,i=e.is_future,o=e.hint
var n=itemInfoMap(e.inv,e.context),s=n.inv,l=n.context
if(Ne&&Ne.last_frame>=R.frame_index-1&&h(Ne.inv,s)||g&&g.last_frame===R.frame_index&&h(g.inv,s)){itemInfoViewClear()
return}K(l)
if(!v(s))l=ve
Ne={pos:c(t,r),inv:s,frame:R.frame_index,last_frame:R.frame_index,context:l,stack:[s],context_stack:[l],auto_close:a,is_future:i,hint:o}
if(Ce[0])Ce[0].resetScroll()}function itemInfoViewPush(e,t){if(!Ne){itemInfoViewShow({inv:e,context:t,x:(L.w()-A)/2,y:(L.h()-w)/2,auto_close:true})
return}if(Ce[Ne.stack.length])Ce[Ne.stack.length].resetScroll()
var r=itemInfoMap(e,t),a=r.inv,i=r.context
Ne.stack.push(a)
Ne.context_stack.push(i)
Ne.inv=a
Ne.context=i}function itemInfoViewPop(){K(Ne.stack.length>1)
Ne.stack.pop()
Ne.context_stack.pop()
Ne.inv=Ne.stack[Ne.stack.length-1]
Ne.context=Ne.context_stack[Ne.context_stack.length-1]}var Me=4
var B=8
var De=16
var Pe=o(1,1,1,.2)
function itemInfoViewDraw(e){var c=e.x,t=e.y0,_=e.z,r=e.w,a=e.h,i=e.context,o=e.inv,n=e.has_stack,s=e.is_future,l=e.scroll_idx,u=e.style,d=e.zoom,f=e.hint
var v=t
var h=J.font
var p=J.font_height
var m=i===fe?o.getBuildName():o.getName()
var g=o.getDesc(false,i)
var E
if(i===ve&&o.isCrafted())E=o.getCraftCost()
var y=o
var T=o.type===te
var I
if(T)if(I=se()[o.attr1])y=I.icon
var S=200
var A={x:c+(r-S)/2,y:v,w:S,h:S,z:_,draw_only:true,hide_count:true}
if(o.type===re){A.frame=Le.ARROW
A.rot=Math.PI
A.y+=A.h
A.x+=A.w
Le.sprite.draw(A)}else if("unlock"===u&&!Ne){A.dynamic_snapshot=true
A.base_name="inv_info"
A.shrink=.921
A.ignore_no_spin=true
ue(A,y)}else{A.dynamic_snapshot_on_mouseover=true
de(A,y)
A.img.draw(A)}var w=v+=S+8
var L
if(void 0!==d&&d<1){L=h.getStringWidth(we,1.5*J.font_height,m)
ce(d,h,we,we,c,v,_+1,1.5*J.font_height,h.ALIGN.HCENTERFIT,r,null,m)}else L=h.drawSizedAligned(we,c,v,_+1,1.5*J.font_height,h.ALIGN.HCENTERFIT,r,0,m)
v+=1.5*J.font_height
L=Oe(L,h.drawSizedAligned(we,c,v,_,J.font_height,h.ALIGN.HCENTERFIT,r,0,i===fe?Te.LBL_ITEM_CONTEXT_BUILD:i===he?Te.LBL_ITEM_CONTEXT_SETTLEMENT_UPGRADE:T?Te.LBL_ITEM_CONTEXT_RECIPE:Te.LBL_ITEM_CONTEXT_ITEM))
v+=J.font_height
var R=2.5*J.font_height
var x=c+(r-L)/2-R-8
Le.sprite.draw({x:Oe(c,x),y:w,z:_,w:R,h:R,frame:i===fe?Le.BUILD:i===he?Le.HOME:T?Le.CRAFTING:Le.INVENTORY,color:x<c-12?Pe:void 0})
v+=Me
var O=Ce[l]
if(!O)O=Ce[l]=Q({background_color:null,auto_hide:true})
var b={x:c,y:v,z:_,w:r,h:t+a-v}
O.begin(b)
var N=r-O.barWidth()
c=v=0
var C=ge(o)&&oe(o.getBID())
if(C&&(C.loaded||C.error))v=ne(v,N,o,C)
if(f)v+=h.drawSizedWrapped(Ae,c,v,_,N,De,J.font_height,f)+Me
for(var M=0;M<g.length;++M)v+=h.drawSizedWrapped(Ae,c,v,_,N,De,J.font_height,g[M])+Me
var D=false
var P=J.button_height+2
function gridShow(e,t){var r="unlock"===u&&e.length>2?3:2
var a=(N-(r-1)*Me)/r
var i=c
var o=v
for(var n=0;n<e.length;++n){var s=e[n]
if(!me(s))s=e[n]=pe(s)
c=i+n%r*(a+Me)
v=o+be(n/r)*P
var l={x:c,y:v,z:_,w:J.button_height,extra_w:a,base_name:"inv_active",style:Ie}
if(s.isCrafted()&&s.attr1!==ie.ANY)l.tooltip=Te.TLTP_VIEW_CRAFT_COST
else l.tooltip=Te.TLTP_VIEW_ITEM_INFO
t(l,s)
if(ue(l,s))itemInfoViewPush(s,ve)
h.drawSizedAligned(l.style,c+l.w+4,v,_,p,h.ALIGN.VCENTER|h.ALIGN.HWRAP|h.ALIGN.HFIT,a-l.w-5,P,s.getName())}c=i
v=o+xe(e.length/r)*P}if(i===fe||i===he){D=true
var k=o.cost
if(C)if(!C.loaded)k=[]
else k=C.cost
var B=false
if(i===fe){var U=_e(o)
B=!(s&&!n)
if(!U&&B){var G=Te.ITEMINFO_CANT_AFFORD_ALERT
v+=h.drawSizedWrapped(Se,c,v,_+1,N,De,p,G)+Me}if(o.is_settlement_locked){v+=h.drawSizedWrapped(Se,c,v,_+1,N,De,p,Te.MSG_OUT_OF_SETTLEMENT_ALERT)+Me
if(Ee(o)){D=false
v+=h.drawSizedWrapped(Se,c,v,_+1,N,De,p,Te.ITEMINFO_SETTLEMENT_LOCKED_ALERT)+Me}}}if(o.unlimited_only)v+=h.drawSizedWrapped(Se,c,v,_+1,N,De,p,Te.ITEMINFO_UNLIMITED_ONLY_ALERT)+Me
else if(k&&!o.unlimited_only){v+=Me
v+=h.drawSizedWrapped(Ie,c,v,_+1,N,De,p,i===fe?Te.addColon(Te.LBL_BUILD_COST):Te.addColon(Te.LBL_REQUIRES))+Me
gridShow(k,function(e,t){if(!ye(o)){var r=_e(t,false,true)
if(r<t.count&&B){e.base_name="inv_empty"
e.style=Se}e.count_override=r+" / "+t.count}})}}else{if(!(T?1:_e(o))&&o.tool_page){var F=Te.ITEMINFO_NOT_IN_INVENTORY_ALERT
v+=h.drawSizedWrapped(Se,c,v,_+1,N,De,p,F)+Me}var W=o.getInfo()
if(W)v+=h.drawSizedWrapped(Ie,c,v,_+1,N,De,p,W)+Me
if(T){K(I)
v+=h.drawSizedWrapped(Ie,c,v,_+1,N,De,p,I.desc+".")+Me}if(o.recipe_list&&o.attr1===ie.ANY){v+=h.drawSizedWrapped(Ie,c,v,_+1,N,De,p,Te.addColon(Te.LBL_EXAMPLES))+Me
gridShow(o.recipe_list.map(function(e){return se()[e].icon}),function(e,t){e.hide_count=true})}else if(o.isCrafted()){D=true
v+=h.drawSizedWrapped(Ie,c,v,_+1,N,De,p,E&&E.count>1?Te.addColon(Te.$(Te.LBL_CRAFT_FROM_AMOUNT,E.count)):Te.addColon(Te.LBL_CRAFT_FROM))+Me
gridShow(E,function(e,t){if(!Re()&&!isFuelCraftClass(t)){var r=_e(t,false,true)
if(r<t.count)e.base_name="inv_empty"
e.count_override=r+" / "+t.count}})
if(E.at_factory&&E.at_factory.length){v+=h.drawSizedColorWrapped(Ie,c,v,_+1,N,De,p,255,Te.addColon(Te.LBL_CRAFTED_BY))+Me
for(var j=0;j<E.at_factory.length;++j){var H=pe({type:ee,id:E.at_factory[j]})
var z={x:c,y:v,z:_,w:J.button_height,extra_w:N,hide_count:true,base_name:"inv_active",tooltip:Te.TLTP_VIEW_BUILD_INFO}
if(ue(z,H))itemInfoViewPush(H,fe)
h.drawSizedAligned(Ie,c+z.w+8,v,_,p,h.ALIGN.VCENTER|h.ALIGN.HWRAP,N-z.w-8,P,H.getName())
v+=P}}}if(o.type===$||o.has_variants&&o.attr1===ie.ANY){var V=le(o.type,o.id)
if(V.length>0){v+=h.drawSizedColorWrapped(Ie,c,v,_+1,N,De,p,255,Te.addColon(Te.LBL_EXAMPLES))+Me
gridShow(V,function(e,t){if(o.type===$&&o.id===ae.FUEL)e.count_override=""+t.getFuelRate()
else e.hide_count=true})}}}O.end(v)
c=e.x
var Y=false
var q=X.click(b)
if(q&&2===q.button)Y=true
if(Re())D=false
return{pinnable:D,dismiss:Y}}function itemInfoViewTick(){if(!Ne)return
var e=Ne,t=e.inv,r=e.pos,a=e.frame,i=e.last_frame,o=e.context,n=e.stack,s=e.auto_close,l=e.is_future,c=e.hint
if(i<R.frame_index-1||X.pointerLocked()){itemInfoViewClear()
return}L.push()
b()
Ne.last_frame=R.frame_index
if(r[0]+A>L.x1())r[0]=L.x1()-A
if(r[1]+w>L.y1())r[1]=L.y1()-w
if(r[0]<L.x0())r[0]=L.x0()
if(r[1]<L.y0())r[1]=L.y0()
var _=Z.ITEM_INFO_VIEW
var u=r[0]
var d=u+B
var f=A-2*B
var v=r[1]
var h=n.length>1
var p=itemInfoViewDraw({scroll_idx:n.length-1,x:d,y0:v,z:_,w:f,h:w-B,has_stack:h,is_future:l,context:o,inv:t,hint:h?null:c}),m=p.dismiss,g=p.pinnable
var E=.75*J.button_height
if(h)if(J.buttonText({x:u+B,y:v+B,z:_+2,w:E,h:E,font_height:E,text:"←"})||X.keyDownEdge(X.KEYS.BACKSPACE))itemInfoViewPop()
if(g)if(J.buttonImage({x:d+f-2*E-8,y:v+B,z:_+2,w:E,h:E,img:Le.sprite,frame:D(t,o)?Le.PINNED:Le.PIN,tooltip:k(t,o)}))P(t,o,M)
if(J.buttonImage({x:d+f-E,y:v+B,z:_+2,w:E,h:E,img:Le.sprite,frame:Le.X})||!h&&X.keyDownEdge(X.KEYS.BACKSPACE))m=true
var y=R.frame_index!==a
var T={x:u,y:v,w:A,h:w}
if(X.drag(T));if(y&&!C.active()&&!O(T)&&x())m=true
if(y&&N.chat_ui.isFocused())m=true
var I={x:u,y:v,z:_-1,w:A,h:w,pixel_scale:.25,color:C.panel_color_popup}
if(X.click(I))m=true
var S=!(C.active()&&C.isBuildMenu())
if(y&&s&&X.click({peek:true})||S&&X.keyDownEdge(X.KEYS.ESC)||m)itemInfoViewClear()
J.panel(I)
L.pop()}},{"../common/ids":198,"../common/materials_common":201,"../glov/client/camera2d":241,"../glov/client/engine":250,"../glov/client/input":271,"../glov/client/scroll_area":289,"../glov/client/ui":306,"../glov/common/vmath":332,"./blueprint":24,"./blueprint_manage":25,"./crafting_recipes":59,"./factory_ui":79,"./inventory":94,"./inventory_ui":95,"./items":98,"./layout":99,"./localization/localization":108,"./main":112,"./menu":117,"./styles":160,"./todo_list":165,"./ui_util":168,"./world_metadata":186,assert:void 0}],98:[function(e,t,r){"use strict"
r.itemLocalizationStartup=itemLocalizationStartup
r.createItemLite=createItemLite
r.parseAttribMods=parseAttribMods
r.Item=Item
r.craftClassAndMatToItem=craftClassAndMatToItem
r.itemIsAccountLocked=itemIsAccountLocked
r.getItemsForCraftClass=getItemsForCraftClass
r.createItem=createItem
r.getItemsForMatAny=getItemsForMatAny
r.itemPrototypePoke=itemPrototypePoke
r.itemCheck=itemCheck
r.isItem=isItem
r.itemFromJSON=itemFromJSON
r.itemIsBlueprint=itemIsBlueprint
r.itemIsBlueprintReady=itemIsBlueprintReady
r.addItemAdjectives=addItemAdjectives
r.itemPotentiallyMergeable=itemPotentiallyMergeable
r.itemPartiallyMergeable=itemPartiallyMergeable
r.itemFullyMergeable=itemFullyMergeable
r.satisfiesCost=satisfiesCost
r.satisfiesCostLoose=satisfiesCostLoose
r.itemEqualLoose=itemEqualLoose
r.itemEqual=itemEqual
r.itemIsUnlimited=itemIsUnlimited
r.itemIsSettlementLocked=itemIsSettlementLocked
r.itemIsPlaceable=itemIsPlaceable
r.itemIsAllowedInQuickbar=itemIsAllowedInQuickbar
r.notLiquid=notLiquid
r.snapshotOverLimit=snapshotOverLimit
r.itemGetGfx=itemGetGfx
r.itemGetGfxQueued=itemGetGfxQueued
r.itemsTick=itemsTick
r.startup=startup
r.sprite_blueprint_bg=r.mode_list_block_size=r.ITEM_ID_DESC=r.ITEM_ID_NAME=r.ITEM_CONTEXT_SETTLEMENT_UPGRADE=r.ITEM_CONTEXT_ITEM=r.ITEM_CONTEXT_BUILD=r.TOOL_BASE_HP=r.sameItem=r.DYNAMIC_COST_FUNCS=r.COST_FUNCS=r.BRUSH_SIZES=void 0
var a,i
function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]
for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))e[a]=r[a]}return e}).apply(this,arguments)}var o=e("../glov/common/vmath")
var n=o.unit_vec
var s=o.v2set
var l=o.v2sub
var c=o.vec2
var _=o.vec3
var u=o.zero_vec
var d=e("../common/items_common")
var f=d.processUnlockableVariants
var h=d.sameItem
e("not_worker")
var p={def:n,"1x1":n,"2x2":_(2,2,2),"3x3":_(3,3,3),"2x1":_(2,2,1),"3x1":_(3,3,1)}
r.BRUSH_SIZES=p
var m={}
r.COST_FUNCS=m
var g={}
r.DYNAMIC_COST_FUNCS=g
var E=h
r.sameItem=E
var y=2e3
r.TOOL_BASE_HP=y
var M=1
r.ITEM_CONTEXT_BUILD=M
var T=2
r.ITEM_CONTEXT_ITEM=T
var I=3
r.ITEM_CONTEXT_SETTLEMENT_UPGRADE=I
var S=[]
r.ITEM_ID_NAME=S
var A=[]
r.ITEM_ID_DESC=A
var w=e("assert")
var L=e("../glov/client/camera2d")
var R=e("../glov/client/engine")
var x=e("../glov/client/error_report").errorReportSetDetails
var D=e("../glov/client/localization").getStringFromLocalizable
var O=e("../glov/client/sprites").spriteCreate
var b=e("../glov/common/util")
var N=b.cloneShallow
var C=b.empty
var P=b.isInteger
var k=b.merge
var B=b.ridx
var U=e("../glov/common/verify")
var G=e("../common/entitlements")
var F=G.propToEntitlementKey
var W=G.registerItemEntitlements
var j=e("../common/globals").STACK_SIZE
var H=e("../common/ids")
var z=H.INV_ITEM_NAME
var V=H.ITEM_BERRY
var Y=H.ITEM_BLOCK_PREVIEW
var q=H.ITEM_BLUEPRINT
var K=H.ITEM_BOTTLE
var Z=H.ITEM_BUCKET
var X=H.ITEM_CARROT
var Q=H.ITEM_CHEST_MEDIUM
var J=H.ITEM_COAL
var $=H.ITEM_CORN
var ee=H.ITEM_DOOR
var te=H.ITEM_DOWSER_ADVANCED
var re=H.ITEM_DOWSER_SIMPLE
var ae=H.ITEM_HANDSTOOL
var ie=H.ITEM_HATCHET
var oe=H.ITEM_HOE
var ne=H.ITEM_ID_CODE_NAME
var se=H.ITEM_INGOT
var le=H.ITEM_JUICE
var ce=H.ITEM_LIQUID
var _e=H.ITEM_MUSHROOM
var ue=H.ITEM_ORE
var de=H.ITEM_PAINT
var fe=H.ITEM_PICKAX
var ve=H.ITEM_PIE
var he=H.ITEM_PLANT
var pe=H.ITEM_PUMPKIN
var me=H.ITEM_ROAST_VEGETABLES
var ge=H.ITEM_ROD
var Ee=H.ITEM_SANDWICH
var ye=H.ITEM_SEASHELL
var Te=H.ITEM_SEEDS_WHEAT
var Ie=H.ITEM_SHOVEL
var Se=H.ITEM_SPICE
var Ae=H.ITEM_STARFISH
var we=H.ITEM_TOMATO
var Le=H.ITEM_TOOL_HEAD
var Re=H.ITEM_UNKNOWNID
var xe=H.ITEM_WAYGATE
var Oe=H.ITEM_WHEAT
var be=H.ITEM_WILD_CROP
var Ne=H.TYPE_BLOCK
var Ce=H.TYPE_CRAFT_CLASS
var Me=H.TYPE_ITEM
var De=H.TYPE_RECIPE
var Pe=H.TYPE_SETTLEMENT_UPGRADE
var ke=e("../common/materials_common")
var Be=ke.CraftClass
var Ue=ke.Mat
var Ge=e("../common/world_constants").ATTRIB_FIXED_MAX
var Fe=e("./autogen/item_defs")
var We=e("./baking").assertBakeRuleExists
var je=e("./blueprint").blueprintGetDef
var He=e("./build_menu").blueprintMetaName
var ze=e("./build_mode")
var Ve=ze.doStamina
var Ye=ze.unlimitedMode
var qe=e("./crafting").craftClassMatches
var Ke=e("./crafting_mods")
var Ze=Ke.CMODS
var Xe=Ke.CMOD_FORMAT
var Qe=Ke.CMOD_TABLE
var Je=Ke.RARITY_LABEL
var $e=e("./crafting_recipes")
var et=$e.craftingRecipes
var tt=$e.getCraftCost
var rt=e("./dowser_advanced").DOWSER_ADVANCED_BASE_LEN
var at=e("./dowser_simple").DOWSER_SIMPLE_BASE_LEN
var it=e("./inventory")
var ot=it.INV_PLAYER
var nt=it.canFit
var st=it.transInvAdd
var lt=e("./localization/localization").L
var ct=e("./main")
var _t=e("./materials")
var ut=_t.CRAFT_CLASS_DESC
var dt=_t.CRAFT_CLASS_NAME
var ft=_t.INV_MATERIAL_NAME
var vt=_t.INV_MATERIAL_TIER
var ht=_t.LAST_LOCALIZED_MATERIAL_CLASS
var pt=_t.MATERIAL2_DURABILITY_FACTOR
var mt=_t.MATERIAL2_STAMINA_FACTOR
var gt=_t.MATERIAL_CLASS
var Et=_t.MATERIAL_CLASS_NAME
var yt=_t.MATERIAL_CODE_NAME
var Tt=_t.MATERIAL_DURABILITY_FACTOR
var It=_t.MATERIAL_MAX_STONE_TIER
var St=_t.MATERIAL_NAME
var At=_t.MATERIAL_TIER
var wt=_t.MATERIAL_TOOL_DIG_RATE
var Lt=_t.MATERIAL_UNLIMITED_SPECIAL
var Rt=_t.METAL_TIERS
var xt=_t.MaterialClass
var Ot=e("./proc_gen").oreLowestStoneTier
var bt=e("./props")
var Nt=e("./props")
var Ct=Nt.validFlowerType
var Mt=Nt.validMushroomType
var Dt=e("./settlement")
var Pt=Dt.settlementCurrent
var kt=Dt.settlementLastBound
var Bt=e("./status")
var Ut=e("./stone_tiers")
var Gt=Ut.STONE_TIER_DEPTH
var Ft=Ut.STONE_TIER_NAMES
var Wt=e("./tiles")
var jt=e("./tiles").TILE_WATER
var Ht=e("./ui_util")
var zt=e("./ui_util").STAMINA_SYMBOL
var Vt=e("./user_data")
var Yt=Vt.userAttribModMaxTrans
var qt=Vt.userDataGet
var Kt=Vt.userDataIsWaiting
var Zt=Vt.userStaminaMod
var Xt=e("./waygate_upgrade").WAYGATE_UPGRADES
var Qt=e("./world_comm").getPerm
var Jt=e("./world_metadata").adventureMode
var $t=Math.floor,er=Math.max,tr=Math.min,rr=Math.round
var ar=Wt.tile_map_default
w(ar)
var ir=["1x1","2x2","3x3"]
r.mode_list_block_size=ir
var or=["1x1","2x1","3x1"]
var nr=[]
nr[ae]=["1x1"]
var sr=[]
var lr=[" ","flip"]
var cr=[]
cr[fe]=[]
cr[fe][xt.STONE]=1
cr[fe][xt.METAL]=1
cr[ie]=[]
cr[ie][xt.WOOD]=1
cr[Ie]=[]
cr[Ie][xt.DIRT]=1
cr[Ie][xt.INGREDIENT]=1
cr[Ie][xt.PAINT]=1
cr[ae]=[]
cr[ae][xt.DIRT]=.33
cr[ae][xt.WOOD]=1
cr.flint_blade=[]
cr.flint_blade[xt.WOOD]=1
cr.flint_blade[xt.STONE]=.5
var _r=[]
_r[Z]=true
_r[ce]=true
var ur=[]
ur[fe]=lt.LBL_HAFT
ur[ie]=lt.LBL_HAFT
ur[Ie]=lt.LBL_HAFT
ur[oe]=lt.LBL_HAFT
var dr=((a={})[Ue.BLUE_BERRY]=V,a[Ue.RED_BERRY]=V,a[Ue.YELLOW_BERRY]=V,a[Ue.CORN]=$,a[Ue.TOMATO]=we,a[Ue.PUMPKIN]=pe,a[Ue.CARROT]=X,a[Ue.BROWN_MUSHROOM]=_e,a[Ue.LUMINESCENT_MUSHROOM]=_e,a[Ue.RED_MUSHROOM]=_e,a[Ue.CORAL_MUSHROOM]=_e,a[Ue.HOT]=Se,a[Ue.PUNGENT]=Se,a[Ue.SAVORY]=Se,a)
function itemLocalizationStartup(){for(var e=0;e<=ht;++e){var t=xt[e]
var r=lt.get("MATERIAL_CLASS_"+t+"_NAME")
w(r,"Unlocalized Material Class name.")
Et[e]=r}for(var a in yt){var i=yt[a]
if("ANY"!==i&&"NONE"!==i){var o=ft[i]
var n=lt.get("MAT_"+i+"_NAME")
w(n,"Unlocalized Material name.")
St[o]=n}}for(var s=0;s<Gt.length;++s){var l=lt.get("STONE_TIER_T"+s)
w(l,"Unlocalized Stone Tier name.")
Ft[s]=l}var c=1
var _=Be[c]
while("string"===typeof _){var u=lt.get("CRAFT_CLASS_"+_+"_NAME")
var d=lt.get("CRAFT_CLASS_"+_+"_DESC")
w(u,"Unlocalized Craft Class name.")
dt[c]=u
ut[c]=d
_=Be[++c]}for(var f in Wt.tile_code_name){var v=lt.get("TILES_"+Wt.tile_code_name[f]+"_NAME")
var h=lt.get("TILES_"+Wt.tile_code_name[f]+"_NAME_BLOCK")
var p=lt.get("TILES_"+Wt.tile_code_name[f]+"_INFO")
Wt.tile_name[f]=v
Wt.tile_name_block[f]=h
Wt.tile_info[f]=p}for(var m in Wt.liquid_code_name){var g=lt.get("TILES_"+Wt.liquid_code_name[m]+"_NAME")
Wt.liquid_name[m]=g}for(var E=0;E<ne.length;++E){var y=ne[E]
if(y){var T=lt.get(y+"_NAME")
var I=lt.get(y+"_DESC")
S[E]=T
A[E]=I}}}var fr
var vr
r.sprite_blueprint_bg=vr
var hr={}
var pr={}
var mr={}
function ItemLite(e){w(e.type)
w.equal(typeof e.id,"number")
this.type=e.type
this.id=e.id
this.count=e.count||1
this.attr1=e.attr1||0
this.attr2=e.attr2||0
this.attr3=e.attr3||0
w(!e.attribs)}ItemLite.prototype.attribs=null
function createItemLite(e){return new ItemLite(e)}var gr=function(){var e=[]
for(var t in ar){t=Number(t)
if(!isFinite(t))continue
var r=ar[t].inv
w(r)
var a=[]
for(var i=0;i<r.length;++i)a.push(new ItemLite(r[i]))
e[t]=a}return e}()
var Er=[]
m.identity=function identity(e,t){t=t||1
w(!e.attr2)
var r=e.id+","+e.attr1+","+e.attr3+","+t
var a=Er[r]
if(!a)a=Er[r]=new ItemLite({type:Me,id:e.id,attr1:e.attr1,attr3:e.attr3,count:t})
return a}
m.item=function item(e){return new ItemLite(e)}
m.fromMaterial=function fromMaterial(e,t,r){var a=t+r
w(a)
w(!(t&&r))
var i=e.attr1||e.def_material
if(gt[i]===xt.METAL)return new ItemLite({type:Me,id:se,attr1:i,count:a})
var o
if(r)o=ar.material_crafted_map[i]
if(!o){o=ar.material_map[i]
if(!U(o))o=ar.material_map[Ue.WOOD]}return new ItemLite({type:Ne,id:o,count:a})}
g.waygate=function(){if(Jt()&&!Kt()&&!qt("used_free_settlement"))return[]
return this.cost}
function parseAttribMods(e){var t={}
for(var r in e)t[Ze[r]]=e[r]
return t}function Item(e){this.type=e.type
this.id=e.id
this.preview_item=pr
this.initBase(e)}Item.prototype.name=null
Item.prototype.desc=null
Item.prototype.info=null
Item.prototype.is_item=true
Item.prototype.color=null
Item.prototype.need_thumbnail_update=true
Item.prototype.loading_gfx=pr
Item.prototype.mode_list=null
Item.prototype.mode_list_ids=null
Item.prototype.pick_as_id=null
Item.prototype.pick_as_mode=null
Item.prototype.flippable=false
Item.prototype.brush_size=null
Item.prototype.stackable=true
Item.prototype.is_gather=false
Item.prototype.consumable=false
Item.prototype.consume_attribs=null
Item.prototype.placeable=true
Item.prototype.cost=null
Item.prototype.dynamic_cost=null
Item.prototype.is_crafted=false
Item.prototype.no_spin=false
Item.prototype.potentially_unlimited=false
Item.prototype.allowed_in_inventory=false
Item.prototype.no_attribs=false
Item.prototype.rooted=false
Item.prototype.intangible=true
Item.prototype.tangible_height=null
Item.prototype.always_interact=false
Item.prototype.draw_scale=1/7
Item.prototype.clickable=true
Item.prototype.mineable=true
Item.prototype.size=_(1,1,1)
Item.prototype.size_auto=false
Item.prototype.no_auto_rot=false
Item.prototype.flips_on_x=false
Item.prototype.baked_key=null
Item.prototype.mat_baked_key=null
Item.prototype.preview_block_map=null
Item.prototype.preview_block_id=0
Item.prototype.on_flow=null
Item.prototype.underwater_only=false
Item.prototype.snapshot_size=null
Item.prototype.is_container=false
Item.prototype.ignore_take=false
Item.prototype.craft_classes=null
Item.prototype.has_variants=false
Item.prototype.tool_page=false
Item.prototype.is_settlement_locked=false
Item.prototype.is_recipe=false
Item.prototype.recipe_list=null
Item.prototype.floater_z=0
Item.prototype.unlock_display_item=null
Item.prototype.place_rot=0
Item.prototype.def_material=0
Item.prototype.unlimited_only=false
Item.prototype.unlimited_only_for_build_menu=false
Item.prototype.unlockable_variants=null
Item.prototype.variable_yield=false
Item.prototype.sysadmin_only=false
Item.prototype.fuel_rate_map=null
Item.prototype.fuel_rate=0
Item.prototype.dig_rate=0
Item.prototype.cost_mat_map=null
Item.prototype.attribs=null
Item.prototype.has_hp=false
Item.prototype.particles_always_on_in_unlimited=false
Item.prototype.progress_indicator=true
Item.prototype.initBase=function(e){this.count="number"===typeof e.count?e.count:1
this.attr1=e.attr1||0
this.attr2=e.attr2||0
this.attr3=e.attr3||0
for(var t in e.attribs){w(!this.stackable)
var r=e.attribs[t]
w(r)
w(P(r))
if(!this.attribs)this.attribs={}
this.attribs[t]=r}}
Item.prototype.initBaked=function(){this.baked_key=this.mat_baked_key[this.attr1]||this.mat_baked_key.def
if("string"!==typeof this.baked_key)this.baked_key=this.baked_key[this.attr3]||this.baked_key.def}
Item.prototype.initPreviewBlock=function(){this.preview_block_id=this.preview_block_map[this.attr1]||this.preview_block_map.def}
Item.prototype.initFuelRate=function(){this.fuel_rate=void 0!==this.fuel_rate_map[this.attr1]?this.fuel_rate_map[this.attr1]:this.fuel_rate_map.def||0}
var yr=function(){var e={}
for(var t in ar){var r=ar[t]
if(r.craft_class&&r.mat&&!r.not_material_source){var a=e[r.craft_class]=e[r.craft_class]||{}
w(!a[r.mat])
a[r.mat]=Number(t)}}e[Be.STONE_RAW][Ue.FANCY_STONE]=Wt.STONE_LIGHT
return e}()
function craftClassAndMatToItem(e,t,r,a){var i=yr[e]
w(i)
var o=i[t]
if(a)return o
if(!o&&!R.DEBUG)for(var n in i){o=i[n]
break}w(o)
return new ItemLite({type:Ne,id:o,count:r})}Item.prototype.updateCostFromMatMap=function(){for(var e in this.cost_mat_map){var t=this[e]
if(t&&t!==Ue.ANY){var r=this.cost_mat_map[e]
var a=this.cost[r.cost_idx]
if(a.type===Me)a.attr1=t
else if(a.type===Ce)this.cost[r.cost_idx]=craftClassAndMatToItem(a.id,t,a.count)
else w(0)}}}
Item.prototype.attribSet=function(e,t){if(!t){if(this.attribs){delete this.attribs[e]
if(C(this.attribs))delete this.attribs}}else{if(!this.attribs)this.attribs={}
this.attribs[e]=t}}
Item.prototype.attribGet=function(e){return this.attribs&&this.attribs[e]||0}
Item.prototype.getStaminaRate=function(){return(mt[this.attr2]||1)*(2-(Qe[Ze.STAMINA_RATE][this.attribGet(Ze.STAMINA_RATE)]||1))}
Item.prototype.calcHP=function(){var e=Tt[this.getMaterial()]||.1
e*=pt[this.attr2]||1
e*=Qe[Ze.DURABILITY][this.attribGet(Ze.DURABILITY)]||1
this.hp_max=rr(e*y)
this.hp_cur=rr(this.attribGet("hp")/Ge*this.hp_max)}
Item.prototype.calcDigRate=function(){this.dig_rate_mod=wt[this.attr1]
if(isNaN(this.dig_rate_mod))this.dig_rate_mod=1
this.dig_rate_mod*=Qe[Ze.DIG_RATE][this.attribGet(Ze.DIG_RATE)]||1}
Item.prototype.setHP=function(e){this.hp_cur=e
this.attribSet("hp",this.hpToAttrib(e))}
Item.prototype.hpToAttrib=function(e){return rr(e/this.hp_max*Ge)}
Item.prototype.getRarity=function(){return this.attribs&&this.attribs[Ze.RARITY]||0}
var Tr=null
function toolSetModeList(e){if(sr[e.id]){var t=sr[e.id]
if(t[e.attr1])e.mode_list=t[e.attr1]}if(1===e.mode_list.length){e.brush_size=p[e.mode_list[0]]
e.mode_list=null}}function toolMaxTier(e){var t=[]
t[xt.METAL]=Rt[e.attr1]||Rt[Ue.STONE]
if(e.id===ae)t[xt.WOOD]=At[Ue.LEAF]
return t}function itemIsAccountLocked(e){if(e.unlockable_variants){var t=Ue.ANY
var r=Ue.NONE
for(var a=0;a<e.unlockable_variants.length;++a){var i=e.unlockable_variants[a]
var o=e.attr1,n=e.attr2,s=e.attr3
o=i.attr1===t?t:o||r
n=i.attr2===t?t:n||r
s=i.attr3===t?t:s||r
if(o===i.attr1&&n===i.attr2&&s===i.attr3)return!Qt("owned")[F(e.id,o,n,s)]}}return false}function getItemsForCraftClass(e){var t=[]
for(var r in Tr){var a=Tr[r]
for(var i in a){var o=a[i]
var n=o.prototype
if(n.craft_classes&&n.craft_classes[e]){var s={}
if(n.has_hp){s.attr1=Ue.IRON
s.attr2=Ue.WOOD}else if(n.has_variants)s.attr1=Ue.ANY
t.push(new o(s))}}}return t}function createItem(e){if(!e)return null
w(e.type)
w.equal(typeof e.id,"number")
var t=Tr[e.type][e.id]
if(U(t))return new t(e)
if(e.type===Me)return new(t=Tr[Me][Re])(e)
else{x("item",JSON.stringify(e))
w(false)
return null}}var Ir=((i={})[ye]=[{attr1:Ue.RED},{attr1:Ue.ORANGE},{attr1:Ue.YELLOW},{attr1:Ue.GREEN},{attr1:Ue.BLUE},{attr1:Ue.PURPLE}],i[Ae]=[{attr1:Ue.RED},{attr1:Ue.YELLOW},{attr1:Ue.BLUE}],i)
function getItemsForMatAny(e){var t=[]
var r=Ir[e]
if(r)for(var a=0;a<r.length;++a)t.push(createItem(_extends({type:Me,id:e},r[a])))
return t}function initPrototypes(){(Tr=[])[De]=[]
Tr[Pe]=[]
Tr[Ce]=[]
Tr[Ne]=[]
Tr[Me]=[]
function protoInit(e,t,r,a){if(a.debug_only&&!R.DEBUG)return null
if("string"===typeof t){w(z[t],"Unknown item ID: "+t)
t=z[t]}var i=r.prototype=Object.create(Item.prototype)
i.type=e
i.id=t
for(var o in a)i[o]=a[o]
if(a.fuel_rate){i.craft_classes=i.craft_classes||{}
i.craft_classes[Be.FUEL]=a.fuel_rate}if(a.has_hp){i.craft_classes=i.craft_classes||{}
i.craft_classes[Be.REPAIRABLE]=true}w(!Tr[e][t])
Tr[e][t]=r
return i}function initToolShared(e,t){protoInit(Me,e,function ItemTool(e){this.initBase(e)
toolSetModeList(this)
this.calcDigRate()
this.max_tier=toolMaxTier(this)
if(this.id===fe)this.max_stone_tier=It[this.attr1]
if(this.has_hp&&this.attr1!==Ue.ANY)this.calcHP()
if(Lt[this.attr1]){this.is_crafted=false
this.has_hp=false}},k({name:S[e],desc:A[e],size_auto:true,placeable:false,no_spin:true,stackable:false,is_gather:true,default_mode_idx:0,mode_list:nr[e]||ir,dig_rates:cr[e],allowed_in_inventory:true,max_stone_tier:0,has_hp:e!==ae,is_crafted:true},t||{}))}Fe.init(protoInit)
initToolShared(fe)
initToolShared(ie)
initToolShared(Ie)
initToolShared(ae,{img:"ui_util.HANDS",allowed_in_inventory:false})
protoInit(Me,q,function ItemBlueprint(e){this.initBase(e)},{name:"Placeholder Blueprint",cost:[createItemLite({type:Ce,id:Be.STONE_RAW})],flippable:true,mode_list:lr,loading_gfx:mr,baked_key:"bluebox-paused",def_material:Ue.STONE})
function ItemBlockPreview(e){this.initBase(e)}protoInit(Me,Y,ItemBlockPreview,{name:"Preview Block"})
var a=[]
function initBlock(e){var t=ar[e]
var r
if(t&&t.craft_class)(r={})[t.craft_class]=true
a[e]=protoInit(Ne,e,function ItemBlock(e){this.initBase(e)},{name:t.debug_only?"(Admin) "+Wt.tile_name[e]:Wt.tile_name[e],block_name:t.debug_only?"(Admin) "+Wt.tile_name_block[e]:Wt.tile_name_block[e],info:Wt.tile_info[e],mode_list:e===Wt.TILLED||e===Wt.TILLED_WATERED?or:ir,placeable:t&&!t.unplaceable,unlimited_only:t&&t.unlimited_only,cost:gr[e].length?gr[e]:null,is_crafted:t&&t.crafted,allowed_in_inventory:t&&t.allowed_in_inventory&&(!t.debug_only||R.defines.DEBUG),sysadmin_only:t.debug_only,variable_yield:t&&t.variable_yield,fuel_rate:t&&t.fuel_rate||0,craft_classes:r})}for(var e=0;e<256;++e)initBlock(e)
function initCraftClass(e){var t={placeable:false}
t.name=dt[e]
t.desc=ut[e]
switch(e){case Be.WOOD_RAW:t.preview_item=new ItemBlockPreview({attr1:Wt.WOOD})
break
case Be.WOOD_PLANK:t.preview_item=new ItemBlockPreview({attr1:Wt.PLANKS_WOOD})
break
case Be.BRICK:t.preview_item=new ItemBlockPreview({attr1:Wt.BRICK_STONE})
break
case Be.STONE_RAW:t.preview_item=new ItemBlockPreview({attr1:Wt.STONE})
break
case Be.FUEL:t.preview_item=createItem({type:Me,id:J})
break
case Be.SCALED_INGOT:t.preview_item=createItem({type:Me,id:se})
break
case Be.GRINDABLE:t.preview_item=createItem({type:Me,id:Oe})
break
case Be.BAKED_FOOD:t.preview_item=createItem({type:Me,id:ve,atttr1:Ue.PUMPKIN})
break
case Be.FARMING_SEED:t.preview_item=createItem({type:Me,id:Te})
break
case Be.INGREDIENT:t.preview_item=createItem({type:Me,id:we})
break
case Be.REPAIRABLE:t.img=fr
t.frame=Ht.GATHERING_TOOLS
break
case Be.WHEAT_CORN:t.preview_item=createItem({type:Me,id:Oe})
break
case Be.VEGETABLE:t.preview_item=createItem({type:Me,id:X})
break
case Be.PIE_FILLING:t.preview_item=createItem({type:Me,id:pe})}protoInit(Ce,e,function ItemCraftClass(e){this.initBase(e)},t)}for(var t=1;t<=Be.PIE_FILLING;++t)initCraftClass(t)
protoInit(Pe,-1,function ItemSettlementUpgrade(e){this.initBase(e)
this.upgrade_data=Xt[this.attr1]
this.cost=Object.values(this.upgrade_data.cost)},{})
protoInit(De,-1,function ItemRecipe(e){this.initBase(e)
var t=et()[this.attr1]
this.name=(null==t?void 0:t.name)||lt.$(lt.RECIPE_UKNOWN,this.attr1)},{cost:[],is_crafted:true})
function protoPostProcess(e){var t=e.prototype
if(t.placeable)t.potentially_unlimited=true
if(t.is_crafted)t.allowed_in_inventory=true
if(t.brush_size){w.equal(typeof t.brush_size,"string")
w(p[t.brush_size],t.brush_size)
t.brush_size=p[t.brush_size]}if(t.img){if("string"===typeof t.img){w(t.img.startsWith("ui_util."))
t.frame=Ht[t.img.slice(8)]
w(t.frame,t.img)
t.img=fr}t.need_thumbnail_update=false}function processMatBakedKey(e){var t={}
for(var r in e){var a=e[r]
if("def"===r)t[r]="string"===typeof a?a:processMatBakedKey(a)
else{var i=ft[r]
w(i,"Invalid material name: "+r)
t[i]="string"===typeof a?a:processMatBakedKey(a)}}w(t.def)
return t}if(t.mat_baked_key)t.mat_baked_key=processMatBakedKey(t.mat_baked_key)
if(t.unlockable_variants){t.unlockable_variants=f(t.unlockable_variants)
W(t.id,t.unlockable_variants)}if(t.preview_block_map){var r={}
for(var a in t.preview_block_map)if("def"===a){var i=t.preview_block_map.def
var o=Wt[i]
w(o,"Invalid tile name: "+i)
r.def=o}else{var n=ft[a]
w(n,"Invalid material name: "+a)
var s=t.preview_block_map[a]
var l=Wt[s]
w(l,"Invalid tile name: "+s)
r[n]=l}w(r.def)
t.preview_block_map=r}if(t.fuel_rate_map){var c={}
for(var _ in t.fuel_rate_map){var u=t.fuel_rate_map[_]
w.equal(u,$t(u))
if("def"===_)c.def=u
else{var d=ft[_]
w(d,"Invalid material name: "+_)
c[d]=u}}t.fuel_rate_map=c}if(t.fuel_rate)w.equal(t.fuel_rate,$t(t.fuel_rate))}for(var r in Tr){var i=Tr[r]
for(var o in i)protoPostProcess(i[o])}for(var n=0;n<a.length;++n)a[n].preview_item=new ItemBlockPreview({attr1:n})}function itemPrototypePoke(e,t,r){var a=Tr[Me][e]
w(a)
a.prototype[t]=r}function itemCheck(){for(var e in Tr){var t=Tr[e]
for(var r in t){var a=t[r].prototype
if(a.mat_baked_key)for(var i in a.mat_baked_key){var o=a.mat_baked_key[i]
if("string"!==typeof o)for(var n in o)We(o[n])
else We(o)}if(a.baked_key)We(a.baked_key)
if(a.unlockable_variants)We(a.fallback_baked_key)
if(a.rooted&&!a.intangible)w(false,("1"===e?ne[r]:e+","+r)+": is both rooted and tangible, cannot be both")}}}function isItem(e){return e&&e.is_item}function itemFromJSON(e){return createItem(e)}Item.prototype.toJSON=function(e,t){w(this.type===Me||this.type===Ne||this.type===Pe||this.type===De)
var r={type:this.type,id:this.id}
if(!t&&1!==this.count){r.count=this.count
w(null!==r.count)}if(this.attr1)r.attr1=this.attr1
if(this.attr2)r.attr2=this.attr2
if(this.attr3)r.attr3=this.attr3
if(this.attribs)for(var a in this.attribs){var i=this.attribs[a]
w(i)
w(P(i))
if(!r.attribs)r.attribs={}
r.attribs[a]=i}return r}
ItemLite.prototype.toJSON=Item.prototype.toJSON
Item.prototype.toTransLog=function(){return this.type+","+this.id+","+(this.attr1||0)}
Item.prototype.same=function(e){return e&&this.type===e.type&&this.id===e.id&&(this.type===Ne||this.attr1===e.attr1&&this.attr2===e.attr2&&this.attr3===e.attr3)}
function itemIsBlueprint(e){return e.type===Me&&e.id===q}function itemIsBlueprintReady(e){var t=je(e.getBID())
return t&&t.loaded&&!t.error}Item.prototype.getBID=function(){if(itemIsBlueprint(this))return this.attr1
return null}
Item.prototype.getBlueprintName=function(){var e=this.getBID()
var t=He(e)
if(t&&"inherit"!==t)return t
return je(e).name}
Item.prototype.getShowCount=function(){return this.show_count||this.stackable}
Item.prototype.getMaterial=function(e){if(this.attr1&&!itemIsBlueprint(this)&&this.attr1!==Ue.ANY)return this.attr1
if(this.def_material)return this.def_material
if(this.type===Ne){var t=ar[this.id]
w(e||t)
if(!t)return 0
w(e||t.mat)
return t.mat}U(e)
return 0}
Item.prototype.getMaterialClass=function(){var e=this.getMaterial(true)
return gt[e]||xt.NONE}
Item.prototype.getFuelRate=function(){return this.fuel_rate}
Item.prototype.getQuality=function(){return this.attr3||0}
Item.prototype.updateThumbnail=function(e){bt.getForPreview(this,bt.PREVIEW_SNAPSHOT).getSnapshot(this,e)
this.thumbnail_updated=true
this.need_thumbnail_update=false}
var Sr=c()
var Ar=c()
Item.prototype.updateThumbnailDynamic=function(e){if(!e.snapshot_res){L.virtualToCanvas(Sr,u)
s(Ar,e.w,e.h)
L.virtualToCanvas(Ar,Ar)
l(Ar,Ar,Sr)
e.snapshot_res=$t(tr(Ar[0],Ar[1]))
e.pixel_perfect=true}bt.getForPreview(this,bt.PREVIEW_SNAPSHOT).getSnapshot(this,e)}
Item.prototype.consume=function(e){if(this.type===Me){switch(this.id){case le:var t=createItem({type:Me,id:K})
if(nt(t)){var r=ct.getFrameTransaction()
st(r,ot,t)}else Bt.get("ifull").setMessage(lt.MSG_INVENTORY_FULL)
break
default:Bt.push(lt.STATUSMSG_DELICIOUS)}if(this.consume_attribs)for(var a in this.consume_attribs){var i=this.consume_attribs[a]
if(a.startsWith(Ze.TIMED))Yt(e,a,i)
else if(a===Ze.STAMINA||a===Ze.STAMINA_DRAIN){var o=Qe[a][i]
w(o)
Zt(e,o)}else w(false)
if(Xe[a])Bt.push(Xe[a](this.consume_attribs,a))}}}
Item.prototype.isIngredientOrFood=function(){var e
return(null==(e=this.craft_classes)?void 0:e[Be.INGREDIENT])||this.consumable}
Item.prototype.showOnToolPage=function(){return this.consumable||this.tool_page}
Item.prototype.isAllowedInInventoryInitialCheck=function(){if(this.no_attribs&&(this.attr1||this.attr2||this.attr3))return false
if(this.type===Me){if(gt[this.attr1]===xt.INGREDIENT&&!this.isIngredientOrFood()||gt[this.attr1]&&gt[this.attr1]!==xt.INGREDIENT&&this.isIngredientOrFood())return false
if(this.isIngredientOrFood())if(!this.attr1&&this.baked_swap)return false
else if(this.attr3&&dr[this.attr3]!==Se)if(this.id!==_e)return false
switch(this.id){case de:case ye:return gt[this.attr1]===xt.PAINT
case Ae:return this.attr1===Ue.RED||this.attr1===Ue.YELLOW||this.attr1===Ue.BLUE
case le:case V:return dr[this.attr1]===V
case Se:return dr[this.attr3]===Se
case he:return Ct(this.attr3)
case _e:return Mt(this.attr1)
case Ee:case me:return dr[this.attr1]&&qe(Be.VEGETABLE,createItem({type:Me,id:dr[this.attr1]}))
case ve:return dr[this.attr1]&&qe(Be.PIE_FILLING,createItem({type:Me,id:dr[this.attr1]}))
case Z:return!this.attr3&&(!this.attr2||this.attr2===jt)&&pt[this.attr1]
case te:case re:if(this.attr1===Ue.MUTTAL)return false
return!this.attr3&&pt[this.attr2]&&gt[this.attr1]===xt.METAL&&pt[this.attr1]
case ue:if(this.attr1===Ue.MUTTAL)return false
case se:return!this.attr2&&!this.attr3&&gt[this.attr1]===xt.METAL&&this.attr1!==Ue.COAL&&!Lt[this.attr1]
case ge:return!this.attr2&&!this.attr3&&pt[this.attr1]&&!Lt[this.attr1]
case Le:return!this.attr2&&!this.attr3&&Tt[this.attr1]&&!Lt[this.attr1]
case fe:case ie:case Ie:case oe:if(this.attr3)return false
if(this.attr1===Ue.FLINT)return false
if(!Tt[this.attr1])return false
if(!pt[this.attr2])return false
return true}}return true}
Item.prototype.isAllowedInInventory=function(){if(!this.allowed_in_inventory)return false
if(!this.stackable&&this.count>1||this.count>j)return false
if(this.skip_allow_inventory_check)return true
this.skip_allow_inventory_check=true
this.allowed_in_inventory=this.isAllowedInInventoryInitialCheck()
return this.allowed_in_inventory}
function addItemAdjectives(e,t,r){if(t)if(r)return lt.$(lt.FORMAT_ITEM_2_ADJ,e,r,t)
else return lt.$(lt.FORMAT_ITEM_1_ADJ,e,t)
else if(r)return lt.$(lt.FORMAT_ITEM_1_ADJ,e,r)
else return e}Item.prototype.addAttributesToName=function(e,t){t=t||{}
var r=Ue.ANY
if(this.is_recipe)return e
else if(!t.no_material){var a=this.attr1!==r?St[this.attr1]:null
if(a&&t.attr1_is_name)e=a
if(void 0!==t.adj1_force)a=t.adj1_force
else if(a&&void 0!==t.adj1_replace)a=t.adj1_replace
var i=this.attr3!==r?St[this.attr3]:null
if(void 0!==t.adj3_force)i=t.adj3_force
else if(i&&void 0!==t.adj3_replace)i=t.adj3_replace
var o=addItemAdjectives(e,a,i)
if(t.attr3_as_num)o=lt.separateWords(o,lt.addNumberSign((this.attr3||0)+1))
if(o!==e)return o}if(t.no_any||this.attr1!==r)return e
else return lt.$(lt.FORMAT_ITEM_ANY_ADJ,e)}
Item.prototype.processItemNameAttributes=function(e,t){var r={no_material:t&&t.no_material}
switch(this.id){case q:var a=je(this.getBID())
var i=lt.ITEM_BLUEPRINT_NAME
var o=this.getBlueprintName()
if(o)if(t&&t.for_search)i=o
else i=lt.separateColon(i,o)
if(a.error)return lt.$(lt.ITEM_BLUEPRINT_NAME_ERROR,i)
else if(!a.loaded)return lt.$(lt.ITEM_BLUEPRINT_NAME_LOADING,i)
else if(o)return i
else return lt.ITEM_BLUEPRINT_NAME_UNKNOWN
case Ie:case fe:case ie:if(this.getMaterial(true)===Ue.FLINT){e=lt.ITEM_NAME_CRUDE_TOOL
r.adj1_force=null}break
case ce:e=Wt.liquid_name[this.attr2]||e
break
case he:var n=bt.mapToNameKeyFromFlowerType(this.attr3)
e=n&&lt.get("ITEM_SEEDS_"+n+"_NAME")||e
r.adj3_force=null
break
case ye:case Ae:var s=yt[this.attr1]
var l=ne[this.id]
e=s&&lt.get(l+"_"+s+"_NAME")||e
r.adj1_force=null
break
case Q:if(this.attr3){var c=yt[this.attr1]
var _=yt[this.attr3]
e=lt.get("ITEM_CHEST_MEDIUM_"+c+"_"+_+"_NAME")||e
r.adj1_force=null
r.adj3_force=null}break
case Z:r.adj3_force=this.attr2?lt.ITEM_ADJ_FULL:lt.ITEM_ADJ_EMPTY
break
case me:r.attr1_is_name=true
r.adj1_replace=lt.ITEM_ADJ_ROAST
break
case _e:r.attr1_is_name=true
r.adj1_force=null
break
case ee:case be:r.attr3_as_num=true
r.adj3_force=null}return this.addAttributesToName(e,r)}
Item.prototype.getName=function(e){if(this.type===Ne){if(this.name)return this.name
else if(this.unplaceable&&ar[this.id])return ar[this.id].name
return lt.$(lt.ITEM_NAME_UNKNOWN_BLOCK,this.id)}else if(this.type===Me){var t=this.name
if(!t)return lt.$(lt.ITEM_NAME_UNKNOWN_ITEM,this.id)
t=this.processItemNameAttributes(t,e)
if(this.attribs&&this.attribs[Ze.RARITY]){var r=Je[this.attribs[Ze.RARITY]]
t=lt.$(lt.FORMAT_ITEM_1_ADJ,t,r)}if(this.fallback)t=lt.addEllipsis(lt.addQuestionMark(t))
if(this.has_hp&&this.hp_cur<this.hp_max){var a=this.hp_cur?lt.addPercentage(er(rr(100*this.hp_cur/this.hp_max),this.hp_cur?1:0)):lt.LBL_BROKEN
t=lt.addParenthesesAfter(t,a)}return t}else if(this.type===Ce)return this.name
else if(this.type===Pe)return this.upgrade_data.name
else if(this.type===De)return this.name
return lt.$(lt.ITEM_NAME_UNKNOWN_ITEM,lt.$(lt.FORMAT_FRACTION,this.type,this.id))}
Item.prototype.getBuildName=function(e){if(this.type===Ne&&this.block_name)return this.block_name
return this.getName(e)}
function getMaxMetalName(e){var t
var r=Rt[e]
if(r>0){var a=vt[xt.METAL][r]
if(a)t=St[a]}return t}function getMaxStoneName(e){var t
var r=It[e]
if(r>0)t=Ft[r]
return t}Item.prototype.getDesc=function(e,t){var a=this.attribs&&this.attribs[Ze.PREVIEW_MOD_COUNT_MAX]
function v(e,t){var r=t?lt.addPercentage(e):e
return a?lt.addPlus(r):r}var r=[]
if(this.has_hp&&!Lt[this.attr1])if(this.hp_cur===this.hp_max)r.push(lt.separateColon(lt.LBL_DURABILITY,v(this.hp_max)))
else{var i=lt.$(lt.FORMAT_FRACTION,this.hp_cur,this.hp_max)
r.push(lt.separateColon(lt.LBL_DURABILITY,i))}if(this.dig_rates||this.type===Me&&this.id===oe){var o=this.getStaminaRate()
if(Ve()&&1!==o){var n=lt.$(a?lt.LBL_STAMINA_USAGE_BASE:lt.LBL_STAMINA_USAGE,zt)
r.push(lt.separateColon(n,v(rr(100*o),"%")))}}if(itemIsBlueprint(this)){var s=je(this.getBID())
if(s)if(s.desc)r.push(s.desc)
else if(s.isEditable()&&!e)r.push(lt.ITEM_DESC_EDITABLE_BP)}if(this.type===Me){if(!this.is_recipe)if(_r[this.id])if(this.attr2){var l=Wt.liquid_name[this.attr2]
r.push(lt.separateColon(lt.LBL_CONTENTS,l))}else r.push(lt.ITEM_ADJ_EMPTY)
else if(this.attr2)if(ur[this.id]){var c=ur[this.id]
var _=St[this.attr2]
r.push(lt.$(lt.FORMAT_ITEM_1_ADJ,c,_))}if(this.desc){var u=D(this.desc)
r=r.concat(u.split("\n"))}switch(this.id){case xe:if(!this.dynamic_cost().length)r.push(lt.ITEMINFO_FIRST_SETTLEMENT_FREE)
break
case te:case re:if(!this.is_recipe)r.push(lt.separateColon(lt.LBL_DOWSER_RANGE,this.dowser_range))
break
case se:if(t!==M&&!this.is_recipe){if(this.attr1===Ue.MUTTAL){r.push(lt.ITEM_DESC_MUTTAL)
break}if(this.attr1===Ue.TIN||this.attr1===Ue.GOLD||this.attr1===Ue.SILVER){r.push(lt.ITEM_DESC_WEAK_METAL)
break}}case Le:if(t!==M&&!this.is_recipe){var d=getMaxMetalName(this.attr1)
var f=getMaxStoneName(this.attr1)
if(d&&f)r.push(lt.$(lt.ITEM_DESC_MADE_FROM_GATHERS_BOTH,d,f))
else if(d)r.push(lt.$(lt.ITEM_DESC_MADE_FROM_GATHERS_METAL,d))
else if(f)r.push(lt.$(lt.ITEM_DESC_MADE_FROM_GATHERS_STONE,f))}}if(this.dig_rates&&!this.is_recipe){var h=false
var p=this.dig_rates[xt.STONE]
var m=this.dig_rates[xt.METAL]
var g=this.max_tier[xt.METAL]
var E=g>=0&&vt[xt.METAL][g]
if(p&&m&&p===m&&E){var y=p*this.dig_rate_mod
var T=v(rr(100*y),"%")
r.push(lt.$(lt.ITEM_DESC_STONE_METAL_GATHERING,T,Ft[this.max_stone_tier],St[E]))
h=true}for(var I=0;I<this.dig_rates.length;++I){if(I!==xt.STONE&&I!==xt.METAL&&I!==xt.WOOD&&I!==xt.DIRT)continue
if(h&&(I===xt.STONE||I===xt.METAL))continue
var S=this.dig_rates[I]
if(S){S*=this.dig_rate_mod
var A=Et[I]
var w=lt.$(lt.ITEM_DESC_MATERIAL_GATHERING,v(rr(100*S),"%"),A)
var L=this.max_tier[I]
if(L){if(L<0)continue
var R=vt[I][L]
if(R){var x=St[R]
w=lt.addParenthesesAfter(w,lt.$(lt.ITEM_DESC_UP_TO,x))}}else if(I===xt.STONE){var O=Ft[this.max_stone_tier]
w=lt.addParenthesesAfter(w,lt.$(lt.ITEM_DESC_UP_TO_STONE,O))}r.push(w)}}}if(this.attribs)for(var b in this.attribs)if(Xe[b])r.push(""+Xe[b](this.attribs,b))
if(this.attr1!==Ue.ANY&&this.consumable&&this.consume_attribs){r.push(lt.addColon(lt.ITEM_DESC_CONSUMABLE_FOR))
for(var N in this.consume_attribs)if(Xe[N])r.push(""+Xe[N](this.consume_attribs,N))}}else if(this.desc){var C=D(this.desc)
r=r.concat(C.split("\n"))}return r}
Item.prototype.getInfo=function(){if(this.info_cached)return this.info_cached
var e=this.info||""
if(this.type===Me)if(this.id===ue&&this.attr1){var t=Ot(this.attr1)
if(t>0){var r=[e]
r.push(lt.$(lt.ITEM_INFO_ORE_DEPTH,this.getName(),Ft[t],Gt[t-1]))
e=r.join("\n\n")}}this.info_cached=e
return this.info_cached}
Item.prototype.getHardness=function(){var e=this.getMaterial()
return At[e]}
Item.prototype.isCrafted=function(){return this.is_crafted}
Item.prototype.getCraftCost=function(){if(this.craft_cost)return this.craft_cost
w(this.isCrafted())
this.craft_cost=tt(this)
return this.craft_cost}
Item.prototype.getRawCost=function(){if(this.raw_cost)return this.raw_cost
var e=this.cost
w(e)
var t=false
var r=[]
for(var a=0;a<e.length;++a){var i=e[a]
if(!isItem(i))i=e[a]=createItem(i)
if(i.isCrafted()){t=true
var o=i.getCraftCost()
for(var n=0;n<o.length;++n){var s=o[n]
if(1!==i.count)(s=createItem(s)).count*=i.count
r.push(s)}}else r.push(i)}if(!t)r=e
else for(var l=0;l<r.length;++l)for(var c=l+1;c<r.length;++c)if(r[l].same(r[c])){r[l]=createItem(r[l])
r[l].count+=r[c].count
B(r,c)}return this.raw_cost=r}
Item.prototype.initDowser=function(){var e=Qe[Ze.RANGE][this.attribGet(Ze.RANGE)]
var t=this.id===te?rt:at
this.dowser_range=rr(t*e)}
Item.prototype.initUniqueSpiced=function(){this.consume_attribs=N(this.consume_attribs)
if(this.attr1===Ue.LUMINESCENT_MUSHROOM){this.consume_attribs={}
this.consume_attribs[Ze.STAMINA_DRAIN]=1}if(this.attr1===Ue.CORN&&this.consume_attribs[Ze.STAMINA])this.consume_attribs[Ze.STAMINA]--
this.initSpiced()}
Item.prototype.initSpiced=function(){this.consume_attribs=N(this.consume_attribs)
if(this.attr3===Ue.HOT)this.consume_attribs[Ze.TIMED_STAMINA_MED]=(this.consume_attribs[Ze.TIMED_STAMINA_MED]||0)+10
if(this.attr3===Ue.PUNGENT)this.consume_attribs[Ze.STAMINA]=(this.consume_attribs[Ze.STAMINA]||0)+1
if(this.attr3===Ue.SAVORY)this.consume_attribs[Ze.TIMED_O2_CAPACITY_LARGE]=(this.consume_attribs[Ze.TIMED_O2_CAPACITY_LARGE]||0)+20}
function itemPotentiallyMergeable(e,t){return e&&t&&e.stackable&&e.type===t.type&&e.id===t.id&&e.attr1===t.attr1&&e.attr2===t.attr2&&e.attr3===t.attr3}function itemPartiallyMergeable(e,t){if(itemPotentiallyMergeable(e,t))return tr(j-e.count,t.count)
return 0}function itemFullyMergeable(e,t){return itemPotentiallyMergeable(e,t)&&e.count+t.count<=j}var wr={}
function satisfiesCost(e,t){if(!e||!t)return false
if(e.type===Ce)return qe(e.id,t)
if(!(e.type===t.type&&(e.id===t.id||e.type===Me&&e.id===ce&&t.id===Z)))return false
if(e.type===Ne)return true
var r=Ue.ANY
if(!((e.attr1===r||(e.attr1||0)===(t.attr1||0))&&(e.attr2===r||(e.attr2||0)===(t.attr2||0))&&(e.attr3===r||(e.attr3||0)===(t.attr3||0))))return false
var a=e.attribs||wr
var i=t.attribs||wr
if(a!==i){for(var o in a)if("hp"!==o&&a[o]!==i[o])return false
for(var n in i)if("hp"!==n&&i[n]!==a[n])return false}if(t.has_hp||e.has_hp)if(!(t.hp_cur>0))return false
return true}function satisfiesCostLoose(e,t){if(!e||!t)return false
if(e.type===Ce)return qe(e.id,t)
if(!(e.type===t.type&&(e.id===t.id||e.type===Me&&e.id===ce&&t.id===Z)))return false
if(e.type===Ne)return true
var r=Ue.ANY
if(!((!e.attr1||e.attr1===r||(e.attr1||0)===(t.attr1||0))&&(!e.attr2||e.attr2===r||(e.attr2||0)===(t.attr2||0))&&(!e.attr3||e.attr3===r||(e.attr3||0)===(t.attr3||0))))return false
return true}function itemEqualLoose(e,t){if(!e){if(!t)return true
return false}if(!t)return false
return e.type===t.type&&e.id===t.id&&(e.count||1)===(t.count||1)&&(e.attr1||0)===(t.attr1||0)&&(e.attr2||0)===(t.attr2||0)&&(e.attr3||0)===(t.attr3||0)}function itemEqual(e,t,r){if(!E(e,t,r))return false
return!e||e.count===t.count}function itemIsUnlimited(e){return Ye()&&e&&e.potentially_unlimited}function itemIsSettlementLocked(e){if(e&&e.is_settlement_locked&&!Ye()){var t=Pt()
if(t&&t.allowsItem(e.id))return 0
else{if(!t)if((t=kt())&&t.allowsItem(e.id))return 1
return 2}}return 0}function itemIsPlaceable(e){return e&&e.placeable&&(!e.unlimited_only||Ye())}function itemIsAllowedInQuickbar(e){if(!e)return false
if(e.sysadmin_only&&!Qt("sysadmin"))return false
if(e.unlimited_only||e.unlimited_only_for_build_menu)return true
var t=e.cost
if(t)for(var r=0;r<t.length;++r){var a=t[r]
if(!isItem(a))a=t[r]=createItem(a)
if(a.isAllowedInInventory())continue
if(a.type===Ce)continue
if(a.attr1===Ue.ANY)continue
return false}return true}function notLiquid(e){return e&&!(e.type===Me&&e.id===ce)}var Lr
var Rr
var xr
function snapshotsFrameCheck(){if(xr!==R.frame_index){xr=R.frame_index
Rr=Lr=0}}var Or=1
var br=1
function snapshotOverLimit(e){snapshotsFrameCheck()
if(e){if(!U(Rr<br))return true;++Rr}else{if(Lr>=Or)return true;++Lr}return false}function itemGetGfx(e,t){if((e=e||hr).preview_item)e=e.preview_item
var r=t.dynamic_snapshot&&(e.need_thumbnail_update||e.thumbnail_updated)&&(!e.no_spin||t.ignore_no_spin)
var a=e.need_thumbnail_update
var i=false
if(itemIsBlueprint(e)){var o=e.blueprint_def
if(!o)o=e.blueprint_def=je(e.getBID())
if(!o.loaded)return e.loading_gfx
if(e.blueprint_def_ver!==o.ver)a=i=true
if(a)if(o.isEmpty()){e.img=fr
e.frame=Ht.EMPTY_BLUEPRINT
e.blueprint_def_ver=o.ver
return e}}if(e.dynamic_snapshot&&!r)a=true
if(a||r){if(!bt.hasForPreview(e,bt.PREVIEW_SNAPSHOT)||i||r){snapshotsFrameCheck()
if(t.no_perframe_limit);else if(snapshotOverLimit(r))return e.loading_gfx}if(r)e.updateThumbnailDynamic(t)
else{t.dynamic_snapshot=false
e.updateThumbnail(t)
if(i)e.blueprint_def_ver=e.blueprint_def.ver}}w(e.img)
return e}var Nr=[]
function itemGetGfxQueued(e,t){if(!e.need_thumbnail_update&&!e.dynamic_snapshot){var r=Lr+Rr+10007*xr
var a=itemGetGfx(e,{})
w(a)
w(a!==e.loading_gfx)
w(r===Lr+Rr+10007*xr)
return void t(a)}Nr.push([e,t])}function itemsTick(){snapshotsFrameCheck()
while(Nr.length&&Lr<Or){var e=Nr.splice(0,1)[0],t=e[0];(0,e[1])(itemGetGfx(t,{}))}}function startup(){fr=Ht.sprite
w(fr)
hr.img=fr
hr.frame=Ht.BLANK
pr.img=fr
pr.frame=Ht.QUESTION_MARK
mr.img=fr
mr.frame=Ht.EMPTY_BLUEPRINT
r.sprite_blueprint_bg=vr=O({url:"img/blueprint_bg.png",filter_min:gl.LINEAR_MIPMAP_LINEAR,filter_mag:gl.LINEAR})
initPrototypes()}},{"../common/entitlements":194,"../common/globals":197,"../common/ids":198,"../common/items_common":200,"../common/materials_common":201,"../common/world_constants":212,"../glov/client/camera2d":241,"../glov/client/engine":250,"../glov/client/error_report":255,"../glov/client/localization":275,"../glov/client/sprites":302,"../glov/common/util":330,"../glov/common/verify":331,"../glov/common/vmath":332,"./autogen/item_defs":14,"./baking":17,"./blueprint":24,"./build_menu":26,"./build_mode":27,"./crafting":57,"./crafting_mods":58,"./crafting_recipes":59,"./dowser_advanced":66,"./dowser_simple":67,"./inventory":94,"./localization/localization":108,"./main":112,"./materials":114,"./proc_gen":132,"./props":141,"./settlement":148,"./status":156,"./stone_tiers":157,"./tiles":162,"./ui_util":168,"./user_data":170,"./waygate_upgrade":180,"./world_comm":182,"./world_metadata":186,assert:void 0,not_worker:void 0}],99:[function(e,t,r){"use strict"
r.quickbarOnTop=quickbarOnTop
r.quickbarOnLeft=quickbarOnLeft
r.quickbarOnRight=quickbarOnRight
r.menuUpperLeft=menuUpperLeft
r.layoutWide=layoutWide
r.layoutCameraFull=layoutCameraFull
r.layoutCameraSquare=layoutCameraSquare
r.layoutCameraPush=layoutCameraPush
r.layoutCameraPop=layoutCameraPop
r.layoutCameraTallWide=layoutCameraTallWide
r.layoutCameraTallWideRaw=layoutCameraTallWideRaw
r.layoutCameraCurX1=layoutCameraCurX1
r.layoutCameraCurY1=layoutCameraCurY1
r.layoutCameraTallWideMode=layoutCameraTallWideMode
r.layoutTick=layoutTick
r.startup=startup
r.PHOTOUI_WG_H=r.PHOTOUI_USERBUTTON_H=r.PHOTOUI_SHADOW_OFFSET=r.PHOTOUI_FRAME_PAD=r.PHOTOUI_BORDER_PAD=r.UIVIEWS_CONTENT_PAD=r.UIVIEWS_BUTTON_H=r.UIVIEWS_BUTTON_W=r.SHAREMENU_BUTTON_H=r.SHAREMENU_BUTTON_W=r.SHAREMENU_CONTENT_PAD=r.SHAREMENU_BORDER_PAD=r.CORNER_BUTTON_MARGIN=r.TC_VERTBUTTONS_FH=r.TC_VERTBUTTONS_H=r.TC_VERTBUTTONS_W=r.TC_DPAD_LEFT_PAD=r.TC_DPAD_BOT_PAD=r.TC_DPAD_RADIUS=r.QUICKBAR_BORDER_PAD=r.QUICKBAR_BOX_SIZE=r.RIGHT=r.LEFT=r.WIDE=r.TALL=r.AUTO=void 0
var o=0
r.AUTO=o
var n=1
r.TALL=n
var s=2
r.WIDE=s
var a=0
r.LEFT=a
var i=1
r.RIGHT=i
var d=100
r.QUICKBAR_BOX_SIZE=d
var f=8
r.QUICKBAR_BORDER_PAD=f
var l=230
r.TC_DPAD_RADIUS=l
var c=250
r.TC_DPAD_BOT_PAD=c
var _=250
r.TC_DPAD_LEFT_PAD=_
var u=280
r.TC_VERTBUTTONS_W=u
var v=240
r.TC_VERTBUTTONS_H=v
var h=90
r.TC_VERTBUTTONS_FH=h
var p=10
r.CORNER_BUTTON_MARGIN=p
var m=32
r.SHAREMENU_BORDER_PAD=m
var g=8
r.SHAREMENU_CONTENT_PAD=g
var E=300
r.SHAREMENU_BUTTON_W=E
var y=48
r.SHAREMENU_BUTTON_H=y
var T=240
r.UIVIEWS_BUTTON_W=T
var I=48
r.UIVIEWS_BUTTON_H=I
var S=4
r.UIVIEWS_CONTENT_PAD=S
var A=30
r.PHOTOUI_BORDER_PAD=A
var w=30
r.PHOTOUI_FRAME_PAD=w
var L=8
r.PHOTOUI_SHADOW_OFFSET=L
var R=48
r.PHOTOUI_USERBUTTON_H=R
var x=128
r.PHOTOUI_WG_H=x
var O=e("assert")
var b=e("../glov/client/camera2d.js")
var N=e("../glov/client/cmds.js").cmd_parse
var C=e("./main.js")
var M=Math.round
var D=e("../glov/client/settings.js")
var P=e("../glov/client/ui.js")
var k=e("../glov/common/vmath.js"),B=k.vec4,U=k.v4set
var G
function quickbarOnTop(){return C.main_active&&G===n}function quickbarOnLeft(){return C.main_active&&G===s&&D.layout_quickbar===a}function quickbarOnRight(){return C.main_active&&G===s&&D.layout_quickbar===i}function menuUpperLeft(){return quickbarOnRight()}function layoutWide(){return G===s}var F
var W=B(0,0,1e3,1e3)
function layoutCameraFull(){F=W
b.setAspectFixed2(1e3,1e3)}var j=B(0,0,1e3,1e3)
var H=B()
function layoutCameraSquare(){F=j
b.set(H[0],H[1],H[2],H[3])}var z=null
function layoutCameraPush(){O(!z)
z=F
b.push()}function layoutCameraPop(){O(z)
F=z
z=null
b.pop()}var V=B(0,0,1600,1e3)
var Y=B(0,0,1e3,1600)
var q=B()
var K=B()
var X={mode:n,rect:Y,camera:q}
var Q={mode:s,rect:V,camera:K}
var J
function layoutCameraTallWide(){var e=J.camera
F=J.rect
b.set(e[0],e[1],e[2],e[3])
return J}function layoutCameraTallWideRaw(e,t,r,a){var i=D.layout
if(i===o)if(b.screenAspect()<1)i=n
else i=s
if(i===n)b.setAspectFixed(r,a)
else b.setAspectFixed(e,t)
return i}function layoutCameraCurX1(){return F[2]}function layoutCameraCurY1(){return F[3]}function layoutCameraTallWideMode(){return J.mode}var $=50
var ee=20
var te=8
function layoutTick(e){if((G=D.layout)===o)if(b.screenAspect()<1)G=n
else G=s
layoutCameraFull()
var l=[$,$,b.x1()-$,b.y1()-$]
if(e){var t=d+f+ee+te
if(quickbarOnLeft())l[0]=t
else if(quickbarOnRight())l[2]=b.x1()-t
else if(quickbarOnTop())l[1]=d+f+te
else l[3]=b.y1()-t}var c=l[2]-l[0]
var _=l[3]-l[1]
var u=c/_
function setupView(e,t){var r=t[2]/t[3]
if(u>r){var a=M(_*r)
var i=(c-a)/2
U(e,l[0]+i,l[1],l[2]-i,l[3])}else{var o=M(c/r)
if(t===V){var n=_-o
U(e,l[0],l[1],l[2],l[3]-n)}else{var s=(_-o)/2
U(e,l[0],l[1]+s,l[2],l[3]-s)}}b.calcMap(e,e,t)}setupView(H,j)
setupView(q,Y)
setupView(K,V)
if(G===n)J=X
else J=Q
if(false){P.drawRect(l[0],l[1],l[2],l[3],Z.DEBUG,[1,0,0,.5])
layoutCameraSquare()
P.drawRect(0,0,j[2],j[3],Z.DEBUG+1,[0,1,0,.5])
if(layoutCameraTallWide().mode===n)P.drawRect(0,0,Y[2],Y[3],Z.DEBUG+2,[0,0,1,.5])
else P.drawRect(0,0,V[2],V[3],Z.DEBUG+2,[0,0,1,.5])
layoutCameraFull()}}function startup(){D.register({layout:{default_value:o,type:N.TYPE_INT,range:[0,2]},layout_quickbar:{default_value:a,type:N.TYPE_INT,range:[0,1]}})
G=o}},{"../glov/client/camera2d.js":241,"../glov/client/cmds.js":244,"../glov/client/settings.js":291,"../glov/client/ui.js":306,"../glov/common/vmath.js":332,"./main.js":112,assert:void 0}],100:[function(e,t,d){"use strict"
d.lightCalcReset=lightCalcReset
d.lightCalcBakeRules=lightCalcBakeRules
d.lightCalc=lightCalc
d.torch_table=d.sun_table=d.clear_version=d.LIGHT_TORCH=d.LIGHT_SUN=d.LIGHT_FADE_HORIZ=void 0
var K=e("assert")
var r=e("../common/globals.js"),Z=r.CS2,a=r.CS3,n=r.ID_FACTOR,i=r.ID2
var X=Math.max,_=Math.min,u=Math.round,f=Math.sqrt
var B=e("./tiles.js").TILE_NON_OPAQUE
var o=e("../common/voxel_data_common.js").ZMAP_UNKNOWN
var v=f(2)
var s=1+n+i
var U=16
var G=23-(d.LIGHT_FADE_HORIZ=U)
var Q=1
d.LIGHT_SUN=Q
var M=2
d.LIGHT_TORCH=M
var J=255
var h=3
var $=0
d.clear_version=$
function emitScaled(e){return J-u((1-e)*J/U)*U}var l
var ee
function lightCalcReset(e,t){l=e
ee=t}var D
function lightCalcBakeRules(e){D=e}function lightAlloc(e,t){K(t)
K(e)
if(!e[t])e[t]=new Uint8Array(a)
return e[t]}var te=new Array(64)
var F=new Array(64)
var c={}
var W=new Array(64)
var j=new Array(64)
var H=[[-1,0,0],[1,0,0],[0,-1,0],[0,1,0],[0,0,-1],[0,0,1]]
var z=[[[-1,-1,0],[-1,1,0],[-1,0,-1],[-1,0,1]],[[1,-1,0],[1,1,0],[1,0,-1],[1,0,1]],[[-1,-1,0],[1,-1,0],[0,-1,-1],[0,-1,1]],[[-1,1,0],[1,1,0],[0,1,-1],[0,1,1]],[[-1,0,-1],[1,0,-1],[0,-1,-1],[0,1,-1]],[[-1,0,1],[1,0,1],[0,-1,1],[0,1,1]]]
function isBorder(e){var t=12303&e
var r=49392&e
var a=200448&e
return!t||!r||!a||8207===t||33008===r||134912===a}function spreadLight(e,t){for(var r=255;r>0;--r){var a=e[r]
if(!a)continue
var i=r-U
var o=r-G
for(var n=0;n<a.length;++n){var s=a[n]
var l=s>>12
var c=4095&s
if(W[l][c]>r)continue
var _=15&c
var u=(240&c)>>4
var d=c>>8
for(var f=0;f<H.length;++f){var v=H[f]
var h=l
var p=_
var m=u
var g=d
if(v[0]){if(16&(p+=v[0])){h+=p>>4
p&=15}}else if(v[1]){if(16&(m+=v[1])){h+=m<0?-4:4
m&=15}}else if(16&(g+=v[2])){h+=g<0?-16:16
g&=15}var E=256*g+16*m+p
var y=F[h][E]
if(y&&y<B)continue
var T=W[h]
if(!T)T=W[h]=lightAlloc(te[h],t)
var I=T[E]
if(i>=I){var S=void 0
if(i===I){var A=z[f]
for(var w=S=0;w<A.length;++w){var L=A[w]
var R=l
var x=_
if(L[0])if(16&(x+=L[0])){R+=x>>4
x&=15}var O=u
if(L[1])if(16&(O+=L[1])){R+=O<0?-4:4
O&=15}var b=d
if(L[2])if(16&(b+=L[2])){R+=b<0?-16:16
b&=15}var N=256*b+16*O+x
var C=W[R]
if(C&&C[N]===r){S=o
break}}}else S=i
if(S)if((T[E]=S)>U){var M=4096*h+E
if(!isBorder(M)){var D=e[S]
if(!D)D=e[S]=[]
D.push(M)}else{var P=j[h]
var k=P[S]
if(!k)k=P[S]=[]
k.push(E)}}}}}}}function sunAttenuationTable(){var e=1/16
var t=[]
for(var r=0;r<16;++r)for(var a=0;a<16;++a){var i=X(0,J-(a*G+r*U))
if(!i||t[i])continue
var o=i
var n=2/(e*(a*(v-1)+r)+1)-1
n=_(X(n,0),1)
i=u(255*n)
t[o]=i}t[0]=0
return t}var p=sunAttenuationTable()
d.sun_table=p
function torchAttenuationTable(e){var t=new Uint8Array(256)
for(var r=0;r<16;++r)for(var a=0;a<16;++a){var i=X(0,J-(a*G+r*U))
if(!i||t[i])continue
var o=i
var n=a*(v-1)+r
var s=n?1/(f(e)*n):1
var l=.05
var c=(s*s-l)/(1-l)
s=c>0?f(c):0
s=_(X(s,0),1)
i=u(255*s)
t[o]=i}t[0]=0
return t}var m=torchAttenuationTable(.075)
d.torch_table=m
var re=function(){var e=[]
for(var t=-1;t<=1;++t)for(var r=-1;r<=1;++r)for(var a=-1;a<=1;++a){var i=a+1+4*(r+1)+16*(t+1)
var o=[]
if(a>=0)o.push(0)
if(a<=0)o.push(1)
if(r>=0)o.push(2)
if(r<=0)o.push(3)
if(t>=0)o.push(4)
if(t<=0)o.push(5)
e[i]=o}return e}()
var ae=[-1,1,-4,4,-16,16]
var w=[[0,1,0,16,0,16],[15,16,0,16,0,16],[0,16,0,1,0,16],[0,16,15,16,0,16],[0,16,0,16,0,1],[0,16,0,16,15,16]]
var ie=new Int16Array(Z)
ie.fill(o)
function reinitEmitters(e,t,r,a,i,o,n,s){var l=w[e]
var c=l[0]
var _=l[1]
var u=l[2]
var d=l[3]
var f=l[4]
var v=l[5]
for(var h=f;h<v;++h){var p=!a&&!h||2===a&&15===h
for(var m=u;m<d;++m){var g=h*Z+16*m+c
var E=p||!r&&!m||2===r&&15===m
for(var y=c;y<_;++y,++g){var T=o[g]
if(T>G)if(E||!t&&!y||2===t&&15===y){var I=s[T]
if(!I)I=s[T]=[]
if(-1===I.indexOf(g))I.push(g)}else{var S=i+g
var A=n[T]
if(!A)A=n[T]=[]
if(-1===A.indexOf(S))A.push(S)}}}}}function lightSunInit(e,t,r,a,i,o){var n=i.light_sun
var s=4096*a
if(i.light_need_init&Q){if(n)n.fill(0)
i.sun_clear_version=$
i.light_need_init&=~Q
i.light_sent=false
var l=o[J]
if(!l)l=o[J]=[]
var c=[]
var _=ee[i.vsid]
_=_&&_.data||ie
var u=i.worldZ()
var d=u+15
var f=0
var v
for(var h=0;h<16;++h){var p=16*h+3840
var m=!h&&!t||15===h&&2===t
var g=h&&h<15
for(var E=0;E<16;++E,++f){var y=_[f]
var T=m||!E&&!e||15===E&&2===e
var I=g&&E&&E<15
K(void 0!==y)
if(y>=d)continue
if(I){var S=_[f-16]
var A=_[f-1]
var w=_[f+1]
var L=_[f+16]
v=X(S,A,w,L)-1}else v=Infinity
if(!n)n=lightAlloc(i,"light_sun")
var R=X(u-1,y)
var x=E+p
for(var O=d;O>R;x-=Z,--O){n[x]=J
if(O>v)continue
if(!(T||!r&&x<Z||2===r&&x>=3840)){var b=s+x
l.push(b)}else c.push(x)}}}if(c.length)i.emitters_sun[J]=c
for(var N=0;N<i.sun_emit_version.length;++N)i.sun_emit_version[N]=$
return}if(!n){for(var C=0;C<i.sun_emit_version.length;++C)i.sun_emit_version[C]=$
return}var M=i.emitters_sun
var D=false
for(var P in M){D=true
break}if(D){var k={}
for(var B in M){var U=M[B]
var G=o[B=Number(B)]
if(!G)G=o[B]=[]
var F=[]
for(var W=0;W<U.length;++W){var j=s+U[W]
if(isBorder(j))F.push(U[W])
else G.push(j)}if(F.length)k[B]=F}M=i.emitters_sun=k}var H=re[a]
for(var z=0;z<H.length;++z){var V=H[z]
var Y=a+ae[V]
var q=te[Y]
K(q)
if(q.light_need_init&Q||q.sun_clear_version>i.sun_emit_version[V]){reinitEmitters(V,e,t,r,s,n,o,M)
i.sun_emit_version[V]=$
i.light_sent=false}}}function lightTorchInit(e,t,r,a,i,o){var n=i.light_torch
var s=i.baked_props
var l=4096*a
if(i.light_need_init&M){if(n)n.fill(0)
i.torch_clear_version=$
i.light_need_init&=~M
i.light_sent=false
if(s)for(var c in s){var _=s[c].key
if(!_)continue
if(!D[_])K(0,"lightTorchInit got prop with unknown baked key "+_)
var u=D[_].emit
if(u){var d=emitScaled(u)
c=Number(c)
if(!n)n=lightAlloc(i,"light_torch")
n[c]=d
var f=l+c
if(!isBorder(f)){var v=o[d]
if(!v)v=o[d]=[]
v.push(f)}else{var h=i.emitters_torch[d]
if(!h)h=i.emitters_torch[d]=[]
h.push(c)}}}for(var p=0;p<i.torch_emit_version.length;++p)i.torch_emit_version[p]=$
return}if(!n){for(var m=0;m<i.torch_emit_version.length;++m)i.torch_emit_version[m]=$
return}var g=i.emitters_torch
var E=false
for(var y in g){E=true
break}if(E){var T={}
for(var I in g){var S=g[I]
var A=o[I=Number(I)]
if(!A)A=o[I]=[]
var w=[]
for(var L=0;L<S.length;++L){var R=l+S[L]
if(isBorder(R))w.push(S[L])
else A.push(R)}if(w.length)T[I]=w}g=i.emitters_torch=T}var x=re[a]
for(var O=0;O<x.length;++O){var b=x[O]
var N=a+ae[b]
var C=te[N]
K(C)
if(C.light_need_init&M||C.torch_clear_version>i.torch_emit_version[b]){reinitEmitters(b,e,t,r,l,n,o,g)
i.torch_emit_version[b]=$
i.light_sent=false}}}function getNeighbors(e){for(var t=0;t<h;++t)for(var r=0;r<h;++r){var a=4*(4*t+r)
for(var i=0;i<h;++i,++a){var o=l[e+(t*n+r)*n+i-s]
K(o)
te[a]=o
F[a]=o.data||c}}}function lightCalc(e){if(e.full)return
d.clear_version=$+=1
getNeighbors(e.chunk_id)
var t=[]
for(var r=0;r<h;++r)for(var a=0;a<h;++a){var i=4*(4*r+a)
for(var o=0;o<h;++o,++i){var n=te[i]
lightSunInit(o,a,r,i,n,t)
W[i]=n.light_sun
j[i]=n.emitters_sun}}if(t.length)spreadLight(t,"light_sun")
t=[]
for(var s=0;s<h;++s)for(var l=0;l<h;++l){var c=4*(4*s+l)
for(var _=0;_<h;++_,++c){var u=te[c]
lightTorchInit(_,l,s,c,u,t)
W[c]=u.light_torch
j[c]=u.emitters_torch}}if(t.length)spreadLight(t,"light_torch")}},{"../common/globals.js":197,"../common/voxel_data_common.js":209,"./tiles.js":162,assert:void 0}],101:[function(e,t,r){"use strict"
r.ptLineDistSq=ptLineDistSq
r.v2distSqBV=v2distSqBV
r.ptLineDistSqBBV=ptLineDistSqBBV
var s=e("assert")
var a=e("../glov/common/vmath.js"),i=a.vec2,n=a.v2addScale,l=a.v2distSq,c=a.v2lengthSq,_=a.v2set,u=a.v2sub
var d=i()
function ptLineDistSq(e,t,r,a){u(d,r,t)
var i=c(d)
s(i>0)
var o=((a[0]-t[0])*d[0]+(a[1]-t[1])*d[1])/i
if(o<0)_(e,0,l(a,t))
else if(o>1)_(e,1,l(a,r))
else{n(d,t,d,o)
_(e,o,l(a,d))}return e}function v2distSqBV(e,t,r){return(e[t+0]-r[0])*(e[t+0]-r[0])+(e[t+1]-r[1])*(e[t+1]-r[1])}function ptLineDistSqBBV(e,t,r,a,i){d[0]=t[a]-t[r]
d[1]=t[a+1]-t[r+1]
var o=c(d)
s(o>0)
var n=((i[0]-t[r])*d[0]+(i[1]-t[r+1])*d[1])/o
if(n<0)_(e,0,v2distSqBV(t,r,i))
else if(n>1)_(e,1,v2distSqBV(t,a,i))
else{d[0]=t[r]+d[0]*n
d[1]=t[r+1]+d[1]*n
_(e,n,l(i,d))}return e}},{"../glov/common/vmath.js":332,assert:void 0}],102:[function(e,t,r){"use strict"
r.lineLineDist=lineLineDist
r.pointLineDist=pointLineDist
r.intersect=intersect
r.ptLineDist3DSq=ptLineDist3DSq
r.v3distSqBV=v3distSqBV
r.ptLineDist3DSqBBV=ptLineDist3DSqBBV
r.ptLineNearestBBV=ptLineNearestBBV
var s=e("assert")
var l=Math.sqrt
var a=e("../glov/common/vmath.js"),d=a.vec3,c=a.v2set,_=a.v3addScale,u=a.v3copy,f=a.v3cross,v=a.v3determinant,h=a.v3distSq,p=a.v3lengthSq,m=a.v3sub,g=a.v3div,E=a.v4set,y=a.unit_vec
var T=1e-7
var I=d()
var S=d()
var A=d()
var w=d()
var L=d()
function lineLineDist(e,t,r,a,i){f(I,r,i)
var o=p(I)
if(o<T)return 0
m(S,a,t)
var n=v(S,i,I)
var s=v(S,r,I)/o
_(A,t,r,n/o)
_(w,a,i,s)
m(L,w,A)
u(e,A)
return l(p(L))}var i=d()
function pointLineDist(e,t,r){return l(p(f(I,t,m(i,e,r))))}function intersect(e,t,r){var a
var i
var o
var n
var s=d()
o=d(r[0],r[1],r[2])
n=d(r[0]+1,r[1]+1,r[2]+1)
a=(o[0]-e[0])/t[0]
i=(n[0]-e[0])/t[0]
g(s,y,t)
if(a>i)if(s[0]>=0){a=(o[0]-e[0])*s[0]
i=(n[0]-e[0])*s[0]}else{a=(n[0]-e[0])*s[0]
i=(o[0]-e[0])*s[0]}var l=(o[1]-e[1])/t[1]
var c=(n[1]-e[1])/t[1]
if(l>c)if(s[1]>=0){l=(o[1]-e[1])*s[1]
c=(n[1]-e[1])*s[1]}else{l=(n[1]-e[1])*s[1]
c=(o[1]-e[1])*s[1]}if(a>c||l>i)return false
if(l>a)a=l
if(c<i)i=c
var _=(o[2]-e[2])/t[2]
var u=(n[2]-e[2])/t[2]
if(_>u)if(s[2]>=0){_=(o[2]-e[2])*s[2]
u=(n[2]-e[2])*s[2]}else{_=(n[2]-e[2])*s[2]
u=(o[2]-e[2])*s[2]}if(a>u||_>i)return false
if(_>a)a=_
if(u<i)i=u
return i}var R=d()
function ptLineDist3DSq(e,t,r,a){m(R,r,t)
var i=p(R)
s(i>0)
var o=((a[0]-t[0])*R[0]+(a[1]-t[1])*R[1]+(a[2]-t[2])*R[2])/i
if(o<0)c(e,0,h(a,t))
else if(o>1)c(e,1,h(a,r))
else{_(R,t,R,o)
c(e,o,h(a,R))}return e}function v3distSqBV(e,t,r){return(e[t+0]-r[0])*(e[t+0]-r[0])+(e[t+1]-r[1])*(e[t+1]-r[1])+(e[t+2]-r[2])*(e[t+2]-r[2])}function ptLineDist3DSqBBV(e,t,r,a,i){R[0]=t[a+0]-t[r+0]
R[1]=t[a+1]-t[r+1]
R[2]=t[a+2]-t[r+2]
var o=p(R)
s(o>0)
var n=((i[0]-t[r+0])*R[0]+(i[1]-t[r+1])*R[1]+(i[2]-t[r+2])*R[2])/o
if(n<0)c(e,0,v3distSqBV(t,r,i))
else if(n>1)c(e,1,v3distSqBV(t,a,i))
else{R[0]=t[r+0]+R[0]*n
R[1]=t[r+1]+R[1]*n
R[2]=t[r+2]+R[2]*n
c(e,n,h(i,R))}return e}function ptLineNearestBBV(e,t,r,a,i){R[0]=t[a+0]-t[r+0]
R[1]=t[a+1]-t[r+1]
R[2]=t[a+2]-t[r+2]
var o=p(R)
s(o>0)
var n=((i[0]-t[r+0])*R[0]+(i[1]-t[r+1])*R[1]+(i[2]-t[r+2])*R[2])/o
if(n<0)E(e,t[r],t[r+1],t[r+2],0)
else if(n>1)E(e,t[a],t[a+1],t[a+2],1)
else{e[0]=t[r+0]+R[0]*n
e[1]=t[r+1]+R[1]*n
e[2]=t[r+2]+R[2]*n
e[3]=n}return e}},{"../glov/common/vmath.js":332,assert:void 0}],103:[function(e,t,r){"use strict"
r.liquidStartup=liquidStartup
r.liquidUpdateReset=liquidUpdateReset
r.liquidUpdatePrepare=liquidUpdatePrepare
r.liquidUpdateFinalize=liquidUpdateFinalize
r.liquidUpdateDeferInternal=liquidUpdateDeferInternal
r.updateLiquid=r.liquid_tick_idx=void 0
var ie=e("assert")
var n=e("./editvolume_client.js").chunkInEditBounds
var a=e("../common/globals.js"),oe=a.CHUNK_SIZE,ne=a.CS2,s=a.CS3,l=a.ID_FACTOR,c=a.ID2
var i=e("../glov/client/engine.js")
var o=e("./main.js")
var se=Math.random
var _=e("./rand_seed.js")
var u=e("./tiles.js")
var d=e("../glov/common/vmath.js"),f=d.v3copy,le=d.v3set
var ce=e("./voxel_data.js")
var v=ce.getPropRelativeFromTile,_e=ce.getTileRelative,ue=ce.transSetTileDirect,de=ce.transSetTileRelative
var fe=e("../common/world_trans.js").createTransSet
var ve=u.TILE_POROUS,he=u.TILE_TILLED,pe=u.TILE_TILLED_WATERED,me=u.TILE_DIRT,ge=u.TILE_GRASS,h=u.TILE_STONE,Ee=u.TILE_PROP_BASE,ye=u.TILE_PROP_MAX,Te=u.TILE_WATER,Ie=u.TILE_WATER_FLOW,Se=u.priority_liquid,Ae=u.priority_solid
var p=500
var we=.15
function liquidStartup(){}var Le=0
r.liquid_tick_idx=Le
var m=p
var Re=false
var xe
var Oe
function liquidUpdateReset(){Re=false}function liquidUpdatePrepare(){ce.gen_miss=0
if((m-=i.frame_dt)<=0&&!Re){m+=p
r.liquid_tick_idx=Le+=1
return true}else if(m<0)m=0
return false}function liquidUpdateFinalize(){if(Oe){ie(!Re)
if(Oe.numOps()||xe.hasPristineSends()){if(Oe.numOps()){var e=o.getFrameTransaction()
e.ops=Oe.ops
e.loose_compaction=Oe.loose_compaction
Re=true
e.silent_error=true
e.onComplete(function(){Re=false})}if(xe.hasPristineSends())o.getFrameTransactionSet().mergePristineSends(xe)
Oe=xe=null}}}function liquidUpdateDeferInternal(e){e.last_liquid_tick=Le+2}var g=function(){var Y=new Int32Array(3)
var q=new Int32Array(3)
var K=new Int32Array(3)
var Z=new Int32Array(3)
var X=[-1,1,0,0]
var Q=[0,0,-1,1]
var J=new Array(X.length)
var $=new Array(X.length)
var ee=new Array(X.length)
var te=_.createFast()
var e={data:new Uint8Array(s)}
e.data.fill(h)
var re
var ae
var t
var r
var a
var i
var o=new Int32Array(3)
function ulGetRelative(){t=re
f(o,Y)
if(o[0]<0){t--
o[0]+=16}else if(o[0]>=16){t++
o[0]-=16}if(o[1]<0){t-=l
o[1]+=16}else if(o[1]>=16){t+=l
o[1]-=16}if(o[2]<0){t-=c
o[2]+=16}else if(o[2]>=16){t+=c
o[2]-=16}if(!(r=ae[t])){if(!(r=ce.chunk_map[t])||!r.did_gen)r=e
else if(!n(r))r=e
ae[t]=r}i=o[0]+o[1]*oe+o[2]*ne
if(!r.data)a=0
else a=r.data[i]
return a}function ulAndGetLiquid(){return r.liquid?r.liquid[i]:0}function ulGetLiquid(){ulGetRelative()
return ulAndGetLiquid()}function ulAndGetProp(){return v(t,o,a)}return function updateLiquidFn(t){if(t.last_liquid_tick>=Le||Re)return false
t.getLocalPos(K)
t.last_liquid_tick=Le
ie(t.liquid)
ae={}
re=t.chunk_id
var e=Te
var r=Ie
ie(Se[e])
ie(Se[r])
var a=[]
var i=false
var o={}
var n=ce.gen_miss
if(!Oe){xe=fe();(Oe=xe.trans()).loose_compaction=true}var s=Oe.ops.length
function setLiquid(e){var t=de(Oe,re,Y,e,true,true)
t.loose_priority=Se[e]
if(e&&!ulGetRelative())t[4]|=4
le(Z,Y[0],Y[1],Y[2]-1)
var r=_e(re,Z,0,false)
if(r===he||r===pe)de(Oe,re,Z,me,false,true).loose_priority=Ae[me]}function setSelf(e){ue(Oe,t,q,e,true,true,void 0).loose_priority=Se[e]
if(!e){le(Z,q[0],q[1],q[2]-1)
if(_e(re,Z,0,false)===me&&se()<we)de(Oe,re,Z,ge,false,true).loose_priority=Ae[ge]}}var l
var c
var _
function flowToNeighbor(e){if($[e])return
if(J[e])return
le(Y,l+X[e],c+Q[e],_)
setLiquid(r)
var t=ee[e]
if(t)o[t.uid]=t}var u=0
for(_=0;_<oe;++_)for(c=0;c<oe;++c)for(l=0;l<oe;++l,++u){var d=t.liquid[u]
if(d!==e&&d!==r)continue
if(a[u-ne])continue
le(Y,l,c,_)
var f=ulGetRelative()
if(f>=Ee&&f<=ye){var v=ulAndGetProp()
if(v&&v.onFlow)f=0}if(f){ue(Oe,t,Y,0,true,true,d)
continue}le(Y,l,c,_-1)
var h=ulGetRelative()
var p=ulAndGetLiquid()
var m=void 0
if(h>=Ee&&h<=ye)if((m=ulAndGetProp())&&m.onFlow)h=0
if(d===e&&!h&&(!p||p===r)){a[u]=true
Y[2]=_+1
if(ulGetLiquid()===e){Y[2]=_+2
if(ulGetLiquid()===e){Y[2]=_-1
setLiquid(e)
continue}}Y[2]=_-1
setLiquid(e)
Y[2]=_
ue(Oe,t,Y,0,true,true,d).loose_priority=Se[d]
if(m)o[m.uid]=m
continue}if(d===r&&!h&&!p){setLiquid(r)
if(m)o[m.uid]=m
continue}le(Y,l,c,_+1)
var g=ulGetLiquid()
var E=g===e||g===r?1:0
for(var y=0;y<X.length;++y){le(Y,l+X[y],c+Q[y],_)
var T=ulGetRelative()
$[y]=ulAndGetLiquid()
var I=T>=Ee&&T<=ye&&ulAndGetProp()
if(I)if(I.onFlow)T=0
else I=null
J[y]=T
ee[y]=I}var S=0
var A=0
var w=0
var L=[]
var R=[]
for(var x=0;x<X.length;++x){var O=J[x]
var b=$[x]
if(b===e)++S
else if(O&&O<ve)++A
else if(O);else if(b&&b!==r);else{if(b===r)++w
le(Y,l+X[x],c+Q[x],_-1)
var N=ulGetRelative()
var C=ulAndGetLiquid()
var M=null
if(N>=Ee&&N<=ye)if((M=ulAndGetProp())&&M.onFlow)N=0
if(!N&&(!C||C===r))L.push(x)
else if(C===e)R.push(x)}}le(q,l,c,_)
if(d===e&&L.length&&!S&&!E){var D=0
if(L.length>1){te.reseed(10007*re+u)
D=te.range(L.length)}var P=L[D]
var k=ee[P]
if(k)o[k.uid]=k
le(Y,l+X[P],c+Q[P],_)
setLiquid(d)
setSelf(0)
continue}if(d===e){if(R.length)for(var B=0;B<R.length;++B)flowToNeighbor(R[B])
else if(L.length){var U=0
if(L.length>1){te.reseed(10007*re+u)
U=te.range(L.length)}flowToNeighbor(U=L[U])}else if(E||S)if(!w){var G=[]
for(var F=0;F<X.length;++F)if(!J[F]&&!$[F])G.push(F)
if(G.length){var W=0
if(G.length>1){te.reseed(10007*re+u)
W=te.range(G.length)}flowToNeighbor(G[W])}}if(!S&&!E&&A<4||1===S&&!R.length&&!E&&A<2&&!L.length)if(1&Le)setSelf(r)
else i=true}else{var j=h&&h<ve
var H=p&&p===e
if(!E&&!S)setSelf(0)
else if(S>0&&(j||H)&&S+A>=3||E&&j||S>=3||S&&S+w===4)setSelf(e)
else if(L.length&&!R.length&&S+w<=1&&j){var z=0
if(L.length>1){te.reseed(10007*re+u)
z=te.range(L.length)}flowToNeighbor(z=L[z])
setSelf(e)}}}if(ce.gen_miss!==n){Oe.ops.length=s
t.liquid_unstable=false
return true}if(Oe.ops.length!==s||i)for(var V in o)o[V].onFlow(Oe)
else t.liquid_unstable=false
return true}}()
r.updateLiquid=g},{"../common/globals.js":197,"../common/world_trans.js":213,"../glov/client/engine.js":250,"../glov/common/vmath.js":332,"./editvolume_client.js":72,"./main.js":112,"./rand_seed.js":145,"./tiles.js":162,"./voxel_data.js":175,assert:void 0}],104:[function(e,t,r){"use strict"
r.listCreate=listCreate
var s=e("../glov/client/aabbtree.js")
var a=e("assert")
var l=e("./fixed_octree.js").createFixedOctree
var i=e("../common/globals.js"),c=i.ID_FACTOR,_=i.ID2
var o=e("../glov/common/util.js").ridx
var n=0
function FIFO(e){this.name=e.name
this.head=null
this.tail=null
this.count=0
this.nkey="n"+ ++n
this.pkey="p"+n}FIFO.prototype.length=function(){return this.count}
FIFO.prototype.add=function(e){a(!e[this.nkey])
a(!e[this.pkey])
e[this.pkey]=this.tail
if(this.tail){this.tail[this.nkey]=e
this.tail=e}else this.head=this.tail=e;++this.count}
FIFO.prototype.remove=function(e){var t=e[this.pkey]
var r=e[this.nkey]
if(t){t[this.nkey]=r
e[this.pkey]=null}else{a.equal(this.head,e)
a(e!==r)
this.head=r}if(r){r[this.pkey]=t
e[this.nkey]=null}else{a.equal(this.tail,e)
this.tail=t}--this.count}
FIFO.prototype.prepare=function(){this.prepared_popped=null}
FIFO.prototype.preparedPop=function(){a(this.count)
a(this.head)
a(this.head!==this.prepared_popped)
this.prepared_popped=this.head
return this.head}
FIFO.prototype.preparedLength=function(){return this.count}
function AABBTreeWrap(e){this.tree=s.create(e)
this.prepared_list=[]}AABBTreeWrap.prototype.length=function(){return this.tree.getNumLeaves()}
AABBTreeWrap.prototype.clear=function(){this.tree.clear()}
var u=new Float32Array(6)
AABBTreeWrap.prototype.add=function(e){u[0]=e.pos[0]-.125
u[1]=e.pos[1]-.125
u[2]=e.pos[2]
u[3]=e.pos[0]+1.25
u[4]=e.pos[1]+1.25
u[5]=e.pos[2]+1.25
this.tree.add(e,u)}
AABBTreeWrap.prototype.remove=function(e){this.tree.remove(e)}
AABBTreeWrap.prototype.getVisible=function(e,t){this.tree.finalize()
var r=this.tree.getVisibleNodes(e,this.prepared_list,0)
this.prepared_list.length=r
this.prepared_list.sort(t)}
AABBTreeWrap.prototype.preparedLength=function(){return this.prepared_list.length}
AABBTreeWrap.prototype.preparedPop=function(){return this.prepared_list.pop()}
function LIFO(e){this.arr=[]}LIFO.prototype.length=function(){return this.arr.length}
LIFO.prototype.add=function(e){this.arr.push(e)}
LIFO.prototype.remove=function(e){var t=this.arr.indexOf(e)
a(-1!==t)
o(this.arr,t)}
function SimpleList(e){this.arr=[]
this.prepared_list=[]}SimpleList.prototype.length=function(){return this.arr.length}
SimpleList.prototype.add=function(e){this.arr.push(e)}
SimpleList.prototype.remove=function(e){var t=this.arr.indexOf(e)
a(-1!==t)
o(this.arr,t)}
function isInsidePlanesAABB(e,t){var r=t[0]
var a=t[1]
var i=t[2]
for(var o=0;o<e.length;++o){var n=e[o]
var s=n[0]
var l=n[1]
var c=n[2]
if(s*(s<0?r:r+1)+l*(l<0?a:a+1)+c*(c<0?i:i+1)<n[3])return false}return true}SimpleList.prototype.getVisible=function(e,t){var r=0
for(var a=0;a<this.arr.length;++a){var i=this.arr[a]
if(isInsidePlanesAABB(e,i.pos))this.prepared_list[r++]=i}this.prepared_list.length=r
this.prepared_list.sort(t)}
SimpleList.prototype.preparedLength=AABBTreeWrap.prototype.preparedLength
SimpleList.prototype.preparedPop=AABBTreeWrap.prototype.preparedPop
function SimpleLinkedList(e){this.name=e.name
this.head=null
this.tail=null
this.count=0
this.nkey="n"+ ++n
this.pkey="p"+n
this.prepared_list=[]}SimpleLinkedList.prototype.length=function(){return this.count}
SimpleLinkedList.prototype.add=function(e){a(!e[this.nkey])
a(!e[this.pkey])
e[this.pkey]=this.tail
if(this.tail){this.tail[this.nkey]=e
this.tail=e}else this.head=this.tail=e;++this.count}
SimpleLinkedList.prototype.remove=function(e){var t=e[this.pkey]
var r=e[this.nkey]
if(t){t[this.nkey]=r
e[this.pkey]=null}else this.head=r
if(r){r[this.pkey]=t
e[this.nkey]=null}else this.tail=t;--this.count}
SimpleLinkedList.prototype.getVisible=function(e,t){var r=0
var a=this.nkey
for(var i=this.head;i;i=i[a])if(isInsidePlanesAABB(e,i.pos))this.prepared_list[r++]=i
this.prepared_list.length=r
this.prepared_list.sort(t)}
SimpleLinkedList.prototype.preparedLength=AABBTreeWrap.prototype.preparedLength
SimpleLinkedList.prototype.preparedPop=AABBTreeWrap.prototype.preparedPop
var d=8
var f=3
function Hybrid1(e){this.count=0
this.megacells={}
this.root_tree=s.create({name:"hybrid_root"})
this.root_list=[]
this.prepared_list=[]}Hybrid1.prototype.clear=function(){for(var e in this.megacells)this.megacells[e].clear()
this.megacells=null
this.root_tree.clear()}
Hybrid1.prototype.length=function(){return this.count}
Hybrid1.prototype.add=function(e){++this.count
var t=e.pos
var r=e.mcid
if(void 0===r)r=e.mcid=(t[0]>>f)+(t[1]>>f)*c+(t[2]>>f)*_
var a=this.megacells[r]
if(!a){var i=(t[0]>>f)*d
var o=(t[1]>>f)*d
var n=(t[2]>>f)*d
a=this.megacells[r]=s.create({name:"hybrid_cell"})
u[0]=i
u[1]=o
u[2]=n
u[3]=i+d
u[4]=o+d
u[5]=n+d
this.root_tree.add(a,u)}u[0]=e.pos[0]
u[1]=e.pos[1]
u[2]=e.pos[2]
u[3]=e.pos[0]+1
u[4]=e.pos[1]+1
u[5]=e.pos[2]+1
a.add(e,u)}
Hybrid1.prototype.remove=function(e){--this.count
var t=this.megacells[e.mcid]
a(t)
if(1===t.getNumLeaves()){this.root_tree.remove(t)
delete this.megacells[e.mcid]}else t.remove(e)}
Hybrid1.prototype.getVisible=function(e,t){var r=2
if(this.root_tree.finalize())--r
var a=this.root_list
var i=this.root_tree.getVisibleNodes(e,a,0)
a.length=i
var o=0
var n=this.prepared_list
for(var s=0;s<a.length;++s){var l=a[s]
if(r&&l.finalize())--r
o+=i=l.getVisibleNodes(e,n,o)}this.prepared_list.length=o
this.prepared_list.sort(t)}
Hybrid1.prototype.preparedLength=AABBTreeWrap.prototype.preparedLength
Hybrid1.prototype.preparedPop=AABBTreeWrap.prototype.preparedPop
function Hybrid4(e){this.count=0
this.megacells={}
this.root_tree=s.create({name:"hybrid_root"})
this.root_list=[]
this.prepared_list=[]}Hybrid4.prototype.length=function(){return this.count}
Hybrid4.prototype.add=function(e){++this.count
var t=e.pos
var r=e.mcid
if(!r)r=e.mcid=(t[0]>>f)+(t[1]>>f)*c+(t[2]>>f)*_
var a=this.megacells[r]
if(!a){var i=(t[0]>>f)*d
var o=(t[1]>>f)*d
var n=(t[2]>>f)*d
a=this.megacells[r]=l({pos:[i,o,n],size:d})
u[0]=i
u[1]=o
u[2]=n
u[3]=i+d
u[4]=o+d
u[5]=n+d
this.root_tree.add(a,u)}a.add(e)}
Hybrid4.prototype.clear=function(){for(var e in this.megacells)this.megacells[e].clear()
this.megacells=null
this.root_tree.clear()}
Hybrid4.prototype.remove=function(e){--this.count
var t=this.megacells[e.mcid]
a(t)
if(1===t.getNumLeaves()){t.clear()
this.root_tree.remove(t)
delete this.megacells[e.mcid]}else t.remove(e)}
Hybrid4.prototype.getVisible=function(e,t){this.root_tree.finalize()
var r=this.root_list
var a=this.root_tree.getVisibleNodes(e,r,0)
r.length=a
var i=0
var o=this.prepared_list
for(var n=0;n<r.length;++n)i=r[n].getVisibleNodes(e,o,i)
this.prepared_list.length=i
this.prepared_list.sort(t)}
Hybrid4.prototype.preparedLength=AABBTreeWrap.prototype.preparedLength
Hybrid4.prototype.preparedPop=AABBTreeWrap.prototype.preparedPop
function listCreate(e){switch(e.type){case"fifo":return new FIFO(e)
case"hybrid1":return new Hybrid1(e)
case"hybrid4":return new Hybrid4(e)
case"aabbtree":return new AABBTreeWrap(e)
case"simplelinked":return new SimpleLinkedList(e)
case"simple":return new SimpleList(e)
case"lifo":return new LIFO(e)
default:a(false)
return null}}},{"../common/globals.js":197,"../glov/client/aabbtree.js":236,"../glov/common/util.js":330,"./fixed_octree.js":83,assert:void 0}],105:[function(e,t,r){"use strict"
r.queueSpinner=queueSpinner
r.loadingCustomSetMessage=loadingCustomSetMessage
r.loadingCustomInit=loadingCustomInit
r.loadingCustomDrawNow=loadingCustomDrawNow
r.isLoadingCustom=isLoadingCustom
var s=e("./localization/localization").L
var a=e("assert")
var l=e("./camera.js").setViewParameters
var c=e("../glov/client/camera2d.js")
var _=e("../glov/client/engine.js")
var u=e("../glov/client/font.js")
var d=e("gl-mat4/lookAt")
var i=e("./build_mode.js"),o=i.doPointerLockBottom,n=i.doPointerLockTop
var f=e("./main_menu.js")
var v=Math.floor,h=Math.PI,p=Math.random
var m=e("./photo_mode.js").copyToClipboardCheck
var g=e("./props.js")
var E=e("../glov/client/quat.js"),y=E.quat,T=E.qFromYPR
var I=e("../glov/client/snapshot.js"),S=I.viewportRenderPrepare,A=I.viewportRenderFinish
var w=e("../glov/client/sprites.js").spriteQueueFn
var L=e("./styles.js").title_style
var R=e("./tiles.js")
var x=e("../glov/client/transition.js")
var O=e("../glov/common/util.js"),b=O.clamp,N=O.easeInOut
var C=e("./ui_util.js")
var M=e("../glov/common/vmath.js"),D=M.mat4,P=M.vec2,k=M.vec3,B=M.zaxis
var U=e("./voxel_data.js")
var G=U.applyBevelValue
var F
var W
var j=null
var H
var z=false
var V=null
var Y=0
var q=0
var K=1500
var X=500
var Q=32
var J=24
var $=P()
var ee=P()
var te
var re
var ae=[R.DIRT,R.GRASS,R.STONE,R.ORE_IN_STONE,R.ORE_IN_STONE_LIGHT,R.ORE_IN_STONE_DARK,R.ORE_IN_STONE_RED,R.WOOD,R.TILLED,R.SNOW,R.SAND,R.STONE_DARK,R.STONE_LIGHT,R.STONE_RED,R.PLANKS_WOOD,R.BRICK_CLAY,R.BRICK_STONE,R.WOOD_LIGHT,R.PLANKS_WOOD_LIGHT,R.WOOD_DARK,R.PLANKS_WOOD_DARK,R.WOOD_RED,R.PLANKS_WOOD_RED,R.LEAVES1,R.LEAVES2,R.LEAVES3,R.LEAVES4,R.LEAVES5]
var ie=function(){var r=.25*h
var a=D()
var i=k(0,0,.85)
var e=2
var o=k(0,4,i[2]+e)
var n=k(0,0,0)
var s=y()
return function drawSpinnerFn(){var e=ee[0]-$[0]
var t=ee[1]-$[1]
S({pre:g.saveGlobalState,viewport:[$[0],_.height-ee[1],e,t]})
_.setupProjection(r,e,t,.1,100)
d(a,o,i,B)
l(a,true)
gl.clear(gl.DEPTH_BUFFER_BIT)
G(true)
T(s,5e-4*_.frame_timestamp,0,0)
re.draw(n,s,1,{})
A({post:g.restoreGlobalState})
G()
_.startSpriteRendering()}}()
function queueSpinner(){if(!te){var e=new Int8Array([2,2,2])
te=U.createUtilVD(e,false)
for(var t=0;t<e[0];++t)for(var r=0;r<e[1];++r)for(var a=0;a<e[2];++a){var i=v(p()*ae.length)
te.set([t,r,a],ae[i])}te.ver_meshing++
te.updateGeometrySimple()
re=U.createSimpleDrawable(te,[e[0]/2,e[1]/2,0])}var o=250
var n=250
var s=(1e3-o)/2
var l=(1e3-n)/2
c.virtualToCanvas($,[s,l])
c.virtualToCanvas(ee,[s+o,l+n])
w(Z.LOADING+100,ie)}var oe=1e3
function loadingCustomDraw(e,t){var r=false
if(!V||V[0]!==e||V[1]!==t){r=true
V=[e,t]
Y=_.frame_timestamp}c.setAspectFixed(1e3,1e3)
var a=c.y1()-250
var i=_.font.drawSizedAligned(L,0,a,Z.LOADING,Q,u.ALIGN.HCENTERFIT,1e3,0,s.MSG_LOADING)
if(q||r)q+=_.frame_dt/oe
if(q>1)q=0
C.sprite_centered.draw({x:(1e3+i)/2+8+Q/2,y:a+Q/2,z:Z.LOADING,w:Q,h:Q,rot:N(q,2)*h*2,frame:C.TIME})
a+=Q+8
if(_.frame_timestamp-Y>2e4&&!j){var o=t+e
_.font.drawSizedAligned(L,0,a,Z.LOADING,J,u.ALIGN.HCENTERFIT,1e3,0,s.LOADCUSTOM_WAITING_ON.$({loads:o}))
a+=J+8}if(j&&e){var n=z?b(1-(_.getFrameTimestamp()-H-K)/X,0,1):1
if(!n)j=null
else _.font.drawSizedAligned(_.font.styleAlpha(L,n),0,a,Z.LOADING,J,u.ALIGN.HCENTERFIT,1e3,0,j)}f.drawBG(Z.LOADING-1)
queueSpinner()}function loadingCustom(e){profilerStart("loadingCustom")
var t=1
if(++W>=2){if(2===W)F.start()
t=F.tick(e)}var r=_.loadsPending()+t
loadingCustomDraw(t,r)
m()
n()
o()
if(F.finished){var a=F.extra_frames--<=0
if(a&&F.fade_time)x.queue(Z.TRANSITION_FINAL,x.fade(F.fade_time))
F.state(e)
if(a){F.on_finished()
_.setState(F.state)}}if(!r)F.finished=true
return profilerStop("loadingCustom")}function loadingCustomSetMessage(e,t){j=e
H=_.getFrameTimestamp()
z=t}function loadingCustomInit(e){F=e
a.equal(typeof F.state,"function")
a.equal(typeof F.start,"function")
a.equal(typeof F.tick,"function")
a.equal(typeof F.extra_frames,"number")
W=0
z=false
V=j=null
Y=_.frame_timestamp
q=0
_.setState(loadingCustom)}function loadingCustomDrawNow(){c.push()
loadingCustomDraw(0,0)
c.pop()}function isLoadingCustom(){return _.stateActive(loadingCustom)}},{"../glov/client/camera2d.js":241,"../glov/client/engine.js":250,"../glov/client/font.js":260,"../glov/client/quat.js":287,"../glov/client/snapshot.js":295,"../glov/client/sprites.js":302,"../glov/client/transition.js":305,"../glov/common/util.js":330,"../glov/common/vmath.js":332,"./build_mode.js":27,"./camera.js":28,"./localization/localization":108,"./main_menu.js":113,"./photo_mode.js":128,"./props.js":141,"./styles.js":160,"./tiles.js":162,"./ui_util.js":168,"./voxel_data.js":175,assert:void 0,"gl-mat4/lookAt":void 0}],106:[function(e,t,r){t.exports={FORMAT_ADD_COLON:"{val}:",FORMAT_ADD_ELLIPSIS:"{val}...",FORMAT_ADD_NUMBER_SIGN:"#{val}",FORMAT_ADD_PARENTHESES:"({val})",FORMAT_ADD_PARENTHESES_AFTER:"{val} ({detail})",FORMAT_ADD_PERCENTAGE:"{val}%",FORMAT_ADD_PLUS:"{val}+",FORMAT_ADD_QUESTION_MARK:"{val}?",FORMAT_DURATION_YEARS:"{val, plural, one{# year} other{# years}}",FORMAT_DURATION_DAYS:"{val, plural, one{# day} other{# days}}",FORMAT_DURATION_HOURS:"{val, plural, one{# hour} other{# hours}}",FORMAT_DURATION_MINUTES:"{val, plural, one{# minute} other{# minutes}}",FORMAT_DURATION_SECONDS:"{val, plural, one{# second} other{# seconds}}",FORMAT_FRACTION:"{val} / {val_2}",FORMAT_INPUT_MERGE:"[{key}]{command}",FORMAT_INPUT_PREPEND:"[{key}] {command}",FORMAT_SEPARATOR_COLON:": ",FORMAT_SEPARATOR_COMMA:", ",FORMAT_SEPARATOR_WORDS:" ",BTN_ACCEPT:"Accept",BTN_CANCEL:"Cancel",BTN_CREATE_USER:"Create User",BTN_DELETE:"Delete",BTN_DISMISS:"Dismiss",BTN_DOWNLOAD:"Download",BTN_EQUIP:"Equip",BTN_EXIT_TO_MAIN_MENU:"← Exit to Main Menu",BTN_GET_LINK:"Get Link",BTN_GET_WORLD_LINK:"Get World Link",BTN_HIDE:"Hide",BTN_INFO:"Info",BTN_INVITE_PLAY:"Invite",BTN_INVITE_TO_WORLD:"Invite to World",BTN_LOGIN:"Log in",BTN_LOGOUT:"Log out",BTN_NEW_USER:"New User",BTN_NO:"No",BTN_OK:"OK",BTN_PROCESSING:"Processing...",BTN_RANDOM:"Random",BTN_REMOVE:"Remove",BTN_REMOVE_SPOTLIGHT:"Remove Spotlight",BTN_RENAME:"Rename",BTN_RETRY:"Retry",BTN_SAVE:"Save",BTN_SHARE:"Share",BTN_SHARE_WORLD:"Share World",BTN_SHARING:"Sharing...",BTN_SKIP:"Skip",BTN_SORT_ALPHABETICALLY:"A-Z",BTN_SUBMIT:"Submit",BTN_TAKE:"Take",BTN_TAKE_PHOTO:"Take Photo",BTN_YES:"Yes",CHATERROR_RUNNING_CMD:"Error running {val}: {val_2}",DLG_ERROR_IMAGE_UPLOAD_TITLE:"Error uploading images",DLG_ERROR_TITLE:"Error",DLG_SHARE_TITLE:"Share",DLG_SHARE_WG_TITLE:"Share Waygate",ERR_DISCONNECTED:"Disconnected",ERR_WORLD_DISCONNECTED:"Disconnected from world",CHATERROR_EMPTY_RESPONSE:"Empty response",INPUT_CLICK:"Click",INPUT_CLICK_LEFT:"Left Click",INPUT_CLICK_MIDDLE:"Middle Click",INPUT_CLICK_RIGHT:"Right Click",INPUT_DRAG_QBAR:"drag quickbar",INPUT_KEY_CTRL_CLICK:"Ctrl Click",INPUT_KEY_DEL:"Del",INPUT_KEY_ENTER:"Enter",INPUT_KEY_SHIFT:"Shift",INPUT_KEY_SHIFT_CLICK:"Shift Click",INPUT_KEY_SPACE:"Space",INPUT_KEY_TAB:"Tab",INPUT_TAP:"Tap",INPUT_TAP_DOUBLE:"Double-tap",LBL_AUTHOR:"Author",LBL_BUILD_MENU:"Build Menu",LBL_CONFIRM_PASSWORD:"Confirm Password",LBL_DESCRIPTION:"Description",LBL_DISPLAY_NAME:"Display Name",LBL_ELAPSED_TIME:"Time",LBL_ENERGY_WELL:"Energy Well",LBL_EMAIL_ADDRESS:"Email Address",LBL_ERROR:"Error",LBL_EXIT_MENU:"Exit Menu",LBL_FIELD_OF_VIEW:"Field of View",LBL_MENU:"Menu",LBL_NAME:"Name",LBL_NEW_WORLD:"New World",LBL_NUMBERED_WORLD:"World #{val}",LBL_PASSWORD:"Password",LBL_PRIVACY_POLICY:"Privacy Policy",LBL_RARITY_COMMON:"Common",LBL_RARITY_EPIC:"Epic",LBL_RARITY_LEGENDARY:"Legendary",LBL_RARITY_RARE:"Rare",LBL_RARITY_UNCOMMON:"Uncommon",LBL_RECIPE:"Recipe",LBL_REQUIRES:"Requires",LBL_RESULTS:"Results",LBL_TERMS_OF_SERVICE:"Terms of Service",LBL_UNKNOWN_WORLD_ID:"???",LBL_UNKNOWN_WORLD_NAME:"Unknown World",LBL_USERNAME:"Username",LBL_USER_ID:"User ID",LBL_VERSION:"Version",LBL_VIEW_INFO:"View info",LBL_WORLD_NAME:"World Name",LBL_WORLD_URL:"World URL",MSG_INVENTORY_FULL:"Inventory full",MSG_LOADING:"Loading...",MSG_OUT_OF_SETTLEMENT_ALERT:"Industry only works within Settlements.",MSG_PLEASE_WAIT:"Please wait...",MSG_SAVED:"Saved.",MSG_SAVING:"Saving...",TLTP_PLACE_IN_QB:"Place in quickbar",ACCESSCONTROL_AREA_LOST:"Area moved or deleted",ACCESSCONTROL_CANNOT_CREATE:"You do not have access to create Areas here.",ACCESSCONTROL_CANNOT_MANAGE:"You do not have access to manage this Area.",ACCESSCONTROL_READONLY_NOTE:"Note: Users with Admin or higher access to the world can always build anywhere.  Only Builders/Area Builders will be restricted from building in this Area.",ACCESSCONTROL_WORLD_PRESET_NOTE:'Note: An Area set to "Anyone can build" is usually only useful if the world\'s access is set to "Anyone can Area build".',BTN_CLEAR_AREA:"Clear contents",BTN_CREATE_AREA:"Create Area",BTN_DELETE_AREA:"Delete Area",DLG_CLEAR_AREA_MSG:"Clearing an Area's contents will permanently remove everything built within the area, but leave the access control settings in-place.  Really clear this Area's contents?",DLG_CLEAR_AREA_TITLE:"Clear Area Contents",DLG_DELETE_AREA_MSG:"Deleting an Area will only remove access control settings, leaving any changes to the world.  Really delete this Area?",DLG_DELETE_AREA_TITLE:"Delete Area",DLG_MOVE_WARN_MSG:"After this operation, you will no longer be within this Area and will need to re-open the Area Access Control from the new location.",LBL_ACCESS_PRESET_BUILD:"Anyone can build",LBL_ACCESS_PRESET_READONLY:"Read-only (Visitor)",LBL_AREA_ACCESS_CONTROL:"Area Access Control",LBL_AREA_ACCESS_FOR_NEARBY_BUILDERS:"Area Access for Nearby Builders",LBL_AREA_CLEARING:"Clearing Area...",LBL_AREA_CLEARING_STALLED:"Clearing Area stalled: please move around the Area.",LBL_AREA_COORDS_MAX:"Max",LBL_AREA_COORDS_MIN:"Min",LBL_AREA_COORDS_SIZE:"Size",LBL_AREA_COORDS_X:"Width (X) = {val}",LBL_AREA_COORDS_Y:"Width (Y) = {val}",LBL_AREA_COORDS_Z:"Height (Z) = {val}",LBL_AREA_OWNER:"Area Owner",LBL_RESIZE_OR_DELETE_AREA:"Resize or Delete Area",STATUSMSG_AREA_CLEARED:"Area cleared",TLTP_CHANGE_ACCESS:"Change Access",AGE_CONSENTMENT:"I confirm being at least 13 years old",DISCLAIMER_CREATE_ACCOUNT:"By creating an account you agree to our",DISCLAIMER_LOGIN:"By logging in you agree to our",DISCLAIMER_TOS_PP_SEPARATOR:"and",DLG_AUTO_LOGGIN_FAILED_TITLE:"Auto-login Failed",DLG_LOGIN_ERROR_TITLE:"Login Error",DLG_PLATFORM_LOGIN_FAILED_TITLE:"{val} login failed",DLG_SHARE_USER_ID_TITLE:"Your User ID",LBL_CLICK_TO_COPY:"Click to copy",LBL_EXTERNAL_LOGINS:"Or log in with",LBL_LOGGED_IN_AS:"Logged in as",LBL_TAP_TO_COPY:"Tap to copy",LOGINMSG_AUTO_LOGGING_IN:"Auto logging in...",LOGINMSG_CONNECTING:"Establishing connection...",LOGINMSG_LOGGING_IN:"Logging in...",LOGINMSG_LOGGING_OUT:"Logging out...",LOGINMSG_NEW_VERSION:"New version available!",LOGINMSG_RELOAD_PAGE:"Please reload the page.",LOGINMSG_RESTART_OR_UPDATE_APP:"Please restart or update the app.",LOGINMSG_SERVER_RESTARTING:"Server restarting...",LOGINMSG_TRY_AGAIN:"Please try again soon.",LOGINMSG_UNDER_MAINTENANCE:"The game is under maintenance.",LOGINMSG_UPDATE_APP:"Please update the app.",COSTUME_UNKNOWN:"Unknown",SUBTITLE_BETA:"Beta",DLG_DELETE_BP_MSG:"Are you sure you want to delete this blueprint ({val})?",DLG_DELETE_BP_TITLE:"Delete Blueprint?",DLG_ERROR_RENAMING_BP_TITLE:"Blueprint Rename Failed",DLG_ERROR_SHARING_BP_TITLE:"Blueprint Share Failed",DLG_REMOVE_BP_MSG:"Are you sure you want to remove this blueprint ({val})?",DLG_REMOVE_BP_TITLE:"Remove Blueprint from library?",DLG_RENAME_BP_MSG:'Enter a new name for blueprint "{val}"',DLG_RENAME_BP_TITLE:"Rename Blueprint",DLG_SHARE_BP_TITLE:"Blueprint Share",ERR_MUST_NAME_BP:"You must name this blueprint before sharing.",ERR_CMD_REQUIRES_OWNED_BP:"Command requires an editable blueprint owned by you in-hand.",MSG_BP_DELETED:"Blueprint deleted",MSG_BP_REMOVED:"Blueprint removed from library",MSG_BP_RENAMED:"Blueprint renamed",BTN_SHOW_IN_BUILD_MENU:"Show in Build menu",TLTP_DELETE_THIS_BP:"Delete this blueprint",TLTP_HOLD_SKIP_CONFIRMATION:"(hold {val} to skip confirmation)",TLTP_LINK_BP_GET:"Get a link anyone can use to add this blueprint to their library",TLTP_LINK_BP_SHARE:"Share a link that anyone can use to add this blueprint to their library",TLTP_REMOVE_THIS_BP:"Remove this blueprint from your library",TLTP_RENAME_BP_FOR_ALL:"Rename your shared blueprint for ALL users",TLTP_RENAME_BP_IN_LIBRARY:"Rename this blueprint in your library",TLTP_SHARE_BP:"Create a new, read-only copy of this blueprint for sharing or later use",TLTP_SHOW_BP_IN_BUILD_MENU:"Open the Build menu and select this blueprint",BBOX_BP_DATA_ERROR:"Blueprint data error: {val}",BBOX_BP_DATA_LOADING:"Blueprint data loading...",BBOX_BP_IS_IN_YOUR_LIBRARY:"Blueprint is in your library",BBOX_BP_SAVED:"Saved!",BBOX_CANNOT_SAVE_OWNED_BY:"Cannot save, blueprint owned by {val}",BBOX_INVALID_BP_ID:"Invalid Blueprint ID",BBOX_MISSING_RESOURCES:"Cannot completely build: missing resources",BBOX_MODIFIED_ELSEWHERE_MSG_EDIT:"To safely edit this blueprint, remove this BlueBox and place a new one.",BBOX_MODIFIED_ELSEWHERE_MSG_OVERWRITE:"Saving here will cause those changes to be overwritten.",BBOX_MODIFIED_ELSEWHERE_MSG_WARNING:"Warning: This blueprint has been modified elsewhere.",BBOX_MUST_CLEAR_BOUNDS:"Cannot start editing: must clear extraneous stuff from bounds",BBOX_NO_CHANGES_DETECTED:"No changes detected",BBOX_NO_MATCHING_RESOURCES:"Cannot deposit: no matching resources",BBOX_OVERLAPS_ANOTHER_EDITED_BP:"Cannot start editing: overlaps another edited blueprint",BBOX_OVERLAPS_EDITED_BP:"Cannot build: overlaps edited blueprint",BBOX_REFRESHING_STATE:"Refreshing state...",BBOX_SOMETHING_BLOCKING:"Cannot completely build: something blocking build or foundation missing",BBOX_TO_EDIT_FINISH_AND_PLACE:"To edit this blueprint, finish building it and then re-place the BlueBox",BBOX_WAITING_PREVIOUS_SAVE:"Waiting for previous save to complete...",BBOX_HAS_FALLBACKS_SAVE:"Cannot save blueprint containing phony props...",BTN_ADDING_TO_LIBRARY:"Adding...",BTN_ADD_TO_LIBRARY:"Add to My Library",BTN_DEPOSIT_ALL:"Deposit All",BTN_REMOVE_BBOX:"Remove BlueBox",DLG_ERROR_ADDING_BP_TITLE:"Error adding to library",DLG_UNSAVED_CHANGES_MSG:"You have made changes that have not been saved. You will be unable to save these changes to this blueprint once the BlueBox is removed. Really stop editing?",DLG_UNSAVED_CHANGES_TITLE:"Unsaved changes",LBL_BLUEPRINT:"Blueprint",LBL_BLUEPRINT_ERROR:"Blueprint (Error)",LBL_BLUEPRINT_LOADING:"Blueprint (Loading...)",LBL_BLUEPRINT_STATUS:"Blueprint status",LBL_BP_VIEW:"Blueprint View",LBL_BP_VIEW_ERROR:"Blueprint View (Error)",LBL_BP_VIEW_LOADING:"Blueprint View (Loading...)",LBL_EDITABLE_BLUEPRINT:"Editable Blueprint",LBL_LEFT_TO_BUILD:"Left to build",LBL_NONE_RESOURCES:"None",LBL_REQUIRED_RESOURCES:"Required resources",STATUSMSG_BBOX_CANNOT_EJECT:"BlueBox cannot eject excess: no place to drop items",STATUSMSG_BP_COMPLETELY_BUILT:"Blueprint completely built",STATUSMSG_BP_STILL_LOADING:"Blueprint still loading. Please try again...",STATUSMSG_PREVIEWING_BP:"Previewing blueprint. Select again to view options",TLTP_DEPOSIT_RESOURCE:"Deposit {val} {val_2}",CHATERROR_SAVING_BP:"Error saving blueprint: {val}",CHATERROR_SAVING_BP_SNAPSHOT:"Error saving blueprint snapshot: {val}",STATUSMSG_BP_SAVED:"Blueprint saved",BTN_AFFORDABLE_ITEMS:"Affordable",BTN_ALLOCATING:"Allocating...",BTN_ALL_ITEMS:"All",BTN_DETAILS:"Details",BTN_ICONS:"Icons",BTN_NEW_BP:"New",BUILDMENU_HINT_CRAFT_TOOLS_AND_CONSUMABLES:"Tools and consumables can be crafted at an Aetherbench or other Settlement buildings",BUILDMENU_HINT_NEW_BP_MSG_CREATE:"You can create your own blueprints!",BUILDMENU_HINT_NEW_BP_MSG_START:'Press "New" above to get started.',BUILDMENU_ITEM_NOT_FOUND:"Not found",BUILDMENU_NOTHING_AFFORDABLE:"Nothing affordable",BUILDMENU_NO_BP_AVAILABLE:"No blueprints available",BUILDMENU_NO_TOOLS_OR_CONSUMABLES:"No tools or consumables in inventory",BUILDMENU_UNLOCK_SCHEMATICS:"Unlock more schematics by upgrading your Settlement at the Waygate",DLG_QUOTA_EXCEEDED_MSG:"You already have the maximum ({val}) number of editable blueprints.",DLG_QUOTA_EXCEEDED_TITLE:"Quota Exceeded",ERR_MISSING_BLUEPRINT_ID:"Missing blueprint ID",LBL_BLUEPRINTS:"Blueprints",LBL_CRAFTED_BLOCKS:"Crafted Blocks",LBL_NEW_BLUEPRINT:"New",LBL_PROPS:"Props",LBL_RAW_BLOCKS:"Raw Blocks",LBL_SEARCH_ALL:"Search All",LBL_SETTLEMENT:"Settlement",LBL_TOOLS_AND_CONSUMABLES:"Tools and Consumables",LBL_TOOLS_AND_FARMING:"Tools and Farming",TLTP_CLOSE_BUILD_MENU:"Close Build menu",TLTP_SELECT_AND_CLOSE_BUID_MENU:"Select and close Build menu",TLTP_SELECT_IN_QB_AND_VIEW:"Select in quickbar and view info",STATUSMSG_BP_NOT_ALLOWED:"You are not allowed to place blueprints in this world",STATUSMSG_DIG_NO_STAMINA_BUCKET:"You are too exhausted to use your bucket!",STATUSMSG_DIG_NO_STAMINA_DIG:"You are too exhausted to dig!",STATUSMSG_DIG_NO_STAMINA_HINT:"Consume some food or return to your Waygate through Menu | World Info",STATUSMSG_DIG_NO_STAMINA_HOE:"You are too exhausted to use your hoe!",STATUSMSG_DIG_NO_STAMINA_WATER:"You are too exhausted to gather water!",STATUSMSG_DIG_WRONG_TIER_BREAK:"A {val} of {val_2} is needed to break {val_3} {val_4}",STATUSMSG_DIG_WRONG_TIER_DECONSTRUCT:"A {val} of {val_2} is needed to deconstruct {val_3}",STATUSMSG_DIG_WRONG_TIER_GATHER:"A {val} of {val_2} is needed to gather {val_3}",STATUSMSG_DIG_WRONG_TOOL:"Your {val} is not the right kind of tool to gather {val_2}",STATUSMSG_GROUND_WRONG_KIND:"This must be placed on {val}",STATUSMSG_PLACE_BLOCKED:"Failed to place block, something else got there first",STATUSMSG_PLACE_CHUNK_UNLOAD:"Failed to place block, chunk unloaded",STATUSMSG_SETTLEMENT_OUT_OF_BOUNDS:"Warning: Industry only works within Settlements",STATUSMSG_SETTLEMENT_OVERLAP:"Warning: Too close to other Settlements",STATUSMSG_TOOL_BROKE:"Tool broke :(",STATUSMSG_TOOL_BROKE_REPAIR:"Tool broke, but can be repaired at an Anvil",STATUSMSG_TOOL_BROKE_REPLACE:"Tool broke, auto-equipped replacement",STATUSMSG_TOOL_CUSTOM_NOT_ALLOWED:"Custom tools are not allowed in this world",PAGETITLE_DMCA:"FRVR: DMCA",PAGETITLE_GDPR:"FRVR: General Data Protection Regulation",PAGETITLE_PRIVACY_POLICY:"FRVR: Privacy Policy",PAGETITLE_TERMS_OF_SERVICE:"FRVR: Terms of Service",PAGETITLE_UPDATES:"Updates",CHATERROR_INVALID_POS_STRING:"Invalid position string: {val}",MSG_ALREADY_SAT_DOWN:"You're already sat down!",MSG_NOWHERE_TO_SIT:"Nowhere to sit on.",STATUSMSG_CANNOT_SPRINT:"Cannot sprint, out of {val}",STATUSMSG_CONSUME_OR_RETURN:"Consume some food or return to your Waygate through Menu | World Info",STATUSMSG_FALL_DAMAGE_SHIELD:"Protected from fall damage for {val, plural, one{# second} other{# seconds}}.",BTN_GET_COSTUME:'Get "{val}" outfit!',BTN_GET_NOW:"Get now!",BTN_GET_NOW_PRICE:"Get now! {val}",CUSTOMIZATION_CUSTOM_OUTFIT:"This outfit is made of mixed parts from multiple outfits.",DLG_CANT_SAVE_COSTUME_MSG:"You have selected items that you do not own",DLG_CANT_SAVE_COSTUME_TITLE:"You cannot save this outfit!",LBL_ENDS_ON:"Ends on {val}",LBL_LIMITED_TIME:"Limited time",TLTP_CUSTOM_OUTFIT:"Custom Outfit",TLTP_INFO:"Info",TLTP_ITEM_COLLECTION:"Belongs to a collection",TLTP_ITEM_COLOR_OF:"Color of an outfit",TLTP_ITEM_NOT_OWNED:"You do not own this item!",TLTP_ITEM_PART_OF:"Part of an outfit",TLTP_SAVE:"Save",TLTP_TAB_ARMS:"Arms",TLTP_TAB_COLORING:"Coloring",TLTP_TAB_COSTUMES:"Outfits",TLTP_TAB_HEADS:"Heads",TLTP_TAB_LEGS:"Legs",TLTP_TAB_TORSOS:"Torsos",CONTINENT_LOADER_COMPLETE:"Continent generation complete",CONTINENT_LOADER_NEW:"Generating new continent...",CONTINENT_LOADER_SYNCING:"Syncing continent with server...",BTN_DOWN:"Down",BTN_JUMP:"Jump",BTN_UP:"Up",STATUSMSG_STUCK_DIG_OR_WG:"You're pretty stuck!  Dig your way out, or 'gate away.",STATUSMSG_STUCK_MENU_OR_LEAVE:"You're pretty stuck!  Use the menu to Waygate elsewhere or leave the world.",COSMETIC_COLLECTION_2021_12:"Christmas 2021",COSMETIC_COLLECTION_2022_12:"Christmas 2022",COSMETIC_COLLECTION_CONQUERORS_OF_THE_SEA:"Conquerors of the Sea",COSMETIC_COLLECTION_EMBRACE_NATURE:"Embrace Nature",COSMETIC_COLLECTION_LEGACY:"Legacy",COSMETIC_COLLECTION_TRADITIONAL_ATTIRES:"Traditional Attires",COSMETIC_COLLECTION_VILLAGERS:"Meet the Villagers",COSMETIC_COLLECTION_WILD_MILITIA:"Wild Militia",COSMETIC_COLLECTION_EXPLORE_THE_WORLD:"Explore the World",COSMETIC_COLOR_BLUE_AERO:"Blue Aero",COSMETIC_COLOR_BLUE_LOBELIA:"Blue Lobelia",COSMETIC_COLOR_BLUE_OCEAN:"Blue Ocean",COSMETIC_COLOR_BROWN_BRIGHT:"Brown Chestnut",COSMETIC_COLOR_BROWN_CINNAMON_CRUMBLE:"Brown Cinnamon Crumble",COSMETIC_COLOR_BROWN_DARK_RUM:"Brown Rum",COSMETIC_COLOR_BROWN_ENGLISH_WALNUT:"Brown Walnut",COSMETIC_COLOR_BROWN_KURO:"Brown Kuro",COSMETIC_COLOR_BROWN_PASTEL:"Brown Pastel",COSMETIC_COLOR_BROWN_PRAIRIE_DOG:"Brown Prairie Dog",COSMETIC_COLOR_BROWN_SCORCHED:"Brown Scorched",COSMETIC_COLOR_BROWN_WEATHERVANE:"Brown Weathervane",COSMETIC_COLOR_EYRA_03:"Eyra #3",COSMETIC_COLOR_FRIZARD_01:"Frizard #1",COSMETIC_COLOR_FRIZARD_02:"Frizard #2",COSMETIC_COLOR_FRIZARD_03:"Frizard #3",COSMETIC_COLOR_GNARL_01:"Gnarl #1",COSMETIC_COLOR_GNARL_02:"Gnarl #2",COSMETIC_COLOR_GNARL_03:"Gnarl #3",COSMETIC_COLOR_GNARL_04:"Gnarl #4",COSMETIC_COLOR_GRAYSCALE_BLACK_WASH:"Black Wash",COSMETIC_COLOR_GRAYSCALE_KOKUSHOKU_BLACK:"Black Kokushoku",COSMETIC_COLOR_GRAYSCALE_ORKA_BLACK:"Black Orca",COSMETIC_COLOR_GRAYSCALE_TIN_SOLDIER:"Grey Tin Soldier",COSMETIC_COLOR_GREEN_GOBLIN:"Green Goblin",COSMETIC_COLOR_GREEN_LETTUCE:"Green Lettuce",COSMETIC_COLOR_GREEN_MARTINA_OLIVE:"Green Olive",COSMETIC_COLOR_GREEN_MOUNT_HYJAL:"Green Mount Hyjal",COSMETIC_COLOR_KHORNOS_01:"Khornos #1",COSMETIC_COLOR_KHORNOS_02:"Khornos #2",COSMETIC_COLOR_KHORNOS_03:"Khornos #3",COSMETIC_COLOR_RED_AZUKI:"Red Azuki",COSMETIC_COLOR_RED_KOBE:"Red Kobe",COSMETIC_COLOR_RED_MILANO:"Red Milano",COSMETIC_COLOR_TONE_01:"Human #1",COSMETIC_COLOR_TONE_02:"Human #2",COSMETIC_COLOR_TONE_03:"Human #3",COSMETIC_COLOR_TONE_04:"Human #4",COSMETIC_COLOR_TONE_05:"Human #5",COSMETIC_COLOR_TONE_06:"Human #6",COSMETIC_COLOR_VIOLET_CLEAR_MAUVE:"Violet Mauve",COSMETIC_COLOR_YELLOW_MANTICORE_WING:"Yellow Manticore",COSMETIC_COLOR_YELLOW_SUNFLOWER:"Yellow Sunflower",COSMETIC_COSTUME_2021_12_SANTA_HAT:"'21 Santa Hat",COSMETIC_COSTUME_2021_12_SNOWMAN:"'21 Snowman",COSMETIC_COSTUME_2021_12_SWEATER_1:"'21 Sweater #1",COSMETIC_COSTUME_2021_12_SWEATER_2:"'21 Sweater #2",COSMETIC_COSTUME_2022_12_REINDEER_1:"'22 Reindeer #1",COSMETIC_COSTUME_2022_12_REINDEER_2:"'22 Reindeer #2",COSMETIC_COSTUME_CAPTAIN:"Captain",COSMETIC_COSTUME_CUSTOM:"Custom",COSMETIC_COSTUME_EYRA_BOTANIST:"Botanist",COSMETIC_COSTUME_FRIZARD_ARCHAEOLOGIST:"Archaeologist",COSMETIC_COSTUME_FRIZARD_BUCCANEER:"Buccaneer",COSMETIC_COSTUME_FRIZARD_SEA_CAPTAIN:"Sea Captain",COSMETIC_COSTUME_GNARL_SHAMAN:"Shaman",COSMETIC_COSTUME_HAKAMA_BOY:"The Hakama",COSMETIC_COSTUME_KHORNOS_HUNTER:"Hunter",COSMETIC_COSTUME_KHORNOS_WARRIOR:"Warrior",COSMETIC_COSTUME_KHORNOS_WARRIORESS:"Warrioress",COSMETIC_COSTUME_SKELETON_MINION:"Skeleton Minion",COSMETIC_COSTUME_VILLAGER_1:"Villager #1",COSMETIC_COSTUME_VILLAGER_2:"Villager #2",COSMETIC_COSTUME_VILLAGER_3:"Villager #3",COSMETIC_COSTUME_VILLAGER_4:"Villager #4",COSMETIC_COSTUME_YUKATA_GIRL:"The Yukata",COSMETIC_FLAVOUR_CAPTAIN:"The best looking armor in town!",COSMETIC_FLAVOUR_EYRA_BOTANIST:"In charge of keeping the gardens blooming.",COSMETIC_FLAVOUR_FRIZARD_ARCHAEOLOGIST:"Loves dungeons and museums. Hates snakes and rolling boulders.",COSMETIC_FLAVOUR_FRIZARD_BUCCANEER:'"You\'ve got dangerous eyes... Not as dangerous as mine!"',COSMETIC_FLAVOUR_FRIZARD_SEA_CAPTAIN:'"Look at me, I am the captain now!"',COSMETIC_FLAVOUR_GNARL_SHAMAN:"The spiritual healer of the tribe.",COSMETIC_FLAVOUR_HAKAMA_BOY:"Hakama are tied at the waist and fall approximately to the ankles.",COSMETIC_FLAVOUR_KHORNOS_HUNTER:"This humanoid Hog is as wild as it's fashion style!",COSMETIC_FLAVOUR_MERRY_CHRISTMAS:"Merry Christmas!",COSMETIC_FLAVOUR_KHORNOS_WARRIOR:"These humanoid bovine soldiers are the heart of the army.",COSMETIC_FLAVOUR_SKELETON_MINION:"Spooky scary skeletons!",COSMETIC_FLAVOUR_SNOWMAN:"Christmas magic brought him to life!",COSMETIC_FLAVOUR_VILLAGER:"Your friendly neighbourhood worlds inhabitant.",COSMETIC_FLAVOUR_YUKATA_GIRL:"The perfect Kimono for casual settings and summer festivals.",COSMETIC_PART_ARMOR_CAPTAIN_ARM:"Golden Gauntlets",COSMETIC_PART_ARMOR_CAPTAIN_HEAD:"Golden Helmet",COSMETIC_PART_ARMOR_CAPTAIN_TORSO:"Golden Chestplate",COSMETIC_PART_EYRA_BOTANIST_ARM:"Vine Sleeves",COSMETIC_PART_EYRA_BOTANIST_HEAD:"Eyra Floral (Long)",COSMETIC_PART_EYRA_BOTANIST_LEG:"Botanist Boots",COSMETIC_PART_EYRA_BOTANIST_TORSO:"Botanist Jacket",COSMETIC_PART_FRIZARD_ARCHAEOLOGIST_ARM:"Archaeologist Sleeves",COSMETIC_PART_FRIZARD_ARCHAEOLOGIST_HEAD:"Archaeologist Fedora",COSMETIC_PART_FRIZARD_ARCHAEOLOGIST_LEG:"Frizard Scissor Feet",COSMETIC_PART_FRIZARD_ARCHAEOLOGIST_TORSO:"Archaeologist Jacket",COSMETIC_PART_FRIZARD_BUCCANEER_ARM:"Buccaneer Sleeves",COSMETIC_PART_FRIZARD_BUCCANEER_HEAD:"Buccaneer Hat",COSMETIC_PART_FRIZARD_BUCCANEER_LEG:"Frizard Frog Feet",COSMETIC_PART_FRIZARD_BUCCANEER_TORSO:"Buccaneer Dress",COSMETIC_PART_FRIZARD_SEA_CAPTAIN_ARM:"Sea Captain Gloves",COSMETIC_PART_FRIZARD_SEA_CAPTAIN_HEAD:"Sea Captain Hat",COSMETIC_PART_FRIZARD_SEA_CAPTAIN_LEG:"Frizard Reptilian Feet",COSMETIC_PART_FRIZARD_SEA_CAPTAIN_TORSO:"Sea Captain Cape",COSMETIC_PART_GNARL_SHAMAN_ARM:"Bony Wristbands",COSMETIC_PART_GNARL_SHAMAN_HEAD:"Gnarl Dreads (Medium)",COSMETIC_PART_GNARL_SHAMAN_LEG:"Shaman Boots",COSMETIC_PART_GNARL_SHAMAN_TORSO:"Bony Dress",COSMETIC_PART_HAKAMA_BOY_ARM:"Hakama Sleeves",COSMETIC_PART_HAKAMA_BOY_HEAD:"Human Bun (Short)",COSMETIC_PART_HAKAMA_BOY_LEG:"Waraji Sandals",COSMETIC_PART_HAKAMA_BOY_TORSO:"Hakama",COSMETIC_PART_KHORNOS_HUNTER_ARM:"Naked Arms",COSMETIC_PART_KHORNOS_HUNTER_HEAD:"Hog Head (Mohawk)",COSMETIC_PART_KHORNOS_HUNTER_LEG:"Ringed Hooves",COSMETIC_PART_KHORNOS_HUNTER_TORSO:"Tank Top",COSMETIC_PART_KHORNOS_WARRIORESS_ARM:"Battle Wrist Armor",COSMETIC_PART_KHORNOS_WARRIORESS_HEAD:"Cow Head (Medium Horns)",COSMETIC_PART_KHORNOS_WARRIORESS_LEG:"Ringed Hooves",COSMETIC_PART_KHORNOS_WARRIORESS_TORSO:"Battle Armored Top",COSMETIC_PART_KHORNOS_WARRIOR_ARM:"Battle Bracelets",COSMETIC_PART_KHORNOS_WARRIOR_HEAD:"Bull Head (Long Horns)",COSMETIC_PART_KHORNOS_WARRIOR_LEG:"Hooves",COSMETIC_PART_KHORNOS_WARRIOR_TORSO:"Battle Harness",COSMETIC_PART_SKELETON_MINION_ARM:"Bony Arm",COSMETIC_PART_SKELETON_MINION_HEAD:"Minion Skull",COSMETIC_PART_SKELETON_MINION_LEG:"Punctured Boots",COSMETIC_PART_SKELETON_MINION_TORSO:"Minion Tórax",COSMETIC_PART_VILLAGER_ARM:"Villager Sleeves",COSMETIC_PART_VILLAGER_ARM_2021_12_SWEATER:"2021 Christmas Sleeves",COSMETIC_PART_VILLAGER_ARM_CROSS:"Corset Sleeves",COSMETIC_PART_VILLAGER_ARM_INVERTED:"Tunic Sleeves",COSMETIC_PART_VILLAGER_ARM_SNOWMAN:"Snowman Arm",COSMETIC_PART_VILLAGER_HEAD_MEDIUM_BUN:"Human Bun (Medium)",COSMETIC_PART_VILLAGER_HEAD_MEDIUM_DOUBLEBUN:"Human Doublebun (Medium)",COSMETIC_PART_VILLAGER_HEAD_REINDEER_1:"Human Reindeer Headband #1",COSMETIC_PART_VILLAGER_HEAD_REINDEER_2:"Human Reindeer Headband #2",COSMETIC_PART_VILLAGER_HEAD_SANTAHAT:"Human Santa Hat",COSMETIC_PART_VILLAGER_HEAD_SHORT:"Human Caesar Cut (Short)",COSMETIC_PART_VILLAGER_HEAD_SHORT_SIDEFRINGE:"Human Sidefringe (Short)",COSMETIC_PART_VILLAGER_HEAD_SNOWMAN:"Snowman Tall Hat",COSMETIC_PART_VILLAGER_LEG_METAL:"Golden Leg Armor",COSMETIC_PART_VILLAGER_LEG_SHORT_BOOT:"Villager Short Boots",COSMETIC_PART_VILLAGER_LEG_TALL_BOOT:"Villager Tall Boots",COSMETIC_PART_VILLAGER_LEG_THIGH_BOOT:"Villager Thigh Boots",COSMETIC_PART_VILLAGER_TORSO:"Villager Suspenders",COSMETIC_PART_VILLAGER_TORSO_2:"Villager Vest",COSMETIC_PART_VILLAGER_TORSO_2_SNOWMAN:"Snowman Vest",COSMETIC_PART_VILLAGER_TORSO_3:"Villager Corset",COSMETIC_PART_VILLAGER_TORSO_3_2021_12_SWEATER:"2021 Christmas Sweater",COSMETIC_PART_VILLAGER_TORSO_4:"Villager Tunic",COSMETIC_PART_VILLAGER_TORSO_4_2021_12_SWEATER:"2021 Christmas Sweater #2",COSMETIC_PART_YUKATA_GIRL_ARM:"Yukata Sleeves",COSMETIC_PART_YUKATA_GIRL_HEAD:"Human Bun (Long)",COSMETIC_PART_YUKATA_GIRL_LEG:"Zori Sandals",COSMETIC_PART_YUKATA_GIRL_TORSO:"Yukata",COSMETIC_RACE_EYRA:"Eyra",COSMETIC_RACE_FRIZARD:"Frizard",COSMETIC_RACE_GNARL:"Gnarl",COSMETIC_RACE_HUMAN:"Human",COSMETIC_RACE_HUMAN_KINDA:"Human?",COSMETIC_RACE_KHORNOS:"Khornos",COSMETIC_RACE_UNDEAD:"Undead",COSMETIC_TYPE_ARMS:"Arms",COSMETIC_TYPE_COLOR_EYES:"Eye Color",COSMETIC_TYPE_COLOR_HAIR:"Hair Color",COSMETIC_TYPE_COLOR_SKIN:"Skin Tone",COSMETIC_TYPE_COSTUME:"Outfit",COSMETIC_TYPE_HEAD:"Head",COSMETIC_TYPE_LEGS:"Legs",COSMETIC_TYPE_TORSO:"Torso",CMODS_DIG_DURABILITY:"Durability",CMODS_DIG_RATE:"Speed",CMODS_NOT_GOOD:"This can't be good...",CMODS_O2_CAPACITY:"O2 Capacity",CMODS_RANDOM_BONUSES:"+{val}-{val_2} random bonuses",CMODS_STAMINA_CAPACITY:"{val} Capacity",CMODS_STAMINA_DRAIN:"{val} Drain",CMODS_STAMINA_RANGE:"Range",CMODS_STAMINA_RATE:"Less {val} Usage",CMODS_TIMED:"{val} {val_2} for {val_3}",CMODS_TIMED_DIG_RATE:"Gather Speed",CMODS_TIMED_SPRINTING_STAMINA:"Sprinting {val}",CMODS_TIMED_STAMINA:"{val}/second",CMODS_TIMED_STAMINA_CAPACITY_WGSICK:"{val} (Waygate Sickness)",DOWSERUI_ORE_DETECTED:"{val} ore detected!",DOWSERUI_UNIDENTIFIED:"Unidentified ore detected.",BTN_DRINK:"Drink",ENERGYWELL_CANCEL_SICKNESS:"Note: Bonus time will instead cancel that much Waygate Sickness",ENERGYWELL_CANCEL_SICKNESS_SOME:"Note: Some bonus time will cancel your Waygate Sickness",ENERGYWELL_FULL:"You are already at full {val}",ENERGYWELL_LAST_DRINK:"Your last drink was {val} ago",ENERGYWELL_MUST_VISIT:"You must visit and Energy Well in-world to drink...",ENERGYWELL_READY:"Ready!",ENERGYWELL_RECHARGING:"The Energy Well is still recharging...",ENERGYWELL_WITHIN_SETTLEMENT:"Energy Wells only work within your Home Settlement",LBL_CURRENT_ENERGY:"Current {val}",LBL_OVERFILL_ENERGY:"Overfill: +{val} for {val_2}",LBL_REFILL_ENERGY:"Refill {val}",LBL_WELL_RESTED:"Well Rested: +{val} for {val_2}",STATUSMSG_ENERGY_WELL_ADD:"+{val} (Energy Well)",BTN_FINISH:"Finish",ERR_CRAFTING_CANNOT_COMPLETE:"Storage full: Crafting cannot complete",ERR_CRAFTING_STALLED:"Storage full: Crafting stalled",ERR_INSUFFICIENT_RESOURCES:"Cannot craft: Insufficient resources loaded",ERR_INVALID_INPUT:"Cannot craft: Invalid input combination",FACTORY_CRAFTING_COMPLETE:"Crafting complete: Take this to continue",FACTORY_CRAFTING_IN_PROGRESS:"Crafting in progress... check back later!",FACTORY_FULL_INVENTORY:"Cannot take: Inventory full",FACTORY_NO_RECIPES_AVAILABLE:"No recipes available",FACTORY_PROGRESS_READY:"Ready!",FACTORY_REFRESHING_CONTENTS:"Refreshing contents...",FACTORY_UPGRADE_SETTLEMENT_TO_UNLOCK:"Upgrade your Settlement to unlock",FORMAT_CRAFTING_PROGRESS:"{val} ({val_2})",FORMAT_NUMBER_OR_MORE:"{val}+",LBL_CRAFTING_COMPLETE:"Crafting Complete!",LBL_MISSING_PROP:"Missing prop",LBL_NO_RECIPE_SELECTED:"No Recipe Selected",LBL_OUTPUT_MULTIPLE:"{val} (x{val_2})",LBL_REFRESHING_FACTORY:"Refreshing...",LBL_SELECT_RECIPE:"Select Recipe",RECIPELIST_ALL_UNLOCKED_FOR_STATION:"All recipes for this station unlocked!",RECIPELIST_AMOUNT_UNLOCKED:"{total, plural, one{{val} of # recipe unlocked} other{{val} of # recipes unlocked}}",RECIPELIST_EVEN_MORE_FROM_LATER_UPGRADES:"Even more recipes available from later upgrades",RECIPELIST_UNLOCK_MORE_BY_UPGRADING:"Unlock more recipes by upgrading your Settlement",RECIPELIST_UPGRADE_SETTLEMENT_TO_UNLOCK:"Upgrade your Settlement at the Waygate to unlock",STATUSMSG_CANNOT_CHANGE_RECIPE_NO_SPACE:"Unable to change recipe: insufficient space to eject loaded inputs",STATUSMSG_SOME_ITEMS_DROPPED:"Some items dropped on ground",TLTP_ADD_TO_RECIPE:"Add to recipe",TLTP_ENOUGH_FOR_ONE:"(enough for one)",HUDS_GEM_FOUND_ALL:"All {val} gems found!",HUDS_GEM_FOUND_ONE:"{val} Gem found!",HUDS_GEM_HIDDEN:"This world {gems, plural, one{has a hidden gem} other{has hidden gems}}",HUDS_IN_OUTSKIRTS_OF:'In outskirts of "{val}"',HUDS_IN_SETTLEMENT:'In Settlement "{val}"',HUDS_IN_THE_WILDS:"In the Wilds",STATUSMSG_ITS_DARK:"It's pretty dark!  {val}",STATUSMSG_SETTLEMENT_NO_ACCESS:"(you do not have access to this Settlement)",STATUSMSG_STAMINA_DAMAGE:"-{val} ({val_2})",STATUSMSG_STAMINA_MODS:"{val} {val_2} {val_3}",TLTP_WORLD_CLICK_TO_LIKE:"Click to like this world",TLTP_WORLD_LIKED:"You like this world!",TLTP_WORLD_TIMES_VIEWED:"This world {views, plural, one{has been viewed # time} other{has been viewed # times}}",DLG_ERROR_GETTING_PHOTO_TITLE:"Error getting photo",DLG_ERROR_TOURNAMENT_CREATING_TITLE:"Error Creating Tournament",DLG_ERROR_TOURNAMENT_LEAVING_TITLE:"Error Leaving Tournament",DLG_ERROR_TOURNAMENT_SUBMITTING_TITLE:"Error Submitting Tournament Score",DLG_INITIALIZING_PURCHASE_TITLE:"Initializing Purchase",DLG_INVITING_TITLE:"Inviting!",DLG_OFFICIAL_GROUP_TITLE:"Getting Official Group",DLG_OFFICIAL_PAGE_TITLE:"Getting Official Page",DLG_PURCHASE_FAILED_PROCESS_MSG:"Error processing purchase: {error}",DLG_PURCHASE_FAILED_SYNC_MSG:"Purchase succeeded but failed to sync. Try reloading the page. Error={error}",DLG_SHARE_BLUEPRINT_MSG:"Worlds FRVR Blueprint | {val}",DLG_SHARE_WORLD_CURRENT_JOIN:"Join {val}",DLG_SHARE_WORLD_FRIEND_INVITING_MSG:"{val} is inviting you to play in {val_2} in Worlds FRVR!",DLG_SHARE_WORLD_FRIEND_JUST_PLAYED_MSG:"{val} just played  {val_2}!",DLG_SHARING_BLUEPRINT_TITLE:"Sharing Blueprint",DLG_SHARING_PHOTO_TITLE:"Sharing Photo",DLG_SHARING_WORLD_TITLE:"Sharing World",DLG_TOURNAMENT_CREATING_TITLE:"Creating Tournament",DLG_TOURNAMENT_LEAVING_TITLE:"Leaving Current Tournament",DLG_TOURNAMENT_SUBMITTING_TITLE:"Submitting Tournament Score",ERR_FB_PURCHASE_NOT_LOGGED:"Not logged in",ERR_FB_PURCHASE_NOT_READY:"FB Payments not ready",ERR_LOAD_BLUEPRINT_IMAGE:"Failed to load blueprint image",ERR_LOAD_WORLD_IMAGE:"Failed to load",FBINSTANT_SHARE_PHOTO:"Worlds FRVR Photo",FBINSTANT_SHARE_WORLD:"Worlds FRVR | {val}",FBINSTANT_TAKE_SCREENSHOT:"I took a photo in Worlds FRVR!",FEEDBACK_DESC_ACCOUNT_DELETE:'For account deletion, please type in "{text}" and we will delete your account within a week.',FEEDBACK_DESC_DISCORD:"For additional support, please visit us on Discord: {val}",FEEDBACK_DESC_FACEBOOK:"For additional support, please contact us through our Facebook page.",FEEDBACK_DESC_GENERIC:"Your feedback is important to us! We receive a lot of feedback and cannot address every individual issue, but we will do our best to consider all submitted feedback.",FEEDBACK_DESC_YANDEX:"For additional support press the Yandex Menu button and choose Feedback.",FEEDBACK_ERROR_WHAT_CAUSED:"What were you doing when you encountered the error?",LBL_ERROR_DETAILS:"Error details",LBL_FEEDBACK_TEXT:"Bug Report / Feedback",STATUSMSG_FEEDBACK_SUBMITTED:"Feedback submitted",STATUSMSG_FEEDBACK_SUBMIT_ERROR:"Error submitting feedback",ERR_CUSTOM_TEXTURES_NOT_ALLOWED:"Custom textures not allowed",ERR_INVALID_DATA_HEADER:"Invalid data header: {val}",BTN_CREATE_LF:"I'll explore the Lost Frontier!",BTN_CREATE_UNL:"An Unlimited World, please!",BTN_EXPLORE_OTHER_WORLDS:"Explore on my own!",LBL_LOST_FRONTIER:"Lost Frontier",LBL_UNLIMITED:"Unlimited",LBL_WELCOME_TITLE:"Welcome to",MSG_CREATE_LF_DESC:"Build your own Settlement and gather resources. Explore an undiscovered world!",MSG_CREATE_UNL_DESC:"Unlimited resources, imagination is the only limit. Build anything that you want!",MSG_EXPLORE_OTHER_WORLDS_DESC:"You can also explore other amazing worlds made by players from all over the globe!",MSG_WHAT_KIND_OF_WORLD:"What kind of world do you want to create?",BTN_COMING_SOON:"Coming soon!",BTN_CONSUME:"Consume",BTN_DROP:"Drop",BTN_PUT:"Put",BTN_PUT_ALL:"Put All",BTN_QUICK_DEPOSIT:"Quick Deposit",BTN_SORT:"Sort",BTN_SPLIT:"Split",BTN_TAKE_ALL:"Take All",BTN_USE:"Use",DLG_DISPLAY_NAME_CHANGED_MSG_NEW:"Display name changed to {val}!",DLG_DISPLAY_NAME_CHANGED_MSG_USERID:"Your User ID (login) remains {val}.",DLG_DISPLAY_NAME_CHANGED_TITLE:"Display Name Changed",DLG_DISPLAY_NAME_ERROR_MSG:"Unable to rename: lost connection",DLG_DISPLAY_NAME_MSG:"Enter a new name for yourself",DLG_DISPLAY_NAME_TITLE:"Display Name",INVENTORYUI_AMOUNT_INSUFFICIENT:"({val} short)",INVENTORYUI_AMOUNT_ONE:"(one)",INVENTORYUI_CONTAINER:"container",INVENTORYUI_INVENTORY:"inventory",INVENTORYUI_MISSING_CONTAINER:"Missing container",INVENTORYUI_REFRESHING_CONTENTS:"Refreshing contents...",LBL_TRANSFER:"Transfer",STATUSMSG_CANNOT_DROP:"Cannot drop: could not find empty space",STATUSMSG_CANNOT_PUT:"Cannot put all: {val} full",STATUSMSG_CANNOT_TAKE:"Cannot take all: {val} full",STATUSMSG_QUICK_DEPOSIT_FAIL_FULL:"Quick Deposit failed: Full container",STATUSMSG_QUICK_DEPOSIT_FAIL_NO_CONTAINERS:"Quick Deposit failed: No nearby containers",STATUSMSG_QUICK_DEPOSIT_FAIL_NO_MATCH:"Quick Deposit failed: Nothing matching nearby containers",STATUSMSG_QUICK_DEPOSIT_FAIL_PARTIAL:"Quick Deposit partially complete: Full container",STATUSMSG_QUICK_DEPOSIT_SUCCESS:"Quick Deposit: {items, plural, one{# item stored} other{# items stored}} {containers, plural, one{in # nearby container} other{in # nearby containers}}",STATUSMSG_QUICK_STORE_FAIL_FULL:"Cannot quick-store: {val} full",TLTP_ADD_QUICKBAR:"Add to quickbar and exit menu",TLTP_CHANGE_NAME:"Change Display Name",TLTP_DEPOSIT_ALL_NEARBY:"Deposit all items into nearby containers with matching items",TLTP_DROP:"Drop",TLTP_EQUIPMENT_EQUIP:"Equip",TLTP_EQUIPMENT_SLOT:"Equipment slot for {val}",TLTP_EQUIPMENT_SLOT_DEFAULT_CRUDE_TOOLS:"(Empty, using default crude tool)",TLTP_EQUIPMENT_SLOT_DEFAULT_TOOLS:"(Empty, using default tool)",TLTP_EQUIPMENT_SPLIT_STACK:"Split stack",TLTP_EQUIPMENT_UNEQUIP:"Un-equip",TLTP_ITEM_IN_TRASH:"{val} (in trash)",TLTP_NEXT_SKIN:"Next skin",TLTP_PREVIOUS_SKIN:"Previous skin",TLTP_SORT_AND_STACK:"Sort and stack items",TLTP_STACK:" {val} (stack)",TLTP_TRASH:"Trash",TLTP_TRASH_EMPTY:"Empty Trash",DLG_ERROR_INVENTORY_RESET_MSG:"Try reloading the app or page if this persists.",DLG_ERROR_INVENTORY_RESET_TITLE:"Error Resetting Inventory",INVENTORY_ITEM_LABEL_HATCHET:"gathering wood (Hatchet)",INVENTORY_ITEM_LABEL_PICKAX:"gathering stone (Pickax)",INVENTORY_ITEM_LABEL_SHOVEL:"gathering dirt (Shovel)",STATUSMSG_CANT_GRANT_INVENTORY_LOCKED:"Could not grant items: inventory locked",STATUSMSG_ITEM_ADD:"+{val} {val_2} ({val_3})",STATUSMSG_ITEM_AUTO_EQUIP:"Auto-equipped {val}",STATUSMSG_ITEM_AUTO_GRANT:"Auto-granted {val}",STATUSMSG_ITEM_REMOVED:"Removed {val}",ITEMINFO_CANT_AFFORD_ALERT:"You cannot afford to build this.",ITEMINFO_FIRST_SETTLEMENT_FREE:"First Settlement Waygate is free!",ITEMINFO_NOT_IN_INVENTORY_ALERT:"You do not have this in your inventory.",ITEMINFO_SETTLEMENT_LOCKED_ALERT:"This is not yet unlocked in your current Settlement.",ITEMINFO_UNLIMITED_ONLY_ALERT:"This can only be built directly in Unlimited Mode worlds.",LBL_BUILD_COST:"Build Cost",LBL_CRAFTED_BY:"Crafted by",LBL_CRAFT_FROM:"Crafted from",LBL_CRAFT_FROM_AMOUNT:"{val} crafted from",LBL_EXAMPLES:"Examples",LBL_ITEM_CONTEXT_BUILD:"(Build)",LBL_ITEM_CONTEXT_ITEM:"(Item)",LBL_ITEM_CONTEXT_RECIPE:"(Recipe)",LBL_ITEM_CONTEXT_SETTLEMENT_UPGRADE:"(Settlement Upgrade)",TLTP_VIEW_BUILD_INFO:"View build info",TLTP_VIEW_CRAFT_COST:"View crafting cost",TLTP_VIEW_ITEM_INFO:"View item info",LOADCUSTOM_WAITING_ON:"{loads, plural, one{Waiting on # load} other{Waiting on # loads}}...",ERR_LANGUAGE_NOT_FOUND:'Language "{val}" not supported',MSG_LANGUAGE_GET:"The current language is {val}",MSG_LANGUAGE_SET:"The language changed to {val}",DLG_REWARD_TITLE:"Congratulations!",DLG_REWARD_REFERRAL_MSG:"{friends, plural, one{A friend} other{# friends}} you invited {friends, plural, one{has} other{have}} started to play Worlds FRVR!",DLG_REWARD_GEM_MSG:"Here is your free {val}♦ Gem reward!",DLG_EXIT_CONFIRMATION_MSG:"Pending changes will be lost.",DLG_EXIT_CONFIRMATION_TITLE:"Are you sure you want to exit?",MSG_COPY_TEXT_FAILURE:"Copy to clipboard FAILED, please copy from below.",MSG_COPY_TEXT_SUCCESS:"Copied to clipboard!",WINDOW_TITLE:"Worlds FRVR",WINDOW_TITLE_COMPOSITE:"{val} | Worlds FRVR",BTN_BUILD_CONTEST:"Build Contest!",BTN_FEEDBACK_ACCOUNT:"Feedback / Account",BTN_JOIN_OUR_GROUP:"Join our Group!",BTN_LATEST_NEWS:"Latest News",BTN_OUTFIT:"Outfit",BTN_PLAY:"Play",BTN_RECENT_UPDATES:"Recent Updates",DLG_ACCESS_TOKEN_APPLIED_TITLE:"Access Token Applied",DLG_ERROR_ACCESS_TOKEN_TITLE:"Access Token Error",DLG_ERROR_WORLD_CREATE_TITLE:"World Creation Error",DLG_ERROR_WORLD_DELETE_TITLE:"World Deletion Error",DLG_ERROR_WORLD_FORGET_TITLE:"World Forget Error",DLG_ERROR_WORLD_PASSWORD_TITLE:"World Password Error",DLG_NEW_WORLD_NAME_MSG:"Enter a name for your new world",DLG_JOIN_USER_FAILED_NOT_FOUND_MSG:"The user {user} cannot be found.",DLG_JOIN_USER_FAILED_NOT_PLAYING_MSG:"The user is not currently playing.",DLG_JOIN_USER_FAILED_TITLE:"Joining User Failed",GAME_MODE_LOST_FRONTIER:"Lost Frontier",GAME_MODE_LOST_FRONTIER_BETA:"Lost Frontier - BETA",GAME_MODE_UNLIMITED:"Unlimited",LBL_ACCESS_TOKEN_ENTER:"Enter Access Token",LBL_CONTINENT_DATA_MOD:"Continent data provided by mod",LBL_DISCORD_WORLDS:"Worlds Discord",LBL_DMCA:"DMCA",LBL_FEATURED_WORLDS:"Featured Worlds",LBL_FRIENDS_IN_WORLD:"Friends In-World",LBL_GAME_MODE:"Game Mode",LBL_GDPR:"GDPR",LBL_MEANWHILE_CHECK_OUT:"Meanwhile check out",LBL_MY_WORLDS:"My Worlds",LBL_MY_WORLDS_FROZEN:"My Frozen Worlds",LBL_SEARCH:"Search",LBL_USERS_ONLINE_NUMBER:"{users, plural, one{# user online} other{# users online}}",LBL_WORLDS:"Worlds",LBL_WORLDS_ACTIVE:"Active Worlds",LBL_WORLDS_ACTIVE_AND_RECENT:"Active and Recent Worlds",LBL_WORLDS_RECENT:"Recent Worlds",LBL_WORLD_PASSWORD_ENTER:"Enter World Password",LBL_WORLD_SEED:"World Seed",LBL_WORLD_SEED_ENTER:"Enter a random seed for your new world",LBL_WORLD_SEED_SHORT:"Seed",LBL_WORLD_TYPE:"World Type",LOGINMSG_RECONNECTING:"Connection lost, attempting to reconnect ({val})...",MSG_ACCESS_TOKEN_VALIDATING:"Validating access token...",MSG_ACTIVE_WORLDS_NOT_FOUND:"No active worlds found",MSG_ACTIVE_WORLDS_QUERYING:"Querying...",MSG_PARTY_CHOOSING_HOST:"Choosing a Party host...",MSG_PARTY_HOST_IN_PRIVATE_WORLD:"The Party host is in a private World.\nPlease wait until the host joins another World.",MSG_PARTY_WAITING_HOST_WORLD:"Waiting for the Party host to join a World...",MSG_PASSWORD_VALIDATING:"Validating password...",MSG_REDDIT_FOR_MORE_INFO:"Check out {val} for more info!",MSG_SEARCHING:"Searching...",MSG_SERVER_NEEDS_ACCESS_TOKEN:"This server requires an Access Token.",PAGETITLE_CREATE_NEW_WORLD:"Create New World",SETTING_AUTO_FULLSCREEN_HELP:"Automatically enter full-screen when clicking Play on the main menu, if available",SETTING_NOT_AVAILABLE_ON_DEVICE:"Not available on this device",TLTP_SEARCH_WORLDS_ALL:"Search all worlds",TLTP_SEARCH_WORLDS_BUILDER:"Search only worlds where you can build",TLTP_SORT_BY_LIKES:"Sort by Likes",TLTP_SORT_BY_NAME:"Sort by Name",TLTP_SORT_BY_VIEWS:"Sort by Views",WORLD_CREATE_BETA_WARN_MSG:"We are actively developing gameplay content, adding new procedural generation, and reworking content. During this beta period, many things may be removed, change or experience corruption.",WORLD_CREATE_BETA_WARN_TITLE:"Build at your own risk!",WORLD_SEED_EMPTY:"Empty",WORLD_TYPE_FLAT:"Flat (persistent)",WORLD_TYPE_GENERATED_V1:"Generated V1",WORLD_TYPE_SMALL:"Small",DLG_GENERATE_TOKENS_TITLE:"Generate Tokens",ERR_INVALID_BP_ID:"Invalid Blueprint ID",ERR_INVALID_PHOTO_ID:"Invalid Photo ID",ERR_PROP_FAR_AWAY:"{val} too far away",ERR_PROP_MISSING:"{val} missing",LBL_BUILD_BLUEPRINT:"Build/Blueprint",LBL_CHARACTER:"Character",LBL_CONTAINER:"Container",LBL_FRIENDS:"Friends",LBL_INVENTORY_CHARACTER:"Inventory/Character",LBL_QUICKSLOT:"Quick-Slot",LBL_SETTINGS:"Settings",LBL_WAYGATE:"Waygate",LBL_WORLD_INFO:"World Info",PAGETITLE_BLUEPRINT:"{val} (Blueprint)",DLG_API_ACCESS_MSG:"A mod at {val} is requesting access. Access will persist until you reload the page. Allow?",DLG_API_ACCESS_TITLE:"Mod API Access",BTN_CONTROLLING_CAMERA:"Controlling: Camera",BTN_CONTROLLING_PLAYER:"Controlling: Player",BTN_EXIT_PHOTO_MODE:"Exit Photo Mode",BTN_HIDE_SELF:"Hide Self",BTN_RETAKE_PHOTO:"Retake",BTN_SAVE_PHOTO:"Save Photo",BTN_SHOW_SELF:"Show Self",CHATERROR_COPY_NOT_SUPPORTED:"Copy to clipboard not supported: ({val})",DLG_ERROR_TAKING_PHOTO_TITLE:"Error taking photo",DLG_SAVING_PHOTO_TITLE:"Saving Photo",ERR_COULD_NOT_COMPRESS:"Could not compress into valid size.",ERR_WG_DEFAULT_VOXELS:"Waygate images must use default voxel packs",LBL_CONFIRM_WG_IMAGES:"Confirm Waygate Images",LBL_FIELD_OF_VIEW_SHORT:"FOV",LBL_PHOTO_TAKEN:"Photo Taken",LBL_TIME_OF_DAY_SHORT:"Time",STATUSMSG_CLICK_TAKE_PHOTO:"Click to take photo",LBL_CREATED:"Created",LBL_LOCATION:"Location",PHOTOMSG_ID_INVALID:"Photo ID invalid",PHOTOMSG_LOADING:"Photo data loading...",PHOTOTITLE_AUTHOR:"Photo by {val}",PHOTOTITLE_ERROR:"Photo (Error)",PHOTOTITLE_LOADING:"Photo (Loading...)",DLG_ARE_YOU_SURE_TITLE:"Are you sure?",DLG_ENTER_NEW_VALUE_MSG:"Enter a new value for {val}",DLG_INVALID_VALUE_INSERTED_MSG:"The value inserted is invalid.",LBL_PROPERTY_EDITOR:"Property Editor",STATUSMSG_SAVE_FAILED:"Save Failed.",STATUSMSG_SAVE_FAILED_NO_PROP:"Save Failed. Prop not found.",DLG_CHANGING_NAME_WILL_RESET_MSG:"Changing the name will reset all scores saved in this flag.",DLG_COURSE_GOAL_NAME_MSG:"Enter the name for this flag's course.",DLG_COURSE_START_NAME_MSG:"Enter the name for this buzzer's course.",DLG_ENTER_SIGN_TEXT_MSG:"Enter a message to display on the sign.",DLG_START_OTHER_RACE_MSG:"Do you want to start this race and abandon your previous one?",DLG_SUBMITTING_SCORE_TITLE:"Submitting Score",FORMAT_BUZZER_SCORE:"{val} - {val_2}",LBL_COURSE_FINISH:"Course Finish",LBL_COURSE_NAME:"Course Name",LBL_COURSE_START:"Course Start",LBL_SIGN_TEXT:"Sign Text",MSG_SIGN_DEFAULT_TEXT:"Hello!",STATUSMSG_ASSIGN_BUZZER_NAME:"Interact while holding Race Start Buzzer to assign a name.",STATUSMSG_ASSIGN_FLAG_NAME:"Interact while holding Race Goal Flag to assign a name.",STATUSMSG_EXHAUSTED_TO_USE_BUCKET:"You are too exhausted to use your Water Bucket",STATUSMSG_MINE_PROP_FULL:"Cannot destroy prop: Empty contents first",STATUSMSG_MINE_PROP_NAMED:"Cannot destroy prop: Clear name first",STATUSMSG_MINE_WG_LINKED:"Cannot destroy waygate: Remove ID first",STATUSMSG_RACE_RESTARTED:"Current race restarted!",STATUSMSG_REMOVE_SPOTLIGHT_TO_EDIT:"Remove spotlight from Flag before editing.",DLG_EQUIPMENT_SLOTS_MSG:"Gathering Tools must be placed in your Equipment Slots (found to the right of your character), not in your Quickbar, to be automatically used.",DLG_EQUIPMENT_SLOTS_TITLE:"Use Equipment Slots",ERR_NOT_IN_WORLD:"Not currently in a world",LBL_BRUSH_MODE_1X1:"1x1",LBL_BRUSH_MODE_2X1:"2x1",LBL_BRUSH_MODE_2X2:"2x2",LBL_BRUSH_MODE_3X1:"3x1",LBL_BRUSH_MODE_3X3:"3x3",LBL_BRUSH_MODE_FLIPPED:"Flipped",LBL_GATHERING_TOOLS:"Gathering Tools",STATUSMSG_LIGHT_MINI_KB:"Press {val} to pull out your lantern.",STATUSMSG_LIGHT_MINI_TOUCH:"Tap your lantern to get some light.",STATUSMSG_LIGHT_NOSLOT_KB:"Press {val} or use the {val_2} to start building a torch.",STATUSMSG_LIGHT_NOSLOT_TOUCH:"Long-press a Quickbar slot or use the Build menu to start building a torch.",STATUSMSG_LIGHT_SLOT_KB:"Press {val} or select a light in the Quickbar.",STATUSMSG_LIGHT_SLOT_TOUCH:"Select a torch or lantern in the Quickbar.",STATUSMSG_WOOD_FOR_TORCH:"Wood is required to build a torch",TLTP_CHANGE_BRUSH:"Change brush size",TLTP_EMPTY_SLOT:"(Empty slot)",TLTP_LOW_DURABILITY:"Low durability on your {val}",TLTP_QBAR_FLIP:"Flip",TLTP_QBAR_UNBIND:"Unbind",TLTP_QUICKSLOT_ITEM:"Quick-slot item",TLTP_RECENT_ITEM:"(Recent item)",TLTP_RECENT_ITEM_EXISTING:"{val} (recent item)",TLTP_SELECT_LANTERN_OR_TORCH:"Select lantern or torch",TLTP_SWAP_TO_GATHERING:"Swap to Gathering Tools",TLTP_SWAP_TO_RECENT:"Swap to recent item",TLTP_TOGGLE_LANTERN:"Toggle lantern",TLTP_TOOL_IN_HAND:"{val} (in hand)",BTN_CANCEL_SCORE_REMOVAL:"Cancel Score Removal",BTN_CREATE_TOURNAMENT:"Create Tournament",BTN_LEAVE_TOURNAMENT:"Leave Tournament",BTN_REMOVE_SCORE:"Remove Score",BTN_SPOTLIGHT_RESULTS:"Spotlight Results",DLG_REMOVE_SCORE_MSG:"Are you sure you want to remove this score from the race results?  If the race has been modified, consider clearing all scores by re-placing the Race Goal Flag.  Only remove individuals' scores if someone is suspected of cheating or your own score.  If the user is suspected of cheating, you may want to ban them from the world first.",DLG_REMOVE_SCORE_TITLE:"Remove Score",DLG_REMOVING_SCORE_TITLE:"Removing Score",DLG_TOURNAMENT_SWITCH_MSG:"You can only race in a single Tournament at a time.  Do you want to switch your current Tournament?",DLG_TOURNAMENT_SWITCH_TITLE:"Switch Current Tournament?",FORMAT_RANK_NUMBER:"{val}.",LBL_RACE_RESULTS:"Race Results",LBL_WORLD_INFO_MENU:"World Info Menu",RACERESULTS_ALL_SCORES:"All Scores ({val})",RACERESULTS_NEW_BEST:"New Best Score!",RACERESULTS_NO_RANK:"No Rank",RACERESULTS_YOUR_SCORE:"Your Score",TLTP_REMOVE_SCORE:"Remove an individual score from the results list",TLTP_SPOTLIGHT_RESULTS:"Display these results in the {val} for anyone in this world",BTN_ABANDON_RACE:"Abandon?",DLG_LEAVE_RACE_MSG:"Do you want to leave your current race attempt?",LBL_READY_TIME:"Ready",REDDOT_NEW:"New!",LBL_GREETING_1:"Hi, {val}",LBL_GREETING_2:"Hello, {val}",LBL_GREETING_3:"Welcome, {val}",BTN_AA_OFF:"Antialiasing: Off",BTN_AA_OFF_PENDING:"Antialiasing: (Off)",BTN_AA_ON:"Antialiasing: On",BTN_AA_ON_PENDING:"Antialiasing: (On)",BTN_BUGS_FEEDBACK:"Bugs / Feedback",BTN_BUILD_INTEGRATED:"Build Menu: Integrated",BTN_BUILD_SEPARATE:"Build Menu: Separate",BTN_CAMERA_FP:"First person camera",BTN_CAMERA_TP:"Third person camera",BTN_CHAT_KEEP_FOCUS:"Chat: Keep Focus",BTN_CHAT_UNFOCUS:"Chat: Auto-Unfocus",BTN_EXIT_FULLSCREEN:"Exit Fullscreen",BTN_FAST:"Fast",BTN_FLY_ALT_LOCKED:"Fly: Altitude-locked",BTN_FLY_RELATIVE:"Fly: Relative",BTN_FULLSCREEN:"Fullscreen",BTN_FULLSCREEN_KEY:"Fullscreen ({val})",BTN_LAYOUT_AUTO:"Layout: Auto",BTN_LAYOUT_TALL:"Layout: Tall",BTN_LAYOUT_WIDE:"Layout: Wide",BTN_MAX_JUMP_HOLD:"Max Jump: Hold",BTN_MAX_JUMP_TAP:"Max Jump: Tap",BTN_MUSIC_OFF:"Music: Off",BTN_MUSIC_ON:"Music: On",BTN_ORIENTATION:"Orientation",BTN_PRETTY:"Pretty",BTN_QBAR_LEFT:"Quickbar: Left",BTN_QBAR_RIGHT:"Quickbar: Right",BTN_QBAR_TOP:"Quickbar: Top",BTN_RESET_DEFAULTS:"Reset to Defaults",BTN_RESET_INVENTORY:"Reset Inventory",BTN_RESET_TUTORIAL:"Reset Tutorial",BTN_SHADERS_MEH:"Shaders: Meh.",BTN_SHADERS_SHINY:"Shaders: Shiny!",BTN_SHOW_CONTROLS:"Show Controls",BTN_SOUND_OFF:"Sound: Off",BTN_SOUND_ON:"Sound: On",BTN_UIS_INTEGRATED:"Interactable UIs: Integrated",BTN_UIS_SEPARATE:"Interactable UIs: Separate",CONTROLS_BUILD_MENU:"Build menu",CONTROLS_CHAT:"chat",CONTROLS_CYCLE_SIZES:"cycle brush sizes / modes",CONTROLS_DOUBLE_JUMP:"Double-tap jump ({val}) to fly where available",CONTROLS_FLY_DOWN:"fly down",CONTROLS_FORMAT_AGAIN:"{val} again",CONTROLS_FORMAT_DESC:"{val} - {val_2}",CONTROLS_FORMAT_OR:"{val} or {val_2}",CONTROLS_FULLSCREEN:"toggle fullscreen",CONTROLS_INV_MENU:"inventory menu",CONTROLS_JUMP_FLY:"jump / fly up",CONTROLS_MOVE:"move",CONTROLS_OPEN_MENU:"open menu",CONTROLS_PHOTO_MODE:"photo mode",CONTROLS_PICK:"pick item",CONTROLS_PLACE_DESTROY:"place item, destroy blocks; drag to place multiple",CONTROLS_QUICK_SLOT:"Quick-Slot an item",CONTROLS_SCROLL_QBAR:"scroll quickbar",CONTROLS_SECTION_BUILDING:"Building",CONTROLS_SECTION_MOVEMENT:"Movement",CONTROLS_SECTION_OTHER:"Other",CONTROLS_SELECT_QBAR:"select item in quickbar",CONTROLS_SOCIAL_MENU:"social menu",CONTROLS_SPRINT:"sprint",CONTROLS_TOGGLE_GATHERING:"toggle between gathering tools and recent item",CONTROLS_TOGGLE_HUD:"toggle HUD",CONTROLS_TOGGLE_VIEW:"toggle first-/third-person view; scroll while pressed to zoom in/out",CONTROLS_TORCH:"torch",CONTROLS_UNLOCK_MOUSE:"unlock mouse cursor",CONTROLS_WORLD_MENU:"world info menu",DLG_AA_CHANGED_QUIT_MSG:"Changing antialiasing requires restarting the app, quit now?",DLG_AA_CHANGED_RESTART_MSG:"Changing antialiasing requires restarting the app, restart now?",DLG_AA_CHANGED_TITLE:"Antialiasing Changed",DLG_CONTROLS_TITLE:"Controls",DLG_RESET_INV_MSG:"This will reset your inventory to the initial/blank state.  Really continue?",DLG_RESET_INV_TITLE:"Reset Inventory",DLG_RESET_DEFAULTS_MSG:"This will reset all settings and options to their default values.  Some settings may not take effect until you reload the page or restart the app.  Really continue?",DLG_RESET_DEFAULTS_TITLE:"Reset to Defaults",DLG_RESET_DEFAULTS_NOTHING_MSG:"All settings were already at their default values.",DLG_RESET_DEFAULTS_REQUIRED_QUIT_MSG:"Settings have been reset.  Applying the new defaults requires restarting the app, quit now?",DLG_RESET_DEFAULTS_REQUIRED_RESTART_MSG:"Settings have been reset.  Applying the new defaults requires restarting the app, restart now?",DLG_RESET_DEFAULTS_DONE_TITLE:"Settings Reset",LBL_AUDIO:"Audio",LBL_CAMERA_DISTANCE:"Camera Distance",LBL_CONTROLS:"Controls",LBL_DEBUG:"Debug",LBL_GRAPHICS:"Graphics",LBL_INTERFACE:"Interface",LBL_LOOK_SENSITIVITY:"Look Sensitivity",LBL_MOUSE_SENSITIVITY:"Mouse Sensitivity",LBL_PRESET:"Preset",LBL_RENDERER:"Renderer",LBL_RESOLUTION_SCALE:"Resolution Scale",LBL_VIEW_DISTANCE:"View Distance",LBL_VOLUME_MASTER:"Master Volume",LBL_VOLUME_MUSIC:"Music Volume",LBL_VOLUME_SOUND:"Sound Volume",BTN_SETTLEMENT_SET_AS_HOME:"Set as Home",BTN_UNLOCK_LETS_SEE:"Let's see!",BTN_UNLOCK_MORE1:"Also...",BTN_UNLOCK_MORE2:"And?",BTN_UNLOCK_MORE3:"Next...",BTN_UNLOCK_MORE4:"What else?",BTN_UNLOCK_MORE5:"More?",ERR_SETTLEMENT_OUT_OF_RANGE:"Cannot access Settlement Management: out of range",LBL_ADDITIONAL_CONTRIBUTORS:"Additional contributors",LBL_FIRST_UPGRADE:"First Upgrade",LBL_NEXT_TIER:"Next Tier",LBL_OPTIONAL_UPGRADES:"Optional Upgrades",LBL_SETTLEMENT_SIZE:"Settlement Size",LBL_SETTLEMENT_UNLOCK:"Settlement Unlock!",LBL_SIZE:"Size",LBL_TIER_NUMBER:"Tier {val}",LBL_UNLOCKED:"Unlocked",LBL_UNLOCKED_INDUSTRY:"Unlocked industry",LBL_UNLOCKED_TIER:"Unlocked Tier {val}",LBL_UNLOCKS:"Unlocks",LBL_UNLOCKS_INDUSTRY:"Unlocks industry",SETTLEMENT_DRAG_ITEMS:"HINT: Drag items from your inventory below to the requirement slot to unlock upgrades.",SETTLEMENT_FIRST_INCREASE_TIER:"First increase your Settlement Tier to open up more upgrade options.",SETTLEMENT_HOME_UNBOUND:"Setting this Settlement as your Home allows you to 'gate here from anywhere, replenish {val} here, and help expand it.",SETTLEMENT_NO_OPT_UPGRADES:"No optional upgrades available",SETTLEMENT_OTHER:"({val, plural, one{# other} other{# others}})",SETTLEMENT_RADIUS_ADD:"The bounds of your Settlement are expanded by {val} in all directions.",SETTLEMENT_UNLOCKED_AFTER_CREATION:"Unlocked {val} after world creation",SETTLEMENT_UNLOCKED_JUST_NOW:"Unlocked just now by {val}",SETTLEMENT_UNLOCKED_TIME_AGO:"Unlocked {val} ago by {val_2}",SETTLEMENT_VISIT_WG_IN_WORLD:"Visit the Waygate in-world to manage this Settlement",SETTLEMENT_VISIT_WG_IN_WORLD_UNBOUND:"Visit this Settlement in-world to make it your Home",SETTLEMENT_WG_UNLOCK:"The Waygate grows in power and grants your Settlement expanded capacities.",LBL_SHARE_MENU:"Share Menu",STATUSMSG_PHOTO_SAVED:"Photo Saved.",SOCIAL_BLOCKED_NUMBER:"Blocked Users ({val})",SOCIAL_FRIENDS_NUMBER:"Friends ({val})",SOCIAL_REFERRAL_BASIC:"Share the game with your friends!",SOCIAL_REFERRAL_FIRST:"Share the game with your friends! The first time a new friend starts playing by using your shared posts, you get 50 FREE Gems! Redeemable one time only.",DLG_CANNOT_PURCHASE_MSG:"Cannot purchase: not logged in or disconnected",DLG_FIND_MORE_GEMS_MSG:"You can find Gems in featured worlds and previous contest winning worlds.",DLG_NEED_MORE_GEMS_COST_MSG:"Cost",DLG_NEED_MORE_GEMS_CURRENT_AMOUNT_MSG:"Your Gems",DLG_NEED_MORE_GEMS_MSG:'You need more Gems to buy "{description}".',DLG_NEED_MORE_GEMS_TITLE:"Need More Gems",DLG_PROCESSING_PURCHASE_TITLE:"Processing Purchase",DLG_PURCHASE_CONFIRMATION_MSG:'Are you sure you wish to buy "{description}"?',DLG_PURCHASE_CONFIRMATION_TITLE:"Purchase Confirmation",DLG_PURCHASE_FAILED_CUSTOM_MSG:"Purchase failed. Error={error}.",DLG_PURCHASE_SUCCESSFUL_MSG:"Thank you for your purchase!",DLG_PURCHASE_SUCCESSFUL_TITLE:"Purchase Successful",CHATERROR_STUCK_LESS_MINUTE:"Must wait at least a minute before running {val} again",CHATERROR_STUCK_NOT_ADMIN:"Must be an admin or owner to use {val} in {val_2} worlds",CHATERROR_STUCK_TRY_WAYGATE:"Must have tried using a Waygate (in the last 2 minutes) to get unstuck first",LBL_BUILD:"Build",LBL_CRAFT:"Craft",LBL_UNLOCK:"Unlock",STATUSMSG_ADDED_TASK:"Added {val} to To-Do List",STATUSMSG_CANNOT_REMOVE_TUTORIAL_TASK:"Cannot remove tutorial task from To-Do List",STATUSMSG_REMOVED_TASK:"Removed {val} from To-Do List",TODO_ADD_PIN:"Add this to your pinned To-Do List",TODO_READY:"Ready!",TODO_REMOVE_PIN:"Remove this from your pinned To-Do List",BTN_SKIP_ALL:"Skip All",BTN_SKIP_STEP:"Skip Step",DLG_SKIP_TUTORIAL_MSG_ALREADY_KNOW:"Already know what you are doing? Great!",DLG_SKIP_TUTORIAL_MSG_OPTIONS:"Do you want to skip just this step or the entire tutorial?",DLG_SKIP_TUTORIAL_TITLE:"Skip Tutorial",LBL_COMPLETED:"Completed",TLTP_SHOW_TUTORIAL:"Show tutorial",TUTORIAL_AETHERBENCH_BUILD_MENU_MSG_1:"You now have all you need to build your first Aetherbench!",TUTORIAL_AETHERBENCH_BUILD_MENU_MSG_2_GENERIC:"Most things are Built directly in the world from raw resources. Let's open the Menu and get started!",TUTORIAL_AETHERBENCH_BUILD_MENU_MSG_2_KEYBOARD:"Most things are Built directly in the world from raw resources, by using the {build_menu}. Let's open it and get started!",TUTORIAL_AETHERBENCH_BUILD_TAB_MSG:'Use the top tab to select the "Build Menu", where new items can be built.',TUTORIAL_AETHERBENCH_BUILD_TITLE:"Build an Aetherbench!",TUTORIAL_AETHERBENCH_MATERIALS_MSG_1:"To start crafting in this world, you're going to need an Aetherbench!",TUTORIAL_AETHERBENCH_MATERIALS_MSG_2:"First, gather at least {wood, plural, one{# wood} other{# wood}} and {stone, plural, one{# stone} other{# stone}}.",TUTORIAL_AETHERBENCH_MATERIALS_TITLE:"Get Aetherbench Materials!",TUTORIAL_AETHERBENCH_PLACE_PROP_MSG_GENERIC:"Lastly, while holding the Aetherbench, tap wherever you would like to build it in your world!",TUTORIAL_AETHERBENCH_PLACE_PROP_MSG_KEYBOARD:"Lastly, while holding the Aetherbench, click wherever you would like to build it in your world!",TUTORIAL_AETHERBENCH_PLACE_PROP_MSG_NOTE:"Note: Industry like Aetherbenches can only be used if built within Settlements.",TUTORIAL_AETHERBENCH_SELECT_PROP_MSG_GENERIC:"Double tap the Aetherbench icon to select it and close the {build_menu}!",TUTORIAL_AETHERBENCH_SELECT_PROP_MSG_KEYBOARD:"Double click or right click the Aetherbench icon to select it and close the {build_menu}!",TUTORIAL_AETHERBENCH_SELECT_PROP_TITLE:"Select Aetherbench!",TUTORIAL_AETHERBENCH_SETTLEMENT_TAB_MSG:'Use the side tab to select the "Settlement" category, where the Aetherbench schematic is found.',TUTORIAL_COMPLETE_MSG:"Now that you know the basics, craft better tools, keep upgrading your Settlement, and have fun exploring!",TUTORIAL_COMPLETE_MSG_NEXT_STEPS:"To find new crops, explore far and wide. To find new ores, dig deep.",TUTORIAL_COMPLETE_TITLE:"Tutorial Complete",TUTORIAL_CORD_CRAFT_MSG_1:"Great! You now have all you need to craft a single piece of cord!",TUTORIAL_CORD_CRAFT_MSG_2:"Start crafting some cord by selecting your Aetherbench and depositing the resources.",TUTORIAL_CORD_CRAFT_TITLE:"Craft Cord!",TUTORIAL_CORD_MATERIALS_MSG_1:"To craft better tools, and to upgrade your Settlement further, you're going to need some cord!",TUTORIAL_CORD_MATERIALS_MSG_2:"First, gather the required resources. Try picking some flowers to get some Plant Fiber.",TUTORIAL_CORD_MATERIALS_TITLE:"Gather Cord Materials!",TUTORIAL_CORD_PUT_MSG:"Start cord crafting by depositing the resources in the ingredient slots.",TUTORIAL_CORD_TAKE_MSG:"When crafting has completed, take your newly created cord from the Aetherbench.",TUTORIAL_GO_TO_AETHERBENCH_TITLE:"Go to an Aetherbench!",TUTORIAL_GO_TO_SETTLEMENT_TITLE:"Return to Settlement!",TUTORIAL_HINT_TITLE:"Tutorial Hint",TUTORIAL_INVITE_FRIENDS_MSG:"Invite your friends to play live in this world!",TUTORIAL_INVITE_FRIENDS_TITLE:"Play with Friends!",TUTORIAL_LOST_FRONTIER_MSG:"You've been sent through an ancient Waygate and arrived in a new world, but the Waygate requires resources to be restored.",TUTORIAL_LOST_FRONTIER_MSG_NO_ACCESS:"You do not have access to this Settlement, you will need to find another Settlement or build your own to get started.",TUTORIAL_LOST_FRONTIER_MSG_NO_SETTLEMENT:"You are not currently near a Settlement, you will need to find one or build your own to get started.",TUTORIAL_LOST_FRONTIER_MSG_SELECT:"Select the Waygate where you started to check out your Settlement and scope out what is needed.",TUTORIAL_LOST_FRONTIER_MSG_SET_HOME:'This Settlement welcomes new builders, find the Waygate near the center and select "{button}" to get started.',TUTORIAL_LOST_FRONTIER_TITLE:"Welcome to the Lost Frontier!",TUTORIAL_OPEN_BUILD_MENU_TITLE:"Open Build Menu!",TUTORIAL_OPEN_MENU_TITLE:"Open Menu!",TUTORIAL_OPEN_SETTLEMENT_TAB_TITLE:"Open Settlement Tab!",TUTORIAL_PICKAX_CRAFT_MSG:"Now, start crafting a Pickax by clicking on your Aetherbench, choosing the Pickax recipe, and then depositing the resources.",TUTORIAL_PICKAX_CRAFT_MSG_HINT:"Hint: Equipped tools like Pickaxes and Shovels are used automatically when gathering the related resource.",TUTORIAL_PICKAX_CRAFT_TITLE:"Craft Pickax!",TUTORIAL_PICKAX_MATERIALS_MSG_1:"You now have all of the industry required to create better tools! Let's make a new Pickax first.",TUTORIAL_PICKAX_MATERIALS_MSG_2:"First, craft the required components.",TUTORIAL_PICKAX_MATERIALS_MSG_HINT:'Hint: When viewing recipes, you can use the "pin" button to add anything to the To-Do list below.',TUTORIAL_PICKAX_MATERIALS_TITLE:"Gather Pickax Materials!",TUTORIAL_PUT_RESOURCES_TITLE:"Put Resources!",TUTORIAL_SHARE_URL_MSG:"Having fun building? Share your world with friends simply by sending them the URL!",TUTORIAL_STONECUTTERY_BUILD_MSG:"Now that you have everything you need, open up the {build_menu} and build your first Stonecuttery! You can find it under the Settlement tab next to the Aetherbench.",TUTORIAL_STONECUTTERY_BUILD_TITLE:"Build a Stonecuttery!",TUTORIAL_STONECUTTERY_MATERIALS_MSG_1:"Shaping stone into useful items requires a Stonecuttery.",TUTORIAL_STONECUTTERY_MATERIALS_MSG_2:"First, craft at least {cord, plural, one{# more Cord} other{# more Cord}} and gather at least {stone, plural, one{# stone} other{# stone}}.",TUTORIAL_STONECUTTERY_MATERIALS_TITLE:"Get Stonecuttery Materials!",TUTORIAL_STONECUTTERY_PLACE_PROP_MSG_GENERIC:"Lastly, while holding the Stonecuttery, tap wherever you would like to build it in your world!",TUTORIAL_STONECUTTERY_PLACE_PROP_MSG_KEYBOARD:"Lastly, while holding the Stonecuttery, click wherever you would like to build it in your world!",TUTORIAL_STONECUTTERY_PLACE_PROP_MSG_NOTE:"Note: Industry like Stonecutteries can only be used if built within Settlements.",TUTORIAL_STONETOOLHEAD_CRAFT_MSG:"Start crafting a tool head by clicking on your Stonecuttery and depositing the resources.",TUTORIAL_STONETOOLHEAD_CRAFT_MSG_NOTE:"Note: Crafting continues even while unattended! You can use this time to check on your Settlement or gather more resources.",TUTORIAL_STONETOOLHEAD_CRAFT_TITLE:"Craft Stone Tool Head!",TUTORIAL_STONETOOLHEAD_MATERIALS_MSG_1:"To craft better tools, and to upgrade your Settlement further, you're going to need some Stone Tool Heads!",TUTORIAL_STONETOOLHEAD_MATERIALS_MSG_2:"First, gather the required resources.",TUTORIAL_STONETOOLHEAD_MATERIALS_TITLE:"Gather Tool Head Materials!",TUTORIAL_UPGRADE_SETTLEMENT_FIRST_PUT_MSG_GENERIC:"Drag or double tap the required items in your inventory below to deposit them, unlocking your first Upgrade",TUTORIAL_UPGRADE_SETTLEMENT_FIRST_PUT_MSG_KEYBOARD:"Drag or double click the required items in your inventory below to deposit them, unlocking your first Upgrade",TUTORIAL_UPGRADE_SETTLEMENT_MATERIALS_MSG:"To upgrade your Settlement, gather the required resources.",TUTORIAL_UPGRADE_SETTLEMENT_MATERIALS_TITLE:"Gather Raw Resources!",TUTORIAL_UPGRADE_SETTLEMENT_MSG:"Great! Now, return to your Waygate and upgrade your Settlement by depositing these resources.",TUTORIAL_UPGRADE_SETTLEMENT_MSG_HINT:"If you cannot find your home, try getting up someplace high to look around, or use the fast travel option in the World Info tab in the menu. Be aware that if you travel via Waygate twice in an hour you will suffer from Waygate Sickness.",TUTORIAL_UPGRADE_SETTLEMENT_SECOND_MSG:"Great! Now, return with your newly crafted Tool Head and upgrade your Settlement by depositing the required resources.",TUTORIAL_UPGRADE_SETTLEMENT_TITLE:"Upgrade your Settlement!",TUTORIAL_WOODCUTTERY_BUILD_MSG:"Now that you have everything you need, open up the {build_menu} and build a brand new Woodcuttery! You can find it under the Settlement tab alongside the other Industry props.",TUTORIAL_WOODCUTTERY_BUILD_TITLE:"Build an Woodcuttery!",TUTORIAL_WOODCUTTERY_MATERIALS_MSG_1:"The last thing you'll need to craft better tools is a wood rod for a haft. Wood Rods are made by a Woodcuttery.",TUTORIAL_WOODCUTTERY_MATERIALS_MSG_2:"First, craft at least {heads, plural, one{# more Tool Head} other{# more Tool Heads}} and gather at least {wood, plural, one{# wood} other{# wood}}.",TUTORIAL_WOODCUTTERY_MATERIALS_TITLE:"Get Woodcuttery Materials!",TUTORIAL_WOODCUTTERY_PLACE_PROP_MSG_GENERIC:"Lastly, while holding the Woodcuttery, tap wherever you would like to build it in your world!",TUTORIAL_WOODCUTTERY_PLACE_PROP_MSG_KEYBOARD:"Lastly, while holding the Woodcuttery, click wherever you would like to build it in your world!",TUTORIAL_WOODCUTTERY_PLACE_PROP_MSG_NOTE:"Note: Industry like Woodcutteries can only be used if built within Settlements.",STATUSMSG_UNKNOWN_USERATTRIB:'Removed unknown {val} "{val_2}"',BTN_ADD_FRIEND:"Add to friends list",BTN_BLOCK_USER:"Block user",BTN_KICK_FROM_WORLD:"Kick",BTN_REMOVE_FRIEND:"Remove from friends list",BTN_UNBLOCK_USER:"Unblock user",FRIENDLIST_FB_FRIEND:"This user is your Facebook friend",FRIENDLIST_USER_IS_ADDED:"This user is on your friends list",LBL_ADMIN_ACTIONS:"Admin Actions",LBL_AREA_ADMIN_ACTIONS:"Area Admin Actions",LBL_CHANGE_ACCESS:"Change Access",LBL_CURRENT_ACCESS:"Current Access",LBL_DEFAULT:"Default",PRESENCE_ALSO_IDLE:"{val} (Idle)",PRESENCE_BUILDING:"Building",PRESENCE_IN_MENUS:"In menus",PRESENCE_LOST_FRONTIER:"Lost Frontier",PRESENCE_OFFLINE:"Offline",PRESENCE_UNKNOWN:"Unknown",PRESENCE_VIEWING:"Viewing",USERINFO_LOADING:"Loading data...",USERINFO_MY_FRIEND_FB:'My friend "{val}" on Facebook',USERINFO_NOT_ALLOWED_TO_CHANGE_ACCESS:"You are not allowed to change Area access for this user",USERINFO_THIS_ME:"This is me!",USERINFO_USER_BLOCKED:"This user is blocked and will not see your status",USERINFO_WORLDSTEAM:"This is an official account of a Worlds FRVR Team member!",STATUSMSG_ORPHANED_TILEPROP:"Encountered orphaned {val}, cleaning up...",STATUSMSG_PROP_WOUT_TILEPROP:"Encountered prop without {val}, cleaning up...",BTN_ADD_NEW_TARGET:"Add new target",BTN_ASSIGN_WGID:"Assign Waygate ID",BTN_CHANGE:"Change",BTN_DESTROY_SETTLEMENT:"Destroy Settlement",BTN_EXITWAY_PUBLIC:"Exitway Usable By: Everyone",BTN_EXITWAY_BUILDERS:"Exitway Usable By: Builders",BTN_ESTABLISH_SETTLEMENT:"Establish new Settlement",BTN_MOVE_SETTLEMENT:"Move my Settlement here",BTN_NOT_AVAILABLE:"Not available",BTN_REMOVE_WGID:"Remove Waygate ID",BTN_SET:"Set",BTN_SET_DEFAULT_SETTLE_WG:"Set as Default Settlement / Waygate",BTN_SET_DEFAULT_WG:"Set as Default Waygate",DLG_ASSIGN_WGID_ALREADY_MSG_CONFIRM:'The Waygate ID "{val}" is already in use by another Waygate, do you really wish to reassign this Waygate ID to THIS Waygate?',DLG_ASSIGN_WGID_ALREADY_MSG_LINKS:"Note: Any links to the specified Waygate ID would now go to this Waygate.",DLG_ASSIGN_WGID_DEF_MSG_CONFIRM:"Changing the Default Waygate will cause all new visitors to arrive at this Waygate (unless they follow a link to another, specific, Waygate). Do you really wish to change the Default Waygate?",DLG_ASSIGN_WGID_DEF_MSG_SCREENSHOT:"Note: Setting this Waygate as the Default Waygate will allow you to configure a default screenshot for all links to this World.",DLG_ASSIGN_WGID_TITLE:"Assign Waygate ID",DLG_DESTROY_SETTLEMENT_MSG_CONFIRM:"This cannot be undone. Are you sure you wish to destroy this Settlement?",DLG_DESTROY_SETTLEMENT_MSG_WARNING:"Destroying a Settlement will lose all unlocks and upgrades. Players who have this Settlement as their Home, including yourself, will have the default Settlement as Home instead.",DLG_DESTROY_SETTLEMENT_TITLE:"Destroy Settlement?",DLG_ERROR_ASSIGNING_WG_TITLE:"Error assigning Waygate ID",DLG_ERROR_DESTROYING_SETTLEMENT_TITLE:"Error destroying Settlement",DLG_ERROR_EDITING_WG_TITLE:"Error editing Waygate",DLG_ERROR_ESTABLISHING_SETTLEMENT:"Error establishing Settlement",DLG_ERROR_MOVING_SETTLEMENT:"Error moving Settlement",DLG_ERROR_REMOVING_WGID_TITLE:"Error removing Waygate ID",DLG_ERROR_RENAMING_WG_TITLE:"Error renaming Waygate",DLG_ERROR_SETTING_WG_IMG_TITLE:"Error setting Waygate image",DLG_ESTABLISH_SETTLEMENT_MSG_CONFIRM:"Are you sure you wish to continue?",DLG_ESTABLISH_SETTLEMENT_MSG_HOME:"After establishing a new Settlement, this will be your Home, and you will be unable to 'gate to your previous Settlement without visiting it in-world first.",DLG_ESTABLISH_SETTLEMENT_TITLE:"Establish a new Settlement?",DLG_INVALID_WORLD_ID_TITLE:"Invalid World ID",DLG_LINKABLE_WGID_MSG:"Enter an identifier for this Waygate.  Waygate IDs may be up to 16 characters long and may contain only lowercase letters (a-z), numbers (0-9), and underscores (_).  They must be unique within this World.",DLG_LINKABLE_WGID_TITLE:"Assign Linkable Waygate ID",DLG_MOVE_SETTLEMENT_MSG_CONFIRM:"Are you sure you wish to continue? If playing with other players, please consult the rest of your team before moving a Settlement.",DLG_MOVE_SETTLEMENT_MSG_WARNING:"Moving a Settlement may leave some crafting stations outside of any Settlement and therefore non-functional. Settlements can only be moved once per day.",DLG_MOVE_SETTLEMENT_TITLE:"Move existing Settlement?",DLG_REMOVE_WGID_MSG:"Removing the Waygate ID will cause any links to this Waygate to target the Default Waygate for this World instead. If you reassign this Waygate ID to a different Waygate, then those links will target the new Waygate. Are you sure you wish to remove this Waygate ID?",DLG_REMOVE_WGID_TITLE:"Remove Waygate ID",DLG_WAYGATE_TARGET_MSG:"Enter a World ID or click Current to select the active world",DLG_WAYGATE_TARGET_TITLE:"Waygate Target",DLG_WG_NAME_MSG:"Enter a name for this Waygate",DLG_WG_NAME_TITLE:"Waygate Name",ERR_INVALID_WGID:"Invalid Waygate ID",ERR_WAYGATE_DISAPPEARED:"Waygate disappeared, cannot apply change",LBL_DEFAULT_WAYGATE:"Default Waygate",LBL_ENERGY_WELL_STATUS:"Energy Well Status",LBL_ENTRYWAY:"Entryway",LBL_ENTRYWAY_SETTLEMENT:"Settlement / Entryway",LBL_EXITWAY_TARGETS:"Exitway Targets",LBL_LISTED:"Listed",LBL_MINE:"Mine",LBL_NAMED_SETTLEMENT:"Settlement: {val}",LBL_OTHER:"Other",LBL_RECENT:"Recent",LBL_SCREENSHOT:"Screenshot",LBL_SETTLEMENT_MNG:"Settlement Management",LBL_SHOW_WORLD_INFO:"Show World Info",LBL_THIS_WORLD:"This World",LBL_UNKNOWN_MENU:"Unknown menu",LBL_WAYGATE_ID:"Waygate ID",LBL_WAYGATE_TARGETS:"Waygate Targets",LBL_WG_AND_SETTLEMENT_MNG:"Waygate and Settlement Management",LBL_WG_CONFIGURATION:"Waygate Configuration",STATUSMSG_DRINKING_WELL:"Drinking from Energy Well ({val}s)...",STATUSMSG_EXITING:"Exiting to Main Menu ({val_2}s)...",STATUSMSG_EXITWAY_INACCESSIBLE:"This Exitway is inaccessible to you",STATUSMSG_WAYGATING_CHOICES:"Waygating (with choices) ({val}s)...",STATUSMSG_WAYGATING_TO:"Waygating to {val} ({val_2}s)...",STATUSMSG_WELL_RECHARGING:"Energy Well still recharging ({val}s)",STATUSMSG_WG_IMG_SAVED:"Waygate Image Saved.",WGLINK_FROZEN:"Frozen",WGLINK_FULL:"Full",WGLINK_LOADING:"Loading...",WGLINK_NOT_FOUND:"Waygate not found",WGTARGET_EXITWAY_LOADING:"(loading...)",WGTARGET_INVALID_WORLD_ID:"Invalid World ID: {val}",WGUI_DEFAULT_WG_CANNOT_EXITWAY:"The default Waygate cannot function as an Exitway.",WGUI_ENERGY_WELL_REMOTE_SUBTITLE:"Visit to replenish {val}",WGUI_ENERGY_WELL_SUBTITLE:"Replenish {val} here",WGUI_ENTRYWAY_REQUIREMENT:"This Waygate requires an ID in order to be an Entryway",WGUI_LF_WG_EXITWAY_FUTURE:"Lost Frontier Waygate Exitways will be in a future update...",WGUI_LISTED_WG_LINKED:"Listed Waygates can be linked to by anyone, by URL or another Waygate, and are shown on the World Info screen.",WGUI_MUST_VISIT_EDIT_EXITWAY:"You must visit the Waygate in-world to edit Exitway Targets",WGUI_NEW_WAYGATE:"New Waygate",WGUI_REMOVE_WG_TARGET:"Remove Waygate Target",WGUI_SETTLEMENT_MNG_SUBTITLE:"Deposit resources in the Waygate to expand and enhance",WGUI_SETTLEMENT_OVERLAP:"Too close to other Settlements to establish a new Settlement.",WGUI_SETTLEMENT_OVERLAP_NO_MOVE:"Too close to other Settlements to establish or move a Settlement.",WGUI_SETTLE_CANNOT_EXITWAY:"A Settlement Waygate cannot function as an Exitway.",WGUI_THIS_IS_DEFAULT_WG:"This is the Default Waygate. To remove it, first set a different Waygate as Default.",WGUI_UNKNOWN_WAYGATE:"Unknown Waygate {val}",WGUI_UNLIMITED_HINT_1:"Hint: People entering your world will face the same",WGUI_UNLIMITED_HINT_2:"direction you are facing when you place the Waygate!",WGUI_WG_ADVENTURE_HINT_1:"Hint: You can build a new Waygate and move your",WGUI_WG_ADVENTURE_HINT_2:"Settlement's power there up to once a day!",WGUI_WG_IN_WORLD:"{val} in {val_2}",WGUI_WG_IS_SETTLEMENT:"This Waygate defines a Settlement and the Settlement's benefits.",CHATERROR_ACCESSING_WAYGATE:"Error accessing Waygate {val}: {val_2}",CHATERROR_ACCESS_REVOKED:"Access revoked",CHATERROR_GROUP_RACE_START:"Group Race Start Error",CHATERROR_RUNNING_COMMAND:"Error running /{val}: {val_2}",CHATUI_ADMIN_MSG:"[admin] {val}",DLG_JOINING_WORLD_FAILED_TITLE:"Joining World Failed",DLG_RACE_SAVE_ERROR_TITLE:"Race Save Error",DLG_RUN_ELEVATE_MSG:"(Admin) Run /elevate to bypass permissions.",DLG_WORLD_ACCESS_DENIED_MSG:"Access denied.  This world is not public and requires an access token, or for the owner to add your User ID ({val}).",DLG_WORLD_FULL_MSG:"World full.  This world is currently full, please try again later.",STATUSMSG_CANT_JOIN_NOT_CONNECTED:"Unable to join world: not connected to server",STATUSMSG_GEM_FOUND:"You found 1{val} gem!",STATUSMSG_GROUP_RACE_CANCELLED:"The current Group Race was canceled!",STATUSMSG_GROUP_RACE_START:"A Group Race just started!",STATUSMSG_GROUP_RACE_START_SECONDS:"A Group Race will start in {val} seconds!",STATUSMSG_GROUP_RACE_WON_BY_OTHER:"{val} won the Group Race with a time of {val_2}!",STATUSMSG_GROUP_RACE_WON_BY_YOU:"You won the Group Race! Congratulations!",STATUSMSG_ORPHANED_PROP:"Encountered orphaned prop without TILE_PROP, cleaning up...",STATUSMSG_OUT_OF_SYNC:"World out of sync, resyncing...",STATUSMSG_RACE_ABANDON_ERROR:"Race Abandon Error: {val}",STATUSMSG_RACE_NO_MULTIPLE_CLIENTS:"Races cannot be started in worlds that allow multiple clients.",STATUSMSG_RACE_SINGLE_CLIENT_ENABLE:'Run "/world_single_client 1" to enable single client per user in this world.',STATUSMSG_RACE_START_ERROR:"Race Start Error: {val}",STATUSMSG_TRANSACTION_FAILED:"Transaction failed: {val}",BTN_DELETE_WORLD:"Delete",BTN_DONE_EDITING:"Done",BTN_EDIT_WG_INFORMATION:"Edit Waygate Information",BTN_EDIT_WORLD_SETTINGS:"Edit World Settings",BTN_EXIT_WORLD:"← Exit World",BTN_FORGET_WORLD:"Forget",BTN_IM_STUCK:"I'm stuck!",BTN_JOIN_WORLD:"Join",BTN_PLAYING_AS_SELF:"Playing as: Self",BTN_PLAYING_AS_VISITOR:"Playing as: Visitor",BTN_SETTLEMENT_INFO:"Settlement Info",BTN_WAYGATE_GO:"Go",DLG_CHAT_SLOW_MODE_COOLDOWN_MSG:"Enter a new value, in seconds. (min {min}, max {max})",DLG_DELETE_WORLD_MSG:"Are you sure you wish to delete {val} ({val_2})?",DLG_DELETE_WORLD_TITLE:"Delete World",DLG_ERR_LOST_CONNECTION_MSG:"Unable to process request: lost connection to world",DLG_ERR_LOST_CONNECTION_TITLE:"Lost connection",DLG_ERR_MODIFYING_WORLD_TITLE:"Error modifying world",DLG_FORGET_WORLD_MSG:"Are you sure you wish to remove {val} ({val_2}) from your recent list?",DLG_FORGET_WORLD_TITLE:"Forget World",DLG_WG_TRAVEL_NOT_ALLOWED_MSG:"You are currently waiting for a Group Race to begin. Traveling via Waygate will cancel your current Race. Are you sure you wish to continue?",DLG_WG_TRAVEL_NOT_ALLOWED_TITLE:"Waygate Travel Not Allowed",DLG_WG_TRAVEL_UNSAFE_MSG:"You have not yet recovered from your previous Waygate use. Traveling via Waygate again so soon will result in suffering temporary Waygate Sickness (reduced {val}).  Are you sure you wish to continue?",DLG_WG_TRAVEL_UNSAFE_TITLE:"Waygate Travel Currently Unsafe",DLG_WORLD_NAME_MSG:"Enter a new name for your world",FORMAT_NUMBER_MILLION:"{val}M",FORMAT_NUMBER_OF_BUILDERS:"{builders, plural, one{# Builder} other{# Builders}}",FORMAT_NUMBER_OF_VIEWERS:"{viewers, plural, one{# Viewer} other{# Viewers}}",FORMAT_NUMBER_THOUSAND:"{val}K",FORMAT_READY_WG_TIME:"({val})",FORMAT_ROLE_DISPLAY:"[{val}]",LBL_ACCESS_ADMIN:"Admin",LBL_ACCESS_ADMINS:"Admins",LBL_ACCESS_ADMIN_LONG:"Admin (can grant access, etc)",LBL_ACCESS_AREABUILDER:"Area Builder",LBL_ACCESS_AREABUILDERS:"Area Builders",LBL_ACCESS_AREABUILDER_LONG:"Area Builder (designated Areas only)",LBL_ACCESS_BUILDER:"Builder",LBL_ACCESS_BUILDERS:"Builders",LBL_ACCESS_BUILDER_LONG:"Builder (can build)",LBL_ACCESS_DEFAULT:"Default",LBL_ACCESS_NONE:"None",LBL_ACCESS_NONE_BAN:"None (ban)",LBL_ACCESS_NONE_LONG:"No access",LBL_ACCESS_NONE_NOBODY:"Nobody",LBL_ACCESS_OWNER:"Owner",LBL_ACCESS_OWNER_CREATOR:"Creator",LBL_ACCESS_PRESET:"Access Preset",LBL_ACCESS_PRESET_AREA_BUILD:"Anyone can Area build",LBL_ACCESS_PRESET_BUILD_ANYWHERE:"Anyone can build anywhere",LBL_ACCESS_PRESET_PRIVATE:"Private",LBL_ACCESS_PRESET_PRIVATE_LONG:"This world is private",LBL_ACCESS_PRESET_SPECTATE:"Anyone can spectate",LBL_ACCESS_PRESET_VISIT:"Anyone can visit",LBL_ACCESS_READONLY:"Visitor",LBL_ACCESS_READONLY_LONG:"Visitor (has avatar)",LBL_ACCESS_READONLY_VIEWERS:"Viewers",LBL_ACCESS_SPECTATOR:"Spectator",LBL_ACCESS_SPECTATOR_ANYONE:"Anyone",LBL_ACCESS_SPECTATOR_LONG:"Spectator (can view, but invisible)",LBL_CHAT:"Chat",LBL_CHAT_SLOW_MODE_COOLDOWN:"Chat slow mode cooldown",LBL_FLYING:"Flying",LBL_MORE_ACCESS_OPTIONS:"More access options",LBL_OFFLINE_USERS:"Offline",LBL_PLACE_BLUEPRINTS:"Place Blueprints",LBL_SHOW_OTHER_PLAYERS:"Show other players",LBL_TIME_AFTERNOON:"Afternoon",LBL_TIME_DAWN:"Dawn",LBL_TIME_DUSK:"Dusk",LBL_TIME_DYNAMIC:"Dynamic",LBL_TIME_MIDNIGHT:"Midnight",LBL_TIME_MORNING:"Morning",LBL_TIME_NOON:"Noon",LBL_TIME_OF_DAY:"Time of Day",LBL_USER_DISTANCE_FAR:"Far",LBL_USER_DISTANCE_MEDIUM:"Medium",LBL_USER_DISTANCE_NEAR:"Near",LBL_USER_DISTANCE_UNLIMITED:"Unlimited",LBL_WAYGATES:"Waygates",LBL_WHO_IS_HERE:"Who's Here ({val})",LBL_WORLD_SETTINGS:"World Settings",STATUSMSG_PLAYING_AS_VISITOR:"Now playing as a read-only Visitor",TLTP_DEFAULT_WAYGATE:"This is the Default Waygate",TLTP_WAYGATE_DISABLED_LF:"You cannot go directly to arbitrary Waygates in Lost Frontier worlds, use the Join button above to return to your last position.",TLTP_DONE_EDITING:"Done editing",TLTP_HOME_SETTLEMENT:"This is your Home Settlement",TLTP_RENAME_WORLD:"Rename World",WORLDINFO_ANYONE_BUILD_WARNING:"Warning: Anyone on the internet can join and build in your world at any time. Do not use this option if you care about what you are building.",WORLDINFO_ASSIGNED_ROLES:"{val} of {val_2} builder/admin roles assigned",WORLDINFO_FRIENDS:"{val, plural, one{# friend} other{# friends}}: {names}",WORLDINFO_HIDDEN_GEMS:"{gems, plural, one{#{symbol} hidden gem} other{#{symbol} hidden gems}}",WORLDINFO_LIKES:"{val, plural, one{{short_val} Like} other{{short_val} Likes}}",WORLDINFO_LOADING:"World info loading...",WORLDINFO_LOADING_ERROR:"Error loading world info: {val}",WORLDINFO_NO_WG_FOUND:"No Waygates found",WORLDINFO_SAFE_WG_TRAVEL:"Safe Waygate travel ready!",WORLDINFO_THIS_IS_MY_WORLD:"This is my world",WORLDINFO_UNLISTED:"(unlisted)",WORLDINFO_VIEWS:"{val, plural, one{{short_val} View} other{{short_val} Views}}",WORLDINFO_VISITORS:"{val, plural, one{{short_val} Visitor} other{{short_val} Visitors}}",WORLDINFO_WG_TRAVEL_UNSAFE:"Waygate travel currently unsafe",WORLDINFO_YOU_ARE_ADMIN:"You are an admin",FORMAT_ITEM_1_ADJ:"{val_2} {val}",FORMAT_ITEM_2_ADJ:"{val_2} {val_3} {val}",FORMAT_ITEM_ANY_ADJ:"Any {val}",ITEM_ADJ_EMPTY:"Empty",ITEM_ADJ_FULL:"Full",ITEM_ADJ_ROAST:"Roast",ITEM_DESC_CONSUMABLE_FOR:"Consumable for",ITEM_DESC_EDITABLE_BP:"Editable blueprint: place in the world to edit",ITEM_DESC_MADE_FROM_GATHERS_BOTH:"A pickax made from this can gather metal up to {val} and stone up to {val_2}.",ITEM_DESC_MADE_FROM_GATHERS_METAL:"A pickax made from this can gather metal up to {val}.",ITEM_DESC_MADE_FROM_GATHERS_STONE:"A pickax made from this can gather stone up to {val}.",ITEM_DESC_MATERIAL_GATHERING:"{val} {val_2}-gathering",ITEM_DESC_MUTTAL:"A useless, brittle alloy.  A mutt of a metal.",ITEM_DESC_STONE_METAL_GATHERING:"{val} Stone/Metal-gathering (up to {val_2} Stone/{val_3})",ITEM_DESC_UP_TO:"up to {val}",ITEM_DESC_UP_TO_STONE:"up to {val} Stone",ITEM_DESC_WEAK_METAL:"A weak, soft metal, mostly used for alloys or decorative purposes.",ITEM_INFO_ORE_DEPTH:"{val} can be found in {val_2} stone at a depth of {val_3} blocks or deeper.",ITEM_NAME_CRUDE_TOOL:"Crude Stone Tool",ITEM_NAME_UNKNOWN_BLOCK:"Unknown block ({val})",ITEM_NAME_UNKNOWN_ITEM:"Unknown item ({val})",LBL_BROKEN:"broken",LBL_CONTENTS:"Contents",LBL_DOWSER_RANGE:"Range",LBL_DURABILITY:"Durability",LBL_HAFT:"haft",LBL_STAMINA_USAGE:"{val} Usage",LBL_STAMINA_USAGE_BASE:"Base {val} Usage",STATUSMSG_DELICIOUS:"Delicious!",TILES_GRASS_NAME:"Dirt (Grass)",TILES_GRASS_NAME_BLOCK:"Grass Block",TILES_DIRT_NAME:"Dirt",TILES_DIRT_NAME_BLOCK:"Dirt Block",TILES_DIRT_INFO:"Can be gathered from Grass Blocks or Dirt Blocks with a shovel or the crude tools you start with.",TILES_STONE_NAME:"Stone",TILES_STONE_NAME_BLOCK:"Stone Block",TILES_STONE_INFO:"Can be gathered from Stone Blocks with a pickax or the crude tools you start with.  Stone Blocks can be found underground or on the surface.",TILES_ORE_IN_STONE_LIGHT_NAME:"Metal Ore in Light Stone",TILES_ORE_IN_STONE_LIGHT_NAME_BLOCK:"Metal Ore in Light Stone",TILES_ORE_IN_STONE_NAME:"Metal Ore in Stone",TILES_ORE_IN_STONE_NAME_BLOCK:"Metal Ore in Stone",TILES_ORE_IN_STONE_DARK_NAME:"Metal Ore in Dark Stone",TILES_ORE_IN_STONE_DARK_NAME_BLOCK:"Metal Ore in Dark Stone",TILES_ORE_IN_STONE_RED_NAME:"Metal Ore in Red Stone",TILES_ORE_IN_STONE_RED_NAME_BLOCK:"Metal Ore in Red Stone",TILES_ORE_IN_VEINIUM_NAME:"Metal Ore in Veinium",TILES_ORE_IN_VEINIUM_NAME_BLOCK:"Metal Ore in Veinium",TILES_VEINIUM_NAME:"Veinium",TILES_VEINIUM_NAME_BLOCK:"Veinium Block",TILES_VEINIUM_INFO:"Contains trace metals indicating ore may be nearby.",TILES_COAL_NAME:"Coal",TILES_COAL_NAME_BLOCK:"Coal Block",TILES_CORAL_NAME:"Coral",TILES_CORAL_NAME_BLOCK:"Coral Block",TILES_WOOD_NAME:"Wood",TILES_WOOD_NAME_BLOCK:"Wood Block",TILES_WOOD_INFO:"Can be gathered from Wood Blocks with a hatchet or the crude tools you start with.  Forests can be found by looking for darker patches in the distance.",TILES_PLANKS_WOOD_NAME:"Wood Planks",TILES_PLANKS_WOOD_NAME_BLOCK:"Wood Planks Block",TILES_PLANKS_WOOD_INFO:"Useful for building many things, such as Chests, found under the Props section of the build menu.",TILES_WOOD_LIGHT_NAME:"Light Wood",TILES_WOOD_LIGHT_NAME_BLOCK:"Light Wood Block",TILES_WOOD_LIGHT_INFO:"Can be gathered from Light Wood Blocks with a hatchet or the crude tools you start with.  Forests can be found by looking for darker patches in the distance.  Light Wood is easy to handle.",TILES_PLANKS_WOOD_LIGHT_NAME:"Light Wood Planks",TILES_PLANKS_WOOD_LIGHT_NAME_BLOCK:"Light Wood Planks Block",TILES_PLANKS_WOOD_LIGHT_INFO:"Useful for building many things, such as Chests, found under the Props section of the build menu.",TILES_WOOD_DARK_NAME:"Dark Wood",TILES_WOOD_DARK_NAME_BLOCK:"Dark Wood Block",TILES_WOOD_DARK_INFO:"Can be gathered from Dark Wood Blocks with a hatchet or the crude tools you start with.  Forests can be found by looking for darker patches in the distance.  Dark Wood is heavy and durable.",TILES_PLANKS_WOOD_DARK_NAME:"Dark Wood Planks",TILES_PLANKS_WOOD_DARK_NAME_BLOCK:"Dark Wood Planks Block",TILES_PLANKS_WOOD_DARK_INFO:"Useful for building many things, such as Chests, found under the Props section of the build menu.",TILES_WOOD_RED_NAME:"Red Wood",TILES_WOOD_RED_NAME_BLOCK:"Red Wood Block",TILES_WOOD_RED_INFO:"Can be gathered from Red Wood Blocks with a hatchet or the crude tools you start with.  Forests can be found by looking for darker patches in the distance.  Red Wood is pretty durable.",TILES_PLANKS_WOOD_RED_NAME:"Red Wood Planks",TILES_PLANKS_WOOD_RED_NAME_BLOCK:"Red Wood Planks Block",TILES_PLANKS_WOOD_RED_INFO:"Useful for building many things, such as Chests, found under the Props section of the build menu.",TILES_LEAVES1_NAME:"Leaves",TILES_LEAVES1_NAME_BLOCK:"Leaf Block #1",TILES_LEAVES2_NAME:"Leaves",TILES_LEAVES2_NAME_BLOCK:"Leaf Block #2",TILES_LEAVES3_NAME:"Leaves",TILES_LEAVES3_NAME_BLOCK:"Leaf Block #3",TILES_LEAVES4_NAME:"Leaves",TILES_LEAVES4_NAME_BLOCK:"Leaf Block #4",TILES_LEAVES5_NAME:"Leaves",TILES_LEAVES5_NAME_BLOCK:"Leaf Block #5",TILES_PASSABLE_LEAVES_NAME:"Leaves",TILES_PASSABLE_LEAVES_NAME_BLOCK:"Passable Leaf Block",TILES_TILLED_NAME:"Dirt",TILES_TILLED_NAME_BLOCK:"Tilled Dirt Block",TILES_TILLED_WATERED_NAME:"Dirt",TILES_TILLED_WATERED_NAME_BLOCK:"Watered Tilled Dirt Block",TILES_SNOW_NAME:"Snow",TILES_SNOW_NAME_BLOCK:"Snow Block",TILES_SAND_NAME:"Sand",TILES_SAND_NAME_BLOCK:"Sand Block",TILES_STONE_DARK_NAME:"Dark Stone",TILES_STONE_DARK_NAME_BLOCK:"Dark Stone Block",TILES_STONE_DARK_INFO:"Can be gathered from Dark Stone Blocks with a pickax or the crude tools you start with.  Dark Stone Blocks can be found underground or on the surface.",TILES_STONE_LIGHT_NAME:"Light Stone",TILES_STONE_LIGHT_NAME_BLOCK:"Light Stone Block",TILES_STONE_LIGHT_INFO:"Can be gathered from Light Stone Blocks with a pickax or the crude tools you start with.  Light Stone Blocks can be found underground or on the surface.",TILES_STONE_RED_NAME:"Red Stone",TILES_STONE_RED_NAME_BLOCK:"Red Stone Block",TILES_STONE_RED_INFO:"Can be gathered from Red Stone Blocks with a pickax or the crude tools you start with.  Red Stone Blocks can be found underground or on the surface.  Just like red stone on Earth, it has no conductive properties whatsoever.",TILES_GLASS_NAME:"Glass",TILES_GLASS_NAME_BLOCK:"Glass Block",TILES_BRICK_CLAY_NAME:"Clay Bricks",TILES_BRICK_CLAY_NAME_BLOCK:"Clay Bricks Block",TILES_BRICK_STONE_NAME:"Stone Bricks",TILES_BRICK_STONE_NAME_BLOCK:"Stone Bricks Block",TILES_COLORED_HUE0_NAME:"Red Painted Wood",TILES_COLORED_HUE0_NAME_BLOCK:"Red Painted Wood Block",TILES_COLORED_HUE1_NAME:"Orange Painted Wood",TILES_COLORED_HUE1_NAME_BLOCK:"Orange Painted Wood Block",TILES_COLORED_HUE2_NAME:"Yellow Painted Wood",TILES_COLORED_HUE2_NAME_BLOCK:"Yellow Painted Wood Block",TILES_COLORED_HUE3_NAME:"Green Painted Wood",TILES_COLORED_HUE3_NAME_BLOCK:"Green Painted Wood Block",TILES_COLORED_HUE4_NAME:"Blue Painted Wood",TILES_COLORED_HUE4_NAME_BLOCK:"Blue Painted Wood Block",TILES_COLORED_HUE5_NAME:"Purple Painted Wood",TILES_COLORED_HUE5_NAME_BLOCK:"Purple Painted Wood Block",TILES_WATER_NAME:"Water",CRAFT_CLASS_BAKED_FOOD_NAME:"Any Baked Food",CRAFT_CLASS_BRICK_NAME:"Any Brick",CRAFT_CLASS_FARMING_SEED_DESC:"Crop seeds can be obtained from small, wild versions of these plants.",CRAFT_CLASS_FARMING_SEED_NAME:"Any Crop Seed",CRAFT_CLASS_FUEL_NAME:"Any Fuel",CRAFT_CLASS_GRINDABLE_NAME:"Any Grindable",CRAFT_CLASS_INGREDIENT_NAME:"Any Food",CRAFT_CLASS_PIE_FILLING_NAME:"Any Filling",CRAFT_CLASS_REPAIRABLE_NAME:"Any Tool",CRAFT_CLASS_SCALED_INGOT_NAME:"Any Ingot",CRAFT_CLASS_STONE_RAW_NAME:"Any Raw Stone",CRAFT_CLASS_VEGETABLE_NAME:"Any Vegetable",CRAFT_CLASS_WHEAT_CORN_NAME:"Wheat or Corn",CRAFT_CLASS_WOOD_PLANK_NAME:"Any Wood Plank",CRAFT_CLASS_WOOD_RAW_NAME:"Any Raw Wood",MATERIAL_CLASS_NONE_NAME:"None",MATERIAL_CLASS_WOOD_NAME:"Wood",MATERIAL_CLASS_STONE_NAME:"Stone",MATERIAL_CLASS_DIRT_NAME:"Dirt",MATERIAL_CLASS_METAL_NAME:"Metal",MAT_LEAF_NAME:"Leaf",MAT_LIGHT_WOOD_NAME:"Light Wood",MAT_WOOD_NAME:"Wood",MAT_RED_WOOD_NAME:"Red Wood",MAT_DARK_WOOD_NAME:"Dark Wood",MAT_FLINT_NAME:"Flint",MAT_ROCK_NAME:"Rock",MAT_STONE_NAME:"Stone",MAT_CORAL_NAME:"Coral",MAT_FANCY_STONE_NAME:"Fancy Stone",MAT_UNUSED_STONE_NAME:"Unused Stone",MAT_SAND_NAME:"Sand",MAT_DIRT_NAME:"Dirt",MAT_MUTTAL_NAME:"Muttal",MAT_COAL_NAME:"Coal",MAT_COPPER_NAME:"Copper",MAT_TIN_NAME:"Tin",MAT_BRONZE_NAME:"Bronze",MAT_IRON_NAME:"Iron",MAT_SILVER_NAME:"Silver",MAT_EMBERYLLIUM_NAME:"Emberyllium",MAT_GOLD_NAME:"Gold",MAT_BRIGHTSTEEL_NAME:"Brightsteel",MAT_COBALT_NAME:"Cobalt",MAT_MYTHRIL_NAME:"Mythril",MAT_AETHERSTONE_NAME:"Aetherstone",MAT_AETHERSTEEL_NAME:"Aethersteel",MAT_REGULAR_NAME:"Regular",MAT_FAST_NAME:"Fast",MAT_SUPER_NAME:"Super",MAT_ANY_INGREDIENT_NAME:"Any ingredient",MAT_TOMATO_NAME:"Tomato",MAT_PUMPKIN_NAME:"Pumpkin",MAT_CARROT_NAME:"Carrot",MAT_RED_BERRY_NAME:"Red Berry",MAT_BLUE_BERRY_NAME:"Blue Berry",MAT_YELLOW_BERRY_NAME:"Yellow Berry",MAT_LABEL_NAME:"Label",MAT_HOT_NAME:"Hot",MAT_PUNGENT_NAME:"Pungent",MAT_SAVORY_NAME:"Savory",MAT_BREAD_NAME:"Bread",MAT_BROWN_MUSHROOM_NAME:"Brown Mushroom",MAT_LUMINESCENT_MUSHROOM_NAME:"Luminescent Mushroom",MAT_RED_MUSHROOM_NAME:"Red Mushroom",MAT_CORN_NAME:"Corn",MAT_CORAL_MUSHROOM_NAME:"Coral Mushroom",MAT_RED_NAME:"Red",MAT_ORANGE_NAME:"Orange",MAT_YELLOW_NAME:"Yellow",MAT_GREEN_NAME:"Green",MAT_BLUE_NAME:"Blue",MAT_PURPLE_NAME:"Purple",STONE_TIER_T0:"Regular",STONE_TIER_T1:"1★ Dense",STONE_TIER_T2:"2★ Extra-Dense",STONE_TIER_T3:"3★ Hard",STONE_TIER_T4:"4★ Extra-Hard",STONE_TIER_T5:"5★ Super-Hard",STONE_TIER_T6:"6★ Duper-Hard",STONE_TIER_T7:"7★ Mega-Hard",STONE_TIER_T8:"8★ Double-Plus-Hard",STONE_TIER_T9:"9★ Indestructible",ITEM_BLUEPRINT_NAME:"Blueprint",ITEM_BLUEPRINT_NAME_ERROR:"{val} (ERROR)",ITEM_BLUEPRINT_NAME_LOADING:"{val} (Loading...)",ITEM_BLUEPRINT_NAME_UNKNOWN:"Unknown Blueprint",ITEM_BERRY_NAME:"Clump",ITEM_BREAD_NAME:"Corn Bread",ITEM_CARROT_NAME:"Carrot",ITEM_CROISSANT_NAME:"Croissant",ITEM_JUICE_NAME:"Juice",ITEM_LEFTOVERS_NAME:"Leftovers",ITEM_MUSHROOM_NAME:"Mushroom",ITEM_PIE_NAME:"Pie",ITEM_ROAST_VEGETABLES_NAME:"Roast Vegetable",ITEM_SANDWICH_NAME:"Sandwich",ITEM_TOMATO_NAME:"Tomato",ITEM_BOTTLE_NAME:"Empty Bottle",ITEM_COAL_NAME:"Coal",ITEM_CORAL_POWDER_NAME:"Coral Powder",ITEM_CORD_DESC:"Rough rope, useful in assembling all sorts of things.",ITEM_CORD_NAME:"Cord",ITEM_CORN_NAME:"Corn",ITEM_FIBER_DESC:"Fiber gathered from wild or domestic flowers and other plants.",ITEM_FIBER_NAME:"Plant Fiber",ITEM_FLOUR_NAME:"Flour",ITEM_INGOT_NAME:"Ingot",ITEM_ORE_INFO:"Metal ores are primarily found in veins and deposits within other terrain features.  Though Copper and Iron ores can be found near the surface, other ores can only be found deeper, within harder layers of stone.",ITEM_ORE_NAME:"Ore",ITEM_PAINT_NAME:"Paint",ITEM_PUMPKIN_NAME:"Pumpkin",ITEM_SPICE_NAME:"Spice",ITEM_SPICE_PLANT_NAME:"Spice Plant",ITEM_SUGAR_CANE_NAME:"Sugar Cane",ITEM_SUGAR_NAME:"Sugar",ITEM_TOOL_HEAD_NAME:"Tool Head",ITEM_WHEAT_NAME:"Wheat",ITEM_WILD_CROP_NAME:"Wild Crop",ITEM_BERRY_BUSH_BLUE_NAME:"Blue Berry Bush Seed",ITEM_BERRY_BUSH_RED_NAME:"Red Berry Bush Seed",ITEM_BERRY_BUSH_YELLOW_NAME:"Yellow Berry Bush Seed",ITEM_SEEDS_CARROT_NAME:"Carrot Seeds",ITEM_SEEDS_CORN_NAME:"Corn Seeds",ITEM_SEEDS_FLOWERS_BLUE_NAME:"Bashful Blue Flower Seed",ITEM_SEEDS_FLOWERS_ORANGE_NAME:"Optimistic Orange Flower Seed",ITEM_SEEDS_FLOWERS_PURPLE_NAME:"Prestigious Purple Flower Seed",ITEM_SEEDS_FLOWERS_RED_NAME:"Radiant Red Flower Seed",ITEM_SEEDS_FLOWERS_YELLOW_NAME:"Yummy Yellow Flower Seed",ITEM_SEEDS_MUSHROOMS_BROWN_NAME:"Blissful Brown Mushroom Seed",ITEM_SEEDS_MUSHROOMS_CORAL_NAME:"Charming Coral Mushroom Seed",ITEM_SEEDS_MUSHROOMS_LUMINESCENT_NAME:"Lonely Luminescent Mushroom Seed",ITEM_SEEDS_MUSHROOMS_RED_NAME:"Rapturous Red Mushroom Seed",ITEM_SEEDS_PUMPKIN_NAME:"Pumpkin Seeds",ITEM_SEEDS_SUGAR_CANE_NAME:"Sugar Cane Seeds",ITEM_SEEDS_TOMATO_NAME:"Tomato Seeds",ITEM_SEEDS_WHEAT_NAME:"Wheat Seeds",ITEM_ACCESS_CONTROL_DESC:"Allows creating and modifying Areas with limited access.",ITEM_ACCESS_CONTROL_NAME:"Area Access Control",ITEM_BED_NAME:"Bed",ITEM_BENCH_NAME:"Bench",ITEM_BUZZERGOAL_DESC:"Finishes a Race by touching it.  Using it allows to check scores for its Race.\n(To activate, interact while holding this item to assign a name.  Allows finishing a Race started at a Race Start Buzzer with the same name.)",ITEM_BUZZERGOAL_NAME:"Race Goal Flag",ITEM_BUZZERSTART_DESC:"Starts a Race by pressing while active.\n(To activate, interact while holding this item to assign a name.  Reaching a Race Goal Flag with the same name will finish the race.)",ITEM_BUZZERSTART_NAME:"Race Start Buzzer",ITEM_CHAIR_NAME:"Chair",ITEM_CHEST_MEDIUM_NAME:"Chest",ITEM_CHEST_MEDIUM_WOOD_BLUE_NAME:"Sunken Chest",ITEM_CHEST_SMALL_NAME:"Small Chest",ITEM_CHEST_TALL_NAME:"Closet",ITEM_CHEST_TINY_NAME:"Tiny Chest",ITEM_DOOR_DOUBLE_NAME:"Double Door",ITEM_DOOR_NAME:"Door",ITEM_FENCE_NAME:"Fence",ITEM_FLOWERPOT_NAME:"Flowerpot",ITEM_GEM_NAME:"Gem",ITEM_INDICATOR_NAME:"Indicator",ITEM_LADDER_NAME:"Ladder",ITEM_LANTERN_NAME:"Lantern",ITEM_LIGHT_CUBE_NAME:"Cube Light",ITEM_RODH_NAME:"Rod (Horizontal)",ITEM_RODV_NAME:"Rod (Vertical)",ITEM_ROD_NAME:"Rod",ITEM_RUG_NAME:"Rug",ITEM_SEASHELL_BLUE_NAME:"Sea Snail",ITEM_SEASHELL_GREEN_NAME:"Scallop",ITEM_SEASHELL_NAME:"Seashell",ITEM_SEASHELL_ORANGE_NAME:"Cowrie",ITEM_SEASHELL_PURPLE_NAME:"Venus Comb",ITEM_SEASHELL_RED_NAME:"Conch",ITEM_SEASHELL_YELLOW_NAME:"Sand Dollar",ITEM_STARFISH_NAME:"Starfish",ITEM_STARFISH_BLUE_NAME:"Blue Sea Star",ITEM_STARFISH_RED_NAME:"Red Starfish",ITEM_STARFISH_YELLOW_NAME:"Cushion Sea Star",ITEM_SHELF_NAME:"Shelf",ITEM_SIGNBOARD_NAME:"Signboard",ITEM_SIGNPOST_NAME:"Signpost",ITEM_STEPS_NAME:"Steps",ITEM_TABLE_LARGE_NAME:"Large Table",ITEM_TABLE_SMALL_NAME:"Small Table",ITEM_TORCH_NAME:"Torch",ITEM_WINDOW_LARGE_NAME:"Large Window",ITEM_WINDOW_MEDIUM_NAME:"Medium Window",ITEM_WINDOW_SMALL_NAME:"Small Window",ITEM_ANVIL_DESC:"Repairs tools and more efficiently produces metal tool heads.",ITEM_ANVIL_NAME:"Anvil",ITEM_BONFIRE_DESC:"Stone Bonfire with Wood Legs",ITEM_BONFIRE_METAL_DESC:"Bonfire with chains and metal bowl.",ITEM_BONFIRE_METAL_NAME:"Metal Bonfire",ITEM_BONFIRE_NAME:"Bonfire",ITEM_CAMPFIRE_DESC:"Roasts most raw food into something more edible.",ITEM_CAMPFIRE_NAME:"Campfire",ITEM_ENERGY_WELL_DESC:"Provides an alternate place to refill your energy.",ITEM_ENERGY_WELL_NAME:"Energy Well",ITEM_FURNACE_GLASS_DESC:"Refines sand into glass.",ITEM_FURNACE_GLASS_NAME:"Glass Furnace",ITEM_FURNACE_ORE_DESC:"Refines metals into ingots.",ITEM_FURNACE_ORE_NAME:"Ore Furnace",ITEM_JUICER_DESC:"Berries go in, juice comes out. Yum!",ITEM_JUICER_NAME:"Juicer",ITEM_KILN_DESC:"Produces charcoal and bricks.",ITEM_KILN_NAME:"Kiln",ITEM_LEAPGATE_DESC:"Teleports you to another location in this world.",ITEM_LEAPGATE_NAME:"Leapgate",ITEM_LEAPGATE_SHARD_NAME:"Leapgate Shard",ITEM_MILL_DESC:"Grinds something into a new ingredient.",ITEM_MILL_NAME:"Mill",ITEM_OVEN_DESC:"Cooks more advanced food than the Campfire.",ITEM_OVEN_NAME:"Oven",ITEM_PAINT_MIXER_DESC:"Creates and combines paints.",ITEM_PAINT_MIXER_NAME:"Paint Mixer",ITEM_SAWMILL_DESC:"Produces wood rods and cuts wood planks.",ITEM_SAWMILL_NAME:"Woodcuttery",ITEM_STONECUTTER_ADVANCED_NAME:"Advanced Stonecutter",ITEM_STONECUTTER_SIMPLE_DESC:"Produces stone tool heads and cuts stone bricks.",ITEM_STONECUTTER_SIMPLE_NAME:"Stonecuttery",ITEM_TOOL_HEAD_CAST_DESC:"Shapes refined metal into tool heads.",ITEM_TOOL_HEAD_CAST_NAME:"Tool Head Cast",ITEM_VEINIUM_GRINDER_DESC:"Grinds Veinium into ore based on its location.",ITEM_VEINIUM_GRINDER_NAME:"Veinium Grinder",ITEM_WATERING_SYSTEM_DESC:"Automatically waters nearby crops.",ITEM_WATERING_SYSTEM_NAME:"Watering System",ITEM_WAYGATE_NAME:"Waygate",ITEM_WORKBENCH_DESC:"A magical workbench that produces components and tools.",ITEM_WORKBENCH_NAME:"Aetherbench",ITEM_BUCKET_NAME:"Bucket",ITEM_DOWSER_ADVANCED_DESC:"Tool for finding veins of stone which may contain ore.",ITEM_DOWSER_ADVANCED_INFO:"Bar size indicates density variation in the view direction, bar color indicates matching ore.",ITEM_DOWSER_ADVANCED_NAME:"Advanced Dowser",ITEM_DOWSER_SIMPLE_DESC:"Tool for detecting nearby ore.",ITEM_DOWSER_SIMPLE_INFO:"Bar size indicates closeness, bar color indicates matching ore.",ITEM_DOWSER_SIMPLE_NAME:"Simple Dowser",ITEM_HANDSTOOL_NAME:"Empty Hands",ITEM_HATCHET_NAME:"Hatchet",ITEM_HOE_NAME:"Hoe",ITEM_PICKAX_NAME:"Pickax",ITEM_SHOVEL_NAME:"Shovel",ITEM_LIQUID_NAME:"Unknown Liquid",ITEM_PLANT_NAME:"Unknown Flower Seed",LBL_RECIPE_INPUT_BERRY:"Berry",LBL_RECIPE_INPUT_BINDING:"Binding",LBL_RECIPE_INPUT_BOTTLE:"Bottle",LBL_RECIPE_INPUT_CATALYST:"Catalyst",LBL_RECIPE_INPUT_FOCUS:"Focus",LBL_RECIPE_INPUT_FUEL:"Fuel",LBL_RECIPE_INPUT_GRINDABLE:"Grindable",LBL_RECIPE_INPUT_HAFT:"Haft",LBL_RECIPE_INPUT_HEAD:"Head",LBL_RECIPE_INPUT_INGREDIENT:"Ingredient",LBL_RECIPE_INPUT_MATERIAL:"Material",LBL_RECIPE_INPUT_METAL:"Metal",LBL_RECIPE_INPUT_PRIMARY:"Primary",LBL_RECIPE_INPUT_TOOL:"Tool",LBL_RECIPE_TAG_CONSUMABLE:"Consumable",LBL_RECIPE_TAG_CRAFTING_MAT:"Crafting material",LBL_RECIPE_TAG_FUEL:"Fuel",LBL_RECIPE_TAG_INGREDIENT:"Ingredient",LBL_RECIPE_TAG_PLACEABLE:"Placeable",MAT_UNKNOWN:"Unknown",RECIPE_ALLOY_DESC:"Two refined metals combined into an alloy",RECIPE_ALLOY_NAME:"Alloy Ingot",RECIPE_BRICK_CLAY_DESC:"Dried clay",RECIPE_CAMPFIRE_DESC:"Roast stuff!",RECIPE_CAMPFIRE_NAME:"Cooking",RECIPE_CAMPFIRE_UNKNOWN_NAME:"Food",RECIPE_CHARCOAL_DESC:"A lump of coal",RECIPE_CHARCOAL_NAME:"Charcoal",RECIPE_CHARCOAL_SLOW_DESC:"A slowly burned lump of coal",RECIPE_CHARCOAL_SLOW_NAME:"Charcoal",RECIPE_CORD_DESC:"Binding made from plant fiber",RECIPE_DOWSER_ADVANCED_DESC:"Tool for finding veins of stone which may contain ore",RECIPE_DOWSER_SIMPLE_DESC:"Tool for detecting nearby ore",RECIPE_GLASS_BOTTLE_DESC:"An empty glass bottle",RECIPE_GLASS_BOTTLE_NAME:"Glass Bottle",RECIPE_GLASS_DESC:"Transparent block",RECIPE_HATCHET_DESC:"Tool for gathering wood",RECIPE_HOE_DESC:"Tool for tilling dirt to allow planting crops",RECIPE_INGOT_DESC:"Refined metal",RECIPE_INGOT_NAME:"Metal Ingot",RECIPE_JUICE_DESC:"Healthy Juice!",RECIPE_METAL_BUCKET_DESC:"Tool for watering crops and transporting water",RECIPE_METAL_BUCKET_NAME:"Metal Bucket",RECIPE_METAL_ROD_DESC:"Thin straight bar",RECIPE_METAL_ROD_NAME:"Metal Rod",RECIPE_METAL_TOOL_HEAD_CAST_DESC:"Head for constructing tools",RECIPE_METAL_TOOL_HEAD_CAST_NAME:"Metal Tool Head",RECIPE_METAL_TOOL_HEAD_DESC:"Head for constructing tools",RECIPE_METAL_TOOL_HEAD_NAME:"Metal Tool Head",RECIPE_MILL_DESC:"Grind something into a new ingredient!",RECIPE_MILL_NAME:"Grind",RECIPE_MILL_UNKNOWN_NAME:"Ingredient",RECIPE_MIXED_PAINT_DESC:"Mix paint to get new colors",RECIPE_MIXED_PAINT_NAME:"Mixed Paint",RECIPE_OVEN_DESC:"Mix something together!",RECIPE_OVEN_NAME:"Cooking",RECIPE_OVEN_UNKNOWN_NAME:"Food",RECIPE_PAINTED_WOOD_DESC:"Brightly colored wood planks",RECIPE_PAINTED_WOOD_NAME:"Painted Wood",RECIPE_PICKAX_DESC:"Tool for gathering stone",RECIPE_PLANKS_DESC:"Refined wood",RECIPE_PLANKS_NAME:"Wooden Planks",RECIPE_PRIMARY_COLOR_PAINT_DESC:"Mix primary colors from berries",RECIPE_PRIMARY_COLOR_PAINT_NAME:"Primary Color Paint",RECIPE_SHOVEL_DESC:"Tool for gathering dirt",RECIPE_SPICY_JUICE_DESC:"Spicy juice!",RECIPE_SPICY_JUICE_NAME:"Spicy Juice",RECIPE_STONE_BRICKS_DESC:"Refined stone",RECIPE_STONE_TOOL_HEAD_DESC:"Head for constructing tools",RECIPE_TOOL_REPAIR_DESC:"Repair an existing tool",RECIPE_TOOL_REPAIR_NAME:"Tool Repair",RECIPE_TOOL_REPAIR_WARNING_MISMATCH:"Minimal repair due to material mismatch",RECIPE_TOOL_REPAIR_WARNING_REDUCED:"Reduced repair due to ingot used",RECIPE_TOOL_REPAIR_WARNING_WASTEFUL:"Repair is wasteful",RECIPE_UKNOWN:'Unknown recipe "{val}"',RECIPE_VEINIUM_GRIND_DESC:"Grind Veinium into ore based on the location of the grinder",RECIPE_WOOD_BUCKET_DESC:"Tool for watering crops and transporting water",RECIPE_WOOD_BUCKET_NAME:"Wood Bucket",RECIPE_WOOD_ROD_DESC:"Thin straight bar",RECIPE_WOOD_ROD_NAME:"Wood Rod"}},{}],107:[function(e,t,r){t.exports={FORMAT_ADD_COLON:"{val}:",FORMAT_ADD_ELLIPSIS:"{val}...",FORMAT_ADD_PARENTHESES_AFTER:"{val} ({detail})",FORMAT_ADD_PERCENTAGE:"{val}%",FORMAT_INPUT_MERGE:"[{key}]{command}",FORMAT_INPUT_PREPEND:"[{key}] {command}",FORMAT_SEPARATOR_COLON:": ",FORMAT_SEPARATOR_COMMA:", ",FORMAT_SEPARATOR_WORDS:" ",BTN_ACCEPT:"Aceitar",BTN_CANCEL:"Cancelar",BTN_CREATE_USER:"Criar utilizador",BTN_DELETE:"Eliminar",BTN_DOWNLOAD:"Download",BTN_EQUIP:"Equip",BTN_EXIT_TO_MAIN_MENU:"← Sair para Menu Principal",BTN_GET_LINK:"Obter link",BTN_GET_WORLD_LINK:"Obter Link de mundo",BTN_INFO:"Informação",BTN_INVITE_PLAY:"Convidar",BTN_INVITE_TO_WORLD:"Convidar para o mundo",BTN_LOGIN:"Iniciar sessão",BTN_LOGOUT:"Terminar sessão",BTN_NEW_USER:"Novo utilizador",BTN_NO:"Não",BTN_OK:"OK",BTN_PROCESSING:"A processar...",BTN_RANDOM:"Casual",BTN_REMOVE:"Remover",BTN_REMOVE_SPOTLIGHT:"Remover destaque",BTN_RENAME:"Renomear",BTN_RETRY:"Tentar novamente",BTN_SAVE:"Guardar",BTN_SHARE:"Partilhar",BTN_SHARE_WORLD:"Partilhar mundo",BTN_SHARING:"A partilhar...",BTN_SORT_ALPHABETICALLY:"A-Z",BTN_SUBMIT:"Submeter",BTN_TAKE:"Tirar",BTN_TAKE_PHOTO:"Tirar fotografia",BTN_YES:"Sim",CHATERROR_RUNNING_CMD:"Erro ao executar {val}: {val_2}",DLG_ERROR_IMAGE_UPLOAD_TITLE:"Erro ao carregar imagens",DLG_ERROR_TITLE:"Erro",DLG_SHARE_TITLE:"Partilhar",DLG_SHARE_WG_TITLE:"Partilhar Waygate",ERR_WORLD_DISCONNECTED:"Desligado do mundo",CHATERROR_EMPTY_RESPONSE:"Resposta vazia",INPUT_CLICK:"Clicar",INPUT_CLICK_LEFT:"Clique esquerdo",INPUT_CLICK_MIDDLE:"Clique com botão do meio",INPUT_CLICK_RIGHT:"Clique direito",INPUT_DRAG_QBAR:"arrastar barra rápida",INPUT_KEY_CTRL_CLICK:"Ctrl+Clique",INPUT_KEY_DEL:"Del",INPUT_KEY_ENTER:"Enter",INPUT_KEY_SHIFT:"Shift",INPUT_KEY_SHIFT_CLICK:"Shift+Clique",INPUT_KEY_SPACE:"Espaço",INPUT_KEY_TAB:"Tab",INPUT_TAP:"Toque",INPUT_TAP_DOUBLE:"Duplo toque",LBL_AUTHOR:"Autor",LBL_BUILD_MENU:"Menu de Construção",LBL_CONFIRM_PASSWORD:"Confirmar palavra-passe",LBL_DESCRIPTION:"Descrição",LBL_DISPLAY_NAME:"Nome de apresentação",LBL_ELAPSED_TIME:"Hora",LBL_ENERGY_WELL:"Poço de Energia",LBL_EMAIL_ADDRESS:"Endereço de e-mail",LBL_ERROR:"Erro",LBL_EXIT_MENU:"Sair do menu",LBL_FIELD_OF_VIEW:"Campo de Visão",LBL_MENU:"Menu",LBL_NAME:"Nome",LBL_NEW_WORLD:"Novo mundo",LBL_NUMBERED_WORLD:"Mundo #{val}",LBL_PASSWORD:"Palavra-passe",LBL_PRIVACY_POLICY:"Política de Privacidade",LBL_RECIPE:"Receita",LBL_REQUIRES:"Requer",LBL_RESULTS:"Resultados",LBL_TERMS_OF_SERVICE:"Termos de Serviço",LBL_UNKNOWN_WORLD_ID:"???",LBL_UNKNOWN_WORLD_NAME:"Mundo desconhecido",LBL_USERNAME:"Nome de utilizador",LBL_USER_ID:"ID do utilizador",LBL_VERSION:"Versão",LBL_VIEW_INFO:"Ver info",LBL_WORLD_NAME:"Nome do mundo",LBL_WORLD_URL:"URL do mundo",MSG_INVENTORY_FULL:"Inventário cheio",MSG_LOADING:"A carregar...",MSG_OUT_OF_SETTLEMENT_ALERT:"A indústria só funciona dentro de Povoações.",MSG_PLEASE_WAIT:"Por favor, aguarde…",MSG_SAVED:"Guardado.",MSG_SAVING:"A guardar...",TLTP_PLACE_IN_QB:"Colocar na barra rápida",BTN_CREATE_AREA:"Criar Área",LBL_ACCESS_PRESET_BUILD:"Qualquer um pode construir",DISCLAIMER_CREATE_ACCOUNT:"Ao criar uma conta, concorda com os",DISCLAIMER_LOGIN:"Ao iniciar sessão, concorda com os nossos",DISCLAIMER_TOS_PP_SEPARATOR:"e",DLG_AUTO_LOGGIN_FAILED_TITLE:"Falha ao iniciar sessão",DLG_LOGIN_ERROR_TITLE:"Erro de Login",DLG_PLATFORM_LOGIN_FAILED_TITLE:"Falha ao iniciar sessão de {val}",DLG_SHARE_USER_ID_TITLE:"O seu ID de utilizador",LBL_EXTERNAL_LOGINS:"Ou iniciar sessão com",LBL_LOGGED_IN_AS:"Autenticado como",LOGINMSG_AUTO_LOGGING_IN:"A iniciar sessão automaticamente...",LOGINMSG_CONNECTING:"A estabelecer ligação...",LOGINMSG_LOGGING_IN:"A iniciar sessão...",LOGINMSG_LOGGING_OUT:"A terminar sessão...",LOGINMSG_NEW_VERSION:"Nova versão disponível!",LOGINMSG_RELOAD_PAGE:"Atualize a página.",LOGINMSG_RESTART_OR_UPDATE_APP:"Reinicie ou atualize a aplicação.",LOGINMSG_SERVER_RESTARTING:"A reiniciar o servidor...",LOGINMSG_TRY_AGAIN:"Por favor, tente de novo mais tarde.",LOGINMSG_UNDER_MAINTENANCE:"O jogo está em manutenção.",LOGINMSG_UPDATE_APP:"Atualize a aplicação.",COSTUME_UNKNOWN:"Desconhecido",SUBTITLE_BETA:"Beta",DLG_DELETE_BP_MSG:"Tem a certeza de que pretende eliminar esta planta ({val})?",DLG_DELETE_BP_TITLE:"Eliminar planta?",DLG_ERROR_RENAMING_BP_TITLE:"Falha ao mudar o nome da planta",DLG_ERROR_SHARING_BP_TITLE:"Falha ao partilhar planta",DLG_REMOVE_BP_MSG:"Tem a certeza de que pretende remover esta planta ({val})?",DLG_REMOVE_BP_TITLE:"Remover planta da biblioteca?",DLG_RENAME_BP_MSG:'Introduza um novo nome para a planta "{val}"',DLG_RENAME_BP_TITLE:"Renomear plano",DLG_SHARE_BP_TITLE:"Partilha de planta",ERR_CMD_REQUIRES_OWNED_BP:"O comando requer uma planta editável pertencente a si.",MSG_BP_DELETED:"Planta eliminada",MSG_BP_REMOVED:"Planta removida da biblioteca",MSG_BP_RENAMED:"Planta renomeada",TLTP_DELETE_THIS_BP:"Eliminar esta planta",TLTP_HOLD_SKIP_CONFIRMATION:"(mantenha premido {val} para ignorar a confirmação)",TLTP_LINK_BP_GET:"Obtenha um link que qualquer pessoa possa usar para adicionar esta planta à sua biblioteca",TLTP_LINK_BP_SHARE:"Partilhar um link que qualquer pessoa pode usar para adicionar esta planta à sua biblioteca",TLTP_REMOVE_THIS_BP:"Remover esta planta da biblioteca",TLTP_RENAME_BP_FOR_ALL:"Renomeie a sua planta partilhada para TODOS os utilizadores",TLTP_RENAME_BP_IN_LIBRARY:"Renomeie esta planta na sua biblioteca",TLTP_SHARE_BP:"Crie uma nova cópia só de leitura desta planta para partilha ou uso posterior",BBOX_BP_DATA_ERROR:"Erro de dados da planta: {val}",BBOX_BP_DATA_LOADING:"Dados de planta a carregar...",BBOX_BP_IS_IN_YOUR_LIBRARY:"A planta está na sua biblioteca",BBOX_BP_SAVED:"Guardado!",BBOX_CANNOT_SAVE_OWNED_BY:"Não é possível guardar, a planta pertence a {val}",BBOX_INVALID_BP_ID:"ID de planta inválido",BBOX_MISSING_RESOURCES:"Não é possível construir completamente: falta de recursos",BBOX_MODIFIED_ELSEWHERE_MSG_EDIT:"Para editar esta planta com segurança, remova esta BlueBox e coloque uma nova.",BBOX_MODIFIED_ELSEWHERE_MSG_OVERWRITE:"Guardar aqui fará com que essas alterações sejam substituídas.",BBOX_MODIFIED_ELSEWHERE_MSG_WARNING:"Aviso: este planta foi modificada em outro lugar.",BBOX_MUST_CLEAR_BOUNDS:"Não é possível iniciar a edição: deve tirar dos limites as coisas acessórias",BBOX_NO_CHANGES_DETECTED:"Nenhuma alteração detetada",BBOX_NO_MATCHING_RESOURCES:"Não é possível depositar: não há recursos correspondentes",BBOX_OVERLAPS_ANOTHER_EDITED_BP:"Não é possível iniciar a edição: sobrepõe-se a outra planta editada",BBOX_OVERLAPS_EDITED_BP:"Não é possível construir: sobrepõe-se a planta editada",BBOX_REFRESHING_STATE:"A atualizar o estado...",BBOX_SOMETHING_BLOCKING:"Não é possível construir completamente: há algo a bloquear a construção ou a fundação",BBOX_TO_EDIT_FINISH_AND_PLACE:"Para editar esta planta, termine de construí-la e, em seguida, substitua a BlueBox",BBOX_WAITING_PREVIOUS_SAVE:"A aguardar que a gravação anterior seja concluída...",BTN_ADDING_TO_LIBRARY:"A adicionar...",BTN_ADD_TO_LIBRARY:"Adicionar à minha biblioteca",BTN_DEPOSIT_ALL:"Depositar tudo",BTN_REMOVE_BBOX:"Remover BlueBox",DLG_ERROR_ADDING_BP_TITLE:"Erro ao adicionar à biblioteca",DLG_UNSAVED_CHANGES_MSG:"Fez alterações que não foram guardadas. Não será possível guardar estas alterações nesta planta assim que a BlueBox for removida. Parar de editar?",DLG_UNSAVED_CHANGES_TITLE:"Alterações não guardadas",LBL_BLUEPRINT:"Planta",LBL_BLUEPRINT_ERROR:"Planta (Erro)",LBL_BLUEPRINT_LOADING:"Planta (A carregar...)",LBL_BLUEPRINT_STATUS:"Estado da planta",LBL_BP_VIEW:"Vista da planta",LBL_BP_VIEW_ERROR:"Vista da planta (Erro)",LBL_BP_VIEW_LOADING:"Vista da planta (A carregar...)",LBL_EDITABLE_BLUEPRINT:"Planta editável",LBL_LEFT_TO_BUILD:"Falta construir",LBL_NONE_RESOURCES:"Nenhum",LBL_REQUIRED_RESOURCES:"Recursos necessários",STATUSMSG_BBOX_CANNOT_EJECT:"A BlueBox não pode ejetar o excesso: não há lugar para deixar itens",STATUSMSG_BP_COMPLETELY_BUILT:"Planta completamente construída",STATUSMSG_BP_STILL_LOADING:"A planta ainda está a carregar. Por favor, tente de novo...",STATUSMSG_PREVIEWING_BP:"A pré-visualizar a planta. Selecione novamente para ver as opções",TLTP_DEPOSIT_RESOURCE:"Depositar {val} {val_2}",CHATERROR_SAVING_BP:"Erro ao guardar planta: {val}",CHATERROR_SAVING_BP_SNAPSHOT:"Erro ao guardar o instantâneo da planta: {val}",STATUSMSG_BP_SAVED:"Planta guardada",BTN_AFFORDABLE_ITEMS:"Acessível",BTN_ALLOCATING:"A alocar...",BTN_ALL_ITEMS:"Tudo",BTN_DETAILS:"Detalhes",BTN_ICONS:"Ícones",BTN_NEW_BP:"Novo",BUILDMENU_HINT_CRAFT_TOOLS_AND_CONSUMABLES:"As ferramentas e os consumíveis podem ser fabricados num Aetherbench ou noutros edifícios de Povoação",BUILDMENU_HINT_NEW_BP_MSG_CREATE:"Pode criar as suas próprias plantas!",BUILDMENU_HINT_NEW_BP_MSG_START:'Prima "Novo" acima para começar.',BUILDMENU_ITEM_NOT_FOUND:"Não encontrado",BUILDMENU_NOTHING_AFFORDABLE:"Nada acessível",BUILDMENU_NO_BP_AVAILABLE:"Nenhuma planta disponível",BUILDMENU_NO_TOOLS_OR_CONSUMABLES:"Sem ferramentas ou consumíveis no inventário",BUILDMENU_UNLOCK_SCHEMATICS:"Desbloqueie mais esquemas atualizando a sua Povoação no Waygate",DLG_QUOTA_EXCEEDED_MSG:"Já tem o número máximo ({val}) de plantas editáveis.",DLG_QUOTA_EXCEEDED_TITLE:"Quota excedida",ERR_MISSING_BLUEPRINT_ID:"ID de planta em falta",LBL_BLUEPRINTS:"Planta",LBL_CRAFTED_BLOCKS:"Blocos artesanais",LBL_NEW_BLUEPRINT:"Novo",LBL_PROPS:"Adereços",LBL_RAW_BLOCKS:"Blocos brutos",LBL_SEARCH_ALL:"Procurar tudo",LBL_SETTLEMENT:"Povoação",LBL_TOOLS_AND_CONSUMABLES:"Ferramentas e consumíveis",LBL_TOOLS_AND_FARMING:"Ferramentas e agricultura",TLTP_CLOSE_BUILD_MENU:"Fechar menu de Construção",TLTP_SELECT_AND_CLOSE_BUID_MENU:"Selecione e feche o menu de Construção",TLTP_SELECT_IN_QB_AND_VIEW:"Selecione na barra rápida e veja as informações",STATUSMSG_BP_NOT_ALLOWED:"Não tem permissão para colocar plantas neste mundo",STATUSMSG_DIG_NO_STAMINA_BUCKET:"Está demasiado exausto para usar o balde!",STATUSMSG_DIG_NO_STAMINA_DIG:"Está demasiado exausto para escavar!",STATUSMSG_DIG_NO_STAMINA_HINT:"Consuma alimentos ou volte ao seu Waygate através do Menu | Info mundo",STATUSMSG_DIG_NO_STAMINA_HOE:"Está demasiado exausto para usar a enxada!",STATUSMSG_DIG_NO_STAMINA_WATER:"Está demasiado exausto para recolher água!",STATUSMSG_DIG_WRONG_TIER_BREAK:"É necessário {val} de {val_2} para quebrar {val_3} {val_4}",STATUSMSG_DIG_WRONG_TIER_DECONSTRUCT:"É necessário {val} de {val_2} para desconstruir {val_3}",STATUSMSG_DIG_WRONG_TIER_GATHER:"É necessário {val} de {val_2} para recolher {val_3}",STATUSMSG_DIG_WRONG_TOOL:"{val} não é o tipo certo de ferramenta para recolher {val_2}",STATUSMSG_GROUND_WRONG_KIND:"Deve ser colocado em {val}",STATUSMSG_PLACE_BLOCKED:"Falha ao colocar o bloco, chegou lá outra coisa primeiro",STATUSMSG_PLACE_CHUNK_UNLOAD:"Falha ao colocar o bloco, pedaço descarregado",STATUSMSG_SETTLEMENT_OUT_OF_BOUNDS:"Aviso: a indústria só funciona dentro de Povoações",STATUSMSG_TOOL_BROKE:"Ferramenta quebrada :(",STATUSMSG_TOOL_BROKE_REPAIR:"Ferramenta quebrada, mas pode ser reparada numa Bigorna",STATUSMSG_TOOL_BROKE_REPLACE:"Ferramenta quebrada, substituição autoequipada",STATUSMSG_TOOL_CUSTOM_NOT_ALLOWED:"As ferramentas personalizadas não são permitidas neste mundo",PAGETITLE_DMCA:"FRVR: DMCA",PAGETITLE_GDPR:"FRVR: Regulamento Geral sobre a Proteção de Dados",PAGETITLE_PRIVACY_POLICY:"FRVR: Política de Privacidade",PAGETITLE_TERMS_OF_SERVICE:"FRVR: Termos de Serviço",PAGETITLE_UPDATES:"Atualizações",CHATERROR_INVALID_POS_STRING:"Cadeia de posição inválida: {val}",MSG_NOWHERE_TO_SIT:"Não há onde se sentar.",STATUSMSG_CANNOT_SPRINT:"Não é possível dar sprint, sem {val}",STATUSMSG_CONSUME_OR_RETURN:"Consuma alimentos ou volte ao seu Waygate através do Menu | Info mundo",CONTINENT_LOADER_COMPLETE:"Geração de continente completa",CONTINENT_LOADER_NEW:"A gerar novo continente...",CONTINENT_LOADER_SYNCING:"A sincronizar continente com o servidor...",BTN_DOWN:"Baixo",BTN_JUMP:"Saltar",BTN_UP:"Cima",STATUSMSG_STUCK_DIG_OR_WG:"Está bastante preso! Escave para sair ou use o gate para escapar.",STATUSMSG_STUCK_MENU_OR_LEAVE:"Está bastante preso! Use o menu para usar o Waygate noutro lugar ou sair do mundo.",COSMETIC_COSTUME_2021_12_SANTA_HAT:"Chapéu de Pai Natal '21",COSMETIC_COSTUME_2021_12_SNOWMAN:"Boneco de neve '21",COSMETIC_COSTUME_2021_12_SWEATER_1:"Camisola #1 '21",COSMETIC_COSTUME_2021_12_SWEATER_2:"Camisola #2 '21",COSMETIC_COSTUME_CAPTAIN:"Capitão",COSMETIC_COSTUME_GNARL_SHAMAN:"Gnarl Shaman",COSMETIC_COSTUME_SKELETON_MINION:"Minion Esqueleto",COSMETIC_COSTUME_VILLAGER_1:"Aldeão #1",COSMETIC_COSTUME_VILLAGER_2:"Aldeão #2",COSMETIC_COSTUME_VILLAGER_3:"Aldeão #3",COSMETIC_COSTUME_VILLAGER_4:"Aldeão #4",CMODS_DIG_DURABILITY:"Durabilidade",CMODS_DIG_RATE:"Velocidade",CMODS_NOT_GOOD:"Não pode ser bom...",CMODS_O2_CAPACITY:"Capacidade de O2",CMODS_RANDOM_BONUSES:"+{val}-{val_2} bónus aleatórios",CMODS_RARITY_COMMON:"Frequente",CMODS_RARITY_RARE:"Raro",CMODS_RARITY_UNCOMMON:"Pouco frequente",CMODS_STAMINA_CAPACITY:"Capacidade de {val}",CMODS_STAMINA_DRAIN:"Consumo de {val}",CMODS_STAMINA_RANGE:"Faixa",CMODS_STAMINA_RATE:"Menos uso de {val}",CMODS_TIMED:"{val} {val_2} por {val_3}",CMODS_TIMED_DIG_RATE:"Velocidade de recolha",CMODS_TIMED_SPRINTING_STAMINA:"{val} de sprint",CMODS_TIMED_STAMINA:"{val}/segundo",CMODS_TIMED_STAMINA_CAPACITY_WGSICK:"{val} (Doença de Waygate)",BTN_DRINK:"Bebida",ENERGYWELL_CANCEL_SICKNESS:"Nota: o tempo de bónus irá cancelar essa quantidade de Doença de Waygate",ENERGYWELL_CANCEL_SICKNESS_SOME:"Nota: algum tempo de bónus irá cancelar a sua Doença de Waygate",ENERGYWELL_FULL:"Já tem o máximo de {val}",ENERGYWELL_LAST_DRINK:"A sua última bebida foi há {val}",ENERGYWELL_MUST_VISIT:"Visite o Poço de Energia no mundo para beber...",ENERGYWELL_READY:"Pronto!",ENERGYWELL_RECHARGING:"O Poço de Energia ainda está a recarregar...",LBL_CURRENT_ENERGY:"{val} atual",LBL_OVERFILL_ENERGY:"Excesso: +{val} por {val_2}",LBL_REFILL_ENERGY:"Recarregar {val}",LBL_WELL_RESTED:"Descansado: +{val} por {val_2}",STATUSMSG_ENERGY_WELL_ADD:"+{val} (Poço de Energia)",BTN_FINISH:"Terminar",ERR_CRAFTING_CANNOT_COMPLETE:"Armazenamento cheio: a criação não pode ser concluída",ERR_CRAFTING_STALLED:"Armazenamento cheio: criação parada",ERR_INSUFFICIENT_RESOURCES:"Não é possível criar: recursos insuficientes carregados",ERR_INVALID_INPUT:"Não é possível criar: combinação de entrada inválida",FACTORY_CRAFTING_COMPLETE:"Criação concluída: leve isto para continuar",FACTORY_CRAFTING_IN_PROGRESS:"Criação em curso... Volte mais tarde!",FACTORY_FULL_INVENTORY:"Não é possível levar: inventário cheio",FACTORY_NO_RECIPES_AVAILABLE:"Nenhuma receita disponível",FACTORY_PROGRESS_READY:"Pronto!",FACTORY_REFRESHING_CONTENTS:"A atualizar o conteúdo...",FACTORY_UPGRADE_SETTLEMENT_TO_UNLOCK:"Atualize a sua Povoação para desbloquear",FORMAT_CRAFTING_PROGRESS:"{val} ({val_2})",FORMAT_NUMBER_OR_MORE:"{val}+",LBL_CRAFTING_COMPLETE:"Criação completa!",LBL_MISSING_PROP:"Adereço em falta",LBL_NO_RECIPE_SELECTED:"Nenhuma receita selecionada",LBL_OUTPUT_MULTIPLE:"{val} (x{val_2})",LBL_REFRESHING_FACTORY:"A atualizar...",LBL_SELECT_RECIPE:"Selecionar receita",RECIPELIST_ALL_UNLOCKED_FOR_STATION:"Todas as receitas desta estação desbloqueadas!",RECIPELIST_EVEN_MORE_FROM_LATER_UPGRADES:"Ainda mais receitas disponíveis de upgrades posteriores",RECIPELIST_UNLOCK_MORE_BY_UPGRADING:"Desbloqueie mais receitas ao atualizar a sua Povoação",RECIPELIST_UPGRADE_SETTLEMENT_TO_UNLOCK:"Atualize a sua Povoação no Waygate para desbloquear",STATUSMSG_CANNOT_CHANGE_RECIPE_NO_SPACE:"Não é possível alterar a receita: espaço insuficiente para ejetar entradas carregadas",STATUSMSG_SOME_ITEMS_DROPPED:"Alguns itens caíram ao chão",TLTP_ADD_TO_RECIPE:"Adicionar à receita",TLTP_ENOUGH_FOR_ONE:"(suficiente para um)",HUDS_GEM_FOUND_ALL:"Todas as joias {val} encontradas!",HUDS_GEM_FOUND_ONE:"{val} joia encontrada!",HUDS_IN_SETTLEMENT:'Na povoação "{val}"',HUDS_IN_THE_WILDS:"Em terreno selvagem",STATUSMSG_ITS_DARK:"Está muito escuro! {val}",STATUSMSG_STAMINA_DAMAGE:"-{val} ({val_2})",STATUSMSG_STAMINA_MODS:"{val} {val_2} {val_3}",TLTP_WORLD_CLICK_TO_LIKE:"Clique para gostar deste mundo",TLTP_WORLD_LIKED:"Gosta deste mundo!",DLG_ERROR_GETTING_PHOTO_TITLE:"Erro ao obter foto",DLG_INITIALIZING_PURCHASE_TITLE:"A iniciar compra",DLG_INVITING_TITLE:"A convidar!",DLG_OFFICIAL_GROUP_TITLE:"A obter o grupo oficial",DLG_OFFICIAL_PAGE_TITLE:"A obter a página oficial",DLG_PURCHASE_FAILED_PROCESS_MSG:"Erro ao processar a compra: {val}",DLG_PURCHASE_FAILED_SYNC_MSG:"A compra foi bem-sucedida, mas não foi possível sincronizar. Tente atualizar a página. Erro = {val}",DLG_PURCHASE_SUCCESSFUL_MSG:"Muito obrigado pela compra!",DLG_PURCHASE_SUCCESSFUL_TITLE:"Compra bem-sucedida",DLG_SHARE_BLUEPRINT_MSG:"Planta Worlds FRVR | {val}",DLG_SHARE_WORLD_CURRENT_JOIN:"Entrar em {val}",DLG_SHARE_WORLD_FRIEND_INVITING_MSG:"{val} enviou um convite para jogar em {val_2} no Worlds FRVR!",DLG_SHARE_WORLD_FRIEND_JUST_PLAYED_MSG:"{val} acabou de jogar {val_2}!",DLG_SHARING_BLUEPRINT_TITLE:"A partilhar planta",DLG_SHARING_PHOTO_TITLE:"A partilhar foto",DLG_SHARING_WORLD_TITLE:"A partilhar mundo",ERR_FB_PURCHASE_NOT_LOGGED:"Sem sessão iniciada",ERR_FB_PURCHASE_NOT_READY:"Pagamentos FB não prontos",ERR_LOAD_BLUEPRINT_IMAGE:"Não foi possível carregar a imagem de planta",ERR_LOAD_WORLD_IMAGE:"Não foi possível carregar",FBINSTANT_SHARE_PHOTO:"Foto Worlds FRVR",FBINSTANT_SHARE_WORLD:"Worlds FRVR | {val}",ERR_CUSTOM_TEXTURES_NOT_ALLOWED:"Texturas personalizadas não permitidas",ERR_INVALID_DATA_HEADER:"Cabeçalho de dados inválido: {val}",BTN_BUY_NOW:"Comprar agora!",BTN_BUY_NOW_PRICE:"Comprar agora! {val}",BTN_COMING_SOON:"Em breve!",BTN_CONSUME:"Consumo",BTN_DROP:"Soltar",BTN_PUT:"Colocar",BTN_PUT_ALL:"Colocar tudo",BTN_QUICK_DEPOSIT:"Depósito rápido",BTN_SORT:"Ordenar",BTN_SPLIT:"Dividir",BTN_TAKE_ALL:"Levar tudo",BTN_USE:"Usar",DLG_CANNOT_PURCHASE_MSG:"Não é possível comprar: sem sessão iniciada ou desligado",DLG_DISPLAY_NAME_CHANGED_MSG_NEW:"Nome de apresentação alterado para {val}!",DLG_DISPLAY_NAME_CHANGED_MSG_USERID:"O seu ID de utilizador (login) continua a {val}.",DLG_DISPLAY_NAME_CHANGED_TITLE:"Nome de apresentação alterado",DLG_DISPLAY_NAME_ERROR_MSG:"Não é possível renomear: ligação perdida",DLG_DISPLAY_NAME_MSG:"Introduza um novo nome para si",DLG_DISPLAY_NAME_TITLE:"Nome de apresentação",DLG_FIND_MORE_GEMS_MSG:"Pode encontrar joias em mundos em destaque e mundos vencedores de concursos anteriores.",DLG_NEED_MORE_GEMS_COST_MSG:"Custo",DLG_NEED_MORE_GEMS_CURRENT_AMOUNT_MSG:"As suas joias",DLG_NEED_MORE_GEMS_MSG:'Precisa de mais joias para comprar "{description}".',DLG_NEED_MORE_GEMS_TITLE:"São precisas mais joias",DLG_PROCESSING_PURCHASE_TITLE:"A processar compra",DLG_PURCHASE_CONFIRMATION_MSG:'Tem a certeza de que deseja comprar "{description}"?',DLG_PURCHASE_CONFIRMATION_TITLE:"Confirmação de compra",DLG_PURCHASE_FAILED_CUSTOM_MSG:"Ocorreu um erro na compra. Erro = {error}.",INVENTORYUI_AMOUNT_INSUFFICIENT:"({val} curto)",INVENTORYUI_AMOUNT_ONE:"(um)",INVENTORYUI_INVENTORY:"inventário",INVENTORYUI_MISSING_CONTAINER:"Contentor em falta",INVENTORYUI_REFRESHING_CONTENTS:"A atualizar o conteúdo...",LBL_TRANSFER:"Transferir",STATUSMSG_CANNOT_DROP:"Não é possível soltar: não foi possível encontrar espaço vazio",STATUSMSG_CANNOT_PUT:"Não é possível colocar tudo: {val} cheio",STATUSMSG_CANNOT_TAKE:"Não é possível levar tudo: {val} cheio",STATUSMSG_QUICK_DEPOSIT_FAIL_FULL:"O Depósito Rápido falhou: contentor cheio",STATUSMSG_QUICK_DEPOSIT_FAIL_NO_CONTAINERS:"O Depósito Rápido falhou: nenhum contentor nas proximidades",STATUSMSG_QUICK_DEPOSIT_FAIL_NO_MATCH:"O Depósito Rápido falhou: nada corresponde aos contentores próximos",STATUSMSG_QUICK_DEPOSIT_FAIL_PARTIAL:"Depósito Rápido parcialmente completo: contentor cheio",STATUSMSG_QUICK_STORE_FAIL_FULL:"Não é possível armazenar rapidamente: {val} cheio",TLTP_ADD_QUICKBAR:"Adicionar à barra rápida e sair do menu",TLTP_CHANGE_NAME:"Mudar nome de apresentação",TLTP_DEPOSIT_ALL_NEARBY:"Deposite todos os itens em contentores próximos com itens correspondentes",TLTP_DROP:"Soltar",TLTP_EQUIPMENT_EQUIP:"Equip",TLTP_EQUIPMENT_SLOT:"Slot de equipamento para {val}",TLTP_EQUIPMENT_SLOT_DEFAULT_CRUDE_TOOLS:"(Vazio, a usar a ferramenta bruta padrão)",TLTP_EQUIPMENT_SLOT_DEFAULT_TOOLS:"(Vazio, a usar a ferramenta padrão)",TLTP_EQUIPMENT_SPLIT_STACK:"Dividir pilha",TLTP_EQUIPMENT_UNEQUIP:"Desequipar",TLTP_ITEM_IN_TRASH:"{val} (no lixo)",TLTP_NEXT_SKIN:"Próxima skin",TLTP_PREVIOUS_SKIN:"Skin anterior",TLTP_SORT_AND_STACK:"Ordenar e empilhar itens",TLTP_STACK:"{val} (pilha)",TLTP_TRASH:"Lixo",TLTP_TRASH_EMPTY:"Esvaziar o lixo",DLG_ERROR_INVENTORY_RESET_MSG:"Tente atualizar a aplicação ou página se persistir.",DLG_ERROR_INVENTORY_RESET_TITLE:"Erro ao repor inventário",INVENTORY_ITEM_LABEL_HATCHET:"recolher madeira (Machado)",INVENTORY_ITEM_LABEL_PICKAX:"recolher pedra (Picareta)",INVENTORY_ITEM_LABEL_SHOVEL:"recolher terra (Pá)",STATUSMSG_CANT_GRANT_INVENTORY_LOCKED:"Não foi possível conceder itens: inventário bloqueado",STATUSMSG_ITEM_ADD:"+{val} {val_2} ({val_3})",STATUSMSG_ITEM_AUTO_EQUIP:"Autoequipado: {val}",STATUSMSG_ITEM_AUTO_GRANT:"Concedido automaticamente: {val}",STATUSMSG_ITEM_REMOVED:"Removido: {val}",ITEMINFO_CANT_AFFORD_ALERT:"Não pode construir isto.",ITEMINFO_NOT_IN_INVENTORY_ALERT:"Não tem isto no seu inventário.",ITEMINFO_SETTLEMENT_LOCKED_ALERT:"Isto ainda não está desbloqueado na sua Povoação atual.",ITEMINFO_UNLIMITED_ONLY_ALERT:"Isto só pode ser construído diretamente em mundos no Modo Ilimitado.",LBL_BUILD_COST:"Custo de construção",LBL_CRAFTED_BY:"Criado por",LBL_CRAFT_FROM:"Criado a partir de",LBL_CRAFT_FROM_AMOUNT:"{val} criado a partir de",LBL_EXAMPLES:"Exemplos",LBL_ITEM_CONTEXT_BUILD:"(Contruir)",LBL_ITEM_CONTEXT_ITEM:"(Item)",LBL_ITEM_CONTEXT_RECIPE:"(Receita)",LBL_ITEM_CONTEXT_SETTLEMENT_UPGRADE:"(Upgrade de Povação)",TLTP_VIEW_BUILD_INFO:"Ver informações de construção",TLTP_VIEW_CRAFT_COST:"Ver custo de criação",TLTP_VIEW_ITEM_INFO:"Ver informações do item",ERR_LANGUAGE_NOT_FOUND:'Idioma "{val}" não suportado',MSG_LANGUAGE_GET:"O idioma atual é {val}",MSG_LANGUAGE_SET:"O idioma mudou para {val}",MSG_COPY_TEXT_FAILURE:"FALHA ao copiar para a área de transferência, copie abaixo.",MSG_COPY_TEXT_SUCCESS:"Texto copiado para a área de transferência!",WINDOW_TITLE:"Worlds FRVR",WINDOW_TITLE_COMPOSITE:"{val} | Worlds FRVR",BTN_JOIN_OUR_GROUP:"Junte-se ao nosso Grupo!",BTN_LATEST_NEWS:"Últimas notícias",BTN_PLAY:"Jogar",BTN_RECENT_UPDATES:"Atualizações recentes",DLG_ACCESS_TOKEN_APPLIED_TITLE:"Token de acesso aplicado",DLG_ERROR_ACCESS_TOKEN_TITLE:"Erro de token de acesso",DLG_ERROR_WORLD_CREATE_TITLE:"Erro ao criar mundo",DLG_ERROR_WORLD_DELETE_TITLE:"Erro ao eliminar mundo",DLG_ERROR_WORLD_FORGET_TITLE:"Erro ao esquecer mundo",DLG_ERROR_WORLD_PASSWORD_TITLE:"Erro de palavra-passe de mundo",DLG_NEW_WORLD_NAME_MSG:"Introduza um nome para o seu novo mundo",GAME_MODE_LOST_FRONTIER:"Lost Frontier",GAME_MODE_LOST_FRONTIER_BETA:"Lost Frontier - BETA",GAME_MODE_UNLIMITED:"Ilimitado",LBL_ACCESS_TOKEN_ENTER:"Insira o Token de Acesso",LBL_CONTINENT_DATA_MOD:"Dados do continente fornecidos pelo mod",LBL_DISCORD_WORLDS:"Discord de mundos",LBL_DMCA:"DMCA",LBL_FEATURED_WORLDS:"Mundos em destaque",LBL_FRIENDS_IN_WORLD:"Amigos no mundo",LBL_GAME_MODE:"Modo de jogo",LBL_GDPR:"RGPD",LBL_MEANWHILE_CHECK_OUT:"Entretanto, veja",LBL_MY_WORLDS:"Os meus mundos",LBL_SEARCH:"Pesquisar",LBL_WORLDS:"Mundos",LBL_WORLDS_ACTIVE:"Mundos ativos",LBL_WORLDS_ACTIVE_AND_RECENT:"Mundos ativos e recentes",LBL_WORLDS_RECENT:"Mundos recentes",LBL_WORLD_PASSWORD_ENTER:"Introduza a palavra-passe do mundo",LBL_WORLD_SEED:"Seed do mundo",LBL_WORLD_SEED_ENTER:"Introduza uma seed aleatória para o seu novo mundo",LBL_WORLD_SEED_SHORT:"Seed",LBL_WORLD_TYPE:"Tipo de mundo",LOGINMSG_RECONNECTING:"Ligação perdida, a tentar restabelecer a ligação ({val})...",MSG_ACCESS_TOKEN_VALIDATING:"A validar o token de acesso...",MSG_ACTIVE_WORLDS_NOT_FOUND:"Nenhum mundo ativo encontrado",MSG_ACTIVE_WORLDS_QUERYING:"A consultar",MSG_PASSWORD_VALIDATING:"A validar a palavra-passe...",MSG_REDDIT_FOR_MORE_INFO:"Veja {val} para mais informações!",MSG_SEARCHING:"A pesquisar...",MSG_SERVER_NEEDS_ACCESS_TOKEN:"Este servidor requer um Token de Acesso.",MSG_WORLDS_CREATE_NEEDS_INVITE:"Nota: a criação de novos mundos é atualmente apenas para convidados",PAGETITLE_CREATE_NEW_WORLD:"Criar novo mundo",SETTING_AUTO_FULLSCREEN_HELP:"Entrar automaticamente em ecrã completo ao clicar em Jogar no menu principal, se disponível",SETTING_NOT_AVAILABLE_ON_DEVICE:"Não disponível neste dispositivo",TLTP_SEARCH_WORLDS_ALL:"Pesquisar todos os mundos",TLTP_SEARCH_WORLDS_BUILDER:"Pesquisar apenas mundos onde pode construir",TLTP_SORT_BY_LIKES:"Ordenar por gostos",TLTP_SORT_BY_NAME:"Ordenar por nome",TLTP_SORT_BY_VIEWS:"Ordenar por visualizações",WORLD_CREATE_BETA_WARN_MSG:"Estamos a desenvolver ativamente conteúdo de jogabilidade, adicionando nova geração processual e reformulando conteúdos. Durante este período beta, muitas coisas podem ser removidas, mudadas ou ficar danificadas.",WORLD_CREATE_BETA_WARN_TITLE:"Construa por sua conta e risco!",WORLD_TYPE_FLAT:"Flat (persistente)",WORLD_TYPE_GENERATED_V1:"Gerado V1",WORLD_TYPE_SMALL:"Pequeno",DLG_GENERATE_TOKENS_TITLE:"Gerar tokens",ERR_INVALID_BP_ID:"ID de planta inválido",ERR_INVALID_PHOTO_ID:"ID de foto inválido",ERR_PROP_FAR_AWAY:"{val} demasiado longe",ERR_PROP_MISSING:"{val} em falta",LBL_BUILD_BLUEPRINT:"Construir/Planta",LBL_CHARACTER:"Personagem",LBL_CONTAINER:"Contentor",LBL_FRIENDS:"Amigos",LBL_INVENTORY_CHARACTER:"Inventário/Personagem",LBL_QUICKSLOT:"Quick-Slot",LBL_SETTINGS:"Definições",LBL_WAYGATE:"Waygate",LBL_WORLD_INFO:"Informações do mundo",PAGETITLE_BLUEPRINT:"{val} (Planta)",DLG_API_ACCESS_MSG:"Um mod em {val} está a pedir acesso. O acesso persistirá até atualizar a página. Permitir?",DLG_API_ACCESS_TITLE:"Acesso de API Mod",BTN_CONTROLLING_CAMERA:"A controlar: câmara",BTN_CONTROLLING_PLAYER:"A controlar: jogador",BTN_EXIT_PHOTO_MODE:"Sair do modo de foto",BTN_HIDE_SELF:"Ocultar-se",BTN_RETAKE_PHOTO:"Retomar",BTN_SAVE_PHOTO:"Guardar fotografia",BTN_SHOW_SELF:"Mostrar-se",CHATERROR_COPY_NOT_SUPPORTED:"Copiar para a área de transferência não suportado: ({val})",DLG_ERROR_TAKING_PHOTO_TITLE:"Erro ao tirar foto",DLG_SAVING_PHOTO_TITLE:"A guardar foto",ERR_COULD_NOT_COMPRESS:"Não foi possível comprimir para um tamanho válido.",ERR_WG_DEFAULT_VOXELS:"As imagens de Waygate devem usar pacotes voxel padrão",LBL_CONFIRM_WG_IMAGES:"Confirmar imagens de Waygate",LBL_FIELD_OF_VIEW_SHORT:"FOV",LBL_PHOTO_TAKEN:"Foto tirada",LBL_TIME_OF_DAY_SHORT:"Hora",STATUSMSG_CLICK_TAKE_PHOTO:"Clique para tirar uma foto",LBL_CREATED:"Criado",LBL_LOCATION:"Local",PHOTOMSG_ID_INVALID:"Identificação com foto inválida",PHOTOMSG_LOADING:"Dados de foto a carregar...",PHOTOTITLE_AUTHOR:"Foto de {val}",PHOTOTITLE_ERROR:"Foto (Erro)",PHOTOTITLE_LOADING:"Foto (A carregar...)",DLG_ARE_YOU_SURE_TITLE:"Tem a certeza?",DLG_ENTER_NEW_VALUE_MSG:"Insira um novo valor para {val}",DLG_INVALID_VALUE_INSERTED_MSG:"O valor inserido é inválido.",LBL_PROPERTY_EDITOR:"Editor de Propriedades",STATUSMSG_SAVE_FAILED:"Falha ao guardar.",STATUSMSG_SAVE_FAILED_NO_PROP:"Falha ao guardar. Adereço não encontrado.",DLG_CHANGING_NAME_WILL_RESET_MSG:"Alterar o nome irá repor todas as pontuações guardadas nesta bandeira.",DLG_COURSE_GOAL_NAME_MSG:"Insira o nome para o curso desta bandeira.",DLG_COURSE_START_NAME_MSG:"Insira o nome para o curso desta campainha.",DLG_ENTER_SIGN_TEXT_MSG:"Insira uma mensagem para mostrar no sinal.",DLG_START_OTHER_RACE_MSG:"Quer começar esta corrida e abandonar a anterior?",DLG_SUBMITTING_SCORE_TITLE:"A submeter pontuação",FORMAT_BUZZER_SCORE:"{val} - {val_2}",LBL_COURSE_FINISH:"Fim do curso",LBL_COURSE_NAME:"Nome do curso",LBL_COURSE_START:"Início do curso",LBL_SIGN_TEXT:"Texto do sinal",MSG_SIGN_DEFAULT_TEXT:"Olá!",STATUSMSG_ASSIGN_BUZZER_NAME:"Interaja enquanto mantém pressionada a Campainha de início de corrida para atribuir um nome.",STATUSMSG_ASSIGN_FLAG_NAME:"Interaja enquanto segura a Bandeira da meta de corrida para atribuir um nome.",STATUSMSG_EXHAUSTED_TO_USE_BUCKET:"Está demasiado exausto para usar o balde de água",STATUSMSG_MINE_PROP_FULL:"Não é possível destruir o adereço: esvazie o conteúdo primeiro",STATUSMSG_MINE_PROP_NAMED:"Não é possível destruir o adereço: apague o nome primeiro",STATUSMSG_MINE_WG_LINKED:"Não é possível destruir o Waygate: remova o ID primeiro",STATUSMSG_RACE_RESTARTED:"Corrida atual reiniciada!",STATUSMSG_REMOVE_SPOTLIGHT_TO_EDIT:"Remova o destaque da Bandeira antes de editar.",DLG_EQUIPMENT_SLOTS_MSG:"As Ferramentas de Recolha devem ser colocadas nos seus Slots de Equipamento (à direita do seu personagem), e não na Barra Rápida, para serem usadas automaticamente.",DLG_EQUIPMENT_SLOTS_TITLE:"Utilizar Slots de Equipamento",ERR_NOT_IN_WORLD:"Não está atualmente num mundo",LBL_BRUSH_MODE_FLIPPED:"Invertido",LBL_GATHERING_TOOLS:"Ferramentas de Recolha",STATUSMSG_LIGHT_MINI_KB:"Prima {val} para tirar a sua lanterna.",STATUSMSG_LIGHT_MINI_TOUCH:"Toque na lanterna para acender a luz.",STATUSMSG_LIGHT_NOSLOT_KB:"Pressione {val} ou use {val_2} para começar a construir uma tocha.",STATUSMSG_LIGHT_NOSLOT_TOUCH:"Mantenha pressionado um slot da Barra Rápida ou use o menu Construir para começar a construir uma tocha.",STATUSMSG_LIGHT_SLOT_KB:"Prima {val} ou selecione uma luz na Barra Rápida.",STATUSMSG_LIGHT_SLOT_TOUCH:"Selecione uma tocha ou lanterna na Barra Rápida.",STATUSMSG_WOOD_FOR_TORCH:"A madeira é necessária para construir uma tocha",TLTP_CHANGE_BRUSH:"Alterar o tamanho da escova",TLTP_EMPTY_SLOT:"(Slot vazio)",TLTP_LOW_DURABILITY:"Baixa durabilidade no seu {val}",TLTP_QBAR_FLIP:"Inverter",TLTP_QBAR_UNBIND:"Desvincular",TLTP_QUICKSLOT_ITEM:"Quick-slot de item",TLTP_RECENT_ITEM:"(Item recente)",TLTP_RECENT_ITEM_EXISTING:"{val} (item recente)",TLTP_SELECT_LANTERN_OR_TORCH:"Selecionar lanterna ou tocha",TLTP_SWAP_TO_GATHERING:"Trocar para Ferramentas de Recolha",TLTP_SWAP_TO_RECENT:"Trocar para item recente",TLTP_TOGGLE_LANTERN:"Alternar lanterna",TLTP_TOOL_IN_HAND:"{val} (na mão)",BTN_SPOTLIGHT_SCORE:"Pontuação de destaque",FORMAT_RANK_NUMBER:"{val}.",LBL_RACE_RESULTS:"Resultados da corrida",LBL_WORLD_INFO_MENU:"Menu de informações do mundo",RACERESULTS_ALL_SCORES:"Todas as pontuações ({val})",RACERESULTS_NEW_BEST:"Nova melhor pontuação!",RACERESULTS_NO_RANK:"Sem classificação",RACERESULTS_YOUR_SCORE:"A sua pontuação",TLTP_SPOTLIGHT_SCORE:"Mostre estes resultados em {val} para qualquer pessoa neste mundo",BTN_ABANDON_RACE:"Abandonar?",DLG_LEAVE_RACE_MSG:"Quer abandonar a sua atual tentativa de corrida?",LBL_READY_TIME:"Pronto",REDDOT_NEW:"Novo!",BTN_AA_OFF:"Antialiasing: desativado",BTN_AA_OFF_PENDING:"Antialiasing: (desativado)",BTN_AA_ON:"Antialiasing: ativado",BTN_AA_ON_PENDING:"Antialiasing: (Ativado)",BTN_BUGS_FEEDBACK:"Bugs/Feedback",BTN_BUILD_INTEGRATED:"Menu de Construção: integrado",BTN_BUILD_SEPARATE:"Menu de Construção: separado",BTN_CAMERA_FP:"Câmara de primeira pessoa",BTN_CAMERA_TP:"Câmara de terceira pessoa",BTN_CHAT_KEEP_FOCUS:"Chat: manter foco",BTN_CHAT_UNFOCUS:"Chat: desfocar automaticamente",BTN_EXIT_FULLSCREEN:"Fechar ecrã inteiro",BTN_FAST:"Rápido",BTN_FLY_ALT_LOCKED:"Voo: bloqueado por altitude",BTN_FLY_RELATIVE:"Voo: relativo",BTN_FULLSCREEN:"Ecrã inteiro",BTN_FULLSCREEN_KEY:"Ecrã inteiro ({val})",BTN_LAYOUT_AUTO:"Esquema: auto",BTN_LAYOUT_TALL:"Esquema: alto",BTN_LAYOUT_WIDE:"Esquema: largo",BTN_MAX_JUMP_HOLD:"Salto máximo: manter",BTN_MAX_JUMP_TAP:"Salto máximo: tocar",BTN_ORIENTATION:"Orientação",BTN_PRETTY:"Bonito",BTN_QBAR_LEFT:"Barra rápida: esquerda",BTN_QBAR_RIGHT:"Barra rápida: direita",BTN_QBAR_TOP:"Barra rápida: cima",BTN_RESET_INVENTORY:"Repor inventário",BTN_RESET_TUTORIAL:"Repor tutorial",BTN_SHADERS_MEH:"Shaders: meh.",BTN_SHADERS_SHINY:"Shaders: brilhante!",BTN_SHOW_CONTROLS:"Mostrar controlos",BTN_UIS_INTEGRATED:"UI de interação: integrado",BTN_UIS_SEPARATE:"UI de interação: separado",CONTROLS_BUILD_MENU:"Menu de Construção",CONTROLS_CHAT:"chat",CONTROLS_CYCLE_SIZES:"percorrer tamanhos/modos de pincel",CONTROLS_DOUBLE_JUMP:"Toque duas vezes em saltar ({val}) para voar, se disponível",CONTROLS_FLY_DOWN:"voar para baixo",CONTROLS_FORMAT_AGAIN:"{val} novamente",CONTROLS_FORMAT_DESC:"{val} - {val_2}",CONTROLS_FORMAT_OR:"{val} ou {val_2}",CONTROLS_FULLSCREEN:"alternar para ecrã inteiro",CONTROLS_INV_MENU:"menu de inventário",CONTROLS_JUMP_FLY:"saltar/voar para cima",CONTROLS_MOVE:"mover",CONTROLS_OPEN_MENU:"abrir menu",CONTROLS_PHOTO_MODE:"modo de foto",CONTROLS_PICK:"escolher item",CONTROLS_PLACE_DESTROY:"colocar item, destruir blocos; arraste para colocar vários",CONTROLS_QUICK_SLOT:"Slot rápido de um item",CONTROLS_SCROLL_QBAR:"barra rápida de deslocamento",CONTROLS_SECTION_BUILDING:"A construir",CONTROLS_SECTION_MOVEMENT:"Movimento",CONTROLS_SECTION_OTHER:"Outro",CONTROLS_SELECT_QBAR:"selecionar item na barra rápida",CONTROLS_SOCIAL_MENU:"menu social",CONTROLS_SPRINT:"sprint",CONTROLS_TOGGLE_GATHERING:"alternar entre ferramentas de recolha e item recente",CONTROLS_TOGGLE_HUD:"alternar HUD",CONTROLS_TOGGLE_VIEW:"alternar a visualização em primeira/terceira pessoa; desloque enquanto pressionado para aumentar/diminuir o zoom",CONTROLS_TORCH:"tocha",CONTROLS_UNLOCK_MOUSE:"desbloquear cursor do rato",CONTROLS_WORLD_MENU:"menu de informações do mundo",DLG_AA_CHANGED_QUIT_MSG:"Alterar o antialiasing requer reiniciar a aplicação, sair agora?",DLG_AA_CHANGED_RESTART_MSG:"Alterar o antialiasing requer reiniciar a aplicação, reiniciar agora?",DLG_AA_CHANGED_TITLE:"Antialiasing alterado",DLG_CONTROLS_TITLE:"Controlos",DLG_RESET_INV_MSG:"Isto irá redefinir o seu inventário para o estado inicial/em branco. Continuar mesmo?",DLG_RESET_INV_TITLE:"Repor inventário",LBL_CAMERA_DISTANCE:"Distância da câmara",LBL_CONTROLS:"Controlos",LBL_DEBUG:"Depurar",LBL_GRAPHICS:"Gráficos",LBL_INTERFACE:"Interface",LBL_LOOK_SENSITIVITY:"Sensibilidade de olhar",LBL_MOUSE_SENSITIVITY:"Sensibilidade do rato",LBL_PRESET:"Predefinição",LBL_RENDERER:"Renderização",LBL_RESOLUTION_SCALE:"Escala de resolução",LBL_VIEW_DISTANCE:"Distância de visualização",BTN_UNLOCK_LETS_SEE:"Vamos ver!",BTN_UNLOCK_MORE1:"E também...",BTN_UNLOCK_MORE2:"E?",BTN_UNLOCK_MORE3:"Próximo...",BTN_UNLOCK_MORE4:"E que mais?",BTN_UNLOCK_MORE5:"Mais?",LBL_ADDITIONAL_CONTRIBUTORS:"Contribuidores adicionais",LBL_FIRST_UPGRADE:"Primeira atualização",LBL_NEXT_TIER:"Próximo escalão",LBL_OPTIONAL_UPGRADES:"Upgrades opcionais",LBL_SETTLEMENT_SIZE:"Tamanho da Povoação",LBL_SETTLEMENT_UNLOCK:"Desbloqueio de Povoação!",LBL_SIZE:"Tamanho",LBL_TIER_NUMBER:"Escalão {val}",LBL_UNLOCKED:"Desbloqueado",LBL_UNLOCKED_INDUSTRY:"Indústria desbloqueada",LBL_UNLOCKED_TIER:"Escalão Desbloqueado {val}",LBL_UNLOCKS:"Desbloqueia",LBL_UNLOCKS_INDUSTRY:"Desbloqueia a indústria",SETTLEMENT_DRAG_ITEMS:"DICA: arraste os itens do seu inventário abaixo para o slot de requisito para desbloquear upgrades.",SETTLEMENT_FIRST_INCREASE_TIER:"Primeiro, aumente o seu Escalão de Povoação para abrir mais opções de upgrade.",SETTLEMENT_NO_OPT_UPGRADES:"Não há upgrades opcionais disponíveis",SETTLEMENT_RADIUS_ADD:"Os limites da sua Povoação são expandidos em {val} em todas as direções.",SETTLEMENT_UNLOCKED_AFTER_CREATION:"{val} desbloqueado após a criação do mundo",SETTLEMENT_UNLOCKED_JUST_NOW:"Desbloqueado agora mesmo por {val}",SETTLEMENT_UNLOCKED_TIME_AGO:"Desbloqueado há {val} por {val_2}",SETTLEMENT_VISIT_WG_IN_WORLD:"Visite o Waygate no mundo para gerir esta Povoação",SETTLEMENT_WG_UNLOCK:"O Waygate cresce em potência e concede capacidades expandidas à sua Povoação.",LBL_SHARE_MENU:"Menu Partilhar",STATUSMSG_PHOTO_SAVED:"Foto guardada.",SOCIAL_BLOCKED_NUMBER:"Utilizadores bloqueados ({val})",SOCIAL_FRIENDS_NUMBER:"Amigos ({val})",CHATERROR_STUCK_LESS_MINUTE:"Deve esperar pelo menos um minuto antes de executar {val} novamente",CHATERROR_STUCK_NOT_ADMIN:"Deve ser um administrador ou proprietário para usar {val} em mundos {val_2}",CHATERROR_STUCK_TRY_WAYGATE:"Deve ter tentado usar um Waygate (nos últimos 2 minutos) para se desprender",LBL_BUILD:"Construir",LBL_CRAFT:"Criar",LBL_UNLOCK:"Desbloquear",STATUSMSG_ADDED_TASK:"{val} adicionado à Lista de Tarefas",STATUSMSG_CANNOT_REMOVE_TUTORIAL_TASK:"Não é possível remover a tarefa de tutorial da Lista de Tarefas",STATUSMSG_REMOVED_TASK:"{val} removido da Lista de Tarefas",TODO_ADD_PIN:"Adicionar isto à sua Lista de Tarefas fixada",TODO_READY:"Pronto!",TODO_REMOVE_PIN:"Remover isto da sua Lista de Tarefas fixada",STATUSMSG_UNKNOWN_USERATTRIB:'Removido {val} desconhecido "{val_2}"',BTN_ADD_FRIEND:"Adicionar à lista de amigos",BTN_BLOCK_USER:"Bloquear utilizador",BTN_KICK_FROM_WORLD:"Chutar",BTN_REMOVE_FRIEND:"Remover da lista de amigos",BTN_UNBLOCK_USER:"Desbloquear utilizador",FRIENDLIST_FB_FRIEND:"Este utilizador é seu amigo no Facebook",FRIENDLIST_USER_IS_ADDED:"Este utilizador está na sua lista de amigos",LBL_ADMIN_ACTIONS:"Ações de administrador",LBL_CHANGE_ACCESS:"Alterar acesso",LBL_CURRENT_ACCESS:"Acesso atual",LBL_DEFAULT:"Padrão",PRESENCE_ALSO_IDLE:"{val} (Inativo)",PRESENCE_BUILDING:"A construir",PRESENCE_IN_MENUS:"Em menus",PRESENCE_LOST_FRONTIER:"Lost Frontier",PRESENCE_OFFLINE:"Offline",PRESENCE_UNKNOWN:"Desconhecido",PRESENCE_VIEWING:"A ver",USERINFO_LOADING:"A carregar dados...",USERINFO_MY_FRIEND_FB:'O meu amigo "{val}" no Facebook',USERINFO_THIS_ME:"Sou eu!",USERINFO_USER_BLOCKED:"Este utilizador está bloqueado e não verá o seu estado",STATUSMSG_ORPHANED_TILEPROP:"Encontrado órfão {val}, a limpar...",STATUSMSG_PROP_WOUT_TILEPROP:"Encontrado adereço sem {val}, a limpar...",BTN_ADD_NEW_TARGET:"Adicionar novo destino",BTN_ASSIGN_WGID:"Atribuir ID de Waygate",BTN_CHANGE:"Alterar",BTN_NOT_AVAILABLE:"Indisponível",BTN_REMOVE_WGID:"Remover ID de Waygate",BTN_SET:"Definir",BTN_SET_DEFAULT_SETTLE_WG:"Definir como Povoação/Waygate padrão",BTN_SET_DEFAULT_WG:"Definir como Waygate padrão",DLG_ASSIGN_WGID_ALREADY_MSG_CONFIRM:'O ID de Waygate "{val}" já está em uso por outro Waygate. Deseja mesmo reatribuir este ID de Waygate a ESTE Waygate?',DLG_ASSIGN_WGID_ALREADY_MSG_LINKS:"Nota: todos os links para o ID de Waygate especificado agora vão para este Waygate.",DLG_ASSIGN_WGID_DEF_MSG_CONFIRM:"Alterar o Waygate padrão fará com que todos os novos visitantes cheguem a este Waygate (a menos que sigam um link para outro Waygate específico). Deseja mesmo alterar o Waygate padrão?",DLG_ASSIGN_WGID_DEF_MSG_SCREENSHOT:"Nota: definir este Waygate como o Waygate padrão permitirá que configure uma captura de ecrã padrão para todos os links para este Mundo.",DLG_ASSIGN_WGID_TITLE:"Atribuir ID de Waygate",DLG_ERROR_ASSIGNING_WG_TITLE:"Erro ao atribuir ID de Waygate",DLG_ERROR_EDITING_WG_TITLE:"Erro ao editar Waygate",DLG_ERROR_REMOVING_WGID_TITLE:"Erro ao remover ID de Waygate",DLG_ERROR_RENAMING_WG_TITLE:"Erro ao renomear Waygate",DLG_ERROR_SETTING_WG_IMG_TITLE:"Erro ao definir imagem de Waygate",DLG_INVALID_WORLD_ID_TITLE:"ID de mundo inválido",DLG_LINKABLE_WGID_MSG:"Insira um identificador para este Waygate. Os ID de Waygate podem ter até 16 carateres e podem conter apenas letras minúsculas (a-z), números (0-9) e sublinhados (_). Devem ser únicos neste Mundo.",DLG_LINKABLE_WGID_TITLE:"Atribuir ID de Waygate passível de link",DLG_REMOVE_WGID_MSG:"Remover o ID de Waygate fará com que quaisquer links para este Waygate tenham como destino o Waygate padrão deste Mundo. Se reatribuir este ID de Waygate a um Waygate diferente, essas ligações irão apontar para o novo Waygate. Tem a certeza de que pretende remover este ID de Waygate?",DLG_REMOVE_WGID_TITLE:"Remover ID de Waygate",DLG_WAYGATE_TARGET_MSG:"Insira um ID de Mundo ou clique em Atual para selecionar o mundo ativo",DLG_WAYGATE_TARGET_TITLE:"Waygate de destino",DLG_WG_NAME_MSG:"Insira um nome para este Waygate",DLG_WG_NAME_TITLE:"Nome de Waygate",ERR_INVALID_WGID:"ID de Waygate inválido",ERR_WAYGATE_DISAPPEARED:"O Waygate desapareceu, não é possível aplicar a alteração",LBL_DEFAULT_WAYGATE:"Waygate padrão",LBL_ENERGY_WELL_STATUS:"Estado do Poço de Energia",LBL_ENTRYWAY:"Entrada",LBL_EXITWAY_TARGETS:"Destinos de saída",LBL_LISTED:"Listado",LBL_MINE:"Meu",LBL_OTHER:"Outro",LBL_RECENT:"Recente",LBL_SCREENSHOT:"Captura de ecrã",LBL_SETTLEMENT_MNG:"Gestão de Povoação",LBL_SHOW_WORLD_INFO:"Mostrar informações do mundo",LBL_THIS_WORLD:"Este mundo",LBL_UNKNOWN_MENU:"Menu desconhecido",LBL_WAYGATE_ID:"ID de Waygate",LBL_WAYGATE_TARGETS:"Destinos de Waygate",LBL_WG_AND_SETTLEMENT_MNG:"Gestão de Waygate e Povoação",LBL_WG_CONFIGURATION:"Configuração de Waygate",STATUSMSG_DRINKING_WELL:"A beber do Poço de Energia ({val}s)...",STATUSMSG_WAYGATING_CHOICES:"A usar Waygate (com opções) ({val}s)...",STATUSMSG_WAYGATING_TO:"A usar Waygate para {val} ({val_2}s)...",STATUSMSG_WELL_RECHARGING:"O Poço de Energia continua a recarregar ({val}s)",STATUSMSG_WG_IMG_SAVED:"Imagem de Waygate guardada.",WGLINK_FROZEN:"Congelado",WGLINK_FULL:"Cheio",WGLINK_LOADING:"A carregar...",WGLINK_NOT_FOUND:"Waygate não encontrado",WGTARGET_EXITWAY_LOADING:"(a carregar...)",WGTARGET_INVALID_WORLD_ID:"ID de mundo inválido: {val}",WGUI_DEFAULT_WG_CANNOT_EXITWAY:"O Waygate padrão não pode funcionar como Saída.",WGUI_ENERGY_WELL_REMOTE_SUBTITLE:"Visite para reabastecer {val}",WGUI_ENERGY_WELL_SUBTITLE:"Reabastecer {val} aqui",WGUI_ENTRYWAY_REQUIREMENT:"Este Waygate requer um ID para ser uma Entrada",WGUI_LF_WG_EXITWAY_FUTURE:"As Saídas de Waygate Lost Frontier chegarão numa futura atualização...",WGUI_LISTED_WG_LINKED:"Os Waygates listados podem ser ligados por qualquer pessoa, por URL ou outro Waygate, e são mostrados no ecrã de Informações do Mundo.",WGUI_MUST_VISIT_EDIT_EXITWAY:"Deve visitar o Waygate no mundo para editar os Destinos de Saída",WGUI_NEW_WAYGATE:"Novo Waygate",WGUI_REMOVE_WG_TARGET:"Remover destino de Waygate",WGUI_SETTLEMENT_MNG_SUBTITLE:"Deposite recursos no Waygate para expandir e melhorar",WGUI_SETTLE_CANNOT_EXITWAY:"Um Waygate de Povoação não pode funcionar como Saída.",WGUI_THIS_IS_DEFAULT_WG:"Este é o Waygate Padrão. Para removê-lo, primeiro defina um Waygate diferente como Padrão.",WGUI_UNKNOWN_WAYGATE:"Waygate desconhecido {val}",WGUI_UNLIMITED_HINT_1:"Dica: as pessoas que entram no seu mundo terão a mesma",WGUI_UNLIMITED_HINT_2:"direção que a sua quando coloca o Waygate!",WGUI_WG_ADVENTURE_HINT_1:"Dica: pode construir um novo Waygate e mover o seu",WGUI_WG_ADVENTURE_HINT_2:"poder de Povoação para lá até uma vez por dia!",WGUI_WG_IN_WORLD:"{val} em {val_2}",WGUI_WG_IS_SETTLEMENT:"Este Waygate define uma Povoação e os benefícios da mesma.",CHATERROR_ACCESSING_WAYGATE:"Erro ao aceder ao Waygate {val}: {val_2}",CHATERROR_ACCESS_REVOKED:"Acesso revogado",CHATERROR_GROUP_RACE_START:"Erro no início de corrida de grupo",CHATERROR_RUNNING_COMMAND:"Erro ao executar /{val}: {val_2}",CHATUI_ADMIN_MSG:"[admin] {val}",DLG_JOINING_WORLD_FAILED_TITLE:"Falha em aderir ao Mundo",DLG_RACE_SAVE_ERROR_TITLE:"Erro ao guardar corrida",DLG_RUN_ELEVATE_MSG:"(Admin) Execute/Eleve para ignorar as permissões.",DLG_WORLD_ACCESS_DENIED_MSG:"Acesso negado. Este mundo não é público e requer um token de acesso, ou que o proprietário adicione o seu ID de utilizador ({val}).",DLG_WORLD_FULL_MSG:"Mundo cheio. No momento, este mundo está cheio. Tente novamente mais tarde.",STATUSMSG_CANT_JOIN_NOT_CONNECTED:"Não é possível aderir ao mundo: não está ligado ao servidor",STATUSMSG_GEM_FOUND:"Encontrou 1{val} joia!",STATUSMSG_GROUP_RACE_CANCELLED:"A corrida de grupo atual foi cancelada!",STATUSMSG_GROUP_RACE_START:"Uma corrida de grupo acabou de começar!",STATUSMSG_GROUP_RACE_START_SECONDS:"Uma corrida de grupo começará em {val} segundos!",STATUSMSG_GROUP_RACE_WON_BY_OTHER:"{val} ganhou a corrida de grupo com um tempo de {val_2}!",STATUSMSG_GROUP_RACE_WON_BY_YOU:"Ganhou a corrida de grupo! Parabéns!",STATUSMSG_ORPHANED_PROP:"Encontrado um adereço órfão sem TILE_PROP, a limpar...",STATUSMSG_OUT_OF_SYNC:"Mundo não sincronizado, a ressincronizar...",STATUSMSG_RACE_ABANDON_ERROR:"Erro de abandono da corrida: {val}",STATUSMSG_RACE_NO_MULTIPLE_CLIENTS:"As corridas não podem ser iniciadas em mundos que permitem vários clientes.",STATUSMSG_RACE_SINGLE_CLIENT_ENABLE:'Execute "/world_single_client 1" para ativar um único cliente por utilizador neste mundo.',STATUSMSG_RACE_START_ERROR:"Erro no início da corrida: {val}",STATUSMSG_TRANSACTION_FAILED:"A transação falhou: {val}",BTN_DELETE_WORLD:"Eliminar",BTN_DONE_EDITING:"Feito",BTN_EDIT_WG_INFORMATION:"Editar informações de Waygate",BTN_EDIT_WORLD_SETTINGS:"Editar definições de Mundo",BTN_EXIT_WORLD:"← Sair do Mundo",BTN_FORGET_WORLD:"Esquecer",BTN_IM_STUCK:"Estou preso!",BTN_JOIN_WORLD:"Aderir",BTN_PLAYING_AS_SELF:"Jogar como: eu",BTN_PLAYING_AS_VISITOR:"Jogar como: visitante",BTN_SETTLEMENT_INFO:"Informações de Povoação",BTN_WAYGATE_GO:"Ir",DLG_DELETE_WORLD_MSG:"Tem a certeza que deseja eliminar {val} ({val_2})?",DLG_DELETE_WORLD_TITLE:"Eliminar Mundo",DLG_ERR_LOST_CONNECTION_MSG:"Não foi possível processar o pedido: perda de ligação ao mundo",DLG_ERR_LOST_CONNECTION_TITLE:"Ligação perdida",DLG_ERR_MODIFYING_WORLD_TITLE:"Erro ao modificar o mundo",DLG_FORGET_WORLD_MSG:"Tem a certeza de que pretende remover {val} ({val_2}) da sua lista recente?",DLG_FORGET_WORLD_TITLE:"Esquecer Mundo",DLG_WG_TRAVEL_NOT_ALLOWED_MSG:"Neste momento, está à espera do início de uma corrida de grupo. A viagem por Waygate irá cancelar a sua corrida atual. Tem a certeza de que deseja continuar?",DLG_WG_TRAVEL_NOT_ALLOWED_TITLE:"Viagem por Waygate não permitida",DLG_WG_TRAVEL_UNSAFE_MSG:"Ainda não recuperou do uso anterior de Waygate. Viajar por Waygate novamente tão cedo resultará em Doença de Waygate temporária ({val} reduzido). Tem a certeza de que deseja continuar?",DLG_WG_TRAVEL_UNSAFE_TITLE:"Viagem por Waygate atualmente insegura",DLG_WORLD_NAME_MSG:"Introduza um novo nome para o seu mundo",FORMAT_NUMBER_MILLION:"{val}M",FORMAT_NUMBER_THOUSAND:"{val}Mil",FORMAT_READY_WG_TIME:"({val})",FORMAT_ROLE_DISPLAY:"[{val}]",LBL_ACCESS_ADMIN_LONG:"Admin (pode conceder acesso, etc.)",LBL_ACCESS_BUILDER_LONG:"Construtor (pode construir)",LBL_ACCESS_DEFAULT:"Padrão",LBL_ACCESS_NONE:"Nenhum",LBL_ACCESS_NONE_BAN:"Nenhum (banimento)",LBL_ACCESS_NONE_LONG:"Sem acesso",LBL_ACCESS_NONE_NOBODY:"Ninguém",LBL_ACCESS_OWNER:"Proprietário",LBL_ACCESS_OWNER_CREATOR:"Criador",LBL_ACCESS_PRESET:"Predefinição de acesso",LBL_ACCESS_PRESET_PRIVATE:"Privado",LBL_ACCESS_PRESET_PRIVATE_LONG:"Este mundo é privado",LBL_ACCESS_PRESET_SPECTATE:"Qualquer um pode assistir",LBL_ACCESS_PRESET_VISIT:"Qualquer um pode visitar",LBL_ACCESS_READONLY:"Visitante",LBL_ACCESS_READONLY_LONG:"Visitante (tem avatar)",LBL_ACCESS_SPECTATOR:"Espectador",LBL_ACCESS_SPECTATOR_ANYONE:"Qualquer um",LBL_ACCESS_SPECTATOR_LONG:"Espectador (pode ver, mas está invisível)",LBL_CHAT:"Chat",LBL_FLYING:"Voar",LBL_MORE_ACCESS_OPTIONS:"Mais opções de acesso",LBL_OFFLINE_USERS:"Offline",LBL_PLACE_BLUEPRINTS:"Colocar plantas",LBL_SHOW_OTHER_PLAYERS:"Mostrar outros jogadores",LBL_TIME_AFTERNOON:"Tarde",LBL_TIME_DAWN:"Amanhecer",LBL_TIME_DUSK:"Crepúsculo",LBL_TIME_DYNAMIC:"Dinâmico",LBL_TIME_MIDNIGHT:"Meia-noite",LBL_TIME_MORNING:"Manhã",LBL_TIME_NOON:"Meio-dia",LBL_TIME_OF_DAY:"Hora do dia",LBL_USER_DISTANCE_FAR:"Longe",LBL_USER_DISTANCE_MEDIUM:"Médio",LBL_USER_DISTANCE_NEAR:"Perto",LBL_USER_DISTANCE_UNLIMITED:"Ilimitado",LBL_WAYGATES:"Waygates",LBL_WHO_IS_HERE:"Quem está aqui ({val})",LBL_WORLD_SETTINGS:"Definições de Mundo",STATUSMSG_PLAYING_AS_VISITOR:"A jogar como Visitante só de leitura",TLTP_DONE_EDITING:"Concluir a edição",TLTP_RENAME_WORLD:"Renomear Mundo",WORLDINFO_ANYONE_BUILD_WARNING:"Aviso: qualquer pessoa na Internet pode participar e construir no seu mundo a qualquer momento. Não utilize esta opção se valoriza aquilo que está a construir.",WORLDINFO_ASSIGNED_ROLES:"{val} das {val_2} funções de construtor/administrador atribuídas",WORLDINFO_LOADING:"A carregar informações de Mundo...",WORLDINFO_LOADING_ERROR:"Erro ao carregar informações do mundo: {val}",WORLDINFO_NO_WG_FOUND:"Nenhum Waygate encontrado",WORLDINFO_SAFE_WG_TRAVEL:"Viagem segura por Waygate pronta!",WORLDINFO_THIS_IS_MY_WORLD:"Este é o meu mundo",WORLDINFO_WG_TRAVEL_UNSAFE:"Viagem por Waygate atualmente insegura",WORLDINFO_YOU_ARE_ADMIN:"É um administrador",TILES_GRASS_NAME:"Terra (relva)",TILES_GRASS_NAME_BLOCK:"Bloco de relva",TILES_DIRT_NAME:"Terra",TILES_DIRT_NAME_BLOCK:"Bloco de terra",TILES_DIRT_INFO:"Pode ser recolhido de Blocos de Relva ou Blocos de Terra com uma pá ou as ferramentas brutas com as quais começa.",TILES_STONE_NAME:"Pedra",TILES_STONE_NAME_BLOCK:"Bloco de pedra",TILES_STONE_INFO:"Pode ser recolhido de Blocos de Pedra com uma picareta ou as ferramentas brutas com que começa. Os Blocos de Pedra podem ser encontrados no subsolo ou na superfície.",TILES_ORE_IN_STONE_LIGHT_NAME:"Minério de Metal em Pedra Clara",TILES_ORE_IN_STONE_LIGHT_NAME_BLOCK:"Minério de Metal em Pedra Clara",TILES_ORE_IN_STONE_NAME:"Minério de Metal em Pedra",TILES_ORE_IN_STONE_NAME_BLOCK:"Minério de Metal em Pedra",TILES_ORE_IN_STONE_DARK_NAME:"Minério de Metal em Pedra Escura",TILES_ORE_IN_STONE_DARK_NAME_BLOCK:"Minério de Metal em Pedra Escura",TILES_ORE_IN_STONE_RED_NAME:"Minério de Metal em Pedra Vermelha",TILES_ORE_IN_STONE_RED_NAME_BLOCK:"Minério de Metal em Pedra Vermelha",TILES_ORE_IN_VEINIUM_NAME:"Minério de Metal em Veinium",TILES_ORE_IN_VEINIUM_NAME_BLOCK:"Minério de Metal em Veinium",TILES_VEINIUM_NAME:"Veinium",TILES_VEINIUM_NAME_BLOCK:"Veinium",TILES_VEINIUM_INFO:"Contém vestígios de metais que indicam que pode haver minério nas proximidades.",TILES_COAL_NAME:"Carvão",TILES_COAL_NAME_BLOCK:"Bloco de Carvão",TILES_WOOD_NAME:"Madeira",TILES_WOOD_NAME_BLOCK:"Bloco de Madeira",TILES_WOOD_INFO:"Pode ser recolhido a partir de Blocos de Madeira com um machado ou as ferramentas brutas com que começa. As florestas podem ser encontradas procurando manchas mais escuras ao longe.",TILES_PLANKS_WOOD_NAME:"Pranchas de Madeira",TILES_PLANKS_WOOD_NAME_BLOCK:"Bloco de Pranchas de Madeira",TILES_PLANKS_WOOD_INFO:"Útil para construir muitas coisas, como Baús, encontrado na secção Adereços do menu de construção.",TILES_WOOD_LIGHT_NAME:"Madeira Clara",TILES_WOOD_LIGHT_NAME_BLOCK:"Bloco de Madeira Clara",TILES_WOOD_LIGHT_INFO:"Pode ser recolhido a partir de Blocos de Madeira Clara com um machado ou as ferramentas brutas com que começa. As florestas podem ser encontradas procurando manchas mais escuras ao longe. A Madeira Clara é fácil de manusear.",TILES_PLANKS_WOOD_LIGHT_NAME:"Pranchas de Madeira Clara",TILES_PLANKS_WOOD_LIGHT_NAME_BLOCK:"Bloco de Pranchas de Madeira Clara",TILES_PLANKS_WOOD_LIGHT_INFO:"Útil para construir muitas coisas, como Baús, encontrado na secção Adereços do menu de construção.",TILES_WOOD_DARK_NAME:"Madeira Escura",TILES_WOOD_DARK_NAME_BLOCK:"Bloco de Madeira Escura",TILES_WOOD_DARK_INFO:"Pode ser recolhido a partir de Blocos de Madeira Escura com um machado ou as ferramentas brutas com que começa. As florestas podem ser encontradas procurando manchas mais escuras ao longe. A Madeira Escura é pesada e duradoura.",TILES_PLANKS_WOOD_DARK_NAME:"Pranchas de Madeira Escura",TILES_PLANKS_WOOD_DARK_NAME_BLOCK:"Bloco de Pranchas de Madeira Escura",TILES_PLANKS_WOOD_DARK_INFO:"Útil para construir muitas coisas, como Baús, encontrado na secção Adereços do menu de construção.",TILES_WOOD_RED_NAME:"Madeira Vermelha",TILES_WOOD_RED_NAME_BLOCK:"Bloco de Madeira Vermelha",TILES_WOOD_RED_INFO:"Pode ser recolhido a partir de Blocos de Madeira Vermelha com um machado ou as ferramentas brutas com que começa. As florestas podem ser encontradas procurando manchas mais escuras ao longe. A Madeira Vermelha é bastante duradoura.",TILES_PLANKS_WOOD_RED_NAME:"Pranchas de Madeira Vermelha",TILES_PLANKS_WOOD_RED_NAME_BLOCK:"Bloco de Pranchas de Madeira Vermelha",TILES_PLANKS_WOOD_RED_INFO:"Útil para construir muitas coisas, como Baús, encontrado na secção Adereços do menu de construção.",TILES_LEAVES1_NAME:"Folhas",TILES_LEAVES1_NAME_BLOCK:"Bloco de Folhas #1",TILES_LEAVES2_NAME:"Folhas",TILES_LEAVES2_NAME_BLOCK:"Bloco de Folhas #2",TILES_LEAVES3_NAME:"Folhas",TILES_LEAVES3_NAME_BLOCK:"Bloco de Folhas #3",TILES_LEAVES4_NAME:"Folhas",TILES_LEAVES4_NAME_BLOCK:"Bloco de Folhas #4",TILES_LEAVES5_NAME:"Folhas",TILES_LEAVES5_NAME_BLOCK:"Bloco de Folhas #5",TILES_PASSABLE_LEAVES_NAME:"Folhas",TILES_PASSABLE_LEAVES_NAME_BLOCK:"Bloco de Folhas para Passagem",TILES_TILLED_NAME:"Terra",TILES_TILLED_NAME_BLOCK:"Bloco de Terra Lavrada",TILES_TILLED_WATERED_NAME:"Terra",TILES_TILLED_WATERED_NAME_BLOCK:"Bloco de Terra Regada e Lavrada",TILES_SNOW_NAME:"Neve",TILES_SNOW_NAME_BLOCK:"Bloco de Neve",TILES_SAND_NAME:"Areia",TILES_SAND_NAME_BLOCK:"Bloco de Areia",TILES_STONE_DARK_NAME:"Pedra Escura",TILES_STONE_DARK_NAME_BLOCK:"Bloco de Pedra Escura",TILES_STONE_DARK_INFO:"Pode ser recolhido de Blocos de Pedra Escura com uma picareta ou as ferramentas brutas com que começa. Os Blocos de Pedra Escura podem ser encontrados no subsolo ou na superfície.",TILES_STONE_LIGHT_NAME:"Pedra Clara",TILES_STONE_LIGHT_NAME_BLOCK:"Bloco de Pedra Clara",TILES_STONE_LIGHT_INFO:"Pode ser recolhido de Blocos de Pedra Clara com uma picareta ou as ferramentas brutas com que começa. Os Blocos de Pedra Clara podem ser encontrados no subsolo ou na superfície.",TILES_STONE_RED_NAME:"Pedra Vermelha",TILES_STONE_RED_NAME_BLOCK:"Bloco de Pedra Vermelha",TILES_STONE_RED_INFO:"Pode ser recolhido de Blocos de Pedra Vermelha com uma picareta ou as ferramentas brutas com que começa. Os Blocos de Pedra Vermelha podem ser encontrados no subsolo ou na superfície. Tal como a pedra vermelha na Terra, não tem nenhuma propriedade condutora.",TILES_GLASS_NAME:"Vidro",TILES_GLASS_NAME_BLOCK:"Bloco de Vidro",TILES_BRICK_CLAY_NAME:"Tijolos Vermelhos",TILES_BRICK_CLAY_NAME_BLOCK:"Bloco de Tijolos Vermelhos",TILES_BRICK_STONE_NAME:"Tijolos de Pedra",TILES_BRICK_STONE_NAME_BLOCK:"Bloco de Tijolos de Pedra",TILES_COLORED_HUE0_NAME:"Madeira Pintada de Vermelho",TILES_COLORED_HUE0_NAME_BLOCK:"Bloco de Madeira Pintada de Vermelho",TILES_COLORED_HUE1_NAME:"Madeira Pintada de Laranja",TILES_COLORED_HUE1_NAME_BLOCK:"Bloco de Madeira Pintada de Laranja",TILES_COLORED_HUE2_NAME:"Madeira Pintada de Amarelo",TILES_COLORED_HUE2_NAME_BLOCK:"Bloco de Madeira Pintada de Amarelo",TILES_COLORED_HUE3_NAME:"Madeira Pintada de Verde",TILES_COLORED_HUE3_NAME_BLOCK:"Bloco de Madeira Pintada de Verde",TILES_COLORED_HUE4_NAME:"Madeira Pintada de Azul",TILES_COLORED_HUE4_NAME_BLOCK:"Bloco de Madeira Pintada de Azul",TILES_COLORED_HUE5_NAME:"Madeira Pintada de Roxo",TILES_COLORED_HUE5_NAME_BLOCK:"Bloco de Madeira Pintada de Roxo",CRAFT_CLASS_BAKED_FOOD_NAME:"Qualquer Alimento Cozinhado",CRAFT_CLASS_BRICK_NAME:"Qualquer Tijolo",CRAFT_CLASS_FARMING_SEED_DESC:"As sementes de culturas podem ser obtidas a partir de versões pequenas e selvagens destas plantas.",CRAFT_CLASS_FARMING_SEED_NAME:"Qualquer Semente de Cultura",CRAFT_CLASS_FUEL_NAME:"Qualquer Combustível",CRAFT_CLASS_GRINDABLE_NAME:"Qualquer para Moagem",CRAFT_CLASS_INGREDIENT_NAME:"Qualquer Alimento",CRAFT_CLASS_REPAIRABLE_NAME:"Qualquer Ferramenta",CRAFT_CLASS_SCALED_INGOT_NAME:"Qualquer Lingote",CRAFT_CLASS_STONE_RAW_NAME:"Qualquer Pedra Bruta",CRAFT_CLASS_WHEAT_CORN_NAME:"Trigo ou Milho",CRAFT_CLASS_WOOD_PLANK_NAME:"Qualquer Prancha de Madeira",CRAFT_CLASS_WOOD_RAW_NAME:"Qualquer Madeira Bruta",MATERIAL_CLASS_NONE_NAME:"Nenhum",MATERIAL_CLASS_WOOD_NAME:"Madeira",MATERIAL_CLASS_STONE_NAME:"Pedra",MATERIAL_CLASS_DIRT_NAME:"Terra",MATERIAL_CLASS_METAL_NAME:"Metal",MAT_LEAF_NAME:"Folha",MAT_FIBER_NAME:"Fibra",MAT_LIGHT_WOOD_NAME:"Madeira Clara",MAT_WOOD_NAME:"Madeira",MAT_RED_WOOD_NAME:"Madeira Vermelha",MAT_DARK_WOOD_NAME:"Madeira Escura",MAT_FLINT_NAME:"Sílex",MAT_ROCK_NAME:"Rocha",MAT_STONE_NAME:"Pedra",MAT_FANCY_STONE_NAME:"Pedra Extravagante",MAT_UNUSED_STONE_NAME:"Pedra Não Usada",MAT_SAND_NAME:"Areia",MAT_DIRT_NAME:"Terra",MAT_HOE_ACTION_NAME:"Ação de Enxada",MAT_MUTTAL_NAME:"Muttal",MAT_COAL_NAME:"Carvão",MAT_COPPER_NAME:"Cobre",MAT_TIN_NAME:"Latão",MAT_BRONZE_NAME:"Bronze",MAT_IRON_NAME:"Ferro",MAT_SILVER_NAME:"Prata",MAT_EMBERYLLIUM_NAME:"Emberyllium",MAT_GOLD_NAME:"Ouro",MAT_BRIGHTSTEEL_NAME:"Aço brilhante",MAT_COBALT_NAME:"Cobalto",MAT_MYTHRIL_NAME:"Mitrilo",MAT_AETHERSTONE_NAME:"Pedra de Éter",MAT_AETHERSTEEL_NAME:"Aço de Éter",MAT_REGULAR_NAME:"Regular",MAT_FAST_NAME:"Rápido",MAT_SUPER_NAME:"Super",MAT_ANY_INGREDIENT_NAME:"Qualquer ingrediente",MAT_TOMATO_NAME:"Tomate",MAT_PUMPKIN_NAME:"Abóbora",MAT_CARROT_NAME:"Cenoura",MAT_RED_BERRY_NAME:"Baga Vermelha",MAT_BLUE_BERRY_NAME:"Baga Azul",MAT_YELLOW_BERRY_NAME:"Baga Amarela",MAT_LABEL_NAME:"Etiqueta",MAT_HOT_NAME:"Quente",MAT_PUNGENT_NAME:"Picante",MAT_SAVORY_NAME:"Salgado",MAT_BREAD_NAME:"Pão",MAT_BROWN_MUSHROOM_NAME:"Cogumelo Castanho",MAT_LUMINESCENT_MUSHROOM_NAME:"Cogumelo Luminescente",MAT_RED_MUSHROOM_NAME:"Cogumelo Vermelho",MAT_CORN_NAME:"Milho",MAT_RED_NAME:"Vermelho",MAT_ORANGE_NAME:"Laranja",MAT_YELLOW_NAME:"Amarelo",MAT_GREEN_NAME:"Verde",MAT_BLUE_NAME:"Azul",MAT_PURPLE_NAME:"Roxo",STONE_TIER_T0:"Regular",STONE_TIER_T1:"1★ Denso",STONE_TIER_T2:"2★ Extra-Denso",STONE_TIER_T3:"3★ Duro",STONE_TIER_T4:"4★ Extra-Duro",STONE_TIER_T5:"5★ Super-Duro",STONE_TIER_T6:"6★ Hiper-Duro",STONE_TIER_T7:"7★ Mega-Duro",STONE_TIER_T8:"8★ Duro-Duplo-Plus",STONE_TIER_T9:"9★ Indestrutível",ITEM_BERRY_NAME:"Aglomerado",ITEM_BREAD_NAME:"Pão de Milho",ITEM_CARROT_NAME:"Cenoura",ITEM_CROISSANT_NAME:"Croissant",ITEM_JUICE_NAME:"Sumo",ITEM_LEFTOVERS_NAME:"Restos",ITEM_MUSHROOM_NAME:"Cogumelo",ITEM_PIE_NAME:"Tarte",ITEM_ROAST_VEGETABLES_NAME:"Vegetal Assado",ITEM_SANDWICH_NAME:"Sanduíche",ITEM_TOMATO_NAME:"Tomate",ITEM_BOTTLE_NAME:"Garrafa Vazia",ITEM_COAL_NAME:"Carvão",ITEM_CORD_DESC:"Corda áspera, útil na montagem de todos os tipos de coisas.",ITEM_CORD_NAME:"Cabo",ITEM_CORN_NAME:"Milho",ITEM_FIBER_DESC:"Fibra recolhida de flores selvagens ou domésticas e outras plantas.",ITEM_FIBER_NAME:"Fibra Vegetal",ITEM_FLOUR_NAME:"Farinha",ITEM_INGOT_NAME:"Lingote",ITEM_ORE_INFO:"Os minérios metálicos encontram-se principalmente em fendas e depósitos dentro de outras características de terreno. Embora os minérios de Cobre e Ferro possam ser encontrados perto da superfície, outros minérios só podem ser encontrados a nível mais profundo, dentro de camadas mais duras de pedra.",ITEM_ORE_NAME:"Minério",ITEM_PAINT_NAME:"Tinta",ITEM_PUMPKIN_NAME:"Abóbora",ITEM_SPICE_NAME:"Especiaria",ITEM_SUGAR_CANE_NAME:"Cana de Açúcar",ITEM_SUGAR_NAME:"Açúcar",ITEM_TOOL_HEAD_NAME:"Cabeça de Ferramenta",ITEM_WHEAT_NAME:"Trigo",ITEM_BERRY_BUSH_BLUE_NAME:"Semente de Bagas Azuis",ITEM_BERRY_BUSH_RED_NAME:"Semente de Bagas Vermelhas",ITEM_BERRY_BUSH_YELLOW_NAME:"Semente de Bagas Amarelas",ITEM_SEEDS_CARROT_NAME:"Sementes de Cenoura",ITEM_SEEDS_CORN_NAME:"Sementes de Milho",ITEM_SEEDS_FLOWERS_BLUE_NAME:"Semente de Flor Azul Tímida",ITEM_SEEDS_FLOWERS_ORANGE_NAME:"Semente de Flor Laranja Otimista",ITEM_SEEDS_FLOWERS_PURPLE_NAME:"Semente de Flor Roxa Prestigiada",ITEM_SEEDS_FLOWERS_RED_NAME:"Semente de Flor Vermelha Radiante",ITEM_SEEDS_FLOWERS_YELLOW_NAME:"Semente de Flor Amarela Deliciosa",ITEM_SEEDS_MUSHROOMS_BROWN_NAME:"Semente de Cogumelo Castanho Alegre",ITEM_SEEDS_MUSHROOMS_LUMINESCENT_NAME:"Semente de Cogumelo Luminescente Solitário",ITEM_SEEDS_MUSHROOMS_RED_NAME:"Semente de Cogumelo Vermelho Prazeroso",ITEM_SEEDS_PUMPKIN_NAME:"Sementes de Abóbora",ITEM_SEEDS_SUGAR_CANE_NAME:"Sementes de Cana de Açúcar",ITEM_SEEDS_TOMATO_NAME:"Sementes de Tomate",ITEM_SEEDS_WHEAT_NAME:"Sementes de Trigo",ITEM_ACCESS_CONTROL_DESC:"Permite criar e modificar Áreas com acesso limitado.",ITEM_BED_NAME:"Cama",ITEM_BENCH_NAME:"Bancada",ITEM_BUZZERGOAL_DESC:"Tocá-la termina uma Corrida. Utilizá-la permite verificar as pontuações para a sua Corrida.\n(Para ativar, interaja enquanto mantém este item pressionado para atribuir um nome. Permite terminar uma corrida iniciada numa Campainha de Início de Corrida com o mesmo nome.)",ITEM_BUZZERGOAL_NAME:"Bandeira de Meta da Corrida",ITEM_BUZZERSTART_DESC:"Inicia uma Corrida pressionando enquanto ativo.\n(Para ativar, interaja enquanto mantém este item pressionado para atribuir um nome. Atingir uma Bandeira de Meta de Corrida com o mesmo nome terminará a corrida.)",ITEM_BUZZERSTART_NAME:"Campainha de Início de Corrida",ITEM_CHAIR_NAME:"Cadeira",ITEM_CHEST_MEDIUM_NAME:"Baú",ITEM_CHEST_SMALL_NAME:"Baú Pequeno",ITEM_CHEST_TALL_NAME:"Armário",ITEM_CHEST_TINY_NAME:"Baú Minúsculo",ITEM_DOOR_DOUBLE_NAME:"Porta Dupla",ITEM_DOOR_NAME:"Porta",ITEM_FENCE_NAME:"Cerca",ITEM_FLOWERPOT_NAME:"Vaso",ITEM_GEM_NAME:"Joia",ITEM_LADDER_NAME:"Escada",ITEM_LANTERN_NAME:"Lanterna",ITEM_LIGHT_CUBE_NAME:"Luz de Cubo",ITEM_RODH_NAME:"Haste (Horizontal)",ITEM_RODV_NAME:"Haste (Vertical)",ITEM_ROD_NAME:"Haste",ITEM_RUG_NAME:"Tapete",ITEM_SHELF_NAME:"Prateleira",ITEM_SIGNBOARD_NAME:"Quadro",ITEM_SIGNPOST_NAME:"Sinal",ITEM_STEPS_NAME:"Passos",ITEM_TABLE_LARGE_NAME:"Mesa Grande",ITEM_TABLE_SMALL_NAME:"Mesa Pequena",ITEM_TORCH_NAME:"Tocha",ITEM_WINDOW_LARGE_NAME:"Janela Grande",ITEM_WINDOW_MEDIUM_NAME:"Janela Média",ITEM_WINDOW_SMALL_NAME:"Janela Pequena",ITEM_ANVIL_DESC:"Repara ferramentas e produz com mais eficiência cabeças de ferramentas de metal.",ITEM_ANVIL_NAME:"Bigorna",ITEM_BONFIRE_DESC:"Fogareiro de Pedra com Pernas de Madeira",ITEM_BONFIRE_METAL_DESC:"Fogareiro com correntes e bacia metálica.",ITEM_BONFIRE_METAL_NAME:"Fogareiro Metálico",ITEM_BONFIRE_NAME:"Fogareiro",ITEM_CAMPFIRE_DESC:"Assa a maioria dos alimentos crus, tornando-os mais comestíveis.",ITEM_CAMPFIRE_NAME:"Fogueira",ITEM_ENERGY_WELL_DESC:"Fornece um lugar alternativo para reabastecer as energias.",ITEM_ENERGY_WELL_NAME:"Poço de Energia",ITEM_FURNACE_GLASS_DESC:"Refina a areia em vidro.",ITEM_FURNACE_GLASS_NAME:"Fornalha de Vidro",ITEM_FURNACE_ORE_DESC:"Refina metais em lingotes.",ITEM_FURNACE_ORE_NAME:"Fornalha de Minério",ITEM_JUICER_DESC:"Entram bagas e sai sumo. Que delícia!",ITEM_JUICER_NAME:"Espremedor",ITEM_KILN_DESC:"Produz carvão e tijolos.",ITEM_KILN_NAME:"Forno de fossa",ITEM_MILL_DESC:"Mói algo para criar um novo ingrediente.",ITEM_MILL_NAME:"Moinho",ITEM_OVEN_DESC:"Cozinha comida mais avançada que a Fogueira.",ITEM_OVEN_NAME:"Forno",ITEM_PAINT_MIXER_DESC:"Cria e combina tintas.",ITEM_PAINT_MIXER_NAME:"Misturador de Tintas",ITEM_SAWMILL_DESC:"Produz hastes de madeira e corta pranchas de madeira.",ITEM_SAWMILL_NAME:"Marcenaria",ITEM_STONECUTTER_ADVANCED_NAME:"Esmerilador de Pedra Avançado",ITEM_STONECUTTER_SIMPLE_DESC:"Produz cabeças de ferramentas de pedra e corta tijolos de pedra.",ITEM_STONECUTTER_SIMPLE_NAME:"Esmerilação de pedra",ITEM_TOOL_HEAD_CAST_DESC:"Transforma metal refinado em cabeças de ferramentas.",ITEM_TOOL_HEAD_CAST_NAME:"Molde de Cabeça de Ferramenta",ITEM_WATERING_SYSTEM_DESC:"Rega automaticamente as culturas próximas.",ITEM_WATERING_SYSTEM_NAME:"Sistema de Rega",ITEM_WAYGATE_NAME:"Waygate",ITEM_WORKBENCH_DESC:"Uma bancada mágica que produz componentes e ferramentas.",ITEM_WORKBENCH_NAME:"Bancada de Éter",ITEM_BUCKET_NAME:"Balde",ITEM_DOWSER_ADVANCED_DESC:"Ferramenta para encontrar fendas de pedra que podem conter minério.",ITEM_DOWSER_ADVANCED_INFO:"O tamanho da barra indica a variação da densidade na direção do olhar, a cor da barra indica o minério correspondente.",ITEM_DOWSER_ADVANCED_NAME:"Detetor Avançado",ITEM_DOWSER_SIMPLE_DESC:"Ferramenta para deteção de minério nas proximidades.",ITEM_DOWSER_SIMPLE_INFO:"O tamanho da barra indica proximidade, a cor da barra indica minério correspondente.",ITEM_DOWSER_SIMPLE_NAME:"Detetor Simples",ITEM_HANDSTOOL_NAME:"Mãos Vazias",ITEM_HATCHET_NAME:"Machado",ITEM_HOE_NAME:"Enxada",ITEM_PICKAX_NAME:"Picareta",ITEM_SHOVEL_NAME:"Pá",ITEM_LIQUID_NAME:"Líquido Desconhecido",ITEM_PLANT_NAME:"Sementes de Flor Desconhecida"}},{}],108:[function(e,t,r){"use strict"
r.localizationPastStartup=localizationPastStartup
r.localizationSetChatUI=localizationSetChatUI
r.L=r.DURATION_WITH_SECONDS_ALWAYS=r.DURATION_WITH_MINUTES=r.DURATION_ONLY_SECONDS=r.DURATION_ONLY_MINUTES=r.DURATION_ONLY_DAYS=r.TimeComponent=r.lang_code_ref=void 0
var a
var i=e("../../glov/client/localization")
function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype)
_setPrototypeOf(e.prototype.constructor=e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){e.__proto__=t
return e})(e,t)}var o=e("assert")
var n=e("@messageformat/core")
var s=e("../../glov/client/client_config")
var l=s.MODE_DEVELOPMENT
var c=s.MODE_PRODUCTION
var _=e("../../glov/client/cmds").cmd_parse
var u=e("../../glov/client/localization").getStringFromLocalizable
var d=e("../../glov/client/ui")
var f=e("../../glov/common/util").once
var v=e("./lang_en-US.json")
var h=e("./lang_pt-PT.json")
for(var p in i)if("default"!==p)r[p]=i[p]
var m="en-US"
r.lang_code_ref=m
var g=v
var E=((a={})[m]=g,a["pt-PT"]=h,a)
var y=Object.keys(E)
var T=m
var I=g
var S=1
var A=new n(T)
var w=window.Function
function functionReplacer(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r]
var a=t[t.length-1]
a=(a=a.replace(/return \(([^)]*)\) => {/,"return function($1) {")).replace(/return \(([^)]*)\) => (.+)$/,"return function($1) { return $2; }")
o(!a.includes("=>"),a)
t[t.length-1]=a
return w.apply(void 0,t)}var L=l
try{o.equal(Function("return () => 7")()(),7)}catch(e){L=true}function applyPolyfills(){if(L)window.Function=functionReplacer}function unapplyPolyfills(){if(L)window.Function=w}var R=false
var x=false
var O=false
function localizationPastStartup(){O=true}var b=function(){function StringWrapper(e){this.v=void 0
this.v=e
if(c)this.length=e.length}var e=StringWrapper.prototype
e.set=function set(e){this.v=e
if(c)this.length=e.length}
e.toLocalString=function toLocalString(){return this.v}
e.toString=function toString(){return this.v}
return StringWrapper}()
if(c)["concat","includes","indexOf","lastIndexOf","match","slice","split","startsWith","endsWith","toLowerCase","toUpperCase"].forEach(function(e){b.prototype[e]=function(){return this.v[e].apply(this.v,arguments)}})
var N=function(r){_inheritsLoose(LocalizedReactive,r)
function LocalizedReactive(e){var t;(t=r.call(this,"")||this).f=void 0
t.l=void 0
t.f=e
t.l=0
return t}var e=LocalizedReactive.prototype
e.update=function update(){if(this.l!==S){var e=this.f()
o("string"===typeof e,"func must return a string in order to not break the toLocalString and toString methods")
this.set(e)
this.l=S}return this.v}
e.toLocalString=function toLocalString(){return this.update()}
e.toString=function toString(){return this.update()}
return LocalizedReactive}(b)
var C=function(a){_inheritsLoose(LocalizedEntry,a)
function LocalizedEntry(e,t){var r;(r=a.call(this,t)||this).key=void 0
r.format_func=void 0
r.format_cache=void 0
r.cap=void 0
r.up=void 0
r.lo=void 0
r.key=e
return r}var e=LocalizedEntry.prototype
e.updateEntry=function updateEntry(e){if(e!==this.v){this.set(e)
this.format_func=void 0
if(this.cap)this.cap.set(e.charAt(0).toUpperCase()+e.slice(1))
if(this.up)this.up.set(e.toUpperCase())
if(this.lo)this.lo.set(e.toLowerCase())}}
e.$=function $(e){function format(e,t){if(!O)o(false,"Reference to "+e.key+" being converted to string during startup")
var r=e.format_func
if(!r){applyPolyfills()
r=e.format_func=A.compile(e.v)
unapplyPolyfills()}return r(t)}var t=Object.keys(e)
if(1===t.length){var r=e[t[0]]
if(void 0===r||null===r){if(l)o(r,"Nullish values cannot be passed as parameters.")
r=""}var a=r.key
if(a){var i=this.format_cache||(this.format_cache=Object.create(null))
return i[a]||(i[a]=new N(format.bind(null,this,e)))}}return new N(format.bind(null,this,e))}
e.capital=function capital(){return this.cap||(this.cap=new b(this.v.charAt(0).toUpperCase()+this.v.slice(1)))}
e.upper=function upper(){return this.up||(this.up=new b(this.v.toUpperCase()))}
e.lower=function lower(){return this.lo||(this.lo=new b(this.v.toLowerCase()))}
return LocalizedEntry}(b)
var M;(function(e){e[e["Second"]=0]="Second"
e[e["Minute"]=1]="Minute"
e[e["Hour"]=2]="Hour"
e[e["Day"]=3]="Day"
e[e["Year"]=4]="Year"})((r.TimeComponent=M)||(r.TimeComponent=M={}))
var D={lowest:M.Day,highest:M.Day}
r.DURATION_ONLY_DAYS=D
var P={lowest:M.Minute,highest:M.Minute}
r.DURATION_ONLY_MINUTES=P
var k={lowest:M.Second,highest:M.Second}
r.DURATION_ONLY_SECONDS=k
var B={lowest:M.Minute}
r.DURATION_WITH_MINUTES=B
var U={lowest:M.Second,always_lowest:true}
r.DURATION_WITH_SECONDS_ALWAYS=U
var G=[1,60,3600,86400,31536e3]
var F
var W=G.slice(0)
var j
r.L=j
var H=new(function(){function LocalizationImpl(){for(var e in g){var t=I[e]
this[e]=new C(e,void 0!==t?t:g[e])}if(l)for(var r in E){var a=E[r]
o(a)
var i=0
for(e in g)if(void 0===a[e])i++
if(i)console.warn("Language "+r+" is missing "+i+" entries")}}var e=LocalizationImpl.prototype
e.getLanguage=function getLanguage(){return T}
e.setLanguage=function setLanguage(e){var t=E[e]
if(I===t)return true
if(!t)return false
I=t
A=new n(T=e)
this.updateEntriesText()
return true}
e.get=function get(e){return this[e]}
e.$=function $(e,t){var r={val:t}
for(var a=0;a<(arguments.length<=2?0:arguments.length-2);a++)r["val_"+(a+2)]=a+2<2||arguments.length<=a+2?void 0:arguments[a+2]
return e.$(r)}
e.addColon=function addColon(e){return j.FORMAT_ADD_COLON.$({val:e})}
e.addEllipsis=function addEllipsis(e){return j.FORMAT_ADD_ELLIPSIS.$({val:e})}
e.addNumberSign=function addNumberSign(e){return j.FORMAT_ADD_NUMBER_SIGN.$({val:e})}
e.addParentheses=function addParentheses(e){return j.FORMAT_ADD_PARENTHESES.$({val:e})}
e.addParenthesesAfter=function addParenthesesAfter(e,t){return j.FORMAT_ADD_PARENTHESES_AFTER.$({val:e,detail:t})}
e.addPercentage=function addPercentage(e){return j.FORMAT_ADD_PERCENTAGE.$({val:e})}
e.addPlus=function addPlus(e){return j.FORMAT_ADD_PLUS.$({val:e})}
e.addQuestionMark=function addQuestionMark(e){return j.FORMAT_ADD_QUESTION_MARK.$({val:e})}
e.separate=function separate(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a]
return this.reactive(function(){return r.join(u(e))})}
e.separateColon=function separateColon(e,t){return this.separate(j.FORMAT_SEPARATOR_COLON,e,t)}
e.separateComma=function separateComma(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r]
return this.separate.apply(this,[j.FORMAT_SEPARATOR_COMMA].concat(t))}
e.separateWords=function separateWords(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r]
return this.separate.apply(this,[j.FORMAT_SEPARATOR_WORDS].concat(t))}
e.duration=function duration(e,t){var r,a
var i=null!=(r=t&&t.lowest)?r:M.Minute
var o=null!=(a=t&&t.highest)?a:M.Year
var n=t&&t.always_lowest
for(var s=o;s>=i;s--)if(e){W[s]=Math.floor(e/G[s])
e%=G[s]}else W[s]=0
while(o>i&&!W[o])o--
if(!n)while(i<o&&!W[i])i++
var l=[]
for(var c=o;c>=i;c--){var _=W[c]
if(_||c===i||c===o)l.push(F[c].$({val:_}))}return this.separateComma.apply(this,l)}
e.reactive=function reactive(e){return new N(e)}
e.updateEntriesText=function updateEntriesText(){S++
for(var e in g){var t=I[e]
if(R||x&&void 0===t){var r=g[t=e].match(/{[0-9A-Za-z_]+/g)
if(r)t+="["+r.filter(function(e,t,r){return t===r.indexOf(e)}).join("}, ")+"}]"}this.get(e).updateEntry(t||g[e])}}
return LocalizationImpl}())
r.L=j=H
if(l&&"function"===typeof Proxy){var z=j.get.bind(j)
r.L=j=new Proxy(j,{get:function get(e,t){if("get"===t)return z
var r=e[t]
o(void 0!==r,"Attempt to access missing localization entry "+String(t))
return r}})}F=[j.FORMAT_DURATION_SECONDS,j.FORMAT_DURATION_MINUTES,j.FORMAT_DURATION_HOURS,j.FORMAT_DURATION_DAYS,j.FORMAT_DURATION_YEARS]
_.register({cmd:"lang",access_show:["sysadmin"],help:"Get or set the current language",usage:"Available languages: "+j.separateComma.apply(j,y),prefix_usage_with_help:true,func:function func(e,t){if(!e)t(null,j.MSG_LANGUAGE_GET.$({val:j.getLanguage()}).toLocalString())
else if(j.setLanguage(e))t(null,j.MSG_LANGUAGE_SET.$({val:j.getLanguage()}).toLocalString())
else t(j.ERR_LANGUAGE_NOT_FOUND.$({val:e}).toLocalString())}})
var V=["none","untranslated","all"]
var Y=0
_.register({cmd:"lang_debug",access_show:["sysadmin"],help:"Enable language text debugging",usage:"/lang_debug ["+j.separateComma.apply(j,V)+"]\nIf used without a value, it will cycle between modes",prefix_usage_with_help:true,func:function func(e,t){var r="Wrong usage"
if(!e)Y=(Y+1)%V.length
else{var a=V.indexOf(e)
if(-1===a)return void t(r)
Y=a}var i=V[Y]
switch(i){case"all":x=R=true
break
case"none":x=R=false
break
case"untranslated":R=false
x=true}H.updateEntriesText()
t(null,j.separateColon("Language text debugging",i).toLocalString())}})
var q={}
var K
function localizationSetChatUI(e){K=e}_.register({cmd:"lang_entry",access_show:["sysadmin"],help:"Get or set the text for an entry in the current language",usage:"/lang_entry entry [text]",prefix_usage_with_help:true,func:function func(e,t){var r="Entry not found"
var a="Invalid language"
if(!e)return void t(r)
var i=e.indexOf(" ")
var o=-1===i?e:e.substring(0,i)
var n=H.get(o)
if(!n)t(r)
else if(-1===i){var s=I[o]||g[o]
if(d.copyTextToClipboard(s)){K.focus()
t(null,j.addColon("Text copied to clipboard")+"\n"+s)}else t(null,s)}else if(I===g)t(a)
else{var l=e.substring(i+1)
var c=q[T]
if(!c)c=q[T]={}
c[o]=l
I[o]=l
n.updateEntry(l)
t(null,j.separateColon(o,l).toLocalString())}}})
var Z
function downloadTextFile(e,t){try{if(!Z)Z=document.createElement("a")
Z.download=e
Z.href="data:application/json;charset=utf-8,"+encodeURIComponent(t)
Z.click()
return true}catch(e){return false}}function uploadTextFile(r){r=f(r)
try{var a=document.createElement("input")
a.type="file"
a.accept=".json,.txt"
a.onchange=function(){var e=a.files&&a.files[0]
if(!e)return void r(null)
try{var t=new FileReader
t.onload=function(e){var t=e.target&&e.target.result
r("string"===typeof t?t:null)}
t.readAsText(e)}catch(e){r(null)}}
a.click()}catch(e){r(null)}}_.register({cmd:"lang_entries_save",access_show:["sysadmin"],help:"Save a file with all the modified entries in the current language",prefix_usage_with_help:true,func:function func(e,t){var r=q[T]
if(!r)return void t("No entries were modified for language "+T)
var a="WorldsFRVR_translations_"+T+".json"
var i=""+JSON.stringify(r,null,2)
if(downloadTextFile(a,i))t(null,"File "+a+" downloaded")
else if(d.copyTextToClipboard(i)){K.focus()
t(null,"Modified entries for language "+T+" copied to clipboard")}else t("Your browser does not support downloading files, please change to a compatible browser")}})
_.register({cmd:"lang_entries_load",access_show:["sysadmin"],help:"Load a file with multiple entries' texts for the current language",prefix_usage_with_help:true,func:function func(e,s){var l="Invalid language"
if(I===g)return void s(l)
uploadTextFile(function(e){if(I===g)return void s(l)
var t
try{t=e&&JSON.parse(e)}catch(e){}if(!t||"object"!==typeof t)return void s("Invalid file")
var r=q[T]
var a=0
for(var i in t){var o=t[i]
if("string"!==typeof o)continue
var n=H.get(i)
if(!n)continue
if(!r)r=q[T]={}
r[i]=o
I[i]=o
n.updateEntry(o)
a++}s(null,"Changed "+a+" entries in the "+T+" language")})}})},{"../../glov/client/client_config":243,"../../glov/client/cmds":244,"../../glov/client/localization":275,"../../glov/client/ui":306,"../../glov/common/util":330,"./lang_en-US.json":106,"./lang_pt-PT.json":107,"@messageformat/core":void 0,assert:void 0}],109:[function(e,t,r){"use strict"
r.lodQueueHexomeChoices=lodQueueHexomeChoices
r.lodQueueContinentData=lodQueueContinentData
r.lodOnZMap=lodOnZMap
r.shift=shift
r.startStreaming=startStreaming
r.tickLODs=tickLODs
r.reset=reset
r.startup=startup
var f=e("assert")
var n=e("./camera.js").getCurrentCameraUnderwater
var o=e("glov-async").asyncParallel
var a=e("../glov/client/browser.js").is_discrete_gpu
var i=e("../glov/client/cmds.js").cmd_parse
var s=e("./continent_loader.js"),l=s.continentLoaderReady,c=s.continentLoaderWhenReady
var _=e("./debug.js")
var u=e("../glov/client/engine.js")
var d=e("../glov/client/geom.js")
var v=e("../common/globals.js"),h=v.CHUNK_SIZE,p=v.CS2,m=v.ID_FACTOR
var g=e("./lods_shared.js"),E=g.VERT_SIZE,y=g.lodGen
var T=Math.floor,I=Math.max,S=Math.min,A=Math.round
var w=e("./main.js")
var L=e("./megachunk_client.js").hexomeChoiceReady
var R=e("./proc_gen_debug.js")
var x=e("./proc_gen_biomes.js").procGenDoLODs
var O=e("../glov/client/shaders.js")
var b=e("../glov/common/vmath.js"),N=b.mat4,C=b.vec1,M=b.vec2,D=b.v2addScale,P=b.v2floor,k=b.v2distSq,B=b.v2scale,U=b.unit_vec
var G=e("../common/voxel_data_common.js").ZMAP_UNKNOWN
var F=e("./voxel_chunk_manager.js")
var W=e("./voxel_data.js")
var j=e("./task_sched.js"),H=j.WORKER_LOD,z=j.taskCreate,V=j.workerFlush,Y=j.workerReady,q=j.workerTaskCount
var K=e("../glov/common/util.js").easeOut
var Z=64
var X=-3
var Q=16
var J=a?8:6
var $=4e3
var ee=5e3
var te={}
var re
var ae
var ie
var oe=0
var ne
var se
var le=6*(Z*Z)
function lodQueueHexomeChoices(e){ne.push(e)}function lodQueueContinentData(e){se.push(e)}var ce
function allocIndices(){var e=new Uint16Array(le)
var t=0
for(var r=0;r<Z;++r){var a=r*(Z+1)
var i=a+Z+1
for(var o=0;o<Z;++o){e[t++]=a+o
e[t++]=i+o+1
e[t++]=i+o
e[t++]=a+o
e[t++]=a+o+1
e[t++]=i+o+1}}f.equal(t,le)
ce=d.createIndices(e)}var _e=new Uint8Array(2)
function lodUpdateFlushSub(e,t,r,a){if(e.is_water[t>>5]&1<<(31&t))return
r=I(r,e.min_elev)
var i=t*E+2
var o=e.verts[i]+(e.verts[i+1]<<8)+e.min_elev
if(r<o||u.defines.LODGROW&&r>o){r-=e.min_elev
e.verts[i]=255&r
e.verts[i+1]=r>>8
if(a){_e[0]=255&r
_e[1]=r>>8
e.geom.updateSub(i,_e)}}}function lodUpdateSub(e,t,r,a){var i=te[t]
if(!i)return
var o=a*(Z+1)+r
if(!i.verts){if(!i.vupdates)i.vupdates=[]
i.vupdates.push(o,e)
return}lodUpdateFlushSub(i,o,e,true)}function lodUpdateFlush(e){if(!e.vupdates)return
for(var t=0;t<e.vupdates.length;t+=2)lodUpdateFlushSub(e,e.vupdates[t],e.vupdates[t+1],false)
delete e.vupdates}function onLOD(e){if(e.generation!==oe)return
if(!ce)allocIndices()
var t=e.pos,r=e.min_elev,a=e.verts,i=e.is_water
var o=t[0]+t[1]*m
var n=te[o]
f(n.task)
n.task=null
n.min_elev=r
n.mat=N()
n.verts=a
n.is_water=i
if(!n.load_timestamp)n.load_timestamp=u.frame_timestamp
lodUpdateFlush(n)
n.geom=d.create(re,a,ce,d.TRIANGLES)
n.mat[0]=h
n.mat[5]=h
n.mat[10]=1
n.ready=true}var ue=new Int16Array(p)
var de=.5
function elevFromZmap(e){for(var t=0;t<p;++t)ue[t]=e[t]
ue.sort()
var r=0
while(ue[r]===G)r++
return ue[r+A((p-r)*de)]}function lodOnZMap(e){var t=e.vsid,r=e.data
f(e.from)
f(void 0!==t)
f.equal(r.length,p)
var a=A(t/m)
var i=t-a*m
var o=T(i/Z)
var n=T(a/Z)
var s=i-o*Z
var l=a-n*Z
var c=o+n*m
var _=te[c]
if(!_)return
var u=l*Z+s
if(!_.zmap_updates)_.zmap_updates={}
else if(_.zmap_updates[u]&&"procgen"===e.from)return
_.zmap_updates[u]=e.from
var d=elevFromZmap(r)
lodUpdateSub(d,c,s,l)
if(!s){lodUpdateSub(d,c-1,Z,l)
if(!l)lodUpdateSub(d,c-1-m,Z,Z)}if(!l)lodUpdateSub(d,c-m,s,Z)}function getLOD(e){var t=e[0]+e[1]*m
var r=te[t]
if(!r)te[t]=r={ready:false,mat:N(),task:null,load_timestamp:0,world_pos:M(e[0]*Z*h,e[1]*Z*h)}
return r}var fe
var ve
var he={fade:C(1)}
function doit(e,t,r){var a=getLOD(e)
if(!a.ready){if(r)return
if(!a.task&&(t||u.defines.NOWORKERS||Y(H))&&l(a.world_pos,$)){var i={pos:[e[0],e[1]],generation:oe}
if(ne.length){i.hexome_choices=ne
ne=[]}if(se.length){i.continents=se
se=[]}if(u.defines.NOWORKERS){a.task=true
onLOD(y(e,oe))}else{ve=true
a.task=z({worker:H,time:120,type:"lod_gen",data:i},onLOD)
if(t)V(H)}}++fe
return}if(t)return
if(n())return
a.mat[12]=(e[0]*Z-W.origin_chunk[0]+.5)*h
a.mat[13]=(e[1]*Z-W.origin_chunk[1]+.5)*h
a.mat[14]=-W.origin_chunk[2]*h+a.min_elev+X
u.updateMatrices(a.mat)
var o=u.frame_timestamp-a.load_timestamp
if(o<ee&&a.load_timestamp>w.loading_finished_timestamp)he.fade[0]=K(o/ee,2)
else he.fade[0]=1
O.bind(ae,ie,he)
a.geom.draw()}var pe=[]
var me=false
function shift(){me=true
var e=B(M(),W.origin_chunk,1/Z)
var t=P(M(),e)
var r=[]
var a=[]
var i=[]
var o=M()
D(e,e,U,-.5)
for(var n=-J-1;n<=J+1;++n){o[1]=t[1]+n
for(var s=-J-1;s<=J+1;++s){o[0]=t[0]+s
var l=k(o,e)
if(l<=J*J){i.push(i.length)
a.push(l)
r.push(o.slice(0))}}}i.sort(function(e,t){return a[e]-a[t]})
for(var c=pe.length=0;c<i.length;++c)pe.push(r[i[c]])}i.registerValue("lod_view_dist",{type:i.TYPE_INT,label:"LOD View Distance",range:[1,18],get:function get(){return J},set:function set(e){J=e
if(me)shift()},store:true})
function startStreaming(){if(!x())return
var r=oe
function startStreamingOnReady(){if(r!==oe)return
var e=S(Q,pe.length)
for(var t=0;t<e;++t)doit(pe[t],true)}if(w.omp){var e=[L]
var t=S(Q,pe.length)
for(var a=0;a<t;++a){var i=getLOD(pe[a])
e.push(c.bind(null,i.world_pos,$))}o(e,startStreamingOnReady)}else startStreamingOnReady()}var ge=false
function tickLODs(){if(!x())return
profilerStart("tickLODs")
var e=false
if(w.omp&&!L()){if(u.defines.LODS)_.addText("LODs: Hexome choice not ready")
e=true}ve=false
for(var t=fe=0;t<pe.length;++t)doit(pe[t],false,e)
if(ve)V(H)
if(u.defines.LODS){_.addText("LODs: "+fe+"/"+pe.length+" waiting")
_.addText("LODs: worker: "+q(H)+" tasks, "+(Y(H)?"":"Not ")+"ready")
_.addText("LODs: "+(ge?"":"not ")+"done")}if(!fe&&!ge&&!e){R.dumpPerf()
console.log("LODs generated in "+(Date.now()-F.load_start)+"ms")
ge=true}profilerStop("tickLODs")}function reset(){for(var e in te){var t=te[e]
if(t.geom)t.geom.dispose()}oe++
te={}
ne=[]
se=[]}function startup(){ae=O.create("shaders/lods.vp")
ie=O.create("shaders/lods.fp")
O.prelink(ae,ie)
re=[[O.semantic.POSITION,gl.UNSIGNED_BYTE,4,false],[O.semantic.COLOR,gl.UNSIGNED_BYTE,4,true],[O.semantic.NORMAL,gl.UNSIGNED_BYTE,4,true]]}},{"../common/globals.js":197,"../common/voxel_data_common.js":209,"../glov/client/browser.js":239,"../glov/client/cmds.js":244,"../glov/client/engine.js":250,"../glov/client/geom.js":263,"../glov/client/shaders.js":293,"../glov/common/util.js":330,"../glov/common/vmath.js":332,"./camera.js":28,"./continent_loader.js":38,"./debug.js":62,"./lods_shared.js":110,"./main.js":112,"./megachunk_client.js":116,"./proc_gen_biomes.js":133,"./proc_gen_debug.js":135,"./task_sched.js":161,"./voxel_chunk_manager.js":174,"./voxel_data.js":175,assert:void 0,"glov-async":void 0}],110:[function(e,t,r){"use strict"
r.lodGen=lodGen
r.VERT_SIZE=void 0
var I=12
r.VERT_SIZE=I
var S=e("assert")
var A=e("../glov/common/util").lerp
var a=e("../glov/common/vmath")
var w=a.v2set
var L=a.v3cross
var R=a.v3iAdd
var x=a.v3iNormalize
var i=a.vec2
var o=a.vec3
var n=e("../common/globals")
var O=n.CHUNK_SIZE
var b=n.ID_FACTOR
var s=e("./proc_gen_biomes")
var N=s.RFLOW_UNDERWATER
var C=s.getVSElevAndTile
var M=e("./proc_gen_hydro").hydroChunkInitRange
var l=e("./tiles")
var D=l.liquid_colors
var P=l.tile_colors
var k=Math.ceil,B=Math.floor,U=Math.min
var G=64
var F=(G+1)*(G+1)
var W=16
var j=G+3
var H=new Float32Array(j*j)
var z=new Array(j*j)
var V=new Uint8Array(j*j*3)
var Y=o()
var q=o()
var K=i()
var Z=[o(O,0,0),o(0,O,0),o(-O,0,0),o(0,-O,0)]
function lodGen(e,t){var r=new Uint8Array(F*I)
var a=new Uint32Array(k(F/32))
var i=e[1]*G*b+e[0]*G
var o=e[0]*G*O
var n=e[1]*G*O
w(K,o,n)
M(K,G*O)
var s=0
var l=Infinity
for(var c=-1;c<=G+1;++c){K[1]=n+c*O+O/2
for(var _=-1;_<=G+1;++_){K[0]=o+_*O+O/2
var u=C(i+_+c*b,K)
if(u.tint){V[3*s]=255*u.tint[0]
V[3*s+1]=255*u.tint[1]
V[3*s+2]=255*u.tint[2]}z[s]=u
var d=B(u.elev)
l=U(l,d)
H[s++]=d}}S.equal(s,H.length)
l-=W
function calcNormal(e){var t=H[e]
Z[0][2]=H[e+1]-t
Z[1][2]=H[e+j]-t
Z[2][2]=H[e-1]-t
Z[3][2]=H[e-j]-t
L(Y,Z[0],Z[1])
R(Y,L(q,Z[1],Z[2]))
R(Y,L(q,Z[2],Z[3]))
R(Y,L(q,Z[3],Z[0]))
x(Y)}var f=s=0
for(var v=0;v<=G;++v){var h=(v+1)*j+1
for(var p=0;p<=G;++p){r[s++]=p
r[s++]=v
var m=H[h]-l
r[s++]=255&m
r[s++]=m>>8
var g=z[h]
if(g.tint){r[s++]=V[3*h]
r[s++]=V[3*h+1]
r[s++]=V[3*h+2]}else{var E=P[g.tile]||P.def
r[s++]=E[0]
r[s++]=E[1]
r[s++]=E[2]}var y=D[g.liquid]
if(y){var T=U(g.rflow_amt/4,1)
r[s-3]=A(T,r[s-3],y[0])
r[s-2]=A(T,r[s-2],y[1])
r[s-1]=A(T,r[s-1],y[2])}r[s++]=255
calcNormal(h)
r[s++]=127.5*Y[0]+127.5
r[s++]=127.5*Y[1]+127.5
r[s++]=127.5*Y[2]+127.5
r[s++]=0;++h
if(g.rflow_amt===N)a[f>>5]|=1<<(31&f);++f}}S.equal(s,r.length)
return{pos:e,min_elev:l,generation:t,verts:r,is_water:a}}},{"../common/globals":197,"../glov/common/util":330,"../glov/common/vmath":332,"./proc_gen_biomes":133,"./proc_gen_hydro":137,"./tiles":162,assert:void 0}],111:[function(e,t,r){"use strict"
r.checkLoginRewardsToClaim=checkLoginRewardsToClaim
var s=e("assert")
var l=e("../glov/client/net").netSubs
var c=e("../glov/client/ui").modalDialog
var a=e("../common/rewards_common")
var _=a.LOGIN_REWARDS
var u=a.LoginRewardRequirementType
var d=e("../common/store_data").PRODUCT_ITEM_ID_GEM
var f=e("./analytics").logEvent
var v=e("./localization/localization").L
var o=e("./social_referral").getReferralNumber
var h=e("./status")
var p=e("./store").getProduct
var m=[]
function displayLoginRewardDialog(){var t=m.shift()
if(!t)return
var e=_[t]
if(!e)return
var r=l().getMyUserChannel()
if(!r)return
var a=p(e.product_id)
var i=a&&a.items&&a.items[0]
if(!i)s(false,"Product item does not exist: "+(a&&a.items))
var o
if(e.req_type===u.REFERRALS)o=v.DLG_REWARD_REFERRAL_MSG.$({friends:e.referrals})
var n
if(i.id===d)n=v.$(v.DLG_REWARD_GEM_MSG,i.amount)
s(o&&n)
c({title:v.DLG_REWARD_TITLE,text:v.separate("\n\n",o,n),buttons:{ok:function ok(){r.send("login_reward_claim",t,function(e){if(e){h.push(e)
return}f("reward_claim",1,void 0,t)
displayLoginRewardDialog()})}}})}function checkLoginRewardsToClaim(){var e=l().getMyUserChannel()
if(!e)return
m.length=0
var t=e.getChannelData("public.login_rewards",{})
var r=o()
for(var a in _){var i=_[a]
if(i&&!t[a])if(i.req_type===u.REFERRALS&&r>=i.referrals)m.push(a)}displayLoginRewardDialog()}},{"../common/rewards_common":205,"../common/store_data":208,"../glov/client/net":279,"../glov/client/ui":306,"./analytics":5,"./localization/localization":108,"./social_referral":153,"./status":156,"./store":158,assert:void 0}],112:[function(e,t,i){"use strict"
i.charControllerPos=charControllerPos
i.setExploreCanMoveChar=setExploreCanMoveChar
i.setExploreCanMovePht=setExploreCanMovePht
i.blockImageUpload=blockImageUpload
i.startLoad=startLoad
i.startMain=startMain
i.returnToMainMenu=returnToMainMenu
i.toggleMenuPage=toggleMenuPage
i.menuExitGeneric=menuExitGeneric
i.menuExitClear=menuExitClear
i.menuButton=menuButton
i.menuExit=menuExit
i.isMenuPage=isMenuPage
i.menuConsumeExit=menuConsumeExit
i.addBatchedSend=addBatchedSend
i.getFrameTransactionSet=getFrameTransactionSet
i.getFrameTransaction=getFrameTransaction
i.verifyFrameTransactions=verifyFrameTransactions
i.postTick=postTick
i.isQuickbarVisible=isQuickbarVisible
i.main=main
i.loading_finished_timestamp=i.flashlight_pos_vs=i.walltime_seconds=i.instance_uid=i.cmdParse=i.chat_ui=i.pht_controller=i.char_controller=i.main_active=i.omp=i.ENVIRONMENTS=void 0
var r=e("../glov/client/local_storage")
r.setStoragePrefix("frvr_edits2")
var a=e("assert")
var o=e("../frvr/client/platforms/adapter").initPlatformAdapter
var n=e("../frvr/client/xplay/host/host")
var s=e("../frvr/client/xplay/login").xplaySetup
var l=e("../glov/client/abtests_client").abTestsStartup
var c=e("../glov/client/browser.js").is_discrete_gpu
var _=e("../glov/client/camera2d.js")
var u=e("../glov/client/chat_ui.js").chatUICreate
var d=e("../glov/client/client_config")
var f=d.MODE_PRODUCTION
var v=d.PLATFORM_MOBILE
var h=d.PLATFORM_MSSTART
var p=e("../glov/client/cmds.js").cmd_parse
var m=e("../glov/client/draw_list.js")
var g=e("../glov/client/effects.js").effectsStartup
var I=e("../glov/client/engine.js")
var E=e("../glov/client/environments").environmentsInit
var y=e("../glov/client/error_report.js")
var T=y.errorReportIgnoreUncaughtPromises
var S=y.errorReportSetDetails
var A=e("../glov/client/fbinstant.js")
var w=A.fbInstantInit
var L=A.fbInstantIsReady
var R=e("../glov/client/filewatch.js").filewatchMessageHandler
var x=e("../glov/client/input.js")
var O=e("../glov/client/net.js")
var b=O.netClient
var N=O.netClientId
var C=O.netDisconnected
var M=O.netDisconnectedRaw
var D=O.netInit
var P=O.netSubs
var k=e("../glov/client/scroll_area.js").scrollAreaSetPixelScale
var B=e("../glov/client/settings.js")
var U=e("../glov/client/shaders.js")
var G=e("../glov/client/slider.js").sliderSetDefaultShrink
var F=e("../glov/client/snapshot.js").snapshotStartup
var W=e("../glov/client/social")
var j=W.richPresenceSet
var H=W.setDefaultUserProfileImage
var z=W.socialInit
var V=e("../glov/client/spot.js").spotSuppressPad
var Y=e("../glov/client/textures.js")
var q=e("../glov/client/textures.js").texturesUnloadDynamic
var K=e("../glov/client/ui.js")
var X=e("../glov/client/urlhash.js")
var Q=e("../glov/client/walltime.js")
var J=e("../glov/client/webfs.js").webFSReportUnused
var $=e("../glov/client/worker_comm.js")
var ee=e("../glov/client/worker_perf.js")
var te=e("../glov/common/util.js").callEach
var re=e("../glov/common/verify.js")
var ae=e("../glov/common/vmath")
var ie=ae.v3lengthSq
var oe=ae.v3scale
var ne=ae.v3scaleFloor
var se=ae.v4set
var le=ae.vec3
var ce=e("../common/globals.js")
var _e=ce.CHAT_MAX_LEN
var ue=ce.CHUNK_SIZE
var de=ce.CURRENT_VERSION
var fe=ce.ENV_LOCAL
var ve=ce.ENV_PRODUCTION
var he=ce.ENV_STAGING
var pe=ce.ENV_TEST
var me=ce.ENV_TEST2
var ge=e("../common/roles_common").classifyRole
var Ee=e("../common/world_trans.js").createTransSet
var ye=e("./analytics")
var Te=ye.analyticsStartup
var Ie=ye.logEvent
var Se=e("./app_settings.js")
var Ae=e("./atlas_params.json")
var we=e("./baking.js")
var Le=e("./block_intersections.js").drawBlockIntersections
var Re=e("./bluebox_edit_list.js")
var xe=Re.blueboxDrawAllEditBounds
var Oe=Re.boundsStartup
var be=e("./blueprint.js").blueprintStartup
var Ne=e("./build_menu.js")
var Ce=Ne.doBuildEarly
var Me=Ne.updateUserBlueprints
var De=e("./build_mode.js")
var Pe=De.suppressQueuedPlaceCancel
var ke=De.undergroundFactors
var Be=De.unlimitedMode
var Ue=e("./build_mode.js")
var Ge=e("./camera.js")
var Fe=Ge.getActiveController
var We=Ge.handleCameraInput
var je=Ge.setCharacterControllerAsActive
var He=Ge.setViewParameters
var ze=Ge.updateCurrentCamera
var Ve=e("./character_controller.js").CharacterController
var Ye=e("./character_customization").customizationPendingChanges
e("./client_cmds.js")
var qe=e("./client_entities.js")
var Ke=qe.clientEntitiesStartup
var Ze=qe.clientEntitiesTickLate
var Xe=qe.getEntityManager
var Qe=e("./continent_loader.js").continentLoadsWaiting
var Je=e("./cosmetics.js")
var $e=e("./costume_edit.js").costumeEditStartup
var et=e("./debug.js")
var tt=e("./draw_sprite3d.js").drawSprite3DStartup
var rt=e("./editvolume_clear.js").editVolumeClearContentsTick
var at=e("./external_users/external_users_client_worlds").externalUsersWorldsStartup
var it=e("./fbinstant_worlds.js").fbWorldsInit
var ot=e("./huds.js")
var nt=ot.adventureHUD
var st=ot.gemsHUD
var lt=ot.initHUDs
var ct=ot.socialHUD
var _t=e("./img/font/inknut24.20.json")
var ut=e("./img/font/ubuntu32.20.json")
var dt=e("./in_app_purchases/iap_client_worlds").iapWorldsStartup
var ft=e("./inventory.js")
var vt=e("./item_anims.js")
var ht=e("./item_info_view.js")
var pt=ht.itemInfoViewClear
var mt=ht.itemInfoViewTick
var gt=e("./items.js").itemsTick
var Et=e("./items.js")
var yt=e("./layout.js")
var Tt=yt.CORNER_BUTTON_MARGIN
var It=yt.layoutCameraFull
var St=yt.layoutTick
var At=yt.menuUpperLeft
var wt=e("./layout.js")
var Lt=e("./loading_custom.js")
var Rt=Lt.loadingCustomDrawNow
var xt=Lt.loadingCustomInit
var Ot=e("./localization/localization")
var bt=Ot.L
var Nt=Ot.localizationPastStartup
var Ct=Ot.localizationSetChatUI
var Mt=e("./lods.js")
var Dt=e("./main_menu.js")
var Pt=Dt.elevatedWarn
var kt=Dt.mainMenuStartup
var Bt=e("./main_menu.js")
var Ut=e("./megachunk_client.js")
var Gt=e("./menu.js")
var Ft=Gt.doQuickSlotMenu
var Wt=Gt.menuWantsQuickbarScroll
var jt=e("./menu.js")
var Ht=e("./mobs.js")
var zt=Ht.mobsDraw
var Vt=Ht.mobsDrawLate
var Yt=Ht.mobsStartup
var qt=Ht.mobsTick
var Kt=e("./mod_api_host.js").modAPIStartup
var Zt=e("./particle_system.js")
var Xt=e("./photo_controller.js").PhotoController
var Qt=e("./photo_mode.js")
var Jt=Qt.copyToClipboardCheck
var $t=Qt.photoCanMove
var er=Qt.photoCanMoveChar
var tr=Qt.photoCanMovePht
var rr=Qt.photoModeActive
var ar=Qt.photoModeCancel
var ir=Qt.photoModeTick
var or=Qt.shiftPhotoBounds
var nr=e("./proc_gen.js")
var sr=e("./proc_gen_debug.js")
var lr=e("./prop_edit.js").propEditDialog
var cr=e("./props.js")
var _r=e("./quickbar.js")
var ur=e("./quickbar.js").tickQuickBar
var dr=e("./race_ui").racePanel
var fr=e("./red_dot.js").redDotStartup
var vr=e("./settlement.js").settlementBeamDraw
var hr=e("./share_menu.js")
var pr=hr.shareButton
var mr=hr.shareMenu
var gr=e("./sky.js")
var Er=gr.skyDraw
var yr=gr.skyEdit
var Tr=gr.skyShift
var Ir=gr.skyStartup
var Sr=gr.skyStartupEarly
var Ar=gr.skyTick
var wr=e("./social_referral.js").socialReferralStartup
var Lr=e("./status.js")
var Rr=e("./styles.js")
var xr=Rr.STYLE_CHAT
var Or=Rr.chat_style_default
var br=Rr.chat_style_error
var Nr=Rr.chat_style_link
var Cr=Rr.chat_style_link_hover
var Mr=Rr.chat_style_system
var Dr=Rr.color_black
var Pr=Rr.styles_per_role
var kr=e("./task_sched.js")
var Br=e("./todo_list.js").todoListTick
var Ur=e("./tutorial.js")
var Gr=Ur.tutorialForcingMenu
var Fr=Ur.tutorialPostStateTick
var Wr=Ur.tutorialReset
var jr=Ur.tutorialStartup
var Hr=Ur.tutorialTick
var zr=e("./ui_sounds.js")
var Vr=e("./ui_util.js")
var Yr=e("./ui_util.js").uiUtilStartup
var qr=e("./ui_util_2.js").uiUtil2Startup
var Kr=e("./user_data.js")
var Zr=Kr.userAttribTick
var Xr=Kr.userDataIsWaiting
var Qr=Kr.userDataStartWaiting
var Jr=Kr.worldReadOnly
var $r=e("./user_data.js")
var ea=e("./user_info_view.js")
var ta=ea.userInfoViewClear
var ra=ea.userInfoViewTick
var aa=ea.viewUser
var ia=e("./user_party.js").userPartyInit
var oa=e("./voxel_atlas.js").makeAtlas
var na=e("./voxel_chunk_manager.js")
var sa=e("./voxel_data.js").recalcAtlasParams
var la=e("./voxel_data.js")
var ca=e("./voxel_data_xraw").voxelDataXRAWStartup
var _a=e("./voxel_gen.js")
var ua=e("./waygate_ui.js")
var da=ua.waygateSuppressAutoActivate
var fa=ua.waygateUITick
var va=e("./waygate_upgrade.js").waygateUpgradeStartup
var ha=e("./world_comm.js")
var pa=ha.getPerm
var ma=ha.getWorldID
var ga=ha.leaveWorld
var Ea=ha.transact
var ya=ha.worldAutoConnect
var Ta=ha.worldCommStartup
var Ia=ha.worldGetRoles
var Sa=ha.worldIsWaiting
var Aa=e("./world_init.js")
var wa=Aa.worldInitStart
var La=Aa.worldInitTick
var Ra=e("./world_metadata.js")
var xa=Ra.worldMetadata
var Oa=Ra.worldMetadataDefaultWaygatePos
var ba=Ra.worldMetadataReset
var Na=e("./worlds_sound.js").playSound
var Ca=e("./worlds_soundscape.js")
var Ma=Ca.soundscapeStartup
var Da=Ca.soundscapeStop
var Pa=Ca.soundscapeTick
var ka=Math.abs,Ba=Math.floor,Ua=Math.round,Ga=Math.PI
var Fa=[{name:pe,link_base:"https://worlds.test.frvr.com/"},{name:me,link_base:"https://worlds.test2.frvr.com/"},{name:he,link_base:"https://worlds.staging.frvr.com/"},{name:ve,link_base:"https://worlds.frvr.com/"},{name:fe,link_base:"http://localhost:3000/"}]
i.ENVIRONMENTS=Fa
Z.FLOATERS_MIN=40
Z.FLOATERS_MAX=49
Z.PHOTO_BORDER=50
Z.FLOATER_INTERACT=60
Z.GEMS_HUD=90
Z.TODO_LIST=90
Z.QUICKBAR=100
Z.MENUBUTTON=120
Z.UI=140
Z.PAPERDOLL=180
Z.USER_INFO_VIEW=190
Z.DIG_INDICATOR=200
Z.CHAT=210
Z.CHAT_FOCUSED=210
Z.DRAG=400
Z.TUT=900
Z.TUT_INDICATOR=910
Z.SETTLEMENT_ANIMATE_COMPLETE=920
Z.EDITVOLUME_STATUS=930
Z.ITEM_INFO_VIEW=950
Z.POPUP_MENU=960
Z.CROSSHAIR=1e3
Z.MODAL=1e3
Z.TODO_LIST_FLASH=1020
Z.STATUS=1800
Z.WAYGATE_FX=1900
Z.LOADING=2e3
Z.CHAT_WHILE_LOADING=2200
Z.TOOLTIP=2700
Z.PHOTO_FLASH=2800
var Wa=.1
var ja=5e3
var Ha=10
var za=2e4
var Va=false
i.omp=Va
var Ya=false
i.main_active=Ya
var qa
i.char_controller=qa
var Ka
i.pht_controller=Ka
function charControllerPos(){return qa.pos}var Za=true
var Xa=false
function setExploreCanMoveChar(e){Za=e}function setExploreCanMovePht(e){Xa=e}var Qa
i.chat_ui=Qa
var Ja
i.cmdParse=Ja
var $a
i.instance_uid=$a
var ei
var ti=Q.seconds()
i.walltime_seconds=ti
var ri=le()
i.flashlight_pos_vs=ri
var ai=false
function blockImageUpload(){return ai&&!pa("sysadmin")}function autoTextureUpload(t){["drag","dragstart","dragend","dragover","dragenter","dragleave","drop"].forEach(function(e){t.addEventListener(e,function(e){e.preventDefault()
e.stopPropagation()})})
t.addEventListener("drop",function(e){e.preventDefault()
e.stopPropagation()
var t=e.dataTransfer.files[0]
if(!t||!t.type||!t.type.startsWith("image/"))return
var a=Y.cname(t.name)
var s=Y.findTexForReplacement(t.name)
if(!s){a="voxels"
s=la.pack_texture}var r=new FileReader
r.onload=function(e){var t
function makeAtlasFilter(e,t,r){var a=Ae[e]
var i=oa(a,s,r)
if("primary"===e||"util"===e){var o=a.tiles_per_row
var n=Ba(r.width/o)
sa(e,n,i.width,i.height)}return i}for(var r in Ae)if(Ae[r].fn===a)t=makeAtlasFilter.bind(null,r)
ai=true
s.loadURL(e.target.result,t)
q()}
r.readAsDataURL(t)})}function shiftOrigin(e){la.shift(e)
console.log("Origin shift -> "+la.origin_chunk)
oe(e,e,-ue)
qa.shift(e)
Ka.shift(e)
if(rr())or(e)
Tr(e)
Ue.shift(e)
Mt.shift(e)
jt.shift(e)
vt.shift(e)
Ut.shift(e)
Zt.shift(e)}var ii=le()
function checkOriginShift(){ne(ii,qa.pos,1/ue)
var e=ie(ii)
if(e>=4)if(e>na.claim_dist_sq&&!I.defines.FREECAM){startLoading(loadReStartStreaming)
Rt()}else shiftOrigin(ii)}function originShiftStartUp(){ne(ii,qa.pos,1/ue)
shiftOrigin(ii)}var oi
function loadWaitForNearbyChunks(){na.updateChunks(50)
if(I.defines.CHUNKMAN)na.drawChunkManDebug()
et.draw(10,110)
var e=na.nearbyChunksWaiting()+Qe()
e+=Sa()
if(!Xe().receivedEntReady())e++
if(!e){if(I.defines.INVENTORY)toggleMenuPage(jt.INVENTORY)
if(I.defines.BUILD)toggleMenuPage(jt.BUILD)
if(I.defines.SETTINGS)toggleMenuPage(jt.SETTINGS)}return e}function loadReStartStreaming(){originShiftStartUp()
na.restartStreaming()
Mt.startStreaming()
return(oi=loadWaitForNearbyChunks)()}function loadNeedInitTick(){var e=loadWaitForNearbyChunks()
if(e)return e
if(e=La())return e
return(oi=loadWaitForNearbyChunks)()}function loadNeedInitWait(){var e=La()
a(e)
return e}function loadNeedInitStart(){_a.seedWorld()
oi=loadNeedInitWait
wa(function(e){qa.load(e)
qa.enterWorldInit()
originShiftStartUp()
na.startStreaming()
Mt.startStreaming()
oi=loadNeedInitTick})
return oi()}function loadStartStreaming(){qa.load(Oa())
qa.enterWorldInit()
_a.seedWorld()
originShiftStartUp()
na.startStreaming()
Mt.startStreaming()
return(oi=loadWaitForNearbyChunks)()}function loadWaitingForWorldData(){var e=0
if(!xa())e++
if($r.isWaiting())e++
if(!(e+=Sa()))if(xa().need_init)oi=loadNeedInitStart
else oi=loadStartStreaming
if(I.defines.CHUNKMAN)na.drawChunkManDebug()
et.draw(10,110)
return e+1}var ni=0
i.loading_finished_timestamp=ni
function startLoading(e,r,t){r=r||Date.now()
oi=e
j(true,"loading")
var a=false
xt({extra_frames:6,state:tick,fade_time:250,start:function start(){},tick:function startLoadingTick(){if(Va){Bt.drawCheckConnectionMessage()
tickOMP()}Qa.setZOverride(Z.CHAT_WHILE_LOADING)
var e=!this.finished
if(e)Qa.run({hide:Xr(),pointerlock:!x.touch_mode})
var t=oi()
if(!t&&!a){a=true
console.log("Leaving loading state after "+(Date.now()-r)+"ms")}if(e)Qa.runLate()
return t},on_finished:function on_finished(){i.loading_finished_timestamp=ni=I.frame_timestamp
if(t)t()}})}function startLoad(e){var t=Date.now()
ar()
jt.clear()
Lr.clear()
ba()
Wr()
la.reset()
Qr(false)
Me()
ei=null
startLoading(loadWaitingForWorldData,t,e)}function startMain(e,t){a(!Va)
i.omp=Va=e
i.main_active=Ya=true
if(Va)i.instance_uid=$a=N()
else i.instance_uid=$a="local"
startLoad(t)
if(!Va)$r.init()
lt()}var si=[]
var li=false
var ci=false
function returnToMainMenu(e){if(!e&&ci){li=true
return}var t=Va
i.omp=Va=false
la.reset()
if(t){if(si.length){te(si)
si.length=0}ga()
i.instance_uid=$a="local"}ar()
menuExit()
if(lr())K.modalDialogClear()
i.main_active=Ya=false
Ue.reset()
if(!ya())qa.clearPos()
Da()
I.setState(Bt.mainMenuInit)}function logCaps(){var T=false
function logFinal(e,t){if(T)return
if(M())return
T=true
function supportsWebAssembly(){try{return window.WebAssembly&&"function"===typeof window.WebAssembly.instantiate||false}catch(e){return false}}try{var r=I.canvas.getBoundingClientRect()
var a=gl.getParameter(gl.MAX_FRAGMENT_UNIFORM_VECTORS)
var i=gl.getParameter(gl.MAX_RENDERBUFFER_SIZE)
var o=gl.getParameter(gl.MAX_TEXTURE_SIZE)
var n=gl.getParameter(gl.MAX_VARYING_VECTORS)
var s=gl.getParameter(gl.MAX_VERTEX_ATTRIBS)
var l=gl.getParameter(gl.MAX_VERTEX_UNIFORM_VECTORS)
var c=gl.getParameter(gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS)
var _=gl.getSupportedExtensions()
var u=gl.getParameter(gl.VENDOR)
var d=gl.getParameter(gl.RENDERER)
var f="unavailable"
var v="unavailable"
var h=gl.getExtension("WEBGL_debug_renderer_info")
if(h){f=gl.getParameter(h.UNMASKED_VENDOR_WEBGL)
v=gl.getParameter(h.UNMASKED_RENDERER_WEBGL)}var p=I.canvas.clientWidth
var m=I.canvas.clientHeight
var g=ka(r.width-p)>2||ka(r.height-m)>2
var E=window.devicePixelRatio||1
var y={type:"caps",dpr:E,client_width:p,client_height:m,dpcbsw:e,dpcbsh:t,dpcbs_mismatch:Boolean(e>0&&(Ua(r.width*E)!==e||Ua(r.height*E)!==t)),rect_width:r.width,rect_height:r.height,rect_mismatch:g,screen_width:window.screen.width,screen_height:window.screen.height,max_fragment_uniform_vectors:a,max_renderbuffer_size:i,max_texture_size:o,max_varying_vectors:n,max_vertex_attribs:s,max_vertex_uniform_vectors:l,max_vertex_texture_units:c,vendor:u,renderer:d,vendor_unmasked:f,renderer_unmasked:v,ua:window.navigator.userAgent,webgl:I.webgl2?2:1,supported_extensions:_,wasm:supportsWebAssembly()}
b().send("log",y)}catch(e){b().send("log",{type:"caps",error:e.toString()})}}if(window.ResizeObserver&&false){var i=setTimeout(logFinal.bind(null,-3),3e4)
try{var o=new window.ResizeObserver(function(e){clearTimeout(i)
var t=e&&e[0]
var r=t&&t.devicePixelContentBoxSize&&t.devicePixelContentBoxSize[0].inlineSize
var a=t&&t.devicePixelContentBoxSize&&t.devicePixelContentBoxSize[0].blockSize
o.disconnect()
logFinal(r,a)})
o.observe(I.canvas,{box:["device-pixel-content-box"]})}catch(e){logFinal(-4)}}else logFinal(-1)}X.register({key:"autoanon"})
X.register({key:"msstart"})
function startup(){X.startup({title_transformer:function title_transformer(e){return e?bt.$(bt.WINDOW_TITLE_COMPOSITE,e):bt.WINDOW_TITLE}})
if(h)X.set("msstart","msstart")
F()
k(.4)
if(!I.defines.NOWORKERS)$.setNumWorkers(3)
kr.startup()
P().onceConnected(logCaps)
z()
wr()
ia()
K.scaleSizes(3.125)
K.setPanelPixelScale(.78125)
K.setTooltipWidth(300,.5)
K.setFontHeight(24)
K.setModalSizes(100)
G(.25,.5)
K.setButtonsDefaultLabels({cancel:bt.BTN_CANCEL,no:bt.BTN_NO,ok:bt.BTN_OK,retry:bt.BTN_RETRY,yes:bt.BTN_YES})
K.setProvideUserStringDefaultMessages(bt.MSG_COPY_TEXT_SUCCESS,bt.MSG_COPY_TEXT_FAILURE)
se(K.color_panel,1,1,.8,1)
autoTextureUpload(I.canvas)
U.addGlobal("flashlight_pos_vs",ri)
Sr()
g(["gaussian_blur","copy","color_matrix"])
Ke()
i.char_controller=qa=new Ve
i.pht_controller=Ka=new Xt
je()
i.chat_ui=Qa=u({styles:{def:Or,error:br,link:Nr,link_hover:Cr,system:Mr,SYSADMIN:Pr.SYSADMIN[xr],TEAM:Pr.TEAM[xr],OWNER:Pr.OWNER[xr],ADMIN:Pr.ADMIN[xr],BUILDER:Pr.BUILDER[xr],AREABUILDER:Pr.AREABUILDER[xr],READONLY:Pr.READONLY[xr],SPECTATOR:Pr.SPECTATOR[xr]},border:12,w:524,inner_width_adjust:-2,max_len:_e,url_match:/((?:https?:\/\/)?worlds\.(?:\w+\.)?frvr\.com\/(?:(?:blueprint|photo)\/\w+|w\/\d+(?:\?[^\s]+)?|u\/[a-zA-Z0-9_$]+\/go|\?[^\s]+))/g,url_info:/((?:blueprint|photo)\/\w+|w\/\d+(?:\?[^\s]+)?|u\/[a-zA-Z0-9_$]+\/go|\?[^\s]+)/,hide_disconnected_message:true,volume_join_leave:.1,msg_out_err_delay:.3,user_context_cb:function user_context_cb(e){return aa(e)},emote_cb:function emote_cb(e){if(e.match(/wave/i))qa.wave()
else if(e.match(/\bsits?\b/i))qa.sitOnBlock()},classifyRole:ge})
Qa.setGetRoles(Ia)
i.cmdParse=Ja=Qa.cmdParse.bind(Qa)
Ct(Qa)
R(function(e){Na("msg_in")
Qa.addChat(e)})
I.onLoadMetrics(function(e){Ie("load_time_total",e.time_total,"load_time")
Ie("load_time_js_load",e.time_js_load,"load_time")
Ie("load_time_js_init",e.time_js_init,"load_time")
Ie("load_time_resource_load",e.time_resource_load,"load_time")})
l()
kt()
wt.startup()
la.startup()
ca()
nr.startup()
Yr()
qr()
Ue.startup()
Et.itemLocalizationStartup()
ft.startup()
Et.startup()
_r.startup()
cr.startup()
Ir()
Je.startup()
jt.startup()
Mt.startup()
Bt.startup()
Yt()
vt.startup()
Ta()
ee.startup()
we.startup()
Ma()
jr()
$e()
Kt()
be()
it()
fr()
Oe()
o()
va()
tt()
at()
dt()
H({img:Vr.sprite,img_color:Dr,frame:Vr.USER_PROFILE})
Et.itemCheck()
setTimeout(checkInactive,1e3)
J(/\.(fp|vp|vm|pal)$|^particles\//)
Ie("game_loaded")}var _i
function toggleMenuPage(e,t){ta()
if(Ya&&jt.page===e)_i=true
else{jt.init(e,t||(jt.active()?jt.KEEP:null))
Pe()
x.pointerLockExit()}}var ui={in_event_cb:x.pointerLockEnter}
function menuHotkeys(){var e=!x.touch_mode&&jt.page===jt.INVENTORY?ui:null
if(x.keyDownEdge(x.KEYS.I,e))toggleMenuPage(jt.INVENTORY)
var t=!x.touch_mode&&jt.page===jt.SOCIAL?ui:null
if(x.keyDownEdge(x.KEYS.P,t))toggleMenuPage(jt.SOCIAL)
var r=!x.touch_mode&&jt.page===jt.WORLD_INFO_VIEW_SELF?ui:null
if(x.keyDownEdge(x.KEYS.O,r))toggleMenuPage(jt.WORLD_INFO_VIEW_SELF)
var a=!x.touch_mode&&jt.isBuildMenu()?ui:null
if(!Jr()&&(x.keyDownEdge(x.KEYS.B,a)||x.padButtonDownEdge(x.PAD.X)||!Ft()&&x.keyDownEdge(x.KEYS.Q,a)))toggleMenuPage(jt.BUILD)}var di=false
function menuExitGeneric(){di=true}function menuExitClear(){di=false}var fi
var vi
function menuButton(e,t){var r=!x.touch_mode&&t?ui:null
var a=null
if(!e)if(!B.split_build)a=["new_build_settlement"]
var i={x:At()?Tt:_.w()-K.button_height-Tt,y:0,z:Z.MENUBUTTON,img:Vr.sprite,frame:e?Vr.X:Vr.MENU,shrink:.7,colors:_r.quickbar_colors_selected,disabled:false,tooltip:jt.prefixShortcutKey("E",e?bt.LBL_EXIT_MENU:bt.LBL_MENU),in_event_cb:r&&r.in_event_cb,hook:a}
fi=x.keyDownEdge(x.KEYS.E,r)
if(e&&x.keyDownEdge(x.KEYS.R,r))di=true
if(x.keyDownEdge(x.KEYS.ESC))vi=I.frame_index
else if(x.keyDown(x.KEYS.ESC)){if(vi===I.frame_index-1)vi=I.frame_index}else vi=0
if(!I.defines.NOUI&&!(Ue.doingDragPlace()&&x.touch_mode)&&K.buttonImage(i)||vi&&x.keyUpEdge(x.KEYS.ESC,r)||fi||e&&di||x.padButtonDownEdge(x.PAD.B)){di=false
ta()
return true}return di=false}function menuExit(){da()
pt()
Bt.menuExitClearParams()
jt.clear()
if(I.stateActive(Bt.mainMenu)&&jt.getMenuLastPage()===jt.CHARACTER_CUSTOMIZATION)I.setState(Bt.welcomeScreenInit)}function isMenuPage(e){return jt.page===e}var hi=false
function menuConsumeExit(){hi=true
if(_i){_i=false
return true}return false}function menuConfirmExit(){return K.modalDialog({title:bt.DLG_EXIT_CONFIRMATION_TITLE,text:bt.DLG_EXIT_CONFIRMATION_MSG,buttons:{yes:{label:bt.BTN_YES,in_event_cb:function in_event_cb(){x.pointerLockEnter()
_i=true}},no:{label:bt.BTN_NO}}})}function stateMenu(){var e=Gr()
_i=e?false:menuButton(true,!hi)||_i
hi=false
if(!jt.isQuickMenu()){pr()
dr()}verifyFrameTransactions("stateMenu:top")
if(!e)menuHotkeys()
verifyFrameTransactions("stateMenu:after hotkeys")
qa.update(false)
verifyFrameTransactions("stateMenu:after char controller")
if(Fe()===Ka){Ka.update(false)
verifyFrameTransactions("stateMenu:after photo controller")}checkOriginShift()
ze()
verifyFrameTransactions("stateMenu:after camera")
if(jt.tickMenu()&&!e)_i=true
verifyFrameTransactions("stateMenu:after tick")
Ue.tickBuildModeInactive()
verifyFrameTransactions("stateMenu:after tickBuildModeInactive")
if(!x.touch_mode){var t=jt.getMenuPage()===jt.CHARACTER_CUSTOMIZATION&&Ye()
if(!e&&x.click(!t?ui:null))if(t)menuConfirmExit()
else _i=true}if(_i){_i=false
menuExit()}}function stateExplore(){profilerStart("buttons")
if(menuButton(false,false)){if(fi)Pe()
jt.init(jt.DEFAULT)}else if(x.keyDownEdge(x.KEYS.G)&&Ue.interactableProp())Ue.interactableProp().interact(null,null)
pr()
dr()
menuHotkeys()
ct()
profilerStopStart("char controller")
We()
qa.update(Za)
if(Fe()===Ka)Ka.update(Xa)
profilerStop()
checkOriginShift()
ze()
qt()
profilerStart("buildMode")
verifyFrameTransactions("before build mode")
Ue.tickBuildMode()
verifyFrameTransactions("after build mode")
profilerStop()
nt()
st()}function statePhotoMode(){var e=ir()
qa.update(er())
Ka.update(tr())
checkOriginShift()
ze()
return e}function addBatchedSend(e){a(Va)
si.push(e)}function tickOMP(){Bt.checkConnection()
Ut.megachunkTickOMP()
if(si.length&&!C()){te(si)
si.length=0}}function getFrameTransactionSet(){return ei=ei||Ee()}function getFrameTransaction(){getFrameTransactionSet()
return ei.trans()}function verifyFrameTransactions(e){if(ei)for(var t=0;t<ei.numTransactions();++t)if(!ei.get(t).ops.length)a(false,"Queued frame transaction with no ops at "+e)}function runTransaction(){if(ei&&!C()){var e=ei
ei=null
Ea(e)}}var pi
function postTick(e){(pi=pi||[]).push(e)}var mi=-1
var gi
function checkInactive(){profilerStart("checkInactive")
setTimeout(checkInactive,1e3)
var e=I.frame_index
if(e===mi){if(5===++gi){na.releaseClaimed()
if(Va)j(false,Jr()?"view":"build",{world_id:ma()})
else j(false,"offline",null)}}else{gi=0
mi=e}profilerStop("checkInactive")}var Ei
function isQuickbarVisible(){return Ei}var yi
function tick(){profilerStart("main.js:tick")
profilerStart("top")
ci=true
Ue.tempPointReset()
i.walltime_seconds=ti=Q.seconds()
Ei=!rr()&&!jt.menuHidesQuickbar()
St(Ei)
It()
Pt()
Bt.drawCheckConnectionMessage()
if(Wt()&&Ei)_r.quickbarScrollView()
if(!jt.active()&&!(rr()&&!$t())&&!K.isMenuUp())V()
Qa.run({hide:jt.active()||!Va,pointerlock:!x.touch_mode&&!jt.active()})
if(Qa.isFocused())Pe()
if(jt.isBuildMenu()){Ce()
It()}if(I.defines.SKYEDIT&&!I.defines.NOUI)yr()
Jt()
rt()
mr()
mt()
Hr()
if(!rr())Br(jt.active())
ra()
if(!Be())Zr(qa.underwater.head)
if(Ei){profilerStopStart("quickbar")
ur(jt.active())}verifyFrameTransactions("before state tick")
if(rr()){profilerStopStart("statePhotoMode")
yi=statePhotoMode()
qt()}else{yi=(B.camera_view?B.fov_third:B.fov)*Ga/180
if(jt.active()){profilerStopStart("stateMenu")
stateMenu()
verifyFrameTransactions("after menu")
qt()}else{profilerStopStart("stateExplore")
stateExplore()}}profilerStopStart("after state")
ze()
Fr()
Ar(ke())
It()
fa(!jt.active()&&!rr())
runTransaction()
Ze()
gt()
Pa()
if(Va){tickOMP()
j(true,Jr()?"view":Be()?"build":"explore",{world_id:ma()})}else j(true,"sp",null)
Lr.tickStatus()
if(I.defines.NOLODS)I.setZRange(Wa,ja)
else I.setZRange(Ha,za)
I.start3DRendering({fov:yi})
if(!I.defines.NOLODS){He()
Mt.tickLODs()
Er()
vr(true)
gl.depthMask(true)
gl.clear(gl.DEPTH_BUFFER_BIT)
gl.disable(gl.BLEND)
I.setZRange(Wa,ja)}He()
zt()
cr.tickProps()
profilerStopStart("tickVCM")
na.tickVCM()
profilerStopStart("other draw")
m.opaqueDraw()
Zt.updateParticleSystems()
Le()
vt.tickItemAnims()
if(!Jr()&&!rr())xe()
if(I.DEBUG&&x.keyDownEdge(x.KEYS.M))I.defines.PROCGEN=!I.defines.PROCGEN
if(I.defines.PROCGEN)sr.drawDebug()
if(I.defines.MEGACHUNK)Ut.drawDebug()
if(x.keyDownEdge(x.KEYS.F8)){I.defines.NOUI=!I.defines.NOUI
B.set("show_metrics",I.defines.NOUI?0:1)}if(I.defines.CHUNK)na.drawDebug()
if(I.defines.CHUNKMAN)na.drawChunkManDebug()
la.tickVD()
if(I.defines.NOLODS)Er()
m.alphaDraw()
vr(false)
profilerStopStart("bottom")
runTransaction()
et.draw(10,110)
if(!jt.active()&&!rr())Vt()
if(pi)te(pi,pi=null)
Qa.runLate()
ci=false
if(li){li=false
returnToMainMenu(true)}profilerStop()
return profilerStop("main.js:tick")}function waitForFacebook(){if(L())I.setState(Bt.welcomeScreenInit)}function doNetInit(){D({engine:I,ver:de,cmd_parse:p,auto_create_user:X.get("autoanon")})}function main(){var e
re.dothrow(I.DEBUG)
if(I.DEBUG)Array.prototype.foo="bar"
if(!window.Worker){window.alert("WebWorkers required.")
return}S("ver",de)
if(f)T()
var t=null!=(e=window.conf_env)?e:""
if(0===t.length){t=null
var r=X.getURLBase()
for(var a=0;a<Fa.length;a++){var i=Fa[a]
if(i.link_base===r){t=i.name
break}}}E(Fa,t)
if(v)n.call("showgame",{})
Se.startup()
w()
s()
B.runTimeDefault("fov",c?60:50)
B.runTimeDefault("render_scale",c?1:.5)
if(I.DEBUG)doNetInit()
if(!I.startup({high:true,game_width:1e3,game_height:1e3,state:window.FBInstant?waitForFacebook:Bt.welcomeScreenInit,show_fps:window.FBInstant?false:void 0,pixely:false,viewport_postprocess:false,znear:Wa,zfar:ja,antialias:Boolean(B.aa),do_borders:false,do_sounds:false,map_analog_to_dpad:false,pad_to_touch:x.PAD.RT,pad_focus_dpad:true,safearea_ignore_bottom:true,font:{info:ut,texture:"font/ubuntu32.20"},title_font:{info:_t,texture:"font/inknut24.20"},ui_sprites:{color_set_shades:[.8,1,1],button:{name:"button",ws:[40,48,40],hs:[256]},button_rollover:null,button_down:{name:"button_down",ws:[40,48,40],hs:[256]},button_disabled:{name:"button_disabled",ws:[40,48,40],hs:[256]},panel:{name:"panel",ws:[40,48,40],hs:[40,176,40]},slider:{name:"slider",ws:[38,4,38],hs:[51]},slider_handle:{name:"slider_handle",ws:[28],hs:[41]},menu_entry:{name:"menu_entry",ws:[40,48,40],hs:[256]},menu_selected:{name:"menu_selected",ws:[40,48,40],hs:[256]},menu_down:null,menu_header:{name:"menu_header",ws:[33,10,213],hs:[256]},scrollbar_bottom:{name:"scrollbar_bottom",ws:[32],hs:[32]},scrollbar_trough:{name:"scrollbar_trough",ws:[32],hs:[32]},scrollbar_top:{name:"scrollbar_top",ws:[32],hs:[32]},scrollbar_handle_grabber:{name:"scrollbar_handle_grabber",ws:[32],hs:[32]},scrollbar_handle:{name:"scrollbar_handle",ws:[32],hs:[8,16,8]},progress_bar:{name:"progress_bar",ws:[20,88,20],hs:[128]},progress_bar_trough:{name:"progress_bar_trough",ws:[21,86,21],hs:[128]}},ui_sounds:zr}))return
Nt()
if(!I.DEBUG)doNetInit()
Te()
startup()}},{"../common/globals.js":197,"../common/roles_common":206,"../common/world_trans.js":213,"../frvr/client/platforms/adapter":217,"../frvr/client/xplay/host/host":228,"../frvr/client/xplay/login":233,"../glov/client/abtests_client":237,"../glov/client/browser.js":239,"../glov/client/camera2d.js":241,"../glov/client/chat_ui.js":242,"../glov/client/client_config":243,"../glov/client/cmds.js":244,"../glov/client/draw_list.js":246,"../glov/client/effects.js":249,"../glov/client/engine.js":250,"../glov/client/environments":254,"../glov/client/error_report.js":255,"../glov/client/fbinstant.js":257,"../glov/client/filewatch.js":259,"../glov/client/input.js":271,"../glov/client/local_storage":274,"../glov/client/net.js":279,"../glov/client/scroll_area.js":289,"../glov/client/settings.js":291,"../glov/client/shaders.js":293,"../glov/client/slider.js":294,"../glov/client/snapshot.js":295,"../glov/client/social":296,"../glov/client/spot.js":300,"../glov/client/textures.js":304,"../glov/client/ui.js":306,"../glov/client/urlhash.js":307,"../glov/client/walltime.js":308,"../glov/client/webfs.js":309,"../glov/client/worker_comm.js":311,"../glov/client/worker_perf.js":312,"../glov/common/util.js":330,"../glov/common/verify.js":331,"../glov/common/vmath":332,"./analytics":5,"./app_settings.js":12,"./atlas_params.json":13,"./baking.js":17,"./block_intersections.js":21,"./bluebox_edit_list.js":22,"./blueprint.js":24,"./build_menu.js":26,"./build_mode.js":27,"./camera.js":28,"./character_controller.js":30,"./character_customization":31,"./client_cmds.js":34,"./client_entities.js":35,"./continent_loader.js":38,"./cosmetics.js":55,"./costume_edit.js":56,"./debug.js":62,"./draw_sprite3d.js":70,"./editvolume_clear.js":71,"./external_users/external_users_client_worlds":78,"./fbinstant_worlds.js":80,"./huds.js":87,"./img/font/inknut24.20.json":89,"./img/font/ubuntu32.20.json":90,"./in_app_purchases/iap_client_worlds":93,"./inventory.js":94,"./item_anims.js":96,"./item_info_view.js":97,"./items.js":98,"./layout.js":99,"./loading_custom.js":105,"./localization/localization":108,"./lods.js":109,"./main_menu.js":113,"./megachunk_client.js":116,"./menu.js":117,"./mobs.js":120,"./mod_api_host.js":121,"./particle_system.js":126,"./photo_controller.js":127,"./photo_mode.js":128,"./proc_gen.js":132,"./proc_gen_debug.js":135,"./prop_edit.js":140,"./props.js":141,"./quickbar.js":142,"./race_ui":144,"./red_dot.js":146,"./settlement.js":148,"./share_menu.js":150,"./sky.js":151,"./social_referral.js":153,"./status.js":156,"./styles.js":160,"./task_sched.js":161,"./todo_list.js":165,"./tutorial.js":166,"./ui_sounds.js":167,"./ui_util.js":168,"./ui_util_2.js":169,"./user_data.js":170,"./user_info_view.js":171,"./user_party.js":172,"./voxel_atlas.js":173,"./voxel_chunk_manager.js":174,"./voxel_data.js":175,"./voxel_data_xraw":176,"./voxel_gen.js":177,"./waygate_ui.js":179,"./waygate_upgrade.js":180,"./world_comm.js":182,"./world_init.js":185,"./world_metadata.js":186,"./worlds_sound.js":187,"./worlds_soundscape.js":188,assert:void 0}],113:[function(e,t,r){"use strict"
r.startup=startup
r.elevatedWarn=elevatedWarn
r.showCurrentGems=showCurrentGems
r.ensureDefaultSeed=ensureDefaultSeed
r.worldInfoCacheClear=worldInfoCacheClear
r.getWorldInfo=getWorldInfo
r.getWorldInfoAsync=getWorldInfoAsync
r.isDoingWorldOp=isDoingWorldOp
r.createWorld=createWorld
r.deleteWorld=deleteWorld
r.forgetWorld=forgetWorld
r.drawBG=drawBG
r.drawCheckConnectionMessage=drawCheckConnectionMessage
r.checkConnection=checkConnection
r.enterPasswordInit=enterPasswordInit
r.createWorldUIInit=createWorldUIInit
r.requireLogin=requireLogin
r.menuExitClearParams=menuExitClearParams
r.welcomeScreen=welcomeScreen
r.mainMenu=mainMenu
r.setPageFromId=setPageFromId
r.mainMenuInit=mainMenuInit
r.welcomeScreenInit=welcomeScreenInit
r.mainMenuStartup=mainMenuStartup
r.URL_REDDIT=r.URL_DISCORD=r.URL_DMCA=r.URL_GDPR=r.URL_TOS=r.URL_PRIVACY=void 0
function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]
for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))e[a]=r[a]}return e}).apply(this,arguments)}var H="https://frvr.com/legal/samsung/?hideLangSelector=1#PrivacyPolicy"
r.URL_PRIVACY=H
var z="https://frvr.com/legal/samsung/?hideLangSelector=1#TermsofService"
r.URL_TOS=z
var d="https://frvr.com/legal/samsung/?hideLangSelector=1#gdpr"
r.URL_GDPR=d
var f="https://frvr.com/dmca/?hideLangSelector=1"
r.URL_DMCA=f
var v="https://discord.gg/WorldsFRVR"
r.URL_DISCORD=v
var h="https://www.reddit.com/r/WorldsFRVR"
r.URL_REDDIT=h
var a=e("../frvr/client/platforms/adapter.js").getPlatformAdapter
var i=e("../glov/client/browser.js")
var V=e("../glov/client/camera2d.js")
var o=e("../glov/client/client_config.js")
var p=o.PLATFORM_FBINSTANT
var m=o.PLATFORM_IOS
var n=o.PLATFORM_MOBILE
var g=o.PLATFORM_MSSTART
var s=o.PLATFORM_WEB
var E=o.PLATFORM_YANDEX
var l=e("../glov/client/cmds.js").cmd_parse
var c=e("../glov/client/edit_box.js").editBoxCreate
var I=e("../glov/client/engine.js")
var _=e("../glov/client/fbinstant.js")
var Y=_.canFollowOfficialPage
var q=_.canJoinOfficialGroup
var u=e("../glov/client/fscreen.js").fscreenAvailable
var S=e("../glov/client/input.js")
var y=e("../glov/client/link.js")
var T=y.link
var A=y.linkGetDefaultStyle
var w=y.linkText
var L=e("../glov/client/local_storage.js")
var R=e("../glov/client/net.js")
var K=R.netBuildString
var x=R.netClient
var O=R.netDisconnected
var X=R.netSubs
var b=e("../glov/client/scroll_area.js").scrollAreaCreate
var N=e("../glov/client/selection_box.js").dropDownCreate
var C=e("../glov/client/settings.js")
var M=e("../glov/client/shaders.js").shadersRequirePrelink
var D=e("../glov/client/social.js")
var P=D.friendsGet
var k=D.isFriend
var B=D.richPresenceSet
var U=e("../glov/client/spot").spotAsyncActivateButton
var G=e("../glov/client/sprites.js")
var F=e("../glov/client/sprites.js").spriteCreate
var Q=e("../glov/client/ui.js")
var W=e("../glov/client/ui.js").getUIElemData
var J=e("../glov/client/urlhash.js")
var j=e("../glov/client/wsclient.js")
var $=j.ERR_CLIENT_VERSION_NEW
var ee=j.ERR_CLIENT_VERSION_OLD
var te=j.ERR_RESTARTING
var re=e("../glov/common/md5.js")
var ae=e("../glov/common/rand_alea.js").mashString
var ie=e("../glov/common/util.js")
var oe=ie.callEach
var ne=ie.isInteger
var se=e("../glov/common/vmath.js")
var le=se.unit_vec
var ce=se.vec4
var _e=e("../common/waygate_common.js")
var ue=_e.FLAT_SEED_EMPTY
var de=_e.FLAT_SEED_GRASS_ON_STONE
var fe=_e.FLAT_SEED_WATER
var ve=_e.WAYGATE_NAME_LEN
var he=e("../common/world_constants.js")
var pe=he.WORLDINFO_LEVEL_ALL
var me=he.WORLDINFO_LEVEL_BASIC
var ge=e("./account_ui.js").createAccountUI
var Ee=e("./analytics.js")
var ye=Ee.analyticsPostLogin
var Te=Ee.logEvent
var Ie=Ee.logEventOnce
var Se=e("./analytics_ftue.js")
var Ae=Se.FTUE
var we=Se.logEventFTUE
var Le=e("./app_access.js")
var Re=Le.accessAllowFeedback
var xe=Le.accessHasAccess
var Oe=Le.accessSubtitle
var be=e("./client_cmds.js").isElevated
var Ne=e("./continent_loader.js").continentLoaderProvideC0
var Ce=e("./create_first_world.js")
var Me=Ce.createFirstWorldPrompt
var De=Ce.createFirstWorldStartup
var Pe=e("./debug.js")
var ke=e("./fbinstant_worlds.js")
var Be=ke.fbFollowOfficialPage
var Ue=ke.fbJoinOfficialGroup
var Ge=e("./feedback").feedbackShow
var Fe=e("./iframe_content_handlers.js")
var We=e("./layout.js")
var je=We.WIDE
var He=We.layoutCameraTallWideRaw
var ze=We.layoutTick
var Ve=e("./localization/localization").L
var Ye=e("./login_rewards").checkLoginRewardsToClaim
var qe=e("./main.js")
var Ke=e("./menu.js")
var Ze=e("./menu.js").fscreenEnterAndOrient
var Xe=e("./mod_api_host.js")
var Qe=Xe.modContinentDataAvailable
var Je=Xe.modContinentDataGet
var $e=e("./paperdoll")
var et=$e.doPaperDoll
var tt=$e.resetRotation
var rt=e("./photo_mode.js").copyToClipboardCheck
var at=e("./red_dot.js")
var it=at.redDotSeen
var ot=at.setLatestNewsTS
var nt=e("./status.js").tickStatus
var st=e("./styles.js")
var lt=st.color_black
var ct=st.color_gems
var _t=st.colors_light_gold
var ut=st.connection_lost_style
var dt=st.loading_style
var ft=st.menu_header_style
var vt=st.menu_style
var ht=st.menu_style_on_dark
var pt=st.party_info_style
var mt=st.style_gems
var gt=st.sublabel_style
var Et=st.subtitle_style
var yt=e("./tiles.js")
var Tt=e("./ui_util.js")
var It=e("./user_data.js")
var St=e("./user_info_view.js")
var At=St.userGetWorldAndPos
var wt=St.userInfoGet
var Lt=St.userInfoViewTick
var Rt=e("./user_party.js")
var xt=Rt.partyGetHost
var Ot=Rt.partyHasJoinedWorld
var bt=Rt.partyIsActive
var Nt=Rt.partyIsHost
var Ct=Rt.partyWaitingData
var Mt=e("./voxel_gen.js")
var Dt=e("./waygate_ui.js")
var Pt=Dt.waygateLinkUI
var kt=Dt.waygateTexture
var Bt=e("./world_comm.js")
var Ut=Bt.getGemBalance
var Gt=Bt.getPerm
var Ft=Bt.getWorldID
var Wt=Bt.joinWorld
var jt=Bt.whenConnected
var Ht=Bt.worldAutoConnect
var zt=Bt.worldAutoConnectClear
var Vt=Bt.worldAutoConnectIsReconnect
var Yt=Bt.worldGoByURL
var qt=e("./world_info_local_cache.js")
var Kt=qt.worldInfoLocalCacheGet
var Zt=qt.worldInfoLocalCacheUpdate
var Xt=e("./world_metadata.js")
var Qt=Xt.worldMetadata
var Jt=Xt.worldMetadataSet
var $t=Math.ceil,er=Math.floor,tr=Math.max,rr=Math.min,ar=Math.random
J.register({key:"token"})
var ir
var or
var nr
var sr=1
var lr=2
var cr=3
var _r=I.defines.SEARCH?lr:sr
var ur=200
var dr
var fr
var vr
function startup(){dr=F({name:"menu_bg",filter_min:gl.LINEAR,filter_mag:gl.LINEAR})
fr=F({name:"worlds_header",filter_min:gl.LINEAR_MIPMAP_LINEAR,filter_mag:gl.LINEAR})
vr=F({name:"worlds_splash",ext:".jpg",filter_min:gl.LINEAR_MIPMAP_LINEAR,filter_mag:gl.LINEAR})}C.register({auto_fullscreen:{label:"Auto Full-screen",default_value:i.is_android?1:0,type:l.TYPE_INT,range:[0,1],help:u()?Ve.SETTING_AUTO_FULLSCREEN_HELP:Ve.SETTING_NOT_AVAILABLE_ON_DEVICE},show_frozen_worlds:{default_value:1,type:l.TYPE_INT,range:[0,1]}})
var hr=1
var pr=2
var mr={}
function mainMenuSetPage(e){var t=Date.now()
if(e!==mr.page||t-mr.ts>6e4){mr={page:e,ts:t}
L.setJSON("main_menu_page",mr)}}function mainMenuGetPage(){var e=L.getJSON("main_menu_page")
if(e&&Date.now()-e.ts<12e4)return e.page
return-1}var gr=ce(1,0,0,1)
function elevatedWarn(){if(!be())return
Q.drawHollowRect(V.x0Real(),V.y0Real(),V.x1Real(),V.y1Real(),Z.DEBUG,10,0,gr)}function showCurrentGems(e,t,r,a,i){var o=Ut()
ir.drawSizedAligned(mt,e,t,r,i,a,0,0,o+"♦")}function ensureDefaultSeed(){if(!Qt()&&!qe.omp){Jt(void 0,{seed:1,world_type:"flat"})
Mt.seedWorld()}}var Er={}
var yr={}
var Tr=6e4
var Ir=0
function worldInfoCacheClear(){yr={}}var Sr=false
function getWorldInfo(r,e,t,a){r=String(r)
var i=e?pe:me
t=t||Tr
var o=r
if(Sr)o+=":"+i
var n=yr[o]
if(!n)n=yr[o]={err:null,data:Kt(r),timestamp:0,level:0,fetching:false}
if(a){n.cbs=n.cbs||[]
n.cbs.push(a)}if(Date.now()-n.timestamp<t&&n.level>=i)return n.data
if(n.fetching||O())return n.data
if(Ir)return n.data
n.fetching=true;++Ir
function done(e,t){--Ir
n.fetching=false
n.err=e
n.data=e?{err:e}:t
n.level=i
n.timestamp=Date.now()
if(n.cbs)oe(n.cbs,n.cbs=null,n.err,n.data)}if("all"===r)x().send("worldlist_get_all",null,function(e,t){done(e,t)
if(!t)return
var r=t.tabs
if(r)for(var a=0;a<r.length;++a){var i=r[a]
if(i.sections)for(var o=0;o<i.sections.length;++o){var n=i.sections[o]
if(n.trophies)for(var s=0;s<rr(n.worlds.length,3);++s){var l=n.worlds[s]
Er[l]=s+1
var c=yr[l]
if(c&&c.data)c.data.trophy=s+1}}}var _=t.list
if(_)for(var u=0;u<_.length;++u){var d=_[u]
if(Er[d.world_id])d.trophy=Er[d.world_id]}})
else x().send("world_get_info",{world_id:r,level:i},function(e,t){done(e,t)
if(e||!t)return
n.data.trophy=Er[r]
Zt(r,t)})
return n.data}function getWorldInfoAsync(e,t){jt(function(){x().send("world_get_info",{world_id:e,level:pe},t)})}var Ar=false
var wr=false
function isDoingWorldOp(){return wr||Ar}function createWorld(r,a){if("adventure"===r.world_mode){r.world_type="v1"
r.unlimited=false}else r.unlimited=true
if("flat"===r.world_type){r.time_scale=0
r.time_offs=10}Te("world_new",1,r.world_mode,r.world_type)
Ar=true
jt(function(){x().send("world_create",r,function(e,t){if(a)a()
Ar=false
if(e)Q.modalDialog({title:Ve.DLG_ERROR_WORLD_CREATE_TITLE,text:e,buttons:{ok:null}})
else{console.log("Created world "+t.world_id)
if("flat"!==r.world_type&&Qe())Ne(Je())
if(!Ft())Wt(t.world_id)}})})}function deleteWorld(r){if(O())return void Q.modalDialog({title:Ve.DLG_ERROR_WORLD_DELETE_TITLE,text:Ve.ERR_DISCONNECTED,buttons:{ok:null}})
wr=true
x().send("world_delete",r,function(e,t){wr=false
if(e)Q.modalDialog({title:Ve.DLG_ERROR_WORLD_DELETE_TITLE,text:e,buttons:{ok:null}})
else{qe.menuExit()
console.log("Deleted world "+r)
Te("world_delete",1,null,String(r))}})}function forgetWorld(r){if(O())return void Q.modalDialog({title:Ve.DLG_ERROR_WORLD_FORGET_TITLE,text:Ve.ERR_DISCONNECTED,buttons:{ok:null}})
wr=true
x().send("world_forget",r,function(e,t){wr=false
if(e)Q.modalDialog({title:Ve.DLG_ERROR_WORLD_FORGET_TITLE,text:e,buttons:{ok:null}})
else{qe.menuExit()
console.log("Forgot world "+r)
Te("world_forget",1,null,String(r))}})}function drawBG(e){dr.draw({x:V.x0Real(),y:V.y0Real(),w:V.wReal(),h:V.hReal(),z:e||1})}var Lr
var Rr=false
function drawCheckConnectionMessage(){if(Lr){var e=100
var t=10
var r=150
var a=1e3-2*e
var i=V.x0()+(V.w()-a)/2
var o=V.y1()-r-e
var n=false
var s=false
var l=false
if(Rr&&p){n=Y()
s=q()
l=n||s}ir.drawSizedAligned(ut,i,o,Z.DEBUG,32,ir.ALIGN.HVCENTERFIT|ir.ALIGN.HWRAP,a,l?r/2+2*t:r,Lr)
if(l){var c=175
var _=48
var u=10
var d=a-(n?u+c:0)-(s?u+c:0)
var f=.5*_
var v={x:i+d-(d-ir.drawSizedAligned(ht,i,o+r/2-t,Z.DEBUG,Q.font_height,ir.ALIGN.HVCENTERFIT,d,r/2,Ve.addColon(Ve.LBL_MEANWHILE_CHECK_OUT)))/2+u,y:o+3*r/4-t-_/2,z:Z.DEBUG+1,w:c,h:_,font_height:f}
if(n){if(Q.buttonText(_extends({},v,{text:Ve.BTN_LATEST_NEWS,hook:"reddot_news_last_seen_ts"}))){Te("welcome_fb_follow",1,"button")
Be()
ot()}v.x+=u+c}if(s)if(Q.buttonText(_extends({},v,{text:Ve.BTN_JOIN_OUR_GROUP}))){Te("welcome_fb_join_group",1,"button")
Ue()}}Q.panel({x:i,y:o,w:a,h:r,z:Z.DEBUG-1,color:ce(0,0,0,.85)})}}function checkConnection(){var e=x()
if(e.connected&&X().restarting||e.connect_error===te||e.connect_error===$){Rr=true
Lr=Ve.LOGINMSG_SERVER_RESTARTING}else if(e.connect_error===ee){Rr=false
Lr=p?Ve.LOGINMSG_NEW_VERSION+"\n"+Ve.LOGINMSG_RESTART_OR_UPDATE_APP:n?Ve.LOGINMSG_NEW_VERSION+"\n"+Ve.LOGINMSG_UPDATE_APP:s?Ve.LOGINMSG_NEW_VERSION+"\n"+Ve.LOGINMSG_RELOAD_PAGE:Ve.LOGINMSG_UNDER_MAINTENANCE+"\n"+Ve.LOGINMSG_TRY_AGAIN}else if(e.disconnected||X().was_logged_in&&X().logging_in){Rr=true
Lr=Ve.$(Ve.LOGINMSG_RECONNECTING,(e.timeSinceDisconnect()/1e3).toFixed(0))}else{Rr=false
Lr=null}}var xr
function drawPartyInfoMessage(){if(!xr||Lr)return
var e=200
var t=150
var r=1e3-2*e
var a=V.x0()+(V.w()-r)/2
var i=V.y1()-t-e
Q.panel({x:a,y:i,w:r,h:t,z:Z.MODAL-10,color:ce(0,0,0,.85)})
ir.drawSizedAligned(pt,a,i,Z.MODAL-9,32,ir.ALIGN.HVCENTERFIT|ir.ALIGN.HWRAP,r,t,xr)}var Or={}
function joinWorldWrap(e){if(Or.uid)qe.char_controller.setFollowUserOnLoad(Or.uid)
if(Or.world_id!==e)Or={}
a().createAppShortcut()
Wt(e,Or.pos,Or.wgid,Or.force_waygate)
Or={}}function joinUser(i){Or={}
qe.startLoad()
At(i,"",function(e,t){if(Ft())return
if(O()){Or.uid=i
qe.returnToMainMenu()
return}var r
if(e)e=Ve.DLG_JOIN_USER_FAILED_NOT_FOUND_MSG.$({user:i})
else r=null==t?void 0:t.world_id
if(e||!r){qe.returnToMainMenu()
var a={title:Ve.DLG_JOIN_USER_FAILED_TITLE,text:e||Ve.DLG_JOIN_USER_FAILED_NOT_PLAYING_MSG,buttons:{ok:function ok(){J.set("u","")
J.set("action","")}}}
if(!e)a.buttons.retry=function(){joinUser(i)}
Q.modalDialog(a)}else{Or.uid=i
Or.world_id=t.world_id
Or.pos=t.pos_str
joinWorldWrap(r)}})}var br
var Nr
var Cr
var Mr
var Dr
var Pr=64
var kr=240
var Br=50
var Ur=48
var Gr=172
var Fr=4*Gr/3
var Wr=100
function headerLogo(){Nr-=Br
var e=Pr+86
var t=e*fr.texs[0].src_width/fr.texs[0].src_height
fr.draw({x:Dr-t/2,y:4,z:Z.UI-30,w:t,h:e})
Cr=Nr+=Pr+48
Nr+=Br}function mainMenuTop(e,t,r){if(S.pointerLocked()&&!S.pointerLockJustEntered(5))S.pointerLockExit()
ze(false)
B(true,"menus")
nt(.95)
Lt()
Nr=20
Mr=1e3-2*(br=0)
if(t||r){V.setAspectFixed2(1e3,e||1e3)
Mr=V.w()}else V.setAspectFixed(1e3,e||1e3)
Dr=br+Mr/2
qe.chat_ui.run({hide:true})
qe.menuExitClear()
elevatedWarn()
Pe.draw(10,100)
drawCheckConnectionMessage()
Cr=Nr
Nr+=Br}function mainMenuBottom(e,t){if(!e){Nr+=Br
var r=t?-20:10
Q.panel({x:r,y:Cr,w:(t?V.w():1e3)-2*r,h:Nr-Cr,color:t?Ke.panel_color:null})}checkConnection()
drawBG()
qe.chat_ui.runLate()}function lineSep(e,t,r){Nr+=e
Q.drawLine(Dr-t/2,Nr,Dr+t/2,Nr,Z.UI,r,1,lt,0)
Nr+=e}function returnToMainMenuFromSubScreen(){if(mainMenuGetPage()===pr)I.setState(mainMenu)
else I.setState(welcomeScreen)}var jr
var Hr
var zr
var Vr=200
var Yr
function enterAccessToken(){mainMenuTop()
headerLogo()
or.drawSizedAligned(vt,br,Nr,Z.UI,1.5*Q.font_height,ir.ALIGN.HCENTERFIT,Mr,0,Ve.LBL_ACCESS_TOKEN_ENTER)
Nr+=1.5*Q.font_height+16
if(zr){Nr+=Ur
ir.drawSizedAligned(vt,br,Nr,Z.UI,Q.font_height,ir.ALIGN.HCENTERFIT,Mr,0,Ve.MSG_ACCESS_TOKEN_VALIDATING)
Nr+=Q.font_height+16}else{var e=jr.run({x:Dr-Vr-8,y:Nr})
var t=jr.getText().length<10||O()
if(Q.buttonText({x:Dr,y:Nr,w:kr/2-4,h:Ur,text:Ve.BTN_SUBMIT,disabled:t})||!t&&J.get("token")){J.set("token","")
e=jr.SUBMIT}if(Q.buttonText({x:Dr+kr/2+4,y:Nr,w:kr/2-4,h:Ur,text:Ve.BTN_CANCEL})||S.keyDownEdge(S.KEYS.ESC)||S.click({button:2}))returnToMainMenuFromSubScreen()
Nr+=Ur
if(e===jr.SUBMIT&&!O()){zr=true
X().sendCmdParse("access_token "+jr.getText(),function(e,t){zr=false
if(e)if(Hr){console.error("Ignoring access token error: "+e)
returnToMainMenuFromSubScreen()}else Q.modalDialog({title:Ve.DLG_ERROR_ACCESS_TOKEN_TITLE,text:e,buttons:{ok:null}})
else if(t&&t.world_id)joinWorldWrap(t.world_id)
else{var r=t&&t.msg||("string"===typeof t?t:null)
if(r)Q.modalDialog({title:Ve.DLG_ACCESS_TOKEN_APPLIED_TITLE,text:r,buttons:{ok:null}})
Yr=true
returnToMainMenuFromSubScreen()}})}}mainMenuBottom()}function enterAccessTokenInit(){I.setState(enterAccessToken)
zr=false
jr=c({w:Vr,text:J.get("token"),placeholder:"000-0000-0000",initial_focus:true,initial_select:true,spellcheck:false})
Hr=Boolean(J.get("token"))}var qr
var Kr
var Zr
function enterPassword(){mainMenuTop()
headerLogo()
or.drawSizedAligned(vt,br,Nr,Z.UI,1.5*Q.font_height,ir.ALIGN.HCENTERFIT,Mr,0,Ve.LBL_WORLD_PASSWORD_ENTER)
Nr+=1.5*Q.font_height+16
if(Kr){Nr+=Ur
ir.drawSizedAligned(vt,br,Nr,Z.UI,Q.font_height,ir.ALIGN.HCENTERFIT,Mr,0,Ve.MSG_PASSWORD_VALIDATING)
Nr+=Q.font_height+16}else{var e=Zr.run({x:Dr-Vr-8,y:Nr})
if(Q.buttonText({x:Dr,y:Nr,w:kr/2-4,h:Ur,text:Ve.BTN_SUBMIT,disabled:!Zr.getText().length}))e=Zr.SUBMIT
if(Q.buttonText({x:Dr+kr/2+4,y:Nr,w:kr/2-4,h:Ur,text:Ve.BTN_CANCEL})||S.keyDownEdge(S.KEYS.ESC)||S.click({button:2})){Or={}
zt()
qe.returnToMainMenu()}Nr+=Ur
if(e===Zr.SUBMIT){Kr=true
var t=Zr.getText()
var r=re(re(String(qr))+t)
x().send("world_password",{world_id:qr,password:r},function(r){if("ERR_INVALID_PASSWORD"===r&&t.toUpperCase().match(/^W\d+Z.{8}/))return void x().send("access_token",t,function(e,t){Kr=false
if(!e&&t&&t.world_id)joinWorldWrap(t.world_id)
else Q.modalDialog({title:Ve.DLG_ERROR_WORLD_PASSWORD_TITLE,text:r,buttons:{ok:null}})})
Kr=false
if(r)Q.modalDialog({title:Ve.DLG_ERROR_WORLD_PASSWORD_TITLE,text:r,buttons:{ok:null}})
else joinWorldWrap(qr)})}}mainMenuBottom()}function enterPasswordInit(e){if((qr=e)===J.get("w"))Or={world_id:e,pos:J.get("pos"),wgid:J.get("wg"),uid:"go"===J.get("action")&&J.get("u"),force_waygate:true}
else Or={}
I.setState(enterPassword)
Zr=c({w:Vr,text:"",placeholder:"<password>",initial_focus:true,initial_select:true,spellcheck:Kr=false})}var Xr
var Qr
var Jr
var $r
function createWorldUI(){mainMenuTop()
headerLogo()
or.drawSizedAligned(vt,br,Nr,Z.UI,1.5*Q.font_height,ir.ALIGN.HCENTERFIT,Mr,0,Ve.PAGETITLE_CREATE_NEW_WORLD)
Nr+=1.5*Q.font_height+16
ir.drawSizedAligned(vt,Dr-8,Nr,Z.UI,Q.font_height,ir.ALIGN.HRIGHT|ir.ALIGN.VCENTER,0,Ur,Ve.LBL_NAME)
if(Q.buttonText({x:Dr,y:Nr,w:kr,h:Ur,text:Xr.name,disabled:Ar}))Q.modalTextEntry({edit_text:Xr.name,title:Ve.LBL_WORLD_NAME,text:Ve.DLG_NEW_WORLD_NAME_MSG,max_len:ve,buttons:{ok:function ok(e){Xr.name=e.trim()||"New World"},cancel:null}})
Nr+=Ur+16
var e=kt(Xr,"preview")
var t=kr
var r=3*t/4
if(e.loaded)G.queueraw([e],Dr,Nr,Z.UI,t,r,0,0,1,1,le)
if("adventure"===Xr.world_mode){var a=Dr+.965*t
var i=Nr+.965*r
var o=.2*r
Tt.sprite.draw({x:a-o,y:i-o,z:Z.UI+.1,w:o,h:o,frame:Tt.ADVENTURE_MODE})}Nr+=r+8
var n
ir.drawSizedAligned(vt,Dr-8,Nr,Z.UI,Q.font_height,ir.ALIGN.HRIGHT|ir.ALIGN.VCENTER,0,Ur,Ve.addColon(Ve.LBL_GAME_MODE))
Jr.run({x:Dr,y:Nr,disabled:Ar,initial_selection:Xr.unlimited?1:0})
if((n=Jr.getSelected().tag)!==Xr.world_mode)if("adventure"===(Xr.world_mode=n)&&!Xr.seed)Xr.seed=er(1e4*ar())
Nr+=Ur+16
var s="adventure"===n
ir.drawSizedAligned(vt,Dr-8,Nr,Z.UI,Q.font_height,ir.ALIGN.HRIGHT|ir.ALIGN.VCENTER,0,Ur,Ve.addColon(Ve.LBL_WORLD_TYPE))
if(s){Qr.reset_selection=true
Qr.initial_selection=1}Qr.run({x:Dr,y:Nr,disabled:Ar||s})
var l=Qr.getSelected().tag
var c=l.type
Xr.log_type=s?"adventure":l.log_type
if(c!==Xr.world_type){var _="flat"===Xr.world_type
var u="flat"===c
Xr.world_type=c
if(_!==u)if(u)Xr.seed=0
else Xr.seed=er(1e4*ar())}Xr.reset=l.reset
Xr.sized=l.sized
Nr+=Ur+16
if(Qe()&&"flat"!==Xr.world_type){Nr-=8
ir.drawSizedAligned(vt,Dr,Nr,Z.UI,Q.font_height,ir.ALIGN.HFIT,Mr/2,0,Ve.LBL_CONTINENT_DATA_MOD)
Nr+=Q.font_height+16}ir.drawSizedAligned(vt,Dr-8,Nr,Z.UI,Q.font_height,ir.ALIGN.HRIGHT|ir.ALIGN.VCENTER,0,Ur,Ve.addColon(Ve.LBL_WORLD_SEED_SHORT))
if("flat"===Xr.world_type){$r.run({x:Dr,y:Nr,disabled:Ar})
Xr.seed=$r.getSelected().tag}else if(Q.buttonText({x:Dr,y:Nr,w:kr,h:Ur,text:String(Xr.seed),disabled:Ar}))Q.modalTextEntry({edit_text:String(Xr.seed),title:Ve.LBL_WORLD_SEED,text:Ve.LBL_WORLD_SEED_ENTER,buttons:{ok:function ok(e){var t=Number(e.trim())
if(ne(t)&&t<=4294967295&&t>=0)Xr.seed=t
else Xr.seed=ae(e.trim())},cancel:null}})
Nr+=Ur+16
if(Q.buttonText({x:Dr,y:Nr,w:kr/2-4,h:Ur,text:Ve.BTN_SUBMIT,disabled:Ar})){Te("create_world_button",1,"button",Xr.log_type)
createWorld(Xr)}if(Q.buttonText({x:Dr+kr/2+4,y:Nr,w:kr/2-4,h:Ur,text:Ve.BTN_CANCEL,disabled:Ar})||!Ar&&(S.keyDownEdge(S.KEYS.ESC)||S.click({button:2})))I.setState(mainMenu)
Nr+=Ur
if(Xr.reset&&!m){Nr+=24
or.drawSizedAligned(vt,Dr,Nr,Z.UI,Q.font_height,ir.ALIGN.HCENTER,0,0,Ve.WORLD_CREATE_BETA_WARN_TITLE)
Nr+=Q.font_height+8
Nr+=ir.drawSizedWrapped(vt,Dr-.4*Mr,Nr,Z.UI,.8*Mr,48,Q.font_height,Ve.WORLD_CREATE_BETA_WARN_MSG)
Nr+=8}mainMenuBottom()}function loggedOrLogginIn(){return X().loggedIn()||X().logging_in}function createWorldUIInit(){Xr={name:"New World",world_type:null,unlimited:"unlim"===J.get("type"),seed:0}
var e=[{name:Ve.WORLD_TYPE_FLAT,tag:{type:"flat",reset:false,sized:void 0,log_type:"flat"}},{name:Ve.WORLD_TYPE_GENERATED_V1,tag:{type:"v1",reset:true,sized:void 0,log_type:"generated_v1"}},{name:Ve.addParenthesesAfter(Ve.WORLD_TYPE_SMALL,48),tag:{type:"flat",reset:false,sized:48,log_type:"small_48"}}]
if(Gt("sysadmin"))e.push({name:"(Admin) Generated V1 (persistent)",tag:{type:"v1",reset:false,sized:void 0}})
Qr=N({items:e,z:Z.UI,width:kr,entry_height:Ur})
if("unlim"===J.get("type")){Qr.initial_selection=1
Xr.seed=er(1e4*ar())}Jr=N({items:[{name:m?Ve.GAME_MODE_LOST_FRONTIER:Ve.GAME_MODE_LOST_FRONTIER_BETA,tag:"adventure"},{name:Ve.GAME_MODE_UNLIMITED,tag:"unlimited"}],z:Z.UI,width:kr,entry_height:Ur})
$r=N({items:[{name:yt.tile_name[yt.GRASS],tag:de},{name:yt.liquid_name[yt.WATER],tag:fe},{name:yt.tile_name[yt.SNOW],tag:yt.SNOW},{name:yt.tile_name[yt.SAND],tag:yt.SAND},{name:yt.tile_name[yt.STONE],tag:yt.STONE},{name:yt.tile_name[yt.STONE_DARK],tag:yt.STONE_DARK},{name:yt.tile_name[yt.STONE_LIGHT],tag:yt.STONE_LIGHT},{name:yt.tile_name[yt.STONE_RED],tag:yt.STONE_RED},{name:Ve.WORLD_SEED_EMPTY,tag:ue}],z:Z.UI,width:kr,entry_height:Ur})
if(loggedOrLogginIn()){I.setState(createWorldUI)
J.set("page","")
J.set("type","")}}function cmpActiveWorlds(e,t){var r=(e.full?1:0)-(t.full?1:0)
if(r)return r
if(r=t.players-e.players)return r
var a=e.waygates&&e.waygates.default&&e.waygates.default.imgid
var i=t.waygates&&t.waygates.default&&t.waygates.default.imgid
if(a&&!i)return-1
else if(i&&!a)return 1
return e.created-t.created}function requireLogin(e){Ke.clear()
X().once("login",e)}function menuExitClearParams(){switch(Ke.page){case Ke.BLUEPRINT_VIEW:J.set("blueprint","")
break
case Ke.PHOTO_VIEW:J.set("photo","")
break
case Ke.WORLD_INFO_VIEW:if(qe.omp)J.setMulti({w:Ft(),wg:It.get("wg")})
else J.setMulti({w:"",wg:""})}}var ea
var ta
var ra=false
var aa=6e4
function getServerStats(){if(ra||!x().connected)return ea
if(Date.now()-ta<aa)return ea
ra=true
x().send("get_stats",null,function(e,t){if(e)console.error("Error on get_stats: "+e)
ra=false
ta=Date.now()
ea=t})
return ea}var ia="r/WorldsFRVR"
function mainMenuSubLinks(a){var e=!p&&!E&&!g
var t=!p&&!E&&!g
var r=!p
var i=.75*Q.font_height
Dr=Mr/2
var o=true
function linkAdvance(e,t,r){if(!o)br+=ir.drawSized(a,br,Nr,Z.UI,i," - ")
o=false
if(w({x:br,y:Nr,z:Z.UI,font_size:i,url:t,text:e,internal:r}))if(r)r()
br+=ir.getStringWidth(A(),i,e)}var n=0
var s=ir.getStringWidth(a,i," - ")
if(e)n+=ir.getStringWidth(a,i,Ve.LBL_DISCORD_WORLDS)+s
if(t)n+=ir.getStringWidth(a,i,ia)+s
if(r){n+=ir.getStringWidth(a,i,Ve.LBL_TERMS_OF_SERVICE)+s
n+=ir.getStringWidth(a,i,Ve.LBL_PRIVACY_POLICY)+s
n+=ir.getStringWidth(a,i,Ve.LBL_GDPR)+s
n+=ir.getStringWidth(a,i,Ve.LBL_DMCA)+s}if(n)n-=s
br=Dr-n/2
if(e)linkAdvance(Ve.LBL_DISCORD_WORLDS,v)
if(t)linkAdvance(ia,h)
if(r){var l=Fe.termsOfServiceShow,c=Fe.privacyPolicyShow,_=Fe.gdprShow,u=Fe.dmcaShow
linkAdvance(Ve.LBL_TERMS_OF_SERVICE,z,l)
linkAdvance(Ve.LBL_PRIVACY_POLICY,H,c)
linkAdvance(Ve.LBL_GDPR,d,_)
linkAdvance(Ve.LBL_DMCA,f,u)}}var oa={}
function autoForget(r){if(oa[r])return
oa[r]=true
x().send("world_forget",r,function(e,t){if(e)console.error("Error forgetting "+r+": "+e)})}function allocShowWorldElemData(e){var t=e.key
var r=t.split("$"),a=r[0],i=r[1]
return{w:Fr,h:Gr,target:{wid:i},url:"w/"+i+"/info",style:"preview",key:t,ctx:a}}var na=5
var sa
var la
var ca
function showWorld(e,t,r,a,i,o,n){var s=e.my_worlds,l=e.allow_join,c=e.recent_worlds
var _=s[a]&&s[a].name
var u=wr||Ar||!l
i=i||getWorldInfo(a,false)
if(c[a]&&i&&i.err&&"ERR_DOES_NOT_EXIST"===i.err)autoForget(a)
var d=W("main_show_world",{key:r+"$"+a},allocShowWorldElemData)
d.x=t
d.y=Nr
d.disabled=u
d.world_data=i
d.name_guess=_
d.show_private=!o
d.frozen="mine"===r&&s[a]&&s[a].frozen
if(Pt(d)){if("NEW"===a)createWorldUIInit()
else Yt(a,"info")
e.allow_join=false}if(n&&n.length){var f=Nr+Gr+8
var v=Q.font_height
var h=v+4
for(var p=0;p<n.length&&p<na;++p){var m=n[p]
if(p!==n.length-1&&p===na-1)m=n.length-p+" more..."
ir.drawSizedAligned(vt,t,f,Z.UI,v,ir.ALIGN.HCENTERFIT,Fr,0,m)
ca=tr(ca,f+=h)}}}function showWorldList(e,t,r,a,i,o){var n=e.y_min,s=e.y_max,l=e.all_worlds_info
var c=Fr
var _=8
var u=rr(la*a,r.length)
var d=$t(u/la)
var f=0
for(var v=0;v<d;++v){ca=Nr+Gr
var h=rr(la,u-f)
var p=Dr-(h*(c+_)-_)/2
for(var m=0;m<h;++m){var g=r[f++]
if(Nr+Gr>=n&&Nr<s)showWorld(e,p+m*(c+_),t,g=String(g),l[g],i,o&&o[g])}Nr=ca+8}}function showEnterAccessToken(){if(Q.buttonText({x:br,y:Nr,h:.5*Q.button_height,w:ur,text:Ve.LBL_ACCESS_TOKEN_ENTER}))enterAccessTokenInit()}function mainMenuHome(s,e){var l=s.my_worlds,n=s.recent_worlds,c=s.all_worlds_info
if(Gt("sysadmin"))X().getChannelImmediate("worldlist.active")
if("createworld"===J.get("page"))createWorldUIInit()
var t={}
function showFeaturedWorlds(e){if(e.length){var r
e=e.filter(function(e){var t=c[e]
if(t&&t.full){(r=r||[]).push(e)
return false}return true})
if(r)e=e.concat(r)
Nr+=8
or.drawSizedAligned(ft,br,Nr,Z.UI,1.5*Q.font_height,ir.ALIGN.HCENTERFIT,Mr,0,Ve.LBL_FEATURED_WORLDS)
Nr+=1.5*Q.font_height+8
showWorldList(s,"featured",e,2,false)}}function showFriendsInWorld(e,t){if(e.length){Nr+=8
or.drawSizedAligned(ft,br,Nr,Z.UI,1.5*Q.font_height,ir.ALIGN.HCENTERFIT,Mr,0,Ve.LBL_FRIENDS_IN_WORLD)
Nr+=1.5*Q.font_height+8
showWorldList(s,"friends",e,2,false,t)}}var r
var a
var i
function showActiveWorlds(e){Nr+=8
if(!e.length){ir.drawSizedAligned(vt,br,Nr,Z.UI,Q.font_height,ir.ALIGN.HCENTER,Mr,0,r?Ve.MSG_ACTIVE_WORLDS_NOT_FOUND:Ve.MSG_ACTIVE_WORLDS_QUERYING)
Nr+=Q.font_height+8}else{var t=a&&i?Ve.LBL_WORLDS_ACTIVE_AND_RECENT:a?Ve.LBL_WORLDS_ACTIVE:i?Ve.LBL_WORLDS_RECENT:Ve.LBL_WORLDS
or.drawSizedAligned(ft,br,Nr,Z.UI,1.5*Q.font_height,ir.ALIGN.HCENTERFIT,Mr,0,t)
Nr+=1.5*Q.font_height+8
showWorldList(s,"active",e,Wr,false)}}function showMyWorlds(){function cmpMyWorlds(e,t){if("NEW"===e)return 1
else if("NEW"===t)return-1
var r=l[e]
return l[t].created-r.created}var e=[]
var t=[]
for(var r in l)if(l[r].frozen)t.push(r)
else e.push(r)
var a=e.length
var i=Gt("max_worlds")
if(!a&&!i){Nr+=16
ir.drawSizedAligned(vt,br,Nr,Z.UI,Q.font_height,ir.ALIGN.HCENTER,Mr,0,Ve.MSG_LOADING)
Nr+=Q.font_height+4}else{Ie("world_count",Number(a),null,null,{quota:i})
Nr+=8
or.drawSizedAligned(ft,Dr,Nr,Z.UI,1.5*Q.font_height,ir.ALIGN.HCENTER|ir.ALIGN.VCENTER,0,Ur,Ve.addParenthesesAfter(Ve.LBL_MY_WORLDS,Ve.$(Ve.FORMAT_FRACTION,a,i)))
Nr+=Ur+8
var o=e
if(a<i)o.push("NEW")
if(o.length){o.sort(cmpMyWorlds)
showWorldList(s,"mine",o,Infinity,true,null)}if(t.length){Nr+=8
var n=or.drawSizedAligned(ft,Dr,Nr,Z.UI,1.5*Q.font_height,ir.ALIGN.HCENTER|ir.ALIGN.VCENTER,0,Ur,Ve.addParenthesesAfter(Ve.LBL_MY_WORLDS_FROZEN,t.length))
if(Q.buttonText({x:Dr-n/2-8-Ur,y:Nr,w:Ur,h:Ur,font_height:Ur,text:C.show_frozen_worlds?"▼":"▶"}))C.set("show_frozen_worlds",1-C.show_frozen_worlds)
Nr+=Ur+8
if(C.show_frozen_worlds){t.sort(cmpMyWorlds)
showWorldList(s,"frozen",t,Infinity,true,null)}}}}if((r=getWorldInfo("all",false))&&r.err)r=null
if(r)r=r.list.filter(function(e){if(!e.owner_id)return false
return true})
for(var o=0;o<e.length;++o)t[e[o]]=true
var _=P()
var u=[]
var d={}
for(var f in _)if(k(f)){var v=wt(f)
var h=v.display_name,p=v.presence_data
var m=p&&p.payload&&p.payload.world_id
if(m){var g=getWorldInfo(m,false)
if(!g||!g.user_access)continue
if(!d[m]){d[m]=[]
u.push(m)}d[m].push(h||f)}}u.sort(function(e,t){var r=d[t].length-d[e].length
if(r)return r
return e<t?-1:1})
for(var E=0;E<u.length;++E)t[u[E]]=true
var y=Object.keys(n);(y=y.filter(function(e){return!l[e]&&!t[e]})).sort(function(e,t){return n[t].when-n[e].when})
var T=la*Wr
var I=2*la
var S=[]
var A={}
i=rr($t(la/2),y.length)
for(var w=0;w<i;++w){var L=y[w]
A[L]=true
S.push(L)}var R=[]
if(r){r.sort(cmpActiveWorlds)
R=r.map(function(e){return(c[e.world_id]=e).world_id}).filter(function(e){return!l[e]&&!A[e]&&!t[e]})}a=rr(R.length,T-S.length)
for(var x=0;x<a;++x){var O=R[x]
A[O]=true
S.push(O)}if(i<y.length&&S.length<I){y=y.filter(function(e){return!A[e]})
var b=I-S.length
S=S.concat(y.slice(0,b))}S.sort(function(e,t){var r=c[e]
var a=c[t]
if(r)if(a)return cmpActiveWorlds(r,a)
else return r.full?1:-1
else if(a)return a.full?-1:1
var i=n[e]
var o=n[t]
if(i&&o)return o.when-i.when
return e<t?-1:1})
if(!Yr)showEnterAccessToken()
showMyWorlds()
showFriendsInWorld(u,d)
showFeaturedWorlds(e)
showActiveWorlds(S)}var _a=false
var ua
function worldlistContentEdit(e){var t=ur
var r=Z.UI
var a=br+t+8
if(_r!==lr&&(_r!==sr||sa&&0===sa.getScrollPos())&&Q.buttonText({x:a,y:Nr,z:r,h:.5*Q.button_height,w:t,text:"(Admin) Edit"})){_a=!_a
ua=null}a+=t+8
if(_a){if(!ua)ua=c({w:Mr/4,text:JSON.stringify(e,void 0,2),initial_focus:true,spellcheck:false,multiline:20,zindex:1})
var i=ua.getText()
var o=false
try{e=JSON.parse(i)}catch(e){o=true}if(Q.buttonText({x:a,y:Nr,z:r,h:.5*Q.button_height,w:t,text:Ve.BTN_SAVE,disabled:o})){qe.chat_ui.cmdParse("worldlist_content "+JSON.stringify(e))
worldInfoCacheClear()}if(Q.buttonText({x:a+=t+8,y:Nr,z:r,h:.5*Q.button_height,w:t,text:Ve.BTN_CANCEL}))_a=false}Nr+=.5*Q.button_height
if(_a)ua.run({x:br,y:Nr+8})
return e}function mainMenuOther(e,t,r){var a=t[r]||{}
if(!a.sections)return
for(var i=0;i<a.sections.length;++i){Nr+=8
var o=a.sections[i]
if(o.title){or.drawSizedAligned(ft,br,Nr,Z.UI,1.5*Q.font_height,ir.ALIGN.HCENTERFIT,Mr,0,o.title)
Nr+=1.5*Q.font_height}if(o.subtitle){or.drawSizedAligned(gt,br,Nr,Z.UI,.8*Q.font_height,ir.ALIGN.HCENTERFIT,Mr,0,o.subtitle)
Nr+=.8*Q.font_height}Nr+=8
if(o.worlds&&o.worlds.length)showWorldList(e,"tab"+r+"."+i,o.worlds,Infinity,false,null)}}var da={text:"",sort:"likes",edit:false}
var fa
var va
var ha=false
var pa
var ma
var ga
var Ea=50
function updateSearch(){var e=da.sort,t=da.edit,r=da.text
var a=[e,t,r].join()
if(a===fa||!x().connected||ha)return
fa=a
va=[]
ha=true
pa=0
ma=false
pa+=(ga={text:r||void 0,sort:e,filter_edit:t?1:void 0,limit:Ea,offset:pa}).limit
x().send("world_search",ga,function(e,t){ha=false
if(e){console.error(e)
return}va=t.worlds})}function searchMore(){if(ha||ma)return
ha=true
ga.offset=pa
pa+=ga.limit
x().send("world_search",ga,function(e,t){ha=false
if(e){console.error(e)
ma=true
return}if(!t.worlds.length){ma=true
return}var r={}
for(var a=0;a<va.length;++a)r[va[a]]=true
for(var i=0;i<t.worlds.length;++i){var o=t.worlds[i]
if(!r[o]){va.push(o)
r[o]=true}}})}var ya
var Ta=370
var Ia=true
function mainMenuSearch(e){var t=Z.UI
if(!ya)ya=c({placeholder:Ve.LBL_SEARCH,initial_select:true,auto_unfocus:true,max_len:40,text:da.text})
var r=2*Q.font_height
var a=r
if(S.touch_mode)a=Q.button_height
Nr+=8
var i=.5*Q.button_height
var o=Boolean(da.text)
if(Ia){var n=ya.run({x:br,y:Nr+(Q.button_height-a)/2,w:Ta,font_height:a,initial_focus:!S.touch_mode,pointer_lock:!S.touch_mode})
if(n===ya.SUBMIT||!ya.isFocused())da.text=ya.getText()
else if(n===ya.CANCEL){ya.setText("")
da.text=""}br+=Ta+40}else{var s=o?4:3
br=(V.w()-2*i-Q.button_height*s-8*(s+1)-24)/2}Tt.sprite.draw({x:br,y:Nr+(Q.button_height-i)/2,z:t,w:i,h:i,frame:Tt.SORT})
br+=i+8
function sortButtonParam(e,t){t.x=br
t.y=Nr
t.w=Q.button_height
t.font_height=r
t.img=Tt.sprite
t.img_color=lt
t.disabled=da.sort===e
t.disabled_mouseover=true
t.base_name=t.disabled?"inv_selected":null
return t}if(o){if(Q.buttonText(sortButtonParam("name",{text:Ve.BTN_SORT_ALPHABETICALLY,tooltip:Ve.TLTP_SORT_BY_NAME})))da.sort="name"
br+=Q.button_height+8}else if("name"===da.sort)da.sort="likes"
if(Q.buttonImage(sortButtonParam("likes",{frame:Tt.LIKE,tooltip:Ve.TLTP_SORT_BY_LIKES})))da.sort="likes"
br+=Q.button_height+8
if(Q.buttonImage(sortButtonParam("views",{frame:Tt.VIEWS,tooltip:Ve.TLTP_SORT_BY_VIEWS})))da.sort="views"
br+=Q.button_height+8
br+=24
Tt.sprite.draw({x:br,y:Nr+(Q.button_height-i)/2,z:t,w:i,h:i,frame:Tt.FILTER})
br+=i+8
if(Q.buttonImage({x:br,y:Nr,img:Tt.sprite,frame:Tt.GATHERING_TOOLS,img_color:da.edit?null:lt,base_name:da.edit?"inv_selected":null,tooltip:da.edit?Ve.TLTP_SEARCH_WORLDS_BUILDER:Ve.TLTP_SEARCH_WORLDS_ALL}))da.edit=!da.edit
br+=Q.button_height+8
br=0
Nr+=Q.button_height+16
updateSearch()
showWorldList(e,"search",va,Infinity,false,null)
if(sa.getScrollPos()+sa.h>Nr-sa.h)searchMore()
if(ha){Nr+=24
Q.font.drawSizedAligned(dt,V.w()/2,Nr,t,r,Q.font.ALIGN.HCENTER,0,0,Ve.MSG_SEARCHING)
Nr+=r+8}}function needLoginView(){return!X().loggedIn()||X().logging_in||X().logging_out||!x().connected}var Sa=350
var Aa=300
var wa=96
var La=.7*wa
var Ra=.5*wa
var xa=0
var Oa=1
var ba=2
var Na=3
var Ca=4
var Ma=5
var Da=6
var Pa=7
var ka="play"
function fscreenEnterAndOrientAndTriggerPlay(){Ze()
U(ka)}var Ba=[]
Ba[xa]={will_show:false,fn:function fn(e,t,r){if(Q.buttonText({x:e,y:t,w:r,h:wa,font_height:Ra,text:Ve.BTN_PLAY,key:ka,in_event_cb:C.auto_fullscreen&&u()&&fscreenEnterAndOrientAndTriggerPlay})){Te("play_button",1,"button")
we(Ae.MAIN,1,"main_menu")
I.setState(mainMenuInit)
Me()}}}
Ba[Oa]={will_show:false,fn:function fn(e,t,r){if(Q.buttonText({x:e,y:t,w:r,h:wa,font_height:Ra,text:Ve.LBL_ACCESS_TOKEN_ENTER})||J.get("token")){Te("enter_token",1,"button")
enterAccessTokenInit()}}}
Ba[ba]={will_show:false,fn:function fn(e,t,r){if(Q.buttonText({x:e,y:t,w:r,h:wa,font_height:Ra,text:Ve.BTN_OUTFIT,hook:"new_costume"})){if(I.stateActive(welcomeScreen))I.setState(mainMenuInit)
qe.toggleMenuPage(Ke.CHARACTER_CUSTOMIZATION)}}}
Ba[Na]={will_show:false,fn:function fn(e,t,r){if(Q.buttonText({x:e,y:t,w:r,h:La,font_height:Ra,text:m?Ve.BTN_FEEDBACK_ACCOUNT:Ve.BTN_BUGS_FEEDBACK})){Te("welcome_feedback",1,"button")
Ge()}}}
Ba[Ca]={will_show:false,fn:function fn(e,t,r){if(Q.buttonText({x:e,y:t,w:r,h:La,font_height:Ra,text:Ve.BTN_RECENT_UPDATES})){Te("welcome_changelog",1,"button")
Fe.changelogShow()}}}
var Ua=false
var Ga="https://www.reddit.com/r/WorldsFRVR/comments/v5xaat/build_contest_100_anniversary_build_kingdom_of/"
Ba[Ma]={will_show:false,fn:function fn(e,t,r){if(!window.FBInstant)T({x:e,y:t,w:r,h:La,url:Ga})
if(Q.buttonText({x:e,y:t,w:r,h:La,font_height:Ra,text:Ve.BTN_BUILD_CONTEST,colors:_t,hook:window.FBInstant?"reddot_news_last_seen_ts":null}))if(window.FBInstant){Te("welcome_fb_follow",1,"button")
Be()
ot()}}}
Ba[Da]={will_show:false,fn:function fn(e,t,r){if(Q.buttonText({x:e,y:t,w:r,h:La,font_height:Ra,text:Ve.BTN_LATEST_NEWS,hook:"reddot_news_last_seen_ts"})){Te("welcome_fb_follow",1,"button")
Be()
ot()}}}
Ba[Pa]={will_show:false,fn:function fn(e,t,r){if(Q.buttonText({x:e,y:t,w:r,h:La,font_height:Ra,text:Ve.BTN_JOIN_OUR_GROUP})){Te("welcome_fb_join_group",1,"button")
Ue()}}}
var Fa=false
var Wa=550
var ja=730
function welcomeScreen(){profilerStart("welcomeScreen")
var e=X().loggedIn()
var t=needLoginView()
mainMenuTop(t?1e3:1e3,false,false)
mainMenuSetPage(hr)
rt()
gl.clearColor(3/255,3/255,3/255,1)
var r
var a
var i
var o
var n
var s=1400
var l=1e3
var c=1e3
var _=1700
if(t||!xe()){r=750
a=440
i=Dr
o=0
n=!je}else{if((n=He(s,l,c,_))===je){i=3*(Mr=s)/4
a=410}else{i=(Mr=c)/2
a=410}r=780
showCurrentGems(Mr-16,V.y0()+8,Z.UI,ir.ALIGN.HRIGHT,48)}var u={x:i-r/2,y:(a-r)/2,z:Z.UI-1,w:r,h:r}
vr.draw(u)
var d=.627
var f=.685
ir.drawSized(Et,u.x+u.w*d,u.y+u.h*f,Z.UI+1,.035*u.h,Oe())
Nr=a
var v=.75*Ra
if(t){if(!e)Ie("home_screen",1,"menu_log_in")
var h=Q.font_height
var p=8
var m=Ve.separateColon(Ve.LBL_VERSION,K())
var g=getServerStats()
if(g&&g.ccu)m=Ve.LBL_USERS_ONLINE_NUMBER.$({users:g.ccu})+"  |  "+m
ir.drawSizedAligned(ht,Dr,Nr-h,Z.UI,h,ir.ALIGN.HCENTER,0,0,m)
Nr+=p
Nr=nr.showLogin({x:Dr,y:Nr,style:ht,button_height:wa,font_height:Ra,font_height_small:v,text_w:800,button_width:220,url_tos:z,url_priv:H})}if(!t){if(!Fa){Ye()
Fa=true}Ie("home_screen",1,"menu_logged_in")
var E=i
var y=xe()
var T={w:Wa,h:ja,button_h:wa,draw_elipse:true}
if(!y)Nr=a+(o=100)
else if(n===je){T.x=(s/2-Wa)/2
T.y=(l-ja)/2
Nr=a}else{o=20
T.x=(c-Wa)/2
T.y=a+o
Nr=T.y+T.h+32}var I=E-Aa/2
var S=I-Aa/2
var A=I+Aa/2
var w=E-Sa/2
Ba[xa].will_show=y&&!J.get("token")
Ba[Oa].will_show=!Ba[xa].will_show
Ba[ba].will_show=y
Ba[Na].will_show=y&&Re()
Ba[Ca].will_show=y
Ba[Ma].will_show=Ua&&(!window.FBInstant||Y())
Ba[Da].will_show=!Ba[Ma].will_show&&Y()
Ba[Pa].will_show=q()
var L
if(!Ot()&&Ct())Ba[xa].will_show=false
else if(bt())if(Nt());else if(!Ot()){Ba[xa].will_show=false
var R=xt()
if(R&&R.world_id)if(R.pos_str){Or.uid=R.user_id
Or.world_id=R.world_id
Or.pos=R.pos_str
joinWorldWrap(R.world_id)
return profilerStop("welcomeScreen")}else if(R.querying_pos)L=xr||Ve.MSG_PARTY_CHOOSING_HOST
else L=Ve.MSG_PARTY_HOST_IN_PRIVATE_WORLD
else if(R)L=Ve.MSG_PARTY_WAITING_HOST_WORLD
else L=Ve.MSG_PARTY_CHOOSING_HOST}xr=L
drawPartyInfoMessage()
var x=0
for(var O=0;O<Ba.length;++O)if(Ba[O].will_show)++x
if(!nr.auto_login_enabled)x++
var b=n===je?650:800
if(!y){o=n===je?32:150
ir.drawSizedAligned(ht,E-b/2,Nr,Z.UI,v,ir.ALIGN.HCENTERFIT,b,0,Ve.MSG_SERVER_NEEDS_ACCESS_TOKEN)
Nr+=v+o}var N=Q.font_height
var C=8
var M=Ve.separateColon(Ve.LBL_VERSION,K())
var D=getServerStats()
if(D&&D.ccu)M=Ve.LBL_USERS_ONLINE_NUMBER.$({users:D.ccu})+"  |  "+M
Nr+=n===je?45:-80
ir.drawSizedAligned(ht,A,Nr-N,Z.UI,N,ir.ALIGN.HCENTER,0,0,M)
Nr+=C
var P=1
var k=E
var B=Sa
if(x>5){P=2
B=Aa}if(2===P){var U=0
var G=S
var F=false
for(var W=0;W<Ba.length;W++)if(Ba[W].will_show){Ba[W].fn(G,Nr,Aa)
U++
G=S
if(F=!F)G=A
else Nr+=U>2?La:wa}if(G===A)k=G+Aa/2}else for(var j=0;j<Ba.length;j++)if(Ba[j].will_show){Ba[j].fn(w,Nr,Sa)
Nr+=(j>2?La:wa)+8}nr.showLogin({x:k,y:Nr,style:ht,font_height:Ra,font_height_small:v,button_height:La,button_width:B,text_w:b,url_tos:z,url_priv:H,user_id_x:E})
Nr+=La+24
if(y)et(T)}V.setAspectFixed(900,900)
Mr=900
Nr=V.y1()-32
mainMenuSubLinks(ht)
checkConnection()
qe.chat_ui.runLate()
return profilerStop("welcomeScreen")}var Ha=ce(ct[0],ct[1],ct[2],.5)
function mainMenu(){profilerStart("mainMenu")
var e=X().loggedIn()
if(needLoginView()||!xe()){welcomeScreen()
return profilerStop("mainMenu")}else ye(e)
if(Ke.active()){mainMenuTop(null,true)
headerLogo()
var t=Ke.tickMenu()
if(qe.menuButton(true,false)||t)qe.menuExit()
mainMenuBottom(true)
return profilerStop("mainMenu")}mainMenuTop(1e3,false,true)
if((Or.world_id||Or.uid)&&!J.get("token")){Ie("home_screen",1,"in_world")
if(Or.uid)joinUser(Or.uid)
else joinWorldWrap(Or.world_id)
mainMenuBottom(true)
return profilerStop("mainMenu")}var r=getWorldInfo("all",false)
if(r&&r.err)r=null
var a=r&&r.tabs||[]
var i=r&&r.featured||[]
var o=r&&r.globals||[]
if(Gt("sysadmin")){br=8
Nr=104
var n={tabs:a,featured:i,globals:o}
a=(n=worldlistContentEdit(n)).tabs
i=n.featured.slice(0)
o=n.globals}else _a=false
br=50
Nr=8
function tabButton(e,t,r,a){if((t=String(t)).startsWith("♦ ")){t=t.slice(2)
r=Tt.GEMS}var i=r?64:32
var o=_r===e
var n=t?tr(250,ir.getStringWidth(null,2*Q.font_height,t)+2*i):Q.button_height
if(br+n>=V.x1()-Q.button_height-10){br=50
Nr+=Q.button_height}var s={x:br,y:Nr,z:o?Z.UI:Z.UI-10,w:n,font_height:2*Q.font_height,z_bias:o?null:{down:20},colors:o?Ke.tab_colors_selected:Ke.tab_colors_unselected,disabled:false,base_name:o?"tab":"tab_inactive",hook:a}
var l
if(t){s.text=t
l=Q.buttonText(s)}else{s.img=Tt.sprite
s.frame=r
l=Q.buttonImage(s)}if(l){if(sa)sa.resetScroll()
_r=e}if(r&&t)Tt.sprite.draw({x:br+8,y:Nr+(Q.button_height-i)/2,z:Z.UI+25,w:i,h:i,frame:r,color:r===Tt.GEMS?o?ct:Ha:null})
br+=n}tabButton(sr,"",Tt.HOME)
for(var s=0;s<a.length;++s){var l=a[s]
var c=l.reddot?"worldtab."+l.reddot:null
tabButton(cr+s,l.title,null,c)}tabButton(lr,"",Tt.SEARCH)
Nr+=Q.button_height
br=0
Cr=Nr-20
var _=100
if(Q.buttonText({text:"←",x:V.w()-Q.button_height-10,y:0,z:Z.UI+20,font_height:.75*_,w:_,h:_})||!(_r===lr&&null!=ya&&ya.isFocused())&&S.keyDownEdge(S.KEYS.BACKSPACE)){I.setState(welcomeScreenInit)
Te("return_to_welcome_button",1,"button")}showCurrentGems(Mr-_-8-32,(_-48)/2,Z.UI,ir.ALIGN.HRIGHT,48)
mainMenuSetPage(pr)
var u=V.h()
if(!sa)sa=b({z:Z.UI,background_color:null,auto_hide:true})
sa.keyboardScroll()
var d=sa.barWidth()
var f={x:br+0,y:Cr+16,w:+Mr}
if(_a)f.y+=.5*Q.button_height+8
var v=u-58+16
f.h=v-f.y
f.x+=d
f.w-=d
var h=sa.getScrollPos()
var p=h+f.h
h-=Gr
p+=Gr
sa.begin(f)
Nr=br=0
Mr=f.w-d
Dr=Mr/2
la=er((f.w-36)/(Fr+8))
var m=X().getMyUserChannel()
var g=m.data&&m.data.public||{}
var E=g.worlds||{}
var y={all_worlds_info:{},recent_worlds:g.recent||{},my_worlds:E,allow_join:true,y_min:h,y_max:p}
if(_r===sr){mainMenuHome(y,i)
Ie("home_screen",1,"worlds_listing")}else if(_r===lr)mainMenuSearch(y)
else{var T=_r-cr
if(a[T]&&a[T].reddot)it("worldtab."+a[T].reddot)
mainMenuOther(y,a,T)}Nr+=8
sa.end(Nr)
Nr=f.y+f.h
Mr=V.w()
Dr=Mr/2
lineSep(1,300,2)
Nr+=12
mainMenuSubLinks(vt)
Nr-=8
mainMenuBottom(false,true)
rt()
return profilerStop("mainMenu")}var za=true
function setPageFromId(e){if("createworld"===e)createWorldUIInit()}function checkAutoConnect(){if(za||Ht()){Or={world_id:J.get("w"),pos:J.get("pos"),wgid:J.get("wg"),uid:"go"===J.get("action")&&J.get("u"),force_waygate:!za&&!Vt()}
za=false
if("info"===Or.wgid&&Or.world_id){qe.toggleMenuPage(Ke.WORLD_INFO_VIEW,Or.world_id)
Or={}}else if(J.get("blueprint")&&!Or.pos&&!Or.world_id)qe.toggleMenuPage(Ke.BLUEPRINT_VIEW,J.get("blueprint"))
else if(J.get("photo")&&!Or.pos&&!Or.world_id)qe.toggleMenuPage(Ke.PHOTO_VIEW,J.get("photo"))
else if(J.get("page")&&!Or.pos&&!Or.world_id)setPageFromId(J.get("page"))}}function mainMenuInit(){I.setState(mainMenu)
Yr=wr=Ar=false
checkAutoConnect()
mainMenu()}var Va=true
function welcomeScreenInit(){tt()
var e=Va
if(I.DEBUG&&e)M(true)
Va=false
if(J.get("w")||"go"===J.get("action")&&J.get("u")||J.get("blueprint")||J.get("photo")||J.get("page"))return void mainMenuInit()
if(e&&mainMenuGetPage()===pr)return void mainMenuInit()
Fa=false
I.setState(welcomeScreen)
welcomeScreen()}function mainMenuStartup(){ir=Q.font
or=Q.title_font
nr=nr||ge()
De()}},{"../common/waygate_common.js":210,"../common/world_constants.js":212,"../frvr/client/platforms/adapter.js":217,"../glov/client/browser.js":239,"../glov/client/camera2d.js":241,"../glov/client/client_config.js":243,"../glov/client/cmds.js":244,"../glov/client/edit_box.js":248,"../glov/client/engine.js":250,"../glov/client/fbinstant.js":257,"../glov/client/fscreen.js":262,"../glov/client/input.js":271,"../glov/client/link.js":273,"../glov/client/local_storage.js":274,"../glov/client/net.js":279,"../glov/client/scroll_area.js":289,"../glov/client/selection_box.js":290,"../glov/client/settings.js":291,"../glov/client/shaders.js":293,"../glov/client/social.js":296,"../glov/client/spot":300,"../glov/client/sprites.js":302,"../glov/client/ui.js":306,"../glov/client/urlhash.js":307,"../glov/client/wsclient.js":313,"../glov/common/md5.js":324,"../glov/common/rand_alea.js":327,"../glov/common/util.js":330,"../glov/common/vmath.js":332,"./account_ui.js":3,"./analytics.js":5,"./analytics_ftue.js":6,"./app_access.js":11,"./client_cmds.js":34,"./continent_loader.js":38,"./create_first_world.js":60,"./debug.js":62,"./fbinstant_worlds.js":80,"./feedback":81,"./iframe_content_handlers.js":88,"./layout.js":99,"./localization/localization":108,"./login_rewards":111,"./main.js":112,"./menu.js":117,"./mod_api_host.js":121,"./paperdoll":125,"./photo_mode.js":128,"./red_dot.js":146,"./status.js":156,"./styles.js":160,"./tiles.js":162,"./ui_util.js":168,"./user_data.js":170,"./user_info_view.js":171,"./user_party.js":172,"./voxel_gen.js":177,"./waygate_ui.js":179,"./world_comm.js":182,"./world_info_local_cache.js":183,"./world_metadata.js":186}],114:[function(e,t,r){"use strict"
r.STAMINA_BY_MATERIAL=r.STAMINA_BY_MATERIAL_CLASS=r.MATERIAL_UNLIMITED_SPECIAL=r.MATERIAL_INGOT_SCALE=r.MATERIAL2_STAMINA_FACTOR=r.MATERIAL2_DURABILITY_FACTOR=r.MATERIAL_DURABILITY_FACTOR=r.MATERIAL_TOOL_DIG_RATE=r.MATERIAL_TO_MINE_MATERIAL=r.METAL_TIERS=r.MATERIAL_TO_MINE_STONE_TIER=r.MATERIAL_MAX_STONE_TIER=r.MATERIAL_DIG_RATE=r.ALLOYS=r.MATERIAL_NAME=r.MATERIAL_CODE_NAME=r.INV_MATERIAL_NAME=r.MATERIAL_DURABILITY_COST=r.INV_MATERIAL_TIER=r.MATERIAL_TIER=r.MATERIAL_CLASS=r.CRAFT_CLASS_TO_MATERIAL_CLASS=r.CRAFT_CLASS_DESC=r.CRAFT_CLASS_NAME=r.MATERIAL_CLASS_SOUND=r.MATERIAL_SOUND=r.MATERIAL_CLASS_NAME=r.LAST_LOCALIZED_MATERIAL_CLASS=r.MaterialClass=void 0
var a,i,o,n,s,l,c,_,u,d,f,v
var h=e("assert")
var p=e("../common/materials_common")
var m=p.CraftClass
var g=p.Mat
var E;(function(e){e[e["NONE"]=0]="NONE"
e[e["WOOD"]=1]="WOOD"
e[e["STONE"]=2]="STONE"
e[e["DIRT"]=3]="DIRT"
e[e["METAL"]=4]="METAL"
e[e["INGREDIENT"]=5]="INGREDIENT"
e[e["PAINT"]=6]="PAINT"})((r.MaterialClass=E)||(r.MaterialClass=E={}))
var y=E.METAL
r.LAST_LOCALIZED_MATERIAL_CLASS=y
var T=[]
r.MATERIAL_CLASS_NAME=T
var I=((a={})[g.COAL]="_coal",a)
r.MATERIAL_SOUND=I
var S=((i={})[E.NONE]="_dirt",i[E.WOOD]="_wood",i[E.STONE]="_stone",i[E.DIRT]="_dirt",i[E.METAL]="_metal",i)
r.MATERIAL_CLASS_SOUND=S
var A=[]
r.CRAFT_CLASS_NAME=A
var w=[]
r.CRAFT_CLASS_DESC=w
var L={};(r.CRAFT_CLASS_TO_MATERIAL_CLASS=L)[m.WOOD_RAW]=E.WOOD
L[m.STONE_RAW]=E.STONE
var R=((o={})[g.NONE]={tier:0,dur:0,mc:E.NONE},o[g.ANY]={tier:1,dur:0,mc:E.NONE},o[g.LEAF]={tier:1,dur:1,mc:E.WOOD},o[g.LIGHT_WOOD]={tier:2,dur:2,mc:E.WOOD},o[g.WOOD]={tier:3,dur:3,mc:E.WOOD},o[g.RED_WOOD]={tier:4,dur:3,mc:E.WOOD},o[g.DARK_WOOD]={tier:5,dur:4,mc:E.WOOD},o[g.FLINT]={tier:1,dur:1,mc:E.STONE},o[g.ROCK]={tier:2,dur:1,mc:E.STONE},o[g.STONE]={tier:3,dur:1,mc:E.STONE},o[g.CORAL]={tier:4,dur:1,mc:E.STONE},o[g.FANCY_STONE]={tier:5,dur:1,mc:E.STONE},o[g.UNUSED_STONE]={tier:6,dur:1,mc:E.STONE},o[g.SAND]={tier:1,dur:1,mc:E.DIRT},o[g.DIRT]={tier:2,dur:1,mc:E.DIRT},o[g.MUTTAL]={tier:1,dur:1,mc:E.METAL},o[g.COAL]={tier:2,dur:5,mc:E.METAL},o[g.COPPER]={tier:3,dur:10,mc:E.METAL},o[g.TIN]={tier:4,dur:5,mc:E.METAL},o[g.BRONZE]={tier:5,dur:15,mc:E.METAL},o[g.IRON]={tier:6,dur:10,mc:E.METAL},o[g.SILVER]={tier:7,dur:5,mc:E.METAL},o[g.EMBERYLLIUM]={tier:8,dur:10,mc:E.METAL},o[g.GOLD]={tier:9,dur:5,mc:E.METAL},o[g.BRIGHTSTEEL]={tier:10,dur:15,mc:E.METAL},o[g.COBALT]={tier:11,dur:10,mc:E.METAL},o[g.MYTHRIL]={tier:12,dur:10,mc:E.METAL},o[g.AETHERSTONE]={tier:13,dur:15,mc:E.METAL},o[g.AETHERSTEEL]={tier:14,dur:15,mc:E.METAL},o[g.REGULAR]={tier:15,dur:1,mc:E.METAL},o[g.FAST]={tier:16,dur:1,mc:E.METAL},o[g.SUPER]={tier:17,dur:1,mc:E.METAL},o[g.ANY_INGREDIENT]={tier:1,dur:1,mc:E.INGREDIENT},o[g.TOMATO]={tier:2,dur:1,mc:E.INGREDIENT},o[g.PUMPKIN]={tier:3,dur:1,mc:E.INGREDIENT},o[g.CARROT]={tier:4,dur:1,mc:E.INGREDIENT},o[g.RED_BERRY]={tier:5,dur:1,mc:E.INGREDIENT},o[g.BLUE_BERRY]={tier:6,dur:1,mc:E.INGREDIENT},o[g.YELLOW_BERRY]={tier:7,dur:1,mc:E.INGREDIENT},o[g.LABEL]={tier:8,dur:1,mc:E.INGREDIENT},o[g.HOT]={tier:9,dur:1,mc:E.INGREDIENT},o[g.PUNGENT]={tier:10,dur:1,mc:E.INGREDIENT},o[g.SAVORY]={tier:11,dur:1,mc:E.INGREDIENT},o[g.BREAD]={tier:12,dur:1,mc:E.INGREDIENT},o[g.BROWN_MUSHROOM]={tier:13,dur:1,mc:E.INGREDIENT},o[g.LUMINESCENT_MUSHROOM]={tier:14,dur:1,mc:E.INGREDIENT},o[g.RED_MUSHROOM]={tier:15,dur:1,mc:E.INGREDIENT},o[g.CORN]={tier:16,dur:1,mc:E.INGREDIENT},o[g.CORAL_MUSHROOM]={tier:17,dur:1,mc:E.INGREDIENT},o[g.RED]={tier:1,dur:1,mc:E.PAINT},o[g.ORANGE]={tier:2,dur:1,mc:E.PAINT},o[g.YELLOW]={tier:3,dur:1,mc:E.PAINT},o[g.GREEN]={tier:4,dur:1,mc:E.PAINT},o[g.BLUE]={tier:5,dur:1,mc:E.PAINT},o[g.PURPLE]={tier:6,dur:1,mc:E.PAINT},o)
var x={}
r.MATERIAL_CLASS=x
var O={}
r.MATERIAL_TIER=O
var b={}
r.INV_MATERIAL_TIER=b
var N={}
r.MATERIAL_DURABILITY_COST=N
var C={}
r.INV_MATERIAL_NAME=C
var M={}
r.MATERIAL_CODE_NAME=M
var D={}
r.MATERIAL_NAME=D;(function(){var e=0
var t=E[e]
var r={}
while("string"===typeof t){b[e]={}
r[e]={}
t=E[++e]}for(var a in R){var i=Number(a)
var o=R[i],n=o.mc,s=o.tier,l=o.dur
if(r[x[i]=n][s])h(false,"Duplicate Material tier for same MaterialClass")
r[n][s]=true
O[i]=s
b[n][s]=i
N[i]=l
C[g[i]]=i
M[i]=g[i]}})()
var P=((c={})[g.COPPER]=((n={})[g.TIN]=g.BRONZE,n),c[g.IRON]=((s={})[g.GOLD]=g.BRIGHTSTEEL,s),c[g.MYTHRIL]=((l={})[g.AETHERSTONE]=g.AETHERSTEEL,l),c)
r.ALLOYS=P
var k=((_={})[g.LEAF]=.25,_[g.LIGHT_WOOD]=1.8,_[g.WOOD]=2,_[g.RED_WOOD]=2,_[g.DARK_WOOD]=2.5,_)
var B={}
r.MATERIAL_DIG_RATE=B;(function(){for(var e in k){var t=e
B[t]=1/k[t]}})()
var U=((u={})[g.LIGHT_WOOD]={st:0,mt:0,dr:0,td:0,td2:.9,ts2:.7,it:0},u[g.WOOD]={st:0,mt:0,dr:0,td:0,td2:1,ts2:1,it:0},u[g.RED_WOOD]={st:0,mt:0,dr:0,td:0,td2:1.1,ts2:1,it:0},u[g.DARK_WOOD]={st:0,mt:0,dr:0,td:0,td2:1.2,ts2:1.1,it:0},u[g.MUTTAL]={st:0,mt:0,dr:.25,td:.1,td2:.1,ts2:1,it:1},u[g.FLINT]={st:0,mt:g.COAL,dr:.25,td:.5,td2:0,ts2:1,it:0},u[g.STONE]={st:0,mt:g.COPPER,dr:.4,td:.3,td2:0,ts2:1,it:0},u[g.COPPER]={st:1,mt:g.TIN,dr:.7,td:.6,td2:1,ts2:1.2,it:1},u[g.TIN]={st:1,mt:g.TIN,dr:.33,td:.1,td2:1,ts2:1,it:1},u[g.BRONZE]={st:2,mt:g.IRON,dr:1,td:1.4,td2:1.3,ts2:1.2,it:1},u[g.IRON]={st:3,mt:g.EMBERYLLIUM,dr:1.25,td:1,td2:1.32,ts2:1.2,it:2},u[g.SILVER]={st:4,mt:g.EMBERYLLIUM,dr:.5,td:.2,td2:1,ts2:1.1,it:2},u[g.EMBERYLLIUM]={st:4,mt:g.GOLD,dr:1.5,td:1.7,td2:1.34,ts2:1.2,it:4},u[g.GOLD]={st:2,mt:g.GOLD,dr:.5,td:.2,td2:1,ts2:1.1,it:4},u[g.BRIGHTSTEEL]={st:5,mt:g.COBALT,dr:2,td:2.2,td2:1.36,ts2:1.1,it:4},u[g.COBALT]={st:6,mt:g.MYTHRIL,dr:3,td:1.9,td2:1,ts2:1.1,it:8},u[g.MYTHRIL]={st:7,mt:g.AETHERSTEEL,dr:4,td:2,td2:1.2,ts2:1,it:16},u[g.AETHERSTONE]={st:4,mt:g.AETHERSTONE,dr:.5,td:.2,td2:1,ts2:1.2,it:16},u[g.AETHERSTEEL]={st:8,mt:g.AETHERSTEEL,dr:5,td:2.5,td2:1.4,ts2:1,it:16},u[g.REGULAR]={st:8,mt:g.AETHERSTEEL,dr:1,td:1,td2:0,ts2:1,it:0},u[g.FAST]={st:8,mt:g.AETHERSTEEL,dr:4,td:1,td2:0,ts2:1,it:0},u[g.SUPER]={st:8,mt:g.AETHERSTEEL,dr:10,td:1,td2:0,ts2:1,it:0},u)
var G={}
r.MATERIAL_MAX_STONE_TIER=G
var F={}
r.MATERIAL_TO_MINE_STONE_TIER=F
var W={}
r.METAL_TIERS=W
var j={}
r.MATERIAL_TO_MINE_MATERIAL=j
var H=[]
r.MATERIAL_TOOL_DIG_RATE=H
var z={}
r.MATERIAL_DURABILITY_FACTOR=z
var V={}
r.MATERIAL2_DURABILITY_FACTOR=V
var Y={}
r.MATERIAL2_STAMINA_FACTOR=Y
var q={}
r.MATERIAL_INGOT_SCALE=q
var K=((d={})[g.REGULAR]=true,d[g.FAST]=true,d[g.SUPER]=true,d)
r.MATERIAL_UNLIMITED_SPECIAL=K;(function(){for(var e in U){var t=Number(e)
var r=U[t],a=r.st,i=r.mt,o=r.dr,n=r.td,s=r.td2,l=r.ts2,c=r.it
G[t]=a
if(!F[a]||F[a]>t)F[a]=t
if(i){var _=O[i]
W[t]=_
for(var u=1;u<=_;++u){var d=b[E.METAL][u]
if(d&&(!j[d]||_<W[j[d]]))j[d]=t}}else W[t]=-1
H[t]=o
z[t]=n
V[t]=s
Y[t]=l
q[t]=c}})()
var Z=((f={})[E.WOOD]=100,f[E.STONE]=20,f[E.DIRT]=40,f[E.METAL]=120,f[E.INGREDIENT]=20,f[E.PAINT]=20,f)
r.STAMINA_BY_MATERIAL_CLASS=Z
var X=((v={})[g.LEAF]=20,v)
r.STAMINA_BY_MATERIAL=X},{"../common/materials_common":201,assert:void 0}],115:[function(e,t,r){"use strict"
r.mazeGen=mazeGen
r.M_DOOR=r.M_TORCH=r.M_INTERIOR=r.M_TREASURE=r.M_LEAF=r.M_WALL=r.M_OPEN=void 0
var x=e("assert")
var h=Math.abs,O=Math.max,b=Math.min,N=Math.round
var a=e("../glov/common/rand_alea.js").randCreate
var i=e("../glov/common/util.js"),C=i.clamp,p=i.ridx,m=i.sign
var o=0
r.M_OPEN=o
var M=1
r.M_WALL=M
var D=2
r.M_LEAF=D
var g=3
r.M_TREASURE=g
var P=4
r.M_INTERIOR=P
var k=5
r.M_TORCH=k
var B=6
r.M_DOOR=B
var U=a(1)
function mazeGen(e){var S=e.w,t=e.h,T=e.min_dim,A=e.door_w,I=e.r1,r=e.treasure,a=e.treasure_size,i=e.seed
var w=new Uint8Array(S*t)
var o=0
U.reseed(i)
function paintDepth(e,t,r){var a=t<<4
var i=r.rooms,o=r.x,n=r.y
x(i)
for(var s=0;s<A;++s)for(var l=0;l<A;++l){var c=o+s+(n+l)*S
if(w[c]===B)w[c]|=a}a=e<<4
var _=[]
for(var u=0;u<i.length;++u){var d=i[u]
if(void 0!==d.depth)continue
d.depth=e
var f=d.x0,v=d.y0,h=d.x1,p=d.y1,m=d.doors
for(var g=0;g<m.length;++g)_.push(m[g])
for(var E=f;E<=h;++E)for(var y=v;y<=p;++y)w[E+y*S]|=a}for(var T=0;T<_.length;++T){var I=C(e+U.range(3)-1,0,15)
paintDepth(I,O(I,e),_[T])}}function line(e,t,r,a,i){x(i)
var o=m(r-e)
var n=m(a-t)
x(h(o)+h(n)<=1)
w[e+t*S]=i
while(e!==r||t!==a)w[(e+=o)+(t+=n)*S]=i}function drawRect(e,t,r,a,i){for(var o=e;o<=r;++o)for(var n=t;n<=a;++n)w[o+n*S]=i}var L=[]
function doorAt(e,t,r){o=O(o,e)
for(var a=0;a<e;++a)if(t>=L[a].x&&t<L[a].x+A&&r>=L[a].y&&r<L[a].y+A)return true
return false}var R=[]
function divide(e,t,r,a,i){var o=a-t
var n=i-r
var s=.25+I
do{if(O(o,n)<2*T+1)break
if(b(o,n)<=T)break
var l=(2*U.range(2)-1)*s
s++
if(o>n){var c=t+N((o-A)/2+l)
if(c<t+T||c>a-T)break
if(doorAt(e,c,r-1)||doorAt(e,c,i+1))continue
var _=r+U.range(n-A)
if(_>r)line(c,r,c,_-1,M)
if(_<=i-A)line(c,_+A,c,i,M)
L[e]={x:c,y:_}
line(c,_,c,_+A-1,B)
divide(e+1,t,r,c-1,i)
divide(e+1,c+1,r,a,i)}else{var u=r+N((n-1)/2+l)
if(u<r+T||u>i-T)break
if(doorAt(e,t-1,u)||doorAt(e,a+1,u))continue
var d=t+U.range(o-A)
if(d>t)line(t,u,d-1,u,M)
if(d<=a-A)line(d+A,u,a,u,M)
L[e]={x:d,y:u}
line(d,u,d+A-1,u,B)
divide(e+1,t,r,a,u-1)
divide(e+1,t,u+1,a,i)}return}while(true)
var f={x0:t,x1:a,y0:r,y1:i,doors:[]}
var v=0
for(var h=0;h<e;++h){var p=L[h]
if((p.x===t-1||p.x===a+1)&&p.y>=r&&p.y<=i||(p.y===r-1||p.y===i+1)&&p.x>=t&&p.x<=a){v++
f.doors.push(p)
p.rooms=p.rooms||[]
p.rooms.push(f)}}if(1===v){drawRect(t,r,a,i,D)
R.push(f)}else{var m=null
var g=0
for(var E=t;E<=a;++E)for(var y=r;y<=i;++y)if(E===t||E===a||y===r||y===i)if(E===t&&doorAt(e,E-1,y)||E===a&&doorAt(e,E+1,y)||y===r&&doorAt(e,E,y-1)||y===i&&doorAt(e,E,y+1));else{++g
if(!U.range(g))m=E+y*S}else w[E+y*S]=P
if(m)w[m]=k}}line(0,0,S-1,0,M)
line(S-1,0,S-1,t-1,M)
line(S-1,t-1,0,t-1,M)
line(0,t-1,0,0,M)
divide(0,1,1,S-2,t-2)
var n=N(r*S*t)
while(n&&R.length){var s=U.range(R.length)
var l=R[s]
p(R,s)
var c=l.x1-l.x0+1
var _=l.y1-l.y0+1
if(c<a+2||_<a+2)continue;--n
var u=1+U.range(c-a-2)
var d=1+U.range(_-a-2)
var f=l.x0+u
var v=l.y0+d
drawRect(f,v,f+a-1,v+a-1,g)}if(L[0])paintDepth(7,7,L[0])
w.max_depth=o
return w}},{"../glov/common/rand_alea.js":327,"../glov/common/util.js":330,assert:void 0}],116:[function(e,t,r){"use strict"
r.countWaiting=countWaiting
r.megachunkResubscribing=megachunkResubscribing
r.onVolumeMod=onVolumeMod
r.detailGenAttachChoices=detailGenAttachChoices
r.detailGenUnspoil=detailGenUnspoil
r.megachunkTickOMP=megachunkTickOMP
r.onTransSetTile=onTransSetTile
r.shift=shift
r.resubscribe=resubscribe
r.isSpoiled=isSpoiled
r.isSpoiledDebug=isSpoiledDebug
r.megaChunkGetNearbyVolumes=megaChunkGetNearbyVolumes
r.megachunkGetSettlement=megachunkGetSettlement
r.megachunkForVolumeID=megachunkForVolumeID
r.megachunk2DReady=megachunk2DReady
r.megachunk2DHasZMap=megachunk2DHasZMap
r.getSpoilInfo=getSpoilInfo
r.hasMegachunkForChunkId=hasMegachunkForChunkId
r.isSpoiledByChunkId=isSpoiledByChunkId
r.hexomeChoiceGet=hexomeChoiceGet
r.hexomeChoiceReady=hexomeChoiceReady
r.hexomeChoiceSet=hexomeChoiceSet
r.spoil=spoil
r.unspoil=unspoil
r.handleZMapData=handleZMapData
r.drawDebug=drawDebug
r.init=init
r.reset=reset
var _=e("assert")
var i=e("../glov/common/dot-prop.js")
var s=e("./editvolume_client.js").updateEditVolumes
var f=e("../glov/client/engine.js")
var a=e("../common/globals.js"),B=a.CHUNK_SIZE,l=a.CS2,U=a.ID_FACTOR,G=a.ID2,n=a.MC_COUNT,F=a.MEGACHUNK_SIZE
var W=e("../glov/client/input.js")
var d=e("./lods.js").lodOnZMap
var v=e("./main.js")
var h=Math.floor,j=Math.max,p=Math.random,H=Math.round
var o=e("../common/megachunk_common.js")
var m=e("../glov/client/net.js").netDisconnected
var g=e("./voxel_gen.js").voxelGenUnsubMegachunk2Ds
var c=e("./proc_gen_constants.js").HEX_WIDTH
var u=e("./proc_gen_details.js").detailGenMCIDs2
var E=e("./proc_gen_biomes.js")
var y=e("../glov/common/rand_alea.js").mashString
var T=e("./settlement.js").settlementUpdate
var z=e("../glov/client/ui.js")
var I=e("./user_data.js").worldReadOnly
var S=e("../glov/common/util.js").callEach
var A=e("../glov/common/vmath.js"),V=A.vec3,w=A.v3addScale,Y=A.v3scaleFloor,L=A.v3iAdd,R=A.unit_vec
var x=e("./voxel_chunk_manager.js")
var O=x.STREAM_ABS_DIST
var q=e("./voxel_data.js")
var b=e("../common/voxel_data_common.js"),N=b.zmapSerialize,C=b.zmapDeserialize
var M=e("./voxel_gen.js"),D=M.voxelGenQueueDetailData,P=M.voxelGenQueueHexomeChoices
var k=e("./voxel_mesh.js"),K=k.voxelMeshQueueZMaps,X=k.voxelMeshRequestZMap,Q=k.voxelMeshUnsubMegachunk2Ds
var J=e("./world_comm.js").worldSend
var $=e("../common/world_constants.js").VOLUME_SETTLEMENT_PREFIX
var ee=e("./world_metadata.js").worldSeed
var te={}
var re=true
var ae={}
var ie={}
var oe={}
var ne=0
var se=0
function countWaiting(){return ne}function megachunkResubscribing(){return se}function initShared(e){e.resubscribe=false
e.startWaiting()}function MegaChunk(e){this.mcid=e
this.spoiled=null
this.details=null
initShared(this)}MegaChunk.prototype.disposeBase=function(){if(this.waiting){this.waiting=false;--ne}if(this.resubscribe){this.resubscribe=false;--se}}
MegaChunk.prototype.dispose=function(){this.disposeBase()
if(this.details)D(this.mcid,null)}
MegaChunk.prototype.startWaiting=function(){_(!this.waiting)
this.waiting=true;++ne
this.ready_cbs=[]}
MegaChunk.prototype.doneWaiting=function(){if(this.waiting){this.waiting=false;--ne
if(this.resubscribe){this.resubscribe=false;--se}S(this.ready_cbs,this.ready_cbs=null,this)}}
MegaChunk.prototype.onData=function(e){var t=e.spoiled,r=e.details,a=e.volumes
var i=0
for(var o=0;o<t.length;++o)i+=t[o]
_.equal(i,n)
this.spoiled=t
this.details=r
this.details_spoiled=Boolean(r)
this.volumes=a
if(this.details)D(this.mcid,this.details)
else this.detailsInit()
this.doneWaiting()}
MegaChunk.prototype.isSpoiled=function(e){return o.isSpoiled(this.spoiled,e)}
MegaChunk.prototype.spoil=function(e){o.spoil(this.spoiled,e)}
MegaChunk.prototype.unspoil=function(e){o.unspoil(this.spoiled,e)}
MegaChunk.prototype.detailsInit=function(){_(!this.details)
_(!this.details_spoiled)
if(this.spoiled[0]!==n)this.details={ver:0,seed:0}
else{var e=E.getDetailsVersion()
var t=e?y(this.mcid+":"+ee()):0
this.details={ver:e,seed:t}}D(this.mcid,this.details)}
function onMegaChunk(e,t){var r=e.list
for(var a=0;a<r.length;++a){var i=r[a]
var o=i.mcid
var n=te[o]
if(!n){console.log("Received MegaChunk update for "+o+" to which we are not subscribed")
continue}n.onData(i)}s()
T()
t()}function onVolumeMod(e,t,r){var a=te[e]
if(!a){console.log("Received MegaChunk VolumeMod for "+e+" to which we are not subscribed")
return}if(!a.volumes)a.volumes={}
if(void 0===r||null===r)i.delete(a.volumes,t)
else i.set(a.volumes,t,r)
if(!t.includes(".settlement"))s()
T()}function detailGenAttachChoices(e,t){var r=[]
var a=u(r,t.pos)
for(var i=0;i<a;++i){var o=r[i]
var n=te[o]
_(n)
if(!n.details_spoiled){n.details_spoiled=true
e.tset.sendDetailData(o,n.details)}}}function detailGenUnspoil(e){var t=te[e]
if(t)t.details_spoiled=false}function MegaChunk2D(e){this.zmaps={}
initShared(this)
this.mcid=e
var t=H(e/U)
var r=(e-t*U)*F
var a=t*F
this.root_vsid=a*U+r}MegaChunk2D.prototype.startWaiting=MegaChunk.prototype.startWaiting
MegaChunk2D.prototype.doneWaiting=MegaChunk.prototype.doneWaiting
MegaChunk2D.prototype.dispose=MegaChunk.prototype.disposeBase
MegaChunk2D.prototype.onData=function(e){var t=e.zmap
var r=[]
for(var a in t){var i=t[a]
a=Number(a)
this.zmaps[a]=i
var o=new Int16Array(l)
var n=C(o,i)
_(!n,n)
var s=this.root_vsid+h(a/F)*U+a%F
r.push({vsid:s,data:o,from:"server"})
d({vsid:s,data:o,encoded:i,from:"server"})
if(oe[s])delete oe[s]}K(r)
this.doneWaiting()}
function onMegaChunk2D(e,t){var r=e.list
for(var a=0;a<r.length;++a){var i=r[a]
var o=i.mcid
var n=ae[o]
if(!n){console.log("Received MegaChunk2D update for "+o+" to which we are not subscribed")
continue}n.onData(i)}t()}function MegaChunkHC(e){this.choices={}
initShared(this)
this.mcid=e}MegaChunkHC.prototype.startWaiting=MegaChunk.prototype.startWaiting
MegaChunkHC.prototype.doneWaiting=MegaChunk.prototype.doneWaiting
MegaChunkHC.prototype.dispose=MegaChunk.prototype.disposeBase
MegaChunkHC.prototype.onData=function(e){var t=e.choices
for(var r in t){var a=t[r]
this.choices[r]=a}P(t)
this.doneWaiting()}
function onMegaChunkHC(e,t){var r=e.list
for(var a=0;a<r.length;++a){var i=r[a]
var o=i.mcid
var n=ie[o]
if(!n){console.log("Received MegaChunkHC update for "+o+" to which we are not subscribed")
continue}n.onData(i)}t()}var le=new Array(8)
var ce=0
function isMyEdit(e){return-1!==le.indexOf(e)}function megachunkTickOMP(e){var t=false
for(var r in oe){var a=oe[r]
var i=a.mcid,o=a.send_at,n=a.was_pristine
if(!ae[i]){delete oe[r]
continue}if(!n&&isMyEdit(Number(r))||f.frame_timestamp>=o||e)t=true}if(!t||m())return
var s=[]
for(var l in oe){var c=oe[l]
var _=c.mcid,u=c.idx,d=c.data
ae[_].zmaps[u]=d
s.push([Number(l),d])}oe={}
if(s&&!I())J("world_zmap",s)}var _e="REQUEST_PRISTINE"
var ue="REQUEST_PRISTINE_HANDLED"
function onTransSetTile(e){var t=h(e[0]/F)
var r=h(e[1]/F)
var a=ae[r*U+t]
if(!a)return
var i=e[0]-t*F+F*(e[1]-r*F)
var o=e[1]*U+e[0]
if(!a.zmaps[i]){X(o)
a.zmaps[i]=_e}if(-1===le.indexOf(o)){le[ce++]=o
ce%=le.length}}var de=V()
var fe=V()
var ve=O+c/B
function shift(){if(!v.omp)return
w(de,q.origin_chunk,R,-x.view_dist-ve)
w(fe,q.origin_chunk,R,x.view_dist+ve)
Y(de,de,1/F)
Y(fe,fe,1/F)
w(de,de,R,-1)
L(fe,R)
fe[2]++
var e={}
var t=[]
for(var r=de[2];r<=fe[2];++r)for(var a=de[1];a<=fe[1];++a)for(var i=de[0];i<=fe[0];++i){var o=(r*U+a)*U+i
e[o]=true
if(te[o])continue
t.push(o)
te[o]=new MegaChunk(o)
re=false}var n=[]
for(var s in te){if(e[s])continue
n.push(Number(s))
te[s].dispose()
delete te[s]}if(!t.length)t=void 0
if(!n.length)n=void 0
if(t||n)J("mc_sub",{unsub:n,sub:t})
e={}
t=[]
for(var l=de[1];l<=fe[1];++l)for(var c=de[0];c<=fe[0];++c){var _=l*U+c
e[_]=true
if(ae[_])continue
t.push(_)
ae[_]=new MegaChunk2D(_)}n=[]
for(var u in ae){if(e[u])continue
n.push(Number(u))
ae[u].dispose()
delete ae[u]}if(!t.length)t=void 0
if(!n.length)n=void 0
else{megachunkTickOMP(true)
Q(n)
g(n)}if(t||n)J("mc2d_sub",{unsub:n,sub:t})
var d=0
t=[];(e={})[d]=true
if(!ie[d]){t.push(d)
ie[d]=new MegaChunkHC(d)}n=[]
for(var f in ie){if(e[f])continue
n.push(Number(f))
ie[f].dispose()
delete ie[f]}if(!t.length)t=void 0
if(!n.length)n=void 0
if(t||n)J("mchc_sub",{unsub:n,sub:t})}function resubscribe(){var e=[]
for(var t in te){t=Number(t)
var r=te[t]
if(!r.waiting){r.startWaiting()
r.resubscribe=true;++se}e.push(t)}if(e.length)J("mc_sub",{sub:e})
e=[]
for(var a in ae){a=Number(a)
var i=ae[a]
if(!i.waiting){i.startWaiting()
i.resubscribe=true;++se}e.push(a)}if(e.length)J("mc2d_sub",{sub:e})
e=[]
for(var o in ie){o=Number(o)
var n=ie[o]
if(!n.waiting){n.startWaiting()
n.resubscribe=true;++se}e.push(o)}if(e.length)J("mchc_sub",{sub:e})}var he=new Int32Array(3)
function isSpoiledWithDetailsOnReady(e,t){if(!t.details)t.detailsInit()
if(!--e.waiting){var r=e.query_mc.isSpoiled(e.local_pos)
e.cb(r)}}var pe=[]
function isSpoiledWithDetails(e,t,r){var a=u(pe,t)
var i=0
var o
var n
for(var s=0;s<a;++s){var l=pe[s]
var c=te[l]
_(c)
if(c.waiting){i++
if(!n){o={cb:r,query_mc:e,local_pos:he.slice(0)}
n=isSpoiledWithDetailsOnReady.bind(null,o)}c.ready_cbs.push(n)}else if(!c.details)c.detailsInit()}if(!i)r(e.isSpoiled(he))
else o.waiting=i}var me=new Int32Array(3)
function isSpoiled(e,t){Y(me,e,1/F)
w(he,e,me,-F)
_(me[0]>=de[0]&&me[0]<=fe[0])
_(me[1]>=de[1]&&me[1]<=fe[1])
_(me[2]>=de[2]&&me[2]<=fe[2])
var r=(me[2]*U+me[1])*U+me[0]
var a=te[r]
_(a)
if(!t){_(!a.waiting)
return a.isSpoiled(he)}isSpoiledWithDetails(a,e,t)}function isSpoiledDebug(e){Y(me,e,1/F)
w(he,e,me,-F)
var t=(me[2]*U+me[1])*U+me[0]
var r=te[t]
if(!r||r.waiting)return false
return r.isSpoiled(he)}function megaChunkGetNearbyVolumes(){if(re)return{}
var e=q.origin_chunk
Y(me,e,1/F)
if(me[0]-1<de[0]||me[0]+1>fe[0]||me[1]-1<de[1]||me[1]+1>fe[1]||me[2]-1<de[2]||me[2]+1>fe[2])_(false,"mchunkpos out of range; origin="+e+", mc0="+de+", mc1="+fe)
var t=(me[2]*U+me[1])*U+me[0]
var r={}
for(var a=-1;a<=1;++a)for(var i=-1;i<=1;++i)for(var o=-1;o<=1;++o){var n=t+(a*U+i)*U+o
var s=te[n]
if(s&&!s.waiting)for(var l in s.volumes){var c=s.volumes[l]
c.mcid=n
r[c.volume_id=l]=c}}return r}function megachunkGetSettlement(e,t){var r,a
var i=te[e]
_(i)
_(!i.waiting)
var o=""+$+t
return null==(r=i.volumes)?void 0:null==(a=r[o])?void 0:a.settlement}function megachunkForVolumeID(e){for(var t in te){var r=te[t]
if(!r.waiting&&r.volumes&&r.volumes[e])return r}return null}function megachunk2DReady(e,t){var r=h(e[0]/F)
var a=h(e[1]/F)
var i=ae[a*U+r]
if(!i)return void t()
if(!i.waiting)return void t()
i.ready_cbs.push(t)}function megachunk2DHasZMap(e){var t=e[0]
var r=e[1]
var a=h(t/F)
var i=h(r/F)
var o=t-a*F+F*(r-i*F)
var n=ae[i*U+a]
if(!n)return false
return n.zmaps[o]&&n.zmaps[o]!==_e}function getSpoilInfo(e){me[0]=h(e[0]/F)
me[1]=h(e[1]/F)
me[2]=h(e[2]/F)
he[0]=e[0]-me[0]*F
he[1]=e[1]-me[1]*F
he[2]=e[2]-me[2]*F
var t=(me[2]*U+me[1])*U+me[0]
var r=te[t]
if(!r||r.waiting)return
return{spoiled:r.isSpoiled(he),details:r.details,details_spoiled:r.details_spoiled}}function hasMegachunkForChunkId(e){var t=o.parseChunkId(e)
return Boolean(te[t.mcid]&&!te[t.mcid].waiting)}function isSpoiledByChunkId(e){var t=o.parseChunkId(e)
var r=te[t.mcid]
_(r)
_(!r.waiting)
return r.isSpoiled(t.local_pos)}function hexomeChoiceGet(e){var t=ie[0]
_(t&&!t.waiting)
return t.choices[e]}function hexomeChoiceReady(e){var t=ie[0]
_(t)
if(!t.waiting){if(e)e()
return true}if(e)t.ready_cbs.push(e)
return false}function hexomeChoiceSet(e,t){var r=ie[0]
if(r&&!r.waiting)r.choices[e]=t
else _(!t)}function spoil(e){var t=o.parseChunkId(e)
var r=t.mcid
var a=te[r]
if(!a){console.log("Received world_spoiled for unknown MegaChunk "+r+", ignoring")
return}if(a.waiting){console.log("Received world_spoiled for waiting MegaChunk "+r+", ignoring")
return}a.spoil(t.local_pos)}function unspoil(e){var t=o.parseChunkId(e)
var r=t.mcid
var a=te[r]
if(!a){console.log("Received world_unspoiled for unknown MegaChunk "+r+", ignoring")
return}if(a.waiting){console.log("Received world_unspoiled for waiting MegaChunk "+r+", ignoring")
return}a.unspoil(t.local_pos)}var ge=500
var Ee=500
function handleZMapData(e){if(!v.omp)return
for(var t in e){var r=e[t]
var a=N(r)
t=Number(t)
var i=H(t/U)
var o=t-i*U
var n=h(o/F)
var s=h(i/F)
var l=s*U+n
var c=o-n*F+F*(i-s*F)
var _=ae[l]
if(!_)continue
if(_.zmaps[c]===a)continue
d({vsid:t,data:r,encoded:a,from:"mesh"})
var u=false
if(_.zmaps[c]===_e){u=true
_.zmaps[c]=ue}oe[t]={mcid:l,idx:c,data:a,send_at:f.frame_timestamp+ge+p()*Ee,was_pristine:u}}}function drawDebug(){var e=10
var t=0
var r=10
var a=Z.DEBUG
var i=16
var o=10*i
var n=V()
var s=drawDebug.style_me=drawDebug.style_me||z.font.styleColored(null,2164228351)
var l=drawDebug.style_sel=drawDebug.style_sel||z.font.styleColored(null,4294934783)
var c=drawDebug.style_spoiled=drawDebug.style_spoiled||z.font.styleColored(null,4286611711)
var _=drawDebug.style_volume=drawDebug.style_volume||z.font.styleColored(null,4286644223)
Y(n,q.origin_chunk,1/F)
var u
for(var d=fe[2];d>=de[2];--d){var f=e+(fe[0]-de[0]+1)*i
for(var v=fe[1];v>=de[1];--v){var h=f
for(var p=de[0];p<=fe[0];++p){var m=(d*U+v)*U+p
var g=null
if(n[0]===p&&n[1]===v&&n[2]===d)g=s
var E=te[m]
var y=0
if(E.spoiled)for(var T=1;T<E.spoiled.length;T+=2)y+=E.spoiled[T]
var I=E.volumes||{}
var S=Object.keys(I).length
if(W.mouseOver({x:h,y:r,w:o,h:i})){g=l
u={numspoiled:y,mcid:m}}var A=h
A+=z.font.drawSized(g,A,r,a,i,""+m)+4
if(y){var w=128*(1-y/32768)|0
A+=z.font.drawSized(z.font.styleColored(null,4278190335|(w=w<<16|w<<8)),A,r,a,i,"s:"+y)+4}if(E.details){var L="d:"+E.details.ver
g=null
if(E.details_spoiled){L+=",s"
g=c}A+=z.font.drawSized(g,A,r,a,i,L)+4}if(S)A+=z.font.drawSized(_,A,r,a,i,"vol:"+S)+4
h+=o+4}t=j(t,h)
r+=i
f-=i}r+=1.5*i}if(u){var R=u,x=R.mcid,O=R.numspoiled
var b=te[x]
z.print(null,e,r,a,"Selected: "+x)
r+=z.font_height
z.print(null,e,r,a,"Spoiled chunks: "+O)
r+=z.font_height
z.print(null,e,r,a,b.details?"Details version: "+b.details.ver+" ("+(b.details_spoiled?"":"un")+"spoiled)":"No details data")
r+=z.font_height
var N=H(x/G)
var C=H((x-=N*G)/U)
var M=x-C*U
z.print(null,e,r,a,"MC POS: "+M+","+C+","+N)
r+=z.font_height
M*=F
C*=F
N*=F
var D=F-1
z.print(null,e,r,a,"Chunks: ["+M+","+C+","+N+"] - ["+(M+D)+","+(C+D)+","+(N+D)+"]")
r+=z.font_height
M*=B
C*=B
N*=B
D=B*F-1
z.print(null,e,r,a,"World: ["+M+","+C+","+N+"] - ["+(M+D)+","+(C+D)+","+(N+D)+"]")
r+=z.font_height
var P=Object.keys(b.volumes||{})
if(P.length){z.print(null,e,r,a,"Volumes: "+P)
r+=z.font_height}var k=P.filter(function(e){return b.volumes[e].settlement})
if(k.length){z.print(null,e,r,a,"Settlements: "+k)
r+=z.font_height}}z.drawRect(e-5,5,t+5,r+5,a-1,[0,0,0,.8])}function init(e,t){e.onChannelMsg("world","mc",t(onMegaChunk))
e.onChannelMsg("world","mc2d",t(onMegaChunk2D))
e.onChannelMsg("world","mchc",t(onMegaChunkHC))}function reset(e){te={}
re=true
ae={}
oe={}
ie={}
se=ne=0}},{"../common/globals.js":197,"../common/megachunk_common.js":202,"../common/voxel_data_common.js":209,"../common/world_constants.js":212,"../glov/client/engine.js":250,"../glov/client/input.js":271,"../glov/client/net.js":279,"../glov/client/ui.js":306,"../glov/common/dot-prop.js":319,"../glov/common/rand_alea.js":327,"../glov/common/util.js":330,"../glov/common/vmath.js":332,"./editvolume_client.js":72,"./lods.js":109,"./main.js":112,"./proc_gen_biomes.js":133,"./proc_gen_constants.js":134,"./proc_gen_details.js":136,"./settlement.js":148,"./user_data.js":170,"./voxel_chunk_manager.js":174,"./voxel_data.js":175,"./voxel_gen.js":177,"./voxel_mesh.js":178,"./world_comm.js":182,"./world_metadata.js":186,assert:void 0}],117:[function(e,t,m){"use strict"
m.setFadePanel=setFadePanel
m.shift=shift
m.getMenuPage=getMenuPage
m.getMenuLastPage=getMenuLastPage
m.isBuildMenu=isBuildMenu
m.menuActive=menuActive
m.doQuickSlotMenu=doQuickSlotMenu
m.clear=clear
m.isQuickMenu=isQuickMenu
m.menuHidesQuickbar=menuHidesQuickbar
m.menuWantsQuickbarScroll=menuWantsQuickbarScroll
m.init=init
m.startup=startup
m.menuX1=menuX1
m.menuY1=menuY1
m.menuInteractGetPos=menuInteractGetPos
m.menuInteractGetProp=menuInteractGetProp
m.onTokenGen=onTokenGen
m.fscreenEnterAndOrient=fscreenEnterAndOrient
m.menuPanelX0=menuPanelX0
m.prefixShortcutKey=prefixShortcutKey
m.setMenuPageLayout=setMenuPageLayout
m.tickMenu=tickMenu
m.exitSpecificMenu=exitSpecificMenu
m.page_open_frame=m.page=m.hint_color=m.panel_color_popup=m.panel_color=m.tab_colors_unselected=m.tab_colors_selected=m.PANEL_PAD=m.BORDER=m.KEEP=m.CHARACTER_CUSTOMIZATION=m.ACCESS_CONTROL=m.RACE_RESULTS=m.PHOTO_VIEW=m.PROP_EDIT=m.WAYGATE_TARGETS=m.WORLD_INFO_VIEW=m.BLUEPRINT_VIEW=m.BLUEBOX=m.QUICK_SLOT=m.SETTINGS=m.WORLD_INFO_VIEW_SELF=m.SOCIAL=m.ENERGY_WELL=m.WAYGATE_EDIT_REMOTE=m.WAYGATE_EDIT=m.FACTORY=m.CONTAINER=m.BUILD=m.INVENTORY=m.NONE=m.DEFAULT=void 0
var r=-1
m.DEFAULT=r
var a=0
m.NONE=a
var g=1
m.INVENTORY=g
var E=2
m.BUILD=E
var y=3
m.CONTAINER=y
var T=4
m.FACTORY=T
var I=5
m.WAYGATE_EDIT=I
var S=6
m.WAYGATE_EDIT_REMOTE=S
var A=7
m.ENERGY_WELL=A
var w=8
m.SOCIAL=w
var L=9
m.WORLD_INFO_VIEW_SELF=L
var R=10
m.SETTINGS=R
var x=20
m.QUICK_SLOT=x
var O=21
m.BLUEBOX=O
var b=22
m.BLUEPRINT_VIEW=b
var N=23
m.WORLD_INFO_VIEW=N
var C=24
m.WAYGATE_TARGETS=C
var M=25
m.PROP_EDIT=M
var D=26
m.PHOTO_VIEW=D
var P=27
m.RACE_RESULTS=P
var k=28
m.ACCESS_CONTROL=k
var B=30
m.CHARACTER_CUSTOMIZATION=B
var i="keep"
m.KEEP=i
var o=50
m.BORDER=o
var U=20
m.PANEL_PAD=U
var G=e("../glov/client/ui.js")
var n=e("../glov/common/vmath.js"),s=n.vec2,F=n.v2set,l=n.vec3,c=n.v3iAdd,_=n.v3distSq,u=n.vec4,d=n.v4set
var W=G.makeColorSet([1,1,1,1])
d((m.tab_colors_selected=W).rollover,1,1,1,1)
var j=G.makeColorSet([.5,.5,.5,1])
d((m.tab_colors_unselected=j).rollover,.8,.8,.8,1)
d(j.down,1,1,1,1)
var H=u(208/255,208/255,208/255,1)
m.panel_color=H
var f=u(228/255,228/255,228/255,1)
m.panel_color_popup=f
var v=u(.75,1,.75,1)
m.hint_color=v
var z=e("./access_control.js").doAccessControl
var h=e("./analytics.js").logEventOnce
var p=e("assert")
var V=e("./bluebox_ui.js"),Y=V.blueboxGetTitle,q=V.blueboxShift,K=V.blueboxUIInit,X=V.blueprintViewInit,Q=V.doBluebox,J=V.doBlueprintView
var $=e("./blueprint.js"),ee=$.blueprintGetDef,te=$.blueprintIdValid
var re=e("../glov/client/browser.js").is_discrete_gpu
var ae=e("./build_menu.js"),ie=ae.buildMenuInit,oe=ae.buildMenuStartup,ne=ae.doBuild
var se=e("./build_mode.js")
var le=se.unlimitedMode
var ce=e("../glov/client/camera2d.js")
var _e=e("../glov/client/cmds.js").cmd_parse
var ue=e("../glov/client/engine.js")
var de=e("./factory_ui.js"),fe=de.factoryUIInit,ve=de.factoryUIStartup,he=de.doFactoryUI
var pe=e("../glov/client/fscreen.js").fscreenEnter
var me=e("../glov/client/input.js")
var ge=e("./inventory_ui.js"),Ee=ge.doInventory,ye=ge.doContainer,Te=ge.inventoryUIInit,Ie=ge.inventoryUIStartup
var Se=e("./item_info_view.js").itemInfoViewClear
var Ae=e("./layout.js"),we=Ae.layoutCameraFull,Le=Ae.layoutCameraSquare,Re=Ae.layoutCameraTallWide,xe=Ae.layoutCameraCurX1,Oe=Ae.layoutCameraCurY1,be=Ae.layoutWide,Ne=Ae.menuUpperLeft,Ce=Ae.quickbarOnLeft,Me=Ae.quickbarOnTop,De=Ae.CORNER_BUTTON_MARGIN
var Pe=e("./localization/localization").L
var ke=e("../glov/client/localization.js").getStringFromLocalizable
var Be=e("./main.js")
var Ue=Be.charControllerPos
var Ge=e("./main_menu.js"),Fe=Ge.menuExitClearParams,We=Ge.setPageFromId,je=Ge.showCurrentGems
var He=Math.max,ze=Math.min
var Ve=e("./orient.js")
var Ye=e("./photo_mode.js").photoModeActive
var qe=e("./photo_ui.js"),Ke=qe.photoViewGetTitle,Ze=qe.photoViewInit,Xe=qe.doPhotoView,Qe=qe.photoIdValid
var Je=e("./prop_edit.js").doPropEdit
var $e=e("./race_results.js").doRaceResults
var et=e("./race_ui"),tt=et.getRacePanelWidth,rt=et.isRacePanelActive
var at=e("../glov/client/settings.js")
var it=e("./settings_menu.js"),ot=it.doSettings,nt=it.settingsMenuClear,st=it.settingsMenuInit
var lt=e("./social_menu.js"),ct=lt.doSocialMenu,_t=lt.socialMenuInit
var ut=e("./styles.js"),dt=ut.inventory_style,ft=ut.menu_header_style
var vt=e("./character_customization.js"),ht=vt.doCharacterCustomization,pt=vt.characterCustomizationMenuStartup,mt=vt.characterCustomizationMenuInit
var gt=G.provideUserString
var Et=e("./ui_util.js")
var yt=e("../glov/client/urlhash.js")
var Tt=e("./user_data.js").worldReadOnly
var It=e("./waygate_ui.js"),St=It.doEnergyWell,At=It.doWaygateEdit,wt=It.doWaygateTargets,Lt=It.waygateEditTitle,Rt=It.waygateUIInit,xt=It.waygateUIStartup
var Ot=e("./world_info_view.js"),bt=Ot.doWorldInfoView,Nt=Ot.worldInfoViewInit
var Ct=e("./world_metadata.js").adventureMode
var Mt=e("./voxel_data.js")
var Dt=e("./voxel_chunk_manager.js")
var Pt
var kt
var Bt
var Ut=u(H[0],H[1],H[2],.25)
var Gt
m.page=Gt
var Ft
m.page_open_frame=Ft
var Wt
var jt
var Ht
function setFadePanel(e){Ht=e}at.register({split_container:{label:"Split Container UI from main menu",default_value:1,type:_e.TYPE_INT,range:[0,1]},split_factory:{label:"Split Factory UI from main menu",default_value:1,type:_e.TYPE_INT,range:[0,1]},split_waygate:{label:"Split Waygate & Settlement UI from main menu",default_value:1,type:_e.TYPE_INT,range:[0,1]},split_build:{label:"Split Build UI from main menu",default_value:0,type:_e.TYPE_INT,range:[0,1]},quickbar_force_show:{label:"Force show quickbar even if hidden by split_build",default_value:0,type:_e.TYPE_INT,range:[0,1]},quickslot_menu:{label:"Use Quick-Slot Menu",usage:"$HELP\n  Usage: /quickslot_menu Value\n  Value = -1 is Auto - Q will open the Quick-Slot menu only in Unlimited worlds\n  Value = 0 means Q will never open the Quick-Slot menu\n  Value = 1 means Q will always open the Quick-Slot menu",type:_e.TYPE_INT,default_value:-1,range:[-1,1]}})
function shift(e){if(jt)c(jt,e)
q(e)}function getMenuPage(){return Gt}function getMenuLastPage(){return Wt}function isBuildMenu(){return Gt===E||Gt===x}function menuActive(){return Boolean(Gt)&&!Ye()}m.active=menuActive
function doQuickSlotMenu(){return 1===at.quickslot_menu||-1===at.quickslot_menu&&le()}function clear(){if(Gt)Wt=Gt
m.page=Gt=a}function isQuickMenu(){return Gt>=x||Gt===y&&at.split_container||Gt===A&&at.split_waygate||Gt===I&&at.split_waygate||Gt===S&&at.split_waygate||Gt===T&&at.split_factory||Gt===E&&at.split_build}function menuHidesQuickbar(){return menuActive()&&(Tt()||isQuickMenu()&&Gt!==E||at.split_build&&Gt!==E&&!at.quickbar_force_show)}function menuWantsQuickbarScroll(){return!menuActive()||isBuildMenu()||Gt===g}function init(e,t){if(me.pointerLocked())me.pointerLockExit()
if(Gt&&e!==Gt)Fe()
ie()
Nt()
_t()
Te()
st()
m.page_open_frame=Ft=ue.frame_index
if(void 0!==e)m.page=Gt=e
else if(Wt===E||Wt===g||Wt===L||Wt===w||Wt===R)m.page=Gt=Wt
else m.page=Gt=r
if(Gt===r)m.page=Gt=le()&&!at.split_build?E:g
if(Tt()&&(Gt===E||Gt===y||Gt===T||Gt===I||Gt===A||Gt===S))m.page=Gt=L
if(t===i);else if((Gt===y||Gt===O||Gt===I||Gt===C||Gt===S||Gt===M||Gt===P||Gt===T||Gt===A||Gt===k)&&t)jt=t.slice(0)
else jt=null
if(Gt===O)K()
else if(Gt===b)X(t)
else if(Gt===N)Nt(t)
else if(Gt===D)Ze(t)
else if(Gt===g);else if(Gt===y);else if(Gt===I||Gt===C||Gt===A||Gt===S)Rt(Gt===S)
else if(Gt===k);else if(Gt===T)fe()
else if(Gt===B)mt()
Wt=Gt}function logEventDeviceInfo(){var e={}
e.aa=at.aa
e.rs=at.render_scale
e.vwd=Dt.view_dist
e.bev=Mt.bevel_value
e.fov=at.fov
e.vendor_unmasked="unavailable"
e.renderer_unmasked="unavailable"
var t=gl.getExtension("WEBGL_debug_renderer_info")
if(t){e.vendor_unmasked=gl.getParameter(t.UNMASKED_VENDOR_WEBGL)
e.renderer_unmasked=gl.getParameter(t.UNMASKED_RENDERER_WEBGL)}e.screen_width=window.screen.width
e.screen_height=window.screen.height
e.client_width=ue.canvas.clientWidth
e.client_height=ue.canvas.clientHeight
e.is_discrete_gpu=re
h("device_info",1,null,null,e)}function startup(){G.loadUISprite("tab",[40,48,40],[256])
G.loadUISprite("tab_horiz",[40,48,40],[256])
G.sprites.tab_regular=G.sprites.tab
G.sprites.tab_inactive=G.sprites.button
G.sprites.tab_down=G.sprites.button_down
G.sprites.tab_inactive_down=G.sprites.button_down
G.loadUISprite("inv_down",[40,48,40],[256])
G.loadUISprite("inv_selected",[40,48,40],[256])
G.sprites.inv_selected_down=G.sprites.inv_down
G.loadUISprite("inv_active",[40,48,40],[256])
G.sprites.inv_active_down=G.sprites.inv_down
G.loadUISprite("inv_highlight",[40,48,40],[256])
G.sprites.inv_highlight_down=G.sprites.inv_down
G.loadUISprite("inv_empty",[40,48,40],[256])
G.sprites.inv_empty_down=G.sprites.inv_down
G.loadUISprite("inv_info",[40,48,40],[256])
G.loadUISprite("hint_panel",[40,48,40],[40,176,40])
G.loadUISprite("inv_disabled",[40,48,40],[256])
G.loadUISprite("section_border",[32,64,32],[32,192,32])
Pt=Et.sprite
kt=G.font
Bt=G.title_font
ve()
oe()
xt()
Ie()
logEventDeviceInfo()
pt()}function menuX1(){return xe()}function menuY1(){return Oe()}function menuInteractGetPos(){return jt}var zt=l()
function menuInteractGetProp(e){var t=Z.UI
var r=menuX1()
var a=menuY1()
var i=e&&e.ignore_distance||false
var o=e&&e.no_text||false
if(!jt)return null
var n=Gt===A?Pe.LBL_ENERGY_WELL:Gt===I?Pe.LBL_WAYGATE:Pe.LBL_CONTAINER
var s=Mt.getPropLocal(jt)
if(!s||!s.interactDetails()){if(!o)kt.drawSizedAligned(dt,0,0,t,2*G.font_height,kt.ALIGN.HVCENTERFIT,r,.75*a,Pe.$(Pe.ERR_PROP_MISSING,n))
return null}s.getLocalPos(zt)
if(_(Ue(),zt)>se.MAX_INTERACT_DIST_CHECK_SQ&&!i){if(!o)kt.drawSizedAligned(dt,0,0,t,2*G.font_height,kt.ALIGN.HVCENTERFIT,r,.75*a,Pe.$(Pe.ERR_PROP_FAR_AWAY,n))
return null}return s}function onTokenGen(e){gt(Pe.DLG_GENERATE_TOKENS_TITLE,e.join("\n"))}function fscreenEnterAndOrient(){pe()
Ve.set(Ve.LANDSCAPE)}function menuPanelX0(){var e=0
Ht=false
if(Gt===E||Gt===x||(Gt===I||Gt===S)&&Ct()){e+=G.button_height
if(Me())e-=20}return e}function prefixShortcutKey(e,t,r){var a=ke(t)
if(r||!me.touch_mode)return(a.startsWith(e)?Pe.FORMAT_INPUT_MERGE.$({key:e,command:a.substring(e.length)}):Pe.FORMAT_INPUT_PREPEND.$({key:e,command:a})).toLocalString()
return a}function setMenuPageLayout(e){switch(e){case O:case b:case D:case N:case C:case M:case P:case k:Le()
break
default:Re()}}var Vt=s()
var Yt=s()
function tickMenu(){profilerStart("tickMenu")
var i=Gt
if(!Ne()){var e=(be()?2:1)*(G.button_height+De)+De
if(rt()){var t=tt()+De
e=be()?e+t:t}F(Yt,ce.x1()-e,0)}else{var r=2*G.button_height+3*De+(rt()?tt()+De:0)
F(Yt,ce.x0()+r,0)}ce.virtualToCanvas(Vt,Yt)
setMenuPageLayout(i)
var o=0
var n=0
var s
if(Ne()||(Ce()||Me())&&at.quickbar_show_inhand&&!at.quickbar_show_recent||true){o+=G.button_height
if(Ne()){ce.canvasToVirtual(Yt,Vt)
o=He(o,Yt[0])}}function tabButton(e,t,r,a){if(isQuickMenu())return
s=i===e
if(G.buttonImage({x:o,y:n,z:s?Z.UI:Z.UI-10,z_bias:s?null:{down:20},shrink:.7,img:Pt,frame:t,colors:s?W:j,disabled:false,base_name:s?"tab":"tab_inactive",tooltip:r,tooltip_width:500,tooltip_above:true,drag_over:true,key:"menu_tab_button_"+e,hook:a})){m.page_open_frame=Ft=ue.frame_index
Wt=m.page=Gt=e
Se()
nt()}o+=G.button_height}tabButton(g,Et.INVENTORY,prefixShortcutKey("I",Tt()?Pe.LBL_CHARACTER:Pe.LBL_INVENTORY_CHARACTER))
if(!Tt()){if(!at.split_build)tabButton(E,Et.BUILD,prefixShortcutKey("B",Pe.LBL_BUILD_BLUEPRINT),"new_build_settlement")
var a=menuInteractGetProp({no_text:true})
if(a){var l
if(a.isWaygate()&&(l=Lt())){if(!at.split_waygate)tabButton(I,Et.WAYGATE,l)}else if(a.isEnergyWell()){if(!at.split_waygate)tabButton(A,Et.ENERGY_WELL,Pe.LBL_ENERGY_WELL)}else if(a.isFactory()){if(!at.split_factory)tabButton(T,Et.CRAFTING,a.inv.getName())}else if(a.isContainer()){if(!at.split_container)tabButton(y,Et.CONTAINER,Pe.LBL_CONTAINER)}else o+=G.button_height}else o+=G.button_height}o+=.5*G.button_height
tabButton(L,Et.WORLD_INFO,prefixShortcutKey("O",Pe.LBL_WORLD_INFO))
tabButton(w,Et.SOCIAL,prefixShortcutKey("P",Pe.LBL_FRIENDS))
tabButton(R,Et.SETTINGS,Pe.LBL_SETTINGS)
if(!isQuickMenu()){var c=menuX1()
if(!Ne()){ce.canvasToVirtual(Yt,Vt)
c=ze(c,Yt[0])}je(c,n+(G.button_height-64)/2-8,Z.UI,kt.ALIGN.HRIGHT,64)}var _=n+=G.button_height
var u=menuPanelX0()
Ht=false
var d
switch(i){case g:Ee(n)
break
case x:d=Pe.LBL_QUICKSLOT
if(me.keyDownEdge(me.KEYS.Q,{in_event_cb:me.pointerLockEnter}))Be.menuExitGeneric()
case E:ne()
d=d||Pe.LBL_BUILD_MENU
break
case y:d=ye(n)
break
case T:d=he()
break
case w:ct()
break
case R:ot(n)
break
case O:Q()
d=Y()
break
case b:J()
break
case D:Xe()
break
case L:case N:bt(i===L)
break
case I:d=At(u)
break
case S:d=At(u,true)
break
case C:d=wt()
break
case A:d=St(u)
break
case M:d=Je()
break
case P:d=$e()
break
case k:d=z()
break
case B:ht()}var f={x:u-U,y:_-U,w:menuX1()-u+2*U,h:menuY1()-_+2*U,color:Ht?Ut:H}
if(d&&isQuickMenu()){var v=G.button_height
var h={x:f.x+v,y:f.y-G.button_height+16,z:Z.UI-5,w:f.w-2*v,h:G.button_height}
Bt.drawSizedAligned(ft,h.x+8,h.y,h.z+2,2*G.font_height,kt.ALIGN.HVCENTERFIT,h.w-16,h.h,d)
G.drawHBox(h,G.sprites.tab,H)}var p=false
if(!me.touch_mode)if(me.click({x:f.x,y:f.y,w:f.w,h:f.h,in_event_cb:Be.omp?me.pointerLockEnter:void 0,button:2}))p=true
G.panel(f)
we()
profilerStop("tickMenu")
return p}function exitSpecificMenu(e){if(Gt===e){Be.menuExitGeneric()
m.page=Gt=void 0}}yt.register({key:"blueprint",hides:{w:1,pos:1},push:true,title:function title(e){p(e)
if(!te(e))return Pe.ERR_INVALID_BP_ID
var t=ee(e)
if(t.loaded||t.name)return Pe.$(Pe.PAGETITLE_BLUEPRINT,t.name)
return Y()||Pe.$(Pe.PAGETITLE_BLUEPRINT,e)},change:function change(e){if(yt.get("blueprint"))Be.toggleMenuPage(b,e)
else exitSpecificMenu(b)}})
yt.route("blueprint/:blueprint")
yt.register({key:"photo",hides:{w:1,pos:1},push:true,title:function title(e){p(e)
if(!Qe(e))return Pe.ERR_INVALID_PHOTO_ID
return Ke()},change:function change(e){if(yt.get("photo"))Be.toggleMenuPage(D,e)
else exitSpecificMenu(D)}})
yt.route("photo/:photo")
yt.register({key:"page",hides:{w:1,pos:1},push:true,change:function change(){We(yt.get("page"))}})
yt.route("page/:page")
yt.register({key:"type",push:false,hide_values:{default:1,undefined:1}})},{"../glov/client/browser.js":239,"../glov/client/camera2d.js":241,"../glov/client/cmds.js":244,"../glov/client/engine.js":250,"../glov/client/fscreen.js":262,"../glov/client/input.js":271,"../glov/client/localization.js":275,"../glov/client/settings.js":291,"../glov/client/ui.js":306,"../glov/client/urlhash.js":307,"../glov/common/vmath.js":332,"./access_control.js":2,"./analytics.js":5,"./bluebox_ui.js":23,"./blueprint.js":24,"./build_menu.js":26,"./build_mode.js":27,"./character_customization.js":31,"./factory_ui.js":79,"./inventory_ui.js":95,"./item_info_view.js":97,"./layout.js":99,"./localization/localization":108,"./main.js":112,"./main_menu.js":113,"./orient.js":122,"./photo_mode.js":128,"./photo_ui.js":129,"./prop_edit.js":140,"./race_results.js":143,"./race_ui":144,"./settings_menu.js":147,"./social_menu.js":152,"./styles.js":160,"./ui_util.js":168,"./user_data.js":170,"./voxel_chunk_manager.js":174,"./voxel_data.js":175,"./waygate_ui.js":179,"./world_info_view.js":184,"./world_metadata.js":186,assert:void 0}],118:[function(e,t,r){"use strict"
r.meshCalcReset=meshCalcReset
r.meshCalcBakeRules=meshCalcBakeRules
r.meshCalcMaxPropsPerChunk=meshCalcMaxPropsPerChunk
r.meshCalc=meshCalc
r.BYTES_PER_VERT=void 0
var va=e("assert")
var a=e("../common/globals.js"),i=a.CHUNK_SIZE,ha=a.ID_FACTOR,o=a.ID2
var n=e("./light_calc.js"),s=n.lightCalcReset,pa=n.lightCalc,l=n.lightCalcBakeRules,ma=n.sun_table,ga=n.torch_table
va(ma&&ga)
var f=Math.abs,c=Math.ceil,Ea=Math.max,ya=Math.min,g=Math.sqrt
var Ta=e("./tiles.js")
var _=e("../glov/common/vmath.js"),E=_.vec3,v=_.v3addScale,y=_.v3dot,Ia=_.v3lerp,T=_.v3iNormalize,h=_.v3scale,Sa=_.v3set,Aa=_.v4copy,wa=_.v4set
var La=Ta.TILE_INTANGIBLE,Ra=Ta.TILE_PROP_BASE,xa=Ta.TILE_PROP_MAX,Oa=Ta.TILE_TINT_ORE
var ba
var Na
var Ca=1+ha+o
var Ma=16
var Da=4*(r.BYTES_PER_VERT=Ma)
var Pa
function meshCalcReset(e,t){s(Pa=e,t)}var ka={}
function meshCalcBakeRules(e){va(e.metal_tints)
Ta.setMetalTints(e.metal_tints)
for(var t in e)ka[t]=e[t]
l(ka)}var Ba
function meshCalcMaxPropsPerChunk(e){Ba=e}var Ua=null
var Ga=0
var u=0
function geomBufAddQuad(e){var t=Ga+e*Da
if(t>u){var r=Ea(t,c(1.5*u),1024)
var a=new Uint8Array(r)
for(var i=0;i<Ga;++i)a[i]=Ua[i]
Ua=a
u=r}return Ua}var Fa=null
var Wa=0
var d=0
function geomBufAlphaAddQuad(e){var t=Wa+e*Da
if(t>d){var r=Ea(t,c(1.5*d),1024)
var a=new Uint8Array(r)
for(var i=0;i<Wa;++i)a[i]=Fa[i]
Fa=a
d=r}return Fa}var I=Int8Array
var S=[new I([0,0,1]),new I([0,0,-1]),new I([0,1,0]),new I([0,-1,0]),new I([1,0,0]),new I([-1,0,0])]
var ja=new I([1,-1,1,-1,1,-1])
var Ha=[new I([2,0,1]),new I([2,0,1]),new I([1,0,2]),new I([1,0,2]),new I([0,1,2]),new I([0,1,2])]
var za=new I([0,1,1,0,0,0,1,8,1,0,1,16,1,1,1,24,1,1,0,1,1,0,0,9,0,0,0,17,0,1,0,25,1,1,1,2,1,1,0,10,0,1,0,18,0,1,1,26,0,0,1,3,0,0,0,11,1,0,0,19,1,0,1,27,1,0,1,4,1,0,0,12,1,1,0,20,1,1,1,28,0,1,1,5,0,1,0,13,0,0,0,21,0,0,1,29])
var Va=new I([0,1,1,0,0,1,1,0,1,1,1,1,1,1,0,1,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,0,0,1,1,0,0,1,0,0,0,1,0,0,1,0,1,1,0,1,1,0,0,1,1,0,1,1,1,0,1,1,0,1,0,0,0,0,0,0,1])
var Ya=function(){var e=function(){var e=0
var t=[]
for(var r=0;r<6;++r){var a=new I(3)
a[0]=za[e+4]-za[e++]
a[1]=za[e+4]-za[e++]
a[2]=za[e+4]-za[e++]
e++
var i=new I(3)
i[0]=za[e+4]-za[e++]
i[1]=za[e+4]-za[e++]
i[2]=za[e+4]-za[e++]
e+=9
t.push([a,i])}return t}()
var t=new I([-1,-1,1,-1,1,1,-1,1])
var r=new I(3)
function deltaToIdx(e){va(e[0]>=-1&&e[0]<=1)
va(e[1]>=-1&&e[1]<=1)
va(e[2]>=-1&&e[2]<=1)
return e[0]+1+3*(e[1]+1)+9*(e[2]+1)}function deltaToFace(e){va(f(e[0])+f(e[1])+f(e[2])===1)
if(e[2])return e[2]>0?0:1
if(e[1])return e[1]>0?2:3
return e[0]>0?4:5}var a=new I(216)
var i=0
for(var o=0;o<6;++o){var n=S[o]
var s=e[o]
var l=s[0]
var c=s[1]
for(var _=0;_<4;++_){var u=t[2*_]
var d=t[2*_+1]
a[i++]=deltaToFace(h(r,l,u))
a[i++]=deltaToFace(h(r,c,d))
a[i++]=deltaToIdx(n)
a[i++]=deltaToIdx(v(r,n,l,u))
a[i++]=deltaToIdx(v(r,n,c,d))
a[i++]=deltaToIdx(v(r,v(r,n,c,d),l,u))
a[i++]=deltaToIdx(h(r,l,u))
a[i++]=deltaToIdx(h(r,c,d))
a[i++]=deltaToIdx(v(r,h(r,c,d),l,u))}}va.equal(i,a.length)
return a}()
var qa=[145,50,100,200]
var Ka=[19,137,76,38]
var Za=new I([12,16,14,10,14,16,12,10,14,22,12,4,12,22,14,4,10,22,16,4,16,22,10,4])
var Xa=new I([21,25,23,19,5,7,3,1,17,25,15,7,9,19,11,1,11,23,17,5,15,21,9,3])
var Qa=new I([15,17,11,9,17,15,9,11,23,21,3,5,21,23,5,3,19,25,7,1,25,19,1,7])
var Ja=new I([24,26,20,18,8,6,0,2,26,24,6,8,18,20,2,0,20,26,8,2,24,18,0,6])
var $a=[new I([-1,-1,-1]),new I([0,-1,-1]),new I([1,-1,-1]),new I([-1,0,-1]),new I([0,0,-1]),new I([1,0,-1]),new I([-1,1,-1]),new I([0,1,-1]),new I([1,1,-1]),new I([-1,-1,0]),new I([0,-1,0]),new I([1,-1,0]),new I([-1,0,0]),new I([0,0,0]),new I([1,0,0]),new I([-1,1,0]),new I([0,1,0]),new I([1,1,0]),new I([-1,-1,1]),new I([0,-1,1]),new I([1,-1,1]),new I([-1,0,1]),new I([0,0,1]),new I([1,0,1]),new I([-1,1,1]),new I([0,1,1]),new I([1,1,1])]
var A=[new I([-1,-1,-1]),new I([1,-1,-1]),new I([-1,1,-1]),new I([1,1,-1]),new I([-1,-1,1]),new I([1,-1,1]),new I([-1,1,1]),new I([1,1,1])]
var ei=[new I([-1,-1,-1]),new I([0,-1,-1]),new I([-1,0,-1]),new I([0,0,-1]),new I([-1,-1,0]),new I([0,-1,0]),new I([-1,0,0]),new I([0,0,0])]
var p=.25
var ti=[new Float32Array([0,0,p,.9]),new Float32Array([0,0,-p,.9]),new Float32Array([0,p,0,1]),new Float32Array([0,-p,0,1]),new Float32Array([p,0,0,.95]),new Float32Array([-p,0,0,.95])]
var ri=new I([4,7,5,6,0,3,1,2,2,7,3,6,0,5,1,4,1,7,3,5,0,6,2,4])
var ai=new I(3)
var ii=new I(3)
var oi=new Uint8Array(4)
var ni=new Uint8Array(4)
var si=new Uint8Array(4)
var li=new Uint8Array(4)
var ci=new Uint8Array(4)
var _i=new Uint8Array(4)
var ui=new Array(3)
var di=new Array(3)
var fi=new Array(3)
var vi=new Array(3)
var hi=new Array(3)
var pi=new Array(3)
var mi
var gi
var Ei
var yi
for(var m=0;m<=2;++m){ui[m]=new Array(3)
di[m]=new Array(3)
fi[m]=new Array(3)
vi[m]=new Array(3)
hi[m]=new Array(3)
pi[m]=new Array(3)
for(var w=0;w<=2;++w){ui[m][w]=new Array(3)
di[m][w]=new Array(3)
fi[m][w]=new Array(3)
vi[m][w]=new Array(3)
hi[m][w]=new Array(3)
pi[m][w]=new Array(3)}}function neighborGet(e){if(!(240&(e[0]|e[1]|e[2])))return gi[256*e[2]+16*e[1]+e[0]]
var t=e[0]
var r=e[1]
var a=e[2]
var i=ui[1]
if(a<0){i=ui[0]
a+=16}else if(a>=16){i=ui[2]
a-=16}var o=i[1]
if(r<0){o=i[0]
r+=16}else if(r>=16){o=i[2]
r-=16}var n=o[1]
if(t<0){n=o[0]
t+=16}else if(t>=16){n=o[2]
t-=16}if(!n)return 0
return n[256*a+16*r+t]}function neighborGetLiquidFirst(e){var t=e[0]
var r=e[1]
var a=e[2]
var i=256*a+16*r+t
if(!(240&(t|r|a)))return Ei[i]||(void 0===gi?0:gi&&gi[i])
var o=a<0?0:a<16?1:2
var n=r<0?0:r<16?1:2
var s=t<0?0:t<16?1:2
va((i-=4096*(o-1)+256*(n-1)+16*(s-1))>=0&&i<4096)
var l=ui[o][n][s]
var c=di[o][n][s]
if(void 0===l)return 0
return c&&c[i]||l&&l[i]}function neighborGetLight(e,t){if(!(240&(t[0]|t[1]|t[2])))return e.default?e.default[256*t[2]+16*t[1]+t[0]]:0
var r=t[0]
var a=t[1]
var i=t[2]
var o
if(i<0){o=0
i+=16}else if(i>=16){o=2
i-=16}else o=1
var n=e[o]
var s=pi[o]
o=1
if(a<0){o=0
a+=16}else if(a>=16){o=2
a-=16}else o=1
var l=n[o]
var c=s[o]
if(r<0){o=0
r+=16}else if(r>=16){o=2
r-=16}else o=1
var _=l[o]
if(!_)return 0
c[o]=1
return _[256*i+16*a+r]}var Ti=[0,0,0,0,257,0]
var Ii=[0,0,0,0,0,0]
var Si
function neighborGetUnchunked(e){var t
if(e[0]<0)t=t||Si[0]
if(e[0]>=mi.size[0])t=t||Si[1]
if(e[1]<0)t=t||Si[2]
if(e[1]>=mi.size[1])t=t||Si[3]
if(e[2]<0)t=t||Si[4]
if(e[2]>=mi.size[2])t=t||Si[5]
if(void 0!==t)return t
return mi.data[e[2]*mi.stride2+e[1]*mi.stride1+e[0]]}function neighborGetUnchunkedLiquidFirst(e){if(e[0]<0||e[0]>=mi.size[0]||e[1]<0||e[1]>=mi.size[1]||e[2]<0||e[2]>=mi.size[2])return 0
return mi.liquid[e[2]*mi.stride2+e[1]*mi.stride1+e[0]]||mi.data&&neighborGetUnchunked(e)||0}var Ai
var L=new I(3)
function neighborGetDelta(e){L[0]=ai[0]+e[0]
L[1]=ai[1]+e[1]
L[2]=ai[2]+e[2]
return Ai(L)}function neighborGetDeltaVisible(e){var t=neighborGetDelta(e)
return t&&t<Na}function neighborGetLightDelta(e,t){L[0]=ai[0]+t[0]
L[1]=ai[1]+t[1]
L[2]=ai[2]+t[2]
return neighborGetLight(e,L)}function neighborGetProp(e){if(!(240&(e[0]|e[1]|e[2])))return yi[256*e[2]+16*e[1]+e[0]]
var t=e[0]
var r=e[1]
var a=e[2]
var i=fi[1]
if(a<0){i=fi[0]
a+=16}else if(a>=16){i=fi[2]
a-=16}var o=i[1]
if(r<0){o=i[0]
r+=16}else if(r>=16){o=i[2]
r-=16}var n=o[1]
if(t<0){n=o[0]
t+=16}else if(t>=16){n=o[2]
t-=16}va(n)
return n[256*a+16*r+t]}var R=new I(3)
function neighborAndGetProp(e){var t=e-Ra
for(var r=t;r>=0;--r){R[2]=L[2]-r
for(var a=t-r;a>=0;--a){R[1]=L[1]-a
var i=t-r-a
R[0]=L[0]-i
var o=neighborGetProp(R)
if(o&&o.size[0]>i&&o.size[1]>a&&o.size[2]>r)return o}}return null}var wi=function(){var e=[[0,0,1],[0,1,0],[1,0,0]]
var n=[]
var t=new I(3)
for(var r=0;r<A.length;++r){var a=A[r]
var i=n[r]=[]
for(var o=0;o<S.length;++o){var s=S[o]
var l=[]
L[0]=a[0]>0?0:-1
L[1]=a[1]>0?0:-1
L[2]=a[2]>0?0:-1
l.push(L.slice(0))
for(var c=0;c<e.length;++c){var _=e[c]
t[0]=L[0]+a[0]*_[0]
t[1]=L[1]+a[1]*_[1]
t[2]=L[2]+a[2]*_[2]
var u=t.slice(0)
u.wt=.5
if(s[0]&&_[0]||s[1]&&_[1]||s[2]&&_[2])u.wt=3
l.push(u)}l.sort(function(e,t){return e.wt-t.wt})
var d=new Array(3*l.length)
var f=0
d[f++]=l[0][0]
d[f++]=l[0][1]
d[f++]=l[0][2]
var v=l[0]
for(var h=1;h<l.length;++h){d[f++]=l[h][0]-v[0]
d[f++]=l[h][1]-v[1]
d[f++]=l[h][2]-v[2]
v=l[h]}i[o]=d}}return function getAOOctantSum2Fn(e,t,r){var a=n[t][r]
L[0]=e[0]+a[0]
L[1]=e[1]+a[1]
L[2]=e[2]+a[2]
var i=0
var o=Ai(L)
if(o){if(o<ba)return 1
i+=.2}L[0]+=a[3]
L[1]+=a[4]
L[2]+=a[5]
if(o=Ai(L))i+=o>=ba?.05:.1
L[0]+=a[6]
L[1]+=a[7]
L[2]+=a[8]
if(o=Ai(L))i+=o>=ba?.05:.1
L[0]+=a[9]
L[1]+=a[10]
L[2]+=a[11]
if(o=Ai(L))i+=o>=ba?.3:.6
return i}}()
var Li=function(){var h=[]
function init(c){var _=new Int32Array(3)
var u=new Int32Array(3)
var d=E()
var f=E()
var v=E()
function calcRay(e,t,r){Sa(v,e,t,r)
T(v)
var a=[]
a.dir=v.slice(0)
var i=c
Sa(_,0,0,0)
for(var o=0;o<3;++o)if(!v[o]){u[o]=0
d[o]=i+1}else if(v[o]<0){u[o]=-1
d[o]=_[o]/v[o]
f[o]=-1/v[o]}else{d[o]=(_[o]+1)/v[o]
u[o]=1
f[o]=1/v[o]}var n=0
do{var s=d[0]<d[1]?0:1
if(d[2]<d[s])s=2
if(d[s]>i)break
n=d[s]
_[s]+=u[s]
d[s]+=f[s]
var l=1-n/i
a.push([_[0],_[1],_[2],1-(1-l)*(1-l)])}while(true)
return a}function pointsOnSphere(e){var t=[]
var r=Math.PI*(3-g(5))
var a=2/e
for(var i=0;i<e;++i){var o=i*a-1+a/2
var n=g(1-o*o)
var s=i*r
t.push(E(Math.cos(s)*n,o,Math.sin(s)*n))}return t}h=pointsOnSphere(80).filter(function(e){return e[0]>=0&&e[1]>=0&&e[2]>=0}).map(function(e){return calcRay(e[0],e[1],e[2])})}init(3)
function findChild(e,t){for(var r=0;r<e.children.length;++r){var a=e.children[r].pos
if(a[0]===t[0]&&a[1]===t[1]&&a[2]===t[2])return e.children[r]}var i={pos:new I(t),value:0,children:[]}
e.children.push(i)
return i}var v=new I(3)
var p=new I(3)
function buildTree(e,t){var r=S[t]
var a=A[e]
p[0]=a[0]>0?0:-1
p[1]=a[1]>0?0:-1
p[2]=a[2]>0?0:-1
var i=0
for(var o=0;o<h.length;++o){var n=h[o]
i+=Math.abs(y(n.dir,r))}var s={pos:new I(p),value:0,children:[]}
for(var l=0;l<h.length;++l){var c=h[l]
var _=1/(c.length+1)*Math.abs(y(c.dir,r))/i
var u=s
u.value+=_
for(var d=0;d<c.length;++d){var f=c[d]
v[0]=p[0]+a[0]*f[0]
v[1]=p[1]+a[1]*f[1]
v[2]=p[2]+a[2]*f[2];(u=findChild(u,v)).value+=_}}return s}var a=[]
for(var e=0;e<S.length;++e){a[e]=[]
for(var t=0;t<A.length;++t)a[e][t]=buildTree(t,e)}var i
function traverse(e,t){v[0]=t[0]+e.pos[0]
v[1]=t[1]+e.pos[1]
v[2]=t[2]+e.pos[2]
var r=Ai(v)
if(r){if(r<ba)return}else i+=e.value
for(var a=0;a<e.children.length;++a)traverse(e.children[a],t)}return function getAOOctantRayCast3Fn(e,t,r){i=0
traverse(a[r][t],e)
return 1-i}}()
var Ri=function(){var p=[]
var e=0
function init(c){if(c===e)return
e=c
var _=new Int32Array(3)
var u=new Int32Array(3)
var d=E()
var f=E()
var v=E()
function calcRay(e,t,r){Sa(v,e,t,r)
T(v)
var a=[]
a.dir=v.slice(0)
var i=c
Sa(_,0,0,0)
for(var o=0;o<3;++o)if(!v[o]){u[o]=0
d[o]=i+1}else if(v[o]<0){u[o]=-1
d[o]=_[o]/v[o]
f[o]=-1/v[o]}else{d[o]=(_[o]+1)/v[o]
u[o]=1
f[o]=1/v[o]}var n=0
do{var s=d[0]<d[1]?0:1
if(d[2]<d[s])s=2
if(d[s]>i)break
n=d[s]
_[s]+=u[s]
d[s]+=f[s]
var l=1-n/i
a.push([_[0],_[1],_[2],1-(1-l)*(1-l)])}while(true)
return a}function pointsOnSphere(e){var t=[]
var r=Math.PI*(3-g(5))
var a=2/e
for(var i=0;i<e;++i){var o=i*a-1+a/2
var n=g(1-o*o)
var s=i*r
t.push(E(Math.cos(s)*n,o,Math.sin(s)*n))}return t}p=pointsOnSphere(80).filter(function(e){return e[0]>=0&&e[1]>=0&&e[2]>=0}).map(function(e){return calcRay(e[0],e[1],e[2])})}var m=new I(3)
return function getAOOctantRayCastFn(e,t,r,a){init(Ea(e,3))
var i=S[a]
var o=A[r]
L[0]=t[0]+(o[0]>0?0:-1)
L[1]=t[1]+(o[1]>0?0:-1)
L[2]=t[2]+(o[2]>0?0:-1)
var n=Ai(L)
var s=1
if(n){if(n<ba)return 1
s=0}var l=0
var c=0
for(var _=0;_<p.length;++_){var u=p[_]
var d=Math.abs(y(u.dir,i))
c+=d
var f=s
for(var v=0;v<u.length;++v){var h=u[v]
m[0]=L[0]+o[0]*h[0]
m[1]=L[1]+o[1]*h[1]
m[2]=L[2]+o[2]*h[2]
if(n=Ai(m)){if(n<ba)break}else++f}if(0){if(f===u.length)l+=d}else l+=f/(u.length+1)*d}return 1-l/c}}()
var xi=[[[0,0,1,0],[0,0,0,1],[0,1,2,3,4,5],[0,1,2,3]],[[0,1,0,-1],[0,0,1,0],[0,1,5,4,2,3],[1,2,3,0]],[[1,0,-1,0],[0,1,0,-1],[0,1,3,2,5,4],[2,3,0,1]],[[0,0,0,1],[1,0,-1,0],[0,1,4,5,3,2],[3,0,1,2]]]
for(var x=0;x<xi.length;++x){var O=xi[x][3]
for(var b=0;b<4;++b)O[b<<3]=O[b]<<3}var Oi=new I(3)
var bi=7
var Ni=new Uint32Array(i*i*8*bi)
var Ci=new Uint8Array(Ni.buffer)
var Mi=E()
var Di=E()
var Pi=new I(3)
var ki=new Uint8Array(i*i*i)
var Bi=new Uint8Array(i*i*i)
Bi.fill(255)
var Ui=new Array(8)
var Gi=[0,0,0,0,0,0,0]
var Fi=[0,0,0,0,0,0,0]
var Wi=[true,true,true,false,false,false,false]
var ji=new Array(7)
var Hi={}
function meshCalc(e,t,r){t.ver_meshing=e.ver_meshing
var a=(r=r||{}).ao||0
var i=r.lighting||0
var o=ga
var n=ma
var s=false
if(2===i){a=0
s=true}var l=r,c=l.not_world,_=l.skip_greedy_meshing,u=l.need_offs
if(!i){if(c)wa(si,255,255,255,255)
else wa(si,0,0,0,0)
wa(ni,255,255,255,255)
Aa(_i,si)
Aa(ci,ni)}if(!a){wa(oi,255,255,255,255)
Aa(li,oi)}var d=r.liquid
var f=d?Ta.tile_map_liquids:e.tile_map
var v=f.alpha_map||Hi
var h=f.doublesided_map||Hi
var p=f.tile_rate||Hi
var m=f.tint_map||Hi
var g=r.tint_colors||f.tint_colors||Hi
var E=[]
var y=[]
var T=f.tile_override||null
Na=f.tile_invisible
ba=f.tile_non_opaque
va(Na&&ba)
if(c){yi=(mi=e).baked_props||Hi
if(d)Ai=neighborGetUnchunkedLiquidFirst
else Ai=neighborGetUnchunked
if(r.over_tile)Si=r.over_tile
else if(r.ground)Si=Ti
else Si=Ii}else{gi=e.data
if(d){Ei=e.liquid
Ai=neighborGetLiquidFirst}else{yi=e.baked_props||Hi
Ai=neighborGet}var I=e.full
for(var S=0;S<=2;++S)for(var A=0;A<=2;++A)for(var w=0;w<=2;++w){var L=Pa[e.chunk_id+(S*ha+A)*ha+w-Ca]
if(L){I=I&&L.full
ui[S][A][w]=L.data
if(d)di[S][A][w]=L.liquid
else fi[S][A][w]=L.baked_props||Hi}else{ui[S][A][w]=void 0
if(d)di[S][A][w]=void 0
else fi[S][A][w]=Hi}}if(I)return
if(i){if(!r.did_lighting){r.did_lighting=true
pa(e)}vi.default=e.light_sun
hi.default=e.light_torch
for(var R=0;R<=2;++R)for(var x=0;x<=2;++x)for(var O=0;O<=2;++O){var b=Pa[e.chunk_id+(R*ha+x)*ha+O-Ca]
vi[R][x][O]=b&&b.light_sun
hi[R][x][O]=b&&b.light_torch
pi[R][x][O]=0}}}Wa=Ga=0
var N=e.size
var C=Ea(N[0]*N[1],Ea(N[1]*N[2],N[0]*N[2]))
va(Ni.length>=C*bi)
var M=Ci
var D=Ni
D.fill(0)
var P
var k=a<=2?wi:3===a?Li:Ri.bind(null,a)
var B=a?[]:null
var U=N[0]+1
var G=U*(N[1]+1)
var F=G*(N[2]+1)
var W=r.for_baking||r.noscale?1:7
var j=r.sway
var H=u?7:0
var z
function aoFromCache(e){var t=z+e*F
var r=B[t]
if(void 0!==r)return r
var a=4*e
var i=k(Pi,ri[a++],e)
var o=k(Pi,ri[a++],e)
var n=k(Pi,ri[a++],e)
var s=k(Pi,ri[a++],e)
var l=ya(i,o)
var c=ya(n,s)
i=Ea(i,c)
o=Ea(o,c)
var _=i+(n=Ea(n,l))+o+(s=Ea(s,l))
return B[t]=Ea(0,4-_)/4}var V
var Y=[]
if(!d)if(e.baked_props){var q=i?e.light_sun||ki:Bi
var K
var Z
var X
var Q
va(void 0!==Ba)
var J=Ba
for(var $ in e.baked_props){var ee=e.baked_props[$]
if(!ee.key)continue
$=Number($)
var te=ka[ee.key]
if(!te)va(te,'Missing baked ruleset for "'+ee.key+'" ('+Object.keys(ka).length+" found)")
var re=15&$
var ae=(240&$)>>4
var ie=$>>8
Sa(ai,re,ae,ie)
var oe=void 0
for(var ne=0;ne<te.rules.length;++ne){var se=true
if((oe=te.rules[ne]).same)for(var le=0;se&&le<oe.same.length;++le){var ce=neighborGetDelta(oe.same[le])
if(ce&&ce>=Ra&&ce<=xa){var _e=neighborAndGetProp(ce)
if(!_e||_e.key!==ee.key)se=false}else se=false}if(oe.tangible)for(var ue=0;se&&ue<oe.tangible.length;++ue){var de=neighborGetDelta(oe.tangible[ue])
if(!de)se=false
else if(de>=La)if(de>=Ra&&de<=xa){var fe=neighborAndGetProp(de)
if(!fe||!fe.tangible)se=false}else se=false}if(oe.intangible)for(var ve=0;se&&ve<oe.intangible.length;++ve){var he=neighborGetDelta(oe.intangible[ve])
if(he)if(he>=La){if(he>=Ra&&he<=xa){var pe=neighborAndGetProp(he)
if(pe&&pe.tangible)se=false}}else se=false}if(oe.empty)for(var me=0;se&&me<oe.empty.length;++me)if(neighborGetDelta(oe.empty[me]))se=false
if(oe.period)if(re%oe.period[0]^ae%oe.period[1]^ie%oe.period[2])se=false
if(se)break}if(!oe)continue
if(--J<0){var ge=ya(re+ee.size[0],N[0])
var Ee=ya(ae+ee.size[1],N[1])
var ye=ya(ie+ee.size[2],N[2])
for(var Te=ie;Te<ye;++Te)for(var Ie=ae;Ie<Ee;++Ie)for(var Se=re;Se<ge;++Se){var Ae=(Te*N[1]+Ie)*N[0]+Se
Y.push(Ae,e.data[Ae])
e.data[Ae]=ee.tangible?Ta.STONE:Ta.PASSABLE_LEAVES}continue}var we=n[q[$]]
var Le=oe.data.data
var Re=oe.data.bake_offset
var xe=oe.data.size
var Oe=ee.rot||oe.rot||0
var be=xi[Oe]
K=be[0]
Z=be[1]
X=be[2]
Q=be[3]
var Ne=7*(re+K[0]*xe[0]+K[1]*xe[1])
var Ce=7*(ae+Z[0]*xe[0]+Z[1]*xe[1])
var Me=7*ie
for(var De=0;De<8;++De){Sa(ai,re+(1&De?ee.size[0]:0),ae+(2&De?ee.size[1]:0),ie+(4&De?ee.size[2]:0))
var Pe=V=0
for(var ke=0;ke<8;++ke){var Be=ei[ke]
var Ue=neighborGetDelta(Be)
if(!Ue||Ue>=ba){V+=o[neighborGetLightDelta(hi,Be)]
Pe++}}if(!Pe)Pe=1
Ui[De]=V/Pe}if(Le){var Ge=Le.length/Da
var Fe=geomBufAddQuad(Ge)
var We=0
var je=Ga
for(var He=0;He<Ge;++He)for(var ze=0;ze<4;++ze){var Ve=Le[We++]+Re[0]
var Ye=Le[We++]+Re[1]
var qe=Le[We++]+Re[2]
var Ke=Ne+K[2]*Ve+K[3]*Ye
var Ze=Ce+Z[2]*Ve+Z[3]*Ye
Fe[je++]=Ke+H
Fe[je++]=Ze+H
Fe[je++]=Me+qe+H
var Xe=Le[We++]
var Qe=Le[We++]
var Je=X[7&Qe]
if(Je<2){var $e=240&Xe
Xe=15&(Xe<<4-Oe|(15&Xe)>>Oe)
Xe|=240&((240&$e)<<4-Oe|$e>>Oe)}Fe[je++]=Xe
Qe=-8&Qe|Je
if(Je<2)Qe=-25&Qe|Q[24&Qe]
Fe[je++]=Qe
Fe[je++]=Le[We++]
Fe[je++]=Le[We++]
var et=ti[Je]
var tt=(Ke-7*re)/(7*ee.size[0])
var rt=(Ze-7*ae)/(7*ee.size[1])
var at=qe/(7*ee.size[2])
var it=ya(1,Ea(0,et[0]+tt))
var ot=ya(1,Ea(0,et[1]+rt))
var nt=ya(1,Ea(0,et[2]+at))
var st=(1-ot)*((1-it)*Ui[0]+it*Ui[1])+ot*((1-it)*Ui[2]+it*Ui[3])
var lt=(1-ot)*((1-it)*Ui[4]+it*Ui[5])+ot*((1-it)*Ui[6]+it*Ui[7])
Fe[je++]=((1-nt)*st+nt*lt)*et[3]
We++
Fe[je++]=Le[We++]
Fe[je++]=Le[We++]
Fe[je++]=Le[We++]
Fe[je++]=we
We++
Fe[je++]=Le[We++]
Fe[je++]=we
We++
var ct=ya(1,Ea(0,tt))
var _t=ya(1,Ea(0,rt))
var ut=ya(1,Ea(0,at))
var dt=(1-_t)*((1-ct)*Ui[0]+ct*Ui[1])+_t*((1-ct)*Ui[2]+ct*Ui[3])
var ft=(1-_t)*((1-ct)*Ui[4]+ct*Ui[5])+_t*((1-ct)*Ui[6]+ct*Ui[7])
Fe[je++]=(1-ut)*dt+ut*ft
We++
Fe[je++]=Le[We++]}va.equal(We,Le.length)
Ga=je}va(!oe.data.alpha)}}var vt
var ht
var pt
var mt
var gt
for(var Et=0;Et<6;++Et){var yt=(P=Ha[Et])[0]
var Tt=P[1]
var It=P[2]
var St=N[P[0]]
var At=N[P[1]]
var wt=N[P[2]]
var Lt=ja[Et]
var Rt=Lt
var xt=Rt>0?0:St-1
var Ot=Rt>0?St:-1
Oi[yt]=1
for(ai[yt]=xt;ai[yt]!==Ot;ai[yt]+=Rt){var bt=-1
ii[yt]=ai[yt]+Lt
for(var Nt=0,Ct=0;Ct<At;++Ct){ii[Tt]=ai[Tt]=Ct
for(var Mt=0;Mt<wt;++Mt,Nt+=bi){ai[It]=Mt
var Dt=e.get(ai,d)
if(!Dt||Dt>=Na){D[Nt]=0
continue}ii[It]=Mt
var Pt=Ai(ii)
if(Pt)if(Pt>=ba);else{D[Nt]=0
continue}var kt=f[Dt]
va(kt)
if(Pt===Dt&&kt.no_self){D[Nt]=0
continue}var Bt=kt.def
if(kt.face)Bt=kt.face[Et]||Bt
bt=Nt/7
if(Et>=2){if(kt.above){ai[2]++
Pt=Ai(ai)
ai[2]--
if(kt.above[Pt])Bt=kt.above[Pt]}if(kt.below){ai[2]--
Pt=Ai(ai)
ai[2]++
if(kt.below[Pt])Bt=kt.below[Pt]}}var Ut=4*Nt
M[Ut++]=Bt
var Gt=4*Et
var Ft=0
for(var Wt=0;Wt<4;++Wt)if(!neighborGetDeltaVisible($a[Za[Gt+Wt]]))if(!neighborGetDeltaVisible($a[Xa[Gt+Wt]]))Ft|=qa[Wt]
var jt=240&Ft
Ft&=-241
for(var Ht=0;Ht<4;++Ht){var zt=16<<Ht
if(jt&zt)continue
if(!neighborGetDeltaVisible($a[Ja[Gt+Ht]]))if(!neighborGetDeltaVisible($a[Qa[Gt+Ht]]))Ft|=zt}M[Ut++]=Ft
if(a||i){var Vt=4*Et*3
for(var Yt=0;Yt<4;++Yt){if(a){Sa(Pi,ai[0]+Va[Vt++],ai[1]+Va[Vt++],ai[2]+Va[Vt++])
z=Pi[0]+Pi[1]*U+Pi[2]*G
vt=aoFromCache(Et)
M[Ut++]=255*vt}var qt=Ft&Ka[Yt]
var Kt=qt?7:i?4:0
var Zt=9*(4*Et+Yt)
var Xt=Ya[Zt++]
var Qt=Ya[Zt++]
for(var Jt=0;Jt<Kt;++Jt){if(Jt>=3)Wi[Jt]=false
var $t=$a[Ya[Zt++]]
var er=neighborGetDelta($t)
if(!er){Fi[Jt]=Gi[Jt]=1
ji[Jt]=$t}else if(er>=ba)if(er>=Ra){Fi[Jt]=Gi[Jt]=.5
ji[Jt]=$t}else if(er>=Na){Fi[Jt]=Gi[Jt]=1
ji[Jt]=$t}else{Fi[Jt]=0
Gi[Jt]=1
ji[Jt]=$t}else Fi[Jt]=Gi[Jt]=0}if(i){for(var tr=gt=V=mt=0;tr<4;++tr)if(3!==tr||gt>1){var rr=Gi[tr]
if(rr){var ar=ji[tr]
mt+=rr*n[neighborGetLightDelta(vi,ar)]
V+=rr*o[neighborGetLightDelta(hi,ar)]
gt++}}va(gt>=1)
if(s)gt=4
pt=V/gt
M[Ut++]=ht=mt/gt
M[Ut++]=pt}if(qt){var ir=Fi
if(ir[1]){Wi[3]=true
Wi[4]=true
if(ir[4])Wi[6]=true}if(ir[2]){Wi[3]=true
Wi[5]=true
if(ir[5])Wi[6]=true}if(Wi[3]){if(ir[3])Wi[6]=true
if(Wi[6]&&ir[6])Wi[4]=Wi[5]=true}if(a){var or=vt
var nr=1
if(ir[4]&&(ir[1]||ir[2]&&ir[5]&&ir[6])||!ir[5]&&ir[6]&&ir[2]&&ir[3]){or+=aoFromCache(Xt)
nr++}if(ir[5]&&(ir[2]||ir[1]&&ir[4]&&ir[6])||!ir[4]&&ir[6]&&ir[1]&&ir[3]){or+=aoFromCache(Qt)
nr++}if(ir[5]&&ir[2]&&ir[3]&&(!ir[6]&&ir[1]||!ir[1]&&ir[6])){or+=aoFromCache(1^Xt)
nr++}if(ir[4]&&ir[1]&&ir[3]&&(!ir[6]&&ir[2]||!ir[2]&&ir[6])){or+=aoFromCache(1^Qt)
nr++}M[Ut++]=Ea(0,ya(255,or/nr*255|0))}if(i){if(Wi[3])for(var sr=4;sr<7;++sr)if(Wi[sr]){var lr=Gi[sr]
if(lr){var cr=ji[sr]
mt+=lr*n[neighborGetLightDelta(vi,cr)]
V+=lr*o[neighborGetLightDelta(hi,cr)]
gt++}}M[Ut++]=mt/gt
M[Ut++]=V/gt}}else{if(a)M[Ut++]=255*vt
if(i){M[Ut++]=ht
M[Ut++]=pt}}}}}}for(var _r=0;_r<=bt;++_r){var ur=7*_r
var dr=D[ur]
if(!dr)continue
var fr=D[ur+1]
var vr=D[ur+2]
var hr=D[ur+3]
var pr=D[ur+4]
var mr=D[ur+5]
var gr=D[ur+6]
ai[Tt]=_r/wt
ai[It]=_r%wt
var Er=1
var yr=1
var Tr=wt
var Ir=wt-ai[It]
var Sr=At-ai[Tt]
for(var Ar=0;Ar<Sr;++Ar){var wr=_r+Ar*wt
var Lr=7*wr
var Rr=Lr+7*ya(Ir,Tr)
while(Lr<Rr&&D[Lr]===dr&&D[Lr+1]===fr&&D[Lr+2]===vr&&D[Lr+3]===hr&&D[Lr+4]===pr&&D[Lr+5]===mr&&D[Lr+6]===gr)Lr+=7
var xr=Lr/7-wr
if(!xr)break
if((Ar+1)*xr>Er*yr){Er=xr
yr=Ar+1}Tr=xr}if(_)Er=yr=1
for(var Or=0;Or<yr;++Or){var br=7*(_r+Or*wt)
for(var Nr=0;Nr<Er;++Nr,br+=7)if(Or||Nr)D[br]=0}Oi[Tt]=yr
Oi[It]=Er
var Cr=4*ur
var Mr=M[Cr++]
var Dr=M[Cr++]
if(a&&i)for(var Pr=0;Pr<4;++Pr){oi[Pr]=M[Cr++]
ni[Pr]=M[Cr++]
si[Pr]=M[Cr++]
li[Pr]=M[Cr++]
ci[Pr]=M[Cr++]
_i[Pr]=M[Cr++]}else if(a)for(var kr=0;kr<4;++kr){oi[kr]=M[Cr++]
li[kr]=M[Cr++]}else if(i)for(var Br=0;Br<4;++Br){ni[Br]=M[Cr++]
si[Br]=M[Cr++]
ci[Br]=M[Cr++]
_i[Br]=M[Cr++]}var Ur=T&&T[Mr]||Mr
var Gr=Boolean(v[Mr])
var Fr=Boolean(h[Mr])
var Wr=p[Mr]||0
var jr=m[Mr]||0
var Hr=g[Mr]||null
var zr=void 0
if(jr){va(!Hr)
if(jr===Oa){Hr=y[jr]
if(!y[jr])Hr=y[jr]=e.tintGenSingle(jr)}else if(!(zr=E[jr]))zr=E[jr]=e.tintGen(jr)}var Vr=4*Et*4
var Yr=void 0
var qr=void 0
if(Gr){qr=geomBufAlphaAddQuad(1)
Yr=Wa}else{qr=geomBufAddQuad(1)
Yr=Ga}var Kr=Yr
for(var Zr=0;Zr<4;++Zr){var Xr=ai[0]+za[Vr++]*Oi[0]
var Qr=ai[1]+za[Vr++]*Oi[1]
var Jr=ai[2]+za[Vr++]*Oi[2]
qr[Kr++]=Xr*W+H
qr[Kr++]=Qr*W+H
qr[Kr++]=Jr*W+H
qr[Kr++]=Dr
qr[Kr++]=za[Vr++]|Wr
qr[Kr++]=Ur
qr[Kr++]=oi[Zr]
qr[Kr++]=si[Zr]
if(Hr){qr[Kr++]=255*Hr[0]
qr[Kr++]=255*Hr[1]
qr[Kr++]=255*Hr[2]}else if(jr){var $r=.0625*Xr
var ea=.0625*Qr
Ia(Mi,$r,zr[0],zr[1])
Ia(Di,$r,zr[3],zr[2])
Ia(Di,ea,Mi,Di)
qr[Kr++]=255*Di[0]
qr[Kr++]=255*Di[1]
qr[Kr++]=255*Di[2]}else{qr[Kr++]=255
qr[Kr++]=255
qr[Kr++]=255}qr[Kr++]=ni[Zr]
qr[Kr++]=li[Zr]
qr[Kr++]=ci[Zr]
qr[Kr++]=_i[Zr]
if(j){var ta=7*j
var ra=255/(ta*ta)
qr[Kr++]=Jr*Jr*ra}else qr[Kr++]=0}if(Gr)Wa=Kr
else Ga=Kr
if(a||i)if(oi[0]*Ea(si[0],ni[0])+oi[2]*Ea(si[2],ni[2])>oi[1]*Ea(si[1],ni[1])+oi[3]*Ea(si[3],ni[3]))for(var aa=0;aa<Ma;++aa){var ia=qr[Yr+aa]
qr[Yr+aa]=qr[Yr+aa+Ma]
qr[Yr+aa+Ma]=qr[Yr+aa+2*Ma]
qr[Yr+aa+2*Ma]=qr[Yr+aa+3*Ma]
qr[Yr+aa+3*Ma]=ia}if(Fr){if(Gr){qr=geomBufAlphaAddQuad(1)
Wa+=Da}else{qr=geomBufAddQuad(1)
Ga+=Da}var oa=Yr+Da
for(var na=0;na<Ma;++na){qr[oa+na]=qr[Yr+na+3*Ma]
qr[oa+na+Ma]=qr[Yr+na+2*Ma]
qr[oa+na+2*Ma]=qr[Yr+na+Ma]
qr[oa+na+3*Ma]=qr[Yr+na]}}}}}if(d){if(Ga)t.liquid=Ua.slice(0,Ga)
va(!Wa)}else{if(Ga)t.data=Ua.slice(0,Ga)
if(Wa)t.alpha=Fa.slice(0,Wa)}if(i&&r.used_lighting)for(var sa=0;sa<=2;++sa)for(var la=0;la<=2;++la)for(var ca=0;ca<=2;++ca)if(pi[sa][la][ca]){var _a=e.chunk_id+(sa*ha+la)*ha+ca-Ca
r.used_lighting[_a]=1}for(var ua=0;ua<Y.length;){var da=Y[ua++]
var fa=Y[ua++]
e.data[da]=fa}}},{"../common/globals.js":197,"../glov/common/vmath.js":332,"./light_calc.js":100,"./tiles.js":162,assert:void 0}],119:[function(e,t,r){"use strict"
r.meshExport=meshExport
var b=e("file-saver")
var N=e("../glov/common/util.js").fract
var C=e("../glov/common/vmath.js").v3set
var M=Float32Array
var D=Int16Array
var P=[new D([0,0,1]),new D([0,0,-1]),new D([0,1,0]),new D([0,-1,0]),new D([1,0,0]),new D([-1,0,0])]
function meshExport(e,t,r,a){var i=[]
i.push("#Worlds-FRVR")
for(var o=0;o<e.length;o+=12)i.push("v "+e[0+o]+" "+e[2+o]+" "+e[1+o])
for(var n=0;n<P.length;n++){var s=P[n]
i.push("vn "+s[0]+" "+s[2]+" "+s[1])}var l=new Uint8Array(e.length/12)
var c=0
var _=0
var u=0
var d=0
var f=0
var v=0
for(var h=0;h<e.length;h+=12){var p=e[h+4]*(1/8)
var m=8*N(p)
l[h/12]=m
var g=.25*Math.floor(p)
var E=.25*Math.floor(g)
var y=1-N(E)
var T=new D(3)
C(T,e[0+h],e[2+h],e[1+h])
T[0]*=1/7
T[1]*=1/7
T[2]*=1/7
var I=1
var S=1
if(h/12%4===0){c=T[0]
_=T[1]
u=T[2]
for(var A=0;A<48;A+=12){c=Math.max(c,e[0+A+h]*(1/7))
_=Math.max(_,e[2+A+h]*(1/7))
u=Math.max(u,e[1+A+h]*(1/7))}d=c%(1/y)
f=_%(1/y)
v=u%(1/y)}if(0===m||1===m){if(T[0]===c)I=0
if(T[2]===u)S=0
I+=d
S+=v}if(2===m||3===m){if(T[0]===c)I=0
if(T[1]===_)S=0
I+=f
S+=v}if(4===m||5===m){if(T[1]===_)S=0
if(T[2]===u)I=0
S+=f
I+=v}var w=e[h+5]*t[0]
var L=new M(2)
L[0]=N(w)*t[1]+t[3]
L[1]=Math.floor(w)*t[2]+t[3]
I=I*y*r[0]+L[0]
S=S*y*r[1]+L[1]
i.push("vt "+I+" "+(1-S))}for(var R=0;R<e.length;R+=12)i.push("vp "+e[8+R]+" "+e[9+R]+" "+e[10+R])
for(var x=0;x<e.length/12;x+=4){i.push("f "+(1+x)+"/"+(1+x)+"/"+(1+l[0+x])+" "+(3+x)+"/"+(3+x)+"/"+(1+l[1+x])+" "+(2+x)+"/"+(2+x)+"/"+(1+l[2+x]))
i.push("f "+(3+x)+"/"+(3+x)+"/"+(1+l[2+x])+" "+(1+x)+"/"+(1+x)+"/"+(1+l[3+x])+" "+(4+x)+"/"+(4+x)+"/"+(1+l[0+x]))}var O=new Blob([i.join("\n")],{type:"obj"})
b.saveAs(O,a.concat(".obj"),false)}},{"../glov/common/util.js":330,"../glov/common/vmath.js":332,"file-saver":void 0}],120:[function(e,t,r){"use strict"
r.getEntityAnimPos=getEntityAnimPos
r.playerToolAnim=playerToolAnim
r.otherPlayerAnim=otherPlayerAnim
r.updatePlayers=updatePlayers
r.mobsTick=mobsTick
r.mobsDraw=mobsDraw
r.mobsDrawLate=mobsDrawLate
r.mobsStartup=mobsStartup
r.placePrevented=r.EntDrawData=void 0
function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype)
_setPrototypeOf(e.prototype.constructor=e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){e.__proto__=t
return e})(e,t)}var f=e("assert")
var u=e("gl-mat4/translate")
var l=e("../glov/client/chat_ui").CHAT_FLAG_EMOTE
var a=e("../glov/client/cmds").cmd_parse
var c=e("../glov/client/engine").getFrameDt
var m=e("../glov/client/engine")
var i=e("../glov/client/font").styleAlpha
var o=e("../glov/client/input")
var d=e("../glov/client/mat4ScaleRotateTranslate")
var n=e("../glov/client/net")
var s=n.netSubs
var _=n.netUserId
var v=e("../glov/client/quat")
var g=v.qFromYPR
var h=v.qInvert
var p=v.qMult
var w=v.qRotateX
var E=v.qRotateZ
var L=v.qTransformVec3
var y=v.quat
var T=e("../glov/client/settings")
var I=e("../glov/client/words/profanity").profanityFilter
var S=e("../glov/common/util")
var A=S.clamp
var R=S.easeIn
var x=S.easeInOut
var O=S.easeOut
var b=S.lerp
var N=S.merge
var C=e("../glov/common/vmath")
var M=C.mat4
var D=C.v3addScale
var P=C.v3copy
var k=C.v3distSq
var B=C.v3iAdd
var U=C.v3lengthSq
var G=C.v3normalize
var F=C.v3perspectiveProject
var W=C.v3set
var j=C.v3sub
var H=C.vec3
var z=C.zaxis
var V=e("../common/globals").VOXELS_PER_M
var Y=e("../common/ids")
var q=Y.ITEM_BUCKET
var K=Y.ITEM_HANDSTOOL
var Z=Y.ITEM_SHOVEL
var X=Y.TYPE_BLOCK
var Q=Y.TYPE_ITEM
var J=e("../common/items_common").sameItem
var $=e("../common/roles_common").isValidRole
var ee=e("./animation").animationStartup
var te=e("./animation_enum")
var re=te.AnimEnum
var ae=te.isCrouchAnim
var ie=te.isLadderAnim
var oe=e("./animation_player").animationDrawPlayer
var ne=e("./baking").drawBaked2
var se=e("./camera").updateAndGetViewMatrix
var le=e("./character_controller")
var ce=le.CHAR_SIZES
var _e=le.CHAR_SIZE_SMALL
var ue=le.CHAR_SIZE_TALL
var de=e("./chat_floater")
var fe=de.ChatFloater
var ve=de.ChatWithTipFloater
var he=de.chatFloaterStartup
var pe=de.isChatWithTipFloater
var me=e("./client_entities")
var ge=me.allocPerEntData
var Ee=me.clientEntitiesTick
var ye=me.getEntityManager
var Te=me.getEntityPosManager
var Ie=me.getMyEntID
var Se=e("./costume_edit")
var Ae=Se.costumeCurrent
var we=Se.costumeCurrentMod
var Le=e("./floater")
var Re=Le.DEF_FLT_SCALE
var xe=Le.TextFloater
var Oe=Le.drawFloaterSimple
var be=Le.drawFloaterStack
var Ne=e("./inventory").inventoryGetAccountMapped
var Ce=e("./items").createItem
var Me=e("./main")
var De=e("./photo_mode")
var Pe=De.photoModeActive
var ke=De.photoShowSelf
var Be=e("./props")
var Ue=Be.PREVIEW_HELD
var Ge=Be.drawBlock
var Fe=Be.getForPreview
var We=e("./quickbar")
var je=We.getCurrentBrushSize
var He=We.getSelectedVisible
var ze=e("./styles")
var Ve=ze.STYLE_WITHOUT_OUTLINE
var Ye=ze.STYLE_WITH_OUTLINE
var qe=ze.getStyleForClient
var Ke=ze.getStyleForRole
var Ze=e("./tiles_const").TILES
var Xe=e("./user_data")
var Qe=Xe.MORALE_BOOST_MOD
var Je=Xe.setStaminaUsageScaleMod
var $e=e("./user_info_view")
var et=$e.USER_VIEW_H
var tt=$e.USER_VIEW_W
var rt=$e.viewUser
var at=e("./voxel_data")
var it=at.applyBevelParamCharacters
var ot=at.applyBevelParamWorld
var nt=at.getPropLighting
var st=at.localPosFromWorldPos
var lt=at.worldPosFromLocalPos
var ct=e("./world_comm")
var _t=ct.getWorldChannel
var ut=ct.worldGetRoles
var dt=e("./world_metadata").worldUserDistance
var ft=Math.abs,vt=Math.max,ht=Math.min,pt=Math.PI,mt=Math.cos,gt=Math.sqrt,Et=Math.tan,yt=Math.asin
var Tt=1.75*V/12
var It=150
T.register({show_names:{default_value:1,type:a.TYPE_INT,range:[0,1]},show_names_photos:{label:"Show Names in Photos",default_value:0,type:a.TYPE_INT,range:[0,1],store:false},show_names_offscreen:{label:"Show Names Offscreen",default_value:1,type:a.TYPE_INT,range:[0,1]},name_interact_dist:{label:"Name Interact Distance",default_value:-1,type:a.TYPE_INT,range:[-1,1e3]},name_interact_dist_locked:{label:"Name Interact Distance (while pointer locked)",default_value:12,type:a.TYPE_INT,range:[-1,1e3]},show_chat_bubbles:{default_value:1,type:a.TYPE_INT,range:[0,1]},show_chat_bubbles_offscreen:{label:"Show Chat Bubbles Offscreen",default_value:1,type:a.TYPE_INT,range:[0,1]}})
var St
var At
function checkMoraleBoost(e,t){if(t&&t.world_areabuilder&&e.last_receive_time+3e4>m.frame_timestamp)Je(Qe,true)}var wt=y()
var Lt=y()
g(Lt,pt,0,0)
function applyAnimConstraints(e,t,r,a,i,o){if(o&&ie(o)||i===re.SIT){g(e,a,0,0)
h(wt,t)
p(wt,e,wt)
var n=U(wt)
var s=2*Math.atan2(n,wt[3])
if(!(s<1.2||s>5))p(t,t,Lt)}else if(i===re.MINING||i===re.DIG){g(e,a,0,0)
g(t,0,-r,0)
p(t,e,t)}}var Rt=function EntDrawData(){this.local_pos=H()
this.quat=y()
this.head_pos=H()
this.head_quat=y()
this.hand_pos=H()
this.prop_mat=M()
this.prop_quat=y()
this.last_prop=null
this.last_tile=null
this.last_item=null
this.last_scale=1
this.name_floater=null
this.msg_floaters=[]
this.draw_opts={scale_lights:true,torch_factor:0,sun_factor:1,torch_target:0,sun_target:1}
this.alpha=1
this.costume_mod=0
this.last_costume=void 0
this.last_receive_time=0
this.anim_override=null
this.anim_data=void 0}
r.EntDrawData=Rt
var xt=H(.75,0,-.75)
var Ot=H(0,.5,-.5)
var bt=H()
function updatePerClientPos(e,t,r,a){var i=e.head_quat,o=e.head_pos,n=e.local_pos
if(a){P(n,St.feet_pos)
P(o,St.pos)
g(i,St.head_angle[0],St.head_angle[1],0)
g(e.quat,-St.ypr[0],0,0)
applyAnimConstraints(e.quat,i,St.ypr[1],St.look_angle,St.anim,St.anim_secondary)}else{f(isFinite(t.pos[0])&&isFinite(t.pos[1])&&isFinite(t.pos[2]))
st(n,t.pos)
D(o,n,z,10*Tt)
g(e.quat,-t.pos[3],0,0)
g(i,-t.pos[3],-t.pos[4],0)
if(t.anim_state.anim)applyAnimConstraints(e.quat,i,t.pos[4],t.pos[5],t.anim_state.anim,t.anim_state.anim_secondary)}if(r){var s=e.hand_pos
L(s,xt,e.quat)
L(bt,Ot,i)
B(s,bt)
B(s,o)}return e}var Nt=H()
function getEntityAnimPos(e){if(e===Ie()){var t=St,r=t.char_right,a=t.char_up,i=t.facing,o=t.pos
D(Nt,o,i,1)
var n=Et(m.fov_x/2)
var s=Et(m.fov_y/2)
D(Nt,Nt,r,.5*n)
D(Nt,Nt,a,-s)
return Nt}var l=ye().getEnt(e)
var c=Te().getPED(e)
if(!c||!l||!l.draw_data)return null
return updatePerClientPos(l.draw_data,c,true,false).hand_pos}function getHeldItemData(e,t){var r
var a=.5
if(t.type===Q&&(t.need_thumbnail_update||t.thumbnail_updated)){var i=Fe(t,Ue)
r=i!==e.last_prop
e.last_prop=i
a=1/vt(i.size[0],i.size[1],i.size[2])
e.last_tile=null}else{e.last_prop=null
var o=t.type===X?t.id:"unknown"
r=o!==e.last_tile
e.last_tile=o}e.last_scale=a
return r}var Ct=H(-.5,-.5,0)
var Mt=H()
function drawHeldItem(e,t){var r=t&&t[0]||0
var a=e.prop_mat,i=e.last_scale,o=e.prop_quat,n=e.hand_pos,s=e.last_prop,l=e.last_tile,c=e.draw_opts
if(!s&&r>1){i*=1+.3*(r-1)
n=W(Mt,n[0],n[1],n[2]-.075*(r-1))}W(n,n[0]+.01,n[1]+.01,n[2]+.01)
d(a,i,o,n)
if(s){var _=s
if(_.baked&&_.baked.key)ne(a,_.baked.key,c)}else{u(a,a,Ct)
if("unknown"!==l)Ge(a,l,c,t)}}function animFromTool(e){var t=re.MINING
if(!e||e.type===Q&&(e.id===K||e.id===Z))t=re.DIG
return t}var Dt=500
var Pt=null
var kt=H()
function playerToolAnim(e,t,r,a){var i=null
if(a){j(kt,a,St.pos)
G(kt,kt)
var o=Math.atan2(kt[1],kt[0])
i=o-=pt/2}var n=animFromTool(e)
St.useTool(i,n)
r=vt(r||1,.5)
if(!e.type||e.type===Q&&e.id===K)e={type:X,id:Ze.SAND}
if(!Pt||!J(Pt.inv,e)&&Pt.frame!==m.frame_index)Pt={time:m.frame_timestamp,inv:Ce(e),rate:r}
else if(!t||(m.frame_timestamp-Pt.time)*Pt.rate>.6*Dt){Pt.time=m.frame_timestamp
Pt.rate=r}Pt.frame=m.frame_index}function otherPlayerAnim(e,t){var r
t=vt(t||1,.5)
var a=ye().getEnt(e)
var i=Te().getPED(e)
if(!i||!a||!a.draw_data)return
var o=a.draw_data
var n=animFromTool(null==(r=i.anim_state)?void 0:r.held_item)
var s=o.anim_override
if(!s)o.anim_override={start:m.frame_timestamp,duration:Dt*t,anim:n}
else if(s.anim!==n||m.frame_timestamp>s.start+.6*s.duration){s.start=m.frame_timestamp
s.duration=Dt*t
s.anim=n}}var Bt=new Rt
var Ut=H(0,0,-.2)
var Gt=H(.1,0,-.2)
var Ft=H(0,0,-.3)
var Wt=H()
function animateTool(e,t,r,a){var i=e.head_quat,o=e.hand_pos,n=e.prop_quat,s=e.last_prop
if(t)if(s&&s.prop_is_tool&&(s.item_id===Z||s.item_id===q&&!s.attr2)){var l=H(-.75,0,.5)
var c=-pt/4
var _=pt/4
var u=(t>.25?1:0)?1-(t-.25)/.75:t/.25
var d=(t>.5?1:0)?1-(t-.5)/.5:t/.5
var f=t>.5?2:t>.25?1:0
var v=2===f?1-(t-.5)/.5:f?1-(t-.25)/.25:t/.25
Wt[0]=R(u,2)*l[0]*r
Wt[1]=0
Wt[2]=O(d,2)*l[2]*a
L(Wt,Wt,i)
B(o,Wt)
if(0===f)w(n,n,x(v,1.5)*_)
else if(1===f)w(n,n,b(R(v,2),c,_))
else w(n,n,x(v,1.5)*c)}else if(s&&s.prop_is_tool){var h=H(-.75,0,1)
var p=-pt/4
var m=pt/4
var g=(t>.25?1:0)?1-(t-.25)/.75:t/.25
var E=(t>.1?1:0)?1-(t-.1)/.9:t/.1
var y=t>.25?2:t>.1?1:0
var T=2===y?1-(t-.25)/.75:y?(t-.1)/.15:t/.1
Wt[0]=R(g,2)*h[0]*r
Wt[1]=0
Wt[2]=O(E,2)*h[2]*a
L(Wt,Wt,i)
B(o,Wt)
if(2===y)w(n,n,x(T,1.5)*m)
else if(y)w(n,n,b(R(T,2),p,m))
else w(n,n,x(T,1.5)*p)}else{var I=H(-.75,1,0)
var S=pt/8
var A=(t>.25?1:0)?1-(t-.25)/.75:t/.25
Wt[0]=R(A,2)*I[0]*r
Wt[1]=R(A,2)*I[1]*a
Wt[2]=0
L(Wt,Wt,i)
B(o,Wt)
w(n,n,R(A,2)*S)}}function updateAnimProgress(e){if(e){e.progress=e.rate*(m.frame_timestamp-e.time)/Dt
if(e.progress>=1)e=null}return e}var jt=0
function drawItemInHand(){var e=(Pt=updateAnimProgress(Pt))&&Pt.inv||He()
if(!e){jt=0
return}jt+=m.frame_dt
var t=Pt&&Pt.progress||0
var r=Bt
if(getHeldItemData(r,e=Ne(e)))jt=0
var a=ht(jt/100,1)
var i=r.head_quat,o=r.hand_pos,n=r.prop_quat,s=r.last_prop
var l=St,c=l.ypr,_=l.camera_pos,u=l.char_right,d=l.char_up,f=l.facing,v=l.lighting_values
N(r.draw_opts,v)
g(r.quat,-c[0],0,0)
g(i,-c[0],-c[1],0)
D(Nt,_,f,1)
var h=Et(m.fov_x/2)
var p=Et(m.fov_y/2)
D(Nt,Nt,u,h)
D(Nt,Nt,d,-p)
L(o,Ut,r.quat)
L(bt,Gt,i)
B(o,bt)
B(o,Nt)
E(n,i,1.2*pt)
Wt[0]=Wt[1]=0
Wt[2]=.03*mt(c[0])+.03*mt(2*_[0]*pt/16)+.03*mt(2*_[1]*pt/16)
Wt[2]+=-.5*(1-O(a,2))
L(Wt,Wt,i)
B(o,Wt)
animateTool(r,t,h,p)
if(s){r.last_scale/=2
if(e.type===Q&&e.id===q);else w(n,n,pt/4)
if(s.prop_is_tool){L(bt,Ft,n)
B(o,bt)}}drawHeldItem(r,je())}var Ht=H()
function isPosOnscreen(e){F(Ht,e,m.mat_vp)
return Ht[2]>=.5}var zt=function(r){_inheritsLoose(PlayerNameFloater,r)
function PlayerNameFloater(e){var t;(t=r.call(this,e)||this).user_id=void 0
t.user_id=e.user_id
return t}PlayerNameFloater.prototype.interact=function interact(e){var t=this.user_id
o.pointerLockExit()
rt({user_id:t,x:e.x+(e.w-tt)/2,y:e.y-et})}
return PlayerNameFloater}(xe)
function playerNameFloaterWithOpts(e,t){if(!t.user_id)return null
if(!e.name_floater)e.name_floater=new zt({user_id:t.user_id})
e.name_floater.setInteractDist(o.pointerLocked()?T.name_interact_dist_locked:T.name_interact_dist)
e.name_floater.setText(t.display_name||t.user_id)
var r=qe(t.roles,Ye)
if(1!==e.alpha)r=i(r,e.alpha)
e.name_floater.setStyle(r)
return{floater:e.name_floater,show_offscreen:Boolean(T.show_names_offscreen),max_dist:dt(),draw_in_photos:Boolean(T.show_names_photos)}}var Vt=4
var Yt=5e3
var qt=1e3
var Kt=200
function updatePlayerMessageFloaters(e,t){var r=0
for(var a=e.length-1;a>=0;a--){var i=Date.now()-e[a].getTimestamp()
var o=1-A((i-Yt)/qt,0,1)
if(0===o)e.splice(a,1)
else if(T.show_chat_bubbles&&r<Vt){e[a].setBaseAlpha(o)
t.push({floater:e[a],show_offscreen:Boolean(T.show_chat_bubbles_offscreen),max_dist:Kt})
r++}}}var Zt=18
var Xt=H()
var Qt=Infinity
var Jt
function updatePlayer(e,t){var r=Boolean(t.data.held_item)
var a=t.draw_data
if(!a)a=t.draw_data=new Rt
a.alpha=null===t.fade?1:t.fade
var i=updatePerClientPos(a,e,r,false)
var o=i.head_pos
f(isFinite(o[0])&&isFinite(o[1])&&isFinite(o[2]))
D(Xt,o,z,3*Tt)
At=gt(k(Xt,St.pos))
if(Qt>At){Qt=At
Jt=a}var n=[]
var s=T.show_names||T.show_names_photos&&Pe()
var l=At<=dt()
if(l){if(s&&t.data.user_id){var c=playerNameFloaterWithOpts(a,t.data)
f(c)
n.push(c)}updatePlayerMessageFloaters(i.msg_floaters,n)
be(n,Xt,Re,{min_scale:Zt})}if(At<It)checkMoraleBoost(a,t.data.roles)
return isPosOnscreen(Xt)&&l}function drawPlayer(e,t,r){var a=Boolean(t.anim_state.held_item)
var i=e
var o=i.head_pos,n=i.local_pos,s=i.head_quat
nt(e.draw_opts,o,true)
var l=oe(e,t,r,n,i.quat,s)
if(a){if(!J(t.anim_state.held_item,i.last_item)){var c=Ce(t.anim_state.held_item)
i.last_item=c
getHeldItemData(i,c)}i.hand_pos=l.pos
i.prop_quat=l.rot
drawHeldItem(i)}return l}var $t=[]
function updatePlayers(){if(!_t())return
Qt=Infinity
Jt=void 0
var e=c()
var t=ye()
var r=Te()
$t.length=0
Je(Qe,false)
var a=t.entities
for(var i in a){var o=Number(i)
var n=a[o]
if(n.isMe()&&!m.defines.DRAWSELF)continue
var s=r.updateOtherEntity(o,e)
if(!s)continue
if(!updatePlayer(s,n))continue
$t.push([s,n])}}function checkDistToPlayers(){if(Qt<10&&Qt>1&&Jt&&St.anim!==re.SIT){j(kt,Jt.head_pos,St.pos)
G(kt,kt)
var e=Math.atan2(kt[1],kt[0])
e-=pt/2
var t=yt(kt[2])
if(pt-ft(ft(e%(2*pt)- -St.ypr[0]%(2*pt))-pt)<pt/3){St.head_angle[0]=e
St.head_angle[1]=t}else{St.head_angle[0]=-St.ypr[0]
St.head_angle[1]=-St.ypr[1]}}else{St.head_angle[0]=-St.ypr[0]
St.head_angle[1]=-St.ypr[1]}}var er
var tr
var rr=H()
function showSelf(){if(!er){er=ge()
tr=new Rt}er.anim_state=St.getNetAnimState()
updatePerClientPos(tr,er,true,true)
var e=Ae(true)
tr.costume_mod=we()
drawPlayer(tr,er,e)
if(T.show_names_photos&&Pe()){var t={user_id:_(),display_name:s().getDisplayName(),roles:ut()}
D(rr,Me.char_controller.pos,z,3*Tt)
var r=playerNameFloaterWithOpts(tr,t)
if(r)Oe(r,rr,Re,{min_scale:Zt})}checkDistToPlayers()}function drawEntities(){it()
if(Pe()?ke():T.camera_view&&!St.zoomed_in_fpv||St.zoomed_out_tpv)showSelf()
else{St.head_angle[0]=-St.ypr[0]
St.head_angle[1]=-St.ypr[1]}for(var e=0;e<$t.length;++e){var t=$t[e]
var r=t[0]
var a=t[1]
if(!a.draw_data)a.draw_data=new Rt
drawPlayer(a.draw_data,r,a.getData("costume"))}ot()}var ar=function(){var d=H()
return function placePreventedFn(e){lt(d,e)
var t=d[0]
var r=d[1]
var a=d[2]
var i=ye().entities
for(var o in i){var n=i[Number(o)]
var s=n.getData("pos")
f(s)
var l=n.getData("anim")
var c=l&&ae(l)?ce[_e]:ce[ue]
var _=c.col_bounds
var u=c.eye_height+_.max[2]
if(t<=s[0]+_.max[0]&&t+1>=s[0]+_.min[0]&&r<=s[1]+_.max[1]&&r+1>=s[1]+_.min[1]&&a<=s[2]+u&&a+1>=s[2]+1.1)return true}return false}}()
r.placePrevented=ar
function mobsTick(){profilerStart("mobsTick")
m.setMatVP(se())
Ee()
updatePlayers()
profilerStop("mobsTick")}function mobsDraw(){profilerStart("mobsDraw")
drawEntities()
profilerStop("mobsDraw")}function mobsDrawLate(){if(m.defines.NOUI)return
if(St.zoomed_in_fpv||!St.zoomed_out_tpv&&!T.camera_view){if(!m.defines.NOTOOLCLEAR){gl.depthMask(true)
gl.clear(gl.DEPTH_BUFFER_BIT)}else gl.disable(gl.DEPTH_TEST)
drawItemInHand()}}function mobsStartup(){ee()
St=Me.char_controller
he()
Me.chat_ui.registerOnMsgChatCB(function(e){if(!e.quiet&&e.ent_id&&!((e.flags||0)&l)){var t=ye().getEnt(e.ent_id)
if(t&&t.draw_data){var r=t.draw_data.msg_floaters
var a=T.profanity_filter?I(e.msg):e.msg
var i=r.length-1
var o=r[i]
var n=e.style&&$(e.style)?e.style:"NONE"
var s=Ke(n,Ve)
if(o){f(pe(o))
r[i]=new fe(o.getText(),s,o.getTimestamp())}r.push(new ve(a,s,Date.now()))}}})}},{"../common/globals":197,"../common/ids":198,"../common/items_common":200,"../common/roles_common":206,"../glov/client/chat_ui":242,"../glov/client/cmds":244,"../glov/client/engine":250,"../glov/client/font":260,"../glov/client/input":271,"../glov/client/mat4ScaleRotateTranslate":277,"../glov/client/net":279,"../glov/client/quat":287,"../glov/client/settings":291,"../glov/client/words/profanity":310,"../glov/common/util":330,"../glov/common/vmath":332,"./animation":7,"./animation_enum":8,"./animation_player":9,"./baking":17,"./camera":28,"./character_controller":30,"./chat_floater":32,"./client_entities":35,"./costume_edit":56,"./floater":84,"./inventory":94,"./items":98,"./main":112,"./photo_mode":128,"./props":141,"./quickbar":142,"./styles":160,"./tiles_const":163,"./user_data":170,"./user_info_view":171,"./voxel_data":175,"./world_comm":182,"./world_metadata":186,assert:void 0,"gl-mat4/translate":void 0}],121:[function(e,t,r){"use strict"
r.modContinentDataAvailable=modContinentDataAvailable
r.modContinentDataGet=modContinentDataGet
r.modAPIStartup=modAPIStartup
var o=e("./localization/localization").L
var n=e("assert")
var a=e("../glov/client/error_report.js").errorReportSetDetails
var s=e("../glov/client/ui.js")
var i
var l={}
function sendMessage(e,t,r){i.postMessage({msg:t,data:r,origin:e})}var c
function modContinentDataAvailable(){return Boolean(c)}function modContinentDataGet(){var e=c
c=null
a("modapi_cdata",1)
return e}function modMessageHandler(e){var t=e.data,r=t.msg,a=t.data,i=t.origin
if("connect"!==r&&!l[i]){console.log("ModAPI Host: Received message ("+r+") from untrusted origin ("+i+")")
return}switch(r){case"connect":if(l[i])sendMessage(i,"connect_ack")
else if(false===l[i]);else if(null===l[i]);else{l[i]=null
s.modalDialog({title:o.DLG_API_ACCESS_TITLE,text:o.$(o.DLG_API_ACCESS_MSG,i),buttons:{Yes:function Yes(){l[i]=true
sendMessage(i,"connect_ack")},No:function No(){l[i]=false}}})}break
case"ping":sendMessage(i,"pong")
break
case"continent_data_set":n(a instanceof Uint8Array)
c=a
console.log("ModAPI Host: Received continent data ("+a.length+" bytes)")
break
default:console.error("ModAPI Host: Received unknown message from mod_api_messenger:",r)}}function modAPIStartup(){if("undefined"===typeof BroadcastChannel)return
try{i=new BroadcastChannel("mod_api")}catch(e){return}i.addEventListener("message",modMessageHandler)
i.postMessage({msg:"startup"})}},{"../glov/client/error_report.js":255,"../glov/client/ui.js":306,"./localization/localization":108,assert:void 0}],122:[function(e,t,r){"use strict"
r.enabled=enabled
r.set=set
r.unlock=unlock
r.toggle=toggle
r.PORTRAIT=r.LANDSCAPE=void 0
var a="landscape"
r.LANDSCAPE=a
var i="portrait"
r.PORTRAIT=i
var o=e("../glov/common/util.js").eatPossiblePromise
var n=window.screen
function enabled(){return n&&n.orientation}function getSimple(){return n.orientation.type.startsWith(i)?i:a}function set(e){if(enabled())try{if(getSimple()!==e)o(n.orientation.lock(e))}catch(e){}}function unlock(){if(enabled())try{o(n.orientation.unlock())}catch(e){}}function toggle(){if(enabled()){var e=getSimple()===a?i:a
try{o(n.orientation.lock(e))}catch(e){}}}},{"../glov/common/util.js":330}],123:[function(e,t,r){"use strict"
r.paletteGet=paletteGet
r.paletteRange=paletteRange
r.generateSwapKey=generateSwapKey
r.paletteSwap=paletteSwap
r.paletteStartup=paletteStartup
var c=e("assert")
var i=e("../glov/client/engine")
var a=e("../glov/client/filewatch").filewatchOn
var o=e("../glov/client/webfs")
var l=o.webFSExists
var f=o.webFSGetFile
var _=e("../glov/common/util").clone
var s=e("../glov/common/verify")
var n=e("../glov/common/vmath").vec4
var u=e("./materials")
var d=u.INV_MATERIAL_NAME
var v=u.MATERIAL_CLASS
var h=u.MaterialClass
var p=e("./palette/ranges.json")
var m=e("./tiles").setMetalTints
var g=e("./voxel_data")
var E=g.remeshAll
var y=g.tileMapIdentityTinted
var T=e("./voxel_data_xraw").reloadXRAW
var I={}
function paletteGet(e){return I[e]}var S=n(1,0,1,1)
function paletteLoad(e){var t=f(e+".pal")
var r=t.length/3
var a=new ArrayBuffer(3*r*4)
var i=[S]
for(var o=0;o<r;++o){var n=new Float32Array(a,12*o,3)
for(var s=0;s<3;++s)n[s]=t[3*o+s]/255
i.push(n)}var l=p[e]||p.by_prefix[e.split("_")[0]]
if(l){i.tile_map=y(l.unlit||256,r)
var c=l.shiny
for(var _=0;_<c.length;++_){var u=c[_]
for(var d=u[0];d<=u[1];++d)i.tile_map.tile_override[d]=61}}I[e]=i}function paletteRange(e,t,r){if(!t)return null
var a=p[t]
if(a)return[I[a[0]],a[1],a[2]]
if("string"===typeof t){if(!(e=I[t])&&l(t+".pal")){paletteLoad(t)
e=I[t]}if(!e&&r&&l("generic_"+r+".pal"))if(!(e=I[t="generic_"+r])){paletteLoad(t)
e=I[t]}if(e)return[e,1,255]}s(false,i.DEBUG?"Missing palette range for "+JSON.stringify(t):null)
return null}function doSwap(e,t,r){if(s(t&&r)){var a=r[0]
var i=r[1]
for(var o=t[1];o<=t[2];++o){var n=i+o-t[1]
e[o]=a[n]
if(a.tile_map)e.tile_map.tile_override[o]=a.tile_map.tile_override[n]}}}function generateSwapKey(e,t){var r=e
var a=[]
for(var i in t)a.push(i+","+t[i])
a.sort()
if(a.length)r+=";"+a.join(";")
return r}function paletteSwap(e,t){var r=generateSwapKey(e,t)
if(I[r])return r
c(e)
var a=I[e]
c(a)
var i=a.slice(0)
i.tile_map=_(a.tile_map)
for(var o in t){var n=t[o]
var s=paletteRange(a,o)
var l=void 0
if(p[n])l=paletteRange(a,n)
else l=paletteRange(a,o+"_"+n,n)
doSwap(i,s,l)}I[r]=i
return r}function paletteReload(){for(var e in I)if(1===e.split(";").length)paletteLoad(e)
for(var t in I){var r=t.split(";")
if(r.length>1)(function(){var i={}
r.slice(1).forEach(function(e){var t=e.split(","),r=t[0],a=t[1]
i[r]=a})
delete I[t]
paletteSwap(r[0],i)})()}m(paletteGet("metal_tints"))
T(null)
T(null,true)
E()}function preprocessRanges(){for(var e in p)if(e.startsWith("MAT_")){var t=e.slice(4)
if(d[t])p[d[t]]=p[e]}for(var r in d){var a=d[r]
var i=v[a]
var o=h[i]
if(!i||!o)continue
o=o.toLowerCase()
var n=p[o]
if(!n)continue
var s=o+"_"+r.toLowerCase()
if(!l(s+".pal"))continue
if(!I[s])paletteLoad(s)
p[a]=[s,n[1],n[2]]}}function paletteStartup(){preprocessRanges()
paletteLoad("material")
paletteLoad("plant")
paletteLoad("character")
paletteLoad("metal_tints")
m(paletteGet("metal_tints"))
a(".pal",paletteReload)}},{"../glov/client/engine":250,"../glov/client/filewatch":259,"../glov/client/webfs":309,"../glov/common/util":330,"../glov/common/verify":331,"../glov/common/vmath":332,"./materials":114,"./palette/ranges.json":124,"./tiles":162,"./voxel_data":175,"./voxel_data_xraw":176,assert:void 0}],124:[function(e,t,r){t.exports={skin:["character",233,240],hair:["character",241,244],eyes:["character",246,248],armor:["character",224,232],leather:["character",189,192],bones:["character",169,172],hollow:["character",165,168],detail:["character",161,164],metal:["material",1,8],generic:["character",185,188],metal_secondary:["character",229,232],metal_primary:["character",225,228],metal_detail:["character",221,224],torso_secondary:["character",213,216],torso_primary:["character",209,212],arms_secondary:["character",205,208],arms_primary:["character",201,204],legs_secondary:["character",197,200],legs_primary:["character",193,196],detail_secondary:["character",189,192],detail_primary:["character",185,188],MAT_LIGHT_WOOD:["material",89,96],MAT_RED_WOOD:["material",97,104],MAT_DARK_WOOD:["material",105,112],MAT_WOOD:["material",81,88],MAT_ANY:["material",81,88],MAT_FLINT:["material",57,64],MAT_ROCK:["material",57,64],MAT_STONE:["material",73,80],MAT_FANCY_STONE:["material",65,72],MAT_GOLD:["material",1,8],MAT_IRON:["material",9,16],MAT_REGULAR:["material",9,16],MAT_AETHERSTEEL:["material",17,24],MAT_SUPER:["material",17,24],dry:["plant",0,250],MAT_ANY_INGREDIENT:["plant",7,8],MAT_BREAD:["material",86,87],MAT_RED_BERRY:["plant",51,52],MAT_BLUE_BERRY:["plant",55,56],MAT_YELLOW_BERRY:["plant",64,65],MAT_BROWN_MUSHROOM:["plant",3,4],MAT_LUMINESCENT_MUSHROOM:["plant",249,250],MAT_RED_MUSHROOM:["plant",52,53],MAT_CORAL_MUSHROOM:["plant",52,53],MAT_LABEL:["plant",26,27],MAT_HOT:["plant",52,53],MAT_PUNGENT:["plant",53,54],MAT_SAVORY:["plant",69,70],MAT_CARROT:["plant",34,35],MAT_PUMPKIN:["plant",83,84],MAT_TOMATO:["plant",57,58],MAT_CORN:["plant",54,55],MAT_RED:["plant",51,52],MAT_ORANGE:["plant",34,35],MAT_YELLOW:["plant",64,65],MAT_GREEN:["plant",12,13],MAT_BLUE:["plant",55,56],MAT_PURPLE:["plant",69,70],plant:{shiny:[],unlit:249},character:{shiny:[[217,232]],unlit:249},material:{shiny:[[1,40],[221,223]],unlit:249},by_prefix:{metal:{shiny:[[1,8]]}}}},{}],125:[function(e,t,r){"use strict"
r.resetRotation=resetRotation
r.doPaperDoll=doPaperDoll
var f=e("gl-mat4/lookAt")
var s=e("../glov/client/camera2d").virtualToCanvas
var a=e("../glov/client/engine")
var v=a.getFrameDt
var h=a.getFrameTimestamp
var p=a.renderHeight
var T=a.setState
var m=a.setupProjection
var g=a.startSpriteRendering
var I=a.stateActive
var i=e("../glov/client/input")
var c=i.click
var l=i.drag
var _=i.mousePos
var S=e("../glov/client/net").netSubs
var o=e("../glov/client/quat")
var n=o.qFromAxisAngle
var E=o.qFromYPR
var y=o.quat
var u=e("../glov/client/snapshot")
var A=u.viewportRenderFinish
var w=u.viewportRenderPrepare
var d=e("../glov/client/sprites")
var L=d.spriteCreate
var R=d.spriteQueueFn
var x=e("../glov/client/ui").drawElipse
var O=e("../glov/client/ui")
var b=e("../glov/common/util")
var N=b.clamp
var C=b.lerp
var M=e("../glov/common/vmath")
var D=M.mat4
var P=M.rovec4
var k=M.v2floor
var B=M.v2sub
var U=M.vec2
var G=M.vec3
var F=M.vec4
var W=M.zaxis
var j=e("./animation_enum").AnimEnum
var H=e("./animation_player").animationDrawPlayer
var z=e("./camera").setViewParameters
var V=e("./character_customization")
var Y=V.handleBottomButton
var q=V.renamePrompt
var K=e("./client_entities").allocPerEntData
var X=e("./cosmetics").costume_dict
var Q=e("./costume_edit")
var J=Q.costumeCurrent
var $=Q.costumeCurrentMod
var ee=Q.costumePreviewActive
var te=Q.incrementCurCostumeMod
var re=e("./inventory_ui")
var ae=re.doPaperDollInventoryOverlay
var ie=re.handlePaperdollDragAndDrop
var oe=e("./localization/localization").L
var ne=e("./main").toggleMenuPage
var se=e("./main_menu")
var le=se.mainMenuInit
var ce=se.welcomeScreen
var _e=e("./menu").CHARACTER_CUSTOMIZATION
var ue=e("./mobs").EntDrawData
var de=e("./props")
var fe=de.restoreGlobalState
var ve=de.saveGlobalState
var he=e("./styles").floater_style_shadow
var pe=e("./ui_util")
var me=e("./user_data").worldReadOnly
var ge=e("./voxel_data")
var Ee=ge.applyBevelParamCharacters
var ye=ge.applyBevelParamWorld
var Te=ge.applyBevelValue
var Ie=Math.atan2,Se=Math.cos,Ae=Math.PI,we=Math.sin,Le=Math.random
var Re=P(1,1,1,.5)
var xe=F(0,0,0,1)
var Oe={char_ul:U(),char_lr:U(),mouse_offs:U(),fall_time:0,rot:0,yaw:0,pitch:0,ped:null,draw_data:new ue,local_pos:G(0,0,0),quat:n(y(),W,Ae)}
var be
var Ne
var Ce
function getSprites(){be=pe.sprite
Ne=L({url:"img/ui/floor_shadow.png",filter_min:gl.LINEAR,filter_mag:gl.LINEAR,origin:U(.5,.5),color:xe})}var Me=false
function paperdollStartup(){getSprites()
Ce=O.font
Me=true}function resetRotation(){Oe.rot=0}var De=[oe.LBL_GREETING_1,oe.LBL_GREETING_2,oe.LBL_GREETING_3]
var Pe
function drawClickableDisplayName(e,t,r,a,i,o,n){var s=S().loggedIn()
if(s){var l=S().getChannel("user."+s).getChannelData("public.display_name")||s
if(n&&!Pe)Pe=De[Math.floor(Le()*De.length)]
O.font.drawSizedAligned(e,t-i/2,r,a,o,O.font.ALIGN.HCENTERFIT,i,0,n?oe.$(Pe,l):l)
if(c({x:t-.5*i,y:r,w:i,h:o,button:0}))q(l)}}var ke=""
function drawSelfForPaperdoll(e,t,r){Te(true)
Ee()
var a=r?X.preview:J()
if(ke!==a.name){te()
ke=a.name}if(!Oe.ped)Oe.ped=K()
Oe.draw_data.costume_mod=$()
Oe.ped.anim_state.anim=e||j.IDLE
H(Oe.draw_data,Oe.ped,a,Oe.local_pos,Oe.quat,t)
ye()
Te()}function drawCharacter(n){var s=60/180*Ae
var l=D()
var c=G(0,0,1.8)
var _=4
var e=1.7
var u=G(0,4,c[2]+e)
var d=y()
return function(){u[0]=we(Oe.rot+Ae)*_
u[1]=Se(Oe.rot+Ae)*_
var e=Oe.char_lr[0]-Oe.char_ul[0]
var t=Oe.char_lr[1]-Oe.char_ul[1]
w({pre:ve,viewport:[Oe.char_ul[0],p()-Oe.char_lr[1],e,t]})
m(s,e,t,.1,100)
f(l,u,c,W)
z(l,true)
gl.clear(gl.DEPTH_BUFFER_BIT)
var r="idle"
if(Oe.fall_time&&h()-Oe.fall_time<250)r="fall"
var a=Ie(Oe.mouse_offs[0],1500)-Oe.rot
if(a<-Ae)a+=2*Ae
if(a>Ae)a-=2*Ae
var i=N(a,-.75,.75)
Oe.yaw=C(.002*v(),Oe.yaw,i)
var o=N(Ie(-Oe.mouse_offs[1],2500)+.1,-.15,.2)
Oe.pitch=C(.001*v(),Oe.pitch,o)
E(d,Ae+Oe.yaw,Oe.pitch,0)
drawSelfForPaperdoll(r,d,n)
A({post:fe})
g()}}function doInteractivePreview(e,t,r,a,i){_(Oe.mouse_offs)
B(Oe.mouse_offs,Oe.mouse_offs,[e+r/2,t+r/2])
s(Oe.char_ul,[e,t])
s(Oe.char_lr,[e+r,t+a])
k(Oe.char_ul,Oe.char_ul)
k(Oe.char_lr,Oe.char_lr)
R(Z.PAPERDOLL,drawCharacter(i||false))
var o=c({x:e,y:t,w:r,h:a,button:0})
if(null!=o&&o.was_double_click&&!i){if(I(ce))T(le)
ne(_e)}var n=l({x:e,y:t,w:r,h:a})
if(n){Oe.rot+=.005*n.delta[0]
if(n.delta[0]/v()>7)Oe.fall_time=h()
while(Oe.rot<0)Oe.rot+=2*Ae
while(Oe.rot>2*Ae)Oe.rot-=2*Ae}}function doPaperDoll(e,t){if(!Me)paperdollStartup()
var r=e.x,a=e.y,i=e.w,o=e.h,n=e.button_h
var s=Z.PAPERDOLL+1
if(e.draw_elipse)x(r,a,r+i,a+o,Z.UI+1,0,Re)
ee()
var l=0
if(e.is_customization){var c=S().getMyUserChannel()
var _=c&&c.getChannelData("public.display_name")||S().logged_in_username
var u=48*n/64
var d=n
var f=(d-u)/2
var v=a+8
var h=r+8+(l=i-d-24)/2+Ce.drawSizedAligned(he,r+8,v+f,s,u,Ce.ALIGN.HCENTERFIT,l,0,_)/2+8
if(O.buttonImage({x:h,y:v,z:s,img:be,frame:pe.EDIT,w:d,h:d,tooltip:oe.TLTP_CHANGE_NAME}))q(_)}else drawClickableDisplayName(he,r+.5*i,a,s,i,.75*n,!t)
if(t&&!me())ae(e,t)
ie(e)
if(!e.draw_elipse){var p={x:r+.5*i,y:a+.8*o,w:.8*i,h:.5*i,z:Z.PAPERDOLL-1}
Ne.draw(p)}if(e.is_customization||t){var m=r+.1*i
var g=.8*i
var E=n
var y=a+o-E
if(e.is_customization)Y({x:m,y:y=a+1.25*o-E,z:s,w:g,h:E})
else if(O.buttonText({x:m,y:y,w:g,h:E,font_height:.8*E,text:oe.BTN_OUTFIT,hook:"new_costume"})){if(I(ce))T(le)
ne(_e)}}doInteractivePreview(r,a,i,o,e.is_customization)}},{"../glov/client/camera2d":241,"../glov/client/engine":250,"../glov/client/input":271,"../glov/client/net":279,"../glov/client/quat":287,"../glov/client/snapshot":295,"../glov/client/sprites":302,"../glov/client/ui":306,"../glov/common/util":330,"../glov/common/vmath":332,"./animation_enum":8,"./animation_player":9,"./camera":28,"./character_customization":31,"./client_entities":35,"./cosmetics":55,"./costume_edit":56,"./inventory_ui":95,"./localization/localization":108,"./main":112,"./main_menu":113,"./menu":117,"./mobs":120,"./props":141,"./styles":160,"./ui_util":168,"./user_data":170,"./voxel_data":175,"gl-mat4/lookAt":void 0}],126:[function(e,t,r){"use strict"
r.shift=shift
r.updateParticleSystems=updateParticleSystems
r.createParticleSystemWithOwner=createParticleSystemWithOwner
r.createDetachedParticlesFromList=createDetachedParticlesFromList
r.particleStartup=particleStartup
r.ParticleSystem=void 0
var n=e("assert")
var a=e("../glov/common/util.js")
var i=a.ridx
var o=a.sign
var s=e("../glov/client/quat.js"),l=s.quat,c=s.qFromAxisAngle,_=s.qTransformVec3,u=s.qMult
var d=e("../glov/common/vmath.js"),f=d.vec3,v=d.v3add,h=d.v3copy,p=d.v4copy,m=d.mat4,g=d.zaxis,E=d.v3sub,y=d.v3set,T=d.v3iAdd,I=d.vec4,S=d.v4set,A=d.v3scale
var w=Math.abs,L=Math.floor,R=Math.PI,x=Math.min
var O=e("./debug.js")
var b=e("../glov/client/engine.js")
var N=e("../glov/client/filewatch.js").filewatchOn
var C=e("./palette.js").paletteGet
var M=e("./palette/ranges.json")
var D=e("./proc_gen_biomes.js").getVSTintColors
var P=e("./tiles.js"),k=P.MAT_METAL_TINT,B=P.tile_colors
var U=e("../glov/client/webfs.js").webFSGetFile
var G=e("../glov/client/geom.js")
var F=e("../glov/client/shaders.js")
var W=e("./voxel_data.js")
var j=W.getPropLighting2Prop,H=W.getPropLighting,z=W.propInWorld
var V=e("../glov/client/mat4ScaleRotateTranslate.js")
var Y=e("gl-mat4/multiply")
var q=255
var K=72
var Z=0
var X=1
var Q=2
var J=3
var $=true
var ee=[]
var te=[]
var re={}
var ae=0
var ie=l()
var oe=f()
var ne=0
var se=0
var le=0
var ce=0
var _e={}
var ue=I()
var de
var fe
var ve
var he=m()
var pe=function(){function ParticleSystem(e){this.name=e.name
if(!te[this.name])te[this.name]=U("particles/"+this.name,"jsobj")
this.system=te[this.name]
this.position=f()
this.generation=0
this.stage=Z
this.quat_rot=l(0,0,0,0)
this.owner_prop=null
this.raw_position=f()
this.start=0
this.end=0
this.offset_position=f()
this.last_update_frame=0
this.time=0}var e=ParticleSystem.prototype
e.initParticles=function initParticles(e,t){this.random_seed=Math.random()
if(!re[this.name])re[this.name]=new Float32Array(this.system.mega_array)
this.mega_array=re[this.name]
if(void 0!==e&&e>=0){this.mega_array=re[this.name].slice(0)
for(var r=0;r<t.length;r++)this.mega_array[r+e]=t[r]}this.system_lifetime="infinity"===this.system.system_lifetime?Infinity:this.system.system_lifetime
this.end=this.system.particle_amount}
e.updateParticles=function updateParticles(e){if(this.last_update_frame===b.frame_index)return
this.last_update_frame=b.frame_index
if(this.generation!==ae)this.updateGeneration()
this.time+=e
var t=this.stage===Q?this.time_of_death-this.time_of_death%this.system.max_age:this.system_lifetime-this.system_lifetime%this.system.max_age
if(this.time>t){var r=(this.time-t)/this.system.max_age*this.system.particle_amount
this.start=L(r+2)
if(this.start>this.system.particle_amount)this.stage=J}else this.start=0
if(!this.system.burst)this.end=L(this.system.particle_amount*x(this.time/this.system.max_age,1))}
e.updateGeneration=function updateGeneration(){this.system=te[this.name]
this.initParticles()
this.generation=ae}
e.killParticles=function killParticles(){this.stage=Q
this.time_of_death=this.time+this.system.max_age}
e.addParticleSystemToQueue=function addParticleSystemToQueue(){if($)ee.push(this)
return this}
e.fitToOwner=function fitToOwner(e,t){if(this.raw_position[0]===t[0]&&this.raw_position[1]===t[1]&&this.raw_position[2]===t[2])return
h(this.position,t)
if("object"===typeof e){p(ie,e)
if(!this.system.no_world_rotate)p(this.quat_rot,ie)}else if(e)c(ie,g,e*R/2)
_(oe,this.offset_position,ie)
v(this.position,this.position,oe)
h(this.raw_position,t)}
e.drawCubes=function drawCubes(){V(he,1,this.quat_rot,this.position)
Y(he,b.mat_view,he)
var e=1
var t=1
if(this.owner_prop){if(!z(this.owner_prop))return
j(this.owner_prop)
e=this.owner_prop.draw_opts.sun_factor
t=this.owner_prop.draw_opts.torch_factor}else{H(_e,this.position)
e=_e.sun_factor
t=_e.torch_factor}S(ue,this.time,e,t,this.random_seed)
var r={time_light:ue,mega_array:this.mega_array,prv_matrix:he}
F.bind(fe,ve,r)
de.drawSub(6*this.start*6,12*(this.end-this.start))}
e.updateParticleSystemOwner=function updateParticleSystemOwner(e,t){if(b.defines.NOPARTICLES||!$)return
var r=b.frame_dt
if(t&&!this.system.burst)this.fitToOwner(e,t)
this.updateParticles(r)
this.drawCubes()
if(b.defines.PARTICLEDEBUG){ne++
if(this.system.particle_amount)se+=this.system.particle_amount
if(this.time<=r)le++
if(this.stage>=Q)ce++}}
e.detach=function detach(){this.addParticleSystemToQueue()
this.killParticles()}
return ParticleSystem}()
r.ParticleSystem=pe
function reload(){for(var e in te)te[e]=U("particles/"+e,"jsobj")
re=[]
ae++}function shift(e){for(var t=0;t<ee.length;t++)T(ee[t].position,e)}function updateParticleSystems(){if(b.defines.NOPARTICLES||!$)return
profilerStart("updateParticleSystems")
var e=b.frame_dt
for(var t=ee.length-1;t>=0;t--){if(!ee[t])continue
ee[t].updateParticles(e)
if(ee[t].stage===X)ee[t].killParticles()
if(ee[t].stage===J)i(ee,t)
else ee[t].drawCubes()}if(b.defines.PARTICLEDEBUG){for(var r=0;r<ee.length;r++){if(ee[r].system.particle_amount)se+=ee[r].system.particle_amount
if(ee[r].time<=e)le++
if(ee[r].stage>=Q)ce++}ne+=ee.length
O.addText(["Particle systems: "+ne,"Amount of particles: "+se,"Amount of dying systems: "+ce,"Amount of new systems this frame: "+le].join("\n"))
ce=le=se=ne=0}profilerStop("updateParticleSystems")}function createParticleSystemWithOwner(e,t,r){var a=new pe(t)
if(t.offset_position)h(a.offset_position,t.offset_position)
if(t.rot)c(a.quat_rot,g,t.rot*R)
if(r&&!a.system.no_world_rotate)u(a.quat_rot,a.quat_rot,r)
if(!a.system.burst)a.owner_prop=e
a.initParticles()
return a}var me=f()
var ge=[c(l(),g,0),c(l(),g,R/2),c(l(),g,R),c(l(),g,R+R/2)]
function quatFaceAxisSnapped(e,t){E(me,e,t)
var r=w(me[0])>w(me[1])?0:1
var a=o(me[r])
var i=r?1:0
return ge[i+=a>0?2:0]}var Ee=f(1,.65,.3)
function createDetachedParticleSystem(e,t,r,a){var i=new pe(t)
h(i.position,e)
if(r)p(i.quat_rot,quatFaceAxisSnapped(e,r))
else c(i.quat_rot,g,t.rot*R)
if(a){y(Ee,1,.65,.3)
if(a.tile_data){if(a.tile_data.tint_color)h(Ee,a.tile_data.tint_color)
else if(k[a.tile_material])h(Ee,k[a.tile_material])
else if(a.tile_data.tint){var o=W.getVDFromLocalPos(a.pos)
if(!o)n(false,"Missing vd : target.pos="+a.pos+", position="+e+", orig="+r+".")
h(Ee,D(o.vsid,o.pos_world,a.tile_data.tint,true))}else if(B[a.tile]||B[a.tile_material]){h(Ee,B[a.tile]||B[a.tile_material])
A(Ee,Ee,1/255)}else if(a.tile_data.mat&&M[a.tile_data.mat])h(Ee,C("material")[M[a.tile_data.mat][1]])}else if(a.tile_material&&M[a.tile_material])h(Ee,C("material")[M[a.tile_material][1]])
i.initParticles(K,Ee)}else i.initParticles()
i.addParticleSystemToQueue()
return i}var ye=f()
function createDetachedParticlesFromList(e,t,r,a){for(var i=0;i<t.length;i++){if(t[i].offset_position)v(ye,e,t[i].offset_position)
else h(ye,e)
createDetachedParticleSystem(ye,t[i],r,a)}}function disableParticles(){$=false}function createParticleCubes(){fe=F.create({filename:"shaders/particles.vp",non_fatal:true})
ve=F.create("shaders/particles.fp")
if(!fe.valid)disableParticles()
else F.prelink(fe,ve,void 0,disableParticles)
var e=[]
for(var t=0;t<q;t++)e.push(0,1,1,t,1,1,2,t,0,0,1,t,1,1,2,t,1,0,1,t,1,1,2,t,1,1,1,t,1,1,2,t,1,1,0,t,1,1,0,t,1,0,0,t,1,1,0,t,0,0,0,t,1,1,0,t,0,1,0,t,1,1,0,t,1,1,1,t,1,2,1,t,1,1,0,t,1,2,1,t,0,1,0,t,1,2,1,t,0,1,1,t,1,2,1,t,0,0,1,t,1,0,1,t,0,0,0,t,1,0,1,t,1,0,0,t,1,0,1,t,1,0,1,t,1,0,1,t,1,0,1,t,2,1,1,t,1,0,0,t,2,1,1,t,1,1,0,t,2,1,1,t,1,1,1,t,2,1,1,t,0,1,1,t,0,1,1,t,0,1,0,t,0,1,1,t,0,0,0,t,0,1,1,t,0,0,1,t,0,1,1,t)
de=G.createQuads([[F.semantic.POSITION,gl.UNSIGNED_BYTE,4,false],[F.semantic.NORMAL,gl.UNSIGNED_BYTE,4,false]],new Uint8Array(e))}function particleStartup(){N(/^particles\//,reload)
createParticleCubes()}},{"../glov/client/engine.js":250,"../glov/client/filewatch.js":259,"../glov/client/geom.js":263,"../glov/client/mat4ScaleRotateTranslate.js":277,"../glov/client/quat.js":287,"../glov/client/shaders.js":293,"../glov/client/webfs.js":309,"../glov/common/util.js":330,"../glov/common/vmath.js":332,"./debug.js":62,"./palette.js":123,"./palette/ranges.json":124,"./proc_gen_biomes.js":133,"./tiles.js":162,"./voxel_data.js":175,assert:void 0,"gl-mat4/multiply":void 0}],127:[function(e,t,r){"use strict"
r.PhotoController=void 0
function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
return e}function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype)
_setPrototypeOf(e.prototype.constructor=e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){e.__proto__=t
return e})(e,t)}var o=e("../glov/client/engine.js")
var n=e("../glov/client/ui.js").isMenuUp
var a=e("../glov/common/vmath.js")
var i=a.v3copy
var s=a.vec3
var l=e("./base_controller.js")
var c=l.BaseController
var _=l.MAX_STEP_DT
var u=l.MAX_TIMESLICE
var d=e("./camera.js").getActiveController
var f=e("./controller_common.js")
var v=f.movementShared
var h=f.rotationShared
var p=f.updateFacing
var m=e("./controller_components/debug_comp").DebugComponent
var g=e("./controller_modes/mode_common.js")
var E=g.PHTMOVE_ID
var y=g.clampPhotoPosition
var T=e("./controller_modes/phtmove_mode.js").PhotoMoveMode
var I=e("./photo_mode")
var S=I.getPhotoStartPosition
var A=I.photoModeActive
var w=e("./state_machine.js").StateMachine
var L=Math.min
var R=.6
var x=function(t){_inheritsLoose(PhotoController,t)
function PhotoController(){var e;(e=t.call(this,{col_bounds:{min:s(-R,-R,-R),max:s(R,R,R)},eye_height:R})||this).csm=void 0
e.debug_comp=void 0
e.camera_pos=void 0
e.is_tpv=true
e.flying=true
e.can_doublejump_to_fly=false
e.camera_pos=e.pos
e.csm=new w(_assertThisInitialized(e),[T],E)
e.debug_comp=new m(_assertThisInitialized(e))
return e}var e=PhotoController.prototype
e.getParamsFromController=function getParamsFromController(e){i(this.pos,e.camera_pos)
i(this.ypr,e.ypr)
i(this.facing,e.facing)
i(this.char_right,e.char_right)
i(this.char_up,e.char_up)
this.auto_run=e.auto_run
this.blocked_accum=e.blocked_accum
this.blocked_frames=e.blocked_frames
this.blocked_target=e.blocked_target
i(this.vel,e.vel)}
e.setPos=function setPos(e){if(A())y(e,S())
t.prototype.setPos.call(this,e)}
e.updateAndGetCameraPos=function updateAndGetCameraPos(){return this.getCameraPos()}
e.isAerial=function isAerial(){return true}
e.update=function update(e){if(n())e=false
var t=L(o.frame_dt,u)
var r=v(this,t,e)
if(e)h(this,t)
p(this)
if(t>0){var a=t
while(a>0){var i=L(a,_)
this.csm.tick({dt:i,impulse:r})
a-=i}}if(o.defines.CAMERA&&d()===this){this.setDebugFloorInfo()
this.addControllerDebugText()}}
e.addControllerDebugText=function addControllerDebugText(){this.debug_comp.addControllerDebugText()}
e.setDebugFloorInfo=function setDebugFloorInfo(){this.debug_comp.setDebugFloorInfo()}
return PhotoController}(c)
r.PhotoController=x},{"../glov/client/engine.js":250,"../glov/client/ui.js":306,"../glov/common/vmath.js":332,"./base_controller.js":18,"./camera.js":28,"./controller_common.js":40,"./controller_components/debug_comp":43,"./controller_modes/mode_common.js":49,"./controller_modes/phtmove_mode.js":50,"./photo_mode":128,"./state_machine.js":155}],128:[function(e,t,r){"use strict"
r.photoModeActive=photoModeActive
r.getPhotoTime=getPhotoTime
r.photoShowSelf=photoShowSelf
r.getPhotoStartPosition=getPhotoStartPosition
r.getPhotoBounds=getPhotoBounds
r.shiftPhotoBounds=shiftPhotoBounds
r.errorModalDialog=errorModalDialog
r.setImageUploadFalse=setImageUploadFalse
r.validatePhotoCapture=validatePhotoCapture
r.photoModeClear=photoModeClear
r.photoModeCancel=photoModeCancel
r.photoModeInteractive=photoModeInteractive
r.photoCanMove=photoCanMove
r.photoCanMoveChar=photoCanMoveChar
r.photoCanMovePht=photoCanMovePht
r.provideGlobalScreenshot=provideGlobalScreenshot
r.copyCanvasToClipboard=copyCanvasToClipboard
r.copyToClipboardCheck=copyToClipboardCheck
r.photoModeTick=photoModeTick
r.photoCapture=photoCapture
r.DEFAULT_JPEG_QUALITY=r.PHOTO_ASPECT=void 0
var M=e("./localization/localization").L
var a=e("../common/photo_common.js"),f=a.CARD_W,v=a.CARD_H
var R=f/v
r.PHOTO_ASPECT=R
var D=e("./analytics.js").logEvent
var i=e("assert")
var o=e("./build_mode.js"),P=o.doPointerLockBottom,k=o.doPointerLockTop,B=o.pointerLockJustEntered
var n=e("./camera.js"),s=n.CAMMODE_REGULAR,l=n.getCameraMode,c=n.setCameraModeRegular,_=n.setCharacterControllerAsActive,u=n.setPhotoControllerAsActive
var U=e("../glov/client/camera2d.js")
var d=e("../glov/common/chunked_send.js").MAX_CLIENT_UPLOAD_SIZE
var h=e("../common/globals.js").CHUNK_SIZE
var p=e("../glov/client/edit_box.js").editBoxAnyActive
var m=e("../glov/client/effects.js")
var G=e("../glov/client/engine.js")
var g=e("./file_management.js"),x=g.uploadImageSet,F=g.uploadInProgress
var E=e("../glov/client/framebuffer.js"),W=E.framebufferSkipRelease,y=E.framebufferUpdateCanvasForCapture
var j=e("../glov/client/input.js")
var T=e("./layout.js"),O=T.layoutCameraSquare,b=T.layoutCameraFull,H=T.menuUpperLeft,z=T.CORNER_BUTTON_MARGIN,V=T.TC_VERTBUTTONS_H
var I=e("./loading_custom.js").isLoadingCustom
var Y=e("./main.js")
var q=Y.blockImageUpload,S=Y.charControllerPos
var A=Math.asin,w=Math.cos,K=Math.round,L=Math.sin,N=Math.sqrt,X=Math.trunc,C=Math.PI
var Q=e("./menu.js")
var J=e("./quickbar.js")
var $=e("../glov/client/settings.js")
var ee=e("./sky.js").getSkyPropsTime
var te=e("../glov/client/slider.js").slider
var re=e("../glov/client/spot.js").spotUnfocus
var ae=e("../glov/client/sprites.js"),ie=ae.spriteCreate,oe=ae.spriteDraw,ne=ae.spriteDrawPartial
var se=e("./status.js")
var le=e("./styles.js"),ce=le.inventory_style,_e=le.style_photo_label,ue=le.style_photo_label_touch,de=le.touch_jump_button_colors
var fe=e("../glov/client/textures.js")
var ve=e("../glov/client/transition.js")
var he=e("../glov/client/ui.js")
var pe=e("../glov/common/util.js").merge
var me=e("./ui_util.js")
var ge=e("./user_data.js").isWaiting
var Ee=e("../glov/common/vmath.js"),ye=Ee.v2copy,Te=Ee.v3add,Ie=Ee.v3copy,Se=Ee.vec2,Ae=Ee.vec3,we=Ee.vec4,Le=Ee.unit_vec,Re=Ee.zero_vec
var xe=e("./voxel_chunk_manager.js").getKnownBounds
var Oe=e("./voxel_data.js")
var be=e("./world_comm.js").getWorldID
var Ne=e("./world_metadata.js").worldPhotoMove
var Ce=R
var Me=4/3
var De=(Ce-Me)/2
var Pe=512
var ke=128
var Be=60
var Ue=.2
var Ge=.92
r.DEFAULT_JPEG_QUALITY=Ge
var Fe=.02
var We=d/.75
var je=false
var He=null
var ze=false
var Ve=Ae()
var Ye=[Se(),Se(),Se()]
var qe=null
var Ke=null
var Ze
var Xe
var Qe=null
var Je={}
var $e={}
var et=false
var tt=false
var rt={in_event_cb:j.pointerLockEnter}
var at=false
var it=false
var ot=false
function photoModeActive(){return je}function getPhotoTime(){return Qe}function photoShowSelf(){return Xe}function getPhotoStartPosition(){return Ve}function getPhotoBounds(){return Ye}function shiftPhotoBounds(e){for(var t=0;t<Ye.length;t++){Ye[t][0]+=e[t]
Ye[t][1]+=e[t]}Te(Ve,Ve,e)}function errorModalDialog(e,t){he.modalDialog({title:e,text:String(t),buttons:{OK:null}})}function setImageUploadFalse(){ot=false}function validatePhotoCapture(e,t,r){if(e||be()!==t||!r){if(e)errorModalDialog(M.DLG_ERROR_IMAGE_UPLOAD_TITLE,e)
return ot=false}return true}function photoModeClear(){if(!je)return
if(et){et=false
$.pop()}je=false
Qe=Ke=qe=null
Ie(Ve,Re)
for(var e=0;e<Ye.length;e++)ye(Ye[e],Re)
_()
if(Je){for(var t in Je)setTimeout(Je[t].destroy.bind(Je[t]),1)
Je={}
$e={}}if(ze&&j.pointerLocked())j.pointerLockExit()}function photoModeCancel(){if(je)photoModeClear()}function photoModeInteractive(){return!qe}function photoCanMove(){return!at&&!qe}function photoCanMoveChar(){return photoCanMove()&&tt}function photoCanMovePht(){return photoCanMove()&&!tt}var nt=we(0,0,0,.85)
var st=we(0,0,0,.5)
function calcSourceParam(e,t){if(e/t>R){var r=R*t
return{x:(e-r)/2,y:0,w:r,h:t}}else{var a=e/R
return{x:0,y:(t-a)/2,w:e,h:a}}}function makeCaptureCanvas(e,t,r,a){var i=document.createElement("canvas")
i.width=a.w
i.height=a.h
i.getContext("2d").drawImage(t,r.x,r.y,r.w,r.h,0,0,a.w,a.h)
if(!Je[e]){Je[e]=fe.load({name:"photo_"+e,filter_min:gl.LINEAR,filter_mag:gl.LINEAR,wrap_s:gl.CLAMP_TO_EDGE,wrap_t:gl.CLAMP_TO_EDGE})
$e[e]=ie({tex:Je[e]})}Je[e].updateData(i.width,i.height,i)
return i}function doWaygateCapture(){m.clearAlpha()
G.startSpriteRendering()
ne(Z.FLOATERS_MAX)
var e=y()
var t=G.canvas
var r=calcSourceParam(e.width,e.height)
r.y+=t.height-e.height
var a={x:0,y:0,w:f,h:v}
var i={x:r.x+De*r.h,y:r.y,w:r.w-De*r.h*2,h:r.h}
var o={x:0,y:0,w:Pe,h:Pe}
var n={x:0,y:0,w:Pe,h:Pe}
var s={x:0,y:0,w:ke,h:ke}
var l=makeCaptureCanvas("full",t,r,a)
var c=makeCaptureCanvas("preview",t,i,o)
var _=makeCaptureCanvas("thumb",c,n,s)
var u=Ge
var d=(qe={full:{data:l.toDataURL("image/jpeg",u),w:a.w,h:a.h},preview:{data:c.toDataURL("image/jpeg",Ge),w:o.w,h:o.h},thumb:{data:_.toDataURL("image/png"),w:s.w,h:s.h}}).preview.data.length+qe.thumb.data.length
while(qe.full.data.length+d>We){if((u-=Fe)<0){errorModalDialog(M.DLG_ERROR_TAKING_PHOTO_TITLE,M.ERR_COULD_NOT_COMPRESS)
photoModeClear()
return}qe.full.data=l.toDataURL("image/jpeg",u)}et=false
$.pop()}function doScreenshotCapture(){m.clearAlpha()
G.startSpriteRendering()
ne(Z.FLOATERS_MAX)
var e=y()
var t=G.canvas
var r=calcSourceParam(e.width,e.height)
r.y+=t.height-e.height
var a={x:0,y:0,w:K(r.w),h:K(r.h)}
var i={x:0,y:0,w:f,h:v}
var o={x:0,y:0,w:ke,h:ke}
var n={x:(r.w-r.h)/2,y:r.y,w:r.h,h:r.h}
var s=makeCaptureCanvas("max",t,r,a)
var l=makeCaptureCanvas("card",t,r,i)
var c=makeCaptureCanvas("thumb",t,n,o)
Ke=s.toDataURL("image/png")
var _=Ge
var u=(qe={max:{data:s.toDataURL("image/jpeg",_),w:a.w,h:a.h},card:{data:l.toDataURL("image/jpeg",Ge),w:i.w,h:i.h},thumb:{data:c.toDataURL("image/png"),w:o.w,h:o.h}}).card.data.length+qe.thumb.data.length
while(qe.max.data.length+u>We){if((_-=Fe)<0){errorModalDialog(M.DLG_ERROR_TAKING_PHOTO_TITLE,M.ERR_COULD_NOT_COMPRESS)
photoModeClear()
return}qe.max.data=s.toDataURL("image/jpeg",_)}et=false
$.pop()}function photoModeConfirm(){O()
var e=20
var t=48
var r=G.font
var a=0
var i=0
var o=1e3
var n=a+o/2
var s=he.button_height
var l={x:s,y:i,z:Z.UI-5,w:o-2*s,h:he.button_height}
r.drawSizedAligned(ce,l.x,l.y,l.z+2,2*he.font_height,r.ALIGN.HVCENTERFIT,l.w,l.h,ze?M.LBL_CONFIRM_WG_IMAGES:M.LBL_PHOTO_TAKEN)
he.drawHBox(l,he.sprites.tab,Le)
var c=i+=he.button_height
var _=ze?$e.full:$e.max
var u=400
var d=R*u
_.draw({x:n-d/2,y:i,w:d,h:u})
i+=u+24
if(ze){var f=110
var v=Me*f
var h={x:n-v/2,y:i,w:v,h:f}
$e.thumb.draw(h)
i+=f+24
if(j.mouseOver(h)){var p=500
var m=Me*p
$e.preview.draw({x:n-m/2,y:i-p-24,w:m,h:p,z:Z.UI+5})
U.push()
U.setNormalized()
he.drawRect(0,0,1,1,Z.UI+4,[0,0,0,.75])
U.pop()}}i+=24
var g=q()
if(ze&&g){r.drawSizedAligned(ce,a,i,Z.UI+1,he.font_height,r.ALIGN.HCENTERFIT,d,0,M.ERR_WG_DEFAULT_VOXELS)
i+=he.font_height+8}var E=24
var y=(o-5*E)/3
var T=!window.FBInstant&&!ze
var I
if(ze)I=M.BTN_ACCEPT
else I=M.BTN_SAVE_PHOTO
if(he.buttonText({x:a+E,y:i,w:T?3*y+2*E:y,h:t,text:it?M.BTN_PROCESSING:I,disabled:it}))if(ze){ot=true
x(qe,ze,He)
photoModeClear()}else{D("pm_save_photo_button",1,"button")
ot=true
he.modalDialog({title:M.DLG_SAVING_PHOTO_TITLE,text:M.MSG_PLEASE_WAIT})
x(qe,ze,He)
photoModeClear()}if(T)if(he.buttonText({x:a+E,y:i+=t+E,w:y,h:t,text:M.BTN_DOWNLOAD})){D("pm_download_button",1,"button")
var S=document.createElement("a")
S.href=Ke
S.setAttribute("download","Worlds_FRVR_Photo.png")
S.click()}var A=!j.touch_mode?rt:null
if(he.buttonText({x:a+y+2*E,y:i,w:y,h:t,text:M.BTN_RETAKE_PHOTO,disabled:ze&&g,in_event_cb:A&&A.in_event_cb})){re()
Ke=qe=null
if(Je){for(var w in Je)setTimeout(Je[w].destroy.bind(Je[w]),1)
Je={}
$e={}}}if(he.buttonText({x:a+2*(y+E)+E,y:i,w:y,h:t,text:M.BTN_CANCEL,in_event_cb:A&&A.in_event_cb})){if(!ze)D("pm_cancel_button",1,"button")
photoModeClear()}var L=i+=t+E
he.panel({x:a-e,y:c-e,w:o+2*e,h:L-c+2*e,color:Q.panel_color})
b()}function clipboardGetPermission(e){var t
if(!(null!=(t=navigator.permissions)&&t.query))return void e()
var r=false
function onceNext(){if(r)return
r=true
e()}try{navigator.permissions.query({name:"clipboard-write"}).then(onceNext,onceNext)}catch(e){onceNext()}}function drawPhotoFlash(){j.pointerLockExit()
U.push()
U.setNormalized()
he.drawRect(0,0,1,1,Z.PHOTO_FLASH,Le)
U.pop()
ve.queue(Z.TRANSITION_FINAL,ve.fade(350))}function provideGlobalScreenshot(i){function singleTickPhotoFlash(){drawPhotoFlash()
G.removeTickFunc(singleTickPhotoFlash)}G.preSpriteRender(function(){G.startSpriteRendering()
if(!ge()&&be()&&!Q.active()&&!I())ne(Z.FLOATERS_MAX)
else oe()
var e=G.canvas
var t=y()
var r
if(je){(r=calcSourceParam(t.width,t.height)).y+=e.height-t.height
t={x:0,y:0,width:K(r.w),height:K(r.h)}}else r={x:0,y:G.canvas.height-t.height,w:t.width,h:t.height}
if(je||t.width!==e.width){(e=document.createElement("canvas")).width=t.width
e.height=t.height
e.getContext("2d").drawImage(G.canvas,r.x,r.y,r.w,r.h,0,0,t.width,t.height)}var a=be()?"world:"+be():"in_menu"
i(e,a)
G.addTickFunc(singleTickPhotoFlash)})}var lt=true
function copyCanvasToClipboard(){if(!lt)return
provideGlobalScreenshot(function(e,t){e.toBlob(function(t){clipboardGetPermission(function(){function onError(e){lt=false
Y.chat_ui.addChatError(M.$(M.CHATERROR_COPY_NOT_SUPPORTED,e))
console.error("Error copying to clipboard:",e)}try{var e=navigator.clipboard.write([new ClipboardItem({"image/png":t})])
if(e&&e.catch)e.catch(onError)}catch(e){onError(e)}})},"image/png")})}function copyToClipboardCheck(){if(!p()&&window.ClipboardItem&&j.keyDownEdge(j.KEYS.C)&&j.keyDown(j.KEYS.CTRL))copyCanvasToClipboard()}function fovCalc(e,t){var r=e*L(t/2)/w(t/2)
return 2*A(r/N(r*r+1))}function calculatePhotoFOV(e){var t=Ze*C/180
if(ze)if(0!==e){var r=fovCalc(Ce,t)
if(G.width>G.height)return fovCalc(G.height/G.width,r)
else return r}else i(G.width>G.height)
return t}function toggleShowSelf(){if(!(Xe=!Xe))tt=false}var ct
var _t
function photoModeTick(){it=F()||ot||ze&&q()
if(qe){photoModeConfirm()
return _t}var e=!j.touch_mode?rt:null
if(j.keyDownEdge(j.KEYS.F9,e))photoModeCancel()
if(at){if(j.keyDownEdge(j.KEYS.ESC,e))photoModeCancel()}else if(j.keyDownEdge(j.KEYS.ESC))at=true
var t={x:H()?z:U.w()-he.button_height-z,y:0,w:he.button_height,h:he.button_height}
var r=at?M.LBL_EXIT_MENU:M.LBL_MENU
var a=pe({z:Z.MENUBUTTON,img:me.sprite,frame:at?me.X:me.MENU,shrink:.7,colors:J.quickbar_colors_selected,disabled:false,tooltip:Q.prefixShortcutKey("E",r),in_event_cb:at?e&&e.in_event_cb:null},t)
j.drag(t)
if(!G.defines.NOUI&&he.buttonImage(a)||j.keyDownEdge(j.KEYS.E,e))if(at=!at)j.pointerLockExit()
var i=j.touch_mode?12:24
var o=8
var n=j.touch_mode?0:8
var s=j.touch_mode?50:he.font_height
var l=j.touch_mode?280:240
var c=j.touch_mode?120:48
var _={x:U.x1()-o-l,y:U.h()-i-c-(j.touch_mode&&!at?V:0),w:l,h:c,font_height:s,colors:de}
var u=false
if(!at){if(!G.defines.NOUI&&!ct)ct=se.get("photo_prompt").setMessage(M.STATUSMSG_CLICK_TAKE_PHOTO).noBounce().fade(Ue)
if(j.touch_mode&&!Y.chat_ui.isFocused())if(he.buttonText(pe({text:M.BTN_TAKE_PHOTO},_))){if(!ze)D("pm_take_photo_button",1,"button")
u=true}}else{if(ct){ct.remove()
ct=null}if(!Y.chat_ui.isFocused()){if(he.buttonText(pe({in_event_cb:e&&e.in_event_cb,text:M.BTN_EXIT_PHOTO_MODE},_))){photoModeCancel()
return _t}if(Ne()){_.y-=n+c
if(he.buttonText(pe({text:Xe?M.BTN_HIDE_SELF:M.BTN_SHOW_SELF},_)))toggleShowSelf()
_.y-=n+c
if(he.buttonText(pe({text:tt?M.BTN_CONTROLLING_PLAYER:M.BTN_CONTROLLING_CAMERA,disabled:!Xe},_)))tt=!tt}_.y-=n+c
if(he.buttonText(pe({text:M.BTN_TAKE_PHOTO},_)))u=true
var d=j.touch_mode?20:8
var f=j.touch_mode?280:240
var v=he.button_height
var h=j.touch_mode?ue:_e
var p=j.touch_mode?70:he.font_height
var m=12
var g=j.touch_mode?0:8
var E=f-2*m
var y=p
var T=p+g+v+d
var I=U.x1()-o-l
var S=j.touch_mode?(H()?0:he.button_height)+d+T+p+g:_.y-d-v
var A=I+m
var w=j.touch_mode?(H()?0:he.button_height)+d+T:S-g-p
he.font.drawSizedAligned(h,A,w,Z.UI,p,he.font.ALIGN.HLEFT,E,y,M.addColon(j.touch_mode?M.LBL_FIELD_OF_VIEW_SHORT:M.LBL_FIELD_OF_VIEW))
var L=Ze
var R=K(te(L,{x:I,y:S,min:40,max:100,w:f,h:v}))
he.font.drawSizedAligned(h,A,w,Z.UI,p,he.font.ALIGN.HRIGHT,E,y,""+R)
if(R!==L)Ze=R
S-=T
he.font.drawSizedAligned(h,A,w-=T,Z.UI,p,he.font.ALIGN.HLEFT,E,y,M.addColon(M.LBL_TIME_OF_DAY_SHORT))
var x=60*Qe
var O=K(te(x,{x:I,y:S,min:0,max:1439,w:f,h:v}))
he.font.drawSizedAligned(h,A,w,Z.UI,p,he.font.ALIGN.HRIGHT,E,y,""+X(O/60))
if(O!==x)Qe=O/60}}if(j.keyDownEdge(j.KEYS.V)&&Ne())toggleShowSelf()
var b=k()
if(b)at=false
if(b&&!B()&&(j.click({button:0})||j.keyDownEdge(j.KEYS.R))){u=true
if(!ze)D("pm_take_photo_button",1,"button")}if(et){W()
if(ze)Y.postTick(doWaygateCapture)
else Y.postTick(doScreenshotCapture)
drawPhotoFlash()
if(ct){ct.remove()
ct=null}}else if(u){$.push({render_scale:1,bevel:1})
et=true}var N=calcSourceParam(U.wReal(),U.hReal())
if(0!==N.x){he.drawRect(U.x0Real(),U.y0Real(),U.x0Real()+N.x,U.hReal(),Z.PHOTO_BORDER,nt)
he.drawRect(U.x0Real()+N.x+N.w,U.y0Real(),U.wReal(),U.hReal(),Z.PHOTO_BORDER,nt)}if(0!==N.y){he.drawRect(U.x0Real(),U.y0Real(),U.wReal(),U.y0Real()+N.y,Z.PHOTO_BORDER,nt)
he.drawRect(U.x0Real(),U.y0Real()+N.y+N.h,U.wReal(),U.hReal(),Z.PHOTO_BORDER,nt)}if(ze){var C=De*N.h
he.drawRect(U.x0Real()+N.x,U.y0Real()+N.y,U.x0Real()+N.x+C,U.y0Real()+N.y+N.h,Z.PHOTO_BORDER,st)
he.drawRect(U.x0Real()+N.x+N.w-C,U.y0Real()+N.y,U.x0Real()+N.x+N.w,U.y0Real()+N.y+N.h,Z.PHOTO_BORDER,st)}_t=calculatePhotoFOV(N.y)
P()
return _t}function photoCapture(e,t){je=true
at=false
ct=Ke=qe=null
Ie(Ve,S())
for(var r=0;r<Ye.length;r++){Ye[r][0]=(xe()[r][0]-Oe.origin_chunk[r]+2)*h
Ye[r][1]=(xe()[r][1]-Oe.origin_chunk[r]-1)*h}ze=e
He=t
Qe=ee()
_t=(Ze=Be)*C/180
if(l()!==s)c()
if(ze||!Ne())Xe=false
else Xe=Y.char_controller.zoomed_out_tpv||$.camera_view&&!Y.char_controller.zoomed_in_fpv
tt=false
Y.pht_controller.getParamsFromController(Y.char_controller)
u()}},{"../common/globals.js":197,"../common/photo_common.js":204,"../glov/client/camera2d.js":241,"../glov/client/edit_box.js":248,"../glov/client/effects.js":249,"../glov/client/engine.js":250,"../glov/client/framebuffer.js":261,"../glov/client/input.js":271,"../glov/client/settings.js":291,"../glov/client/slider.js":294,"../glov/client/spot.js":300,"../glov/client/sprites.js":302,"../glov/client/textures.js":304,"../glov/client/transition.js":305,"../glov/client/ui.js":306,"../glov/common/chunked_send.js":316,"../glov/common/util.js":330,"../glov/common/vmath.js":332,"./analytics.js":5,"./build_mode.js":27,"./camera.js":28,"./file_management.js":82,"./layout.js":99,"./loading_custom.js":105,"./localization/localization":108,"./main.js":112,"./menu.js":117,"./quickbar.js":142,"./sky.js":151,"./status.js":156,"./styles.js":160,"./ui_util.js":168,"./user_data.js":170,"./voxel_chunk_manager.js":174,"./voxel_data.js":175,"./world_comm.js":182,"./world_metadata.js":186,assert:void 0}],129:[function(e,t,r){"use strict"
r.photoIdValid=photoIdValid
r.photoViewGetTitle=photoViewGetTitle
r.photoViewInit=photoViewInit
r.doPhotoView=doPhotoView
function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]
for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))e[a]=r[a]}return e}).apply(this,arguments)}var a=e("../glov/client/environments")
var D=a.getExternalTextureURL
var P=a.getLinkBase
var k=e("./localization/localization").L
var B=e("./account_ui.js").formatUserID
var i=e("../glov/client/cmds.js").cmd_parse
var U=e("../glov/client/engine.js")
var G=e("../glov/client/social.js").getUserProfileImage
var o=e("./fbinstant_worlds.js"),F=o.fbSharePhoto,W=o.fbSharePhotoLink
var j=e("../glov/client/input.js")
var n=e("./layout.js"),H=n.PHOTOUI_BORDER_PAD,z=n.PHOTOUI_FRAME_PAD,V=n.PHOTOUI_SHADOW_OFFSET,Y=n.PHOTOUI_USERBUTTON_H,q=n.PHOTOUI_WG_H,K=n.UIVIEWS_BUTTON_W,X=n.UIVIEWS_BUTTON_H,Q=n.UIVIEWS_CONTENT_PAD
var s=e("./main.js")
var J=s.menuExit
var $=e("./main_menu.js").getWorldInfo
var l=e("./menu.js")
var ee=l.menuX1,te=l.menuY1
var re=e("../glov/client/net.js").netSubs
var ae=e("./photo_mode.js").PHOTO_ASPECT
var ie=e("../glov/client/sprites.js").spriteCreate
var oe=e("./styles.js")
var c=e("./styles.js"),ne=c.color_photo_frame_shadow,se=c.color_white,le=c.label_style,ce=c.loading_style,_e=c.menu_header_style,ue=c.sublabel_style
var de=e("../glov/client/textures.js")
var fe=e("../glov/client/ui.js")
var ve=e("../glov/common/util.js").dateToSafeLocaleString
var _=e("../glov/client/urlhash.js")
var u=e("./user_info_view.js"),he=u.viewUser,pe=u.userInfoGet,me=u.userInfoViewing
var d=e("./waygate_ui.js"),ge=d.calcWGLinkWidth,Ee=d.waygateLinkUI
var ye=e("./world_comm.js").worldGoByURL
var Te="$deleted"
var f=/^[A-Z0-9]+$/
var Ie
var Se
var Ae=null
var we
function photoIdValid(e){return e&&e.match(f)}function photoViewGetTitle(){return Ie}function photoViewInit(e){we=Ae=Se=null
if(e&&photoIdValid(e))Se=e}function doPhotoView(){var e=0
var t=ee()
var r=fe.button_height
var a=te()
var i=Z.UI
var o=t-e
var n=a-r
var s=U.font
var l=.75*fe.font_height
var c=1.5*fe.font_height
var _=2*fe.font_height
var u=e
var d=r
Ie=k.PHOTOTITLE_LOADING
if(!Ae)Ae=re().getChannelImmediate("photo."+Se).getChannelData("public")
var f=Ae&&0===Object.keys(Ae).length
if(!Se||f||(null==Ae?void 0:Ae.owner_id)===Te){s.drawSizedAligned(ce,e,r,i,fe.font_height,s.ALIGN.HVCENTER,o,2*n/3,k.PHOTOMSG_ID_INVALID)
Ie=k.PHOTOTITLE_ERROR
return}if(!Ae){s.drawSizedAligned(ce,e,r,i,fe.font_height,s.ALIGN.HVCENTER,o,2*n/3,k.PHOTOMSG_LOADING)
Ie=k.PHOTOTITLE_LOADING
return}if(!we){var v=de.load({url:Ae.img.card.url,wrap_s:gl.CLAMP_TO_EDGE,wrap_t:gl.CLAMP_TO_EDGE})
we=ie({tex:v})}var h=$(Ae.world_id,false)
d+=H
var p=o-2*H-2*z
var m=p/ae
var g=p+2*z
var E=m+2*z
fe.drawRect(u+H+V,d+V,u+H+g+V,d+E+V,i+1,ne)
fe.drawRect(u+H,d,u+H+g,d+E,i+2,se)
d+=z
we.draw({x:u+H+z,y:d,z:i+3,w:p,h:m})
d+=m+z+V+2*Q
var y=pe(Ae.owner_id)
var T=B(y.user_id,y.display_name)
Ie=k.$(k.PHOTOTITLE_AUTHOR,T)
var I=o-Y-Q
var S=u+(I+U.font.drawSizedAligned(le,u,d,i+1,_,s.ALIGN.HCENTERFIT,I,0,Ie))/2+Q
if(fe.buttonImage(_extends({x:S,y:d,z:i+1,w:Y,h:Y,colors:me(Ae.owner_id)?oe.colors_user_selected:null},G(Ae.owner_id))))he({x:S,y:d,user_id:Ae.owner_id})
d+=Y+Q
s.drawSizedAligned(le,u,d,i+1,fe.font_height,s.ALIGN.HCENTERFIT,o,0,k.separateColon(k.LBL_CREATED,ve(new Date(Ae.created))))
d+=fe.font_height+2*Q
if(fe.buttonText({x:u+o/2-K-Q,y:d,w:K,h:X,z:i+2,text:window.FBInstant?k.BTN_SHARE:k.BTN_DOWNLOAD}))if(window.FBInstant)F(Se,Ae.img.card.url)
else{var A=document.createElement("a")
A.href=D(Ae.img.max.url)
A.target="_blank"
A.setAttribute("download","Worlds_FRVR_Photo.jpg")
A.click()}if(fe.buttonText({x:u+o/2+Q,y:d,w:K,h:X,z:i+2,text:k.BTN_GET_LINK}))if(window.FBInstant)W(Se,Ae.img.card.url)
else fe.provideUserString(k.DLG_SHARE_TITLE,P()+"photo/"+Se)
d+=X+H
var w=ge(q)
var L=o/2
var R=u+L/2+w/2+2*Q
var x=d+q/2-c/2-l
var O=U.font.drawSizedAligned(ue,R,x,i+1,l,s.ALIGN.HCENTERFIT,L,0,k.addColon(k.LBL_LOCATION))
var b=fe.title_font.drawSizedAligned(_e,R,x+=l,i+1,c,s.ALIGN.HCENTERFIT,L,0,(null==h?void 0:h.name)||k.LBL_UNKNOWN_WORLD_NAME)
var N=h&&!h.err?Ae.world_id:k.LBL_UNKNOWN_WORLD_ID
var C=U.font.drawSizedAligned(ue,R,x+=c,i+1,l,s.ALIGN.HCENTERFIT,L,0,k.$(k.LBL_NUMBERED_WORLD,N))
var M=Math.max(O,b,C)
if(Ee({x:u+o/2-w/2-M/2-Q,y:d,z:i+2,h:q,target:{wid:Ae.world_id},style:"preview",no_overlay:!h||h.err,disabled:!h||h.err,in_event_cb:j.pointerLockEnter,url:"w/"+Ae.world_id,ctx:"photo"})){J()
ye(Ae.world_id,void 0)}}i.register({cmd:"photo_view",help:"View photo details",func:function func(e,t){_.set("photo",e)
s.toggleMenuPage(l.PHOTO_VIEW,e)
t()}})},{"../glov/client/cmds.js":244,"../glov/client/engine.js":250,"../glov/client/environments":254,"../glov/client/input.js":271,"../glov/client/net.js":279,"../glov/client/social.js":296,"../glov/client/sprites.js":302,"../glov/client/textures.js":304,"../glov/client/ui.js":306,"../glov/client/urlhash.js":307,"../glov/common/util.js":330,"./account_ui.js":3,"./fbinstant_worlds.js":80,"./layout.js":99,"./localization/localization":108,"./main.js":112,"./main_menu.js":113,"./menu.js":117,"./photo_mode.js":128,"./styles.js":160,"./user_info_view.js":171,"./waygate_ui.js":179,"./world_comm.js":182}],130:[function(e,t,r){"use strict"
r.getPlatformWorldShareLink=getPlatformWorldShareLink
r.worlds_msstart_url=void 0
var a=e("../glov/client/client_config").PLATFORM_MSSTART
var i=e("../glov/client/environments").getLinkBase
var o="https://www.msn.com/en-us/play/worlds-frvr/cg-9nxnk46xdk4h"
r.worlds_msstart_url=o
function getPlatformWorldShareLink(e,t){if(void 0===t)t="default"
return a?o+"?msstart3pp="+escape(JSON.stringify({wg:t,w:e})):i()+"w/"+e+("default"===t?"":"/"+t)}},{"../glov/client/client_config":243,"../glov/client/environments":254}],131:[function(e,t,r){"use strict"
r.create=create
function FastPriorityQueue(){this.array=[]
this.size=0}FastPriorityQueue.prototype.add=function(e){var t=this.size
this.array[this.size]=e
this.size+=1
var r
var a
while(t>0){a=this.array[r=t-1>>1]
if(e.score>=a.score)break
this.array[t]=a
t=r}this.array[t]=e}
FastPriorityQueue.prototype._percolateUp=function(e,t){var r=this.array[e]
var a
var i
while(e>0){i=this.array[a=e-1>>1]
if(!t&&!(r.score<i.score))break
this.array[e]=i
e=a}this.array[e]=r}
FastPriorityQueue.prototype._percolateDown=function(e){var t=this.size
var r=this.size>>>1
var a=this.array[e]
var i
var o
var n
while(e<r){n=this.array[i=1+(e<<1)]
if((o=i+1)<t)if(this.array[o].score<n.score){i=o
n=this.array[o]}if(!(n.score<a.score))break
this.array[e]=n
e=i}this.array[e]=a}
FastPriorityQueue.prototype._removeAt=function(e){if(e>this.size-1||e<0)return
this._percolateUp(e,true)
return this.pop()}
FastPriorityQueue.prototype.remove=function(e){for(var t=0;t<this.size;t++)if(this.array[t]===e){this._removeAt(t)
return true}return false}
FastPriorityQueue.prototype.pop=function(){if(0===this.size)return
var e=this.array[0]
if(this.size>1){this.array[0]=this.array[--this.size]
this._percolateDown(0)}else--this.size
return e}
function create(){return new FastPriorityQueue}},{}],132:[function(e,t,r){"use strict"
r.setFlatOreType=setFlatOreType
r.getFlatOreType=getFlatOreType
r.seedWorld=seedWorld
r.onZMap=onZMap
r.renderDetail=renderDetail
r.oreLowestStoneTier=oreLowestStoneTier
r.oreFromChunkPos=oreFromChunkPos
r.stoneTierFromPos=stoneTierFromPos
r.deepestOreFromWorldPos=deepestOreFromWorldPos
r.handleHexomeChoices=handleHexomeChoices
r.gen=gen
r.startup=startup
r.getVerticalSliceMapData=r.initPhase40=void 0
var Ee=e("assert")
var n=e("../glov/client/rand_fast").randSimpleSpatial
var a=e("../glov/common/rand_alea").mashString
var i=e("../glov/common/util")
var Q=i.clamp
var J=i.lerp
var s=i.mod
var o=e("../glov/common/vmath")
var l=o.ivec3
var $=o.unit_vec
var c=o.v2distSq
var _=o.v2normalize
var u=o.v2sub
var d=o.v3addScale
var f=o.v3copy
var ye=o.v3set
var v=o.vec1
var h=o.vec2
var E=o.vec3
var p=o.vec4
var m=e("../common/globals")
var Te=m.CHUNK_SIZE
var Ie=m.CS2
var g=m.ID2
var y=m.ID_FACTOR
var T=m.MEGACHUNK_SIZE
var I=e("../common/materials_common").Mat
var S=e("../common/voxel_data_common")
var Se=S.VoxelDataBase
var A=S.ZMAP_UNDERGROUND
var w=S.ZMAP_UNKNOWN
var L=S.ZMap
var Ae=S.voxel_data_mem_tracker
var R=e("./biome_details")
var x=e("./continent").continentSeed
var O=e("./line2d").ptLineDistSq
var ee=e("./proc_gen_biomes")
var b=e("./proc_gen_biomes")
var we=b.biome_noise
var te=b.calcBlendWeightsVS
var N=b.choiceDataSet
var C=b.getElevationEstimate
var re=b.getParam
var Le=b.getVerticalSlice
var ae=b.getVerticalSliceById
var M=b.getVerticalSliceWorldPos
var Re=b.initPhase60
var xe=b.worldStoneType
var ie=b.world_noise
var D=e("./proc_gen_constants")
var Oe=D.PROP_1x1x1
var oe=D.SNOW_ELEVATION
var ne=D.SNOW_VARIATION
var P=e("./proc_gen_details")
var k=P.detailGenGetHighest
var be=P.detailGenLocal
var B=P.detailGenSeed
var U=P.detailStartup
var G=e("./proc_gen_hydro")
var se=e("./proc_gen_hydro").initPhase37
var F=e("./proc_gen_shared")
var Ne=F.intNoise
var Ce=F.phase_counts
var Me=F.phase_timing
var De=e("./rand_seed")
var W=e("./stone_tiers")
var j=W.ORE_DISTRO
var H=W.ORE_FREQ
var z=W.STONE_TIER_DEPTH
var V=W.STONE_TIER_DISTRO
var Y=e("./tiles")
var q=Y.TILE_INTANGIBLE
var K=Y.TILE_NON_OPAQUE
var Pe=Y.TILE_PROP_BASE
var le=Y.TILE_SNOW
var Z=Y.TILE_STONE
var ke=Y.TILE_WATER
var ce=Math.ceil,X=Math.floor,_e=Math.max,Be=Math.min,ue=Math.PI,de=Math.round,fe=Math.sqrt,ve=Math.tan,he=Math.atan2
var pe=10
var me=1
var ge=3
var Ue=20
var Ge=.05
var Fe=.2
var We=1.57
var je=110
var He=.005
var ze=.01
var Ve
var Ye=true
var qe
var Ke=I.GOLD
function setFlatOreType(e,t){Ke=e
null==t||t()}function getFlatOreType(){return Ke}function seedWorld(e){Ye="flat"===e.world_type
qe=a("ore"+e.seed)
ee.seedWorld(e)
R.seedWorld(e)
G.seedWorld(e)
x(e)
B(e)
Ve={}}var Ze=3e4
var Xe
function cleanupExtraChunks(){profilerStart("cleanupExtraChunks")
Xe=null
var e=Date.now()-Ze
var t=true
for(var r in Ve)if(Ve[r].alloc_time<e)delete Ve[r]
else t=false
if(!t)extraChunkCleanupSchedule()
profilerStop("cleanupExtraChunks")}function extraChunkCleanupSchedule(){Xe=setTimeout(cleanupExtraChunks,Ze/2)}function seedPlants(e){return e.seed+1007}var Qe=-3
var Je=10
var $e=.1
var et=-1
var tt=-1
var rt=function(){var m=E()
var g=[]
return function pathDistFn(e,t){var r=-Infinity
var a=0
var i=0
var o=0
et=tt=-1
for(var n=0;n<t.length;++n){var s=t[n]
for(var l=0;l<s.length-1;++l){var c=g[o]
if(!c)c=g[o]=E()
var _=s[l]
var u=s[l+1]
O(c,_,u,e)
var d=J(c[0],_[4],u[4])
c[1]=d-fe(c[1])
if(c[1]>r){r=c[1]
a=c[2]=J(c[0],_[2],u[2])
i=d;++o
et=n
tt=l}else if(c[1]>r-Je){c[2]=J(c[0],_[2],u[2]);++o}}}if(o&&r<Qe){var f=a=0
var v=r-Je
while(o){var h=g[--o]
var p=h[1]-v
if(p>0){a+=(p*=$e)*h[2]
f+=p}}a/=f}ye(m,r,a,i)
return m}}()
var at=function(){var n=p()
var s=h()
return function pathDirfn(e,t){if(-1===et)return n
var r=t[et]
var a=r[tt]
var i=r[tt+1]
var o=c(a,e)
u(s,i,a)
_(s,s)
n[0]=he(s[0],s[1])
n[1]=o
n[2]=a[0]
n[3]=a[1]
return n}}()
var it=.5*(We-Fe)
var ot=.5*(Fe+We)
var nt=function(){var z=h()
var V=E()
var Y=v()
var q=[0,1,y,y+1]
var K=new Array(Te*Te)
var Z=new Array(Te*Te)
var X={}
X.pos_world=h(0,0)
X.dir=h(0,0)
return function initPhase40fn(e){if(e.phase>=40)return;++Ce[40]
var t=Date.now()
e.phase=40
var r=[]
for(var a=0;a<e.hexomes_cont_mid.length;++a){var i=e.hexomes_cont_mid[a]
se(i)
if(i.hydro_paths)r=r.concat(i.hydro_paths)}var o={}
var n=0
for(var s=0;s<q.length&&n<=1;++s){var l=ae(e.vsid+q[s]).origin_hexomes
for(var c=0;c<l.length;++c){var _=l[c]
if(o[_.uid])continue
o[_.uid]=true
n++}}if(1===n){Ee.equal(e.origin_hexomes.length,1)
e.hexomes=e.origin_hexomes
e.blend_primary_hexome=e.hexomes[0]
e.blend_weights=$
e.hexomes_noisy=e.origin_hexomes
e.blend_primary_hexome_noisy=e.hexomes_noisy[0]
e.blend_weights_noisy=$
e.single_hexome=true}var u=e.blend_primary_hexome.water_level
Ee(!e.map)
e.map=new Array(Te)
e.max_z=-Infinity
e.max_solid_z=-Infinity
var d=0
for(var f=0;f<Te;++f){z[1]=f
var v=e.map[f]=new Array(Te)
for(var h=0;h<Te;++h){var p=v[z[0]=h]={}
te(e,z,true)
K[d]=e.blend_primary_hexome_noisy.params.local_func
var m=e.blend_pos_world
var g=de(ee.getElevation(e))
p.h=g
p.base=e.last_base_elevation
p.surface=re(e,null,"surface",true)
var E=_e(0,de(re(e,Y,"surface_depth",true)[0]))
p.ground=re(e,null,"ground",false)
re(e,V,"ground_depth",true)
var y=.5+.5*ie[3].noise2D(m[0]*ze,m[1]*ze)
var T=.5+.5*ie[3].noise2D(m[0]*Ge,m[1]*Ge)
var I=oe+T*ne
if(p.h>I){p.surface=le
E=me+de(ge*Be(1,(p.h-I)/Ue))}p.surface_h=g-E
p.ground_h=p.surface_h-_e(0,de(V[0]+V[1]*y))
p.water_level=u
var S=rt(m,r)
var A=p.hydro_pen=S[0]
var w=ot+it*ie[4].noise2D(m[0]*He,m[1]*He)
var L=0
if(A>0){var R=1-Be(A/15,1)
w=R*w+(1-R)*Fe}else{L=Q(-A/je*1.2-.2,0,1)
w=J(L,w,We)}var x=ve(w)
var O=ce(A*x)
var b=de(S[1])-1
var N=_e(b,u)
var C=N-O
var M=Z[d]=void 0
if(e.blend_primary_hexome_noisy.river_mouth){var D=at(m,r)
X.pos_world=m
X.dir=D
var P=_e(60-2*(p.surface_h-u),0)
if(M=Q(P/60,0,1)){var k=M
if(M<.5)k=0
var B=12
var U=Q(S[2]-A,0,B)/B
var G=k*ee.riverDeltaHeight(X)
C=de(_e(G*=U,-1)+(N-O*(1.1-M)))}}if(O>=0){if(N>u){p.water_level=N
p.h=C}else if(p.h>C){p.h=C
if(e.blend_primary_hexome_noisy.river_mouth&&M)Z[d]=ee.riverDeltaSmoothNoise}}else{if(-(A+.5)<pe)if(e.blend_primary_hexome_noisy.river_mouth&&M)Z[d]=ee.riverDeltaSmoothNoise
w=J(L,w=.25*(w+3*ue/4),We)
var F=ve(w)
var W=Be(b,de(b+1+(A+.5)*F))
if(p.h<W&&N>u)p.h=W
else if(C<p.h)p.h=C}e.max_z=_e(e.max_z,p.water_level,p.h)
e.max_solid_z=_e(e.max_solid_z,p.h)
d++}}for(var j=d=0;j<Te;++j)for(var H=0;H<Te;++H){if(K[d])K[d](e,H,j)
if(Z[d])Z[d](e,H,j)
d++}e.max_z++
e.max_solid_z++
Me[40]+=Date.now()-t}}()
r.initPhase40=nt
var st
function onZMap(e){st=e}function renderDetail(e){if(!e.rendered){e.rendered=true
e.vd=e.detail_type.gen(e)
Ee(e.vd)
f(e.size,e.vd.size)}}var lt=function(){var r=h()
return function getVerticalSliceMapDataFn(e){var t=M(e)
u(r,e,t.pos_world)
nt(t)
return t.map[r[1]][r[0]]}}()
r.getVerticalSliceMapData=lt
function oreLowestStoneTier(e){var t=j.indexOf(e)
if(-1===t)return-1
for(var r=0;r<V.length;++r)if(-1!==V[r][1].indexOf(t)){var a=V[r][0]
if(a<0)return 0
var i=z.indexOf(a)
Ee(-1!==i)
return i+1}return-1}var ct=E()
var _t=E(Te/2,Te/2,0)
function oreFromChunkPos(e){if(Ye){if(-1===Ke)return j[s(e[0]+e[1]+e[2],j.length-1)+1]
return Ke}var t=n(qe,de(e[0]*H),de(e[1]*H),0)
d(ct,_t,e,Te)
var r=C(ct)-ct[2]
var a=0
while(r>V[a+1][0])++a
var i=V[a][1]
var o=X(t*i.length)
if(o===i.length)--o
return j[i[o]]}function stoneTierFromPos(e){if(Ye)return 0
var t=C(e)-e[2]
var r=0
while(t>=z[r])++r
return r}function deepestOreFromWorldPos(e){var t=stoneTierFromPos(e)
var r=0
for(var a=0;a<=t;++a){var i=V[a][1]
for(var o=0;o<i.length;++o)r=r<i[o]?i[o]:r}return r}function liquidStableEstimate(e){var r=e.data,a=e.liquid
function solid(e){if(a[e])return true
var t=r[e]
if(t&&t<q)return true
return false}var t=0
for(var i=0;i<16;++i)for(var o=0;o<16;++o)for(var n=0;n<16;++n,++t){if(!a[t])continue
if(n>0&&!solid(t-1))return false
if(n<15&&!solid(t+1))return false
if(o>0&&!solid(t-16))return false
if(o<15&&!solid(t+16))return false
if(i>0&&!solid(t-256))return false}return true}function handleHexomeChoices(e){for(var t=0;t<e.length;++t){var r=e[t]
for(var a in r)N(a,r[a])}}function liquidQuickUpdate(e){var t=e.data
var r=e.liquid
if(!t||!r)return
for(var a=0;a<Te;++a)for(var i=0;i<Te;++i){var o=i+a*Te
var n=-1
for(var s=0;s<Te;++s){var l=o+s*Ie
if(r[l]){if(-1!==n){r[n]=r[l]
r[l]=0
n+=Ie}}else if(!t[l]){if(-1===n)n=l}else n=-1}}}function topTile(e){if(e.h>e.surface_h)return e.surface
if(e.h>e.ground_h)return e.ground
return Z}var ut=function(){var me=E()
var ge=De.createFast(0)
return function initPhase90fn(e){var t=Date.now();++Ce[90]
var r=new Se(e.pos[0],e.pos[1],e.pos[2],e.chunk_id,null,Ae)
var a=r.pos_world
var i=Le(r.pos)
Re(i)
var o=a[2]
ge.reseed(r.chunk_id+i.seed)
if(o<=i.max_z){var n=false
var s=o+Te
var l=i.map
var c=true
var _=true
Ee(!r.data)
var u=null
for(var d=0;d<Te;++d){var f=l[d]
for(var v=0;v<Te;++v){var h=f[v]
var p=h.h,m=h.surface,g=h.surface_h,E=h.ground,y=h.ground_h,T=h.water_level
if(o>p&&o>T){if(o===p+1)n=true
_=c=false
continue}if(s>=p)n=true
if(!u){r.alloc()
u=r.data}if(T>p)if(!r.liquid)r.alloc(true)
var I=d*Te+v
for(var S=0;S<Te;++S){var A=o+S
if(A>p&&A>T){_=c=false
break}var w=void 0
var L=false
if(A>p){w=ke
L=true
c=false}else if(A>g)w=m
else if(A>y)w=E
else{var R=ge.random()
w=xe(a[0]+v,a[1]+d,A+5*R-2.5)}if(L)r.liquid[I]=w
else u[I]=w
I+=Ie}}}if(n){var x=i.plants
var O=De.createGood(seedPlants(i))
for(var b=0;b<x.length;++b){var N=x[b],C=N.weight,M=N.plant
var D=M.id,P=M.freq,k=M.over,B=M.chance,U=M.offs,G=M.attr1,F=M.attr2,W=M.attr3_list,j=M.size
if(!j)j=Oe
var H=M.min
var z=M.max
var V=H+Ne(we[0],i.pos_world,P,U,z-H+1)
if(V<=0)continue
B*=C
var Y=j[0]
var q=j[1]
var K=j[2]
e:for(var Z=0;Z<V;++Z){if(O.random()>B)continue
var X=O.range(Te-Y+1)
var Q=O.range(Te-q+1)
var J=O.range(4)
var $=W?W[O.range(W.length)]:void 0
var ee=Infinity
for(var te=0;te<q;++te)for(var re=0;re<Y;++re){var ae=l[Q+te][X+re].h
ee=Be(ee,ae)}if(ee<o-1||ee+K>=s)continue
if(!(X&&l[Q][X-1].h===ee||Q&&l[Q-1][X].h===ee||X<Te-Y&&l[Q][X+Y].h===ee||Q<Te-q&&l[Q+q][X].h===ee))continue
ee++
if(!u){r.alloc()
u=r.data}ye(me,X,Q,ee-o)
var ie=me[2]*Ie+me[1]*Te+me[0]
for(var oe=0;oe<K;++oe)for(var ne=0;ne<q;++ne)for(var se=0;se<Y;++se){var le=ie+se+ne*Te+oe*Ie
if(u[le]||r.liquid&&r.liquid[le])continue e}for(var ce=0;ce<q;++ce)for(var _e=0;_e<Y;++_e)if(topTile(l[Q+ce][X+_e])!==k)continue e
if(!r.props)r.props={}
r.props[ie]={id:D,rot:J,attr1:G,attr2:F,attr3:$,size:j}
for(var ue=0;ue<K;++ue)for(var de=0;de<q;++de)for(var fe=0;fe<Y;++fe)u[ie+fe+de*Te+ue*Ie]=Pe+fe+de+ue}}}r.full=c
if(r.liquid)r.liquid_stable=_||liquidStableEstimate(r)}be({vd:r,vs:i,non_spatial_rand:ge})
var ve=r.props
if(ve)for(var he in ve){var pe=ve[he]
Ee(pe.size)
Ee(pe.size[0]&&pe.size[1]&&pe.size[2])
pe.proc_genned=true}if(r.liquid)liquidQuickUpdate(r)
Me[90]+=Date.now()-t
return r}}()
var dt=l()
function calcZMap(e,t){++Ce.zm
var r=Date.now()
var a=new L
var i=a.data
var o=e.max_solid_z
dt[0]=e.pos_world[0]
dt[1]=e.pos_world[1]
dt[2]=o
o=_e(o,k(dt))
var n=X((o+Te-1)/Te)
var s=X(e.max_solid_z/Te)-8
var l={}
var c=(l[t.pos[2]]=t).pos[0]+t.pos[1]*y
for(var _=0;_<Ie;++_){var u=w
e:for(var d=n;d>s;--d){var f=l[d]
if(!f){f=l[d]=ut({pos:[t.pos[0],t.pos[1],d],chunk_id:c+d*g});(Ve[f.chunk_id]=f).alloc_time=r
if(!Xe)extraChunkCleanupSchedule()}var v=f.data
if(!v)continue
for(var h=Te-1;h>=0;--h){var p=v[_+h*Ie]
if(!p)continue
if(p<=K){u=d*Te+h
break e}}}i[_]=u}st(e.vsid,a)
Me.zm+=Date.now()-r}function gen(e){var t=Ve[e.chunk_id]
if(t){delete Ve[e.chunk_id]
return t}var r=Date.now();++Ce[100]
t=ut(e)
if(st&&!e.has_zmap){var a=Le(t.pos)
if(!a.have_zmap)if(t.pos[2]>a.max_solid_z/Te+T/2);else if(t.pos[2]>a.max_solid_z/Te-T/2){a.have_zmap=true
calcZMap(a,t)}else if(!a.have_zmap_prelim){a.have_zmap_prelim=true
st(a.vsid,A)}}Me[100]+=Date.now()-r
return t}function startup(){ee.startup()
U()}},{"../common/globals":197,"../common/materials_common":201,"../common/voxel_data_common":209,"../glov/client/rand_fast":288,"../glov/common/rand_alea":327,"../glov/common/util":330,"../glov/common/vmath":332,"./biome_details":19,"./continent":37,"./line2d":101,"./proc_gen_biomes":133,"./proc_gen_constants":134,"./proc_gen_details":136,"./proc_gen_hydro":137,"./proc_gen_shared":138,"./rand_seed":145,"./stone_tiers":157,"./tiles":162,assert:void 0}],133:[function(r,e,o){"use strict"
o.setLODMode=setLODMode
o.procGenDoLODs=procGenDoLODs
o.riverDeltaHeight=riverDeltaHeight
o.riverDeltaSmoothNoise=riverDeltaSmoothNoise
o.flushVerticalSlices=flushVerticalSlices
o.worldStoneType=worldStoneType
o.sampleUniformNoise3D=sampleUniformNoise3D
o.seedWorld=seedWorld
o.choiceDataSet=choiceDataSet
o.onHexomeChoice=onHexomeChoice
o.getHexome=getHexome
o.getHexomeExact=getHexomeExact
o.getContinentIDsForPos=getContinentIDsForPos
o.BlendWeightContext=BlendWeightContext
o.calcBlendWeightsVS=calcBlendWeightsVS
o.VerticalSlice=VerticalSlice
o.getVerticalSliceById=getVerticalSliceById
o.getVerticalSlice=getVerticalSlice
o.getVerticalSliceWorldPos=getVerticalSliceWorldPos
o.getParam=getParam
o.getElevationEstimate=getElevationEstimate
o.getChunkTintColor=getChunkTintColor
o.initPhase60=initPhase60
o.handleMC2DUnsub=handleMC2DUnsub
o.startup=startup
o.initPhase50=o.getVSElevAndTile=o.getVSTintColors=o.calcBlendWeights=o.getHexomeIDsFromChunkPos=o.getHexomeIDExact=o.rflow_cache=o.vertical_slices=o.getDetailsVersion=o.getElevation=o.RFLOW_UNDERWATER=o.NOISE_CUSTOM_IDX=o.NOISE_DETAIL_IDX=o.world_noise3D=o.world_noise=o.biome_noise=void 0
var Z=new Array(5)
o.biome_noise=Z
var l=new Array(10)
o.world_noise=l
var n=new Array(1)
o.world_noise3D=n
var t=5
o.NOISE_DETAIL_IDX=t
var a=6
o.NOISE_CUSTOM_IDX=a
var f=99
o.RFLOW_UNDERWATER=f
var X=r("assert")
var Q=r("./biome_details.js")
var i=r("./biome_types.js"),s=i.setupFlat,v=i.BIOMES,c=i.BIOME_BY_ID,d=i.BIOME_PARAM_TYPE,h=i.TYPE_ARR,p=i.TYPE_NON_INTERP
var J=r("./detail_gen_rendered.js").renderedDetailGen
var A=r("./context.js").threadName
var _=r("./continent.js"),u=_.continentGet,m=_.continentGetID,g=_.continentGetIDs,E=_.continentReady
var y=r("../common/globals.js"),$=y.CHUNK_SIZE,ee=y.ID_FACTOR,te=y.ID2,w=y.MEGACHUNK_SIZE,re=y.MEGACHUNK_VOXEL_SIZE
var T=r("../glov/client/hsv.js").hsvToRGB
var I=Math.abs,S=Math.ceil,D=Math.floor,ae=Math.max,ie=Math.min,oe=Math.round,L=Math.sqrt,R=Math.cos,x=Math.sin
var O=r("./proc_gen.js")
var b=O.oreFromChunkPos
var N=r("./proc_gen_constants.js"),P=N.HEX_HEIGHT,ne=N.HEX_WIDTH,k=N.SKEW_X,C=N.C_WATER,M=N.C_PLAINS,B=N.C_HILLS,U=N.C_MOUNTAINS,G=N.SNOW_ELEVATION,F=N.SNOW_VARIATION,W=N.STONE_FREQ_XY,j=N.STONE_FREQ_Z,H=N.C_RIVER_DELTA
var z=r("./proc_gen_details.js").DETAILS_CURRENT_VERSION
var V=r("./proc_gen_shared.js")
var se=r("./rand_seed.js")
var Y=r("../glov/common/rand_alea.js").mashString
var q=r("simplex-noise")
var K=r("open-simplex-noise").makeNoise3D
var le=r("./tiles.js")
var ce=r("../glov/common/util.js"),_e=ce.clamp,ue=ce.isPowerOfTwo,de=ce.lerp,fe=ce.nop,ve=ce.ridx
var he=r("../glov/common/vmath.js"),pe=he.vec2,me=he.v2add,ge=he.v2addScale,Ee=he.v2distSq,ye=he.v2set,Te=he.v2floor,Ie=he.v2scale,Se=he.v2sub,Ae=he.vec3,we=he.v3add,Le=he.v3sub,Re=he.v3scaleFloor,xe=he.unit_vec,Oe=he.zero_vec
var be=r("../common/waygate_common.js").FLAT_SEED_EMPTY
var Ne=le.NUM_STONES,Ce=le.STONES,Me=le.TILE_GRASS,De=le.TILE_SNOW,Pe=le.TILE_WATER,ke=le.TILE_DIRT,Be=le.TILE_STONE_DARK,Ue=le.TILE_STONE_LIGHT,Ge=le.TILE_STONE_RED,Fe=le.TILE_TINT_GRASS,We=le.TILE_TINT_ORE,je=le.MAT_METAL_TINT
var He=V.intNoise,ze=V.neighbor_id_offs,Ve=V.phase_counts,Ye=V.phase_timing
var qe
var Ke
var Ze
var Xe
var Qe
var Je
var $e
var et
o.getElevation=et
var tt
var rt
var at
var it
o.getDetailsVersion=it
var ot=false
var nt=1e-4
var st=[.005,.25]
var lt=[25,7]
var ct
o.vertical_slices=ct
var _t
o.rflow_cache=_t
var ut
var dt
var ft
var vt=false
function setLODMode(){vt=true}var ht=true
function procGenDoLODs(){return ht}function sampleRidgeNoise(e,t,r,a){return 1-I(l[e].noise2D(r*t,a*t))}function sampleNoise(e,t,r,a){return l[e].noise2D(r*t,a*t)}function mountainsHeight(e){var t=e.pos_world[0]
var r=e.pos_world[1]
var a
a=50*sampleRidgeNoise(3,.005,t,r)
return(a+=5*sampleRidgeNoise(4,.02,t,r))-10}function spikyHeight(e){var t=e.pos_world[0]
var r=e.pos_world[1]
var a
a=sampleNoise(2,.05,t,r)
if((a-=5*sampleNoise(1,.01,t,r))>0){var i
var o
var n
o=10*sampleNoise(1,.05,t,r)
n=10*sampleNoise(2,.05,t,r)
i=sampleNoise(2,.05,t+=o,r+=n)
i-=5*sampleNoise(1,.01,t,r)
a*=I(i*i/2*sampleNoise(2,.005,t,r))}return a}function shallowsSpikyHeight(e){return spikyHeight(e)-20}function shallowsSpikyReef(e,t,r){var a=e.map[r][t]
e.pos_world[0]+=t
e.pos_world[1]+=r
if(shallowsSpikyHeight(e)>-15){if(getNeighbourCount(t,r,e,a.h)>.5){a.surface_depth=1
a.surface_h=a.h-1}}else{a.surface_depth=1
a.surface_h=a.h-1}e.pos_world[0]-=t
e.pos_world[1]-=r}var pt=pe(0,0)
function rotate(e,t){var r=e[0]
pt[0]=e[2]
pt[1]=e[3]
Se(t,t,pt)
var a=t[0]*R(r)-t[1]*x(r)
var i=t[0]*x(r)+t[1]*R(r)
return ye(pt,a,i)}var mt=pe()
var gt=pe()
function riverDeltaHeight(e){var t=e.pos_world[0]
var r=e.pos_world[1]
var a
a=15*sampleNoise(1,1/30,t,r)
r+=15*sampleNoise(2,1/30,t,r)
var i
gt[0]=t+=a
gt[1]=r
if(e.dir){(mt=rotate(e.dir,gt))[0]*=10
i=10*sampleNoise(3,.005,de(.6,t,mt[0]),de(.6,r,mt[1]))}else{i=10*sampleNoise(3,.005,t,r);--i}return i}function getNeighbourCount(e,t,r,a){var i=0
var o=9
for(var n=-1;n<=1;++n){if(t+n<0||t+n>$-1){o-=3
continue}var s=r.map[t+n]
for(var l=-1;l<=1;++l){var c=s[e+l]
if(0===l&&0===n||e+l<0||e+l>$-1){o--
continue}if(c.h===a)i++}}return i/o}function delta_kernel_func(e,t){if(t<e.h-1)--e.h
if(t>e.h+1)e.h+=1}function mountain_kernel_func(e,t,r,a){if(t===e.h&&e.surface!==De){e.surface_h=e.h-1
e.surface=r
e.ground_h=e.h-a}}function grassFire(e,t,r,a,i,o){var n=e[r][t].h
if(t>0)a(e[r][t-1],n,i,o)
if(t<$-1)a(e[r][t+1],n,i,o)
if(r>0)a(e[r-1][t],n,i,o)
if(r<$-1)a(e[r+1][t],n,i,o)}function riverDeltaSmoothNoise(e,t,r){grassFire(e.map,r,t,delta_kernel_func)}function grassyMountain(e,t,r){var a=e.map[r][t]
var i=e.pos_world[0]
var o=e.pos_world[1]
var n
var s
var l
if(a.surface!==De){var c=sampleRidgeNoise(3,1/80,i=e.pos_world[0]+t,o=e.pos_world[1]+r)
n=13*sampleRidgeNoise(1,.05,i,o)
s=10*sampleRidgeNoise(2,.05,i,o)
if((l=sampleRidgeNoise(3,.1,i+=n,o+=s))<.4&&c<.4){a.surface=Ue
a.surface_h=a.h-1}else if(l<.6&&c<.4){a.surface=Be
a.surface_h=a.h-1}}var _=getNeighbourCount(t,r,e,a.h)
n=13*sampleRidgeNoise(1,1/30,i=e.pos_world[0]+t,o=e.pos_world[1]+r)
s=10*sampleRidgeNoise(2,1/30,i,o)
l=sampleRidgeNoise(3,1/30,i+=n,o+=s)
i=e.pos_world[0]
o=e.pos_world[1]
e.pos_world[0]=i+t
e.pos_world[1]=o+r
var u=mountainsHeight(e)
e.pos_world[0]=i
e.pos_world[1]=o
if(u<20&&l>.95&&_<.6&&a.surface!==De){a.surface_h=a.h-1
a.surface=Ge}if(_>.6&&a.surface!==De&&u<40){a.surface_h=a.h-1
a.ground_h=a.h-2
a.surface=ke
grassFire(e.map,t,r,mountain_kernel_func,ke,2)
if(_>.7&&a.h<G+50*(sampleRidgeNoise(1,1/30,e.pos_world[0]+t,e.pos_world[1]+r)-.5)){a.surface_h=a.h-1
a.ground_h=a.h-2
a.surface=Me
grassFire(e.map,t,r,mountain_kernel_func,Me,2)}}else if(_<.15&&a.surface===De){i=e.pos_world[0]+t
o=e.pos_world[1]+r
if(l>.6){a.surface_h=a.h
a.ground_h=a.h}}}function hexomeMountainSpireHeight(e){return e.w0*e.w0*e.w0*140}function cliffsHeight(e){var r=e.pos_world[0]
var a=e.pos_world[1]
function sample(e,t){return t[0]*(.5+.5*l[e].noise2D(r*t[1],a*t[1]))}var t=e.hexome
var i=ie(sample(0,[1,.025]),sample(1,[1,.025]))
return(.25+.25*t.biome_param)*(.5*t.cliff_height*i*i+.125*t.cliff_height*I(l[2].noise2D(r/16,a/16)))}function genericHeight(e){var t=e.hexome,r=e.pos_world
var a=t.params.noise_weights
var i=t.params.noise_periods
var o=0
for(var n=0;n<a.length;++n){var s=a[n]
if(s)o+=s*(.5+.5*l[n].noise2D(r[0]*i[n],r[1]*i[n]))}return o}function hexomeHillHeight(e){return genericHeight(e)+40*e.w0}var Et={genericHeight:genericHeight,mountainsHeight:mountainsHeight,cliffsHeight:cliffsHeight,grassyMountain:grassyMountain,riverDeltaHeight:riverDeltaHeight,riverDeltaSmoothNoise:riverDeltaSmoothNoise,spikyHeight:spikyHeight,shallowsSpikyHeight:shallowsSpikyHeight,shallowsSpikyReef:shallowsSpikyReef,hexomeHillHeight:hexomeHillHeight,hexomeMountainSpireHeight:hexomeMountainSpireHeight}
function VeriticalSlices(){}function flushVerticalSlices(){o.vertical_slices=ct=new VeriticalSlices}function worldStoneType(e,t,r){var a=n[0](e*W,t*W,r*j)
return Ce[_e(D(a*Ne),0,Ne-1)]}var yt=new Float32Array([0,.001349,.001349,.008905,.010254,.027101,.037364,.05666,.094024,.083166,.17719,.099867,.277057,.109412,.386469,.114112,.500581,.114131,.614712,.108271,.722983,.099347,.82233,.082007,.904337,.05668,.961017,.028057,.989074,.009402,.998476,.001524])
var Tt=16
function sampleUniformNoise3D(e,t,r){var a=n[0](e,t,r)
if((a=ae(0,a*Tt))>=Tt)return 1
var i=D(a)
var o=a-i
return yt[2*i]+yt[2*i+1]*o}function getDetailsVersionCurrent(){return z}function getDetailsVersion0(){return 0}function makeNoise3DNormal(e){var a=K(e)
return function(e,t,r){return _e(.5+.58*a(e,t,r),0,1)}}function Hexomes(){}function seedWorld(e){X(e&&e.seed&&e.world_type)
Xe=e.seed
Qe=e.world_type
flushVerticalSlices()
ut=new Hexomes
ft={}
dt={}
o.rflow_cache=_t={}
ht=true
switch(Qe){case"v1":Je=hexomeInitV1
$e=hexomeInitAfterBiomeTypeV1
o.getElevation=et=at
tt=getElevationEstimateV1
rt=getBiomeTypeV1
o.getDetailsVersion=it=getDetailsVersionCurrent
break
default:console.error("Unknown world type: "+Qe+", using flat")
case"flat":if(Xe===be){Je=hexomeInitEmpty
ht=false}else Je=hexomeInitFlat
$e=fe
o.getElevation=et=getElevationFlat
tt=getElevationFlat
rt=getBiomeTypeFlat
o.getDetailsVersion=it=getDetailsVersion0
s(Xe)}var t="pc"+e.seed
for(var r=0;r<Z.length;++r)Z[r]=new q(""+t+r+"biome")
for(var a=0;a<l.length;++a)l[a]=new q(""+t+a+"world")
for(var i=0;i<n.length;++i)n[i]=makeNoise3DNormal(Y(""+t+i+"world"))}function choiceDataSet(e,t){dt[e]=t}function hexomeInitEmpty(e){e.elevation=v.FLAT.fixed_elev
e.water_level=e.elevation}function hexomeInitFlat(e){e.elevation=v.FLAT.fixed_elev
e.water_level=-1}function hexomeInitV1(e){var t=g(e.hx,e.hy)
e.continent=u(t.cid)
var r=e.cont_idx=t.idx
e.cont_elevation=e.continent.getElevation(r)
e.slopes=e.continent.getSlopes(r)
e.humidity=e.continent.getHumidity(r)
e.cdist=e.continent.getCoastDistance(r)
e.water_level=e.continent.getWaterLevel(r)
e.classif=e.continent.getClassif(r)
e.river_bits=e.continent.getRiver(r)
e.rflow_dir=e.continent.getFlowDir(r)
e.rflow_amt=e.continent.getFlowAmount(r)
if(!e.river_bits&&7!==e.rflow_dir){e.rflow_dir=-1
e.rflow_amt=0}}function hexomeInitAfterBiomeTypeV1(e,t){e.elevation=e.cont_elevation
e.biome_param=t.random()
if(e.type===v.CLIFFS){var r=e.continent.getMinElev(e.cont_idx)
e.cliff_height=e.cont_elevation-r
e.elevation=r}}function getBiomeTypeFlat(e,t){return v.FLAT}var It=1
var St=.25
var At=.03
function weightedChoiceBuild(e){var t=0
for(var r=0;r<e.length;++r)t+=e[r][0]
return{total:t,list:e}}function weightedChoiceGet(e,t){var r=e.total,a=e.list
var i=r*t
for(var o=0;o<a.length;++o)if((i-=a[o][0])<=0)return a[o][1]
return a[0][1]}var wt=weightedChoiceBuild([[It,"DENSE_FOREST"],[St,"PLAINS_FOREST"],[St,"PLAINS_FOREST_SPIKY"],[At,"FOREST_RUIN"],[At,"FOREST_MEGA_TREE"]])
var Lt=weightedChoiceBuild([[It,"PLAINS_FOREST"],[St,"PLAINS"],[St,"PLAINS_WITH_BERRIES"]])
var Rt=weightedChoiceBuild([[It,"PLAINS"],[At,"PLAINS_BLUE_V3"],[At,"PLAINS_RED_V2"],[At,"PLAINS_YELLOW"],[At,"HILLS"]])
var xt=weightedChoiceBuild([[It,"MOUNTAINS"],[St,"SNOW_PINE_MOUNTAINS"],[At,"MOUNTAINS_FLOATY_ROCKS"]])
function getBiomeTypeV1(e,t){var r=e.cont_elevation,a=e.slopes,i=e.humidity,o=e.cdist,n=e.classif,s=e.river_bits
if(n===C){if(I(r-e.water_level)<20)return v.SHALLOWS_SPIKY
return v.OCEAN}if(n===H)return v.RIVER_DELTA
var l=s&&ue(s)
var c=a[3]
if(c>.6&&o<.01)return v.CLIFFS
var _
if(n===U)if(c>.12||r<G)_=weightedChoiceGet(xt,t)
else _="TUNDRA"
else if(n===B)if(i>.66)_="HILLS_FOREST"
else _="HILLS"
else if(n===M)if(i>.75)_=weightedChoiceGet(wt,t)
else if(i>.5)_=weightedChoiceGet(Lt,t)
else if(i>.25)_=weightedChoiceGet(Rt,t)
else _="DESERT"
else X(0)
X(v[_])
if(l&&v[_+"_SPRING"])_+="_SPRING"
return v[_]}function rangeOrValue(e,t){if("number"!==typeof t&&t.length)return e.floatBetween(t[0],t[1])
return t}var Ot=0
var bt=se.createGood(0)
function Hexome(e,t,r){var a=oe(e/ee)
var i=e-a*ee
if(a!==r||i!==t)X(false,"Unexpected Hexome("+e+", "+t+", "+r+") !== "+i+","+a)
this.uid=++Ot
this.phase=0
this.hid=e
this.hx=t
this.hy=r
this.dist=0
this.dist_noisy=0
this.details=[]
this.hydro_output_vsid=null
var o=r-.5*t
var n=t/k
this.unif_pos=pe(n,o)
this.pos_world=pe(n*P,o*P)
Je(this)
bt.reseed(Y("b_"+Xe+"_"+this.pos_world[0]+"_"+this.pos_world[1]))
var s=bt.random()
var l
var c=dt[this.hid]
if(c){l=c.seed
this.initFromChoiceData(c)}else{l=bt.uint32()
this.initFresh(s,l)}bt.reseed(l)
$e(this,bt)
this.blend_weight=bt.floatBetween(this.type.blend[0],this.type.blend[1])
this.params={}
for(var _ in this.type)this.params[_]=this.type[_]
this.sort_uid=bt.range(65536)
this.params.debug_color=T(Ae(),rangeOrValue(bt,this.type.debug_color_hsv[0]),rangeOrValue(bt,this.type.debug_color_hsv[1]),rangeOrValue(bt,this.type.debug_color_hsv[2]))}var Nt
function onHexomeChoice(e){Nt=e}Hexome.prototype.initFresh=function(e,t){this.seed=t
this.type=rt(this,e)
if(Nt)Nt(this)}
Hexome.prototype.initFromChoiceData=function(e){this.seed=e.seed
this.type=c[e.id]
X(this.type,e.id)}
Hexome.prototype.toChoiceData=function(){return{seed:this.seed,id:this.type.id}}
var Ct=function(){var o=pe()
var n=pe()
return function getHexomeIDExactFn(e){Ie(o,e,1/P)
n[0]=o[0]*k
n[1]=o[1]+.5*n[0]
var t=D(n[0])
var r=n[0]-t
var a=D(n[1])
var i=n[1]-a
if(i>1-r)if(i>2*r)++a
else if(i>.5*r){++t;++a}else++t
else if(i>.5*r+.5)++a
else if(i<=2*r-1)++t
return t+a*ee}}()
o.getHexomeIDExact=Ct
var Mt=function(){var O=pe()
var b=pe()
var N=[[0,0],[1,1],[1,0]]
var C=[[0,0],[1,1],[0,1]]
var M=.005
return function getHexomesFn(e,t){X(e!==xe)
X(isFinite(t[0]))
X(isFinite(t[1]))
Ie(O,t,1/P)
b[0]=O[0]*k
b[1]=O[1]+.5*b[0]
var r=D(b[0])
var a=b[0]-r
var i=D(b[1])
var o
if(a>b[1]-i)o=N
else o=C
var n=[]
var s=0
var l=0
for(var c=0;c<o.length;++c){var _=r+o[c][0]
var u=i+o[c][1]
var d=_+u*ee
var f=ut[d]
if(!f)f=ut[d]=new Hexome(d,_,u)
var v=ae(0,.75-Ee(f.unif_pos,O))
var h=f.blend_weight
var p=v*v*h
if((p=Math.pow(v,2+4*(1-h)))>0){s+=p
if(n.length)if(p>l){l=p
e[n.length]=e[0]
e[0]=p
n.push(n[0])
n[0]=f}else{e[n.length]=p
n.push(f)}else{l=p
e[n.length]=p
n.push(f)}}}if(!n.length){var m=["up="+O[0]+","+O[1]+",wps="+t[0]+","+t[1]]
for(var g=0;g<o.length;++g){var E=r+o[g][0]
var y=i+o[g][1]
var T=E+y*ee
var I=ut[T]
var S=ae(0,.75-Ee(I.unif_pos,O))
var A=I.blend_weight
var w=S*S*A
w=Math.pow(S,2+4*(1-A))
m.push("hid="+T+",hx="+E+",hy="+y+",up="+I.unif_pos[0]+","+I.unif_pos[1]+",d="+S+",bw="+A+",w="+w)}X(n.length,m.join("\n"))}var L=M*s
for(var R=n.length-1;R>=0;--R)if(e[R]<L){ve(n,R)
e[R]=e[n.length]}for(var x=0;x<n.length;++x){e[x]/=s
X(n[x])}X(n.length)
return n}}()
var Dt=function(){var E=pe()
var y=pe()
var T=[[0,0],[1,1],[1,0]]
var I=[[0,0],[0,1],[1,1]]
var S=-L(.75)
return function getHexomesContFn(e,t){Ie(E,t,1/P)
y[0]=E[0]*k
y[1]=E[1]+.5*y[0]
var r=D(y[0])
var a=y[0]-r
var i=D(y[1])
var o=y[1]-i
var n
if(a>o)n=T
else n=I
var s=[]
for(var l=0;l<n.length;++l){var c=r+n[l][0]
var _=i+n[l][1]
var u=c+_*ee
var d=ut[u]
if(!d)d=ut[u]=new Hexome(u,c,_)
s.push(d)}var f=s[2]
var v=f.unif_pos[0]
var h=f.unif_pos[1]
var p
var m
if(a>o){p=(E[0]-v)/S
m=(-.5*(E[0]-v)+S*(E[1]-h))/S}else{p=(.5*(E[0]-v)+-S*(E[1]-h))/S
m=(.5*(E[0]-v)+S*(E[1]-h))/S}var g=1-p-m
e[0]=_e(p,0,1)
e[1]=_e(m,0,1)
e[2]=_e(g,0,1)
return s}}()
function getHexome(e){var t=ut[e]
if(!t){var r=oe(e/ee)
var a=e-r*ee
t=ut[e]=new Hexome(e,a,r)}return t}function getHexomeExact(e){return getHexome(Ct(e))}var Pt=function(){var l=pe()
var c=pe()
var _=[[-1,-1],[0,-1],[1,-1],[-1,0],[0,0],[1,0],[2,0],[0,1],[1,1],[2,1],[1,2],[2,2]]
var u=[[-1,-1],[0,-1],[-1,0],[0,0],[1,0],[-1,1],[0,1],[1,1],[2,1],[0,2],[1,2],[2,2]]
var d=$/P
return function getHexomeIDsFromChunkPosFn(e){Ie(l,e,d)
c[0]=l[0]*k
c[1]=l[1]+.5*c[0]
var t=D(c[0])
var r=c[0]-t
var a=D(c[1])
var i
if(r>c[1]-a)i=_
else i=u
var o=[]
for(var n=0;n<i.length;++n){var s=t+i[n][0]+(a+i[n][1])*ee
o.push(s)}return o}}()
o.getHexomeIDsFromChunkPos=Pt
var kt=[[-2,1],[2,3],[-2,-3],[2,-1]]
function getContinentIDsForPos(e,t,r){X(r)
var a=Ct(t)
var i=oe(a/ee)
var o=a-i*ee
var n=S(r/P/2)
var s=0
for(var l=0;l<4;++l){var c=kt[l]
var _=m(o+c[0]*n,i+c[1]*n)
if(!s||-1===e.lastIndexOf(_,s-1))e[s++]=_}return s}function BlendWeightContext(){this.hexomes=null
this.hexomes_noisy=null
this.hexomes_cont=null
this.blend_weights=new Float32Array(3)
this.blend_weights_noisy=new Float32Array(3)
this.blend_weights_cont=new Float32Array(3)}var Bt=function(){var o=pe()
var n=pe()
var s=pe()
var l=pe()
return function calcBlendWeightsFn(e,t,r,a,i){if(!a){s[0]=Z[1].noise2D(t[0]*st[0],t[1]*st[0])*lt[0]
s[1]=Z[2].noise2D(t[0]*st[0],t[1]*st[0])*lt[0]
me(o,t,s)
if(!i)e.hexomes=Mt(e.blend_weights,o)
e.hexomes_cont=Dt(e.blend_weights_cont,o)}if(r){l[0]=Z[3].noise2D(t[0]*st[1],t[1]*st[1])*lt[1]
l[1]=Z[4].noise2D(t[0]*st[1],t[1]*st[1])*lt[1]
me(n,o,l)
e.hexomes_noisy=Mt(e.blend_weights_noisy,n)}}}()
o.calcBlendWeights=Bt
function calcBlendWeightsVS(e,t,r){var a=e.blend_pos_world
me(a,e.pos_world,t)
if(e.single_hexome){Bt(e,a,false,false,true)
return}Bt(e,a,r)
e.blend_primary_hexome=e.hexomes[0]
if(r)e.blend_primary_hexome_noisy=e.hexomes_noisy[0]}function VerticalSlice(e){var t=oe(e/ee)
var r=e-t*ee
this.pos_world=pe(r*$,t*$)
this.vsid=e
this.single_hexome=false
this.phase=0
if(!vt){this.map=null
this.max_z=0}}function getVerticalSliceById(e){var t=ct[e]
if(!t)initPhase30(t=ct[e]=new VerticalSlice(e))
return t}function getVerticalSlice(e){return getVerticalSliceById(e[0]+e[1]*ee)}var Ut=pe()
function getVerticalSliceWorldPos(e){Ie(Ut,e,1/$)
Te(Ut,Ut)
return getVerticalSlice(Ut)}function getParam(e,t,r,a){var i=a?e.blend_weights_noisy:e.blend_weights
var o=a?e.hexomes_noisy:e.hexomes
var n=o.length
switch(d[r]){case p:return(a?e.blend_primary_hexome_noisy:e.blend_primary_hexome).params[r]
case h:for(var s=0;s<t.length;++s)t[s]=0
for(var l=0;l<n;++l){var c=i[l]
if(c){var _=o[l].params[r]
for(var u=0;u<t.length;++u)t[u]+=c*_[u]}}return t
default:X(0)
return 0}}function getElevationFlat(e){e.last_base_elevation=v.FLAT.fixed_elev
return v.FLAT.fixed_elev}var Gt=.333*P
function cubicInterpElevation(e,t){var r=e.length
X.equal(r,3)
var a=e[0]
var i=e[1]
var o=e[2]
var n=a.elevation
var s=i.elevation
var l=o.elevation
var c=t[0]
var _=t[1]
var u=t[2]
var d
var f
var v
var h
var p
var m
if(i.hx>a.hx){d=n+a.slopes[1]*Gt
v=n+a.slopes[2]*Gt
f=s-i.slopes[1]*Gt
p=s-i.slopes[0]*Gt
h=l-o.slopes[2]*Gt
m=l+o.slopes[0]*Gt}else{d=n+a.slopes[0]*Gt
v=n+a.slopes[1]*Gt
f=s-i.slopes[0]*Gt
p=s+i.slopes[2]*Gt
h=l-o.slopes[1]*Gt
m=l-o.slopes[2]*Gt}return s*_*_*_+3*f*c*_*_+3*p*_*_*u+3*d*c*c*_+(d+v+f+p+h+m)/6*6*c*_*u+3*m*_*u*u+n*c*c*c+3*v*c*c*u+3*h*c*u*u+l*u*u*u}var Ft=new Float32Array(3)
var Wt=0
function getElevationEstimateV1(e){if(!E(e,3*P))return Wt
var t=Dt(Ft,e)
return Wt=cubicInterpElevation(t,Ft)}at=function(){return function getElevationV1fn(e){var t=e.hexomes_cont
var r=e.blend_weights_cont
var a=cubicInterpElevation(t,r)
e.last_base_elevation=a
var i=e.blend_weights
var o=e.hexomes
var n=o.length
var s=0
var l={vs:e,pos_world:e.blend_pos_world}
for(var c=0;c<n;++c){var _=i[c]
if(_){var u=o[c]
var d=u.params.height_func
if(d){l.hexome=u
l.w0=t[0]===u?r[0]:t[1]===u?r[1]:r[2]
s+=_*d(l)}}}return a+s}}()
function getElevationEstimate(e){return tt(e)}var jt=new Float32Array(3)
var Ht=new Float32Array(3)
var zt=new Float32Array(3)
var Vt=new Float32Array(2)
function initPhase30Base(e){e.blend_weights=jt
e.blend_weights_noisy=Ht
e.blend_weights_cont=zt
e.blend_pos_world=Vt}var Yt=pe(($-1)/2,($-1)/2)
function initPhase30(e){X.equal(e.phase,0);++Ve[30]
var t=Date.now()
e.phase=30
initPhase30Base(e)
calcBlendWeightsVS(e,Yt,false)
if(!vt){e.blend_weights_mid=e.blend_weights.slice(0)
e.hexomes_mid=e.hexomes.slice(0)
e.hexomes_cont_mid=e.hexomes_cont.slice(0)}e.owner_hexome=e.hexomes[0]
X(e.owner_hexome)
e.mid_elevation=et(e)
var r=e.last_base_elevation
var a=.5+.5*l[3].noise2D(e.pos_world[0]*nt,e.pos_world[1]*nt)
e.mid_elevation_eroded=de(a=.1+.8*a*a*a,e.mid_elevation,r)
e.mid_hexome_exact=getHexomeExact(e.blend_pos_world)
if(!vt){calcBlendWeightsVS(e,Oe,false)
e.origin_hexomes=e.hexomes.slice(0)
e.seed=e.vsid+e.owner_hexome.seed}Ye[30]+=Date.now()-t}var qt=function(){var p=Ae()
return function getTintFn(e,t,r,a){var i=e.blend_weights_noisy
var o=e.hexomes_noisy
var n=o.length
for(var s=0;s<p.length;++s){var l=0
var c=0
var _=void 0
for(var u=0;u<n;++u){var d=i[u]
if(d){var f=o[u].params[a]
if(!f)f=o[u].params.tint_grass_hsv
var v=f[s]
if(Array.isArray(v)){X(v.length>=4)
var h=v[3]+v[2]
if(v.length>=5)h+=1e4*v[4]
if(c!==h){c=h
_=.5+.5*Z[v.length>=5?v[4]:s].noise2D(t[0]*v[2]+v[3],t[1]*v[2])}v=(v[1]-v[0])*_+v[0]}l+=d*v}}p[s]=l}T(r,p[0],p[1],p[2])}}()
var Kt=function(){var o=new VerticalSlice
initPhase30Base(o)
return function getVSTintColorsFn(e,t,r){var a=ft[e]
if(!a){Bt(o,t,true)
ft[e]=a=[]
var i=a[Fe]=Ae()
qt(o,t,i,"tint_grass_hsv")}return a[r]}}()
o.getVSTintColors=Kt
function getChunkTintColor(e,t){X.equal(t,We)
var r=b(e)
return je[r]}var Zt=function(){var c=new VerticalSlice
initPhase30Base(c)
var _=Ae()
var u=Ae()
var d=G+.5*F
return function getVSElevAndTileFn(e,t){c.blend_pos_world=t
Bt(c,t,false)
c.blend_primary_hexome=c.hexomes[0]
var r=c.blend_primary_hexome.water_level
var a=et(c)
var i
var o
var n
if(a<r){a=r
o=Pe
n=f}else if(n=_t[e])o=Pe
if(a>d)i=De
else if(ae(0,oe(getParam(c,_,"surface_depth",false)[0]))>0)i=getParam(c,null,"surface",false)
else{getParam(c,_,"ground_depth",false)
var s=.5
if(ae(0,oe(_[0]+_[1]*s))>0)i=getParam(c,null,"ground",false)
else i=worldStoneType(t[0],t[1],a)}var l
if(i===Me){Bt(c,t,true,true)
qt(c,t,u,"tint_lod_hsv")
l=u}return{elev:a,tile:i,tint:l,liquid:o,rflow_amt:n}}}()
o.getVSElevAndTile=Zt
function seedDetails(e){X(e.phase>=30)
return e.seed}function uninitPhase50(e){if(e.phase<50)return
X.equal(e.phase,50)
e.details.length=0
e.phase=37}var Xt=function(){var z=pe()
var V=pe()
var Y=pe()
var q=Ae()
var K=se.createGood(0)
return function initPhase50fn(S){if(S.phase>=50)return
if(S.phase<37)Ke(S);++Ve[50]
var e=Date.now()
S.phase=50
Ie(z,S.pos_world,1/$)
Te(z,z)
var o={}
var n=[]
var s=[]
var l=[]
var A=Infinity
var c=-Infinity
var w=Infinity
function search(e,t){var r=getVerticalSliceById(e)
A=ie(A,r.pos_world[0])
w=ie(w,r.pos_world[1])
c=ae(c,r.pos_world[0])
if(r.owner_hexome===S)s.push(r)
else{l.push(r)
if(!t)return}for(var a=0;a<ze.length;++a){var i=e+ze[a]
if(!o[i]){o[i]=true
n.push(i)}}}var t=z[0]+z[1]*ee
var r=t
search(t,o[t]=true)
while(n.length)search(t=n.pop())
var L=c-A+16
X(!S.details.length)
var R=[]
for(var a=0;a<l.length;++a){var i=l[a]
var _=i.pos_world[0]-A
var u=i.pos_world[1]-w
for(var d=0;d<$-1;++d){R[u*L+_+d]=true
R[(u+d)*L+_+$-1]=true
R[(u+$-1)*L+_+d+1]=true
R[(u+d+1)*L+_]=true}}var x=0
function addDetail(e,t,r,a,i){var o=e.bounds,n=e.exclusion,s=e.priority
var l=K.uint32()
var c=++x
var _=t-A
var u=r-w
if(!a&&n)for(var d=0;d<n[1];++d)for(var f=0;f<n[0];++f)if(R[(u+d)*L+_+f])return false
var v=Ae(t,r)
if(n){for(var h=0;h<n[1];++h)for(var p=0;p<n[0];++p)R[(u+h)*L+_+p]=true
ge(V,v,n,.5)}else{V[0]=v[0]+(o[0][0]+o[1][0])/2
V[1]=v[1]+(o[0][1]+o[1][1])/2}Te(V,V)
var m=getVerticalSliceWorldPos(V)
Se(Y,V,m.pos_world)
calcBlendWeightsVS(m,Y,false)
var g=et(m)
v[2]=oe(g)
var E
if(e.factory){E=e.factory(l,v,m)
X(!E.seed||E.seed===l)
E.seed=l
X(!E.uid)
E.uid=++c}else{var y=we(Ae(),v,o[0])
var T=Le(Ae(),o[1],o[0])
E=J({priority:s,uid:c<<16|S.sort_uid,origin:v,pos_world:y,size:T,detail_type:e,seed:l,hexome:S,provider_data:i})}Re(q,v,1/re)
var I=q[0]+q[1]*ee+q[2]*te
E.owner_mcid=I
X(E.bounds_buf)
X(E.bounds_idx>=0)
X(E.bounds_len<31)
S.details.push(E)
return true}if(S.type.detail_provider){var f=getVerticalSliceById(r)
K.reseed(seedDetails(f))
var v=Q[S.type.detail_provider](S)
for(var h=0;h<v.length;++h){var p=v[h]
var m=p.pos,g=p.type,E=p.provider_data
var y=m[0]
var T=m[1]
X(y>=S.pos_world[0]-ne&&y<=S.pos_world[0]+ne)
X(T>=S.pos_world[1]-ne&&T<=S.pos_world[1]+ne)
addDetail(g,y,T,true,E)}}var I=S.type.details
for(var O=0;O<I.length;++O){var b=I[O]
var N=b.type_name,C=b.freq,M=b.offs,D=b.chance
var P=Q[N]
var k=b.min
var B=b.max
for(var U=0;U<s.length;++U){var G=s[U]
var F=k+He(Z[0],G.pos_world,C,M,B-k+1)
if(F<=0)continue
K.reseed(seedDetails(G))
for(var W=0;W<F;++W){var j=G.pos_world[0]+K.range($)
var H=G.pos_world[1]+K.range($)
if(K.random()>D)continue
addDetail(P,j,H,false)}}}Ye[50]+=Date.now()-e}}()
o.initPhase50=Xt
function initPhase60(e){if(e.phase>=60)return;++Ve[60]
var t=Date.now()
qe(e)
e.phase=60
e.plants=[]
var r=false
for(var a=0;a<e.hexomes_mid.length;++a){var i=e.blend_weights_mid[a]
if(i){var o=e.hexomes_mid[a].type
if(o.plants&&o.plants.length)for(var n=0;n<o.plants.length;++n){var s=o.plants[n]
e.plants.push({weight:i,plant:s})
r=true}}}if(r)e.max_z++
Ye[60]+=Date.now()-t}function handleMC2DUnsub(e){var t=[]
var r=[]
var a={}
for(var i=0;i<e.length;++i){var o=e[i]
var n=oe(o/ee)
var s=o-n*ee
var l=s*w+n*w*ee
for(var c=0;c<w;++c)for(var _=0;_<w;++_){var u=ct[l+_+c*ee]
if(u)t.push(u)}var d=D(s*re/ne)-1
var f=D(((s+1)*re-1)/ne)+1
for(var v=d;v<=f;++v){var h=n*re+v*P/2
var p=D(h/P)-1
var m=D((h+re-1)/P)+1
for(var g=p;g<=m;++g){var E=v+g*ee
if(!a[E]){a[E]=true
var y=getHexome(E)
if(y.phase>=37)r.push(y)}}}}if(!t.length&&!r.length)return
for(var T=0;T<r.length;++T){uninitPhase50(r[T])
Ze(r[T])}for(var I=0;I<t.length;++I){var S=t[I]
delete ct[S.vsid]}console.log(A(),"Unload "+t.length+" VSes, "+r.length+" Hexomes")}function startup(){qe=O.initPhase40
var e=r("./proc_gen_hydro.js")
Ke=e.initPhase37
Ze=e.uninitPhase37
for(var t in v){if(v[t].height_func){X(Et[v[t].height_func])
v[t].height_func=Et[v[t].height_func]}if(v[t].local_func){X(Et[v[t].local_func])
v[t].local_func=Et[v[t].local_func]}}if(ot){var u=[30,40]
var d=[]
setInterval(function(){var e=[]
var t=[]
var r=[]
for(var a=0;a<u.length;++a){e.push(0)
t.push([Infinity,Infinity])
r.push([-Infinity,-Infinity])}for(var i in ct){var o=ct[i]
for(var n=0;n<u.length;++n)if(o.phase>=u[n]){e[n]++
var s=t[n]
var l=r[n]
s[0]=ie(s[0],o.pos_world[0])
s[1]=ie(s[1],o.pos_world[1])
l[0]=ae(l[0],o.pos_world[0])
l[1]=ae(l[1],o.pos_world[1])}}for(var c=0;c<u.length;++c)if(isFinite(t[c][0])){var _=t[c]+"-"+r[c]+" ("+e[c]+")"
if(_!==d[c]){d[c]=_
console.log(A(),"Phase"+u[c]+":",_)}}},3e4)}}},{"../common/globals.js":197,"../common/waygate_common.js":210,"../glov/client/hsv.js":269,"../glov/common/rand_alea.js":327,"../glov/common/util.js":330,"../glov/common/vmath.js":332,"./biome_details.js":19,"./biome_types.js":20,"./context.js":36,"./continent.js":37,"./detail_gen_rendered.js":64,"./proc_gen.js":132,"./proc_gen_constants.js":134,"./proc_gen_details.js":136,"./proc_gen_hydro.js":137,"./proc_gen_shared.js":138,"./rand_seed.js":145,"./tiles.js":162,assert:void 0,"open-simplex-noise":void 0,"simplex-noise":void 0}],134:[function(e,t,r){"use strict"
r.PROP_4x1x4=r.PROP_1x4x4=r.PROP_2x1x4=r.PROP_1x2x4=r.PROP_2x2x1=r.PROP_2x2x2=r.PROP_1x1x1=r.STONE_FREQ_Z=r.STONE_FREQ_XY=r.SNOW_VARIATION=r.SNOW_ELEVATION=r.C_RIVER_DELTA=r.C_MOUNTAINS=r.C_HILLS=r.C_PLAINS=r.C_WATER=r.HEX_WIDTH=r.SKEW_X=r.HEX_HEIGHT=r.HEX_EDGE=void 0
var a=Math.sqrt
var i=128
r.HEX_EDGE=i
var o=a(3)*i
r.HEX_HEIGHT=o
var n=1/a(.75)
r.SKEW_X=n
var s=1.5*i
r.HEX_WIDTH=s
var l=0
r.C_WATER=l
var c=1
r.C_PLAINS=c
var _=2
r.C_HILLS=_
var u=3
r.C_MOUNTAINS=u
var d=4
r.C_RIVER_DELTA=d
var f=900
r.SNOW_ELEVATION=f
var v=100
r.SNOW_VARIATION=v
var h=24e-6
r.STONE_FREQ_XY=h
var p=6e-4
r.STONE_FREQ_Z=p
var m=[1,1,1]
r.PROP_1x1x1=m
var g=[2,2,2]
r.PROP_2x2x2=g
var E=[2,2,1]
r.PROP_2x2x1=E
var y=[1,2,4]
r.PROP_1x2x4=y
var T=[2,1,4]
r.PROP_2x1x4=T
var I=[1,4,4]
r.PROP_1x4x4=I
var S=[4,1,4]
r.PROP_4x1x4=S},{}],135:[function(e,t,r){"use strict"
r.dumpPerf=dumpPerf
r.fmt=fmt
r.hexomeDebug=hexomeDebug
r.drawDebug=void 0
var S=e("../glov/client/camera2d.js")
var A=e("./debug.js")
var n=e("../glov/client/engine.js")
var ie=e("../common/globals.js").CHUNK_SIZE
var w=e("../glov/client/input.js")
var L=e("./main.js").charControllerPos
var oe=Math.floor,ne=Math.max,se=Math.min,le=Math.round
var a=e("./proc_gen.js")
var i=e("./proc_gen_shared.js")
var o=e("./proc_gen_biomes.js")
var s=e("./proc_gen_hydro.js")
var ce=e("../glov/client/sprites.js").spriteCreate
var l=e("./task_sched.js")
var _e=e("../glov/client/textures.js")
var R=e("../glov/client/ui.js")
var x=e("./ui_util.js")
var c=e("../glov/common/vmath.js"),ue=c.vec2,de=c.v2add,O=c.v2addScale,b=c.v2copy,N=c.v2floor,C=c.v2mul,M=c.v2scale,fe=c.v2set,ve=c.v2sub,D=c.v2div,p=c.vec3,m=c.v3addScale,T=c.v3copy,g=c.v3scaleFloor,he=c.v3set,_=c.vec4
var P=e("./voxel_data.js")
var E=P.worldPosFromLocalPos
var k=o.BlendWeightContext,B=o.calcBlendWeights,pe=o.calcBlendWeightsVS,me=o.getParam,y=o.getVerticalSlice,ge=o.getVerticalSliceById,Ee=o.getVerticalSliceWorldPos,ye=o.initPhase50
var u=i.phase_counts,d=i.phase_timing
var Te=s.initPhase37
var Ie=a.renderDetail,Se=a.initPhase40
var Ae=ie/2
var we=-32
var Le=1e3
function dumpPerf(){if(!n.defines.NOWORKERS){var e=l.per_worker_data
var t={}
var r={}
for(var a in e){var i=e[a]
for(var o in i.phase_counts){t[o]=(t[o]||0)+i.phase_counts[o]
r[o]=(r[o]||0)+i.phase_timing[o]}}console.log("phase_counts(workers)",t)
console.log("phase_timing(workers)",r)}else{console.log("phase_counts",u)
console.log("phase_timing",d)}console.log("vd.timing",P.timing)}var Re
var xe
var Oe=ue()
var be=ue()
var Ne=[[-1,-1],[1,-1],[0,0],[-1,1],[1,1]]
var Ce=p()
function updateDebugTexture(e,t){dumpPerf()
var r=Date.now()
var c=256
var _=c
var a=1
var i=1/a
var o=false
var n=true
var s=true
var l=t
var u=ie*i
var d=fe(Oe,-c*a/2,-_*a/2)
de(d,d,e)
fe(be,c*a,_*a)
var f=new Uint8Array(c*_*3)
function setColor(e,t,r,a,i){var o=3*(t*c+e)
f[o]=r
f[o+1]=a
f[o+2]=i}function blendColor(e,t,r,a,i,o){var n=3*(t*c+e)
var s=1-o
f[n]=f[n]*s+o*r
f[n+1]=f[n+1]*s+o*a
f[n+2]=f[n+2]*s+o*i}function drawShape(e,t,r,a,i,o){for(var n=0;n<r.length;++n){var s=e+r[n][0]
if(s<0||s>=c)continue
var l=t+r[n][1]
if(l<0||l>=_)continue
setColor(s,l,a,i,o)}}var v=ue()
var h=ue()
var p=ue()
var m=ue()
var g=ue()
var E=ue()
var y={}
for(var T=0;T<_;T+=u)for(var I=0;I<c;I+=u){fe(v,d[0]+I*a,d[1]+T*a)
var S=Ee(v)
Se(S)
y[S.owner_hexome.hid]=S.owner_hexome
for(var A=0;A<u;++A){p[1]=A*a
h[1]=v[1]+p[1]
for(var w=0;w<u;++w){p[0]=w*a
h[0]=v[0]+p[0]
var L=void 0
var R=1
pe(S,p,true)
me(S,Ce,"debug_color",true)
var x=S.map[p[1]][p[0]].h
if(x>=0)L=x/Le
else L=-x/we
if(S.map[p[1]][p[0]].hydro_pen>0)he(Ce,0,0,1)
if(n)if(oe(x)%8===0)R=.75
if(L>=0)L=.4+.6*L
else L=.25+.75*-L
if(o)if(I*a+T*a&16)R=.75
L*=R
setColor(I+w,T+A,se(Ce[0]*L*255|0,255),se(Ce[1]*L*255|0,255),se(Ce[2]*L*255|0,255))}}}function pixelPos(e,t){return fe(e,le((t[0]-d[0])*i),le((t[1]-d[1])*i))}if(s)for(var O in y){var b=y[O]
ye(b)
var N=b.details
for(var C=0;C<N.length;++C){var M=N[C]
var D=void 0
var P=void 0
var k=void 0
if("RenderedDetailGen"===M.type){if(!M.pre_render_pos_world){M.pre_render_pos_world=M.pos_world.slice(0)
M.pre_render_size=M.size.slice(0)}if(l&&!M.rendered)Ie(M)
D=l?M.pos_world:M.pre_render_pos_world
P=l?M.size:M.pre_render_size
k=M.detail_type.exclusion}else{fe(g,Infinity,Infinity)
fe(E,-Infinity,-Infinity)
for(var B=0;B<M.bounds_len;++B){var U=M.bounds_idx+6*B
g[0]=se(g[0],M.bounds_buf[U])
E[0]=ne(E[0],M.bounds_buf[U+1])
g[1]=se(g[1],M.bounds_buf[U+2])
E[1]=ne(E[1],M.bounds_buf[U+3])}ve(E,E,g)
P=E
D=g}if(!k)k=P
var G=P[0]*P[1]
for(var F=0;F<P[1];++F){var W=D[1]+F
m[1]=W-d[1]
if(m[1]<0||m[1]>=_)continue
var j=0===F||F===P[1]-1
var H=W>=M.origin[1]&&W<M.origin[1]+k[1]
var z=W===M.origin[1]||W===M.origin[1]+k[1]-1
for(var V=0;V<P[0];++V){var Y=D[0]+V
m[0]=Y-d[0]
if(m[0]<0||m[0]>=c)continue
var q=H&&Y>=M.origin[0]&&Y<M.origin[0]+k[0]
var K=j||0===V||V===P[0]-1
var Z=q&&(z||Y===M.origin[0]||Y===M.origin[0]+k[0]-1)
var X=oe(m[0]*i)
var Q=oe(m[1]*i)
var J=0
if(l&&M.vd){var $=V+F*P[0]
for(var ee=0;ee<P[2];++ee)J+=M.vd.data[$+ee*G]?1:0
J/=P[2]}blendColor(X,Q,q?255:0,0,0,se((Z?.75:K?.5:.125)+4*J,1))}}}}for(var te in y){var re=y[te]
Te(re)
if(null!==re.hydro_output_vsid){var ae=ge(re.hydro_output_vsid)
pixelPos(p,de(p,ae.pos_world,[Ae,Ae]))
drawShape(p[0],p[1],Ne,0,128,255)}}if(!Re)Re=_e.load({name:"proc_gen_debug",format:_e.format.RGB8,width:c,height:_,data:f,filter_min:gl.NEAREST,filter_mag:gl.NEAREST})
else Re.updateData(c,_,f)
if(!xe)xe=ce({texs:[Re]})
console.log("Debug texture update in "+(Date.now()-r)+"ms")
dumpPerf()}function updateDebugTexture2(e){dumpPerf()
var t=Date.now()
var n=1024
var r=n
var a=16
var i=fe(Oe,-n*a/2,-r*a/2)
de(i,i,e)
fe(be,n*a,r*a)
var s=new Uint8Array(n*r*3)
function setColor(e,t,r,a,i){var o=3*(t*n+e)
s[o]=r
s[o+1]=a
s[o+2]=i}var o=ue()
var l=new k
for(var c=0;c<r;c++)for(var _=0;_<n;_++){fe(o,i[0]+_*a,i[1]+c*a)
B(l,o,false)
var u=l.hexomes
var d=l.blend_weights
he(Ce,0,0,0)
for(var f=0;f<u.length;++f){var v=u[f]
var h=d[f]
var p=v.params.debug_color
for(var m=0;m<3;++m)Ce[m]+=h*p[m]}if(0){var g=0
for(var E=1;E<d.length;++E)if(d[E]>d[g])g=E
T(Ce,u[g].params.debug_color)}var y=1
setColor(_,c,se(Ce[0]*y*255|0,255),se(Ce[1]*y*255|0,255),se(Ce[2]*y*255|0,255))}if(!Re)Re=_e.load({name:"proc_gen_debug",format:_e.format.RGB8,width:n,height:r,data:s,filter_min:gl.NEAREST,filter_mag:gl.NEAREST})
else Re.updateData(n,r,s)
if(!xe)xe=ce({texs:[Re]})
console.log("Debug texture update in "+(Date.now()-t)+"ms")
dumpPerf()}function fmt(e){if(!e)return e
if("number"===typeof e){if(e!==(0|e))return e.toFixed(3)
return e}if(3===e.length)return fmt(e[0])+","+fmt(e[1])+","+fmt(e[2])
if(2===e.length)return fmt(e[0])+","+fmt(e[1])
return JSON.stringify(e)}function hexomeDebug(e){var t=E(p(),e)
var r=g(p(),t,1/ie)
var a=y(r)
Se(a)
var i=m(p(),t,r,-ie)
pe(a,i,true)
var o=["HexomeDebugPos: cursor("+fmt(t)+"), chunk("+fmt(r)+")"]
for(var n=0;n<a.hexomes.length;++n){var s=a.hexomes[n]
var l=a.blend_weights[n]
var c=a.hexomes_cont.indexOf(s)
var _=-1===c?0:a.blend_weights_cont[c]
o.push("  Hexome-"+s.hid+" "+s.type.name+"-"+s.uid+" weight: "+fmt(l)+", baryc: "+fmt(_))
if(l>.1&&"Flat"!==s.type.name){o.push("    Continent: idx="+s.cont_idx+", elev="+s.cont_elevation+", classif="+s.classif)
o.push("      humid="+s.humidity.toFixed(2)+", cdist="+s.cdist+", slopes[3]="+s.slopes[3].toFixed(3))
if(s.river_bits)o.push("      river="+("00000"+s.river_bits.toString(2)).slice(-6)+", flow dir="+s.rflow_dir+" amt="+s.rflow_amt)
o.push("    water_level="+s.water_level)
if(s.river_mouth)o.push("    river_mouth")
if(s.hydro_inputs)for(var u=0;u<s.hydro_inputs.length;++u){var d=ge(s.hydro_inputs[u])
o.push("    HydroIn"+u+": "+fmt(d.pos_world)+","+fmt(d.mid_elevation)+"/"+fmt(d.mid_elevation_eroded))}if(null!==s.hydro_output_vsid){var f=ge(s.hydro_output_vsid)
o.push("    HydroOut: "+fmt(f.pos_world)+","+fmt(f.mid_elevation)+"/"+fmt(f.mid_elevation_eroded))}}}var v=a.map[i[1]][i[0]]
for(var h in v)o.push("  computed "+h+": "+fmt(v[h]))
A.addText(o.join("\n"))}var f=function(){var v=ue()
var h=ue()
var p=ue()
var m=_(0,1,1,0)
var g=new k
var E=0
var y=E
var T=0
var I=E
return function(){O(v,L(),P.origin_chunk,ie)
if(!Re||v[0]<Oe[0]+.125*be[0]||v[0]>Oe[0]+.875*be[0]||v[1]<Oe[1]+.125*be[1]||v[1]>Oe[1]+.875*be[1]||y!==E||I!==T){M(v,v,1/ie)
N(v,v)
M(v,v,ie)
b(p,v)
if(0===E)updateDebugTexture(v,T)
else updateDebugTexture2(v)
y=E
I=T}var e=900
var t=S.x1()-50-e
var r=50
var a=Z.UI+50
xe.draw({x:t,y:r,w:e,h:e,z:a,uvs:m})
if(R.buttonText({x:t-200,y:r,z:a+1,w:200,h:50,text:"Mode: "+E})){E=1-E
T=0
w.pointerLockExit()}if(0===E&&R.buttonText({x:t-200,y:r+50,z:a+1,w:200,h:50,text:"Submode: "+(T?"Post-render":"Layout")})){T=1-T
w.pointerLockExit()}var i=10
ve(v,v,Oe)
D(v,v,be)
M(v,v,e)
x.sprite.draw({x:t+v[0]-i/2,y:r+e-v[1]-i/2,z:a+1,w:i,h:i,frame:x.X})
w.mousePos(h)
de(h,h,[-t,-r])
M(h,h,1/e)
h[1]=1-h[1]
C(h,h,be)
de(v,Oe,h)
B(g,v,true)
var o=g.hexomes[0]
var n=["Mouse pos: "+fmt(v),"  Hydro("+fmt(o.hid)+")"]
if(o.hydro_inputs)for(var s=0;s<o.hydro_inputs.length;++s){var l=ge(o.hydro_inputs[s])
n.push("    Input"+s+": "+fmt(l.pos_world)+","+fmt(l.mid_elevation)+"/"+fmt(l.mid_elevation_eroded))}if(null!==o.hydro_output_vsid){var c=ge(o.hydro_output_vsid)
n.push("    Output: "+fmt(c.pos_world)+","+fmt(c.mid_elevation)+"/"+fmt(c.mid_elevation_eroded))}for(var _=0;_<g.hexomes.length;++_){var u=g.hexomes[_]
n.push("  Hexome "+u.type.name+"-"+u.uid+" weight: "+fmt(g.blend_weights[_])+" hid: "+u.hid+" slopes: "+Array.prototype.map.call(u.slopes||[],function(e){return(100*e).toFixed(0)}))}for(var d=0;d<g.hexomes_noisy.length;++d){var f=g.hexomes_noisy[d]
n.push("  Hexome "+f.type.name+"-"+f.uid+" noisy weight: "+fmt(g.blend_weights_noisy[d]))}A.addText(n.join("\n"))}}()
r.drawDebug=f},{"../common/globals.js":197,"../glov/client/camera2d.js":241,"../glov/client/engine.js":250,"../glov/client/input.js":271,"../glov/client/sprites.js":302,"../glov/client/textures.js":304,"../glov/client/ui.js":306,"../glov/common/vmath.js":332,"./debug.js":62,"./main.js":112,"./proc_gen.js":132,"./proc_gen_biomes.js":133,"./proc_gen_hydro.js":137,"./proc_gen_shared.js":138,"./task_sched.js":161,"./ui_util.js":168,"./voxel_data.js":175}],136:[function(e,t,r){"use strict"
r.i32Alloc=i32Alloc
r.f32Alloc=f32Alloc
r.detailGenSeed=detailGenSeed
r.detailGenSetData=detailGenSetData
r.detailGenMCIDs=detailGenMCIDs
r.detailGenMCIDs2=detailGenMCIDs2
r.detailGenGetHighest=detailGenGetHighest
r.detailGenLocal=detailGenLocal
r.detailGenGetDebugData=detailGenGetDebugData
r.detailStartup=detailStartup
r.MAX_DETAIL_REACH=r.DETAILS_CURRENT_VERSION=void 0
var a=e("../common/globals.js"),E=a.CHUNK_SIZE,w=a.ID_FACTOR,L=a.ID2,R=a.MEGACHUNK_SIZE,x=a.MEGACHUNK_VOXEL_SIZE
var i=1
r.DETAILS_CURRENT_VERSION=i
var o=R/2
var T=(o-1)*E
r.MAX_DETAIL_REACH=T
var O=e("assert")
var n=e("./cave_generators.js"),s=n.caveGenBoring,l=n.caveGenMaze,c=n.caveGenSphere,_=n.oreVeinGen
var b=Math.floor,N=Math.round
var p=e("../common/megachunk_common.js").parseChunkId
var u=e("./proc_gen_constants.js"),C=u.HEX_HEIGHT,M=u.HEX_WIDTH
var d=e("./proc_gen_biomes.js")
var f=e("./proc_gen_biomes.js"),D=f.getHexome,P=f.getVerticalSliceById
var v=e("./proc_gen_shared.js")
var h=e("../glov/common/rand_alea.js").randCreate
var m=e("../glov/common/verify.js")
var g=e("../glov/common/vmath.js"),y=g.ivec3,I=g.vec3,k=g.v3iScale,S=g.v3scaleFloor,A=g.v3add,B=g.v3addScale,U=g.v3scale,G=g.unit_vec
var F=v.phase_counts,W=v.phase_timing
var j
var H=o
var z=4*E
var V=10
var Y=-20
var q=256
var K=.5
var Z=16384
var X
var Q
var J
var $=Z
function sharedBufAlloc(){X=new ArrayBuffer(4*Z)
Q=new Int32Array(X)
J=new Float32Array(X)
$=0}function i32Alloc(e){O(e>=0&&e<=1024)
if($+e>Z)sharedBufAlloc()
var t=$
$+=e
return[Q,t]}function f32Alloc(e){O(e>=0&&e<=1024)
if($+e>Z)sharedBufAlloc()
var t=$
$+=e
return[J,t]}function DetailMegaChunks(){}var ee
function DetailMegaChunk(e,t){this.mcid=e
this.phase=0
O.equal(typeof t.ver,"number")
O.equal(typeof t.seed,"number")
this.ver=t.ver
this.seed=t.seed
this.midchunks=[]}DetailMegaChunk.prototype.dispose=function(){var e=this.details
if(e){for(var t=0;t<e.length;++t)e[t].dispose()
this.details=null}this.midchunks=null}
DetailMegaChunk.prototype.addDetail=function(e,t){var r=this
var a=e.bounds_buf,i=e.bounds_idx,o=e.bounds_len
var n={}
for(var s=0;s<o;++s){var l=i+6*s
var c=b(a[l]/z)
var _=b((a[l+1]-1)/z)
var u=b(a[l+2]/z)
var d=b((a[l+3]-1)/z)
var f=b(a[l+4]/z)
var v=b((a[l+5]-1)/z)
for(var h=f;h<=v;++h)for(var p=u;p<=d;++p)for(var m=c;m<=_;++m)n[(h*w+p)*w+m]=1
for(var g=0;g<3;++g){O(t[g]-a[l+2*g]<T)
O(a[l+2*g+1]-t[g]<=T)}}for(var E in n){var y=r.midchunks[E]
if(!y)y=r.midchunks[E]=[]
y.push(e)}r.details.push(e)}
var te=6e4
var re
var ae
var ie
function detailCleanupElem(e){if(e.last_use_time<ie){e.cleanup()
e.last_use_time=0
return false}return true}function detailCleanup(){profilerStart("detailCleanup")
ae=null
ie=Date.now()-te
re=re.filter(detailCleanupElem)
detailCleanupSchedule()
profilerStop("detailCleanup")}function detailCleanupSchedule(){if(re.length&&!ae)ae=setTimeout(detailCleanup,te/2)}function detailGenSeed(e){ee=new DetailMegaChunks
re=[]}function detailGenSetData(e,t){if(t){var r=ee[e]
O(!r||r.ver===t.ver&&r.seed===t.seed)
if(!r)ee[e]=new DetailMegaChunk(e,t)}else{O(ee[e])
ee[e].dispose()
delete ee[e]}}function typeChoice(e,t){var r=e*t.total
var a=t.list,i=t.count
var o
for(var n=0;n<a.length;++n){var s=a[n]
if(s[2]&&i[n]===s[2])continue
o=n
if((r-=s[0])<=0){if(s[2]){i[n]++
if(i[n]===s[2])t.total-=s[0]}break}}return o}function listTotal(e){var t=0
for(var r=0;r<e.length;++r)t+=e[r][0]
return t}var oe=1
var ne=.25
var se=.03
var le={}
function optsForVer(e){if(le[e])return le[e]
var t=[]
var r=[0,0]
if(e>0){t.push([oe,s,0,V])
t.push([ne,c,4,-20])
t.push([se,l,1,-300])
r=[150,50]}var a=[]
var i=[0,0]
if(e>0){a.push([oe,_,0,Y])
i=[750,50]}return le[e]={caves:t,caves_total:listTotal(t),caves_range:r,ores:a,ores_total:listTotal(a),ores_range:i}}var ce=h()
var _e=y()
var ue=y()
function detailGenInitPhase1(m){if(m.phase>=1)return 0
m.phase=1
m.details=[];++F.d1
var e=Date.now()
var t=m.mcid
_e[2]=N(t/L)
var g=(t-=_e[2]*L)*R
_e[1]=N(t/w)
t-=_e[1]*w
_e[0]=t
k(_e,x)
var E=0
function spawnCaves(e,t,r,a,i){var o=[]
for(var n=0;n<t.length;++n)o.push(0)
var s={list:t,total:r,count:o}
for(var l=0;l<e;++l){var c=t[typeChoice(ce.random(),s)]
var _=c[1]
var u=c[3]
ue[0]=ce.range(x)
ue[1]=ce.range(x)
ue[2]=_e[2]+ce.range(x)
var d=ce.uint32()
var f=g+(ue[0]>>4)+(ue[1]>>4)*w
var v=P(f)
if(ue[2]>=v.mid_elevation+u)continue
var h=ce.random()
if(ue[2]>=v.mid_elevation-a&&h<i)continue
ue[0]+=_e[0]
ue[1]+=_e[1]
var p=_(d,ue,v)
O(p.bounds_buf)
O(p.bounds_idx>=0)
O(p.bounds_len<31)
O(!p.seed||p.seed===d)
p.seed=d
O(!p.uid)
p.uid=++E
p.owner_mcid=m.mcid
m.addDetail(p,ue)}}var r=optsForVer(m.ver),a=r.caves,i=r.caves_total,o=r.caves_range,n=r.ores,s=r.ores_total,l=r.ores_range
ce.reseed(m.seed)
var c=ce.uint32()
spawnCaves(o[0]+ce.range(o[1]),a,i,q,K)
ce.reseed(c)
spawnCaves(l[0]+ce.range(l[1]),n,s,-Infinity,0)
var _=b(_e[0]/M)-1
var u=b((_e[0]+x-1)/M)+1
t=m.mcid
for(var d=_;d<=u;++d){var f=_e[1]+d*C/2
var v=b(f/C)-1
var h=b((f+x-1)/C)+1
for(var p=v;p<=h;++p){var y=D(d+p*w)
j(y)
for(var T=0;T<y.details.length;++T){var I=y.details[T]
var S=I.origin
if(I.owner_mcid===t)m.addDetail(I,S)}}}var A=Date.now()-e
W.d1+=A
W.d2-=A
return A}function cmpPriority(e,t){var r=e.priority-t.priority
if(r)return r
if(r=e.seed-t.seed)return r
return e.uid-t.uid}function boundsOverlap(e,t,r){var a=r.bounds_buf,i=r.bounds_idx,o=r.bounds_len
var n=0
for(var s=0;s<o;++s,i+=6)if(t[0]>a[i]&&e[0]<a[i+1]&&t[1]>a[i+2]&&e[1]<a[i+3]&&t[2]>a[i+4]&&e[2]<a[i+5])n|=1<<s
return n}function boundsOverlapMaxZ(e,t,r,a){var i=a.bounds_buf,o=a.bounds_idx,n=a.bounds_len
for(var s=0;s<n;++s,o+=6){var l=i[o+5]
if(l>e)if(r[0]>i[o]&&t[0]<i[o+1]&&r[1]>i[o+2]&&t[1]<i[o+3]&&r[2]>i[o+4]&&t[2]<l)e=l}return e}var de=[0,1,w,w+1,L,L+1,L+w,L+w+1]
var fe=1/R
var ve=-H/R
function detailGenMCIDs(e){var t=b(e[0]*fe+ve)
var r=b(e[1]*fe+ve)
return[(b(e[2]*fe+ve)*w+r)*w+t,de]}var he=1
function detailGenMCIDs2(e,t){var r=b(t[0]*fe)
var a=b(t[1]*fe)
var i=(b(t[2]*fe)*w+a)*w+r
var o=b(t[0]*fe-he)
var n=b(t[0]*fe+he)
var s=b(t[1]*fe-he)
var l=b(t[1]*fe+he)
var c=b(t[2]*fe-he)
var _=b(t[2]*fe+he)+1
var u=0
for(var d=c;d<=_;++d)for(var f=s;f<=l;++f)for(var v=o;v<=n;++v){i=(d*w+f)*w+v
e[u++]=i}return u}var pe=I()
var me=I()
var ge=y()
function detailBlocked(e){var t=e.blocked_origin,r=e.blocked_size
B(me,t,r,.5)
me[2]=t[2]
U(pe,me,1/E)
A(ge,t,r)
var a=detailGenMCIDs(pe),i=a[0],o=a[1]
var n=b(me[0]/z)+b(me[1]/z)*w+b(me[2]/z)*L
var s=r[2]
for(var l=0;l<o.length;++l){var c=i+o[l]
var _=ee[c]
O(_)
if(!_)continue
detailGenInitPhase1(_)
var u=_.midchunks[n]
if(u)for(var d=0;d<u.length;++d){var f=u[d]
var v=boundsOverlap(t,ge,f)
if(v)if(f.blocksOther(e,me,s,v))return true}}return false}var Ee=y()
function detailGenGetHighest(e){B(Ee,e,G,E)
Ee[2]=2147483647
S(pe,e,1/E)
var t=detailGenMCIDs(pe),r=t[0],a=t[1]
var i=b(e[0]/z)+b(e[1]/z)*w+b(e[2]/z-1)*L
var o=i+x/z*L
var n=-Infinity
for(var s=0;s<a.length;++s){var l=r+a[s]
var c=ee[l]
if(!m(c))continue
detailGenInitPhase1(c)
for(var _=i;_<=o;_+=L){var u=c.midchunks[_]
if(!u)continue
for(var d=0;d<u.length;++d)n=boundsOverlapMaxZ(n,e,Ee,u[d])}}return n-1}function detailGenLocal(e){var t=Date.now()
F.d2++
var r=e.vd
var a=r.pos_world
B(Ee,a,G,E)
var i=detailGenMCIDs(r.pos),o=i[0],n=i[1]
var s=b(a[0]/z)+b(a[1]/z)*w+b(a[2]/z)*L
var l=[]
for(var c=0;c<n.length;++c){var _=o+n[c]
var u=ee[_]
O(u)
if(!u)continue
detailGenInitPhase1(u)
var d=u.midchunks[s]
if(!d)continue
for(var f=0;f<d.length;++f){var v=d[f]
if(v.blockable&&!v.blocked_check){v.blocked=detailBlocked(v)
v.blocked_check=true}if(v.blocked)continue
var h=boundsOverlap(a,Ee,v)
if(h){v.last_bits=h
l.push(v)}}}l.sort(cmpPriority)
var p=Date.now()
W.d2+=p-t
for(var m=0;m<l.length;++m){F.d3++
var g=l[m]
g.genLocal(e)
if(g.cleanup){if(!g.last_use_time)re.push(g)
g.last_use_time=p}}detailCleanupSchedule()
W.d3+=Date.now()-p}function detailGenGetDebugData(e,t){var r=detailGenGetDebugData.pos_world
if(!r)r=detailGenGetDebugData.pos_world=y()
var a=p(e)
U(r,a.chunk_pos,E)
B(Ee,r,G,E)
var i=detailGenMCIDs(a.chunk_pos),o=i[0],n=i[1]
var s=b(r[0]/z)+b(r[1]/z)*w+b(r[2]/z)*L
var l=[]
for(var c=0;c<n.length;++c){var _=o+n[c]
var u=ee[_]
if(!u)continue
detailGenInitPhase1(u)
var d=u.midchunks[s]
if(d)for(var f=0;f<d.length;++f){var v=d[f]
var h=boundsOverlap(r,Ee,v)
if(h){v.last_bits=h
l.push(v)}}}l.sort(cmpPriority)
t(l=l.map(function(e){return e.toJSON?e.toJSON():e}))}function detailStartup(){j=d.initPhase50}},{"../common/globals.js":197,"../common/megachunk_common.js":202,"../glov/common/rand_alea.js":327,"../glov/common/verify.js":331,"../glov/common/vmath.js":332,"./cave_generators.js":29,"./proc_gen_biomes.js":133,"./proc_gen_constants.js":134,"./proc_gen_shared.js":138,assert:void 0}],137:[function(e,t,r){"use strict"
r.initPhase37=initPhase37
r.uninitPhase37=uninitPhase37
r.setLODMode=setLODMode
r.seedWorld=seedWorld
r.hydroChunkInitRange=void 0
var D=e("assert")
var a=e("../common/globals.js"),i=a.CHUNK_SIZE,_=a.ID_FACTOR
var P=Math.abs,u=Math.ceil,d=Math.floor,k=Math.max,B=Math.min,o=Math.sqrt
var U=e("./priority_queue.js")
var n=e("./proc_gen_constants.js"),s=n.HEX_EDGE,f=n.HEX_HEIGHT,v=n.SKEW_X,l=n.C_RIVER_DELTA
var c=e("./proc_gen_biomes.js")
var h=e("./proc_gen_shared.js")
var p=e("./rand_seed.js")
var m=e("../glov/common/util.js"),G=m.clamp,F=m.lerp
var g=e("../glov/common/vmath.js"),E=g.vec2,W=g.v2add,y=g.v2addScale,T=g.v2scale
var j=h.neighbor_id_offs,H=h.phase_counts,z=h.phase_timing
var I=c.flushVerticalSlices,V=c.getVerticalSliceById,Y=c.getVerticalSliceWorldPos,q=c.getHexome
var K=i/2
var Z=40
var S=u(f/i)
var X=(S+1)*(S+1)
var Q
var J
var $=false
function seedHydro(e){return e.seed+4321}var A=[1,1,2,3,4,6]
var w=[1,1,3,4,6,8]
function hydroInit(e,t,r,a){if(e.hydro_init)return
e.hydro_init=true
var i=p.createGood(seedHydro(e))
var o=B(a,5)
var n=A[o]
var s=w[o]
e.hydro_width=n+i.random()*s
e.hydro_jitter_x=i.range(9)-4
e.hydro_jitter_y=i.range(9)-4
e.hydro_elev=t}var ee=[_,_+1,1,-_,-_-1,-1]
var L=o(.75)
var R=[[E(-s/2,f/2),E(1,0)],[E(s/2,f/2),E(.5,-L)],[E(s,0),E(-.5,-L)],[E(s/2,-f/2),E(-1,0)],[E(-s/2,-f/2),E(-.5,L)],[E(-s,0),E(.5,L)]]
R.forEach(function(e){return T(e[1],e[1],i)})
var x=s/i-4
function addRiverMouths(e,t,r){if(e<1)return false
if(t.classif===l&&t.rflow_amt>1)return true
if(!t.river_bits)return false
for(var a=0;a<ee.length;++a){var i=t.hid+ee[a]
if(i===r)continue
var o=q(i)
if(0!==o.rflow_amt)if(addRiverMouths(e-1,o,t.hid))return true}return false}var O=E()
function initPhase35(e){if(e.phase>=35||!e.river_bits)return;++H[35]
var t=Date.now()
e.phase=35
var r=e.rflow_dir
if(7===r);else{D(r>=0&&r<6)
var a=R[r]
W(O,e.pos_world,a[0])
var i=a[1]
y(O,O,i,1.5)
var o=null
var n=Infinity
for(var s=0;s<x;++s){W(O,O,i)
var l=Y(O)
var c=l.mid_elevation
if(c<n){n=c
o=l.vsid}}e.hydro_output_vsid=o}z[35]+=Date.now()-t}var te=[2,1,2,1,1,2,1,2]
var re=50
var ae=50
var ie=[[s/4,s/4],[-s/4,s/4],[s/4,-s/4],[-s/4,-s/4]]
var oe=E()
function rflowToErosion(e){return G((e-1)/2,0,1)}function getVSID(e){return e.vsid}var ne=false
function verticalSliceClear(){profilerStart("verticalSliceClear")
ne=false
I()
Q=c.vertical_slices
profilerStop("verticalSliceClear")}function initPhase37(y){if(y.phase>=37)return;++H[37]
var e=Date.now()
if($&&!ne){ne=true
setTimeout(verticalSliceClear,1e3)}initPhase35(y)
y.phase=37
if(addRiverMouths(6,y,null))y.river_mouth=true
var t=y.river_bits,r=y.hid,a=y.rflow_dir
if(7===a){D(!t)
for(var i=0;i<ee.length;++i){var o=r+ee[i]
if(q(o).river_bits&1<<(i+3)%6)t|=1<<i}D(t)}var n=[]
var s=[]
for(var l=0;l<ee.length;++l)if(l!==a&&t&1<<l){var c=r+ee[l]
var _=q(c)
initPhase35(_)
D(null!==_.hydro_output_vsid)
D(_.rflow_dir===(l+3)%6)
n.push(V(_.hydro_output_vsid))
s.push(_.rflow_amt)}if(!n.length&&null===y.hydro_output_vsid){z[37]+=Date.now()-e
return}y.hydro_inputs=n.map(getVSID)
var T=[]
var I={}
var S={}
var u=y.water_level
function connect(m,g,E){if(m.mid_elevation<g.mid_elevation){var e=m
m=g
g=e}var o=g.mid_elevation
function costEstimate(e){return P(e.pos_world[0]-g.pos_world[0])+P(e.pos_world[1]-g.pos_world[1])}function addPath(e){var t=rflowToErosion(E)
var r=Infinity
var a=rflowToErosion(y.rflow_amt)
var i=m.owner_hexome.type.min_erosion||0
var o=g.owner_hexome.type.min_erosion||0
var n=g.mid_elevation_eroded
for(var s=0;s<e.length;++s){var l=e[s]
var c=l[3]
var _=Q[c]
var u=s/(e.length-1)
var d=F(u,t,a)
var f=F(u,i,o)
var v=F(d,_.mid_elevation,_.mid_elevation_eroded)
if(v>_.mid_elevation-f)v=k(_.mid_elevation-f,_.mid_elevation_eroded)
if(v>r)v=r
else{if(v<n)v=n
r=B(r,v)}l[2]=v
var h=I[c]
if(!h)I[c]=[v,d]
else{h[0]=B(v,h[0])
h[1]=k(d,h[1])}var p=S[c]
if(p)if(p===E)S[c]=E+1
else S[c]=k(E,p)
else S[c]=E}T.push(e)}var t=X
var n=U.create()
var s={}
var l={}
var c={}
var _={}
function queue(e,t,r){var a=e.vsid
if(s[a])return
if(t&&e!==g&&e.mid_hexome_exact!==y)return
var i=r
if(t)i+=k(0,e.mid_elevation-t.mid_elevation+1)*re
if(e.mid_elevation<o)i+=(o-e.mid_elevation)*ae
if(l[a]){if(i>=c[a])return
n.remove(e)}else l[a]=true
c[a]=i
e.score=i+costEstimate(e)
_[a]=t
n.add(e)}queue(m,null,0)
var r
while(r=n.pop()){D(--t)
if(r===g){var a=[]
while(r){a.push([r.pos_world[0]+K,r.pos_world[1]+K,1e3,r.vsid,0])
r=_[r.vsid]}a.reverse()
addPath(a)
break}var i=r.vsid
var u=c[i]
l[i]=false
s[i]=true
for(var d=0;d<j.length;++d){var f=i+j[d]
queue(V(f),r,u+te[d])}}}var d=Y(y.pos_world)
var f=null!==y.hydro_output_vsid&&V(y.hydro_output_vsid)
var v=f
if(!v){var h=(v=d).mid_elevation
for(var p=0;p<ie.length;++p){W(oe,y.pos_world,ie[p])
var m=Y(oe)
if(m.mid_elevation<h)h=(v=m).mid_elevation}h=B(u,h)
for(var g=0;g<n.length;++g)h=B(h,n[g].mid_elevation)}for(var E=0;E<n.length;++E)connect(n[E],v,s[E])
if(f&&!n.length){y.hydro_source_vsid=d.vsid
connect(d,f,y.rflow_amt)}if($)for(var A in S)J[A]=S[A]
else{for(var w=0;w<T.length;++w){var L=T[w]
var R=L[0][2]
for(var x=0;x<L.length;++x){var O=L[x]
var b=O[3]
var N=I[b]
O[2]=R=B(N[0],R)
var C=Q[b]
var M=S[b]+(R<=u?1:0)
hydroInit(C,R,N[1],M)
O[0]+=C.hydro_jitter_x
O[1]+=C.hydro_jitter_y
if(y.river_mouth){O[4]=C.hydro_width+G(Z-2*(R-u),0,Z)
O[2]-=G(Z-(R-u),0,Z)}else O[4]=C.hydro_width}}if(T.length)y.hydro_paths=T}z[37]+=Date.now()-e}function uninitPhase37(e){if(e.phase<37)return
D.equal(e.phase,37)
e.hydro_paths=null
e.phase=35}var b=function(){var c=E()
return function(e,t){T(c,e,1/f)
var r=d(c[0]*v)
var a=r+(u(t/f*v)+1)
var i=u(t/f)+1
for(var o=r;o<=a;++o){var n=d(c[1]+.5*o)
var s=n+i
for(var l=n;l<=s;++l)initPhase37(q(l*_+o))}}}()
r.hydroChunkInitRange=b
function setLODMode(){$=true
c.setLODMode()}function seedWorld(e){Q=c.vertical_slices
J=c.rflow_cache}},{"../common/globals.js":197,"../glov/common/util.js":330,"../glov/common/vmath.js":332,"./priority_queue.js":131,"./proc_gen_biomes.js":133,"./proc_gen_constants.js":134,"./proc_gen_shared.js":138,"./rand_seed.js":145,assert:void 0}],138:[function(e,t,r){"use strict"
r.intNoise=intNoise
r.phase_counts=r.phase_timing=r.neighbor_id_offs=void 0
var a=e("../common/globals.js").ID_FACTOR
var n=Math.floor
var i=[30,35,37,40,50,60,70,"d1","d2","d3",90,100,"zm"]
var o=[-a-1,-a,1-a,-1,1,a-1,a,a+1]
r.neighbor_id_offs=o
var s={}
r.phase_timing=s
var l={}
r.phase_counts=l
i.forEach(function(e){s[e]=0
l[e]=0})
function intNoise(e,t,r,a,i){var o=n((.5+.5*e.noise2D(t[0]*r+a,t[1]*r))*i)
if(o===i)o=i-1
return o}},{"../common/globals.js":197}],139:[function(e,t,r){"use strict"
r.showPrompt=showPrompt
var a=e("../glov/client/net.js").netSubs
function showPrompt(e,t){var r=a().getMyUserChannel()
if(!r.getChannelData("public.prompts_seen."+e)){t()
r.send("consume_prompt",e)}}},{"../glov/client/net.js":279}],140:[function(e,t,r){"use strict"
r.savingMessage=savingMessage
r.propEditDialog=propEditDialog
r.saveProp=saveProp
r.propEdit=propEdit
r.doPropEdit=doPropEdit
r.BUTTON_H=r.BUTTON_W=void 0
var s=240
r.BUTTON_W=s
var l=48
r.BUTTON_H=l
var c=e("./localization/localization").L
var _=e("assert")
var u=e("../glov/client/cmds.js").cmd_parse
var n=e("../glov/client/input.js")
var a=e("./layout.js"),i=a.layoutCameraSquare,o=a.layoutCameraPush,d=a.layoutCameraPop
var f=e("./main.js"),v=f.getFrameTransaction,h=f.menuExit,p=f.toggleMenuPage
var m=e("./menu.js"),g=m.PROP_EDIT,E=m.menuInteractGetProp
var y=e("../glov/client/words/profanity.js").profanityFilter
var T=e("./status.js")
var I=e("./styles.js").label_style
var S=e("../glov/client/ui.js")
var A=e("./voxel_data.js").transPropUpdate
function savingMessage(e){var t=T.get("saving")
t.setMessage(e)
if(!t.pos){o()
i()
t.setPos(500,1e3-l)
d()}t.fade()}var w=false
function propEditDialog(){return w}function finishEditDialog(){w=false}function saveProp(t,e){if(!t.existsInWorld()){savingMessage(c.STATUSMSG_SAVE_FAILED_NO_PROP)
return}t.property_edit_locked=true
if(e)e(t)
var r=v()
A(r,t,false)
savingMessage(c.MSG_SAVING)
t.transBusy(r)
r.onComplete(function(e){t.property_edit_locked=false
savingMessage(e?c.STATUSMSG_SAVE_FAILED:c.MSG_SAVED)})}function saveField(e,t,r){finishEditDialog()
e[t.key]=r
saveProp(e,t.on_change)}function chainedModalDialog(e){if(n.pointerLocked())n.pointerLockExit()
S.modalDialog(e)}function confirmEdit(e,t,r,a){if(t.confirm_msg)chainedModalDialog({title:c.DLG_ARE_YOU_SURE_TITLE,text:t.confirm_msg,buttons:{OK:{cb:function cb(){saveField(e,t,r)},in_event_cb:a},Cancel:{cb:finishEditDialog,in_event_cb:a}}})
else saveField(e,t,r)}function propEditTextEntry(a,i,e){var o=!n.touch_mode&&e?n.pointerLockEnter:null
w=true
var t={}
t.OK={cb:function cb(e){var t=i.profanity_filter||i.profanity_lock?y(e.trim()):e.trim()
if(t!==e.trim()&&i.profanity_lock)chainedModalDialog({title:c.DLG_ERROR_TITLE,text:c.DLG_INVALID_VALUE_INSERTED_MSG,buttons:{OK:{cb:finishEditDialog,in_event_cb:o}}})
else{var r=t||""
if(r!==a[i.key])confirmEdit(a,i,r,o)}},in_event_cb:o}
if(i.allow_clear&&a[i.key])t.Clear={cb:function cb(e){confirmEdit(a,i,"",o)},in_event_cb:o}
t.Cancel={cb:finishEditDialog,in_event_cb:o}
S.modalTextEntry({edit_text:a[i.key]||"",title:i.label,text:i.msg||c.$(c.DLG_ENTER_NEW_VALUE_MSG,i.key),max_len:i.max_len||100,buttons:t})}var L
var R
function propEdit(e,t){var r=t.fields,a=t.direct
L=r
R=e.item_id
if(1===r.length&&a)propEditTextEntry(e,r[0],true)
else p(g,e.interactDetails())}var x=c.LBL_PROPERTY_EDITOR
function doPropEdit(){var e=S.font
var t=E()
if(!t||!(t.item_id===R||t.prop_edit_ids&&t.prop_edit_ids[t.item_id])){h()
return x}var r=S.button_height+24
var a=500
var i=Z.UI
for(var o=0;o<L.length;++o){var n=L[o]
e.drawSizedAligned(I,a-8,r,i,S.font_height,e.ALIGN.HRIGHT|e.ALIGN.VCENTER,0,l,n.label)
n.type=n.type||u.TYPE_STRING
switch(n.type){case u.TYPE_STRING:if(S.buttonText({x:a,y:r,z:i,text:t[n.key]||c.addEllipsis(""),h:l,w:s}))propEditTextEntry(t,n,false)
break
default:_(false)}r+=l+4}return x}},{"../glov/client/cmds.js":244,"../glov/client/input.js":271,"../glov/client/ui.js":306,"../glov/client/words/profanity.js":310,"./layout.js":99,"./localization/localization":108,"./main.js":112,"./menu.js":117,"./status.js":156,"./styles.js":160,"./voxel_data.js":175,assert:void 0}],141:[function(e,t,r){"use strict"
r.rotToVec=rotToVec
r.validMushroomType=validMushroomType
r.validFlowerType=validFlowerType
r.mapToNameKeyFromFlowerType=mapToNameKeyFromFlowerType
r.drawBlock=drawBlock
r.startup=startup
r.trueBuzzerID=trueBuzzerID
r.isSpotlitBuzzer=isSpotlitBuzzer
r.drawBagSet=drawBagSet
r.bagDraw=bagDraw
r.bagCalcDrawOffs=bagCalcDrawOffs
r.createFromInv=createFromInv
r.createIndicatorProp=createIndicatorProp
r.createBag=createBag
r.saveGlobalState=saveGlobalState
r.restoreGlobalState=restoreGlobalState
r.hasForPreview=hasForPreview
r.getForPreview=getForPreview
r.propDebugGetFieldName=propDebugGetFieldName
r.fromJSON=fromJSON
r.propClone=propClone
r.tickProps=tickProps
r.bagAddTrans=r.color_interact_water_place=r.color_interact_water=r.color_prop_preview=r.NO_PICKUP_DELAY=r.inv_rot_mat_flipped=r.rot_mat_flipped=r.inv_rot_mat=r.rot_mat=r.PIEB_CHECK_MAX_SIZE=r.PIEB_CHECK_CUR_SIZE=r.PIEB_CHECK_ROOT=r.PREVIEW_HELD=r.PREVIEW_SNAPSHOT=r.PREVIEW_PLACE=r.PROP_TERMINAL_VELOCITY=r.PROP_GRAVITY=void 0
var a,i
function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype)
_setPrototypeOf(e.prototype.constructor=e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){e.__proto__=t
return e})(e,t)}var o=e("../common/globals")
var n=o.CHUNK_SIZE
var s=o.CS2
var l=o.VOXELS_PER_M
var c=-9.8*l/1e3/1e3
r.PROP_GRAVITY=c
var _=-.00625*l
r.PROP_TERMINAL_VELOCITY=_
var u=0
r.PREVIEW_PLACE=u
var d=1
r.PREVIEW_SNAPSHOT=d
var f=2
r.PREVIEW_HELD=f
var v=0
r.PIEB_CHECK_ROOT=v
var h=1
r.PIEB_CHECK_CUR_SIZE=h
var p=2
r.PIEB_CHECK_MAX_SIZE=p
var m=[new Int32Array([1,0,0,1]),new Int32Array([0,-1,1,0]),new Int32Array([-1,0,0,-1]),new Int32Array([0,1,-1,0])]
var g=[(r.rot_mat=m)[0],m[3],m[2],m[1]]
r.inv_rot_mat=g
var E=[new Int32Array([-1,0,0,1]),new Int32Array([0,-1,-1,0]),new Int32Array([1,0,0,-1]),new Int32Array([0,1,1,0])]
var y=r.rot_mat_flipped=E
r.inv_rot_mat_flipped=y
r.propFromJSON=fromJSON
r.propCreate=createFromInv
var S=e("assert")
var T=e("gl-mat4/translate")
var I=e("../glov/client/cmds").cmd_parse
var A=e("../glov/client/engine")
var w=e("../glov/client/font")
var L=e("../glov/client/input")
var R=e("../glov/client/localization").getStringFromLocalizable
var x=e("../glov/client/mat4ScaleRotateTranslate")
var O=e("../glov/client/net")
var b=e("../glov/client/quat")
var N=b.createQuat
var C=b.qFromAxisAngle
var M=b.qRotateZ
var D=b.qTransformVec3
var P=e("../glov/client/settings")
var k=e("../glov/client/shaders")
var B=e("../glov/client/snapshot").snapshot
var U=e("../glov/client/ui")
var G=e("../glov/client/webfs").webFSGetFile
var F=e("../glov/common/util")
var W=F.clone
var j=F.cloneShallow
var H=F.easeIn
var z=F.easeOut
var V=F.merge
var Y=F.msToTimeString
var q=F.nop
var K=F.toArray
var X=e("../glov/common/verify")
var Q=e("../glov/common/vmath")
var J=Q.half_vec
var $=Q.mat4
var ee=Q.unit_vec
var te=Q.v2addScale
var re=Q.v3add
var ae=Q.v3angle
var ie=Q.v3copy
var oe=Q.v3distSq
var ne=Q.v3floor
var se=Q.v3iAdd
var le=Q.v3iSub
var ce=Q.v3same
var _e=Q.v3set
var ue=Q.v3sub
var de=Q.v4copy
var fe=Q.v4lerp
var ve=Q.vec3
var he=Q.vec4
var pe=Q.zaxis
var me=Q.zero_vec
var ge=e("../common/entitlements").propToEntitlementKey
var Ee=e("../common/ids")
var ye=Ee.ITEM_ACCESS_CONTROL
var Te=Ee.ITEM_ANVIL
var Ie=Ee.ITEM_BAG
var Se=Ee.ITEM_BERRY
var Ae=Ee.ITEM_BERRY_BUSH_BLUE
var we=Ee.ITEM_BERRY_BUSH_RED
var Le=Ee.ITEM_BERRY_BUSH_YELLOW
var Re=Ee.ITEM_BLOCK_PREVIEW
var xe=Ee.ITEM_BLUEPRINT
var Oe=Ee.ITEM_BONFIRE
var be=Ee.ITEM_BONFIRE_METAL
var Ne=Ee.ITEM_BUCKET
var Ce=Ee.ITEM_BUZZERGOAL
var Me=Ee.ITEM_BUZZERSTART
var De=Ee.ITEM_CAMPFIRE
var Pe=Ee.ITEM_CARROT
var ke=Ee.ITEM_CHAIR
var Be=Ee.ITEM_CHEST_MEDIUM
var Ue=Ee.ITEM_CHEST_SMALL
var Ge=Ee.ITEM_CHEST_TALL
var Fe=Ee.ITEM_CHEST_TINY
var We=Ee.ITEM_CORN
var je=Ee.ITEM_DOOR
var He=Ee.ITEM_DOOR_DOUBLE
var ze=Ee.ITEM_DOWSER_ADVANCED
var Ve=Ee.ITEM_DOWSER_SIMPLE
var Ye=Ee.ITEM_ENERGY_WELL
var qe=Ee.ITEM_FACTORY_DEBUG
var Ke=Ee.ITEM_FIBER
var Ze=Ee.ITEM_FURNACE_GLASS
var Xe=Ee.ITEM_FURNACE_ORE
var Qe=Ee.ITEM_GEM
var Je=Ee.ITEM_HATCHET
var $e=Ee.ITEM_HOE
var et=Ee.ITEM_INDICATOR
var tt=Ee.ITEM_JUICE
var rt=Ee.ITEM_JUICER
var at=Ee.ITEM_KILN
var it=Ee.ITEM_LIQUID
var ot=Ee.ITEM_MILL
var nt=Ee.ITEM_MUSHROOM
var st=Ee.ITEM_OVEN
var lt=Ee.ITEM_PAINT_MIXER
var ct=Ee.ITEM_PARTICLE_DEBUGGER
var _t=Ee.ITEM_PICKAX
var ut=Ee.ITEM_PIE
var dt=Ee.ITEM_PLANT
var ft=Ee.ITEM_PUMPKIN
var vt=Ee.ITEM_SANDWICH
var ht=Ee.ITEM_SAWMILL
var pt=Ee.ITEM_SEEDS_CARROT
var mt=Ee.ITEM_SEEDS_CORN
var gt=Ee.ITEM_SEEDS_PUMPKIN
var Et=Ee.ITEM_SEEDS_SUGAR_CANE
var yt=Ee.ITEM_SEEDS_TOMATO
var Tt=Ee.ITEM_SEEDS_WHEAT
var It=Ee.ITEM_SHOVEL
var St=Ee.ITEM_SIGNBOARD
var At=Ee.ITEM_SIGNPOST
var wt=Ee.ITEM_SPICE
var Lt=Ee.ITEM_SPICE_PLANT
var Rt=Ee.ITEM_STONECUTTER_ADVANCED
var xt=Ee.ITEM_STONECUTTER_SIMPLE
var Ot=Ee.ITEM_SUGAR_CANE
var bt=Ee.ITEM_TOMATO
var Nt=Ee.ITEM_TOOL_HEAD_CAST
var Ct=Ee.ITEM_TORCH
var Mt=Ee.ITEM_VEINIUM_GRINDER
var Dt=Ee.ITEM_WATERING_SYSTEM
var Pt=Ee.ITEM_WAYGATE
var kt=Ee.ITEM_WHEAT
var Bt=Ee.ITEM_WILD_CROP
var Ut=Ee.ITEM_WORKBENCH
var Gt=Ee.TYPE_BLOCK
var Ft=Ee.TYPE_ITEM
var Wt=e("../common/items_common").getItemUnlockableVariantMethods
var jt=e("../common/materials_common").Mat
var Ht=e("../common/voxel_data_common")
var zt=Ht.ANIM_STYLE_BEAM
var Vt=Ht.ANIM_STYLE_PHYS
var Yt=Ht.ANIM_TYPE_PLAYER
var qt=Ht.ANIM_TYPE_POS
var Kt=e("./baking")
var Zt=Kt.bakedEmits
var Xt=Kt.bakedSize
var Qt=Kt.bakedSwapped
var Jt=Kt.bakedSwappedSimple
var $t=Kt.drawBaked
var er=e("./bluebox_edit_list")
var tr=er.blueboxEditListAdd
var rr=er.blueboxEditListRemove
var ar=er.blueboxEditListUpdate
var ir=e("./bluebox_ui")
var or=e("./bluebox_ui")
var nr=or.blueboxDrawForSnapshot
var sr=or.blueboxOnPlace
var lr=or.blueboxSelect
var cr=or.blueboxSelectProp
var _r=or.blueboxTickProp
var ur=or.blueprintCaptureEnabled
var dr=e("./blueprint")
var fr=dr.STATE_BUILD
var vr=dr.STATE_EDIT
var hr=dr.STATE_PRE_BUILD
var pr=dr.STATE_PRE_EDIT
var mr=dr.STATE_SELF_DESTRUCT
var gr=dr.blueprintGetDef
var Er=e("./build_mode")
var yr=e("./build_mode")
var Tr=yr.VU_TILE_BOX
var Ir=yr.VU_TILE_BRUSHSIZE2
var Sr=yr.VU_TILE_BRUSHSIZE3
var Ar=yr.VU_TILE_DIG_PROGRESS
var wr=yr.VU_TILE_RETICULE_DIG
var Lr=yr.VU_TILE_RETICULE_WATER
var Rr=yr.checkStaminaBeforeAction
var xr=yr.doStamina
var Or=yr.isEmptyOrBag
var br=yr.playSoundForMaterial
var Nr=yr.tempMat
var Cr=yr.unlimitedMode
var Mr=e("./camera").getActiveController
var Dr=e("./character_controller").dirToLookAngle
var Pr=e("./editvolume_client")
var kr=Pr.editVolumeForPos
var Br=Pr.inEditBounds
var Ur=Pr.waygateEditAllowedForPos
var Gr=e("./energy_well")
var Fr=Gr.energyWellCharged
var Wr=Gr.energyWellDrink
var jr=Gr.energyWellReadiness
var Hr=Gr.energyWellShouldAutoDrink
var zr=e("./factory_ui")
var Vr=zr.FACTORY_MAX_INPUT
var Yr=zr.FACTORY_MAX_OUTPUT
var qr=zr.FACTORY_PAUSED
var Kr=zr.FACTORY_STALLED
var Zr=zr.factoryCraftingInProgress
var Xr=zr.factoryGetProgressEstimator
var Qr=e("./floater")
var Jr=Qr.CompoundFloater
var $r=Qr.DEF_COMP_FLT_SCALE
var ea=Qr.DEF_FLT_SCALE
var ta=Qr.GraphicalFloater
var ra=Qr.ProgressBarFloater
var aa=Qr.SpriteFloater
var ia=Qr.TextFloater
var oa=Qr.drawFloaterSimple
var na=Qr.drawFloaterStack
var sa=e("./flora_constants")
var la=sa.ALL_PLANTS
var ca=sa.DEBUG_FLOWERS
var _a=sa.FLOWERS
var ua=sa.WILD_CROP_TO_CROP
var da=sa.WILD_CROP_TO_CROP_SEED
var fa=sa.WILD_CROP_TO_MODEL
var va=e("./inventory")
var ha=e("./inventory")
var pa=ha.INV_EQUIP
var ma=ha.INV_PLAYER
var ga=ha.findAddIdxList
var Ea=ha.findEquipAddIdx
var ya=ha.inventoryEmpty
var Ta=ha.itemListCompact
var Ia=ha.transInvAdd
var Sa=ha.transInvDec
var Aa=e("./item_anims").removeIncoming
var wa=e("./items")
var La=wa.createItem
var Ra=wa.isItem
var xa=wa.itemFromJSON
var Oa=wa.itemGetGfxQueued
var ba=wa.notLiquid
var Na=e("./localization/localization").L
var Ca=e("./main")
var Ma=e("./main").toggleMenuPage
var Da=e("./materials")
var Pa=Da.MATERIAL_CLASS
var ka=Da.MATERIAL_CODE_NAME
var Ba=Da.MaterialClass
var Ua=e("./menu")
var Ga=e("./palette").paletteStartup
var Fa=e("./particle_system")
var Wa=Fa.createDetachedParticlesFromList
var ja=Fa.createParticleSystemWithOwner
var Ha=Fa.particleStartup
var za=e("./prop_edit").propEdit
var Va=e("./quickbar")
var Ya=Va.bucketSelected
var qa=Va.consumeSelectedBucket
var Ka=Va.getSelected
var Za=e("./race_results").raceResults
var Xa=e("./rand_seed")
var Qa=e("./settlement").isSettlement
var Ja=e("./sky")
var $a=e("./status")
var ei=e("./styles")
var ti=ei.color_green
var ri=ei.color_trophies
var ai=ei.color_yellow
var ii=ei.floater_style
var oi=ei.floater_style_default
var ni=ei.floater_style_red
var si=ei.sign_font_style
var li=ei.style_trophies
var ci=e("./tiles")
var _i=e("./tiles")
var ui=_i.TILE_INTANGIBLE
var di=_i.TILE_PROP_BASE
var fi=_i.TILE_PROP_MAX
var vi=_i.TILE_TILLED
var hi=_i.TILE_TILLED_WATERED
var pi=_i.TILE_WATER
var mi=_i.priority_solid
var gi=_i.tile_map_default
var Ei=e("./ui_util")
var yi=e("./user_data")
var Ti=yi.establishSettlementAllowed
var Ii=yi.isWaiting
var Si=yi.raceEditAllowed
var Ai=yi.raceJoinAllowed
var wi=yi.staminaUsageScale
var Li=yi.userDataGet
var Ri=yi.userStaminaMod
var xi=yi.worldReadOnly
var Oi=e("./user_info_view").userInfoGet
var bi=e("./voxel_data")
var Ni=e("./voxel_data")
var Ci=Ni.applyBevelValue
var Mi=Ni.getPropLighting2Prop
var Di=Ni.getWorldPosFromChunkID
var Pi=e("./voxel_data_xraw").loadXRAW
var ki=e("./world_comm")
var Bi=ki.getWorldID
var Ui=ki.worldBuzzerStart
var Gi=ki.worldBuzzerSubmit
var Fi=ki.worldClaimGem
var Wi=ki.worldTransactionsInProgress
var ji=e("./world_metadata")
var Hi=ji.adventureMode
var zi=ji.worldHasGems
var Vi=ji.worldMetadataWaygates
var Yi=ji.worldSpotlitBuzzer
var qi=e("./worlds_sound").playSound
var Ki=e("./worlds_soundscape")
var Zi=Ki.SoundScapeEventMod
var Xi=Ki.logSSEventModState
var Qi=Math.abs,Ji=Math.floor,$i=Math.max,eo=Math.min,to=Math.PI,ro=Math.random,ao=Math.round,io=Math.sin,oo=Math.sqrt
var no=r
var so=128
var lo=512
var co=ve(0,-1,0)
var _o=Xa.createFast()
var uo=3e4
r.NO_PICKUP_DELAY=uo
var fo=1
var vo=to/2
var ho=16
var po=16
var mo=25
var go=3e5
var Eo=15e3
var yo=500
var To=8
var Io=5e-4
var So=5e-4
var Ao=500
var wo=1e3
var Lo=1/7
var Ro=1
var xo=7
var Oo=.5
var bo=1
var No=4
var Co=2
var Mo=100
P.register({factory_status_dist:{label:"Factory Status Display Distance",default_value:6,type:I.TYPE_FLOAT,range:[0,1e3]},unlimited_factories:{label:"Allow Factories in Unlimited Mode",default_value:0,type:I.TYPE_INT,range:[0,1],access_run:["sysadmin"]}})
var Do=[ve(0,-1,0),ve(1,0,0),ve(0,1,0),ve(-1,0,0)]
function rotToVec(e){S(e>=0&&e<=3)
return Do[e]}var Po=[]
function initFlowerSeeds(){function initFlowerArray(e){for(var t=0;t<e.length;t++){var r=e[t]
for(var a=0;a<r.key.length;a++)Po[r.key[a]]=r}}initFlowerArray(_a)
initFlowerArray(ca)}initFlowerSeeds()
function validMushroomType(e){return e===jt.BROWN_MUSHROOM||e===jt.RED_MUSHROOM||e===jt.LUMINESCENT_MUSHROOM||e===jt.CORAL_MUSHROOM}function isMushroom(e){return Po[e]&&validMushroomType(Po[e].attr1)}function mapToFlowerTypeFromSeed(e){if(Po[e].weighted)return Po[e].weighted[Ji(ro()*Po[e].weighted.length)]
else return Po[e].key[Ji(ro()*Po[e].key.length)]}function mapToSeedFromFlowerType(e){if(!Po[e])return 0
return Po[e].key[0]}function validFlowerType(e){return Po[e]}function mapToNameKeyFromFlowerType(e){return Po[e]&&Po[e].name_key}var ko={}
ko[Tt]="crop-wheat"
ko[mt]="crop-corn"
ko[yt]="crop-tomato"
ko[pt]="crop-carrot"
ko[gt]="crop-pumpkin"
ko[Et]="crop-sugar-cane"
ko[we]="red-berry-bush"
ko[Ae]="blue-berry-bush"
ko[Le]="yellow-berry-bush"
var Bo=he(1,1,1,.75)
r.color_prop_preview=Bo
var Uo=he(0,1,0,1)
var Go=he(1,1,0,1)
Uo.tile=wr
var Fo=he(0,1,0,1)
Fo.tile=Tr
var Wo=he(.5,1,1,1)
Wo.tile=Tr
var jo=he(0,0,1,1);(r.color_interact_water=jo).tile=Lr
var Ho=he(.5,.5,1,1);(r.color_interact_water_place=Ho).tile=Lr
var zo=[1,2,3,4,5,6,6,6]
var Vo=[2,2,2,2,2]
var Yo=[1,1,1,2,2]
var qo=[1,1,1]
var Ko=[1,2,2]
var Zo=[1,1,1,1]
var Xo=[1,1,1,1,2]
var Qo=[1,1,2,3,4]
var Jo
var $o
var en
var tn
var rn
var an
var on
var nn=[{type:Ft,id:dt,count:1,user_inv_type:1,drop_chance:.5},{type:Ft,id:Ke,count:1,user_inv_type:1}]
var sn=[{type:Ft,id:wt,count:1,user_inv_type:1}]
var ln=[{type:Ft,id:Ke,count:1,user_inv_type:1}]
var cn=[]
cn[we]=[{type:Ft,id:Se,count:1,attr1:jt.RED_BERRY},{type:Ft,id:we,drop_chance:.05}]
cn[Ae]=[{type:Ft,id:Se,count:1,attr1:jt.BLUE_BERRY},{type:Ft,id:Ae,drop_chance:.05}]
cn[Le]=[{type:Ft,id:Se,count:1,attr1:jt.YELLOW_BERRY},{type:Ft,id:Le,drop_chance:.05}]
cn[yt]=[{type:Ft,id:bt,min:1,max:1.6},{type:Ft,id:yt,drop_chance:.33}]
cn[pt]=[{type:Ft,id:Pe,min:1,max:3},{type:Ft,id:pt,min:1,max:3}]
cn[gt]=[{type:Ft,id:ft,min:1,max:3},{type:Ft,id:gt,count:1}]
cn[mt]=[{type:Ft,id:We,count:1,pickable_early:true},{type:Ft,id:mt,count:1}]
cn[Tt]=[{type:Ft,id:kt,min:1,max:4},{type:Ft,id:Tt,count:1}]
cn[Et]=[{type:Ft,id:Ot,min:1,max:4},{type:Ft,id:Et,count:1}]
var _n={}
var un=he(0,0,0,.75)
var dn=he(0,0,0,.75)
function drawBlock(e,t,r,a,i){var o=gi[t]
bi.drawSingleVoxel({tile:t,opaque:!o.alpha||r&&r.force_opaque,lit:true,mat:e,color:r.color||ee,draw_opts:r})
if(a>1)bi.drawSingleVoxelTextured({opaque:true,tile:2===a?Ir:Sr,mat:e,color:un,tex:Er.tex_voxel_util,atlas_params_vp:bi.atlas_params_voxel_util_vp,atlas_params_fp:bi.atlas_params_voxel_util_fp})
if(i&&o.draw_passable_overlay)bi.drawSingleVoxelTextured({opaque:true,tile:Ar+3,mat:e,color:dn,tex:Er.tex_voxel_util,atlas_params_vp:bi.atlas_params_voxel_util_vp,atlas_params_fp:bi.atlas_params_voxel_util_fp})}function startup(){var e,t
an=Ca.char_controller
on=Ca.getFrameTransaction
Ga()
Ha()
Jo=Pi("sack.vm",j(G("model_opts/sack","jsobj")))
var r=j(G("model_opts/door","jsobj"))
var a=j(G("model_opts/door_frame","jsobj"))
$o=((e={})[jt.WOOD]=[{door_left:Pi("door-wood.vm",r),frame:Pi("door-wood-frame.vm",a)},{door_left:Pi("door-wood2.vm",r),frame:Pi("door-wood2-frame.vm",a)}],e[jt.LIGHT_WOOD]=[{door_left:Pi("door-light.vm",r),frame:Pi("door-light-frame.vm",a)},{door_left:Pi("door-light2.vm",r),frame:Pi("door-light2-frame.vm",a)}],e[jt.DARK_WOOD]=[{door_left:Pi("door-dark.vm",r),frame:Pi("door-dark-frame.vm",a)},{door_left:Pi("door-dark2.vm",r),frame:Pi("door-dark2-frame.vm",a)}],e[jt.RED_WOOD]=[{door_left:Pi("door-red.vm",r),frame:Pi("door-red-frame.vm",a)},{door_left:Pi("door-red2.vm",r),frame:Pi("door-red2-frame.vm",a)}],e[jt.STONE]=[{door_left:Pi("door-stone.vm",r),frame:Pi("door-stone-frame.vm",a)}],e[jt.FANCY_STONE]=[{door_left:Pi("door-fancystone.vm",r),frame:Pi("door-fancystone-frame.vm",a)}],e[jt.IRON]=[{door_left:Pi("door-metal.vm",r),frame:Pi("door-metal-frame.vm",a)}],e)
var i=j(G("model_opts/doubledoor-left","jsobj"))
var o=j(G("model_opts/doubledoor-right","jsobj"))
var n=j(G("model_opts/doubledoor-frame","jsobj"))
en=((t={})[jt.WOOD]={door_left:Pi("doubledoor-wood-left.vm",i),door_right:Pi("doubledoor-wood-right.vm",o),frame:Pi("doubledoor-wood-frame.vm",n)},t[jt.LIGHT_WOOD]={door_left:Pi("doubledoor-lightwood-left.vm",i),door_right:Pi("doubledoor-lightwood-right.vm",o),frame:Pi("doubledoor-lightwood-frame.vm",n)},t[jt.DARK_WOOD]={door_left:Pi("doubledoor-darkwood-left.vm",i),door_right:Pi("doubledoor-darkwood-right.vm",o),frame:Pi("doubledoor-darkwood-frame.vm",n)},t[jt.RED_WOOD]={door_left:Pi("doubledoor-redwood-left.vm",i),door_right:Pi("doubledoor-redwood-right.vm",o),frame:Pi("doubledoor-redwood-frame.vm",n)},t[jt.STONE]={door_left:Pi("doubledoor-stone-left.vm",i),door_right:Pi("doubledoor-stone-right.vm",o),frame:Pi("doubledoor-stone-frame.vm",n)},t[jt.FANCY_STONE]={door_left:Pi("doubledoor-fancystone-left.vm",i),door_right:Pi("doubledoor-fancystone-right.vm",o),frame:Pi("doubledoor-fancystone-frame.vm",n)},t[jt.IRON]={door_left:Pi("doubledoor-metal-left.vm",i),door_right:Pi("doubledoor-metal-right.vm",o),frame:Pi("doubledoor-metal-frame.vm",n)},t)
tn=Pi("gem.vm",j(G("model_opts/gem","jsobj")))
rn=Pi("indicator.vm",j(G("model_opts/gem","jsobj")))}var fn=0
function Prop(e){this.uid=++fn
this.item_id=e.id
this.attr1=e.attr1||0
this.attr2=e.attr2||0
this.attr3=e.attr3||0
this.inv=e
this.chunk_id=null
this.pos=null
this.quat=N()
this.rot=0
this.growth_skytime=Ja.skytime_value
this.size=ve()
this.last_size=ve()
this.draw_offs=ve(.5,.5,0)
this.draw_opts={}
this.emit=0
this.version=1
this.interact_locked=false
this.property_edit_locked=false
this.in_list_mod=false
this.fallback=false
this.draw=null
this.tick=null
this.updateState=null}Prop.prototype.onFlow=q
Prop.prototype.is_preview=false
Prop.prototype.afterPlace=q
Prop.prototype.updatePreview=q
Prop.prototype.updateBeforePlace=q
Prop.prototype.updateDrawable=q
Prop.prototype.interactable=q
Prop.prototype.interactable_continuously=false
Prop.prototype.mineWhenBlocked=q
Prop.prototype.read_only_interact=false
Prop.prototype.updatePos=q
Prop.prototype.override_intangible=false
Prop.prototype.isIntangible=function(){return this.override_intangible||this.inv.intangible}
Prop.prototype.setPos=function(e){if(!this.pos)this.pos=ve()
ie(this.pos,e)
this.pos_idx=this.pos[0]+this.pos[1]*n+this.pos[2]*s
this.updatePos()}
Prop.prototype.setLocalPos=function(e){this.chunk_id=bi.chunkIdFromLocalIntPos(e)
this.setPos(bi.andGetLocalPos())}
Prop.prototype.ifNotLockedInteractable=function(){if(this.interact_locked)return null
return Uo}
Prop.prototype.mineable=function(){return this.inv.mineable}
var vn=ve()
Prop.prototype.cropSetStage=function(e){var t=this.stages[e]
var r=true
if(void 0===this.exists_in_world)this.exists_in_world=this.existsInWorld()
if(this.exists_in_world)e:for(var a=this.size[2];a<t;++a){vn[2]=this.pos[2]+a
for(var i=0;i<this.size[1];++i){vn[1]=this.pos[1]+i
for(var o=0;o<this.size[0];++o){vn[0]=this.pos[0]+o
if(bi.getTileRelative(this.chunk_id,vn,1,false)){r=false
break e}}}}if(r){this.stage=e
this.size[2]=t
this.growth_skytime=Ja.skytime_value
this.updateDrawable()}return r}
Prop.prototype.cropUpdateState=function(){var e=this
if(this.interact_locked)return
if(!this.inEditBounds(p))return
if(this.plantCheckAutoUnroot())return
var t=this.watered?bo:Oo
if(this.stage<this.stage_ready){Mi(this)
var r=this.draw_opts.sun_factor||0
var a=this.draw_opts.torch_factor||0
var i=oo(r)+Lo*oo(a)
if((Ja.skytime_value-this.growth_skytime)*i*t>Ro){this.getLocalPos(vn)
var o=vn[1]
var n=vn[0]
var s=0
this.watered=false
var l=Ja.skytime_value-this.growth_skytime
for(var c=-Co;c<Co+1;c++){vn[1]=o+c
for(var _=-Co;_<Co+1;_++){vn[0]=n+_
var u=bi.getPropLocal(vn)
if(u&&u.item_id===Dt&&u.range>=Qi(_)&&u.range>=Qi(c)){s=eo(u.growth_skytime,Ja.skytime_value)-this.growth_skytime
l=Ja.skytime_value-eo(u.growth_skytime,Ja.skytime_value)
this.watered=u.growth_skytime>Ja.skytime_value}}}var d=Ji((s*i*bo+l*i*Oo)/Ro)
this.growth_skytime=Ja.skytime_value
var f=$i(this.stage+1,eo(this.stage_ready,this.stage+d))
if(this.cropSetStage(f)){var v=on()
if(!this.watered)this.waterableUnwater(v)
bi.transPropUpdate(v,this,true)
this.interact_locked=true
v.onComplete(function(){e.interact_locked=false})}}}}
Prop.prototype.initParticles=function(e){this.particle_systems=[]
var t=e?e:this.inv.particle_systems
for(var r=0;r<t.length;r++){var a=t[r]
var i=ja(this,a,this.quat)
this.particle_systems.push(i)}}
var hn=1
I.registerValue("debug_particle_systems",{type:I.TYPE_INT,label:"Debug particle system amount in particle debugger",range:[1,Infinity],set:function set(e){hn=e},access_show:["sysadmin"],get:function get(){return hn},store:true})
Prop.prototype.initDebugParticles=function(){this.particle_systems=[]
var e=this.inv.particle_systems
for(var t=0;t<hn;t++){var r=e[t%e.length]
var a=ja(this,r,this.quat)
this.particle_systems.push(a)}}
Prop.prototype.particleSystemRun=function(e){if(A.defines.NOPARTICLES)return null
if(null===this.chunk_id||void 0===this.chunk_id)return null
if(!this.particle_systems||!this.particle_systems[0]||this.item_id===ct&&this.particle_systems.length!==hn)this.initParticles()
for(var t=0;t<this.particle_systems.length;t++)this.particle_systems[t].updateParticleSystemOwner(this.rot,e)
return this.particle_systems.length}
Prop.prototype.detachParticleSystems=function(){if(!this.particle_systems)return
for(var e=0;e<this.particle_systems.length;e++)this.particle_systems[e].detach()
this.particle_systems=[]}
Prop.prototype.getGrowthRate=function(){var e=this.draw_opts.sun_factor||0
e=isMushroom(this.attr3)?$i(0,.9-e):e
var t=this.draw_opts.torch_factor||0
return oo(e)+Lo*oo(t)}
Prop.prototype.plantCheckAutoUnroot=function(){var e=this
if(this.interact_locked)return false
this.getLocalPos(vn);--vn[2]
var t=vn[1]
var r=vn[0]
for(var a=0;a<this.size[1];++a){vn[1]=t+a
for(var i=0;i<this.size[0];++i){vn[0]=r+i
var o=bi.getTileLocal(vn,0,false)
if(!o||o>=ui){var n=on()
this.interact_locked=true
bi.transPropRemove(n,this)
n.onComplete(function(){e.interact_locked=false})
return true}}}return false}
Prop.prototype.plantUpdateState=function(){if(this.plantCheckAutoUnroot())return
var e=this.watered?bo:Oo
Mi(this)
var t=this.getGrowthRate()
if((t*=e)<=0)this.growth_skytime=Ja.skytime_value
this.plant_progress=(Ja.skytime_value-this.growth_skytime)*t/this.growth_time
if((Ja.skytime_value-this.growth_skytime)*t>this.growth_time&&this.inEditBounds(p)){this.growth_skytime=Ja.skytime_value
this.stage+=1
this.watered=false
var r=on()
bi.transPropUpdate(r,this,true)
this.updateDrawable()}}
Prop.prototype.isWaterable=function(){return void 0!==this.watered&&!this.watered}
Prop.prototype.wateringSystemWaterNearby=function(e){this.getLocalPos(vn);--vn[2]
var t=vn[1]
var r=vn[0]
for(var a=-this.range;a<this.range+1;a++){vn[1]=t+a
for(var i=-this.range;i<this.range+1;i++){vn[0]=r+i
if(bi.getTileLocal(vn,0,false)===vi&&Br(vn)){bi.transSetTileLocal(e,vn,hi,false,false,vi)
vn[2]+=1
var o=bi.getPropLocal(vn)
if(o&&o.isWaterable()&&o.inEditBounds(v)){o.watered=true
bi.transPropUpdate(e,o,false)}--vn[2]}}}}
Prop.prototype.wateringSystemUpdateState=function(){if(!this.water_amount)return
var e=Ji((this.growth_skytime-Ja.skytime_value)/No)
if((e=$i(e+=1,0))<this.water_amount){var t=on()
this.water_amount=e
this.wateringSystemWaterNearby(t)
this.updateDrawable()
bi.transPropUpdate(t,this,false)}}
Prop.prototype.stateChanged=function(e,t,r){if(!this.is_preview&&null!==this.chunk_id){bi.propStateUpdate(this)
if(this.baked.key!==e){var a=bi.chunk_map[this.chunk_id]
if(t&&this.emit!==r)a.lightDirty(this.emit);++a.ver_props
a.dirty()}}}
Prop.prototype.cropPlantUpdateDrawable=function(){var e=this.baked.key
var t=this.emit
var r
switch(this.item_id){case dt:r=this.stage?"plant-"+this.attr3:isMushroom(this.attr3)?"mushroom-seed":"plant-seed"
this.updateState=this.plantUpdateState
break
case we:case Ae:case Le:r=ko[this.item_id]+"-"+this.stage
this.updateState=this.plantUpdateState
break
default:var a=ko[this.item_id]
if(a){r=a+"-"+(this.stage+1)
break}r="plant-1"}this.baked.key=r
if(this.stage<this.stage_ready){if(!this.watered){this.baked={key:Jt(r,{dry:"plantdry"}),rot:this.baked.rot}
this.baked.size=this.size}}else{this.updateState=null
this.growth_skytime=0}this.emit=Zt(this.baked.key)
this.stateChanged(e,true,t)}
Prop.prototype.wateringSystemUpdateDrawable=function(){var e=this.baked.key
var t=Qt("watering-system-"+this.water_amount,this.attr1)
if(t!==e){this.baked.key=t
if(0===this.water_amount){this.draw=null
this.growth_skytime=0
this.detachParticleSystems()}else this.draw=this.particleSystemRun
this.stateChanged(e)}}
Prop.prototype.waterableUnwater=function(e){S(e)
this.watered=false
this.getLocalPos(vn);--vn[2]
var t=vn[1]
var r=vn[0]
for(var a=0;a<this.size[1];++a){vn[1]=t+a
for(var i=0;i<this.size[0];++i){vn[0]=r+i
if(bi.getTileLocal(vn,0,false)===hi&&Br(vn))bi.transSetTileLocal(e,vn,vi,false,false,hi).loose_priority=mi[vi]}}}
Prop.prototype.plantUpdateBeforePlace=function(){this.watered=false
this.stage=0
if(this.item_id===dt)this.attr3=mapToFlowerTypeFromSeed(this.attr3)
this.growth_skytime=Ja.skytime_value
this.cropPlantUpdateDrawable()}
Prop.prototype.waterableUpdateBeforePlace=function(e){vn[2]=e[2]-1
var t=true
e:for(var r=0;r<this.size[1];++r){vn[1]=e[1]+r
for(var a=0;a<this.size[0];++a){vn[0]=e[0]+a
if(bi.getTileLocal(vn,1,false)!==hi){t=false
break e}}}if(t)this.watered=true}
Prop.prototype.cropUpdateBeforePlace=function(e){this.waterableUpdateBeforePlace(e)
this.growth_skytime=Ja.skytime_value}
Prop.prototype.waterableInteractable=function(){var e=this.stage>=this.stage_ready
if(!this.watered&&Ya(pi)&&!e)return jo
return false}
var pn=[{name:"watering_particles",rot:0,offset_position:[0,0,0]}]
var mn=ve()
Prop.prototype.createDetachedParticleSystemsFromProp=function(e){this.getLocalPos(mn)
_e(mn,mn[0]+this.size[0]/2,mn[1]+this.size[1]/2,mn[2])
Wa(mn,e)}
Prop.prototype.triggerParticleSystemList=function(e){if(this.inv.particle_triggers&&this.inv.particle_triggers[e])this.createDetachedParticleSystemsFromProp(this.inv.particle_triggers[e])}
Prop.prototype.waterableInteract=function(e){var t=this
if(this.waterableInteractable()){if(!Rr(Na.STATUSMSG_EXHAUSTED_TO_USE_BUCKET))return
if(e=qa(e)){if(xr())Ri(e,-ao(Mo*wi()))
qi("bucket_water_crops")
this.createDetachedParticleSystemsFromProp(pn)
this.watered=true
if(this.growth_skytime<Ja.skytime_value-.5)this.growth_skytime=Ja.skytime_value-.5
bi.transPropUpdate(e,this)
this.interact_locked=true
e.onComplete(function(){t.interact_locked=false})
this.getLocalPos(vn);--vn[2]
var r=vn[1]
var a=vn[0]
for(var i=0;i<this.size[1];++i){vn[1]=r+i
for(var o=0;o<this.size[0];++o){vn[0]=a+o
if(bi.getTileLocal(vn,0,false)===vi&&Br(vn))bi.transSetTileLocal(e,vn,hi,false,false,vi,true)}}}}else S(false)}
Prop.prototype.plantWaterableInteract=function(e){if(this.waterableInteractable()){if(!Rr(Na.STATUSMSG_EXHAUSTED_TO_USE_BUCKET))return true
if(e=qa(e)){if(xr())Ri(e,-ao(Mo*wi()))
qi("bucket_water_crops")
this.createDetachedParticleSystemsFromProp(pn)
this.watered=true
Mi(this)
var t=this.getGrowthRate()
var r=t*Oo
var a=(Ja.skytime_value-this.growth_skytime)*r/this.growth_time
r=t*bo
var i=Ja.skytime_value+(1-a)*r*this.growth_time
this.growth_skytime=i-r*this.growth_time
bi.transPropUpdate(e,this)
return true}}return false}
Prop.prototype.cropHarvestable=function(){return this.stage>=this.stage_ready||this.stage>=this.stage_pickable}
Prop.prototype.cropInteractable=function(){if(this.interact_locked)return null
if(!Ya()&&this.cropHarvestable())return this.harvest_to_stage?Fo:Uo
return this.waterableInteractable()}
var gn=ve()
Prop.prototype.chairInteractable=function(){if(this.interact_locked)return null
this.getLocalPos(gn)
if(oe(an.pos,gn)>49)return Go
return Uo}
var En=7
var yn=1
var Tn=4
var In=function(a){_inheritsLoose(SignFloater,a)
function SignFloater(e){var t=si
var r=e.sign_text
return a.call(this,{align:U.font.ALIGN.HCENTER|U.font.ALIGN.HWRAP,text:r,style:t,w:En,resize_to_w:true,min_size:yn,max_size:Tn})||this}return SignFloater}(ia)
var Sn=((a={})[St]=ve(-.5,0,.5),a[At]=ve(0,0,1.5),a)
var An=ve()
function signFloaterPosInit(e){var t=rotToVec(e.rot)
var r=Sn[e.item_id]
An[0]=t[0]*r[0]+t[1]*r[1]
An[1]=t[0]*r[1]+t[1]*r[0]
An[2]=r[2]
te(An,An,e.size,.5)
ie(e.floater_offset,An)}var wn=18
var Ln=.55*to
function isSignVisible(e){var t=oe(Mr().pos,e.floater_pos)
var r=ue(An,e.floater_pos,Mr().getCameraPos())
var a=ae(r,rotToVec(e.rot))
e.max_view_dist=wn*(a-Ln)/Ln
return t<=e.max_view_dist*e.max_view_dist&&a>Ln}Prop.prototype.signUpdateDrawable=function(){this.draw=this.sign_text?this.signDraw:null
if(null!==this.chunk_id)bi.propStateUpdate(this)}
Prop.prototype.signDraw=function(){if(void 0===this.exists_in_world)this.exists_in_world=this.existsInWorld()
if(this.exists_in_world&&this.sign_text){if(!this.sign_floater){signFloaterPosInit(this)
this.sign_floater=new In(this)}this.getLocalPos(this.floater_pos)
re(this.floater_pos,this.floater_pos,this.floater_offset)
if(isSignVisible(this)){this.sign_floater.setText(this.sign_text)
oa({floater:this.sign_floater,max_dist:this.max_view_dist,draw_in_photos:true},this.floater_pos,$r,{vert_offset_scale:-this.sign_floater.h/2,downscale_if_offscreen:false,max_scale:200})}}}
var Rn=5
Prop.prototype.signInteractable=function(){if(this.property_edit_locked)return null
this.getLocalPos(gn)
if(oe(an.pos,gn)>Rn*Rn)return null
return Uo}
Prop.prototype.signInteract=function(){za(this,{fields:[{key:"sign_text",label:Na.LBL_SIGN_TEXT,msg:Na.DLG_ENTER_SIGN_TEXT_MSG,max_len:70,profanity_filter:true,allow_clear:true}],direct:true})}
var xn=ve()
Prop.prototype.findDropOptions=function(e,t,r){this.getLocalPos(gn)
var a=[]
var i=this.size[2]+1
for(var o=0;o<i;++o){vn[2]=gn[2]+o
for(var n=-1;n<this.size[1]+1;++n){vn[1]=gn[1]+n
for(var s=-1;s<this.size[0]+1;++s){vn[0]=gn[0]+s
if(Or(vn))a.push(vn.slice(0))
else{var l=bi.getTileLocal(vn,1,false)
if(e&&l>=di&&l<=fi&&bi.andGetProp()===this)a.push(vn.slice(0))}}}}if(t){var c=[]
if(!(a=a.filter(function(e){if(e[0]>=t[0]&&e[0]<=r[0]&&e[1]>=t[1]&&e[1]<=r[1]){c.push(e)
return false}return true})).length)a=c}return a}
var On=[{name:"harvest_particles",rot:0,offset_position:[0,0,0]},{name:"dirt_particles",rot:1,offset_position:[0,0,0]}]
var bn=ve()
Prop.prototype.cropInteract=function(e){var t=this
var r
if(this.waterableInteractable()){this.waterableInteract(e)
return false}else if(this.cropHarvestable()){var a=this.findDropOptions(!this.harvest_to_stage)
qi("crop_harvest")
e=e||on()
this.createDetachedParticleSystemsFromProp(On)
if(!a.length){bi.transPropRemove(e,this,true)
r=true
a.push(gn)
if(this.stage>this.stage_ready)this.harvest_results=ln}else if(this.stage>this.stage_ready){this.harvest_results=ln
bi.transPropRemove(e,this,true)
r=true}else if(this.harvest_to_stage){var i=this.harvest_to_stage
if(void 0!==this.harvest_left)if(this.harvest_left<1)i=this.stage_ready+1
else--this.harvest_left
if(this.cropSetStage(i))bi.transPropUpdate(e,this,true)
else{bi.transPropUpdate(e,this,false)
this.interact_locked=true
e.onComplete(function(){t.interact_locked=false})
return r}}else{if(this.stage>=this.stage_pickable)for(var o=0;o<this.harvest_results.length;++o)if(this.harvest_results[o].pickable_early)this.harvest_results[o].count=1+this.stage-this.stage_pickable
bi.transPropRemove(e,this,true)
r=true}if(Cr()){this.interact_locked=true
e.onComplete(function(){t.interact_locked=false})
return r}for(var n=0;n<this.harvest_results.length;++n){var s=this.harvest_results[n]
if(s.drop_chance)s.count=ro()<s.drop_chance?1:0
if(s.min&&s.max&&!s.drop_chance)s.count=s.min+Ji(ro()*(s.max-s.min+1))
if(!s.count)continue
var l=La(s)
var c=a[Ji(ro()*a.length)]
ie(bn,gn)
if(this.size[2]>1)bn[2]+=Ji(this.size[2]/2)
no.bagAddTrans(e,{target_pos:c,item:l,src_pos:bn,emptied_pos:c})}this.interact_locked=true
e.onComplete(function(){t.interact_locked=false})}return r}
var Nn=ve()
var Cn=ve(.5,.5,1)
Prop.prototype.chairInteract=function(e,t){if(this.interactable()===Go)return
var r
if(this.attr1===jt.RED_WOOD||this.attr1===jt.WOOD)r=Dr(an.getCardinalFacing())
else r=this.rot*vo-to
this.getLocalPos(Nn)
se(Nn,Cn)
an.sitOnChair(Nn,r)}
Prop.prototype.wateringSystemInteractable=function(){if(this.interact_locked)return null
if(this.water_amount<this.max_water&&Ya(pi))return jo
return null}
Prop.prototype.wateringSystemInteract=function(e){var t=this
if(this.interactable()){if(e=qa(e)){qi("bucket_water_crops")
if(0===this.water_amount){this.growth_skytime=Ja.skytime_value
this.wateringSystemWaterNearby(e)
this.updateState()}this.water_amount+=1
this.growth_skytime+=No
bi.transPropUpdate(e,this)
this.updateDrawable()
this.interact_locked=true
e.onComplete(function(){t.interact_locked=false})}}else S(false)}
Prop.prototype.isFactory=function(){return this.interact===this.factoryInteract}
Prop.prototype.hasGrowthTime=function(){return this.updateDrawable===this.cropPlantUpdateDrawable||this.item_id===Dt}
Prop.prototype.isQuickDepositTarget=function(){return this.isContainer()&&!this.isFactory()&&this.inEditBounds(h)}
Prop.prototype.isContainer=function(){return this.interact===this.chestInteract||this.isFactory()}
Prop.prototype.isWaygate=function(){return this.item_id===Pt}
Prop.prototype.isEnergyWell=function(){return this.item_id===Ye}
Prop.prototype.interactDetails=function(){if(!(this.isContainer()||this.item_id===xe||this.item_id===Pt||this.item_id===Ye||this.item_id===Ce||this.propertyEdit))return null
if(!this.container_pos)this.container_pos=ve()
this.getLocalPos(this.container_pos)
return this.container_pos}
Prop.prototype.chestMineable=function(){return ya(this)||Cr()}
Prop.prototype.chestMineWhenBlocked=function(){$a.get("minefull").setMessage(Na.STATUSMSG_MINE_PROP_FULL)}
Prop.prototype.chestInteract=function(){qi("chest_open")
Ma(Ua.CONTAINER,this.interactDetails())}
Prop.prototype.factoryInteract=function(){qi("factory_open")
Ma(Ua.FACTORY,this.interactDetails())}
Prop.prototype.alwaysInteractable=function(){return Wo}
Prop.prototype.interactableAdventure=function(){return Hi()||P.unlimited_factories?this.alwaysInteractable():null}
Prop.prototype.factoryUpdateDrawable=function(){if(Zr(this)){var t=this.factory_estimator=Xr(this)
if(t){this.draw=this.factoryDraw
Oa(t.output_preview,function(e){t.gfx=e})}else this.draw=null}else if(this.inv.particles_always_on_in_unlimited&&Cr())this.draw=this.particleSystemRun
else{this.draw=null
this.factory_estimator=null}if(null!==this.chunk_id)bi.propStateUpdate(this)}
var Mn=function(r){_inheritsLoose(ProgressIconFloater,r)
function ProgressIconFloater(e){var t;(t=r.call(this,e=e||{})||this).prop=e.prop
S(e.prop)
return t}ProgressIconFloater.prototype.draw=function draw(e){var t=this
var r=e.x,a=e.y,i=e.z,o=e.scale
var n=this.prop.factory_estimator.gfx
if(n){var s={x:r,y:a,z:i,w:this.w*o,h:this.h*o}
if(n.need_thumbnail_update){this.prop.factory_estimator.gfx=null
Oa(this.prop.factory_estimator.output_preview,function(e){if(t.prop.factory_estimator)t.prop.factory_estimator.gfx=e})}else if(n.img){V(s,{frame:n.frame,color:this.color})
n.img.draw(s)}}}
return ProgressIconFloater}(ta)
var Dn=1
var Pn=4
var kn=Dn+2*.05
var Bn=6*kn
var Un=function(t){_inheritsLoose(ProgressFloater,t)
function ProgressFloater(e){return t.call(this,{text:{floater:new ia({w:Bn,size:Dn}),rel_pos:{x:0,y:.98*Pn,z:2}},bar:{floater:new ra({w:Bn,h:kn}),rel_pos:{x:0,y:.98*Pn,z:1}},icon:{floater:new Mn({w:Pn,h:Pn,prop:e}),rel_pos:{x:Bn/2-Pn/2,y:0,z:0}}})||this}var e=ProgressFloater.prototype
e.setText=function setText(e){this.fp_pairs.text.floater.setText(e)}
e.setProgress=function setProgress(e){this.fp_pairs.bar.floater.setProgress(e)}
e.setColor=function setColor(e){this.fp_pairs.bar.floater.setColor(e)}
return ProgressFloater}(Jr)
Prop.prototype.factoryDraw=function(e){S(this.factory_estimator)
if(void 0===this.exists_in_world)this.exists_in_world=this.existsInWorld()
if(this.exists_in_world&&!A.defines.NOUI){var t=this.factory_estimator.estimateProgress()
var r=t.is_running
if(this.inv.progress_indicator){if(!this.progress_floater){this.progress_floater=new Un(this)
this.floater_pos=ve()}this.getLocalPos(this.floater_pos)
te(this.floater_pos,this.floater_pos,this.size,.5)
this.floater_pos[2]+=this.inv.floater_z||this.size[2]
this.progress_floater.setText(Na.$(Na.FORMAT_FRACTION,t.ready,t.total))
this.progress_floater.setProgress(t.partial)
this.progress_floater.setColor(t.ready>0?ti:ai)
oa({floater:this.progress_floater,max_dist:P.factory_status_dist},this.floater_pos,$r)}if(r&&this.factory_state!==Kr)return this.particleSystemRun(e)
else this.detachParticleSystems()}return null}
var Gn=["energy-well-empty","energy-well-full1","energy-well-full2","energy-well-full3"]
function propEnergyWellReadiness(e){if(!xr()||null===e.chunk_id)return 2
if(!Fr(e))return 0
var t=jr()
if(!t)return 0
return t}Prop.prototype.energyWellUpdateDrawable=function(){var e=this.baked.key
var t=propEnergyWellReadiness(this)
var r=Gn[t]
if(r!==e){S(r)
this.baked.key=r
if(t&&!Cr())this.draw=this.particleSystemRun
else this.draw=null
this.stateChanged(e)}}
Prop.prototype.energyWellTick=function(){if(this.baked.key!==Gn[propEnergyWellReadiness(this)])this.energyWellUpdateDrawable()}
Prop.prototype.energyWellInteractable=function(){if(xr())return Hr(this)?Uo:this.alwaysInteractable()
else return null}
Prop.prototype.energyWellInteract=function(){if(Hr(this))Wr()
else{qi("factory_open")
Ma(Ua.ENERGY_WELL,this.interactDetails())}}
var Fn=ve(-.5,-.5,0)
Prop.prototype.blockPreviewDraw=function(e){var t=this.attr1
var r=this.mat
x(r,1,this.quat,e)
T(r,r,Fn)
drawBlock(r,t,this.draw_opts,1,true)}
function propertyEditBaseCheck(e){if(!e.propertyEdit||xi()||e.property_edit_locked)return false
var t=Ka()
if(!t)return false
var r=e.prop_edit_ids||{}
return t.type===Ft&&(t.id===e.item_id||r[t.id])}Prop.prototype.shouldPropertyEdit=function(){return propertyEditBaseCheck(this)}
Prop.prototype.accessControlInteractDetails=function(){if(!this.access_control_pos)this.access_control_pos=he()
this.getLocalPos(this.access_control_pos)
this.access_control_pos[3]=this.rot
return this.access_control_pos}
Prop.prototype.accessControlInteractable=function(){return xi()?null:Wo}
Prop.prototype.accessControlInteract=function(){Ma(Ua.ACCESS_CONTROL,this.interactDetails())}
var Wn=0
var jn={}
I.registerValue("gem_debug",{type:I.TYPE_INT,range:[0,1],get:function get(){return Wn},set:function set(e){Wn=e
jn={}},access_run:["sysadmin"],store:true})
function gemDebugTick(){var e=Bi()
var t=150
var r=150
var a=Z.DEBUG
var i=0
for(var o in jn){var n=jn[o]
var s=0
var l=[]
for(var c in n)if(n[c]!==e)delete n[c]
else{l.push(c);++s}if(s){++i
U.print(s>1?ni:ii,t,r,a,"GemID "+o+": "+l.join("  "))
r+=U.font_height}}U.print(i===zi()?ii:ni,t,r,a,"Total unique gems = "+i+" / "+zi())
r+=U.font_height
if(U.buttonText({x:t,y:r,z:a,text:"Refresh",w:100,h:48,font_height:32}))jn={}}Prop.prototype.gemPropertyEdit=function(){za(this,{fields:[{key:"gem_id",label:"Gem ID",allow_clear:true}]})}
Prop.prototype.gemUpdateDrawable=function(){}
Prop.prototype.gemPickupable=function(){return this.gem_id&&xi()&&zi()&&!(Li("gems_claimed")||{})[this.gem_id]}
Prop.prototype.gemTick=function(){if(Wn&&this.gem_id){var e=this.gem_id,t=this.chunk_id,r=this.pos_idx
var a=Bi()
var i=t+","+r
var o=jn[e]
if(!o)o=jn[e]={}
o[i]=a
var n=false
for(var s in o){if(s===i)continue
n=true}if(!this.id_floater){this.id_floater=new ia
this.floater_pos=ve()}this.getLocalPos(this.floater_pos)
this.floater_pos[0]+=.5
this.floater_pos[1]+=.5
this.floater_pos[2]++
this.id_floater.setText(String(this.gem_id))
this.id_floater.setStyle(n?ni:oi)
oa({floater:this.id_floater},this.floater_pos,ea)}if(this.done||!this.gemPickupable())return
this.getLocalPos(gn)
re(xn,gn,J)
if(oe(an.center_pos,xn)<=ho){qi("pickup_gem")
Fi(this.gem_id,this.chunk_id,this.pos_idx)
this.done=true
this.gem_pickup_time=A.frame_timestamp}}
var Hn=he(1,.25,.25,1)
var zn=he(1,1,1,.2)
var Vn=he(1,1,1,0)
Prop.prototype.gemDraw=function(e){var t=(A.frame_timestamp-this.gem_pickup_time)/2e3
var r=this.gem_pickup_time&&t<2
var a=this.gemPickupable()
var i=this.draw_opts.color===Bo
var o=this.gem_id&&xi()&&zi()&&!a
var n=i||!this.draw_opts.for_snapshot&&(a||r||o)?A.frame_timestamp:0
C(this.gem_quat,pe,(this.rot+.001*n)*vo)
S(tn.opts.draw_offset)
D(this.gem_offs,tn.opts.draw_offset,this.quat)
re(this.gem_pos,e,this.gem_offs)
this.gem_pos[2]+=2*io(.001*n)/7
if(!i){this.draw_opts.alpha_queue=false
var s=this.draw_opts.color?this.draw_opts.color[3]:1
if(r){if(!this.gem_temp_color)this.gem_temp_color=he()
if(t<1){this.gem_pos[2]+=10*H(t,2)
this.draw_opts.color=fe(this.gem_temp_color,t,ee,Vn)}else this.draw_opts.color=fe(this.gem_temp_color,t-1,Vn,zn)
this.draw_opts.alpha_queue=true}else if(!this.gem_id&&!this.draw_opts.for_snapshot)this.draw_opts.color=Hn
else if(o){this.draw_opts.color=zn
this.draw_opts.alpha_queue=true}else this.draw_opts.color=ee
if(1!==s){if(!this.gem_temp_color)this.gem_temp_color=he()
this.draw_opts.color=de(this.gem_temp_color,this.draw_opts.color)
this.draw_opts.color[3]*=s}}var l=tn.vd.mat
tn.vd.mat=this.gem_mat
tn.draw(this.gem_pos,this.gem_quat,1,this.draw_opts)
tn.vd.mat=l}
Prop.prototype.indicatorDraw=function(e){var t
if(!this.draw_opts.for_snapshot){t=A.frame_timestamp
C(this.indicator_quat,pe,(this.rot+.001*t)*vo)
S(rn.opts.draw_offset)
D(this.indicator_offs,rn.opts.draw_offset,this.quat)}re(this.indicator_pos,e,this.indicator_offs)
if(!this.draw_opts.for_snapshot)this.indicator_pos[2]+=3*io(.003*t)/7
rn.draw(this.indicator_pos,this.indicator_quat,1,this.draw_opts)}
Prop.prototype.doorUpdateDrawable=function(){this.override_intangible=Boolean(this.open)}
var Yn=400
Prop.prototype.doorDraw=function(e){var t
var r
var a
var i
if(this.item_id===He){var o=(i=en)[this.attr1]
t=o.door_left
r=o.door_right
a=o.frame}else{i=$o
var n=this.attr3?1:0
var s=i[this.attr1][n]
t=s.door_left
r=s.door_right
a=s.frame}var l=1
a.draw(e,this.quat,1,this.draw_opts)
var c=this.open?-1:0
if(this.open_at){var _=(A.frame_timestamp-this.open_at)/Yn
if(_>=1)this.open_at=0
else{_=z(_,2)
if(this.open)c=-_
else c=-1+_}}if(t){C(this.door_left_quat,pe,(this.rot+.99*c)*vo)
S(t.opts.draw_offset)
D(this.door_offs,t.opts.draw_offset,this.quat)
re(this.door_pos,e,this.door_offs)
t.draw(this.door_pos,this.door_left_quat,1,this.draw_opts);++l}if(r){C(this.door_right_quat,pe,(this.rot-.99*c)*vo)
S(r.opts.draw_offset)
D(this.door_offs,r.opts.draw_offset,this.quat)
re(this.door_pos,e,this.door_offs)
r.draw(this.door_pos,this.door_right_quat,1,this.draw_opts);++l}return l}
Prop.prototype.doorInteract=function(){this.open_at=A.frame_timestamp
if(xi()||!this.inEditBounds(v))this.open=1-this.open
else{var e=on()
bi.transPropUpdateField(e,this,"d","open",this.open?0:1)
e.silent_error=true}qi(this.open?"door_open":"door_close")
this.updateDrawable()}
Prop.prototype.doorInteractable=function(){return Wo}
Prop.prototype.waygateAfterPlace=function(){if(Hi())Ma(Ua.WAYGATE_EDIT,this.interactDetails())}
Prop.prototype.waygateGetID=function(){var e=Vi()
for(var t in e){var r=e[t]
if(r.pos[0]===this.chunk_id&&r.pos[1]===this.pos_idx)return t}return null}
Prop.prototype.waygateLinkable=function(){return Boolean(this.waygateGetID())}
Prop.prototype.waygateMineable=function(){return!this.waygateLinkable()}
Prop.prototype.waygateMineWhenBlocked=function(){$a.get("minewglinked").setMessage(Na.STATUSMSG_MINE_WG_LINKED)}
Prop.prototype.waygateInteract=function(){Ma(Ua.WAYGATE_EDIT,this.interactDetails())}
Prop.prototype.waygateEditAllowed=function(){return Ur(this.getLocalPos())||Ti()&&this.inEditBounds(v)&&!kr(this.getLocalPos())}
Prop.prototype.waygateInteractable=function(){if(this.waygateEditAllowed())return Wo
var e=this.waygateGetID()
if(e&&Qa(e))return Wo
return null}
var qn=.75
var Kn=.2
var Zn=1.5
var Xn=function(i){_inheritsLoose(BuzzerNameFloater,i)
function BuzzerNameFloater(e,t){var r=new ia({text:e,style:w.style(oi,{glow_outer:3,glow_color:255})})
var a=new ia({text:""+t,size:Zn,max_w:15,style:w.style(oi,{glow_outer:4,glow_color:255})})
a.h+=qn
return i.call(this,{descriptor:{floater:r,rel_pos:{x:$i(0,-r.w/2+a.w/2),y:0,z:0}},id:{floater:a,rel_pos:{x:$i(0,-a.w/2+r.w/2),y:r.h+Kn,z:0}}})||this}return BuzzerNameFloater}(Jr)
Prop.prototype.buzzerMineable=function(){return!this.buzzer_id}
Prop.prototype.buzzerMineWhenBlocked=function(){$a.get("minenamed").setMessage(Na.STATUSMSG_MINE_PROP_NAMED)}
Prop.prototype.buzzerShouldPropertyEdit=function(){return propertyEditBaseCheck(this)&&Si()}
function trueBuzzerID(e){return e.toLowerCase().replace(/[^a-z0-9_]/g,"")}var Qn="buzzerstart_blank"
var Jn="buzzerstart_ready"
var $n="buzzerstart_racing"
Prop.prototype.buzzerStartUpdateDrawable=function(){var e=this.baked.key
var t=this.emit
var r
if(!this.buzzer_id)r=Qn
else{r=Jn
if(!Ii()){var a=Li("race_data")||{}
if(a.start&&a.id===trueBuzzerID(this.buzzer_id))r=$n}}if(r!==e){S(r)
this.baked.key=r
this.emit=Zt(this.baked.key)
this.stateChanged(e,true,t)}}
var es=12
var ts=.35
Prop.prototype.buzzerStartDraw=function(){if(void 0===this.exists_in_world)this.exists_in_world=this.existsInWorld()
if(this.exists_in_world){this.updateDrawable()
if(!A.defines.NOUI){this.getLocalPos(this.floater_pos)
if(oe(an.pos,this.floater_pos)<=es*es){te(this.floater_pos,this.floater_pos,this.size,.5)
this.floater_pos[2]+=this.size[2]
if(this.buzzer_id){if(!this.id_floater)this.id_floater=new Xn(Na.addColon(Na.LBL_COURSE_START),this.buzzer_id)
oa({floater:this.id_floater,max_dist:es,fade_dist:ts},this.floater_pos,.125)}}}}}
var rs=6
Prop.prototype.buzzerStartInteractable=function(){if(!Ai()&&!Li("race_data"))return null
this.getLocalPos(gn)
te(gn,gn,this.size,.5)
if(oe(an.pos,gn)>rs*rs||this.interact_locked||!this.buzzer_id&&!Si())return null
return Uo}
Prop.prototype.buzzerStartInteract=function(){if(!this.buzzer_id){$a.get("buzzid").setMessage(Na.STATUSMSG_ASSIGN_BUZZER_NAME)
return}var e=Li("race_data")
var t=e&&e.id===trueBuzzerID(this.buzzer_id)
if(Ai()){if(t)$a.get("buzzrestart").setMessage(Na.STATUSMSG_RACE_RESTARTED)
if(t||!e){qi("race_start")
this.triggerParticleSystemList("press")
Ui(this)}else{var r=this
var a=!L.touch_mode&&!Ua.active()?L.pointerLockEnter:null
U.modalDialog({text:Na.DLG_START_OTHER_RACE_MSG,buttons:{OK:{cb:function cb(){if(r.existsInWorld()){qi("race_start")
r.triggerParticleSystemList("press")
Ui(r)}},in_event_cb:a},Cancel:{cb:q,in_event_cb:a}}})}}}
var as=((i={})[Me]=true,i[Ce]=true,i)
Prop.prototype.buzzerStartPropertyEdit=function(){za(this,{fields:[{key:"buzzer_id",label:Na.LBL_COURSE_NAME,msg:Na.DLG_COURSE_START_NAME_MSG,max_len:30,profanity_lock:true,allow_clear:true}],direct:true})}
var is=1.5
var os=function(n){_inheritsLoose(BuzzerGoalFloater,n)
function BuzzerGoalFloater(e,t,r){var a
var i=new ia({style:w.style(li[r],{glow_outer:4,glow_color:255}),text:Na.$(Na.FORMAT_BUZZER_SCORE,Y(t),e)})
var o=new aa({w:is,h:is,sprite:Ei.sprite,color:ri[r],sprite_params:{frame:Ei.TROPHY}});(a=n.call(this,{text:{floater:i,rel_pos:{x:o.w+.2,y:o.h/2-i.h/2,z:0}},icon:{floater:o,rel_pos:{x:0,y:0,z:0}}})||this).name=e
a.time=t
a.rank=r
return a}var e=BuzzerGoalFloater.prototype
e.setName=function setName(e){if(e!==this.name){this.fp_pairs.text.floater.setText(Na.$(Na.FORMAT_BUZZER_SCORE,Y(this.time),e))
n.prototype.updateSize.call(this)}}
e.setRank=function setRank(e){this.fp_pairs.text.floater.setStyle(w.style(li[e],{glow_outer:4,glow_color:255}))
this.fp_pairs.icon.floater.sprite_params.color=ri[e]}
return BuzzerGoalFloater}(Jr)
var ns="buzzergoal_blank"
var ss="buzzergoal_ready"
var ls="buzzergoal_racing"
Prop.prototype.buzzerGoalUpdateDrawable=function(){var e=this.baked.key
var t=this.emit
var r
if(!this.buzzer_id)r=ns
else{r=ss
if(!Ii()){var a=Li("race_data")||{}
if(a.start&&a.id===trueBuzzerID(this.buzzer_id))r=ls}}if(r!==e){S(r)
this.baked.key=r
this.emit=Zt(this.baked.key)
this.stateChanged(e,true,t)}}
var cs=3
var _s=6
Prop.prototype.buzzerGoalDraw=function(e){if(void 0===this.exists_in_world)this.exists_in_world=this.existsInWorld()
if(this.exists_in_world){this.updateDrawable()
if(!A.defines.NOUI){this.getLocalPos(this.floater_pos)
if(oe(an.pos,this.floater_pos)<=es*es){var t=!Ii()&&Li("race_data")
if(!t||t.id===this.buzzer_id){te(this.floater_pos,this.floater_pos,this.size,.5)
this.floater_pos[2]+=this.size[2]
var r=[]
if(this.score_table!==[]){var a=0
var i=-1
for(var o=0;o<eo(this.score_table.length,_s);o++){if(this.score_table[o].time>i){i=this.score_table[o].time
if((a=o+1)>cs)break}if(!this.score_table[o].floater)this.score_table[o].floater=new os(this.score_table[o].user_id,this.score_table[o].time,a)
else if(this.score_table[o].floater.rank!==a)this.score_table[o].floater.setRank(a)
var n=this.score_table[o].user_id
var s=Oi(n).display_name||n
this.score_table[o].floater.setName(s)
r.unshift({floater:this.score_table[o].floater,max_dist:es,fade_dist:ts})}}if(this.buzzer_id){if(!this.id_floater)this.id_floater=new Xn(Na.addColon(Na.LBL_COURSE_FINISH),this.buzzer_id)
r.push({floater:this.id_floater,max_dist:es,fade_dist:ts})}na(r,this.floater_pos,.125)}}}if(this.baked.key===ls)return this.particleSystemRun(e)
else this.detachParticleSystems()}return null}
Prop.prototype.buzzerGoalInteractable=function(){if(this.interact_locked)return null
if(this.buzzer_id){if((Li("race_data")||{}).id===trueBuzzerID(this.buzzer_id))return null}else if(!Si())return null
return Uo}
Prop.prototype.buzzerGoalInteract=function(){if(!this.buzzer_id){$a.get("buzzid").setMessage(Na.STATUSMSG_ASSIGN_FLAG_NAME)
return}var e=O.subs.logged_in_username
Za(this,e)}
Prop.prototype.buzzerGoalCollisionInteract=function(e){var t=Li("race_data")||{}
var r=Date.now()-e
if(t.start<r&&this.buzzer_id&&t.id===trueBuzzerID(this.buzzer_id)&&!this.property_edit_locked){var a=O.subs.logged_in_username
var i={user_id:a,time:r-t.start}
var o=this
this.triggerParticleSystemList("fireworks")
qi("race_end")
U.modalDialog({title:Na.DLG_SUBMITTING_SCORE_TITLE,text:Na.MSG_PLEASE_WAIT})
Gi(this,i,function(){if(bi.chunk_map[o.chunk_id])Za(o,a,i)})}}
function isSpotlitBuzzer(e){var t=Yi()
return t&&e.buzzer_id&&trueBuzzerID(e.buzzer_id)===trueBuzzerID(t.d)&&e.chunk_id===t.c&&e.pos_idx===t.p}Prop.prototype.buzzerGoalPropertyEdit=function(){if(isSpotlitBuzzer(this)){$a.get("buzz_no_edit").setMessage(Na.STATUSMSG_REMOVE_SPOTLIGHT_TO_EDIT)
return}za(this,{fields:[{key:"buzzer_id",label:Na.LBL_COURSE_NAME,msg:Na.DLG_COURSE_GOAL_NAME_MSG,confirm_msg:this.buzzer_id?Na.DLG_CHANGING_NAME_WILL_RESET_MSG:null,max_len:30,profanity_lock:true,allow_clear:true,on_change:function on_change(e){e.score_table=[]}}],direct:true})}
Prop.prototype.toItem=function(){return La({type:Ft,id:this.item_id,attr1:this.attr1,attr2:this.attr2,attr3:this.attr3})}
Prop.prototype.plantToItem=function(){var e=La({type:Ft,id:this.item_id,attr1:this.attr1,attr2:this.attr2,attr3:mapToSeedFromFlowerType(this.attr3)})
if(!e.attr3)e.placeable=false
return e}
Prop.prototype.reloadContents=function(e){S(this.prediction_locked)
if(e){S(Array.isArray(e))
this.contents=e.map(xa)}else this.contents=[]
this.prediction_locked=false}
Prop.prototype.onDigBase=function(e){this.getLocalPos(gn)
bi.transPropRemove(e,this,true)
if(this.inv.mineable)if(this.local_last_pay_cost){var t=this.local_last_pay_cost
var r=[]
for(var a=0;a<t.length;++a){var i=t[a]
S(i.delta<0)
S(i.item)
var o=La(i.item)
o.count=-i.delta
r.push(o)}Er.addToBagSplatter(e,gn,{cost:r})}else Er.addToBagSplatter(e,gn,this.toItem())
else S(false)}
Prop.prototype.onDig=Prop.prototype.onDigBase
Prop.prototype.cropOnFlow=function(e){if(!this.inEditBounds(h))return
this.onDig(e)}
var us=ve()
Prop.prototype.bagPickup=function(){if(va.locked(ma)||va.locked(pa))return false
var e=false
var t=false
var r=true
var a
var i=[]
for(var o=0;o<this.contents.length;++o){var n=this.contents[o]
if(!n)continue
t=true
var s=n.count
var l=void 0
var c=Ea(n)
var _=0
if(-1!==c){a=a||on()
Ia(a,pa,n,c)
_=s}else if(l=ga(ma,n,s)){a=a||on()
for(var u=0;u<l.length;){var d=l[u++]
var f=l[u++]
Ia(a,ma,n,d,false,f)
_+=f}}if(_){Sa(a,this,o,_)
a.silent_error=true
i.push(n)
e=true}if(_!==s)r=false}if(!e&&t){$a.get("ifull").setMessage(Na.MSG_INVENTORY_FULL).fade()
return false}this.no_pickup_counter=1e3
if(i.length){S(a)
this.getLocalPos(us)
bi.transItemAnim(a,{style:zt,src_type:qt,src:us,target_type:Yt,items:i,from_center:false,pred:true})}if(r){S(ce(this.size,ee))
var v=bi.chunk_map[this.chunk_id]
S(v&&v.did_gen)
if(v.get(this.pos,false)===ci.PROP_BASE)v.set(this.pos,0,false)
v.setProp(this.pos,null)}return true}
var ds=.75
var fs=.35
var vs=[ve(-.5,-.5,0),ve(-1,-.6,-.02),ve(-.25,-.75,-.04)]
var hs=.35*(.25*oo(2)/2*ds)
function bagSoloDraw(e,t,r,a,i){var o=Nr()
x(o,fs,e,t)
T(o,o,vs[a])
drawBlock(o,r,i,1,false)}function drawBagSet(e,t,r){var a=t.contents
var i=t.quat
if(1===a.length&&a[0]&&a[0].type===Gt)bagSoloDraw(i,e,a[0].id,0,t.draw_opts)
else Jo.draw(e,i,hs,t.draw_opts)}function itemDebug(e){return e?e.type+":"+e.id+"("+e.count+")":"null"}function bagDraw(e,t,r){S(t.contents&&t.contents.length)
var a={}
var i=[]
var o=false
var n=0
for(var s=0;s<t.contents.length;++s){var l=t.contents[s]
if(!l)continue
var c=l.id
if(l.type!==Gt)if(l.preview_block_id)c=l.preview_block_id
else{o=true
break}if(!a[c]){a[c]=0
i.push(c)}a[c]+=l.count
n+=l.count}var _=0
if(o){drawBagSet(e,t,r);++_}else if(n){S(i.length)
var u=eo(n,3)
var d=0
var f=n/u
for(var v=0;v<i.length;++v){var h=i[v]
if(a[h]>=f){while(a[h]>=f){a[h]-=f
bagSoloDraw(t.quat,e,h,d,t.draw_opts);++_;++d}a[h]=0}}for(var p=0;d<u&&p<i.length;++p){var m=i[p]
if(a[m]){bagSoloDraw(t.quat,e,m,d,t.draw_opts);++_;++d}}}return _}Prop.prototype.bagDraw=function(e){if(this.done)return 0
var t=Aa(this.contents,this.chunk_id,this.pos_idx,this.quat)
if(t.length)return bagDraw(e,{contents:t,quat:this.quat,draw_opts:this.draw_opts})
return 0}
function bagCalcDrawOffs(e,t){_o.reseed(e)
t[0]=.5+.25*(_o.random()-.5)
t[1]=.5+.25*(_o.random()-.5)
return Io+_o.random()*So}Prop.prototype.bagUpdatePos=function(){this.rot_speed=bagCalcDrawOffs(this.pos_idx,this.draw_offs)}
var ps=ve()
Prop.prototype.bagUpdateState=function(){var e=this
if(this.done||va.locked(this)||this.trans_busy||!this.inEditBounds(v))return
var t=A.frame_dt
this.expire_counter-=t
if(this.expire_counter<=0){var r=on()
if(this.expiring_soon){this.done=true
bi.transPropRemove(r,this,false,true)
r.onComplete(function(){e.done=false})}else{this.expiring_soon=true
this.expire_counter=Eo
bi.transPropUpdate(r,this)}return}this.drop_counter-=t
if(this.drop_counter<=0){this.drop_counter=yo
this.getLocalPos(gn)
ie(ps,gn)
ps[2]--
if(Or(ps)){var a=on()
var i=Ta(this.contents)
S(i.length)
no.bagAddTrans(a,{src_pos:gn,target_pos:ps,bag_to_ignore:this,items:i,max_search:To,from_center:false,is_update_func:true})
bi.transPropRemove(a,this,false,true)
a.silent_error=true
this.trans_busy=true
a.onComplete(function(){e.trans_busy=false})}}}
Prop.prototype.bagTick=function(){var e=A.frame_dt
S(this.pos)
if(this.done)return
M(this.quat,this.quat,e*this.rot_speed)
this.drop_vel=$i(_,this.drop_vel+e*c)
this.draw_offs[2]+=this.drop_vel*e
if(this.draw_offs[2]<0){this.draw_offs[2]=0
this.drop_vel=0}if(!this.draw_offs[2]&&this.expiring_soon){this.hop_time-=e
if(this.hop_time<=0){this.hop_time=Ao+ro()*wo
this.drop_vel=.0025}}if(A.defines.BAG){if(!this.content_floater){this.content_floater=new ia
this.floater_pos=ve()}this.getLocalPos(this.floater_pos)
this.content_floater.setText(this.contents.map(itemDebug).join(",")+"; v:"+this.version)
oa({floater:this.content_floater},this.floater_pos,ea)}if(va.locked(ma)||va.locked(pa)||va.locked(this)||this.trans_busy||xi()||!this.inEditBounds(v))return
if(this.no_pickup_counter){this.no_pickup_counter-=e
if(this.no_pickup_counter<=0)this.no_pickup_counter=0}this.getLocalPos(gn)
re(xn,gn,J)
var t=oe(an.center_pos,xn)
if(this.no_pickup_counter){if(t>=mo)this.no_pickup_counter=0}else if(t<=po)if(this.bagPickup())return}
var ms=ve()
Prop.prototype.bagVacate=function(e,t,r){var a=Infinity
var i=1
for(var o=1;;o++){for(var n=-o;n<=o;++n){var s=n===-o||n===o
gn[0]=t[0]+n
var l=n*n
for(var c=-o;c<=o;++c){var _=s||c===-o||c===o
gn[1]=t[1]+c
var u=l+c*c
for(var d=-o;d<=o;d+=_?1:2*o){gn[2]=t[2]+d
if(Or(gn)){var f=u+d*d
gn[2]--
var v=false
if(f===a){++i
if(ro()<1/i)v=true}if(f<a||v){gn[2]++
a=f
ie(ms,gn)
if(!v)i=1}}}}}if(a<o*o)break
S(o<100)}var h=Ta(this.contents)
no.bagAddTrans(e,{src_pos:t,target_pos:ms,bag_to_ignore:this,items:h,from_center:false,is_update_func:true})
if(!r)bi.transPropRemove(e,this,false,true)}
var gs=ve()
Prop.prototype.plantOnDig=function(e,t){var r=this
e=e||on()
var a=this.item_id===dt?mapToSeedFromFlowerType(this.attr3):this.attr3
if(!Cr()&&this.stage===this.stage_ready&&a){bi.transPropRemove(e,this,true)
if(t)qi("plant_harvest")
for(var i=0;i<this.harvest_results.length;++i){var o=this.harvest_results[i]
if(o.drop_chance)o.count=ro()<o.drop_chance?1:0
if(!o.count)continue
var n=La(o)
n.attr3=n.id===dt||n.id===wt?a:0
this.getLocalPos(gs)
no.bagAddTrans(e,{item:n,emptied_pos:gs,target_pos:gs,src_pos:gs,auto_pickup:true,from_center:true})}}else{if(t)qi("plant_harvest_empty")
this.onDigBase(e)}this.interact_locked=true
e.onComplete(function(){r.interact_locked=false})
e.silent_error=true}
Prop.prototype.cropOnDig=function(e,t){var r=this
e=e||on()
if(this.cropHarvestable()){if(!this.interact(e,t))bi.transPropRemove(e,this,true)
return}else{if(t)qi("plant_harvest_empty")
bi.transPropRemove(e,this,true)}this.interact_locked=true
e.onComplete(function(){r.interact_locked=false})
e.silent_error=true}
Prop.prototype.wildCropOnDig=function(e,t){var r=this
e=e||on()
bi.transPropRemove(e,this,true)
if(!Cr()){if(t)qi("crop_harvest")
var a
if(ua[this.attr3]===kt||ua[this.attr3]===We||ua[this.attr3]===Ot)a=La({type:Ft,id:da[this.attr3],count:1})
else a=La({type:Ft,id:ro()<.5?da[this.attr3]:ua[this.attr3],count:1})
this.getLocalPos(gs)
no.bagAddTrans(e,{item:a,emptied_pos:gs,target_pos:gs,src_pos:gs,auto_pickup:true,from_center:true})}else if(t)qi("plant_harvest_empty")
this.interact_locked=true
e.onComplete(function(){r.interact_locked=false})
e.silent_error=true}
Prop.prototype.plantInteract=function(e,t){if(this.stage!==this.stage_ready)if(this.waterableInteract(e,t))return
this.onDig(e,t)}
Prop.prototype.torchInteractable=function(){if(Hi())return Uo
return null}
Prop.prototype.torchInteract=function(e,t){e=e||on()
if(t){Xi(Zi.Broken)
br("block_break",this.inv.getMaterial())}this.onDig(e,t)}
var Es=ve()
Prop.prototype.plantNeighborChanged=function(e,t){this.getLocalPos(gs);--gs[2]
var r
if(t[2]===gs[2]&&t[0]>=gs[0]&&t[0]<gs[0]+this.size[0]&&t[1]>=gs[1]&&t[1]<gs[1]+this.size[1])r=0
else{Es[2]=gs[2]
e:for(var a=0;a<this.size[0];++a){Es[0]=gs[0]+a
for(var i=0;i<this.size[1];++i){Es[1]=gs[1]+i
if((r=bi.getTileLocal(Es,1,false))>=di&&r<=fi)r=0
if(!r)break e}}}if(!r)this.plantInteract(e)}
Prop.prototype.blueboxCalcBounds=function(){var o=ve()
var n=ve()
var s=ve()
var l=ve()
return function blueboxCalcBounds(){var e=this.blueprint_def,t=this.rot
if(!e.loaded)return null
var r
var a
if(this.bluebox_state===vr){r=this.bluebox_origin_offset
a=this.bluebox_size}else{r=e.origin_offset
a=e.size}S(r&&a)
var i=(this.flipped?E:m)[t]
Di(n,this.chunk_id,this.pos)
o[0]=n[0]+r[0]*i[0]+r[1]*i[1]
o[1]=n[1]+r[0]*i[2]+r[1]*i[3]
o[2]=n[2]+r[2]
_e(s,a[0]*i[0]+a[1]*i[1],a[0]*i[2]+a[1]*i[3],a[2])
if(s[0]<0){l[0]=o[0]
o[0]=o[0]+s[0]+1}else l[0]=o[0]+s[0]-1
if(s[1]<0){l[1]=o[1]
o[1]=o[1]+s[1]+1}else l[1]=o[1]+s[1]-1
l[2]=o[2]+s[2]-1
if(this.bluebox_bounds_origin){ie(this.bluebox_bounds_origin,o)
se(ue(this.bluebox_bounds_size,l,o),ee)
re(this.bluebox_bounds_inv_origin,l,ee)
le(ue(this.bluebox_bounds_inv_size,o,l),ee)}else{this.bluebox_bounds_origin=o.slice(0)
this.bluebox_bounds_size=se(le(l.slice(0),o),ee)
this.bluebox_bounds_inv_origin=se(l.slice(0),ee)
this.bluebox_bounds_inv_size=le(le(o.slice(0),l),ee)}return this}}()
Prop.prototype.blueboxUpdatePos=function(){var t=ve()
var r=3
return function blueboxUpdatePos(){S(!this.removed)
if(this.is_preview||null===this.chunk_id)return
if(!(this.bluebox_state===pr||this.bluebox_state===vr)){if(this.bluebox_in_list_edit){rr(this)
this.bluebox_in_list_edit=false}return}var e=this.blueprint_def
if(!e.loaded){e.onLoad(this.blueboxUpdatePosDelayed.bind(this))
return}if(!this.added_to_blueprint_def){this.added_to_blueprint_def=true
e.addProp(this)}this.blueboxCalcBounds()
this.bluebox_bounds_sort_bias=r+Qi(t[2])/2
if(!this.bluebox_in_list_edit){tr(this)
this.bluebox_in_list_edit=true}else ar(this)}}()
Prop.prototype.blueboxUpdatePosDelayed=function(){if(this.removed)return
this.blueboxUpdatePos()}
Prop.prototype.blueboxOnRemove=function(){if(this.bluebox_in_list_edit){rr(this)
this.bluebox_in_list_edit=false}if(this.added_to_blueprint_def){this.blueprint_def.removeProp(this)
this.added_to_blueprint_def=false}}
Prop.prototype.blueboxUpdateDrawable=function(){var e=this.baked.key
switch(this.bluebox_state){case mr:this.updateState=this.blueboxUpdateState
this.baked.key="bluebox-pre-edit"
break
case hr:this.updateState=null
this.baked.key="bluebox-paused"
break
case fr:this.updateState=this.blueboxUpdateState
this.baked.key="bluebox-build"
break
case pr:this.updateState=null
this.baked.key="bluebox-pre-edit"
break
case vr:this.updateState=null
this.baked.key="bluebox-edit"
break
default:this.baked.key="bluebox-pre-edit"}if(!this.is_preview&&null!==this.chunk_id){bi.propStateUpdate(this)
if(this.baked.key!==e){var t=bi.chunk_map[this.chunk_id];++t.ver_props
t.dirty()}this.blueboxUpdatePos()}}
Prop.prototype.blueboxUpdatePreview=function(){var e=this.blueprint_def
if(e.isEmptyEditable()){var t=e.origin_offset
var r=e.size
if(ur()){r=ir.capture_preview_size
t=ir.capture_preview_origin_offset}S(r)
if(this.bluebox_state!==vr||!ce(this.bluebox_size,r)){this.bluebox_origin_offset=K(t)
this.bluebox_size=K(r)
this.bluebox_ver=e.ver
this.bluebox_state=vr
this.updateDrawable()}}else if(this.bluebox_state===vr){this.bluebox_origin_offset=this.bluebox_size=null
this.bluebox_ver=null
this.bluebox_state=fr
this.updateDrawable()}}
Prop.prototype.blueboxAfterPlace=function(){lr(this.interactDetails(),true)}
Prop.prototype.blueboxUpdateBeforePlace=function(e,t){this.blueboxUpdatePreview()
this.setLocalPos(e)
sr(t,this)}
Prop.prototype.blueboxInteractable=function(){return xi()?null:Wo}
Prop.prototype.blueboxOpenUI=function(){Ma(Ua.BLUEBOX,this.interactDetails())}
Prop.prototype.blueboxInteract=function(){cr(this)}
Prop.prototype.blueboxOnDig=function(e){if(this.bluebox_state===fr){this.blueboxChangeState(e,mr)
return}var t=(this.contents||[]).filter(ba)
e=e||on()
this.getLocalPos(gn)
bi.transPropRemove(e,this)
if(t.length&&!Cr())Er.addToBagSplatter(e,gn,{cost:t},false,true)}
Prop.prototype.transBusy=function(e){var t=this
if(this.trans_busy)return
this.trans_busy=true
e.onComplete(function(){t.trans_busy=false})}
Prop.prototype.blueboxChangeState=function(e,t,r){var a=t===fr?Ca.walltime_seconds:0
this.bluebox_last_update_local=a
var i=this.blueprint_def
var o
var n
var s=null
if(t===vr){o=K(i.origin_offset)
n=K(i.size)
s=i.ver}else o=n=null
if(r){this.bluebox_origin_offset=o
this.bluebox_size=n
this.bluebox_ver=s
this.bluebox_state=t
this.bluebox_last_update=a
if(t===fr){var l={}
var c=this.blueprint_def&&this.blueprint_def.chunk_map
for(var _=0;_<c.length;++_){var u=c[_].props
for(var d in u){var f=u[d]
if(Wt(f.inv))l[ge(f.item_id,f.attr1,f.attr2,f.attr3)]=1}}if(Object.keys(l).length>0)this.bluebox_req_permissions=l}}else{e=e||on()
bi.transPropUpdateField(e,this,"bo","bluebox_origin_offset",o)
bi.transPropUpdateField(e,this,"bs","bluebox_size",n)
bi.transPropUpdateField(e,this,"bv","bluebox_ver",s)
bi.transPropUpdateField(e,this,"s","bluebox_state",t)
bi.transPropUpdateField(e,this,"lu","bluebox_last_update",a)
e.bluebox_no_last_update=true
this.updateDrawable()
this.transBusy(e)}}
Prop.prototype.blueboxUpdateState=function(){if(va.locked(this)||this.trans_busy||!this.blueprint_def.loaded||Wi())return
var e=fo/P.blueprint_rate
if(this.bluebox_state===mr)e=1
var t=Ca.walltime_seconds-this.bluebox_last_update_local
if(t<e)return
var r=Ji(t/e)
var a=this.bluebox_last_update_local+r*e
this.bluebox_last_update_local=a
this.bluebox_total_ticks+=r
var i=_r(this,r)
if(i){i.opBlueboxInfo(this.chunk_id,this.pos_idx)
if(!i.bluebox_no_last_update)bi.transPropUpdateField(i,this,"lu","bluebox_last_update",a)
this.transBusy(i)}}
Prop.prototype.getLocalPos=function(e){if(!e){if(!this.local_pos_temp)this.local_pos_temp=ve()
e=this.local_pos_temp}bi.getLocalPosFromChunkID(e,this.chunk_id,this.pos)
return e}
var ys=ve()
Prop.prototype.inEditBounds=function(e){var t=this.getLocalPos()
if(e===v)return Br(t)
var r
if(e===h)r=this.size
else if(e===p){r=this.max_size
if(!this.max_size){r=this.max_size=this.size.slice(0)
if(this.stages)for(var a=0;a<this.stages.length;++a)r[2]=$i(r[2],this.stages[a])}}else S(false)
for(var i=0;i<r[2];i+=$i(r[2]-1,1)){ys[2]=t[2]+i
for(var o=0;o<r[1];o+=$i(r[1]-1,1)){ys[1]=t[1]+o
for(var n=0;n<r[0];n+=$i(r[0]-1,1)){ys[0]=t[0]+n
if(!Br(ys))return false}}}return true}
Prop.prototype.existsInWorld=function(){return this===bi.getPropDirect(this.chunk_id,this.pos)}
Prop.prototype.getMaterial=function(){return this.inv.getMaterial(false)||jt.DIRT}
Prop.prototype.getMaterialClass=function(){var e=this.inv.getMaterialClass()
if(!X(e!==Ba.NONE))e=Ba.DIRT
return e}
var Ts={chunk_id:1,pos_idx:1,draw_opts:1,stages:1,harvest_to_stage:1,harvest_results:1,stage_ready:1,door_left_quat:1,door_right_quat:1,door_offs:1,door_pos:1,quat:1,mat:1,last_size:1,bid:1,gem_quat:1,gem_pos:1,gem_mat:1,gem_offs:1,local_pos_temp:1,blueprint_def:1,box_ctx:1,particle_systems:1}
Prop.prototype.toDebug=function(){var e={}
for(var t in this){if(Ts[t])continue
var r=this[t]
if("function"===typeof r||void 0===r||false===r||null===r)continue
e[t]=r}return e}
function deserializeContents(e,t){e.contents=(t.d||[]).map(xa)}function serializeContents(e,t){e.d=t.contents||[]}Prop.prototype.toJSON=function(){var e={id:this.item_id}
if(_n[this.item_id])serializeContents(e,this)
if(this.isFactory()){e.fr=this.factory_recipe||void 0
e.fs=this.factory_state||void 0
e.ft=this.factory_time||void 0}if(this.hasGrowthTime())e.gt=Ji(24*this.growth_skytime)
switch(this.item_id){case xe:e.s=this.bluebox_state
if(this.bluebox_state!==fr)S(!this.bluebox_last_update)
e.lu=this.bluebox_last_update
if(this.bluebox_state!==vr)S(!this.bluebox_origin_offset)
e.bo=this.bluebox_origin_offset||void 0
e.bs=this.bluebox_size||void 0
e.bv=this.bluebox_ver||void 0
e.br=this.bluebox_req_permissions||void 0
break
case we:case Ae:case Le:case dt:case mt:case yt:case pt:case gt:case Tt:case Et:if(this.item_id===yt)e.l=this.harvest_left
e.d=this.stage|(this.watered?8:0)
break
case Dt:e.d=this.water_amount
break
case Ie:if(this.expiring_soon)e.es=1
break
case He:case je:e.d=this.open
break
case St:case At:e.d=this.sign_text
break
case Pt:e.d=this.waygate_targets
if(this.exitway_access)e.ea=this.exitway_access
break
case Qe:e.d=this.gem_id
break
case Me:e.d=this.buzzer_id
break
case Ce:e.d=this.buzzer_id
e.ms=this.max_scores
e.st=[]
for(var t=0;t<this.score_table.length;t++)e.st.push({user_id:this.score_table[t].user_id,time:this.score_table[t].time})
break
case Re:S(false)}if(1!==this.size[0])e.sx=this.size[0]
if(1!==this.size[1])e.sy=this.size[1]
if(1!==this.size[2])e.sz=this.size[2]
if(this.rot)e.rot=this.rot
if(this.flipped)e.f=1
if(this.attr1)e.a1=this.attr1
if(this.attr2)e.a2=this.attr2
if(this.attr3)e.a3=this.attr3
if(this.fallback)e.fb=this.fallback
if(this.proc_genned)e.pg=1
if(Ca.omp&&this.version>1)e.v=this.version
return e}
Prop.prototype.drawBaked=function(e){$t(this,e)}
function filterTilled(e){return e===vi||e===hi}filterTilled.label="Tilled Dirt"
function filterDirt(e){if(gi[e])return gi[e].mat===jt.DIRT
return false}filterDirt.label="Dirt or Grass"
function createFromInv(e,t){S(Ra(e))
var r=new Prop(e)
ie(r.size,e.size)
if(e.is_preview)r.is_preview=e.is_preview
if(e.snapshot_size)r.snapshot_size=e.snapshot_size
r.place_rot=e.place_rot
var a=r.item_id
switch(a){case xe:r.bid=r.attr1
S(r.bid||e.blueprint_def)
r.updateDrawable=r.blueboxUpdateDrawable
r.onDig=r.blueboxOnDig
r.interact=r.blueboxInteract
r.interactable=r.blueboxInteractable
r.afterPlace=r.blueboxAfterPlace
r.updatePreview=r.blueboxUpdatePreview
r.updateBeforePlace=r.blueboxUpdateBeforePlace
r.updatePos=r.blueboxUpdatePos
r.onRemove=r.blueboxOnRemove
r.bluebox_state=hr
r.bluebox_last_update_local=0
r.bluebox_last_update=0
r.bluebox_total_ticks=t&&t.bluebox_total_ticks||0
r.bluebox_done_ticks=t&&t.bluebox_done_ticks||0
r.blueprint_def=e.blueprint_def||gr(r.bid)
r.bluebox_origin_offset=null
r.bluebox_size=null
r.bluebox_ver=0
r.bluebox_in_list_edit=false
r.contents=[]
_n[a]=true
r.container_size=Infinity
r.snapshot_size=ve()
r.snapshot_pos=ve()
break
case ke:r.interact=r.chairInteract
r.interactable=r.chairInteractable
r.read_only_interact=true
break
case St:case At:r.interactable=r.signInteractable
r.interact=r.signInteract
r.updateDrawable=r.signUpdateDrawable
r.floater_pos=ve()
r.floater_offset=ve()
r.sign_text=R(Na.MSG_SIGN_DEFAULT_TEXT)
break
case mt:case yt:case pt:case gt:case Tt:case Et:switch(a){case mt:r.stages=zo
r.harvest_to_stage=0
r.harvest_results=cn[r.item_id]
r.stage_ready=r.stages.length-1
r.stage_pickable=r.stages.length-3
break
case Tt:r.stages=Yo
r.harvest_to_stage=0
r.harvest_results=cn[r.item_id]
r.stage_ready=r.stages.length-1
break
case yt:r.stages=Vo
r.harvest_to_stage=Vo.length-3
r.harvest_results=cn[r.item_id]
r.stage_ready=r.stages.length-2
r.harvest_left=2
break
case pt:r.stages=Zo
r.harvest_to_stage=0
r.stage_ready=r.stages.length-1
r.harvest_results=cn[r.item_id]
break
case gt:r.stages=Xo
r.harvest_to_stage=0
r.stage_ready=r.stages.length-1
r.harvest_results=cn[r.item_id]
break
case Et:r.stages=Qo
r.harvest_to_stage=0
r.harvest_results=cn[r.item_id]
r.stage_ready=r.stages.length-1
break
default:S(0)}S(r.harvest_results.length)
r.updateDrawable=r.cropPlantUpdateDrawable
r.updateState=r.cropUpdateState
r.updateBeforePlace=r.cropUpdateBeforePlace
r.interact=r.cropInteract
r.interactable=r.cropInteractable
r.interactable_continuously=true
r.onFlow=r.cropOnFlow
r.onDig=r.cropOnDig
r.groundFilter=filterTilled
r.place_rot=r.rot=Ji(4*ro())
r.baked={key:"crop_corn_1",rot:r.rot}
r.baked.size=r.size
r.stage=0
r.watered=false
break
case Ie:r.updateState=r.bagUpdateState
r.updatePos=r.bagUpdatePos
r.tick=r.bagTick
r.vacate=r.bagVacate
r.draw=r.bagDraw
r.contents=[]
_n[a]=true
r.container_size=Infinity
r.destroy_on_empty=true
r.drop_vel=0
r.no_pickup_counter=0
r.expire_counter=go
r.expiring_soon=false
r.drop_counter=yo
r.hop_time=Ao+ro()*wo
r.rot_speed=Io
r.draw_offs[0]=.5
r.draw_offs[1]=.5
if(t){r.rot_speed=t.rot_speed
ie(r.draw_offs,t.draw_offs)}break
case Ct:r.interactable=r.torchInteractable
r.interact=r.torchInteract
break
case dt:if(!mapToSeedFromFlowerType(r.attr3))r.attr3=la[0]
r.interact=r.plantInteract
r.watered=false
r.stage=1
r.stage_ready=1
r.harvest_to_stage=1
r.updateBeforePlace=r.plantUpdateBeforePlace
r.updateDrawable=r.cropPlantUpdateDrawable
r.updateState=r.plantUpdateState
r.growth_time=Ro
r.toItem=r.plantToItem
r.groundFilter=filterDirt
r.neighborChanged=r.plantNeighborChanged
r.waterableInteract=r.plantWaterableInteract
r.interactable=r.cropInteractable
r.onFlow=r.plantOnDig
r.onDig=r.plantOnDig
r.baked={key:"plant-"+r.attr3}
r.rot=0
if(isMushroom(r.attr3))r.harvest_results=[{type:Ft,id:dt,count:1,user_inv_type:1},{type:Ft,id:nt,count:1,user_inv_type:1,attr1:Po[r.attr3].attr1}]
else r.harvest_results=nn
break
case we:case Ae:case Le:r.harvest_to_stage=1
r.stages=a===Le?Ko:qo
r.harvest_results=cn[r.item_id]
r.watered=false
r.stage=2
r.stage_ready=2
r.growth_time=xo
r.updateBeforePlace=r.plantUpdateBeforePlace
r.updateDrawable=r.cropPlantUpdateDrawable
r.updateState=r.plantUpdateState
r.groundFilter=filterDirt
r.neighborChanged=r.plantNeighborChanged
r.waterableInteract=r.plantWaterableInteract
r.interactable=r.cropInteractable
r.interact=r.cropInteract
r.onFlow=r.cropOnFlow
r.onDig=r.cropOnDig
r.baked={key:"red-berry-bush-0"}
r.rot=0
break
case tt:if(r.attr3&&r.attr3!==jt.ANY)r.baked={key:Jt("bottle",{MAT_ANY_INGREDIENT:r.attr1===jt.ANY?jt.HOT:r.attr1,MAT_LABEL:r.attr3})}
else if(r.attr1!==jt.ANY)r.baked={key:Qt("bottle",r.attr1)}
else r.baked={key:Qt("bottle",jt.RED_BERRY)}
break
case wt:if(Pa[r.attr3]===Ba.INGREDIENT)r.baked={key:""+ka[r.attr3].toLowerCase()}
else r.baked={key:""+ka[jt.HOT].toLowerCase()}
break
case ut:if(r.attr3)r.baked={key:Jt("pie",{MAT_ANY_INGREDIENT:r.attr1,MAT_LABEL:r.attr3})}
else if(r.attr1!==jt.ANY)r.baked={key:Qt("pie",r.attr1)}
else r.baked={key:Qt("pie",jt.PUMPKIN)}
break
case vt:if(r.attr3)r.baked={key:Jt("sandwich",{MAT_BREAD:r.attr3})}
else r.baked={key:"sandwich"}
break
case Lt:if(r.is_preview)r.attr3=r.attr3||jt.HOT
r.baked={key:ka[r.attr3].toLowerCase()+"-plant"}
r.onFlow=r.plantOnDig
r.onDig=r.plantOnDig
r.interact=r.plantOnDig
r.interactable=r.cropInteractable
r.harvest_results=sn
r.stage_ready=0
r.stage=0
break
case Bt:r.baked={key:"wild-crop-"+(fa[r.attr3]||"corn")}
r.onFlow=r.wildCropOnDig
r.onDig=r.wildCropOnDig
r.interact=r.wildCropOnDig
r.stage_ready=0
r.stage=0
r.interactable=r.cropInteractable
break
case Dt:r.baked={key:"watering-system"}
r.interact=r.wateringSystemInteract
r.updateDrawable=r.wateringSystemUpdateDrawable
r.updateState=r.wateringSystemUpdateState
r.interactable=r.wateringSystemInteractable
r.water_amount=0
r.max_water=3
r.range=2
break
case Fe:case Ue:case Be:case Ge:r.contents=[]
_n[a]=true
switch(a){case Fe:r.container_size=2
break
case Ue:r.container_size=4
break
case Be:r.container_size=24
break
case Ge:r.container_size=32
break
default:S(0)}r.interact=r.chestInteract
r.interactable=r.alwaysInteractable
r.mineable=r.chestMineable
r.mineWhenBlocked=r.chestMineWhenBlocked
break
case He:case je:r.open=0
r.door_left_quat=N()
r.door_right_quat=N()
r.door_pos=ve()
r.door_offs=ve()
r.updateDrawable=r.doorUpdateDrawable
r.draw=r.doorDraw
r.interact=r.doorInteract
r.interactable=r.doorInteractable
r.read_only_interact=true
break
case Qe:r.gem_quat=N()
r.gem_pos=ve()
r.gem_mat=$()
r.gem_offs=ve()
r.tick=r.gemTick
r.draw=r.gemDraw
r.updateDrawable=r.gemUpdateDrawable
r.propertyEdit=r.gemPropertyEdit
break
case et:r.indicator_quat=N()
r.indicator_pos=ve()
r.indicator_offs=ve()
r.tick=r.indicatorTick
r.draw=r.indicatorDraw
break
case Re:r.mat=$()
r.draw=r.blockPreviewDraw
break
case ye:r.read_only_interact=true
r.interactable=r.accessControlInteractable
r.interact=r.accessControlInteract
r.interactDetails=r.accessControlInteractDetails
break
case Pt:r.waygate_targets=null
r.exitway_access=0
r.mineable=r.waygateMineable
r.mineWhenBlocked=r.waygateMineWhenBlocked
r.interact=r.waygateInteract
r.interactable=r.waygateInteractable
r.afterPlace=r.waygateAfterPlace
break
case Ye:r.updateDrawable=r.energyWellUpdateDrawable
r.tick=r.energyWellTick
r.interactable=r.energyWellInteractable
r.interact=r.energyWellInteract
break
case Me:r.floater_pos=ve()
r.mineable=r.buzzerMineable
r.mineWhenBlocked=r.buzzerMineWhenBlocked
if(!r.is_preview)r.updateDrawable=r.buzzerStartUpdateDrawable
r.draw=r.buzzerStartDraw
r.interactable=r.buzzerStartInteractable
r.interact=r.buzzerStartInteract
r.shouldPropertyEdit=r.buzzerShouldPropertyEdit
r.propertyEdit=r.buzzerStartPropertyEdit
r.prop_edit_ids=as
r.read_only_interact=true
break
case Ce:r.score_table=[]
r.floater_pos=ve()
r.mineable=r.buzzerMineable
r.mineWhenBlocked=r.buzzerMineWhenBlocked
if(!r.is_preview)r.updateDrawable=r.buzzerGoalUpdateDrawable
r.draw=r.buzzerGoalDraw
r.interactable=r.buzzerGoalInteractable
r.interact=r.buzzerGoalInteract
r.collisionInteract=r.buzzerGoalCollisionInteract
r.shouldPropertyEdit=r.buzzerShouldPropertyEdit
r.propertyEdit=r.buzzerGoalPropertyEdit
r.prop_edit_ids=as
r.read_only_interact=true
break
case ct:r.draw=r.particleSystemRun
r.initParticles=r.initDebugParticles
break
case Oe:case be:case Xe:case Ze:case ht:case lt:case st:case xt:case Rt:case qe:case Ut:case Te:case Nt:case rt:case ot:case De:case at:case Mt:r.contents=[]
_n[a]=true
r.updateDrawable=r.factoryUpdateDrawable
r.container_size=Vr+Yr
r.interact=r.factoryInteract
r.interactable=r.interactableAdventure
r.mineable=r.chestMineable
r.mineWhenBlocked=r.chestMineWhenBlocked
r.factory_recipe=null
r.factory_state=qr
r.factory_time=0
break
case it:case Ne:r.baked={key:Qt(r.attr2?"bucket_full":"bucket_empty",r.attr1!==jt.ANY&&r.attr1,r.attr2)}
r.snapshot_camera_offset=co
r.prop_is_tool=true
break
case _t:case Je:case It:case $e:var i
switch(a){case _t:i="pickax"
break
case Je:i="hatchet"
break
case It:i="shovel"
break
case $e:i="hoe"
break
default:S(0)}if(Pa[r.attr1]===Ba.METAL)i="metal_"+i
else i="stone_"+i
if(r.attr1===jt.FLINT)if(a===Je)i="crude-stone-hatchet"
else if(a===_t)i="crude-stone-pickax"
else if(a===It)i="crude-stone-shovel"
r.baked={key:Qt(i,r.attr1,r.attr2)}
r.snapshot_camera_offset=co
r.prop_is_tool=true
break
case ze:case Ve:r.prop_is_tool=true}C(r.quat,pe,r.rot*vo)
if(e.baked_key)r.baked={key:e.baked_key}
if(e.baked_swap&&r.attr1!==jt.ANY){S(r.baked.key)
r.baked.key=Qt(r.baked.key,r.attr1,r.attr2)}if(e.fallback){r.fallback=true
r.baked.key=e.fallback_baked_key}if(r.inv.size_auto){S(r.baked.key)
ie(r.size,Xt(r.baked.key))}if(!(r.size[0]>=r.size[1]))S(r.size[0]>=r.size[1],"Prop "+e.getName()+" has invalid size ("+r.size.join(",")+") (X must be >= Y). Rotate source and adjust place_rot.")
ie(r.last_size,r.size)
if(r.item_id!==Ie){r.draw_offs[0]=.5*r.size[0]
r.draw_offs[1]=.5*r.size[1]}if("block"===e.on_flow)r.onFlow=null
else if("dig"===e.on_flow)r.onFlow=r.onDig
if(!r.baked)if(!e.intangible)r.baked={}
if(r.baked){if(r.rot)r.baked.rot=(r.rot+4)%4
r.baked.tangible=!e.intangible
r.baked.size=r.size}r.updateDrawable()
if(r.baked&&!r.is_preview&&!r.inv.placeable){console.log("Replacing unplaceable prop id="+r.inv.id+" with placeholder")
r.baked.key=A.DEBUG?"bluebox-edit":"plant-1"}r.emit=r.baked&&r.baked.key?Zt(r.baked.key):0
if(r.isContainer())S(_n[r.item_id])
return r}function createIndicatorProp(){var e=createFromInv(La({type:Ft,id:et}))
e.draw_opts={unlit:true}
return e}Prop.prototype.blueprintFilter=function(){var e=this.item_id
if(this.hasGrowthTime())this.growth_skytime=0
if(_n[this.item_id])this.contents=[]
switch(e){case xe:case Ie:return null
case He:case je:this.open=0
break
case Pt:this.waygate_targets=null
this.exitway_access=0
break
case Qe:this.gem_id=null
break
case Me:this.buzzer_id=null
break
case Ce:this.buzzer_id=null
this.max_scores=null
this.score_table=[]
break
case dt:this.stage=1
this.attr3=mapToSeedFromFlowerType(this.attr3)
this.watered=false
this.updateDrawable()
break
case we:case Ae:case Le:case mt:case yt:case pt:case gt:case Tt:case Et:this.stage=0
this.watered=false
this.size[2]=1
this.updateDrawable()
break
case Dt:this.water_amount=0
break
case Re:S(false)
return null}if(this.inv.no_auto_rot)this.rot=0
this.version=0
return this}
Prop.prototype.setRot=function(e){this.rot=(e+4)%4
if(this.baked)this.baked.rot=this.rot
C(this.quat,pe,this.rot*vo)
if(1&e&&this.size[0]>this.size[1]||!(1&e)&&this.size[1]>this.size[0]){var t=this.size[0]
this.size[0]=this.size[1]
this.size[1]=t}this.draw_offs[0]=.5*this.size[0]
this.draw_offs[1]=.5*this.size[1]}
var Is
function createBag(){if(!Is)Is=La({type:Ft,id:Ie})
return createFromInv(Is)}Prop.prototype.faceMe=function(){if(this.inv.no_auto_rot)return
var e=-an.ypr[0]
var t=(this.place_rot+ao(e/vo))%4
C(this.quat,pe,t*vo)
this.rot=(t+4)%4
if(1&t&&this.size[0]>this.size[1]||!(1&t)&&this.size[1]>this.size[0]){var r=this.size[0]
this.size[0]=this.size[1]
this.size[1]=r
this.draw_offs[0]=.5*this.size[0]
this.draw_offs[1]=.5*this.size[1]}}
Prop.prototype.shouldDigSlow=function(){if(this.contents&&!ya(this))return true
if(this.item_id===xe&&(this.bluebox_state===vr||this.bluebox_state===fr))return true
if(this.item_id===Qe&&this.gem_id)return true
return false}
var Ss=[]
for(var As=0;As<9;++As)Ss.push(ve())
function saveGlobalState(){ie(Ss[0],A.light_dir_ws)
_e(A.light_dir_ws,-.5,1,-3)
ie(Ss[1],k.globals.light_diffuse)
ie(k.globals.light_diffuse,ee)
de(Ss[2],k.globals.ambient)
de(k.globals.ambient,me)
ie(Ss[3],k.globals.fog_params)
_e(k.globals.fog_params,0,0,1e3)
ie(Ss[4],k.globals.fog_color)
_e(k.globals.fog_color,.2,.4,8/15)
ie(Ss[5],k.globals.light_flashlight)
_e(k.globals.light_flashlight,0,0,0)
ie(Ss[6],k.globals.light_sun_key)
ie(k.globals.light_sun_key,ee)
ie(Ss[7],k.globals.light_sun_top)
ie(k.globals.light_sun_top,me)
ie(Ss[8],k.globals.light_sun_back)
ie(k.globals.light_sun_back,me)}function restoreGlobalState(e){if(e)e()
ie(A.light_dir_ws,Ss[0])
ie(k.globals.light_diffuse,Ss[1])
de(k.globals.ambient,Ss[2])
ie(k.globals.fog_params,Ss[3])
ie(k.globals.fog_color,Ss[4])
ie(k.globals.light_flashlight,Ss[5])
ie(k.globals.light_sun_key,Ss[6])
ie(k.globals.light_sun_top,Ss[7])
ie(k.globals.light_sun_back,Ss[8])}var ws=null
var Ls=0
var Rs=null
var xs=0
Prop.prototype.getSnapshot=function(e,t){var r=this
var a=t&&t.dynamic_snapshot?1:0
var i=this.item_id===xe
var o=a||t&&t.force_update
if(i){if(e.blueprint_def)this.blueprint_def=e.blueprint_def
var n=this.blueprint_def
if(this.blueprint_def_ver!==n.ver)o=true}var s=a?"thumbnail_dynamic":"thumbnail"
if(!this[s]||o){var l=t.snapshot_res||so
if(a){l=t.snapshot_res||lo
this[s]=ws
if(Rs!==this||xs+1!==A.frame_index){Rs=this
Ls=0}Ls+=.001*A.frame_dt
xs=A.frame_index}if(i){var c=this.blueprint_def
S(c.loaded)
S(c.size)
ie(this.snapshot_size,c.size)
S(c.origin_offset)
ie(this.snapshot_pos,c.origin_offset)
this.blueprint_def_ver=c.ver}var _
var u
if(!a)u=function on_unload(){if(r[s]===_)r[s]=null
for(var e=0;e<_.inv_objs.length;++e)if(_.inv_objs[e].img===_){_.inv_objs[e].img=null
_.inv_objs[e].need_thumbnail_update=true}_.texs[0].destroy()
_.texs[1].destroy()}
_=B({name:"prop_snap_"+(a?"dyn_":"")+this.item_id+"_"+this.attr1+"_"+this.attr2+"_"+this.attr3+"_"+(this.fallback?"fb_":"")+(this.count||0),sprite:this[s],w:l,h:l,pos:this.snapshot_pos||me,size:this.snapshot_size||this.size,camera_offset:this.snapshot_camera_offset,pre:saveGlobalState,post:restoreGlobalState.bind(null,t&&t.snapshot_post),rot:a?Ls:0,snapshot_backdrop:t&&t.snapshot_backdrop||null,on_unload:u,draw:function draw(){S(!r.draw_opts.color||1===r.draw_opts.color[3])
r.draw_opts.for_snapshot=true
r.draw_opts.torch_factor=0
r.draw_opts.sun_factor=1
r.draw_opts.scale_lights=true
Ci(1)
if(r.item_id===xe)nr(r)
else bi.drawProp(r,me)
Ci()
r.draw_opts.for_snapshot=false}})
this[s]=_
if(a)ws=_}e.img=this[s]
e.img.inv_objs=e.img.inv_objs||[]
e.img.inv_objs.push(e)
e.frame=void 0
e.dynamic_snapshot=a}
Prop.prototype.allowAlpha=function(){if(!this.mat)this.mat=$()}
function createForPreview(e,t){var r=e.fallback;(e=La(e)).fallback=r
e.is_preview=true
var a=createFromInv(e)
switch(e.id){case mt:a.cropSetStage(a.stage_ready)
a.size[2]=5
break
case dt:a.size[2]=2
if(a.emit)a.baked.key+="-no-emit"
break
case we:case Ae:case Le:case yt:case pt:case gt:case Tt:case Et:a.cropSetStage(a.stage_ready)}if(t===u){a.allowAlpha()
a.draw_opts.color=Bo}return a}function getPreviewPropKey(e,t){return t+","+e.id+","+e.attr1+","+e.attr2+","+e.attr3+(e.fallback?",fb":"")}var Os=[]
function hasForPreview(e,t){S.equal(typeof t,"number")
var r=getPreviewPropKey(e,t)
var a=Os[r]
return Boolean(a&&a.thumbnail)}function getForPreview(e,t){S.equal(typeof t,"number")
var r=getPreviewPropKey(e,t)
var a=Os[r]
if(!a)a=Os[r]=createForPreview(e,t)
a.updatePreview()
return a}Prop.prototype.applyFieldMod=function(e,t){switch(this.item_id){case xe:switch(e){case"lu":this.bluebox_last_update_local=this.bluebox_last_update=t
break
case"s":this.bluebox_state=t
break
case"bo":this.bluebox_origin_offset=t
break
case"bs":this.bluebox_size=t
break
case"bv":this.bluebox_ver=t
break
default:S(false)}break
case He:case je:switch(e){case"d":if(this.open!==t){this.open=t
this.open_at=A.frame_timestamp}break
default:S(false)}break
case Ce:switch(e){case"st":this.score_table=t
break
default:S(false)}break
default:if(this.isFactory())switch(e){case"fr":this.factory_recipe=t
break
case"fs":this.factory_state=t
break
case"ft":this.factory_time=t
break
default:S(false)}else S(false)}}
function propDebugGetFieldName(e){switch(e){case"lu":return"bluebox_last_update_local"
case"s":return"bluebox_state"
case"bo":return"bluebox_origin_offset"
case"bs":return"bluebox_size"
case"bv":return"bluebox_ver"
case"d":return"open"
case"fr":return"factory_recipe"
case"fs":return"factory_state"
case"ft":return"factory_time"
default:return e}}function fromJSON(e,t){if(t&&t.item_id!==e.id)t=null
var r=La({type:Ft,id:e.id,attr1:e.a1,attr2:e.a2,attr3:e.a3})
r.fallback=e.fb
var a=createFromInv(r,t)
a.rot=e.rot||0
a.flipped=Boolean(e.f)
if(-1===e.sx){if(1&a.rot&&a.size[0]>a.size[1]||!(1&a.rot)&&a.size[1]>a.size[0]){var i=a.size[0]
a.size[0]=a.size[1]
a.size[1]=i}}else{a.size[0]=e.sx||1
a.size[1]=e.sy||1
a.size[2]=e.sz||1}a.version=e.v||1
if(a.item_id!==Ie){a.draw_offs[0]=.5*a.size[0]
a.draw_offs[1]=.5*a.size[1]}ie(a.last_size,a.size)
if(_n[a.item_id])deserializeContents(a,e)
if(a.isFactory()){a.factory_recipe=e.fr||null
a.factory_state=e.fs||qr
a.factory_time=e.ft||0}if(a.hasGrowthTime())a.growth_skytime=(e.gt||0)/24
var o=false
switch(a.item_id){case xe:a.bluebox_state=e.s||hr
a.bluebox_last_update_local=a.bluebox_last_update=e.lu||0
a.bluebox_origin_offset=e.bo||null
a.bluebox_size=e.bs||null
a.bluebox_ver=e.bv||null
a.bluebox_req_permissions=e.br||null
break
case we:case Ae:case Le:case yt:case pt:case gt:case mt:case dt:case Tt:case Et:if(a.item_id===yt)a.harvest_left=e.l
a.stage=7&e.d
a.watered=Boolean(8&e.d)
if(a.growth_skytime>Ja.skytime_value)a.growth_skytime-=256
break
case Dt:a.water_amount=e.d
break
case Ie:if(e.np===Ca.instance_uid)a.no_pickup_counter=uo
a.expiring_soon=Boolean(e.es)
if(a.expiring_soon)a.expire_counter=Eo
if(t){de(a.quat,t.quat)
o=true}break
case He:case je:a.open=e.d
break
case Pt:a.waygate_targets=e.d
a.exitway_access=e.ea||0
break
case Qe:a.gem_id=e.d
break
case St:case At:a.sign_text=e.d
break
case Me:a.buzzer_id=e.d
break
case Ce:a.buzzer_id=e.d
a.max_scores=e.ms
a.score_table=e.st
break
case Re:X(false)}if(!o)C(a.quat,pe,a.rot*vo)
if(a.baked)a.baked.rot=(a.rot+4)%4
a.updateDrawable()
return a}function propClone(e){return fromJSON(W(e))}var bs=function(){var y=new Int32Array(3)
var T=new Int32Array(3)
var I=new Int32Array(3)
return function bagAddTransFn(e,t){var r=t.target_pos,a=t.item,i=t.items,o=t.src_pos,n=t.bag_to_ignore,s=t.auto_pickup,l=t.no_pickup,c=t.emptied_pos,_=t.max_search,u=t.from_center,d=t.src_is_self,f=t.is_update_func
ne(y,r)
if(i)S(!a)
else{S(a)
i=[a]}if(void 0===_)_=16
if(s){S(o)
re(xn,o,J)
if(oe(an.center_pos,xn)<=po){ne(y,r=o)
_=1}}var v=false
for(var h=0;h<_;++h){var p=bi.getTileLocal(y,1,false)
if(p&&c&&ce(c,y))p=0
if(p&&p<ui||!Br(y))break
if(!p){v=true
ie(T,y)}else if(p>=di&&p<=fi){var m=bi.andGetProp()
if(m)if(m.item_id===Ie&&m!==n){v=true
ie(T,y)}else if(!m.isIntangible())break}y[2]--}S(v)
ue(I,o,T)
var g={target_pos:T,src_offs:I,no_pickup:l?Ca.instance_uid:"",is_update_func:f}
for(var E=0;E<i.length;++E){g.item=i[E]
bi.transBagAdd(e,g)}bi.transItemAnim(e,{style:Vt,src_type:d?Yt:qt,src:d?null:o,target_type:qt,target:g.target_pos,items:i,from_center:u})}}()
r.bagAddTrans=bs
function tickProps(){if(Wn)gemDebugTick()}},{"../common/entitlements":194,"../common/globals":197,"../common/ids":198,"../common/items_common":200,"../common/materials_common":201,"../common/voxel_data_common":209,"../glov/client/cmds":244,"../glov/client/engine":250,"../glov/client/font":260,"../glov/client/input":271,"../glov/client/localization":275,"../glov/client/mat4ScaleRotateTranslate":277,"../glov/client/net":279,"../glov/client/quat":287,"../glov/client/settings":291,"../glov/client/shaders":293,"../glov/client/snapshot":295,"../glov/client/ui":306,"../glov/client/webfs":309,"../glov/common/util":330,"../glov/common/verify":331,"../glov/common/vmath":332,"./baking":17,"./bluebox_edit_list":22,"./bluebox_ui":23,"./blueprint":24,"./build_mode":27,"./camera":28,"./character_controller":30,"./editvolume_client":72,"./energy_well":73,"./factory_ui":79,"./floater":84,"./flora_constants":85,"./inventory":94,"./item_anims":96,"./items":98,"./localization/localization":108,"./main":112,"./materials":114,"./menu":117,"./palette":123,"./particle_system":126,"./prop_edit":140,"./quickbar":142,"./race_results":143,"./rand_seed":145,"./settlement":148,"./sky":151,"./status":156,"./styles":160,"./tiles":162,"./ui_util":168,"./user_data":170,"./user_info_view":171,"./voxel_data":175,"./voxel_data_xraw":176,"./world_comm":182,"./world_metadata":186,"./worlds_sound":187,"./worlds_soundscape":188,assert:void 0,"gl-mat4/translate":void 0}],142:[function(e,t,r){"use strict"
r.lock=lock
r.reset=reset
r.quickbarLoad=quickbarLoad
r.getSelected=getSelected
r.getSelectedIfOwned=getSelectedIfOwned
r.getSelectedVisible=getSelectedVisible
r.quickbarOnEquipChange=quickbarOnEquipChange
r.quickbarSetLastGatherTool=quickbarSetLastGatherTool
r.gatheringToolsSelected=gatheringToolsSelected
r.consumableSelected=consumableSelected
r.consumeSelected=consumeSelected
r.payCostSelected=payCostSelected
r.consumeSelectedBucket=consumeSelectedBucket
r.bucketFill=bucketFill
r.quickbarX1=quickbarX1
r.quickbarY1=quickbarY1
r.quickbarPadLeft=quickbarPadLeft
r.quickbarPadRight=quickbarPadRight
r.quickbarPadTop=quickbarPadTop
r.itemInQuickbar=itemInQuickbar
r.selectByItem=selectByItem
r.setQuickItem=setQuickItem
r.unslot=unslot
r.selectGatheringTools=selectGatheringTools
r.getSelectedGatherTool=getSelectedGatherTool
r.getCurrentModeMappedProp=getCurrentModeMappedProp
r.selectedIsFlipped=selectedIsFlipped
r.getCurrentBrushSize=getCurrentBrushSize
r.toolSelected=toolSelected
r.bucketSelected=bucketSelected
r.quickbarScrollView=quickbarScrollView
r.startup=startup
r.isDragging=isDragging
r.selectLightingInstructions=selectLightingInstructions
r.showGatheringToolDurability=showGatheringToolDurability
r.tickQuickBar=tickQuickBar
r.quickbar_colors_empty=r.quickbar_colors_selected=void 0
r.quickbarGetSelected=getSelected
var ae=e("assert")
var ie=e("../glov/client/camera2d")
var a=e("../glov/client/cmds").cmd_parse
var oe=e("../glov/client/engine")
var ne=e("../glov/client/input")
var i=e("../glov/client/input")
var se=i.KEYS
var le=i.PAD
var ce=e("../glov/client/settings")
var _e=e("../glov/client/sprites").spriteClip
var ue=e("../glov/client/ui")
var R=e("../glov/client/ui.js").buttonWasFocused
var o=e("../glov/common/util")
var de=o.clamp
var fe=o.easeInOut
var n=e("../glov/common/vmath")
var x=n.unit_vec
var s=n.vec4
var l=e("../common/ids")
var h=l.ITEM_BUCKET
var ve=l.ITEM_HANDSTOOL
var c=l.ITEM_HATCHET
var he=l.ITEM_LANTERN
var _=l.ITEM_LIGHT_CUBE
var u=l.ITEM_PICKAX
var d=l.ITEM_SHOVEL
var f=l.ITEM_TORCH
var pe=l.TYPE_ITEM
var me=e("../common/materials_common").Mat
var v=e("./baking").getBakedEmit
var ge=e("./blueprint").blueprintGetDef
var Ee=e("./build_menu")
var p=e("./build_mode")
var ye=p.cancelDragPlace
var m=p.mouseMoveFadeReset
var O=p.tempColorFade
var b=p.unlimitedMode
var Te=e("./inventory")
var g=e("./inventory")
var N=g.EQUIP_SLOTS
var C=g.INV_EQUIP
var E=g.INV_PLAYER
var Ie=g.countAvailable
var y=g.countAvailableEx
var T=g.equipFitsInSlot
var Se=g.findAvailable
var Ae=g.inventoryGetAccountMapped
var I=g.inventoryGetArr
var we=g.inventoryGetMaterialCostMapped
var S=g.inventoryGetSize
var A=g.inventoryGetVer
var w=e("./inventory_ui")
var Le=w.equipDragDroppedItem
var Re=w.getDroppedItem
var xe=w.getMouseoverItem
var Oe=w.getSelectedItem
var be=w.inventoryButton
var M=w.itemHPColor
var D=w.itemHPStyle
var Ne=w.mapInvPos
var L=e("./items")
var P=e("./items")
var k=P.BRUSH_SIZES
var Ce=P.createItem
var B=P.createItemLite
var U=P.itemFromJSON
var G=P.itemGetGfx
var F=P.itemIsAllowedInQuickbar
var Me=P.itemIsBlueprint
var W=P.itemIsBlueprintReady
var De=P.itemIsUnlimited
var Pe=P.sameItem
var j=e("./layout")
var H=j.QUICKBAR_BORDER_PAD
var ke=j.QUICKBAR_BOX_SIZE
var Be=j.quickbarOnLeft
var Ue=j.quickbarOnRight
var Ge=j.quickbarOnTop
var z=e("./layout")
var Fe=e("./localization/localization").L
var We=e("./main")
var je=e("./menu")
var He=e("./menu").doQuickSlotMenu
var V=e("./props")
var Y=V.PREVIEW_HELD
var q=V.getForPreview
var K=e("./status")
var ze=e("./styles").style_mode_label
var X=e("./tiles")
var Q=X.TILE_EMPTY
var J=X.TILE_WATER
var Ve=e("./ui_util")
var $=e("./user_data")
var Ye=e("./user_data").worldReadOnly
var qe=e("./voxel_data").setFlashlight
var ee=e("./world_comm").getWorldID
var te=e("./world_metadata")
var re=te.adventureMode
var Ke=te.worldToolLock
var Ze=Math.abs,Xe=Math.max,Qe=Math.min,Je=Math.round
var $e
var et
var tt=ue.makeColorSet([1,1,1,.5])
tt.down[3]=1
tt.rollover[3]=1
var rt=ue.makeColorSet([1,1,1,1])
r.quickbar_colors_selected=rt
var at=ue.makeColorSet([.4,.4,.4,.5]);(r.quickbar_colors_empty=at).down[3]=1
at.rollover[3]=1
var it=ue.makeColorSet([.4,.4,.4,1])
var ot=s(1,1,1,.75)
var nt=s(0,0,0,.5)
var st=ke
var lt=-2
var ct=-3
var _t=-4
var ut=0
var dt=false
var ft=false
var vt=lt
var ht=false
function lock(){ht=true}var pt=H
var mt=3*pt
var gt=7
var Et=60
var yt=12
var Tt=[]
var It=0
var St=null
var At=lt
var wt=_t
var Lt=0
var Rt=0
var xt=300
var Ot={mode_list:"later",is_gather:true,default_mode_idx:0,getName:function getName(){return Fe.LBL_GATHERING_TOOLS},getBuildName:function getBuildName(){return this.getName()},isCrafted:function isCrafted(){return false},toJSON:function toJSON(){return ae(false)},getBID:function getBID(){return null}}
var bt=null
var Nt=null
var Ct=null
var Mt
var Dt=J
var Pt=-1
var kt=3
function save(){$.set("quickbar",{v:kt,ri:St?St.toJSON("",true):null,sx:At,lx:wt,vi:It,sm:Lt,d:Tt.map(function(e){return e?e.toJSON("",true):void 0})})
Pt=-1}function quickbarViewSlots(){return Ye()?0:6+(ce.quickbar_show_recent?0:1)+(ce.split_build?-1:0)}function reset(e){St=null
At=ct
Lt=It=0
Tt=[]
if(e)save()
Dt=J
Rt=0}function cmdQuickbarReset(e,t){if(!ee())return void t(Fe.ERR_NOT_IN_WORLD)
reset(true)
t()}a.register({cmd:"quickbar_reset",help:"Reset quickbar",func:cmdQuickbarReset})
a.register({cmd:"clear",help:"Alias for /quickbar_reset",func:cmdQuickbarReset})
var Bt
var Ut=0
function getIntrinsicTools(){if(b()){var e=Ke()
if(e&&Nt[e])return Nt[e]
return bt}else return Ct}function selectInitialGatheringTool(){var e=C.contents
Bt=null
for(var t=0;t<N.length;++t){var r=e[t]
if(r){Bt=r
return}}var a=getIntrinsicTools()
for(var i=0;i<N.length;++i){var o=a[i]
if(o){Bt=o
return}}}function shouldEquipTool(e){for(var t=0;t<C.contents.length;++t)if(C.contents[t])return false
for(var r=0;r<N.length;++r)if(T(r,e))return true
return false}function quickbarItemFromJSON(e){if(!(e=U(e)))return null
if(!F(e))return null
return e}function quickbarLoad(){reset(false)
var e=$.get("quickbar")
if(e&&e.v===kt){St=e.ri?quickbarItemFromJSON(e.ri):null
At=e.sx||0
wt=void 0===e.lx?_t:e.lx
It=e.vi||0
Lt=e.sm||0
Tt=(e.d||[]).map(quickbarItemFromJSON)}if(Ye())At=lt
selectInitialGatheringTool()}function setItem(e,t){ae(e===_t||e>=0)
if(e===_t)St=t
else Tt[e]=t}function getItem(e){switch(e){case lt:return null
case ct:return Ot
case _t:return St
default:return Tt[e]}}function getSelected(){return getItem(At)||Mt}function getSelectedIfOwned(){var e=getSelected()
if(!e||At===ct||e===Mt)return e
if(!Ie(e,true)||Me(e)&&!W(e))return Mt
return e}function getSelectedVisible(){if(At===ct){if(Bt){if(-1!==getIntrinsicTools().indexOf(Bt))return Bt
if(Ie(Bt,true))return Bt}return Mt}return getSelectedIfOwned()}function quickbarOnEquipChange(){if(Bt&&!y(C,Bt,true))selectInitialGatheringTool()}function quickbarSetLastGatherTool(e){Bt=e}function gatheringToolsSelected(){return At===ct}function getEquipedGatheringTool(e,t){var r=C.contents
var a=0
var i=null
var o=getIntrinsicTools()
for(var n=0;n<N.length;++n){var s=r[n]
if(s&&s.has_hp&&!(s.hp_cur>0)||Ke())s=null
var l=(s=s||o[n])&&s.dig_rates[e]
if(l>a){a=l
i=s}}if(i&&t&&Ut!==oe.frame_index){Ut=oe.frame_index
Bt=i}return i}function consumableSelected(){if(Te.locked(E))return false
var e=getSelectedIfOwned()
return e&&e.consumable}function getSelectedInventoryIndex(e){var t=getSelected()
var r=I()
var a=S(E)
var i=-1
for(var o=0;o<a;++o)if(Pe(t,r[o],"hp"))if(r[o].count===e)return o
else if(-1===i||r[o].count<r[i].count)i=o
return i}function consumeSelected(e,t){var r=getSelectedInventoryIndex(t=t||1)
return Te.consume(e,r,t)}function payCostSelected(){var e=getSelected()
return Te.payCost(e)}function consumeSelectedBucket(e){if(De(getSelected()))return e||We.getFrameTransaction()
if(Te.locked(E))return null
var t=1
var r=getSelectedInventoryIndex(t)
return Te.transBucketConsume(e,r,t)}function bucketFill(e){Dt=e
if(De(getSelected()))return We.getFrameTransaction()
var t=getSelectedInventoryIndex(1)
return Te.transBucketFill(t,e)}function quickbarX0(){var e=Ge()
return Be()?-90===window.orientation?ie.x0Real():0:e?pt:(90===window.orientation?ie.x1Real():ie.x1())-st}function quickbarY0(){return Ge()?0:pt}function quickbarX1(){var e=Ye()
var t=Be()
var r=Ge()
var a=quickbarX0()
var i=r?1:0
var o=r?0:1
var n=e?1:ce.quickbar_show_recent?2:1
var s=quickbarViewSlots()
if(!oe.defines.NOUI){var l=0
var c=0
var _=0
if(!r)if(!r&&t){if(!ie.safeAreaPadding()[0])l=100}else{if(!ie.safeAreaPadding()[1])c=100
_=1}var u=st+l+c+2*pt
if(!e)if(ce.split_build)if(!je.active())return a-pt-l+i*((n+s)*st+2*mt)+u
else return 0
else return a-pt-l+i*(n*st+mt)-_*gt+(u+i*st*(s-1)+o*gt)
else return a-pt-l+(u+i*st*(n-1))}else return 0}function quickbarY1(){var e=Ye()
var t=Ge()
var r=quickbarY0()
var a=t?1:0
var i=t?0:1
var o=e?1:ce.quickbar_show_recent?2:1
var n=quickbarViewSlots()
if(!oe.defines.NOUI){var s=0
if(t)if(!ie.safeAreaPadding()[2])s=100
var l=st+s+2*pt
if(!e)if(ce.split_build)if(!je.active())return r-pt-s+i*((o+n)*st+2*mt)+l
else return 0
else return r-pt-s+i*(o*st+mt)+(l+i*st*(n-1)+a*gt)
else return r-pt-s+(l+i*st*(o-1))}else return 0}function quickbarTextPos(e){var t=Ye()
ae(e!==lt)
var r
var a=false
if(e===ct)r=0
else if(e===_t)r=t?0:1
else{if(e<It||e>=It+quickbarViewSlots())return null
r=(ce.quickbar_show_recent?2:1)+(e-It)
a=true}var i=quickbarX0()
var o=quickbarY0()
var n=(r+(a&&dt?ut:0))*st
if(a)n+=mt
if(Ge()){i+=n+.5*st
o+=st+pt}else{i+=Ue()?st:0
o+=n+st-ue.font_height}return{x:i,y:o}}function quickbarPadLeft(){return Be()&&!Ye()?st+pt:0}function quickbarPadRight(){return Ue()?st+pt:0}function quickbarPadTop(){return Be()?0:st+pt}function selectable(e){return At!==e}function modeForItem(e){if(!e)return 0
return e.default_mode_idx||0}function scrollSelectedIntoView(){if(At>=0&&(At<It||At>=It+quickbarViewSlots())){var e
if(At<It)e=Xe(0,At-1)
else e=Qe(yt-quickbarViewSlots(),At-quickbarViewSlots()+2)
ut=e-It
It=e}}var Gt
var Ft
function selectShared(e){Ft=null
var t=getSelected()
Lt=modeForItem(t)
if(At!==lt){scrollSelectedIntoView()
if(!e&&t){if(t.has_hp)t=Se(t)||t
var r=(t=Ae(t)).getBuildName()
var a=quickbarTextPos(Gt=At)
if(a)Ft=K.get("inv_selected").setMessage(r,1500).setPos(a.x,a.y)}}save()}function reselect(e){var t=getSelected()
if(t)if(t.mode_list){Lt=(Lt+1)%t.mode_list.length
t.last_mode_idx=Lt
save()}else if(e&&consumableSelected())consumeSelected(null)}function selectByIndex(e,t,r){m()
if(At!==e||t){if(e===ct)wt=At
At=e
selectShared(r)
return true}else{reselect(true)
return false}}function itemIndexInQuickbar(e){if(!e)return lt
if(St&&Pe(e,St,"hp"))return _t
for(var t=0;t<yt;++t){var r=Tt[t]
if(Pe(r,e,"hp"))return t}return lt}var Wt
function itemInQuickbar(e){Wt.id=e
return itemIndexInQuickbar(Wt)!==lt}function selectByItem(e,t){m()
var r=e&&e.pick_as_mode
if(e&&e.pick_as_id)e=Ce({type:e.type,id:e.pick_as_id,attr1:e.attr1,attr2:e.attr2,attr3:e.attr3})
if(e&&e.cost_mat_map){var a
for(var i in e.cost_mat_map){var o=e.cost_mat_map[i]
if(void 0!==o.pick_as)(a=a||{type:e.type,id:e.id,attr1:e.attr1,attr2:e.attr2,attr3:e.attr3})[i]=o.pick_as}if(a)e=Ce(a)}var n=getItem(At)
var s=null===r&&n&&e&&n.type===e.type&&n.mode_list===e.mode_list
var l=null
if(s)l=Lt
if(!e||!Pe(e,n,"hp")||null!==r&&r!==Lt){if((At=itemIndexInQuickbar(e))===lt&&e){if(e.is_gather)return
St=e
At=_t}selectShared(e&&!t)
if(s){Lt=l
save()}else if(null!==r){Lt=r
save()}}}var jt=lt
function setQuickItem(e){setItem(jt,e)
selectByIndex(jt,true)
save()}function unslot(e){if(Pe(St,e,"hp"))setItem(_t,null)
for(var t=0;t<Tt.length;++t)if(Pe(Tt[t],e,"hp"))setItem(t,null)
save()}function selectGatheringTools(){if(At!==ct){selectByIndex(ct,true,true)
save()}}function getSelectedGatherTool(e,t){if(At===ct)return getEquipedGatheringTool(e,t)||Mt
if(Ke())return null
var r=getSelected()
if(r&&!r.is_gather||r===Mt)r=null
if(!r)if(r=getEquipedGatheringTool(e,t)){if(t)selectGatheringTools()
return r}if(r)return Se(r)
return Mt}function selMod(e,t){if(t){selectByIndex(At===lt?_t:lt)
return}var r=It
var a=r+quickbarViewSlots()-1
if(At===lt)selectByIndex(e<0?a:ct)
else if(At===ct)selectByIndex(e<0?a:ce.quickbar_show_recent?_t:r)
else if(At===_t)selectByIndex(e<0?ct:r)
else{var i=At+e
if(i>a)i=ct
else if(i<r)i=ce.quickbar_show_recent?_t:ct
selectByIndex(i)}}function selected(e){return At===e}function is2x2Locked(e){return e&&e.is_gather&&re()}function getCurrentMode(){var e=getSelectedIfOwned()
if(!e||!e.mode_list||e===Mt)return""
if(is2x2Locked(e))return"2x2"
return e.mode_list[Lt]}var Ht={flip:Fe.LBL_BRUSH_MODE_FLIPPED,"1x1":Fe.LBL_BRUSH_MODE_1X1,"2x2":Fe.LBL_BRUSH_MODE_2X2,"3x3":Fe.LBL_BRUSH_MODE_3X3,"2x1":Fe.LBL_BRUSH_MODE_2X1,"3x1":Fe.LBL_BRUSH_MODE_3X1}
function getCurrentModeLabel(){var e=getCurrentMode()
return Ht[e]||e}function getCurrentModeMappedProp(){var e=getSelectedIfOwned()
if(!e||!e.mode_list_ids)return e
var t=e.mode_list_ids[Lt]
if(!t)return e
if(!e.mode_list_mapped)e.mode_list_mapped=[]
var r=e.mode_list_mapped[Lt]
if(!r)r=e.mode_list_mapped[Lt]=Ce({type:e.type,id:t,attr1:e.attr1,attr2:e.attr2,attr3:e.attr3})
return r}function selectedIsFlipped(){return"flip"===getCurrentMode()}function getCurrentBrushSize(){var e=getSelectedIfOwned()
if(e){if(e.brush_size)return e.brush_size
var t=getCurrentMode()
if(k[t])return k[t]}return k.def}function toolSelected(e,t){var r=getSelected()
if(r&&r.type===pe&&r.id===e&&(!t||r.count>=t)){if(-1===getSelectedInventoryIndex()&&!b())return false
return r}return false}function bucketSelected(e){var t=toolSelected(h)
return t&&(void 0===e||t.attr2===e)}function quickbarScrollView(){if(!We.chat_ui.isFocused()&&ne.keyDownEdge(se.TAB)||ne.padButtonDownEdge(le.Y)){var e=quickbarViewSlots()
if(!e)return
if((It+=e*(ne.keyDown(se.SHIFT)?-1:1))<=-e)It=yt-e
else if(It<0)It=0
else if(It>=yt)It=0
else if(It>yt-e)It=yt-e}}function startup(){$e=ue.font
et=Ve.sprite
ue.loadUISprite("quickbar_border",[48,32,48],[48,160,48])
ue.loadUISprite("quickbar_selector",[48,32,48],[48,160,48])
ue.loadUISprite("quickbar_scroll",[64],[30,196,30])
ue.loadUISprite("quickbar_scroll_horiz",[30,196,30],[64])
Ot.mode_list=L.mode_list_block_size
bt=[Ce({type:pe,id:u,attr1:me.REGULAR,attr2:me.WOOD}),Ce({type:pe,id:c,attr1:me.REGULAR,attr2:me.WOOD}),Ce({type:pe,id:d,attr1:me.REGULAR,attr2:me.WOOD})]
Nt=[null,bt,[Ce({type:pe,id:u,attr1:me.FAST,attr2:me.WOOD}),Ce({type:pe,id:c,attr1:me.FAST,attr2:me.WOOD}),Ce({type:pe,id:d,attr1:me.FAST,attr2:me.WOOD})],[Ce({type:pe,id:u,attr1:me.SUPER,attr2:me.WOOD}),Ce({type:pe,id:c,attr1:me.SUPER,attr2:me.WOOD}),Ce({type:pe,id:d,attr1:me.SUPER,attr2:me.WOOD})]]
Ct=[Ce({type:pe,id:u,attr1:me.FLINT}),Ce({type:pe,id:c,attr1:me.FLINT}),Ce({type:pe,id:d,attr1:me.FLINT})]
for(var e=0;e<bt.length;++e)bt[e].has_hp=false
for(var t=0;t<Ct.length;++t)Ct[t].has_hp=false
Mt=Ce({type:pe,id:ve})
Wt=B({type:pe,id:-1})}function isDragging(){return dt}function checkPos(e,t){return e[0]>=t.x&&e[0]<t.x+t.w&&e[1]>=t.y&&e[1]<t.y+t.h}var zt=200
var Vt=s(1,0,1,.5)
function checkReposRect(e,t,r,a,i){ue.drawRect(t,r,a,i,Z.QUICKBAR-5,Vt)
var o=e.cur_pos[0]>=t&&e.cur_pos[0]<=a&&e.cur_pos[1]>=r&&e.cur_pos[1]<=i
if(o)ut=0
return o}function checkRepos(e){var t=Ge()
if(t&&e.cur_pos[1]-e.start_pos[1]>zt||!t&&Ze(e.cur_pos[0]-e.start_pos[0])>zt){var r=Be()
if(!r)if(checkReposRect(e,ie.x0Real(),2*st,2*st,.8*ie.y1())){if(t)ce.set("layout",z.WIDE)
ce.set("layout_quickbar",z.LEFT)}if(t||r)if(checkReposRect(e,ie.x1()-2*st,2*st,ie.x1Real(),.8*ie.y1())){if(t)ce.set("layout",z.WIDE)
ce.set("layout_quickbar",z.RIGHT)}if(!t)if(checkReposRect(e,2*st,ie.y0Real(),ie.x1()-2*st,2*st))if(!t)ce.set("layout",z.TALL)
return true}return false}function bucketConsistencyCheck(){if(b())return
if(Pt===A(E))return
Pt=A(E)
var e=[]
for(var t=0;t<Tt.length;++t){var r=Tt[t]
if(r&&r.type===pe&&r.id===h){r.idx=t
e.push(r)}}if(St&&St.type===pe&&St.id===h){St.idx=_t
e.push(St)}if(!e.length)return
var a=I()
var i=S(E)
var o=[]
for(var n=0;n<i;++n){var s=a[n]
if(s&&s.type===pe&&s.id===h)o.push(s)}e:for(var l=0;l<e.length;++l){var c=e[l]
for(var _=0;_<o.length;++_)if(Pe(c,o[_],"hp"))continue e
var u=c.attr2?Q:Dt
if(!c.qb_compliment||c.qb_compliment.attr2!==u)c.qb_compliment=Ce({type:c.type,id:c.id,attr3:c.attr3,attr1:c.attr1,attr2:u})
var d=false
for(var f=0;f<o.length;++f)if(Pe(c.qb_compliment,o[f],"hp")){d=true
break}if(!d)continue
for(var v=0;v<e.length;++v)if(Pe(e[v],c.qb_compliment,"hp"))continue e
setItem(c.idx,c.qb_compliment)
e[l]=c.qb_compliment
save()}Pt=A(E)}function updateLastStatus(){if(Ft)if(Ft.done)Ft=null
else{var e=quickbarTextPos(Gt)
if(e)Ft.setPos(e.x,e.y)
else Ft.remove()}}var Yt
var qt=0
function getPlayerEmit(){var e=getSelectedVisible()
if(e===Yt)return qt
var t=0
if(e.type===pe&&(e.need_thumbnail_update||e.thumbnail_updated)){var r=q(e,Y)
if(r.baked&&r.baked.key)t=v(r.baked.key)?1:0}Yt=e
return qt=t}function isLight(e){return e&&e.type===pe&&(e.id===f||e.id===he||e.id===_)}var Kt
function getDefaultLights(){if(!Kt)Kt=[Ce({type:pe,id:f,attr1:me.WOOD}),Ce({type:pe,id:f,attr1:me.DARK_WOOD}),Ce({type:pe,id:f,attr1:me.LIGHT_WOOD}),Ce({type:pe,id:f,attr1:me.RED_WOOD})]}function selectLighting(e){if(isLight(getSelectedVisible())){selectByIndex(e?lt:ct,true)
return}var t=getItem(_t)
if(t&&isLight(t)&&Ie(t)){selectByIndex(_t,true)
return}if(e)return
for(var r=0;r<Tt.length;++r){var a=Tt[r]
if(isLight(a)&&Ie(a)){selectByIndex(r,true)
return}}var i=I()
var o=S(E)
for(var n=0;n<o;++n)if(isLight(i[n])){selectByItem(i[n])
return}getDefaultLights()
for(var s=0;s<Kt.length;++s){var l=Kt[s]
if(Ie(l)){selectByItem(l)
return}}K.push(Fe.STATUSMSG_WOOD_FOR_TORCH)}ce.register({show_lighting_hint:{label:"Show hint to use lighting when dark",default_value:1,type:a.TYPE_INT,range:[0,1]}})
function selectLightingInstructions(){if(!ce.show_lighting_hint)return""
var e=Ye()
var r=false
var a=false
function checkSlot(e){var t=getItem(e)
if(t&&isLight(t)&&Ie(t))r=a=true}checkSlot(_t)
for(var t=0;t<Tt.length;++t)checkSlot(t)
if(!r){getDefaultLights()
for(var i=0;i<Kt.length;++i){var o=Kt[i]
if(Ie(o))a=true}}if(!a)return""
if(e)if(ne.touch_mode)return Fe.STATUSMSG_LIGHT_MINI_TOUCH
else return Fe.$(Fe.STATUSMSG_LIGHT_MINI_KB,"[F]")
else if(r)if(ne.touch_mode)return Fe.STATUSMSG_LIGHT_SLOT_TOUCH
else return Fe.$(Fe.STATUSMSG_LIGHT_SLOT_KB,"[F]")
else if(ne.touch_mode)return Fe.STATUSMSG_LIGHT_NOSLOT_TOUCH
else{var n=je.prefixShortcutKey("B",Fe.LBL_BUILD_MENU)
return Fe.$(Fe.STATUSMSG_LIGHT_NOSLOT_KB,"[F]",n)}}var Zt=[]
function showGatheringToolDurability(e){if(b()||oe.defines.NOUI)return 1
var t=e.x,r=e.y,a=e.on_top,i=e.on_left
var o=Z.QUICKBAR
var n=4
var s=(st-(N.length-1)*n)/N.length
var l=4*s
var c=s
var _=!(a||i)
var u=_?t-c:t
var d=_?t-c-n-l:t+n+c
var f=.8*s
var v=.2
var h={x:u-v*(c-n),z:o,w:c*(1+2*v),h:c*(1+2*v)}
if(R()&&a)r+=3*ue.font_height
var p=1
for(var m=0;m<C.contents.length;++m){var g=C.contents[m]
var E=false
if(g&&g.has_hp){var y=g.hp_cur/g.hp_max
p=Qe(p,y)
var T=Zt[m]=Zt[m]||{}
if(T.last_frame!==oe.frame_index-1)T.vis=0
T.last_frame=oe.frame_index
if(g.tool_last_use_frame>=oe.frame_index-1)T.vis=Qe(1e4,T.vis+oe.frame_dt)
else T.vis=Xe(0,T.vis-oe.frame_dt)
var I=de((T.vis-150)/250,0,1)
var S=y<.25||R()?1:I
if(S){E=true
h.y=r-v*c
var A=G(g,{})
h.color=O(A.color||x,S)
h.uvs=h.frame=A.frame
A.img.draw(h)
if(g.hp_cur){var w=Xe(Je(100*y),g.hp_cur?1:0)
var L=D(y)
if(1!==S)L=$e.styleAlpha(L,S)
$e.drawSizedAligned(L,d,r+(s-f)/2,o+1,f,$e.ALIGN.HCENTERFIT,l,0,w+"%")
ue.progressBar({x:d,y:r,z:o,progress:y,w:l,h:s,color:O(M(y),S)})}else et.draw({x:u,y:r,z:o+.1,w:s,h:s,frame:Ve.BROKEN})
if(ne.mouseOver({x:t,y:r,w:l+c+n,h:s}))ue.drawTooltip({x:t,y:r+s,tooltip:g.hp_cur?Fe.$(Fe.TLTP_LOW_DURABILITY,g.getName()):g.getName()})}}if(!a||E)r+=s+n}return p}var Xt={}
function tickQuickBar(A){bucketConsistencyCheck()
var w=Ye()
var L=Be()
var R=Ge()
var e=!L&&!R
var t=quickbarX0()
var r=quickbarY0()
var x=R?1:0
var O=R?0:1
var a=w?1:ce.quickbar_show_recent?2:1
var b=t
var N=r
var C=!w&&A&&(je.page===je.INVENTORY||je.page===je.BUILD)
var M=A&&!C
var i=quickbarViewSlots()
var o=st*(a+i-1)+mt
var n={x:b-pt,y:N-pt,w:st+x*o+2*pt,h:st+O*o+2*pt,payload:true,peek:true,min_dist:15}
var D=!M&&!oe.defines.NOUI&&!w&&ne.drag(n)
var P=ft=false
var k=false
if(D){if(!dt){dt=true
if(C)P=true}if(!A||ne.keyDown(se.SHIFT))k=checkRepos(D)
if(R&&D.cur_pos[1]<r+st+Et||L&&D.cur_pos[0]<t+st+Et||e&&D.cur_pos[0]>t-Et){ft=true
ut+=D.delta[R?0:1]/st
while(It>0&&ut>.5){It--
ut--}while(It<yt-i&&ut<-.5){It++
ut++}save()}}else{vt=lt
dt=false}if(ut&&!ft){var s=oe.frame_dt*Xe(.001,.01*Ze(ut))
if(ut<0)ut=Qe(0,ut+s)
else ut=Xe(0,ut-s)}if(w&&At!==_t)At=lt
if(w){if(!isLight(getItem(_t)))St=Ce({type:pe,id:he,attr1:me.WOOD})
St.from_mini=true}else if(St&&St.from_mini){St.from_mini=false
St=null
At=ct}if(At>=0&&(At<It||At>=It+i)){var l=getItem(At)
for(var c=0;c<i;++c){var _=It+c
var u=Tt[_]
if(!u&&!l||u&&Pe(u,l,"hp")){At=_
save()
break}}}if(ce.quickbar_show_inhand&&(!A||!ce.quickbar_show_recent)){var d=getSelectedVisible()
if(d&&!(d.type===pe&&d.id===ve)){var f=st*(A?1:1.5)
var v=pt
var h=st+v
var p=2*pt
var m={x:b+(Be()?h:Ue()?-(f+v):p),y:N+(Ge()?h:p),z:Z.QUICKBAR+5,w:f,shrink:.925,colors:rt,pad_focusable:false,tooltip:Fe.$(Fe.TLTP_TOOL_IN_HAND,d.getName()),auto_count:true}
if(!oe.defines.NOUI){be(m,d)
if(Ft&&Ft.style)$e.drawSizedWrapped(Ft.style,m.x+m.w+8,m.y+8,Z.QUICKBAR+5,400,20,ue.font_height,d.getName()+"\n"+(d.is_gather?"Details like remaining durability here":"Details like recipe requirements here"))}}}if(!M&&ne.keyDownEdge(se.X))if(ht)ye()
else if(w)selectLighting(w)
else if(At===ct)selectByIndex(wt,true)
else selectByIndex(ct,true)
if(!M&&ne.keyDownEdge(ne.KEYS.F))selectLighting(w)
var B=true
var U=false?"0":"1"
function quickbarButton(e,t){profilerStart("quickbarButton")
var r=Z.QUICKBAR+5
var a={x:b,y:N,z:r,w:st,h:st,colors:tt,disabled:M,pad_focusable:false,tooltip:je.prefixShortcutKey("B",Fe.LBL_BUILD_MENU),img:et,frame:e,hook:t,in_event_cb:!ne.touch_mode&&je.active()&&je.page===je.BUILD?ne.pointerLockEnter:null}
var i=null
if(!oe.defines.NOUI)i=ue.buttonImage(a)
b+=x*st
N+=O*st
profilerStop("quickbarButton")
return i}function quickbarSlotShared(e){profilerStart("quickbarSlotShared")
var t=e===ct
var r=getItem(e)
var a=!M&&selected(e)
var i=a
var o=We.isMenuPage(je.QUICK_SLOT)&&e===jt
if(o)a=true
if(vt===e&&!ft&&!k){r=null
a=false}var n=r
if(!t&&!w&&r&&r.has_hp){var s=Se(r)
if(s)n=s}var l=C
n=Ae(n)
var c
if(!ne.touch_mode)if(e===_t)c=je.prefixShortcutKey(U,n?Fe.$(Fe.TLTP_RECENT_ITEM_EXISTING,n.getName()):Fe.TLTP_RECENT_ITEM)
else if(n)c=je.prefixShortcutKey(U,n.getName())
var _=Xt[e]
if(!_){var u=Z.QUICKBAR+(e<0?5:0)
_=Xt[e]={w:ke,h:ke,z:u,pad_focusable:false,auto_count:true,auto_hp:true,key:"qb_"+e,in_event_button:0}}_.x=b
_.y=N
_.colors=a?!r&&!o?it:rt:!r?at:tt
_.disabled=M
_.drag_target=l
_.button_long_press=!w
_.tooltip=c
_.rollover_quiet=false
_.base_name=void 0
_.count_override=void 0
_.flip=false
if(!ne.touch_mode){if(r)if(t&&!a)_.tooltip+="\n"+je.prefixShortcutKey("X",Fe.TLTP_SWAP_TO_GATHERING)
else if(e===_t&&!a)_.tooltip+="\n"+je.prefixShortcutKey("X",Fe.TLTP_SWAP_TO_RECENT)
if(e===_t)_.tooltip+="\n"+je.prefixShortcutKey("F",Fe.TLTP_SELECT_LANTERN_OR_TORCH)
if(!t){if(!_.tooltip)_.tooltip=Fe.TLTP_EMPTY_SLOT
if(a||e===_t&&selected(ct))_.tooltip+="\n"+je.prefixShortcutKey("Q or Right Click",Fe.TLTP_QUICKSLOT_ITEM)
else _.tooltip+="\n"+je.prefixShortcutKey("Right Click",Fe.TLTP_QUICKSLOT_ITEM)
if(w)_.tooltip=je.prefixShortcutKey("F",Fe.TLTP_TOGGLE_LANTERN)}if(i&&a)if(getCurrentMode()&&!is2x2Locked(r)){if(!r)ae(false,'selected null item with mode "'+getCurrentMode()+'"')
_.tooltip+="\n"+je.prefixShortcutKey("Z",r.flippable?Fe.TLTP_QBAR_FLIP:Fe.TLTP_CHANGE_BRUSH)}}if(r&&r.flippable&&"flip"===r.mode_list[a?Lt:0])_.flip=true
var d=false
if(r){if(Me(r)){var f=r.getBID()
var v=ge(f)
if(!v.loaded||v.error){_.base_name="inv_empty"
_.count_override=v.error?Fe.LBL_ERROR.lower():Fe.MSG_LOADING.lower()
d=true}}if(!_.base_name&&!t&&!De(r))if(!Ie(r,true))_.base_name="inv_empty"
if(!t&&r.is_gather)if(!Se(r)){_.base_name="inv_empty"
d=true}}if(o)_.base_name="inv_selected"
if(d||!r)_.rollover_quiet=true
if(t){_.img=Ve.sprite
_.frame=B?Ve.GATHERING_TOOLS:Ve.HANDS}else{delete _.img
delete _.frame
if(P&&r&&checkPos(D.cur_pos,_))vt=e}if(l){var h=Re(_)
_.peek=true
if(h)if(t)Le(h)
else if(shouldEquipTool(h))ue.modalDialog({title:Fe.DLG_EQUIPMENT_SLOTS_TITLE,text:Fe.DLG_EQUIPMENT_SLOTS_MSG,buttons:{OK:null}})
else{setItem(e,h)
selectByIndex(e,true)}else if(ne.dragOver(_))_.tooltip=null
_.peek=false}_.in_event_cb=!w&&!ht&&selectable(e)&&!ne.touch_mode&&!ft&&!A?ne.pointerLockEnter:null
var p=0
if(w){if(!oe.defines.NOUI&&be(_,r))p++
p+=!M?ne.keyDownEdge(se.TILDE):0}else if(t){p+=!oe.defines.NOUI&&ue.buttonImage(_)?1:0
p+=!M?ne.keyDownEdge(se.TILDE):0
Ne("qb_gather",_)
if(!A)showGatheringToolDurability({x:L?b+st+pt+4:R?b:b-pt-4,y:R?N+st+pt+4:N,on_top:R,on_left:L})}else{if(void 0===_.count_override&&_.auto_count&&r){var m=Te.countAvailable(r)
_.count_override=m}r=we(r)
r=Ae(r)
if(!oe.defines.NOUI)if(be(_,r)){if(ue.button_click&&(2===ue.button_click.button||ue.button_click.long_press)){selectByIndex(e,true,true)
jt=e
We.toggleMenuPage(je.QUICK_SLOT)}else{var g
if(l)g=Oe()
if(g&&!Pe(getItem(e),g,"hp")){if(e!==_t&&Pe(getItem(_t),g,"hp"))setItem(_t,getItem(e))
setItem(e,g)
selectByIndex(e,true)}else p++}Ee.deselect()}}if(a&&!M&&!w&&He()&&ne.keyDownEdge(se.Q)){var E=t?_t:e
selectByIndex(E,true,true)
jt=E
We.toggleMenuPage(je.QUICK_SLOT)}var y=!M?ne.keyDownEdge(se[U]):0
if(y){var T
if(l)T=xe()
if(T&&!Pe(getItem(e),T,"hp")){if(!t){setItem(e,T)
selectByIndex(e,true)}}else p+=y}if(a&&getCurrentMode()||w)p+=ne.keyDownEdge(se.Z)
if(d)p=0
if(p)if(ht)ye()
else if(w)selectLighting(w)
else for(var I=0;I<p;++I)if(selectByIndex(e))a=true
if(a&&!oe.defines.NOUI){var S=getCurrentModeLabel()
if(S)$e.drawSizedAligned(ze,_.x,_.y,_.z+2,24,$e.ALIGN.HVCENTERFIT,_.w,_.h,S)}b+=x*st
N+=O*st
U=String.fromCharCode(U.charCodeAt(0)+1)
profilerStop("quickbarSlotShared")}if(!w)quickbarSlotShared(ct)
if(ce.quickbar_show_recent||w)quickbarSlotShared(_t)
b+=x*mt
N+=O*mt
if(ut)_e(Z.QUICKBAR-.1,Z.QUICKBAR+2.1,b,N,st+x*st*(i-1),st+O*st*(i-1))
if(!M&&!ne.keyDown(se.V)&&!(je.active()&&je.isBuildMenu())){var g=ne.mouseWheel()
if(g&&!ht)selMod(-g,w)
if((ne.padButtonDownEdge(le.LB)||ne.keyDownEdge(se.PAGEUP))&&!ht)selMod(-1,w)
if((ne.padButtonDownEdge(le.RB)||ne.keyDownEdge(se.PAGEDOWN))&&!ht)selMod(1,w)}if(!w){var E=0
if(ut>0&&It>0){E=-1
b-=x*st
N-=O*st
U=String.fromCharCode(U.charCodeAt(0)-1)}b+=x*st*ut
N+=O*st*ut
for(var y=E;y<i+(ut<0?1:0);++y){var T=It+y
if(T<0||T>=yt)continue
quickbarSlotShared(T)}if(ce.split_build){b+=x*mt
N+=O*mt
if(quickbarButton(Ve.BUILD,"new_build_settlement"))We.toggleMenuPage(je.BUILD)}}if(vt!==lt&&!ft&&!k){var I={x:D.cur_pos[0]-st/2,y:D.cur_pos[1]-st/2,z:Z.DRAG,w:st,h:st,disabled:true,base_name:"inv_active",pad_focusable:false,drag_target:true,draw_only:true,hide_count:true}
be(I,getItem(vt))
ue.drawTooltip({x:D.cur_pos[0],y:D.cur_pos[1]+20,tooltip:Fe.TLTP_QBAR_UNBIND,tooltip_width:140})
if(ne.dragDrop()){setItem(vt,null)
save()}ne.mouseOver()}n.peek=false
n.eat_clicks=true
n.min_dist=0
ne.drag(n)
if(D)ne.dragOver()
if(!oe.defines.NOUI){var S=0
var G=0
var F=0
var W=0
if(R){if(!ie.safeAreaPadding()[2])S=100}else if(L){if(!ie.safeAreaPadding()[0])G=100}else{if(!ie.safeAreaPadding()[1])F=100
W=1}var j=st+G+F+2*pt
var H=st+S+2*pt
ue.drawBox({x:t-pt-G,y:r-pt-S,w:j+x*st*(a-1),h:H+O*st*(a-1),z:Z.QUICKBAR-1},ue.sprites.quickbar_border,.5,ot)
if(!w){ue.drawBox({x:t-pt-G+x*(a*st+mt)-W*gt,y:r-pt-S+O*(a*st+mt),w:j+x*st*(i-1)+O*gt,h:H+O*st*(i-1)+x*gt,z:Z.QUICKBAR-1},ue.sprites.quickbar_border,.5,ot)
if(i!==yt){var z=2
var V=a*st+mt+z
var Y=i*st-2*z
var q=i/yt*Y
var K=gt+2
var X={x:t+(L?st+1:R?V:-(K+1)),y:r+(R?st+1:V),w:R?q:K,h:R?K:q}
var Q=Y-q
var J=(It-ut)/(yt-i)
if(J<0){J=Xe(J,-.95)
X[R?"w":"h"]*=1+J
J=0}else if(J>1){J=Qe(J,1.95)
X[R?"w":"h"]-=(J-1)*Q}var $={x:X.x+x*J*Q,y:X.y+O*J*Q,w:X.w,h:X.h,z:Z.QUICKBAR+5}
if(R)ue.drawHBox($,ue.sprites.quickbar_scroll_horiz,nt)
else ue.drawVBox($,ue.sprites.quickbar_scroll,nt)}if(ce.split_build)ue.drawBox({x:t-pt-G+x*((a+i)*st+2*mt),y:r-pt-S+O*((a+i)*st+2*mt),w:j,h:H,z:Z.QUICKBAR-1},ue.sprites.quickbar_border,.5,ot)}if(C)ne.dragOver({x:t-pt-G,y:r-pt-S,w:j+x*(st*(i+a-1)+mt),h:H+O*(st*(i+a-1)+mt)})}updateLastStatus()
var ee=getPlayerEmit()
if(ee!==Rt){var te=oe.frame_dt/xt
var re=de(ee-Rt,-te,te)
Rt=de(Rt+=re,0,1)}qe(fe(Rt,2))
ht=false}},{"../common/ids":198,"../common/materials_common":201,"../glov/client/camera2d":241,"../glov/client/cmds":244,"../glov/client/engine":250,"../glov/client/input":271,"../glov/client/settings":291,"../glov/client/sprites":302,"../glov/client/ui":306,"../glov/client/ui.js":306,"../glov/common/util":330,"../glov/common/vmath":332,"./baking":17,"./blueprint":24,"./build_menu":26,"./build_mode":27,"./inventory":94,"./inventory_ui":95,"./items":98,"./layout":99,"./localization/localization":108,"./main":112,"./menu":117,"./props":141,"./status":156,"./styles":160,"./tiles":162,"./ui_util":168,"./user_data":170,"./voxel_data":175,"./world_comm":182,"./world_metadata":186,assert:void 0}],143:[function(e,t,r){"use strict"
r.raceResults=raceResults
r.prepareResultsList=prepareResultsList
r.doResultList=doResultList
r.doRaceResults=doRaceResults
function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]
for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))e[a]=r[a]}return e}).apply(this,arguments)}var a=e("../glov/client/fbinstant")
var i=a.fbGetTournamentData
var o=a.fbIsTournamentActive
var l=e("../glov/client/scroll_area.js").scrollAreaCreate
var n=e("../glov/client/social.js")
var v=n.friendIsBlocked
var I=n.getUserProfileImage
var S=e("../glov/client/ui.js")
var A=e("../glov/client/ui.js").buttonWasFocused
var s=e("../glov/common/util.js")
var h=s.defaults
var c=s.merge
var w=s.msToTimeString
var _=e("./fbinstant_worlds")
var u=_.fbCreateRaceTournament
var d=_.fbLeaveWorldsTournament
var f=_.fbPostSessionScoreAsync
var L=e("./localization/localization").L
var p=e("./main.js")
var m=p.menuExit
var g=p.toggleMenuPage
var E=e("./menu.js")
var y=E.RACE_RESULTS
var T=E.menuInteractGetProp
var R=E.menuX1
var x=E.menuY1
var O=E.prefixShortcutKey
var b=e("./props.js").isSpotlitBuzzer
var N=e("./styles.js")
var C=N.color_line
var M=N.color_remove_user
var D=N.color_remove_user_alternate
var P=N.color_remove_user_over
var k=N.color_remove_user_viewing
var B=N.color_trophies
var U=N.color_user_alternate
var G=N.color_user_over
var F=N.color_user_self_score
var W=N.color_user_viewing
var j=N.colors_user_selected
var H=N.label_style
var z=N.menu_header_style
var V=N.sublabel_style
var Y=e("./ui_util.js")
var q=e("./user_info_view.js")
var K=q.formatPresence
var X=q.userInfoGet
var Q=q.userInfoViewing
var J=q.viewUser
var $=e("./world_comm.js")
var ee=$.getWorldID
var te=$.worldBuzzerRemove
var re=$.worldGetRoles
var ae=e("./world_info_view.js")
var ie=ae.refreshWorldInfo
var oe=ae.worldCmdParseGated
var ne=ae.worldInfoModifyingAccess
function fbPropHasActiveTournament(e){var t=i()
return t&&e&&t.world_id===ee()&&t.buzzer_id===e.buzzer_id&&t.chunk_id===e.chunk_id&&t.pos_idx===e.pos_idx}function fbCheckSubmitToTournament(e,t){if(window.FBInstant&&e)if(fbPropHasActiveTournament(t))f(e.time)}function fbCreateTournamentButton(e,t,r){if(S.buttonText(c({text:L.BTN_CREATE_TOURNAMENT},e)))if(o())S.modalDialog({title:L.DLG_TOURNAMENT_SWITCH_TITLE,text:L.DLG_TOURNAMENT_SWITCH_MSG,buttons:{yes:function yes(){return d(function(){u(ee(),t,r)})},no:null}})
else u(ee(),t,r)}function fbLeaveTournamentButton(e){if(S.buttonText(c({text:L.BTN_LEAVE_TOURNAMENT},e)))d()}var se
var le
var ce
var _e=false
function raceResults(e,t,r){se=e.item_id
le=t
_e=false
fbCheckSubmitToTournament(ce=r,e)
g(y,e.interactDetails())}function lineSep(e,t,r,a){S.drawLine(e-a/2,t,e+a/2,t,r+.1,2,1,C)}function prepareResultsList(e){var t=[]
var r=0
var a=0
for(var i=0;i<e.length;i++){if(e[i].time>a){r=i+1
a=e[i].time}t.push(h(X(e[i].user_id),{time:e[i].time,rank:r}))}return t}var ue=1.5*S.font_height
var de=S.font_height
var fe=.75*S.font_height
var ve=1.5*S.font_height
var he=1.25*S.font_height
var pe=4
var me=125
var ge=2*pe+de+4+fe
var Ee=40
var ye=16
var Te=ge/2-20
var Ie=4
var Se=16
var Ae=32
var we=8
var Le=8
var Re=4*ge/3
var xe
function removeResultEntry(e){S.modalDialog({title:L.DLG_REMOVE_SCORE_TITLE,text:L.DLG_REMOVE_SCORE_MSG,buttons:{yes:{cb:function cb(){if(xe){_e=false
S.modalDialog({title:L.DLG_REMOVING_SCORE_TITLE,text:L.MSG_PLEASE_WAIT})
te(xe,e)}}},no:null}})}function showResultEntry(e,t,r,a){var i=S.font,o=S.title_font
var n=a.x,s=a.y,l=a.w
var c=Z.UI
var _=l
var u=me
var d=s
var f=e.user_id,v=e.display_name,h=e.presence_data
if(e.rank<=3)Y.sprite.draw({x:n+ye,y:s+Te,z:c+1,w:Ee,h:Ee,frame:Y.TROPHY,color:B[e.rank]})
o.drawSizedAligned(z,u,s,c+1,e.rank?ve:he,i.ALIGN.HRIGHT|i.ALIGN.VCENTER,0,ge,e.rank?L.$(L.FORMAT_RANK_NUMBER,e.rank):L.RACERESULTS_NO_RANK)
var p=S.buttonImage(_extends({x:u+=26,y:s,z:c,w:ge,h:ge,colors:Q(f)?j:void 0},I(f)))||false
u+=ge+4
var m=A()
var g=i.drawSizedAligned(z,l-Ae,s,c+1,ue,i.ALIGN.HRIGHT|i.ALIGN.VCENTER,0,1.1*ge,w(e.time))
i.drawSizedAligned(H,l-Ae-g-we,s,c+1,de,i.ALIGN.HRIGHT|i.ALIGN.VCENTER,0,ge+de/2,L.addColon(L.LBL_ELAPSED_TIME))
var E=S.buttonShared({x:0,y:s-Ie,w:_,h:ge+2*Ie,pad_focusable:false,rollover_quiet:Q(f)})
if(E.ret)p=true
m=m||E.focused
s+=pe
var y=v||f
i.drawSizedAligned(H,u+=4,s,c+1,de,i.ALIGN.HLEFT,_,0,y)
s+=de+pe
if(!r)i.drawSizedAligned(V,u+Le,s,c+1,fe,i.ALIGN.HLEFT,_,0,K(h))
s+=fe
s+=pe
if(p)if(_e)removeResultEntry(f)
else J({x:u+Re,y:s,user_id:f})
s+=2*Ie
var T
if(Q(f))T=_e?k:W
else if(m)T=_e?P:G
else if(1&t)T=_e?D:U
else if(_e)T=M
if(T)S.drawRect(0,d-Ie,_,s-Ie,c-.5,T)
if(f===le&&t>-1&&!_e)S.drawRect(0,d-Ie,_,s-Ie,c-.5,F)
return s-d}function doResultList(e,t,r){if(e){if(!e.value)e.value=l({z:Z.UI,background_color:null,auto_hide:true})
e.value.begin(r)
r.y=6}var a=6
var i=r.x,o=r.w
for(var n=0;n<t.length;++n){var s=showResultEntry(t[n],n,v(t[n].user_id),{x:i,y:r.y,w:o})
r.y+=s
a+=s}if(e&&e.value)e.value.end(r.y)
return a}var Oe={}
var be=16
var Ne=80
var Ce=200
var Me=L.LBL_RACE_RESULTS
function doRaceResults(){if(!(xe=T({ignore_distance:true}))||xe.item_id!==se){m()
return Me}var e=0
var t=R()
var r=S.button_height
var a=x()
var i=Z.UI
var o=t-e
var n=a-r
var s=r
var l=e+o/2
var c=S.font
var _=prepareResultsList(xe.score_table)
if(ce)for(var u=0;u<_.length;u++)if(ce.time===_[u].time&&ce.user_id===_[u].user_id)ce.rank=_[u].rank
s+=be
var d=48
if(ce){c.drawSizedAligned(z,l,s,i+1,ue,c.ALIGN.HCENTER,0,0,ce.rank?L.RACERESULTS_NEW_BEST:L.RACERESULTS_YOUR_SCORE)
if(window.FBInstant){var f={x:e+o-Ce-Se,y:s+(ue-d)/2,w:Ce,h:d,font_height:de}
if(!fbPropHasActiveTournament(xe))fbCreateTournamentButton(f,ce.time,xe)
else fbLeaveTournamentButton(f)}lineSep(l,s+=ue+be,i+.1,Ne)
s+=8
s+=showResultEntry(h(X(ce.user_id),ce),-1,v(ce.user_id),{x:e,y:s,w:o})
s+=be}if(re().world_owner)if(S.buttonText({x:e+Se,y:s+(ue-d)/2,w:Ce,h:d,font_height:de,disabled:ne(),text:b(xe)?L.BTN_REMOVE_SPOTLIGHT:L.BTN_SPOTLIGHT_RESULTS,tooltip:b(xe)?void 0:L.$(L.TLTP_SPOTLIGHT_RESULTS,O("O",L.LBL_WORLD_INFO_MENU))}))if(b(xe))oe("spotlit_buzzer_remove",ie)
else oe("spotlit_buzzer_set "+xe.chunk_id+" "+xe.pos_idx,ie)
if(re().world_admin||re().frozen_owner)if(S.buttonText({x:e+o-Ce-Se,y:s+(ue-d)/2,w:Ce,h:d,font_height:de,text:_e?L.BTN_CANCEL_SCORE_REMOVAL:L.BTN_REMOVE_SCORE,tooltip:_e?void 0:L.TLTP_REMOVE_SCORE}))_e=!_e
c.drawSizedAligned(z,l,s,i+1,ue,c.ALIGN.HCENTER,0,0,L.$(L.RACERESULTS_ALL_SCORES,_.length))
lineSep(l,s+=ue+be,i+.1,Ne)
doResultList(Oe,_,{x:e,y:s+=2,w:o,h:r+n-s})
return L.separateColon(L.LBL_RESULTS,xe.buzzer_id)}},{"../glov/client/fbinstant":257,"../glov/client/scroll_area.js":289,"../glov/client/social.js":296,"../glov/client/ui.js":306,"../glov/common/util.js":330,"./fbinstant_worlds":80,"./localization/localization":108,"./main.js":112,"./menu.js":117,"./props.js":141,"./styles.js":160,"./ui_util.js":168,"./user_info_view.js":171,"./world_comm.js":182,"./world_info_view.js":184}],144:[function(e,t,r){"use strict"
r.isRacePanelActive=isRacePanelActive
r.isRacePanelInColumn=isRacePanelInColumn
r.raceReady=raceReady
r.possiblyCancelReadyRace=possiblyCancelReadyRace
r.getRacePanelWidth=getRacePanelWidth
r.racePanel=racePanel
var a=e("../glov/client/camera2d")
var _=e("../glov/client/engine")
var u=e("../glov/client/input")
var d=e("../glov/client/ui")
var i=e("../glov/common/util")
var f=i.msToTimeString
var v=i.nop
var o=e("./layout")
var n=o.CORNER_BUTTON_MARGIN
var s=o.menuUpperLeft
var l=o.quickbarOnTop
var h=e("./localization/localization").L
var p=e("./menu").menuActive
var m=e("./menu")
var c=e("./quickbar").quickbarX1
var g=e("./share_menu").isShareButtonInColumn
var E=e("./styles").menu_style
var y=e("./user_data").userDataGet
var T=e("./world_comm").worldBuzzerAbandon
var I=e("./worlds_sound").playSound
var S
var A=130
var w=42
var L=18
var R=4
var x=d.font_height
var O=A+2*L
var b=2*L+(x+R)+w
function isRacePanelActive(){return Boolean(S)}function isRacePanelInColumn(){return isRacePanelActive()&&l()&&!(a.x1()-c()>=2*d.button_height+O+3*n)}function getRacePanelPos(){var e=d.button_height+n
var t=O+n
var r
if(l()){r={x:a.w()-2*e-t,y:0}
if(a.x1()-c()<2*e+t){r.x+=2*e
r.y+=e}if(g())r.y+=e}else r={x:s()?n+2*e:a.w()-2*e-t,y:0}
return r}function raceReady(){return S?Date.now()-S.start<0:false}function possiblyCancelReadyRace(){if(raceReady())T()}function getRacePanelWidth(){return A+2*L}var N=null
var C=36e5
function racePanel(){if(!(S=y("race_data"))){N=null
return}var e=Date.now()-S.start
if(e<0&&!N){N=Math.floor(e/1e3)
I("race_ready")}else if(N){var t=Math.floor(e/1e3)
if(t!==N)if(0===(N=t)){I("race_start")
N=null}else I("race_ready")}if(!_.defines.NOUI){var r=getRacePanelPos(),a=r.x,i=r.y
var o=a+O/2-A/2
var n=i+L
d.font.drawSizedAligned(E,o,n,Z.MENUBUTTON,d.font_height,d.font.ALIGN.HLEFT,O-2*L,0,h.addColon(e>=0?h.LBL_ELAPSED_TIME:h.LBL_READY_TIME))
var s=f(Math.abs(e))
d.font.drawSizedAligned(E,o,n,Z.MENUBUTTON,d.font_height,d.font.ALIGN.HRIGHT,O-2*L,0,e>=C?s.slice(0,-2):s)
n+=x+R
if(d.buttonText({x:o,y:n,z:d.Z.MENUBUTTON,w:A,h:w,text:h.BTN_ABANDON_RACE})){var l=!u.touch_mode&&!p()?u.pointerLockEnter:null
d.modalDialog({text:h.DLG_LEAVE_RACE_MSG,buttons:{OK:{cb:T,in_event_cb:l},Cancel:{cb:v,in_event_cb:l}}})}var c={x:a,y:i,w:O,h:b}
u.drag(c)
d.panel({x:a,y:i,z:Z.MENUBUTTON-1,w:O,h:b,pixel_scale:.5,color:m.panel_color_popup})}}},{"../glov/client/camera2d":241,"../glov/client/engine":250,"../glov/client/input":271,"../glov/client/ui":306,"../glov/common/util":330,"./layout":99,"./localization/localization":108,"./menu":117,"./quickbar":142,"./share_menu":150,"./styles":160,"./user_data":170,"./world_comm":182,"./worlds_sound":187}],145:[function(e,t,r){"use strict"
var a=e("../glov/client/rand_fast.js").randFastCreate
var i=e("../glov/common/rand_alea.js").randCreate
r.createFast=a
r.createGood=i},{"../glov/client/rand_fast.js":288,"../glov/common/rand_alea.js":327}],146:[function(e,t,r){"use strict"
r.setLatestNewsTS=setLatestNewsTS
r.redDotWorldInit=redDotWorldInit
r.redDotIsSeen=redDotIsSeen
r.redDotSeen=redDotSeen
r.redDotDrawNew=redDotDrawNew
r.redDotStartup=redDotStartup
var a=e("../glov/client/cmds").cmd_parse
var i=e("../glov/client/engine")
var o=e("../glov/client/local_storage")
var n=e("../glov/client/net")
var s=n.netClient
var l=n.netSubs
var c=e("../glov/client/ui")
var _=e("../glov/common/vmath").vec4
var u=e("../common/ids").ITEM_ENERGY_WELL
var d=e("../common/waygate_upgrade_common").WAYGATE_UPGRADES
var f=e("./costume_edit").getCostumeOptions
var v=e("./localization/localization").L
var h=e("./settlement").settlementCurrent
var p=e("./user_data")
var m=p.userDataGet
var g=p.userDataSet
var E=p.userDataSetEx
var y=e("./world_metadata").adventureMode
var T=Math.min,I=Math.abs,S=Math.sin
var A="w_"
var w=_(1,0,0,1)
var L={}
var R={}
var x
a.register({cmd:"red_dot_reset",help:"(Hidden) Reset all red dots",access_show:["sysadmin"],func:function func(e,t){o.clearAll("reddot_"+e)
L={}
t(null,"Cleared.")}})
a.register({cmd:"world_red_dot_reset",help:"(Hidden) Reset all per-world red dots",access_show:["sysadmin"],func:function func(e,t){g("reddot",void 0)
L={}
t(null,"Cleared.")}})
var O={latest_request_ts:0,user_ts:0,world_ts:0,request_rate:3e4}
function getLatestNewsTS(){if(!s().connected)return O.world_ts<O.user_ts
var e=Date.now()
if(0===O.user_ts&&l().loggedIn()){O.user_ts=l().getMyUserChannel().getChannelData("public.latest_news_ts")||0
O.user_ts=Number(O.user_ts)}if(e-O.latest_request_ts>O.request_rate){O.latest_request_ts=e
s().send("world_global_get","latest_news_ts",function(e,t){if(!e)O.world_ts=t})}return O.world_ts<O.user_ts}function setLatestNewsTS(){l().sendCmdParse("latest_news_set_ts "+Date.now(),function(e){if(e)console.log(e)})
O.user_ts=Date.now()}var b={false:function _false(){return false},new_costume:function new_costume(){var e=f()
for(var t=0;t<e.length;++t)if(!redDotIsSeen("c."+e[t]))return false
return true},reddot_news_last_seen_ts:function reddot_news_last_seen_ts(){return getLatestNewsTS()},new_build_settlement:function new_build_settlement(){if(!y())return true
var e=h()
if(!e)return true
for(var t in d){var r=d[t]
if(e.unlocked_upgrades[t]&&r.unlocks)for(var a=0;a<r.unlocks.length;++a){var i=r.unlocks[a]
if(i===u)continue
if(!redDotIsSeen("w_b_"+i))return false}}return true}}
function redDotWorldInit(e){R={}}function redDotIsSeen(e){if(Array.isArray(e)){for(var t=0;t<e.length;++t)if(!redDotIsSeen(e[t]))return false
return true}if(b[e])return b[e]()
var r=e.startsWith(A)
if(x&&!r)return true
var a=r?R:L
var i=a[e]
if(!i){i=a[e]={}
if(r)i.seen=m("reddot."+e.slice(A.length))
else i.seen=Boolean(o.get("reddot_"+e))}return i.seen}function redDotSeen(e){var t=e.startsWith(A)
var r=t?R:L
var a=r[e]
if(!a)a=r[e]={}
if(!a.seen){if(t)E("reddot",e.slice(A.length),1)
else o.set("reddot_"+e,1)
a.seen=1}}var N=_(.8,.11,0,1)
function redDotColorPulse(){var e=I(S(i.frame_timestamp/250))
N[3]=e
return N}function redDotDraw(e){if(redDotIsSeen(e.hook))return
var t=T(e.w,e.h)
var r=e.reddot_pad||T(4,.05*t)
var a=e.reddot_r||.125*t
redDotColorPulse()
if("upper_left"===e.reddot_pos)c.drawCircle(e.x+a+r,e.y+a+r,e.z+.1,a,.95,N)
else c.drawCircle(e.x+e.w-a-r,e.y+a+r,e.z+.1,a,.95,N)}function redDotDrawNew(e){var t=e.w?e.x+e.w:e.x
var r=e.h
var a=T(4,.05*r)
var i=.125*r
var o=4.5*i
var n=e.y+a
c.drawCircle((t-=a)-i,n+i,e.z+.1,i,.95,w)
c.drawRect(t-o+i,n,t-i,n+2*i-.5,e.z+.1,w)
c.drawCircle(t-o+i,n+i,e.z+.1,i,.95,w)
c.font.drawSizedAligned(null,t-1.5*a,n+i,e.z+.12,2*i,c.font.ALIGN.HRIGHT|c.font.ALIGN.VCENTER,0,0,v.REDDOT_NEW)}function redDotClick(e){e.hook
if("string"===typeof e.hook&&(e.hook.startsWith("w_b_")||e.hook.startsWith("c.")))redDotSeen(e.hook)}function redDotStartup(){c.addHook(redDotDraw,redDotClick)
if(x=!o.get("reddot_init"))o.set("reddot_init",1)}},{"../common/ids":198,"../common/waygate_upgrade_common":211,"../glov/client/cmds":244,"../glov/client/engine":250,"../glov/client/local_storage":274,"../glov/client/net":279,"../glov/client/ui":306,"../glov/common/vmath":332,"./costume_edit":56,"./localization/localization":108,"./settlement":148,"./user_data":170,"./world_metadata":186}],147:[function(e,t,r){"use strict"
r.doSettings=doSettings
r.settingsMenuClear=settingsMenuClear
r.settingsMenuInit=settingsMenuInit
var O=e("../glov/client/browser.js").is_discrete_gpu
var a=e("../glov/client/cmds.js").resetSettings
var b=e("../glov/client/engine.js")
var i=e("../glov/client/fscreen.js")
var N=i.fscreenActive
var C=i.fscreenAvailable
var M=i.fscreenExit
var D=e("../glov/client/input.js")
var P=e("../glov/client/scroll_area.js").scrollAreaCreate
var o=e("../glov/client/slider.js")
var k=o.slider
var B=o.sliderIsDragging
var U=e("../glov/client/ui")
var G=e("../glov/common/util.js").clamp
var F=e("./analytics.js").logEvent
var W=e("./app_access.js").accessAllowFeedback
var j=e("./credits_menu.js").doCreditsMenu
var H=e("./feedback").feedbackShow
var z=e("./inventory.js")
var V=e("./inventory.js").inventoryReset
var n=e("./layout.js")
var Y=n.TALL
var q=n.layoutCameraCurX1
var K=n.layoutCameraCurY1
var X=n.layoutCameraTallWideMode
var Q=n.layoutWide
var J=e("./localization/localization").L
var $=e("./main.js")
var s=e("./menu.js")
var ee=s.PANEL_PAD
var te=s.doQuickSlotMenu
var re=s.fscreenEnterAndOrient
var ae=s.menuX1
var ie=s.menuY1
var oe=s.setFadePanel
var ne=e("./orient.js")
var l=e("./styles.js")
var se=l.inventory_style
var le=l.menu_header_style
var ce=e("./tutorial.js").tutorialStartByName
var _e=e("./user_data.js").worldReadOnly
var ue=e("./voxel_chunk_manager.js")
var de=e("./voxel_data.js")
var fe=e("./world_comm.js").getWorldChannel
var ve=e("./world_metadata.js").adventureMode
var he=e("../glov/client/net.js").netBuildString
var pe=e("../glov/client/settings.js")
var me=Math.round
function toggleAA(){pe.set("aa",1-pe.aa)
if(Boolean(pe.aa)!==Boolean(b.antialias))U.modalDialog({title:J.DLG_AA_CHANGED_TITLE,text:window.FBInstant?J.DLG_AA_CHANGED_QUIT_MSG:J.DLG_AA_CHANGED_RESTART_MSG,buttons:{Yes:b.reloadSafe,No:null}})}function resetSettingsAfterPrompt(){var e=a()
if(e){$.chat_ui.handleCmdParse(null,e)
U.modalDialog({title:J.DLG_RESET_DEFAULTS_DONE_TITLE,text:window.FBInstant?J.DLG_RESET_DEFAULTS_REQUIRED_QUIT_MSG:J.DLG_RESET_DEFAULTS_REQUIRED_RESTART_MSG,buttons:{Yes:b.reloadSafe,No:null}})}else U.modalDialog({title:J.DLG_RESET_DEFAULTS_DONE_TITLE,text:J.DLG_RESET_DEFAULTS_NOTHING_MSG,buttons:{OK:null}})}var ge
var Ee
var ye
var Te=false
var Ie=false
var Se="☎"
var Ae="☏"
var we=pe.volume
function doSettings(n){var e=X()
var s=0
var l=254
var t=(3*l+ee)/2
var c=36
function settingsButton(e,t,r,a,i){var o=U.buttonText({x:s,y:n,w:t||l,font_height:a||c,text:e,in_event_cb:r,hook:i})
s+=(t||l)+ee
return o}var _=200
var u=80
var d=U.button_height
function volumeSlider(e,t,r){ge.drawSizedAligned(se,s,n,Z.UI,c,ge.ALIGN.VCENTER|ge.ALIGN.HFIT,_,U.button_height,J.addColon(t))
var a=(s+=_+8)+u+8
var i=me(100*pe[e])/100
var o=me(100*k(i,{x:a,y:n+(U.button_height-d)/2,min:0,max:1,w:l,h:d}))
ge.drawSizedAligned(se,s,n,Z.UI,c,ge.ALIGN.HFIT|ge.ALIGN.HRIGHT|ge.ALIGN.VCENTER,u,U.button_height,J.addPercentage(o))
if((o/=100)!==i)r(e,o)
s=a+l+ee}function crlf(){s=16
n+=U.button_height+ee}function category(e,t){if(!t)crlf()
Ee.drawSized(le,0,n,Z.UI,32,e)
n+=40}if(settingsButton(J.BTN_EXIT_TO_MAIN_MENU,t)){F("exit_to_main_menu_button",1,"button","settings")
$.returnToMainMenu()}if(W()&&settingsButton(J.BTN_BUGS_FEEDBACK))H()
if(Ie){if(settingsButton("Settings"))Ie=false
crlf()
j(n)
if(Te)Te=Ie=false
return}else if(settingsButton("Credits"))Ie=true
crlf()
if(!ye)ye=P({z:Z.UI,background_color:null,auto_hide:true})
ye.keyboardScroll()
var r=ye.barWidth()
var a={x:0,y:n,w:q(),h:K()-n}
ye.begin(a)
s=16
n=0
if(settingsButton(J.BTN_RESET_DEFAULTS))U.modalDialog({title:J.DLG_RESET_DEFAULTS_TITLE,text:J.DLG_RESET_DEFAULTS_MSG,buttons:{OK:resetSettingsAfterPrompt,Cancel:null}})
crlf()
category(J.LBL_AUDIO,true)
volumeSlider("volume",J.LBL_VOLUME_MASTER,function(e,t){we=t
pe.set(e,t)})
if(settingsButton(0===pe.volume?Ae:Se,U.button_height,null,.85*U.button_height)){var i=0===pe.volume?we||1:0
we=i||we
pe.set("volume",i)}crlf()
volumeSlider("volume_music",J.LBL_VOLUME_MUSIC,pe.set)
if(e===Y)crlf()
volumeSlider("volume_sound",J.LBL_VOLUME_SOUND,pe.set)
crlf()
category(J.LBL_GRAPHICS,true)
s+=l+ee
ge.drawSizedAligned(se,s-8,n,Z.UI,c,ge.ALIGN.VCENTER|ge.ALIGN.HRIGHT,0,U.button_height,J.addColon(J.LBL_PRESET))
if(settingsButton(J.BTN_FAST)){$.chat_ui.cmdParseInternal("bevel 0")
pe.set("render_scale",.5)
pe.set("fov_third",50)
pe.set("fov",50)
if(pe.aa)toggleAA()}if(settingsButton(J.BTN_PRETTY)){$.chat_ui.cmdParseInternal("bevel 1")
pe.set("render_scale",1)
pe.set("view_dist",15)
pe.set("fov_third",60)
pe.set("fov",60)
if(!pe.aa)toggleAA()}crlf()
if(de.bevel_available)if(settingsButton(de.bevel_value?J.BTN_SHADERS_SHINY:J.BTN_SHADERS_MEH))$.chat_ui.cmdParseInternal("bevel "+(1-de.bevel_value))
if(!b.antialias_unavailable){var o=Boolean(pe.aa)!==Boolean(b.antialias)
if(settingsButton(pe.aa?o?J.BTN_AA_ON_PENDING:J.BTN_AA_ON:o?J.BTN_AA_OFF_PENDING:J.BTN_AA_OFF))toggleAA()}crlf()
ge.drawSizedAligned(se,s,n,Z.UI,c,ge.ALIGN.VCENTER|ge.ALIGN.HFIT,_,U.button_height,J.addColon(J.LBL_RESOLUTION_SCALE))
s+=_+8
var f=G(me(100*pe.render_scale),25,100)
var v=s+u+8
var h=me(k(f,{x:v,y:n+(U.button_height-d)/2,min:25,max:100,w:l,h:d}))
if(h>95)h=100
else if(h>63&&h<71)h=66.666666667
else if(h>45&&h<55)h=50
else if(h>30&&h<36)h=33.333333333
else if(h>23&&h<27)h=25
ge.drawSizedAligned(se,s,n,Z.UI,c,ge.ALIGN.HFIT|ge.ALIGN.HRIGHT|ge.ALIGN.VCENTER,u,U.button_height,J.addPercentage(me(h)))
if(h!==f)pe.set("render_scale",h/100)
if(B())oe(true)
s=v+l+ee
if(e===Y)crlf()
ge.drawSizedAligned(se,s,n,Z.UI,c,ge.ALIGN.VCENTER|ge.ALIGN.HFIT,_,U.button_height,J.addColon(J.LBL_VIEW_DISTANCE))
s+=_+8
var p=G(ue.view_dist,5,O?30:15)
var m=me(k(p,{x:v=s+u+8,y:n+(U.button_height-d)/2,min:5,max:O?30:15,w:l,h:d}))
ge.drawSizedAligned(se,s,n,Z.UI,c,ge.ALIGN.HFIT|ge.ALIGN.HRIGHT|ge.ALIGN.VCENTER,u,U.button_height,""+m)
if(m!==p)pe.set("view_dist",m)
s=v+l+ee
crlf()
ge.drawSizedAligned(se,s,n,Z.UI,c,ge.ALIGN.VCENTER|ge.ALIGN.HFIT,_,U.button_height,J.addColon(J.LBL_FIELD_OF_VIEW))
s+=_+8
var g=pe.camera_view?"fov_third":"fov"
var E=me(pe[g])
var y=me(k(E,{x:v=s+u+8,y:n+(U.button_height-d)/2,min:40,max:100,w:l,h:d}))
ge.drawSizedAligned(se,s,n,Z.UI,c,ge.ALIGN.HFIT|ge.ALIGN.HRIGHT|ge.ALIGN.VCENTER,u,U.button_height,""+y)
if(y!==E)pe.setAsync(g,y)
if(B())oe(true)
s=v+l+ee
category(J.LBL_CONTROLS)
if(settingsButton(pe.fly_relative?J.BTN_FLY_RELATIVE:J.BTN_FLY_ALT_LOCKED))pe.set("fly_relative",pe.fly_relative?0:1)
if(settingsButton(pe.camera_view?J.BTN_CAMERA_TP:J.BTN_CAMERA_FP))pe.setAsync("camera_view",pe.camera_view?0:1)
if(e===Y&&!D.touch_mode)crlf()
var T=D.touch_mode?"max_jump_tap_touch":"max_jump_tap_kb"
if(settingsButton(pe[T]?J.BTN_MAX_JUMP_TAP:J.BTN_MAX_JUMP_HOLD))pe.setAsync(T,pe[T]?0:1)
if(!D.touch_mode&&settingsButton(J.BTN_SHOW_CONTROLS)){var I=J.CONTROLS_FORMAT_DESC
U.modalDialog({title:J.DLG_CONTROLS_TITLE,text:[J.addColon(J.CONTROLS_SECTION_MOVEMENT),"  "+J.$(I,"WASD",J.CONTROLS_MOVE),"  "+J.$(I,J.INPUT_KEY_SPACE,J.CONTROLS_JUMP_FLY),"  "+J.$(I,"C",J.CONTROLS_FLY_DOWN),"  "+J.$(I,J.INPUT_KEY_SHIFT,J.CONTROLS_SPRINT),"  "+J.$(J.CONTROLS_DOUBLE_JUMP,J.INPUT_KEY_SPACE),"  "+J.$(I,"V",J.CONTROLS_TOGGLE_VIEW),J.addColon(J.CONTROLS_SECTION_BUILDING),"  "+J.$(I,J.$(J.CONTROLS_FORMAT_OR,J.INPUT_CLICK_LEFT,"R"),J.CONTROLS_PLACE_DESTROY),"  "+J.$(I,J.INPUT_CLICK_MIDDLE,J.CONTROLS_PICK),"  "+J.$(I,J.INPUT_CLICK_RIGHT,J.CONTROLS_UNLOCK_MOUSE),te()?"  "+J.$(I,"Q",J.CONTROLS_QUICK_SLOT)+"\n  "+J.$(I,"B",J.CONTROLS_BUILD_MENU):"  "+J.$(I,J.$(J.CONTROLS_FORMAT_OR,"Q","B"),J.CONTROLS_BUILD_MENU),"  "+J.$(I,J.$(J.CONTROLS_FORMAT_OR,J.INPUT_KEY_TAB,J.INPUT_DRAG_QBAR),J.CONTROLS_SCROLL_QBAR),"  "+J.$(I,"1-8",J.CONTROLS_SELECT_QBAR),"  "+J.$(I,J.$(J.CONTROLS_FORMAT_OR,"Z",J.$(J.CONTROLS_FORMAT_AGAIN,"1-8")),J.CONTROLS_CYCLE_SIZES),"  "+J.$(I,"X",J.CONTROLS_TOGGLE_GATHERING),J.addColon(J.CONTROLS_SECTION_OTHER),"  "+J.$(I,"E",J.CONTROLS_OPEN_MENU),"  "+J.$(I,"F",J.CONTROLS_TORCH),"  "+J.$(I,"I",J.CONTROLS_INV_MENU),"  "+J.$(I,"O",J.CONTROLS_WORLD_MENU),"  "+J.$(I,"P",J.CONTROLS_SOCIAL_MENU),"  "+J.$(I,"F8",J.CONTROLS_TOGGLE_HUD),"  "+J.$(I,"F9",J.CONTROLS_PHOTO_MODE),"  "+J.$(I,"F11",J.CONTROLS_FULLSCREEN),"  "+J.$(I,J.INPUT_KEY_ENTER,J.CONTROLS_CHAT)].join("\n"),width:750,y0:70,buttons:{OK:null}})}crlf()
ge.drawSizedAligned(se,s,n,Z.UI,c,ge.ALIGN.VCENTER|ge.ALIGN.HFIT,_,U.button_height,J.addColon(D.touch_mode?J.LBL_LOOK_SENSITIVITY:J.LBL_MOUSE_SENSITIVITY))
s+=_+8
var S=me(100*pe.mouse_sensitivity)
var A=me(k(S,{x:v=s+u+8,y:n+(U.button_height-d)/2,min:10,max:150,w:l,h:d}))
if(A>95&&A<105)A=100
ge.drawSizedAligned(se,s,n,Z.UI,c,ge.ALIGN.HFIT|ge.ALIGN.HRIGHT|ge.ALIGN.VCENTER,u,U.button_height,""+A)
if(A!==S)$.chat_ui.cmdParseInternal("mouse_sensitivity "+A/100)
s=v+l+ee
if(1===pe.camera_view){if(e===Y)crlf()
ge.drawSizedAligned(se,s,n,Z.UI,c,ge.ALIGN.VCENTER|ge.ALIGN.HFIT,_,U.button_height,J.addColon(J.LBL_CAMERA_DISTANCE))
s+=_+8
var w=pe.camera_max_distance
var L=me(k(w,{x:v=s+u+8,y:n+(U.button_height-d)/2,min:5,max:12,w:l,h:d}))
ge.drawSizedAligned(se,s,n,Z.UI,c,ge.ALIGN.HFIT|ge.ALIGN.HRIGHT|ge.ALIGN.VCENTER,u,U.button_height,""+L)
if(L!==w)pe.set("camera_max_distance",L)
s=v+l+ee}category(J.LBL_INTERFACE)
if(C())if(N()){if(settingsButton(J.BTN_EXIT_FULLSCREEN)){M()
ne.unlock()}}else settingsButton(D.touch_mode?J.BTN_FULLSCREEN:J.$(J.BTN_FULLSCREEN_KEY,"F11"),void 0,re)
if(ne.enabled())settingsButton(J.BTN_ORIENTATION,void 0,ne.toggle)
crlf()
if(settingsButton([J.BTN_LAYOUT_AUTO,J.BTN_LAYOUT_TALL,J.BTN_LAYOUT_WIDE][pe.layout]))pe.set("layout",(pe.layout+1)%3)
if(settingsButton(Q()?[J.BTN_QBAR_LEFT,J.BTN_QBAR_RIGHT][pe.layout_quickbar]:J.BTN_QBAR_TOP))pe.set("layout_quickbar",(pe.layout_quickbar+1)%2)
if($.omp&&settingsButton(pe.chat_auto_unfocus?J.BTN_CHAT_UNFOCUS:J.BTN_CHAT_KEEP_FOCUS))pe.set("chat_auto_unfocus",1-pe.chat_auto_unfocus)
crlf()
if(settingsButton([J.BTN_UIS_INTEGRATED,J.BTN_UIS_SEPARATE][pe.split_factory],t)){var R=1-pe.split_factory
pe.set("split_factory",R)
pe.set("split_container",R)
pe.set("split_waygate",R)}if(settingsButton([J.BTN_BUILD_INTEGRATED,J.BTN_BUILD_SEPARATE][pe.split_build],t))pe.set("split_build",1-pe.split_build)
crlf()
if(!_e()){category(J.LBL_DEBUG,true)
if(settingsButton(J.BTN_RESET_INVENTORY))U.modalDialog({title:J.DLG_RESET_INV_TITLE,text:J.DLG_RESET_INV_MSG,buttons:{OK:function OK(){if(fe())V()},Cancel:null}})
if(ve()){if(settingsButton(J.BTN_RESET_TUTORIAL))ce("adventure_start",true)
if(b.DEBUG)crlf()}if(b.DEBUG){if(settingsButton("Debug: Materials"))z.debugMaterials()
if(settingsButton("Debug: Blocks"))z.debugBlocks()}crlf()}ye.end(n)
var x=ye.isVisible()?r+4:0
ge.drawSizedAligned(se,ae()-x,ie()-.75*U.font_height,Z.UI,.75*U.font_height,ge.ALIGN.HRIGHT|ge.ALIGN.VBOTTOM,0,0,J.separateColon(J.LBL_RENDERER,"WebGL"+(b.webgl2?2:1)))
ge.drawSizedAligned(se,ae()-x,ie(),Z.UI,.75*U.font_height,ge.ALIGN.HRIGHT|ge.ALIGN.VBOTTOM,0,0,J.separateColon(J.LBL_VERSION,he()))}function settingsMenuClear(){if(Ie)Te=true}function settingsMenuInit(){ge=U.font
Ee=U.title_font
Ie=false}},{"../glov/client/browser.js":239,"../glov/client/cmds.js":244,"../glov/client/engine.js":250,"../glov/client/fscreen.js":262,"../glov/client/input.js":271,"../glov/client/net.js":279,"../glov/client/scroll_area.js":289,"../glov/client/settings.js":291,"../glov/client/slider.js":294,"../glov/client/ui":306,"../glov/common/util.js":330,"./analytics.js":5,"./app_access.js":11,"./credits_menu.js":61,"./feedback":81,"./inventory.js":94,"./layout.js":99,"./localization/localization":108,"./main.js":112,"./menu.js":117,"./orient.js":122,"./styles.js":160,"./tutorial.js":166,"./user_data.js":170,"./voxel_chunk_manager.js":174,"./voxel_data.js":175,"./world_comm.js":182,"./world_metadata.js":186}],148:[function(e,t,r){"use strict"
r.isSettlement=isSettlement
r.Settlement=Settlement
r.settlementFromVolume=settlementFromVolume
r.settlementGet=settlementGet
r.settlementForPos=settlementForPos
r.settlementCurrent=settlementCurrent
r.settlementLastBound=settlementLastBound
r.settlementGetLazyAsync=settlementGetLazyAsync
r.settlementUpdate=settlementUpdate
r.settlementBeamDraw=settlementBeamDraw
var s=e("assert")
var f=e("./camera.js").getCurrentCameraPos
var a=e("../glov/client/cmds.js").cmd_parse
var v=e("./draw_sprite3d.js").drawSprite3D
var i=e("./editvolume_client.js"),o=i.editVolumeById,n=i.editVolumeForPos
var h=e("../glov/client/engine.js")
var p=e("./fx_util.js").fxUtilGlow
var m=e("../common/globals.js").CHUNK_SIZE
var l=Math.abs,g=Math.max,E=Math.min
var c=e("./main.js").charControllerPos
var _=e("./megachunk_client.js"),u=_.megachunkForVolumeID,d=_.megachunkGetSettlement
var y=e("./photo_mode.js").photoModeActive
var T=e("../glov/client/settings.js")
var I=e("../common/settlement_common.js").settlementTier
var S=e("../glov/client/sprites.js"),A=S.blendModeReset,w=S.blendModeSet,L=S.BLEND_ADDITIVE
var R=e("./user_data.js").userHomeSettlementID
var x=e("../glov/common/util.js"),O=x.clamp,b=x.clone,N=x.easeInOut,C=x.lerp
var M=e("../glov/common/vmath.js"),D=M.vec2,P=M.vec3,k=M.v2dist,B=M.vec4
var U=e("./waygate_upgrade.js"),G=U.WAYGATE_TIERS,F=U.WAYGATE_UPGRADES
var W=e("../common/world_constants.js"),j=W.VOLUME_SETTLEMENT_PREFIX,H=W.WAYGATE_FLAG_SETTLEMENT
var z=e("./world_metadata.js"),V=z.adventureMode,Y=z.worldMetadataWaygate,q=z.worldMetadataWaygates
var K=e("../common/world_trans.js").decodeWorldPos
var Z=e("./voxel_data.js"),X=Z.localPosFromWorldPos,Q=Z.worldPosFromLocalPos
var J=e("./voxel_chunk_manager.js")
var $=2
function isSettlementRaw(e,t){return(null==t?void 0:t.flags)&H}function isSettlement(e){return V()&&isSettlementRaw(e,Y(e))}function settlementRadius(e){var t=e.unlocks
var r=I(e)
var a=G[r]
s(a)
var i=a.radius
for(var o in F)if(t&&t[o]){var n=F[o]
if(!n)continue
if(n.radius_add)i+=n.radius_add}return i}function applyUpgrade(e,t){var r=F[t]
if(!r)return
if(r.unlock_items)for(var a=0;a<r.unlock_items.length;++a){var i=r.unlock_items[a]
e.unlocks.push(i)}if(r.unlocks)for(var o=0;o<r.unlocks.length;++o){var n=r.unlocks[o]
e.unlocked_ids[n]=true}if(r.unlocks_recipes)for(var s=0;s<r.unlocks_recipes.length;++s){var l=r.unlocks_recipes[s]
e.unlocked_recipes[l]=true}}function Settlement(e,t,r){this.mcid=e
this.settlement_id=t
this.last_data=b(r)
var a=r.unlocks,i=r.progress
var o=Y(t)
this.world_pos=P()
if(o){var n=o.pos,s=o.name
K(this.world_pos,n[0],n[1])
this.name=s}else this.name="..."
this.tier=I(r)
this.radius=settlementRadius(r)
this.unlocks=[]
this.unlocked_upgrades=a||{}
this.unlocked_ids={}
this.unlocked_recipes={}
this.unlock_info=a
this.progress=i
applyUpgrade(this,"tier0")
for(var l in F)if(a&&a[l])applyUpgrade(this,l)}Settlement.prototype.allowsItem=function(e){return this.unlocked_ids[e]}
Settlement.prototype.allowsRecipe=function(e){return this.unlocked_recipes[e]}
function keyToUpgradeData(e){return F[e]}function cmpUpgradeIndex(e,t){return e.upgrade_idx-t.upgrade_idx}Settlement.prototype.availableUpgrades=function(){var i=this
var e=Object.keys(F).filter(function(e){if(i.unlocked_upgrades[e])return false
var t=F[e],r=t.prereqs
if(t.is_tier)return false
if(r)for(var a=0;a<r.length;++a)if(!i.unlocked_upgrades[r[a]])return false
return true}).map(keyToUpgradeData)
e.sort(cmpUpgradeIndex)
if(e.length>$)e=e.slice(0,$)
return e}
Settlement.prototype.allowsRecipeSoon=function(e){var t=G[this.tier+1]
if(t)if(t.unlocks_recipes)if(-1!==t.unlocks_recipes.indexOf(e))return true
var r=this.availableUpgrades()
for(var a=0;a<r.length;++a)if(r[a].unlocks_recipes)if(-1!==r[a].unlocks_recipes.indexOf(e))return true
return false}
Settlement.prototype.buildAllowed=function(){var e=o(""+j+this.settlement_id)
return e&&e.build_allowed}
var ee={}
function initSettlement(e,t){s("number"===typeof t)
var r=d(t,e)
if(!r)return null
return new Settlement(t,e,r)}function settlementFromVolume(e){var t=e.volume_id
if(!t.startsWith(j))return null
var r=t.slice(j.length)
var a=ee[r]
if(void 0===a)a=ee[r]=initSettlement(r,e.mcid)
return a}function settlementGet(e){var t=e
var r=ee[t]
if(void 0===r){var a=u(""+j+t)
if(!a)r=ee[t]=null
else r=ee[t]=initSettlement(t,a.mcid)}return r}var te=P()
var re
function settlementForPos(e){re=null
var t=n(e)
if(!t)return null
var r=re=settlementFromVolume(t)
if(!r)return null
var a=r.world_pos
Q(te,e)
if(g(l(a[0]-te[0]),l(a[1]-te[1]),l(a[2]-te[2]))<=r.radius)return r
return null}var ae
var ie
var oe
function settlementCurrent(e){if(oe!==h.frame_index){oe=h.frame_index
ae=settlementForPos(c())
ie=re}return e?ie:ae}function settlementLastBound(){var e=R()
if(isSettlement(e))return settlementGet(e)
return null}var ne=[]
function settlementGetLazyAsync(e,t){ne.push([e,t])}function settlementUpdate(e){ee={}
if(e)ne=[]
else for(var t=ne.length-1;t>=0;--t){var r=ne[t],a=r[0],i=r[1]
var o=settlementGet(a)
if(o){ne.splice(t,1)
i(o)}}}T.register({settlement_beam_dist:{label:"Settlement Beam Distance",help:"Set the distance at which to start drawing Settlement beams",usage:"Default: 20",prefix_usage_with_help:true,default_value:20,type:a.TYPE_FLOAT,range:[0,1e3]},settlement_beam_in_photo_mode:{help:"Allow drawing Settlement beams in photo mode",default_value:0,type:a.TYPE_INT,range:[0,1]}})
var se=P()
var le=D(10,400)
var ce=D()
var _e=B(1,248/255,164/255,1)
var ue=.25
var de=B(180/255,248/255,1,1)
var fe=.1
var ve=100
function settlementBeamDraw(e){if(h.defines.NOUI||y()&&!T.settlement_beam_in_photo_mode||!V())return
if(e&&h.defines.NOBEAMFAR)return
if(!e&&h.defines.NOBEAMNEAR)return
var t=R()
var r=q()
var a=false
var i=J.view_dist*m
if(e)i=g(i,T.settlement_beam_dist)
for(var o in r){var n=r[o]
var s=void 0
var l=void 0
if(o===t){s=_e
l=ue}else if(n.flags&H){s=de
l=fe}else continue
K(te,n.pos[0],n.pos[1])
X(se,te)
var c=k(se,f())
var _=e?i:T.settlement_beam_dist
var u=O((c-_)/ve,0,1)
if(!e)u=E(u,O((i+ve-c)/ve,0,1))
if(u>0){a=true
w(L)
gl.depthMask(false)
var d=C(O((c-250)/2e3,0,1),1,10)
ce[0]=le[0]*d
ce[1]=le[1]*d
s[3]=l*N(u,2)
v({pos:se,size:ce,color:s,texs:p()})}}if(a){A()
gl.depthMask(true)}}},{"../common/globals.js":197,"../common/settlement_common.js":207,"../common/world_constants.js":212,"../common/world_trans.js":213,"../glov/client/cmds.js":244,"../glov/client/engine.js":250,"../glov/client/settings.js":291,"../glov/client/sprites.js":302,"../glov/common/util.js":330,"../glov/common/vmath.js":332,"./camera.js":28,"./draw_sprite3d.js":70,"./editvolume_client.js":72,"./fx_util.js":86,"./main.js":112,"./megachunk_client.js":116,"./photo_mode.js":128,"./user_data.js":170,"./voxel_chunk_manager.js":174,"./voxel_data.js":175,"./waygate_upgrade.js":180,"./world_metadata.js":186,assert:void 0}],149:[function(e,t,r){"use strict"
r.settlementEditStartup=settlementEditStartup
r.settlementEditInit=settlementEditInit
r.settlementProgress=settlementProgress
r.settlementEditRun=settlementEditRun
r.CRAFTING_ICON_SIZE=void 0
var b=100
r.CRAFTING_ICON_SIZE=b
var N=e("assert")
var C=e("../glov/client/camera2d.js")
var a=e("../glov/client/cmds.js").cmd_parse
var M=e("../glov/client/engine.js")
var T=e("../glov/client/input.js")
var D=e("../glov/client/settings.js")
var i=e("../glov/client/spot.js")
var P=i.SPOT_DEFAULT_LABEL
var k=i.spot
var B=e("../glov/client/ui.js")
var U=e("../glov/client/walltime.js")
var G=e("../glov/common/util.js").secondsToFriendlyString
var o=e("../glov/common/vmath")
var F=o.v2set
var W=o.vec2
var j=e("../common/ids").TYPE_SETTLEMENT_UPGRADE
var s=e("./analytics.js").logEvent
var I=e("./factory_ui.js").drawZoomed
var n=e("./inventory.js")
var d=n.INV_PLAYER
var f=n.inventoryGet
var v=n.inventoryGetSize
var m=n.transInvDec
var l=e("./inventory_ui.js")
var h=l.ACCEPT_HIGHLIGHT
var p=l.ACCEPT_NO
var g=l.ACCEPT_OK
var H=l.INVTYPE_CONTAINER
var z=l.INVTYPE_MAIN
var E=l.ctxTrans
var V=l.doInventorySetupContext
var Y=l.doInventorySub
var q=l.doInventorySubOneItem
var y=l.inventoryAnimate
var K=l.inventoryButton
var c=l.inventoryUIInit
var X=l.inventoryUITick
var _=e("./item_info_view.js")
var Q=_.ITEM_INFO_VIEW_W
var u=_.itemInfoViewClear
var S=_.itemInfoViewDraw
var J=_.itemInfoViewShow
var A=e("./items.js")
var w=A.ITEM_CONTEXT_BUILD
var $=A.ITEM_CONTEXT_ITEM
var ee=A.ITEM_CONTEXT_SETTLEMENT_UPGRADE
var L=A.sameItem
var R=A.satisfiesCost
var x=e("./layout.js")
var te=x.WIDE
var re=x.layoutCameraCurX1
var ae=x.layoutCameraTallWide
var ie=x.layoutCameraTallWideMode
var oe=e("./localization/localization").L
var O=e("./menu.js")
var ne=O.PANEL_PAD
var se=O.panel_color
var le=O.prefixShortcutKey
var ce=e("./settlement.js").settlementGet
var _e=e("./styles.js")
var ue=_e.color_black
var de=_e.inventory_style
var fe=_e.label_style
var ve=_e.menu_header_style
var he=_e.style_mode_label
var pe=_e.sublabel_style
var me=e("./todo_list.js")
var ge=me.TODO_TOGGLE
var Ee=me.todoIsInList
var ye=me.todoListAdd
var Te=me.todoTooltip
var Ie=e("./tutorial.js").tutorialPosHook
var Se=e("./ui_util.js")
var Ae=e("./ui_util.js").STAMINA_SYMBOL
var we=e("./user_data.js").userDataSet
var Le=e("./user_info_view.js").userInfoGet
var Re=e("./waygate_ui.js")
var xe=Re.FONT_HEIGHT
var Oe=Re.PAD
var be=Re.SUBLABEL_H
var Ne=Re.SUBLINE_W
var Ce=Re.SUBTITLE_H
var Me=Re.drawHLine
var De=e("./waygate_upgrade.js")
var Pe=De.WAYGATE_TIERS
var ke=De.WAYGATE_UPGRADES
var Be=e("./world_metadata.js").worldMetadata
var Ue=e("./worlds_sound.js").playSound
var Ge=Math.floor,Fe=Math.max,We=Math.min
var je
var He
var ze
var Ve={}
function settlementEditStartup(){je=B.font
He=B.title_font
ze=Se.sprite}function settlementEditInit(){c()
Ve={}}function settlementProgress(e,t,r){var a,i
var o=ke[t]
N(o)
var n=o.cost[r]
N(n)
var s=n.count
var l=(null==(a=e.progress)?void 0:null==(i=a[t])?void 0:i[r])||0
var c=Ve[t+"_"+r]
if(c)l=Fe(l,c.expected)
return We(l,s)}function slotInfo(e){var t=e.split(","),r=t[0],a=t[1]
N(r)
N(a)
var i=ke[r]
N(i)
var o=i.cost[a]
N(o)
return{key:r,subkey:a,cost:o}}function settlementFitsInSlot(e,t){var r=slotInfo(e).cost
N(r)
return R(r,t)}function settlementFitsInSlotExact(e,t){var r=slotInfo(e).cost
N(r)
return L(r,t)}function acceptsItemSettlement(e,t,r){var a
var i
if(t.type===H){a=t
i=r}else if(r.type===H){a=r
i=t}else return g
if(t.type===H&&!r.inv){var o=slotInfo(t.idx).cost
N(o)
for(var n=0;n<v(d);++n)if(R(o,f(n)))return h}if(!i.inv)return p
var s=slotInfo(a.idx)
var l=s.cost,c=s.key,_=s.subkey
N(l)
var u=settlementProgress(e.wgctx.settlement,c,_)
if(!(l.count-u>0))return p
if(settlementFitsInSlot(a.idx,i.inv))return h
else return p}function transSettlementProgress(e,t,r,a,i){var o=r+"_"+a
var n=Ve[o]
if(!n){var s,l
n=Ve[o]={amount:0,expected:(null==(s=t.progress)?void 0:null==(l=s[r])?void 0:l[a])||0}}n.amount+=i
n.expected+=i
e.opSettlementProgress(t.mcid,t.settlement_id,r,a,i)
e.onComplete(function(){n.amount-=i
if(n.amount<=0)delete Ve[o]})}var Ye
var qe
var Ke=[oe.BTN_UNLOCK_LETS_SEE,oe.BTN_UNLOCK_MORE1,oe.BTN_UNLOCK_MORE2,oe.BTN_UNLOCK_MORE3,oe.BTN_UNLOCK_MORE4,oe.BTN_UNLOCK_MORE5]
function settlementAnimateComplete(e){qe=M.frame_index
u()
Ue("waygate_upgrade")
var t=ke[e]
N(t)
s("waygate_unlock",1,e)
var r=t.radius_add,a=t.unlock_items,i=t.is_tier,o=t.tier_idx
var g=[]
g.push({type:"message",title:i?oe.separateColon(oe.$(oe.LBL_UNLOCKED_TIER,o),t.name):oe.separateColon(oe.LBL_UNLOCKED,t.name),text:oe.SETTLEMENT_WG_UNLOCK})
if(r)g.push({type:"message",title:oe.separateColon(oe.LBL_SIZE,"+"+2*r),text:oe.$(oe.SETTLEMENT_RADIUS_ADD,r)})
if(a)for(var n=0;n<a.length;++n)g.push(a[n])
var E=0
var y=0
function run(e){qe=M.frame_index
y+=M.frame_dt
var t=Z.SETTLEMENT_ANIMATE_COMPLETE
var r=100
var a=1e3-2*r
var i=1e3-1.5*r
var o=r
var n=r/2
var s=n
var l=B.button_height
var c={x:o+l,y:n-ne+16,z:t-5,w:a-2*l,h:B.button_height}
He.drawSizedAligned(ve,c.x+8,c.y,c.z+2,2*B.font_height,je.ALIGN.HVCENTERFIT,c.w-16,c.h,oe.LBL_SETTLEMENT_UNLOCK)
B.drawHBox(c,B.sprites.tab,se)
n+=B.button_height+Oe
var _=g[E]
var u=36
var d=s+i-B.button_height-ne
var f=false
var v=We(1,y/1e3)
if("message"===_.type){n+=2*B.font_height
if(_.title)I(v,He,de,de,o,n,t,2*B.font_height,je.ALIGN.HCENTERFIT,a,null,_.title)
n+=5*B.font_height
if(_.text)je.drawSizedAligned(de,o,n,t,1.5*B.font_height,je.ALIGN.HCENTERFIT|je.ALIGN.HWRAP,a,0,_.text)}else{var h=_.is_recipe?$:w
var p=_.is_recipe?_.recipe_item:_
var m=S({scroll_idx:"settlement",x:o,y0:n,z:t,w:a,h:d-n,style:"unlock",has_stack:false,is_future:true,context:h,inv:p,zoom:v})
f=m.dismiss
if(m.pinnable)if(B.buttonImage({x:o+a-B.button_height,y:n,z:t+2,w:B.button_height,h:B.button_height,img:Se.sprite,frame:Ee(p,h)?Se.PINNED:Se.PIN,tooltip:Te(p,h)}))ye(p,h,ge)}if(T.click({button:2}))f=true
if(B.buttonText({x:o+.25*a,y:d,z:t,w:.5*a,font_height:u,text:E===g.length-1?oe.BTN_OK:Ke[E]||oe.BTN_UNLOCK_MORE3,auto_focus:true})||f){y=0
if(++E===g.length)Ye=null}B.panel({x:o-ne,y:s+B.button_height-ne,z:t-5,w:a+2*ne,h:i-B.button_height+2*ne,color:se})
if(T.click())Ye=null
if(Ye)B.menuUp({z:Z.SETTLEMENT_ANIMATE_COMPLETE-10})}Ye={run:run}}a.register({cmd:"settlement_upgrade_show",help:"(Debug) Show the settlement upgrade complete dialog for a given unlock",func:function func(e,t){if(!e)return void t("Missing key")
settlementAnimateComplete(e)
t()},access_run:["sysadmin"]})
var Ze
function contribute(e,t,r,a,i){N.equal(r.type,z)
var o=e.each_target,n=e.wgctx
var s=slotInfo(t)
var l=s.cost,c=s.key,_=s.subkey
var u=n.settlement,d=n.settlement_id
var f=settlementProgress(u,c,_)
var v=l.count-f
N(v&&v>0,v)
var h=We(We(v,a.count),i)
N(h&&h>0,h)
y(a,r.type+","+r.idx,H+","+t,false)
var p=E(e)
m(p,o[r.type],r.idx,h)
transSettlementProgress(p,u,c,_,h)
Ze=Object.keys(u.unlock_info||{}).length
p.onComplete(function(e){if(!e){var t
var r=Object.keys((null==(t=ce(d))?void 0:t.unlock_info)||{}).length
if(r!==Ze){Ze=r
settlementAnimateComplete(c)}}})}function swapItemSettlement(e,t,r){if(t.type===z&&r.type===H){var a=t
t=r
r=a}if(!(t.type===H&&r.type===z))return false
N(t.type!==r.type||t.idx!==r.idx)
var i=e.each_data[r.type][r.idx]
if(!i)return true
var o=t.idx
N(settlementFitsInSlot(o,i))
contribute(e,o,r,i,Infinity)
return true}function quickTransferSettlement(e,t,r,a){N.equal(t.type,z)
var i=e.wgctx.possible_slots
for(var o=0;o<i.length;++o){var n=i[o]
if(settlementFitsInSlotExact(n,r)){contribute(e,n,t,r,a)
return true}}for(var s=0;s<i.length;++s){var l=i[s]
if(settlementFitsInSlot(l,r)){contribute(e,l,t,r,a)
return true}}return false}function userIdToDisplay(e){var t=Le(e)
return t.display_name||t.user_id}var Xe=.667*100
var Qe=.5*b
var Je=b
var $e=16
var et=750
var tt=224
function drawUnlocks(e,t,r,a,i,o,n,s){var l=a.length
if(l){t-=Oe
var c=Z.UI
var _=e+r/2
var u=Ge(r/(i+Oe))
var d=Fe(0,l-u)
var f
if(d){f=[]
for(var v=0;v<a.length-u+2;++v){var h=a[v]
f.push(oe.separateColon(h.is_recipe?oe.LBL_RECIPE:n,h.getName()))}f=f.join("\n")
a=a.slice(-u)
l=u}var p=_-(l*i+Oe*(l-1))/2
var m=p
var g=p+l*(i+Oe)
if(o)je.drawSizedAligned(fe,p,t,c,xe,je.ALIGN.HRIGHT|je.ALIGN.VCENTER,0,i,oe.separateColon(o,""))
for(var E=0;E<l;++E){if(d&&!E)B.label({style:fe,x:p,y:t,z:c,size:xe,align:je.ALIGN.HVCENTERFIT,w:2*i+Oe,h:i,text:oe.SETTLEMENT_OTHER.$({val:d+2}),tooltip:f,tooltip_width:400})
else if(d&&1===E);else{var y=a[E]
if(K({x:p,y:t,z:c,w:i,h:i,draw_only_mouseover:true,rollover_quiet:true,no_bg:true,shrink:1,hide_count:true,tooltip:oe.separateColon(y.is_recipe?oe.LBL_RECIPE:n,y.getName())+"\n"+le(oe.INPUT_CLICK,oe.LBL_VIEW_INFO),tooltip_width:400},y))J({x:e>et?m-Q-$e:g,y:0,inv:y.is_recipe?y.recipe_item:y,context:y.is_recipe?$:w,auto_close:true,is_future:s})}p+=i+Oe}t+=i+Oe}return t}function settlementEditRun(e,t,c,_){N(c)
var r=c.wgid,y=c.is_unbound
var a=r
var T=Z.UI
var u=ie()===te
if(Ye)if(qe<M.frame_index-1)Ye=null
else{C.setAspectFixed(1e3,1e3)
Ye.run()
ae()}var I=M.DEBUG&&false
var i=re()-e
var S=ce(a)
if(!S){je.drawSizedAligned(fe,e,t,T,2*B.font_height,je.ALIGN.HVCENTER|je.ALIGN.HWRAP,i,2*(1e3-t)/3,oe.ERR_SETTLEMENT_OUT_OF_RANGE)
return}var o={settlement_id:a,settlement:S}
var A=S.unlock_info||{}
var w=S.tier
var L=w+1
var m=o.possible_slots=[]
var R=.75*B.button_height
var g=V({wgctx:o})
var E=W()
var x=W()
function doCost(e,t,r,a){var i=ke[a].cost
var o=Object.keys(i)
o.sort()
var n=o.length
var s=e+r/2-(n*(b+$e)+Oe*(n-1))/2
var l=s-$e-Oe
var c=s+(b+$e+Oe)*n
Ie("required_items_before",F(E,s,t))
for(var _=0;_<n;++_){var u=o[_]
var d=i[u]
var f=settlementProgress(S,a,u)
var v=a+","+u
var h={ctx:g,inv_type:H,ii:v,x:s+$e/2,y:t,z:T,slot_w:b,no_quickbar:true,quick_transfer_cb:null,accepts_item_cb:acceptsItemSettlement,swap_cb:swapItemSettlement,empty_inv:d,allow_empty_select:true,count_override:f+" / "+d.count,disabled:f===d.count||y,label_style:he}
if(h.disabled){h.draw_only=true
h.no_bg=true
K(h,d)}else{m.push(v)
if(q(h)){var p=acceptsItemSettlement(g,{type:H,idx:v},{})
J({x:s>et?l-Q:c,y:0,inv:d,context:$,auto_close:true,hint:p?oe.SETTLEMENT_DRAG_ITEMS:null})}}je.drawSizedAligned(pe,s,t+b+4,T,be,je.ALIGN.HCENTERFIT,b+$e,0,d.getName())
s+=b+$e+Oe}Ie("required_items_after",F(x,s,t))
return t+(b+4+be+Oe)}function doTier(e,t,r,a){if(I)B.drawRect(e,t,e+r,t+a,T,[1,0,0,.25])
var i=e+r/2
var o=t
var n=Pe[w]||{}
if(w){He.drawSizedAligned(ve,e,o,T,Ce,je.ALIGN.HCENTERFIT,r,0,oe.separateColon(oe.$(oe.LBL_TIER_NUMBER,w),n.name))
o+=Ce
var s=A["tier"+w]
if(s){var l=Fe(0,U.seconds()-s.time)
var c=Le(s.user_id)
var _=c.display_name||c.user_id
var u=je.drawSizedAligned(pe,e,o,T,xe,je.ALIGN.HCENTERFIT,r,0,l<60?oe.$(oe.SETTLEMENT_UNLOCKED_JUST_NOW,_):oe.$(oe.SETTLEMENT_UNLOCKED_TIME_AGO,G(l),_))
var d={key:"unlock_time",def:P,x:e+(r-u)/2,y:o,w:u,h:xe}
if(k(d).focused){var f=U.toSS2020(Be().created)
var v=G(s.time-f,true)
d.tooltip=oe.$(oe.SETTLEMENT_UNLOCKED_AFTER_CREATION,v)
if(s.users)d.tooltip+="\n\n"+oe.addColon(oe.LBL_ADDITIONAL_CONTRIBUTORS)+"\n  "+s.users.map(userIdToDisplay).join("\n  ")
B.drawTooltipBox(d)}o+=xe+Oe}var h=S.radius,p=S.unlocks
je.drawSizedAligned(fe,e,o,T,xe,je.ALIGN.HCENTERFIT,r,0,oe.separateColon(oe.LBL_SETTLEMENT_SIZE,2*h))
o=drawUnlocks(e,o+=xe+Oe,r,p,Qe,null,oe.LBL_UNLOCKED_INDUSTRY)}else o+=40
o+=10
var m=Pe[L]
if(m){if(w)o=Me(i,o,Ne)+10
var g={type:j,id:-1,attr1:m.key}
if(!y&&B.buttonImage({x:e+r-R-Oe,y:o,z:T,w:R,h:R,img:Se.sprite,frame:Ee(g,ee)?Se.PINNED:Se.PIN,tooltip:Te(g,ee)}))ye(g,ee,ge)
He.drawSizedAligned(ve,e+R+Oe,o,T,Ce,je.ALIGN.HCENTERFIT,r-2*(R+Oe),0,oe.separateColon(w?oe.LBL_NEXT_TIER:oe.LBL_FIRST_UPGRADE,m.name))
o+=Ce
if(!w||D.split_waygate){o+=Oe
je.drawSizedAligned(fe,e,o,T,xe,je.ALIGN.HCENTERFIT,r,0,oe.addColon(oe.LBL_REQUIRES))
o+=xe}o=doCost(e,o,r,"tier"+L)
if(m.unlocks){o+=Oe
je.drawSizedAligned(fe,e,o,T,xe,je.ALIGN.HCENTERFIT,r,0,oe.addColon(oe.LBL_UNLOCKS))
o=drawUnlocks(e,o+=xe,r,m.unlock_items,Je,null,oe.LBL_UNLOCKS_INDUSTRY,true)}var E=m.radius-n.radius
if(E)je.drawSizedAligned(fe,e,o,T,xe,je.ALIGN.HCENTERFIT,r,0,oe.separateColon(oe.LBL_SETTLEMENT_SIZE,"+"+2*E))}}function doUpgrades(e,t,r,a){if(I)B.drawRect(e,t,e+r,t+a,T,[0,1,0,.25])
var i=e+r/2
var o=false
var n=S.availableUpgrades()
for(var s=0;s<n.length;++s){var l=n[s]
var c=l.name,_=l.key,u=l.radius_add,d=l.unlock_items
if(o)t=Me(i,t,Ne)
else if(n.length<2){je.drawSizedAligned(fe,e,t,T,xe,je.ALIGN.HCENTERFIT,r,0,oe.LBL_OPTIONAL_UPGRADES)
t+=xe+Oe}o=true
var f={type:j,id:-1,attr1:l.key}
if(!y&&B.buttonImage({x:e+r-R-Oe,y:t,z:T,w:R,h:R,img:Se.sprite,frame:Ee(f,ee)?Se.PINNED:Se.PIN,tooltip:Te(f,ee)}))ye(f,ee,ge)
He.drawSizedAligned(ve,e+R+Oe,t,T,Ce,je.ALIGN.HCENTERFIT,r-2*(R+Oe),0,c)
t=doCost(e,t+=Ce,r,_)
if(u){je.drawSizedAligned(fe,e,t,T,xe,je.ALIGN.HCENTERFIT,r,0,oe.separateColon(oe.LBL_SETTLEMENT_SIZE,"+"+2*u))
t+=xe+Oe}if(d)t=drawUnlocks(e,t,r,d,Je,oe.LBL_UNLOCKS,"",true)}if(!o){t+=2*Ce
je.drawSizedAligned(pe,e,t,T,Ce,je.ALIGN.HCENTERFIT,r,0,oe.SETTLEMENT_NO_OPT_UPGRADES)
t+=Ce+Oe
if(w<2)je.drawSizedAligned(pe,e+Oe,t,T,xe,je.ALIGN.HCENTERFIT|je.ALIGN.HWRAP,r-2*Oe,0,oe.SETTLEMENT_FIRST_INCREASE_TIER)}}function doInventory(e,t,r,a){if(_){je.drawSizedAligned(pe,e,t,T,xe,je.ALIGN.HVCENTERFIT,r,a,y?oe.SETTLEMENT_VISIT_WG_IN_WORLD_UNBOUND:oe.SETTLEMENT_VISIT_WG_IN_WORLD)
return}if(I)B.drawRect(e,t,e+r,t+a,T,[0,0,1,.25])
if(y){var i=.618*r
var o=e+(r-i)/2
var n=t
B.drawLine(o,n,o+i,n,T,1,1,ue)
n+=2*Oe
n+=je.drawSizedAligned(fe,e,n,T,xe,je.ALIGN.HCENTER|je.ALIGN.HWRAP,r,a,oe.$(oe.SETTLEMENT_HOME_UNBOUND,Ae))
n+=2*Oe
var s=.75*B.button_width
if(B.buttonText({x:e+(r-s)/2,y:n,z:T,w:s,text:oe.BTN_SETTLEMENT_SET_AS_HOME,font_height:xe}))we("home",c.wgid)
return}var l=e
if(u){ze.draw({x:l,y:t,z:T,w:Xe,h:Xe,frame:Se.INVENTORY})
l+=Xe+Oe}else l+=Oe
B.drawLine(l,t,l+.618*(e+r-l),t,T,1,1,ue)
Y({ctx:g,inv_type:z,no_quickbar:true,final:true,no_buttons:true,x0:l,y:t+Oe,z:T,scale:1,quick_transfer_cb:quickTransferSettlement,accepts_item_cb:acceptsItemSettlement,swap_cb:swapItemSettlement,hide_trash:!u})}var n=e
var s=t
var l=n+i/2
if(u){var d=1e3-t-tt
if(0===w)doTier(l-et/2,s,et,d)
else{doTier(n,s,et,d)
var f=.618*d
var v=s+(d-f)/2
B.drawLine(l,v,l,v+f,T,1,1,ue)
doUpgrades(n+i/2,s,et,d)}doInventory(n,s+d,i,tt)}else{var h=(1600-t-tt-8)/2
var p=n+(i-et)/2
var O=s
doTier(p,s,et,h)
O=Me(l,O+=h,Ne)
if(w>0)doUpgrades(p,O,et,h)
doInventory(n,O+=h,i,tt)}X()}},{"../common/ids":198,"../glov/client/camera2d.js":241,"../glov/client/cmds.js":244,"../glov/client/engine.js":250,"../glov/client/input.js":271,"../glov/client/settings.js":291,"../glov/client/spot.js":300,"../glov/client/ui.js":306,"../glov/client/walltime.js":308,"../glov/common/util.js":330,"../glov/common/vmath":332,"./analytics.js":5,"./factory_ui.js":79,"./inventory.js":94,"./inventory_ui.js":95,"./item_info_view.js":97,"./items.js":98,"./layout.js":99,"./localization/localization":108,"./menu.js":117,"./settlement.js":148,"./styles.js":160,"./todo_list.js":165,"./tutorial.js":166,"./ui_util.js":168,"./user_data.js":170,"./user_info_view.js":171,"./waygate_ui.js":179,"./waygate_upgrade.js":180,"./world_metadata.js":186,"./worlds_sound.js":187,assert:void 0}],150:[function(e,t,r){"use strict"
r.isShareButtonInColumn=isShareButtonInColumn
r.shareButton=shareButton
r.shareMenu=shareMenu
var v=e("./localization/localization").L
var i=e("./build_mode.js").doingDragPlace
var o=e("../glov/client/camera2d.js")
var h=e("../glov/client/engine.js")
var a=e("./fbinstant_worlds.js"),p=a.fbInviteAsync,m=a.fbShareWorld,g=a.fbShareWorldLink
var E=e("../glov/client/input.js")
var y=E.mouseDownAnywhere,T=E.mouseDownOverBounds
var n=e("./layout.js")
var I=e("./analytics.js").logEvent
var s=n.CORNER_BUTTON_MARGIN,S=n.SHAREMENU_BORDER_PAD,A=n.SHAREMENU_CONTENT_PAD,w=n.SHAREMENU_BUTTON_W,L=n.SHAREMENU_BUTTON_H,R=n.menuUpperLeft
var x=e("./main.js")
var O=e("./menu.js")
var l=e("../glov/client/net.js")
var c=e("../common/photo_common.js").PHT_IMG_KEYS
var _=e("./photo_mode.js"),u=_.errorModalDialog,d=_.setImageUploadFalse,f=_.photoCapture,b=_.validatePhotoCapture
var N=e("./prop_edit.js").savingMessage
var C=e("./quickbar.js"),M=C.quickbarX1,D=C.quickbar_colors_selected
var P=e("../glov/client/ui.js")
var k=e("../glov/client/urlhash.js")
var B=e("./ui_util.js")
var U=e("./world_comm.js"),G=U.getWorldChannel,F=U.getWorldID
var W=e("./platform_share_urls.js").getPlatformWorldShareLink
var j={in_event_cb:E.pointerLockEnter}
var H=false
var z
var V
var Y
function shareMenuPhotoCapture(o){x.menuExit()
f(false,function(e,t){if(b(e,o,t)){var r=x.char_controller
var a=l.client.pak("photo_create")
a.writeAnsiString(o)
a.writeAnsiString(r.getPosString())
for(var i=0;i<c.length;i++){a.writeInt(t[c[i]].id)
a.writeInt(t[c[i]].w)
a.writeInt(t[c[i]].h)}a.send(function(e,t){d()
if(e||!G())u(v.DLG_ERROR_IMAGE_UPLOAD_TITLE,e||v.ERR_WORLD_DISCONNECTED)
else{N(v.STATUSMSG_PHOTO_SAVED)
P.modalDialogClear()
k.set("photo",t)
x.toggleMenuPage(O.PHOTO_VIEW,t)}})}})}function isShareButtonInColumn(){return n.quickbarOnTop()&&!(o.x1()-M()>=2*(s+P.button_height))}function shareButton(){var e=s+P.button_height
if(n.quickbarOnTop()){V=o.w()-2*e
Y=0
if(o.x1()-M()<2*e){V+=e
Y+=e}}else{V=R()?s+e:o.w()-2*e
Y=0}if(!H){var t={x:V,y:Y,z:Z.MENUBUTTON,img:B.sprite,frame:B.SHARE,shrink:.7,colors:D,disabled:false,tooltip:v.LBL_SHARE_MENU}
if(!h.defines.NOUI&&!(i()&&E.touch_mode)&&P.buttonImage(t)){H=true
z=h.frame_index}var r=!E.touch_mode&&!E.pointerLocked()?j:null
if(E.keyDownEdge(E.KEYS.F9,r)){var a=F()
I("enter_photo_mode_button",1,"button")
shareMenuPhotoCapture(a)}}}function shareMenu(){if(!H)return
var e=Boolean(window.FBInstant)
var t=w+2*S
var r=2*S+2*(A+L)+(e?2:0)*(A+L)
var a=R()?V:V-t+P.button_height
var i=Y
var o=a+t/2-w/2
var n=i+S
var s=!E.touch_mode?j:null
if(P.buttonText({x:o,y:n,z:Z.POPUP_MENU,w:w,h:L,text:O.prefixShortcutKey("F9",v.BTN_TAKE_PHOTO),in_event_cb:s&&s.in_event_cb,auto_focus:true})){var l=F()
I("enter_photo_mode_button",1,"button")
shareMenuPhotoCapture(l)
H=false}n+=L+A
if(P.buttonText({x:o,y:n,z:Z.POPUP_MENU,w:w,h:L,text:v.BTN_GET_WORLD_LINK})){var c=F()
if(window.FBInstant)g(c)
else{var _=W(c)
P.provideUserString(v.DLG_SHARE_TITLE,_)
I("share_link",1,null,String(c))}H=false}n+=L+A
if(e){if(P.buttonText({x:o,y:n,z:Z.POPUP_MENU,w:w,h:L,text:v.BTN_INVITE_TO_WORLD})){p(F())
H=false}n+=L+A
if(P.buttonText({x:o,y:n,z:Z.POPUP_MENU,w:w,h:L,text:v.BTN_SHARE_WORLD})){m(F())
H=false}}var u={x:a,y:i,w:t,h:r}
E.drag(u)
var d=false
var f=h.frame_index!==z
if(f&&!T(u)&&y())d=true
if(f&&x.chat_ui.isFocused())d=true
if(f&&E.click({peek:true})||E.keyDownEdge(E.KEYS.ESC)||E.padButtonDownEdge(E.PAD.B)||d)H=false
P.panel({x:a,y:i,z:Z.POPUP_MENU-1,w:t,h:r,pixel_scale:.5,color:O.panel_color_popup})}},{"../common/photo_common.js":204,"../glov/client/camera2d.js":241,"../glov/client/engine.js":250,"../glov/client/input.js":271,"../glov/client/net.js":279,"../glov/client/ui.js":306,"../glov/client/urlhash.js":307,"./analytics.js":5,"./build_mode.js":27,"./fbinstant_worlds.js":80,"./layout.js":99,"./localization/localization":108,"./main.js":112,"./menu.js":117,"./photo_mode.js":128,"./platform_share_urls.js":130,"./prop_edit.js":140,"./quickbar.js":142,"./ui_util.js":168,"./world_comm.js":182}],151:[function(e,t,u){"use strict"
u.getSkyPropsTime=getSkyPropsTime
u.skyGetTorchColors=skyGetTorchColors
u.skyGetSunBrightness=skyGetSunBrightness
u.skyStartupEarly=skyStartupEarly
u.skyStartup=skyStartup
u.skyEdit=skyEdit
u.skyTick=skyTick
u.skyShift=skyShift
u.skyReinit=skyReinit
u.skyDraw=skyDraw
u.sky_props=u.fog_color=u.fog_params=u.skytime_value=u.day_idx=void 0
var d=600
var f=3
var v=24/(1e3*d)
var I=e("assert")
var r=e("../glov/client/cmds").cmd_parse
var m=e("../glov/client/color_picker").colorPicker
var S=e("../glov/client/engine")
var a=e("../glov/client/engine").addViewSpaceGlobal
var i=e("../glov/client/filewatch").filewatchOn
var g=e("../glov/client/font")
var o=e("../glov/client/hsv").hsvToRGB
var E=e("../glov/client/input")
var n=e("../glov/client/models")
var s=e("../glov/client/quat")
var l=s.qFromAxisAngle
var c=s.quat
var _=s.unit_quat
var h=e("../glov/client/shaders")
var y=e("../glov/client/slider").slider
var p=e("../glov/client/textures")
var T=e("../glov/client/ui")
var A=e("../glov/client/walltime")
var w=e("../glov/client/webfs").webFSGetFile
var L=e("../glov/common/util")
var R=L.clamp
var x=L.cloneShallow
var O=L.easeIn
var b=L.lerp
var N=L.ridx
var C=e("../glov/common/vmath")
var M=C.mat4
var D=C.v2distSq
var P=C.v3add
var k=C.v3addScale
var B=C.v3copy
var U=C.v3distSq
var G=C.v3iAdd
var F=C.v3iMul
var W=C.v3iNormalize
var j=C.v3iSub
var H=C.v3lerp
var z=C.v3mul
var V=C.v3mulMat4
var Y=C.v3pow
var q=C.v3scale
var K=C.v3set
var X=C.vec1
var Q=C.vec3
var J=C.vec4
var $=C.zaxis
var ee=C.zero_vec
var te=e("../common/globals").CHUNK_SIZE
var re=e("./camera")
var ae=re.getCurrentCameraTargetDir
var ie=re.getCurrentCameraUnderwater
var oe=e("./main")
var ne=e("./main").charControllerPos
var se=e("./photo_mode").getPhotoTime
var le=e("./styles").label_style
var ce=e("./user_data")
var _e=ce.BLOOD_MOON_MOD
var ue=ce.setStaminaUsageScaleMod
var de=e("./voxel_chunk_manager")
var fe=e("./voxel_data")
var ve=e("./voxel_data_xraw").loadXRAW
var he=e("./world_metadata")
var pe=he.adventureMode
var me=he.worldMetadata
var ge=Math.cos,Ee=Math.ceil,ye=Math.floor,Te=Math.max,Ie=Math.min,Se=Math.PI,Ae=Math.pow,we=Math.random,Le=Math.round,Re=Math.sin,xe=Math.sqrt
var Oe=2*Se
var be
var Ne=-1
var Ce=[]
var Me=0
u.day_idx=Me
r.registerValue("day_idx",{help:"(Admin) Show the current day index",access_run:["sysadmin"],get:function get(){return Me}})
var De=0
u.skytime_value=De
r.registerValue("skytime_value",{help:"(Admin) Show the current skytime value (floating point day)",access_run:["sysadmin"],get:function get(){return De}})
var Pe=1
r.registerValue("skytime_scale",{help:"(Admin) (Client-only) Scale the global skytime rate",access_run:["sysadmin"],type:r.TYPE_FLOAT,range:[0,1e3],get:function get(){return Pe},set:function set(e){Pe=e}})
var ke={}
var Be
var Ue=[]
var Ge
var Fe
var We
var je=Q()
var He=Q()
var ze=Q()
var Ve=Q()
var Ye=J()
var qe=J()
var Ke=J()
var Ze=J()
var Xe={sky_colortop_diskmul:Ye,sky_colormid_weight:qe,sky_colorsun_diskadd:Ke,sky_colorglow_fade:Ze,camera_pos_ws:Ve,sun_vec_vs:ze}
var Qe=1
var Je=Q()
u.fog_params=Je
var $e=X()
var et=Q()
var tt=Q()
var rt=Q()
var at=Q(0,0,-1)
var it=Q(1,0,0)
var ot=Q()
function colorToText(e){var t=[]
for(var r=0;r<3;++r)t.push(("0"+Le(255*e[r]).toString(16)).slice(-2))
return t.join("")}function colorFromText(e,t){if(3!==t.length&&6!==t.length)return e
var r=2
var a=255
if(3===t.length){r=1
a=15}for(var i=0;i<3;++i)e[i]=parseInt(t.slice(i*r,(i+1)*r),16)/a
return e}var nt=Q(0,0,0)
u.fog_color=nt
var st=Q(0,0,0)
var lt={sun_pos:Q(),light_dir_ws:Q(0,0,1)}
u.sky_props=lt
function getRawTime(){var e
var t=me()||{}
var r=t.time_offs||0
var a=null!=(e=t.time_scale)?e:1
var i=A()*v*a+r
var o=ye(i/24)
return R(i-24*o,0,23.9999)}var ct=0
r.register({cmd:"nextday",help:"(Hidden)(Client only) Advance to the next day",access_show:["sysadmin"],func:function func(e,t){ct++
return t(null,"Day advanced")}})
function parseTime(e){var t=Number(e)
if(isFinite(t))return t
return{midnight:0,dawn:4.5,sunrise:5,day:8,noon:12,midday:12,sunset:19,dusk:20.2,night:22}[e]}r.register({cmd:"time",help:"Set or display current time",func:function func(e,t){var r=me()
if(!r)return t("Not currently in a world")
if(e){var a=parseTime(e)
if(void 0===a)return t("Usage: /time [0-24]")
var i=getRawTime()
if(a<i)a+=24
var o=a-i
var n=r.time_offs+o
while(n>=24)n-=24
oe.chat_ui.cmdParse("world_time_offs "+n)
return t()}else return t(null,"time = "+lt.time.toFixed(3))}})
r.register({cmd:"time_scale",help:"Set or display current time scale",func:function func(e,t){var r=me()
if(!r)return t("Not currently in a world")
if(e){var a=Number(e)
if(!isFinite(a)||a<0||a>1e3)return t("Usage: /time_scale [SCALE 0-100 (default 1)]")
var i=A()
var o=getRawTime()-i*v*a%24
if(o<0)o+=24
oe.chat_ui.cmdParse("world_time_scale "+a+" "+o)
return t()}else{var n=24/(r.time_scale*v*60*1e3)
return t(null,"time_scale = "+r.time_scale.toFixed(3)+" (1 game day = "+n.toFixed(0)+" minutes)")}}})
var _t={latitude:{def:45*Se/180,range:[0,Se/2],radians:true,interp:false},axial_tilt:{def:23.5*Se/180,range:[0,Se/2],radians:true,interp:false},solar_orbit:{def:0,range:[0,Oe],radians:true,interp:false},time:{def:10,range:[0,24],interp:false},time_scale:{def:1,range:[0,100],interp:false,gamma:true},torch_hue_min:{def:10,range:[0,360]},torch_hue_max:{def:50,range:[0,360]},torch_hue_freq:{def:78e-5,range:[0,.01]},torch_value_min:{def:.9,range:[0,1]},torch_value_max:{def:1,range:[0,1]},torch_value_freq:{def:.008,range:[0,.01]},torch_sat:{def:.2,range:[0,1]},torch_color_top:{def:[1,.7,.7],color:true,gamma:true},torch_color_bot:{def:[.65,.65,1],color:true,gamma:true},light_sun_key:{def:[.8,.8,.65],color:true,gamma:true},light_sun_top:{def:[.1,.1,.1],color:true,gamma:true},light_sun_back:{def:[.2,.2,.45],color:true,gamma:true},fog_extinction:{def:45e-5,range:[0,.02],gamma:true},fog_inscattering:{def:1e-4,range:[0,.02],gamma:true},fog_start_dist:{def:200,range:[0,1e3]},sun_disk_radius:{def:.25,range:[0,1]},sun_color:{def:[1,1,1],color:true},sun_disk_intensity:{def:8,range:[0,16]},sun_glow:{def:[0,0,0],color:true},color_top:{def:[.12,.28,.56],color:true},color_mid:{def:[.68,1,1],color:true},color_mid_weight:{def:2,range:[1,10]},moon_color:{def:[1,1,1],color:true},moon_scale:{def:1,range:[0,4]}}
var ut=Object.keys(_t).filter(function(e){return false!==_t[e].interp})
var dt={color:false}
function getSkyPropsTime(){return lt.time}function skyGetTorchColors(e,t,r){var a=(lt.torch_value_min+lt.torch_value_max)/2+(lt.torch_value_max-lt.torch_value_min)/2*Re(S.frame_timestamp*lt.torch_value_freq)
var i=(lt.torch_hue_min+lt.torch_hue_max)/2+(lt.torch_hue_max-lt.torch_hue_min)/2*Re(S.frame_timestamp*lt.torch_hue_freq+77)
o(t,i,lt.torch_sat,a)
z(e,t,lt.torch_color_top)
z(r,t,lt.torch_color_bot)}function skyGetSunBrightness(){return Te(et[0],et[1],et[2],tt[0],tt[1],tt[2])}var ft
function updateDayIdx(){var e=me()||{time_offs:0,time_scale:1}
var t=e.time_offs,r=e.time_scale,a=e.created
var i=A()
var o=i*v*r+t
var n=ye(o/24)
if(S.defines.SKYEDIT||1!==Pe){if(ft!==S.frame_index-1){if(me()){lt.time_scale=r
lt.time=R(o-24*n,0,23.9999)
ft=S.frame_index}}else ft=S.frame_index
var s=S.frame_dt
lt.time+=s*v*Pe*lt.time_scale
if(lt.time>=24){lt.time-=24
u.day_idx=Me+=1}u.skytime_value=De=Me+lt.time/24}else{lt.time=getRawTime()
if(1===r&&0===t){var l=Ee(a/(1e3*d)+17/24+f)*d*1e3
if(i<l){var c=1-(l-(i=Te(a,i)))/(1e3*d)
lt.time=Te(10,24*c)}}var _=i*v
u.skytime_value=De=_/24+ct
u.day_idx=Me=ye(De)}}function skyLoad(e){var t=w("skies/"+e,"jsobj")
for(var r in t){var a=t[r]
for(var i=1;i<a.length;i+=2){var o=a[i]
if(Array.isArray(o)){I.equal(o.length,3)
a[i]=Q(o[0],o[1],o[2])}}}ke[e]=t}function skyReload(e){skyLoad(e.match(/skies\/(.*)/)[1])
Ne=-1
Ce=[]}function skyStartupEarly(){h.addGlobal("fog_params",Je)
h.addGlobal("fog_color",nt)
h.addGlobal("sun_glow",st)
h.addGlobal("minimum_ambient",$e)
h.addGlobal("light_sun_key",et)
h.addGlobal("light_sun_top",tt)
h.addGlobal("light_sun_back",rt)
h.addGlobal("light_dir_top_ws",at)
a("light_dir_top")
h.addGlobal("light_dir_back_ws",ot)
a("light_dir_back")
h.addGlobal("pos_x_ws",it)
a("pos_x")}function skyStartup(){Be=ve("moon.vm",x(w("model_opts/moon","jsobj")))
Ue.push(fe.loadGoxel("# Goxel 0.8.3\r\n# One line per voxel\r\n# X Y Z RRGGBB\r\n-5 0 -2 d8eaf2\r\n-4 0 -2 d8eaf2\r\n-3 0 -2 d8eaf2\r\n-5 1 -2 d8eaf2\r\n-4 1 -2 d8eaf2\r\n-3 1 -2 d8eaf2\r\n-6 0 -1 d8eaf2\r\n-5 0 -1 d8eaf2\r\n-4 0 -1 d8eaf2\r\n-3 0 -1 d8eaf2\r\n-2 0 -1 d8eaf2\r\n-1 0 -1 d8eaf2\r\n-5 1 -1 d8eaf2\r\n-4 1 -1 d8eaf2\r\n-3 1 -1 d8eaf2\r\n-1 1 -1 d8eaf2\r\n-6 0 0 d8eaf2\r\n-5 0 0 d8eaf2\r\n-4 0 0 d8eaf2\r\n-3 0 0 d8eaf2\r\n-2 0 0 d8eaf2\r\n-1 0 0 d8eaf2\r\n-5 1 0 d8eaf2\r\n-4 1 0 d8eaf2\r\n-3 1 0 d8eaf2\r\n-1 1 0 d8eaf2\r\n-5 0 1 d8eaf2\r\n-4 0 1 d8eaf2\r\n-3 0 1 d8eaf2\r\n-5 1 1 d8eaf2\r\n-4 1 1 d8eaf2\r\n-3 1 1 d8eaf2\r\n-5 -2 -2 d8eaf2\r\n-4 -2 -2 d8eaf2\r\n-3 -2 -2 d8eaf2\r\n-5 -1 -2 d8eaf2\r\n-4 -1 -2 d8eaf2\r\n-3 -1 -2 d8eaf2\r\n-1 -4 -1 d8eaf2\r\n-1 -3 -1 d8eaf2\r\n-6 -2 -1 d8eaf2\r\n-5 -2 -1 d8eaf2\r\n-4 -2 -1 d8eaf2\r\n-3 -2 -1 d8eaf2\r\n-1 -2 -1 d8eaf2\r\n-6 -1 -1 d8eaf2\r\n-5 -1 -1 d8eaf2\r\n-4 -1 -1 d8eaf2\r\n-3 -1 -1 d8eaf2\r\n-2 -1 -1 d8eaf2\r\n-1 -1 -1 d8eaf2\r\n0 -3 -2 d8eaf2\r\n1 -3 -2 d8eaf2\r\n0 -2 -2 d8eaf2\r\n1 -2 -2 d8eaf2\r\n0 -4 -1 d8eaf2\r\n1 -4 -1 d8eaf2\r\n2 -4 -1 d8eaf2\r\n0 -3 -1 d8eaf2\r\n1 -3 -1 d8eaf2\r\n2 -3 -1 d8eaf2\r\n0 -2 -1 d8eaf2\r\n1 -2 -1 d8eaf2\r\n2 -2 -1 d8eaf2\r\n0 -1 -1 d8eaf2\r\n1 -1 -1 d8eaf2\r\n2 -1 -1 d8eaf2\r\n-1 -4 0 d8eaf2\r\n-1 -3 0 d8eaf2\r\n-6 -2 0 d8eaf2\r\n-5 -2 0 d8eaf2\r\n-4 -2 0 d8eaf2\r\n-3 -2 0 d8eaf2\r\n-1 -2 0 d8eaf2\r\n-6 -1 0 d8eaf2\r\n-5 -1 0 d8eaf2\r\n-4 -1 0 d8eaf2\r\n-3 -1 0 d8eaf2\r\n-2 -1 0 d8eaf2\r\n-1 -1 0 d8eaf2\r\n-1 -3 1 d8eaf2\r\n-5 -2 1 d8eaf2\r\n-4 -2 1 d8eaf2\r\n-3 -2 1 d8eaf2\r\n-1 -2 1 d8eaf2\r\n-5 -1 1 d8eaf2\r\n-4 -1 1 d8eaf2\r\n-3 -1 1 d8eaf2\r\n0 -4 0 d8eaf2\r\n1 -4 0 d8eaf2\r\n2 -4 0 d8eaf2\r\n0 -3 0 d8eaf2\r\n1 -3 0 d8eaf2\r\n2 -3 0 d8eaf2\r\n0 -2 0 d8eaf2\r\n1 -2 0 d8eaf2\r\n2 -2 0 d8eaf2\r\n0 -1 0 d8eaf2\r\n1 -1 0 d8eaf2\r\n2 -1 0 d8eaf2\r\n0 -4 1 d8eaf2\r\n1 -4 1 d8eaf2\r\n0 -3 1 d8eaf2\r\n1 -3 1 d8eaf2\r\n2 -3 1 d8eaf2\r\n0 -2 1 d8eaf2\r\n1 -2 1 d8eaf2\r\n2 -2 1 d8eaf2\r\n0 -1 1 d8eaf2\r\n1 -1 1 d8eaf2\r\n0 0 -2 d8eaf2\r\n1 1 -2 d8eaf2\r\n2 1 -2 d8eaf2\r\n1 2 -2 d8eaf2\r\n2 2 -2 d8eaf2\r\n0 0 -1 d8eaf2\r\n1 0 -1 d8eaf2\r\n2 0 -1 d8eaf2\r\n0 1 -1 d8eaf2\r\n1 1 -1 d8eaf2\r\n2 1 -1 d8eaf2\r\n3 1 -1 d8eaf2\r\n0 2 -1 d8eaf2\r\n1 2 -1 d8eaf2\r\n2 2 -1 d8eaf2\r\n3 2 -1 d8eaf2\r\n1 3 -1 d8eaf2\r\n2 3 -1 d8eaf2\r\n0 0 0 d8eaf2\r\n1 0 0 d8eaf2\r\n2 0 0 d8eaf2\r\n0 1 0 d8eaf2\r\n1 1 0 d8eaf2\r\n2 1 0 d8eaf2\r\n3 1 0 d8eaf2\r\n0 2 0 d8eaf2\r\n1 2 0 d8eaf2\r\n2 2 0 d8eaf2\r\n3 2 0 d8eaf2\r\n1 3 0 d8eaf2\r\n2 3 0 d8eaf2\r\n3 3 0 d8eaf2\r\n0 0 1 d8eaf2\r\n1 1 1 d8eaf2\r\n2 1 1 d8eaf2\r\n3 1 1 d8eaf2\r\n1 2 1 d8eaf2\r\n2 2 1 d8eaf2\r\n3 2 1 d8eaf2\r\n"))
Ue.push(fe.loadGoxel("# Goxel 0.8.3\r\n# One line per voxel\r\n# X Y Z RRGGBB\r\n-5 -4 -2 d8eaf2\r\n-4 -4 -2 d8eaf2\r\n-3 -4 -2 d8eaf2\r\n-5 -3 -2 d8eaf2\r\n-4 -3 -2 d8eaf2\r\n-3 -3 -2 d8eaf2\r\n-2 -3 -2 d8eaf2\r\n-5 -2 -2 d8eaf2\r\n-4 -2 -2 d8eaf2\r\n-3 -2 -2 d8eaf2\r\n-2 -2 -2 d8eaf2\r\n-4 -1 -2 d8eaf2\r\n-3 -1 -2 d8eaf2\r\n-2 -1 -2 d8eaf2\r\n-1 -1 -2 d8eaf2\r\n-4 -5 -1 d8eaf2\r\n-3 -5 -1 d8eaf2\r\n-5 -4 -1 d8eaf2\r\n-4 -4 -1 d8eaf2\r\n-3 -4 -1 d8eaf2\r\n-2 -4 -1 d8eaf2\r\n-1 -4 -1 d8eaf2\r\n-6 -3 -1 d8eaf2\r\n-5 -3 -1 d8eaf2\r\n-4 -3 -1 d8eaf2\r\n-3 -3 -1 d8eaf2\r\n-2 -3 -1 d8eaf2\r\n-1 -3 -1 d8eaf2\r\n-5 -2 -1 d8eaf2\r\n-4 -2 -1 d8eaf2\r\n-3 -2 -1 d8eaf2\r\n-2 -2 -1 d8eaf2\r\n-1 -2 -1 d8eaf2\r\n-5 -1 -1 d8eaf2\r\n-4 -1 -1 d8eaf2\r\n-3 -1 -1 d8eaf2\r\n-2 -1 -1 d8eaf2\r\n-1 -1 -1 d8eaf2\r\n0 -1 -2 d8eaf2\r\n1 -1 -2 d8eaf2\r\n0 -2 -1 d8eaf2\r\n0 -1 -1 d8eaf2\r\n1 -1 -1 d8eaf2\r\n-1 0 -2 d8eaf2\r\n-1 1 -2 d8eaf2\r\n-1 2 -2 d8eaf2\r\n-5 0 -1 d8eaf2\r\n-4 0 -1 d8eaf2\r\n-3 0 -1 d8eaf2\r\n-2 0 -1 d8eaf2\r\n-1 0 -1 d8eaf2\r\n-5 1 -1 d8eaf2\r\n-4 1 -1 d8eaf2\r\n-3 1 -1 d8eaf2\r\n-2 1 -1 d8eaf2\r\n-1 1 -1 d8eaf2\r\n-2 2 -1 d8eaf2\r\n-1 2 -1 d8eaf2\r\n-2 3 -1 d8eaf2\r\n-1 3 -1 d8eaf2\r\n0 0 -2 d8eaf2\r\n1 0 -2 d8eaf2\r\n0 1 -2 d8eaf2\r\n1 1 -2 d8eaf2\r\n0 2 -2 d8eaf2\r\n1 2 -2 d8eaf2\r\n0 3 -2 d8eaf2\r\n0 0 -1 d8eaf2\r\n1 0 -1 d8eaf2\r\n0 1 -1 d8eaf2\r\n1 1 -1 d8eaf2\r\n0 2 -1 d8eaf2\r\n1 2 -1 d8eaf2\r\n0 3 -1 d8eaf2\r\n1 3 -1 d8eaf2\r\n-4 -5 0 d8eaf2\r\n-3 -5 0 d8eaf2\r\n-5 -4 0 d8eaf2\r\n-4 -4 0 d8eaf2\r\n-3 -4 0 d8eaf2\r\n-2 -4 0 d8eaf2\r\n-6 -3 0 d8eaf2\r\n-5 -3 0 d8eaf2\r\n-4 -3 0 d8eaf2\r\n-3 -3 0 d8eaf2\r\n-2 -3 0 d8eaf2\r\n-5 -2 0 d8eaf2\r\n-4 -2 0 d8eaf2\r\n-3 -2 0 d8eaf2\r\n-2 -2 0 d8eaf2\r\n-1 -2 0 d8eaf2\r\n-5 -1 0 d8eaf2\r\n-4 -1 0 d8eaf2\r\n-3 -1 0 d8eaf2\r\n-2 -1 0 d8eaf2\r\n-1 -1 0 d8eaf2\r\n-5 -4 1 d8eaf2\r\n-4 -4 1 d8eaf2\r\n-3 -4 1 d8eaf2\r\n-5 -3 1 d8eaf2\r\n-4 -3 1 d8eaf2\r\n-3 -3 1 d8eaf2\r\n-2 -3 1 d8eaf2\r\n-5 -2 1 d8eaf2\r\n-4 -2 1 d8eaf2\r\n-3 -2 1 d8eaf2\r\n-2 -2 1 d8eaf2\r\n-4 -1 1 d8eaf2\r\n-3 -1 1 d8eaf2\r\n-2 -1 1 d8eaf2\r\n-1 -1 1 d8eaf2\r\n0 -2 0 d8eaf2\r\n0 -1 0 d8eaf2\r\n1 -1 0 d8eaf2\r\n0 -1 1 d8eaf2\r\n1 -1 1 d8eaf2\r\n-5 0 0 d8eaf2\r\n-4 0 0 d8eaf2\r\n-3 0 0 d8eaf2\r\n-2 0 0 d8eaf2\r\n-1 0 0 d8eaf2\r\n-5 1 0 d8eaf2\r\n-4 1 0 d8eaf2\r\n-3 1 0 d8eaf2\r\n-2 1 0 d8eaf2\r\n-1 1 0 d8eaf2\r\n-4 2 0 d8eaf2\r\n-3 2 0 d8eaf2\r\n-2 2 0 d8eaf2\r\n-1 2 0 d8eaf2\r\n-2 3 0 d8eaf2\r\n-1 3 0 d8eaf2\r\n-5 0 1 d8eaf2\r\n-4 0 1 d8eaf2\r\n-3 0 1 d8eaf2\r\n-1 0 1 d8eaf2\r\n-4 1 1 d8eaf2\r\n-3 1 1 d8eaf2\r\n-2 1 1 d8eaf2\r\n-1 1 1 d8eaf2\r\n-2 2 1 d8eaf2\r\n-1 2 1 d8eaf2\r\n-1 3 1 d8eaf2\r\n0 0 0 d8eaf2\r\n1 0 0 d8eaf2\r\n0 1 0 d8eaf2\r\n1 1 0 d8eaf2\r\n2 1 0 d8eaf2\r\n0 2 0 d8eaf2\r\n1 2 0 d8eaf2\r\n2 2 0 d8eaf2\r\n0 3 0 d8eaf2\r\n1 3 0 d8eaf2\r\n0 0 1 d8eaf2\r\n1 0 1 d8eaf2\r\n0 1 1 d8eaf2\r\n1 1 1 d8eaf2\r\n0 2 1 d8eaf2\r\n1 2 1 d8eaf2\r\n0 3 1 d8eaf2\r\n1 3 1 d8eaf2\r\n0 1 2 d8eaf2\r\n0 2 2 d8eaf2\r\n"))
Ue.push(fe.loadGoxel("# Goxel 0.8.3\r\n# One line per voxel\r\n# X Y Z RRGGBB\r\n-3 -4 -1 d8eaf2\r\n-1 -4 -1 d8eaf2\r\n-1 -3 -1 d8eaf2\r\n-1 -1 -1 d8eaf2\r\n0 -4 -2 d8eaf2\r\n1 -4 -2 d8eaf2\r\n2 -4 -2 d8eaf2\r\n0 -3 -2 d8eaf2\r\n1 -3 -2 d8eaf2\r\n2 -3 -2 d8eaf2\r\n0 -2 -2 d8eaf2\r\n1 -2 -2 d8eaf2\r\n0 -1 -2 d8eaf2\r\n0 -5 -1 d8eaf2\r\n1 -5 -1 d8eaf2\r\n2 -5 -1 d8eaf2\r\n0 -4 -1 d8eaf2\r\n1 -4 -1 d8eaf2\r\n2 -4 -1 d8eaf2\r\n0 -3 -1 d8eaf2\r\n1 -3 -1 d8eaf2\r\n2 -3 -1 d8eaf2\r\n0 -2 -1 d8eaf2\r\n1 -2 -1 d8eaf2\r\n2 -2 -1 d8eaf2\r\n0 -1 -1 d8eaf2\r\n1 -1 -1 d8eaf2\r\n2 -1 -1 d8eaf2\r\n-4 0 -1 d8eaf2\r\n-3 0 -1 d8eaf2\r\n-1 0 -1 d8eaf2\r\n-1 1 -1 d8eaf2\r\n-1 2 -1 d8eaf2\r\n-2 3 -1 d8eaf2\r\n-1 3 -1 d8eaf2\r\n0 0 -2 d8eaf2\r\n1 0 -2 d8eaf2\r\n2 0 -2 d8eaf2\r\n0 1 -2 d8eaf2\r\n1 1 -2 d8eaf2\r\n2 1 -2 d8eaf2\r\n0 2 -2 d8eaf2\r\n1 2 -2 d8eaf2\r\n0 3 -2 d8eaf2\r\n0 0 -1 d8eaf2\r\n1 0 -1 d8eaf2\r\n2 0 -1 d8eaf2\r\n3 0 -1 d8eaf2\r\n0 1 -1 d8eaf2\r\n1 1 -1 d8eaf2\r\n2 1 -1 d8eaf2\r\n3 1 -1 d8eaf2\r\n0 2 -1 d8eaf2\r\n1 2 -1 d8eaf2\r\n2 2 -1 d8eaf2\r\n0 3 -1 d8eaf2\r\n1 3 -1 d8eaf2\r\n2 3 -1 d8eaf2\r\n-1 -4 0 d8eaf2\r\n-1 -3 0 d8eaf2\r\n-1 -2 0 d8eaf2\r\n-1 -1 0 d8eaf2\r\n0 -5 0 d8eaf2\r\n1 -5 0 d8eaf2\r\n2 -5 0 d8eaf2\r\n0 -4 0 d8eaf2\r\n1 -4 0 d8eaf2\r\n2 -4 0 d8eaf2\r\n0 -3 0 d8eaf2\r\n1 -3 0 d8eaf2\r\n2 -3 0 d8eaf2\r\n0 -2 0 d8eaf2\r\n1 -2 0 d8eaf2\r\n2 -2 0 d8eaf2\r\n0 -1 0 d8eaf2\r\n1 -1 0 d8eaf2\r\n2 -1 0 d8eaf2\r\n0 -4 1 d8eaf2\r\n1 -4 1 d8eaf2\r\n2 -4 1 d8eaf2\r\n0 -3 1 d8eaf2\r\n1 -3 1 d8eaf2\r\n2 -3 1 d8eaf2\r\n0 -2 1 d8eaf2\r\n1 -2 1 d8eaf2\r\n0 -1 1 d8eaf2\r\n1 -1 1 d8eaf2\r\n-4 0 0 d8eaf2\r\n-3 0 0 d8eaf2\r\n-1 0 0 d8eaf2\r\n-1 1 0 d8eaf2\r\n-1 2 0 d8eaf2\r\n-2 3 0 d8eaf2\r\n-1 3 0 d8eaf2\r\n-1 2 1 d8eaf2\r\n0 0 0 d8eaf2\r\n1 0 0 d8eaf2\r\n2 0 0 d8eaf2\r\n3 0 0 d8eaf2\r\n0 1 0 d8eaf2\r\n1 1 0 d8eaf2\r\n2 1 0 d8eaf2\r\n3 1 0 d8eaf2\r\n0 2 0 d8eaf2\r\n1 2 0 d8eaf2\r\n2 2 0 d8eaf2\r\n0 3 0 d8eaf2\r\n1 3 0 d8eaf2\r\n2 3 0 d8eaf2\r\n0 4 0 d8eaf2\r\n1 4 0 d8eaf2\r\n0 0 1 d8eaf2\r\n1 0 1 d8eaf2\r\n2 0 1 d8eaf2\r\n0 1 1 d8eaf2\r\n1 1 1 d8eaf2\r\n2 1 1 d8eaf2\r\n0 2 1 d8eaf2\r\n1 2 1 d8eaf2\r\n2 2 1 d8eaf2\r\n0 3 1 d8eaf2\r\n1 3 1 d8eaf2\r\n"))
Ge=n.load("models/sky/sky_sphere.glb")
Fe=h.create("shaders/sky.fp")
We=h.create("shaders/sky.vp")
skyLoad("default")
skyLoad("bloodmoon")
skyLoad("underwater")
i(/^skies\//,skyReload)
for(var e in _t){var t=_t[e]
if(t.color){lt[e]=J(0,0,0,1)
B(lt[e],t.def)}else lt[e]=t.def}updateDayIdx()
h.prelink(We,Fe,Xe)}function formatProp(e){var t=lt[e]
if(_t[e].radians)t=180*t/Se
return t.toPrecision(4)}var vt=2
var ht=1/vt
var pt={latitude:"Orbit",time:"Time",torch_hue_min:"Torch Light",light_sun_key:"Sun Light",sun_disk_radius:"Skydome"}
var mt=Q()
function skyEdit(){var e=100
var t=500
var r=Z.UI
var a=10
var i=100
var o=i+a
var n=S.font
var s=16
var l=200
var c=le
for(var _ in _t){var u=e+a
if(pt[_]){n.drawSized(c,u,o+8,r,s,pt[_])
o+=s+8}var d=_t[_]
n.drawSizedAligned(c,u,o,r,s,g.ALIGN.HFIT,150,0,_)
if(E.click({x:u,y:o,w:150,h:s}))if(d.color)B(lt[_],d.def)
else lt[_]=d.def
u+=158
var f=lt[_]
if(d.color){if(d.gamma)Y(mt,f,ht)
else B(mt,f)
if(!d.edit_box){d.edit_box=T.createEditBox({font_height:s,x:u,y:o,w:l})
d.edit_box.setText(colorToText(mt))}d.edit_box.run()
if(d.edit_box.isFocused())colorFromText(mt,d.edit_box.getText())
else d.edit_box.setText(colorToText(mt))
m({x:u+=l+8,y:o,z:r,icon_h:s,picker_h:250,color:mt,pad:14})
if(d.gamma)Y(f,mt,vt)
else B(f,mt)}else{if(d.gamma){var v=Ae(f-d.range[0],ht)
var h=y(v,{x:u,y:o,z:r,w:l,h:.8*s,min:0,max:Ae(d.range[1]-d.range[0],ht)})
if(h!==v)lt[_]=Ae(h,vt)+d.range[0]}else lt[_]=y(f,{x:u,y:o,z:r,w:l,h:.8*s,min:d.range[0],max:d.range[1]})
u+=l+8
n.drawSized(c,u,o,r,s,formatProp(_))}o+=s}var p={x:e-a,y:i,w:t+2*a,h:(o+=s+a)-i,z:r-1}
if(E.pointerLocked())if(E.click(p))E.pointerLockExit()
T.panel(p)}function sameSkies(e,t){if(e.length!==t.length)return false
for(var r=0;r<e.length;++r)if(e[r]!==t[r])return false
return true}function interpField(e,t,r){if(1===t.length)return t[0]
var a=0
var i=0
for(var o=0;o<t.length;o+=2)if(t[o]>be){a=(i=o)-2
break}if(!i)I(i,r+"."+t.length+"@"+be)
I(t[a]<=be)
var n=(be-t[a])/(t[i]-t[a])
if(e.color){H(mt,n,t[a+1],t[i+1])
return mt}else return b(n,t[a+1],t[i+1])}function skyTick(e){updateDayIdx()
be=null===se()?lt.time:se()
be=R(be,0,23.9999)
var t=[ke.default]
var r=[1]
var a=me()||{time_offs:0,time_scale:1}
var i=a.time_offs,o=a.time_scale
if(pe()&&0===i&&1===o&&(be>20&&Me%27===0||be<4&&Me%27===1)){ue(_e,true)
t.push(ke.bloodmoon)
r.push(interpField(dt,ke.bloodmoon.overlay_weight))}else ue(_e,false)
if(ie()){t.push(ke.underwater)
r.push(1)}if(be!==Ne||!sameSkies(t,Ce)){Ne=be
Ce=t
for(var n=0;n<ut.length;++n){var s=ut[n]
var l=_t[s]
for(var c=0;c<t.length;++c){var _=t[c]
var u=_[s]
if(!u)continue
var d=r[c]
var f=interpField(l,u,s)
var v=_.blend_layers&&_.blend_layers[s]
if(v){I.equal(v,"multiply")
if(l.color)z(mt,lt[s],f)
else f*=lt[s]}if(d>=1)if(l.color)B(lt[s],f)
else lt[s]=f
else if(l.color)H(lt[s],d,lt[s],f)
else lt[s]=b(d,lt[s],f)}}}var h
var p
var m
var g
var E
var y=Q(0,0,-1)
h=ge(lt.solar_orbit)
p=Re(lt.solar_orbit)
m=y[0]
E=y[2]
y[0]=h*m+p*E
y[2]=-p*m+h*E
h=ge(lt.axial_tilt)
p=Re(lt.axial_tilt)
g=y[1]
E=y[2]
y[1]=h*g-p*E
y[2]=p*g+h*E
var T=be/24*Oe+lt.solar_orbit
h=ge(-T)
p=Re(-T)
m=y[0]
E=y[2]
y[0]=h*m+p*E
y[2]=-p*m+h*E
h=ge(lt.latitude)
p=Re(lt.latitude)
g=y[1]
E=y[2]
y[1]=h*g-p*E
y[2]=p*g+h*E
B(lt.sun_pos,y)
q(lt.light_dir_ws,y,-1)
if(lt.light_dir_ws[2]>0)lt.light_dir_ws[2]*=-1
B(S.light_dir_ws,lt.light_dir_ws)
ot[0]=-lt.light_dir_ws[0]
ot[1]=-lt.light_dir_ws[1]
ot[2]=0
W(ot)
B(et,lt.light_sun_key)
B(tt,lt.light_sun_top)
B(rt,lt.light_sun_back)
$e[0]=pe()?.012:.005
if(S.defines.NOGAMMA){B(nt,lt.color_mid)
B(st,lt.sun_glow)}else{z(nt,lt.color_mid,lt.color_mid)
z(st,lt.sun_glow,lt.sun_glow)}if(e[0]>0){H(et,e[0],et,ee)
H(tt,e[0],tt,ee)
H(nt,e[0],nt,ee)}if(e[1]>0){H(rt,e[0],rt,ee)
$e[0]=b(e[1],$e[0],0)}Qe=1-e[0]
K(Je,lt.fog_extinction,lt.fog_inscattering,lt.fog_start_dist)
if(S.defines.OLDLIGHT){B(S.light_ambient,rt)
P(S.light_diffuse,et,tt)
j(S.light_diffuse,S.light_ambient)}}var gt=M()
function drawSkySphere(){var e=ne()
q(je,ae(),-1)
B(He,lt.sun_pos)
B(Ve,e)
V(ze,He,S.mat_view)
if(S.defines.NOGAMMA){B(Ye,lt.color_top)
B(qe,lt.color_mid)
q(Ke,lt.sun_color,lt.sun_disk_intensity)
B(Ze,lt.sun_glow)}else{z(Ye,lt.color_top,lt.color_top)
z(qe,lt.color_mid,lt.color_mid)
q(Ke,lt.sun_color,lt.sun_disk_intensity)
F(Ke,Ke)
z(Ze,lt.sun_glow,lt.sun_glow)}qe[3]=lt.color_mid_weight
Ke[3]=-(1-.015*lt.sun_disk_radius)
Ye[3]=1/(1+Ke[3])
Ke[3]*=Ye[3]
Ze[3]=Qe
gt[0]=gt[5]=gt[10]=.99*S.ZFAR
gt[12]=e[0]
gt[13]=e[1]
gt[14]=e[2]
S.updateMatrices(gt)
p.bind(0,p.textures.error)
h.bind(We,Fe,Xe)
Ge.drawGeom()}var Et=[]
function skyShift(e){for(var t=0;t<Et.length;++t)G(Et[t].pos,e)}var yt=1200
var Tt=2e3
var It=5e3
var St=24
function cloudRandomPos(){return(2*we()-1)*Tt}var At=true
function skyReinit(){At=true
Ne=-1
Et=[]}function updateClouds(){var e=ne()
var t=S.frame_dt
for(var r=Et.length-1;r>=0;--r){var a=Et[r]
if(a.fading){a.age-=t
if(a.age<0){N(Et,r)
continue}}else a.age+=t
k(a.pos,a.pos,a.speed,t)
if(!a.fading&&D(a.pos,e)>Tt*Tt*1.5*1.5){a.fading=true
a.age=It}}while(Et.length<10){var i=fe.origin_chunk[2]*te
Et.push({prop:Ue[ye(we()*Ue.length)],pos:Q(At?cloudRandomPos():-Tt,cloudRandomPos(),yt+20*we()-i),speed:[.0025+.0025*we(),0,0],quat:l(c(),$,ye(4*we())/4*Oe),age:At?It:0,color:J(1,1,1,0)})}At=false}function cmpCloudDist(e,t){return t.dist-e.dist}var wt=Q()
var Lt=[]
var Rt=J(1,1,1,1)
var xt=J(1,1,1,1)
function skyDraw(){K(Rt,Qe,Qe,Qe,1)
updateClouds()
var e=ne()
if(!S.defines.NOSKY)drawSkySphere()
gl.enable(gl.BLEND)
var t=S.ZFAR
k(wt,e,lt.sun_pos,.9*t)
wt[2]=e[2]-lt.sun_pos[2]*t*.9-.0325*t
wt[1]-=.1*t
z(xt,lt.moon_color,Rt)
if(!ie())Be.draw(wt,_,180*lt.moon_scale,{unlit:true,color:xt})
if(!S.defines.NOCLOUDS){S.light_dir_ws[2]*=-1
S.setGlobalMatrices(S.mat_view)
var r=de.view_dist*te*2
var a=0
for(var i=0;i<Et.length;++i){var o=Et[i]
var n=O(Ie(o.age/It,1),2)
var s=xe(U(o.pos,e))
n*=R((s-r)/25,0,1)
n*=Qe
if(!(o.color[3]=n));else if(1!==n){o.dist=s
Lt[a++]=o}else o.prop.draw(o.pos,o.quat,St,{nofog:true,color:o.color})}if(a){Lt.length=a
Lt.sort(cmpCloudDist)
for(var l=0;l<a;++l){var c=Lt[l]
c.prop.draw(c.pos,c.quat,St,{nofog:true,color:c.color})}}S.light_dir_ws[2]*=-1
S.setGlobalMatrices(S.mat_view)}}},{"../common/globals":197,"../glov/client/cmds":244,"../glov/client/color_picker":245,"../glov/client/engine":250,"../glov/client/filewatch":259,"../glov/client/font":260,"../glov/client/hsv":269,"../glov/client/input":271,"../glov/client/models":278,"../glov/client/quat":287,"../glov/client/shaders":293,"../glov/client/slider":294,"../glov/client/textures":304,"../glov/client/ui":306,"../glov/client/walltime":308,"../glov/client/webfs":309,"../glov/common/util":330,"../glov/common/vmath":332,"./camera":28,"./main":112,"./photo_mode":128,"./styles":160,"./user_data":170,"./voxel_chunk_manager":174,"./voxel_data":175,"./voxel_data_xraw":176,"./world_metadata":186,assert:void 0}],152:[function(e,t,r){"use strict"
r.socialMenuInit=socialMenuInit
r.doSocialMenu=doSocialMenu
function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]
for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))e[a]=r[a]}return e}).apply(this,arguments)}var d=e("../glov/client/scroll_area.js").scrollAreaCreate
var a=e("../glov/client/social.js")
var f=a.friendIsBlocked
var v=a.friendsGet
var M=a.getExternalFriendInfos
var D=a.getUserProfileImage
var h=a.isFriend
var P=e("../glov/client/ui.js")
var k=e("../glov/client/ui.js").buttonWasFocused
var B=e("../glov/common/enums.js").ID_PROVIDER_FB_INSTANT
var p=e("./fbinstant_worlds.js").fbShareWorld
var m=e("./layout.js").layoutWide
var U=e("./localization/localization").L
var G=e("./main.js")
var F=e("./main_menu.js").getWorldInfo
var i=e("./menu.js")
var g=i.menuX1
var E=i.menuY1
var y=e("./social_referral.js").getReferralNumber
var o=e("./styles.js")
var n=o.color_line
var W=o.color_user_alternate
var j=o.color_user_over
var H=o.color_user_viewing
var z=o.colors_user_selected
var V=o.label_style
var T=o.menu_header_style
var Y=o.sublabel_style
var q=e("./user_data.js").followUserAllowed
var s=e("./user_info_view.js")
var K=s.formatPresence
var I=s.userInfoGet
var X=s.userInfoViewing
var Q=s.viewUser
var J=e("./waygate_ui.js").waygateLinkUI
var l=e("./world_comm.js")
var $=l.getWorldID
var ee=l.worldTargetGo
function socialMenuInit(){}var S
function cmpFriend(e,t){if(!e.presence_data!==!t.presence_data)if(e.presence_data)return-1
else return 1
var r=(e.display_name||e.user_id).toLowerCase()
var a=(t.display_name||t.user_id).toLowerCase()
if(r===a){r=e.user_id
a=t.user_id}if(r<a)return-1
else return 1}var te=4
var re=8
var ae=4
function showFriendEntry(e,t,r,a,i,o){var n
var s=P.font
var l=i-16
var c=P.font_height
var _=.75*P.font_height
var u=2*te+c+4+_
var d=4*u/3
var f=re+d+8
var v=e[t]
var h=v.user_id,p=v.display_name,m=v.presence_data
var g=null==(n=M(h))?void 0:n[B]
var E=null==g?void 0:g.name
var y=r
if(!o){var T,I
var S=null==m?void 0:null==(T=m.payload)?void 0:T.world_id
var A=S===$()
var w=S&&(A||(null==(I=F(S,false))?void 0:I.user_access))
var L=A&&q()
if(w){var R={wid:S,uid:h}
if(J({x:re,y:r,z:a,h:u,target:R,ctx:"friend"+t,url:"u/"+h+"/go",style:"thumb",overlay_mode:true,overlay_users:true,teleport_icon:L})&&(L||!A)){G.menuExit()
ee(R)}}}var x=f
var O=Boolean(P.buttonImage(_extends({x:x,y:r,z:a,w:u,h:u,colors:X(h)?z:void 0},D(h))))
x+=u+4
var b=k()
if(false){if(P.buttonText({x:x,y:r,z:a,w:d,h:u,text:U.BTN_INVITE_PLAY}));b=b||k()
x+=d+4}var N=P.buttonShared({x:0,y:r-ae,w:l,h:u+2*ae,pad_focusable:false,rollover_quiet:X(h)})
if(N.ret)O=true
b=b||N.focused
r+=te
var C=p||E||h
if(E&&E!==C)C=C+" ("+E+")"
s.drawSizedAligned(V,x+=4,r,a+1,c,s.ALIGN.HLEFT,l,0,C)
r+=c+4
if(!o)s.drawSizedAligned(Y,x+8,r,a+1,_,s.ALIGN.HLEFT,l,0,K(m))
r+=_
r+=te
if(O)Q({x:x+d,y:r,user_id:h})
r+=2*ae
if(1&t||b||X(h))P.drawRect(0,y-ae,l,r-ae,a-.5,X(h)?H:b?j:W)
return r-y}function lineSep(e,t,r){var a=t
P.drawLine(e-40,t,e+40,t,r+.1,2,1,n)
return(t+=8)-a}function doFriendList(e,t,r,a,i,o,n){var s=P.font,l=P.title_font
var c=(r+o)/2
var _=a
var u=1.5*P.font_height
l.drawSizedAligned(T,c,a,i,u,s.ALIGN.HCENTER,0,0,U.$(t,e.length))
a+=u+8
a+=lineSep(c,a,i)
for(var d=0;d<e.length;++d)a+=showFriendEntry(e,d,a,i,o,n)
return(a+=6)-_}var A=120
var w=48
var L=8
function doFriendsReferralButton(e,t,r,a,i){var o=P.font
var n=t
var s=1.2*P.font_height
var l=y()?U.SOCIAL_REFERRAL_BASIC:U.SOCIAL_REFERRAL_FIRST
var c=o.getStringWidth(V,s,l)
var _=A+2*L
var u=c+2*L+_
if(u<=a)e+=(a-u)/2
else c=a-_-2*L
if(P.buttonText({x:e+L,y:t+(i-w)/2,z:r,w:A,h:w,text:U.BTN_SHARE}))p($())
e+=_
if(u<=a)o.drawSizedAligned(V,e+L,t,r,s,o.ALIGN.HLEFT|o.ALIGN.VCENTER,c,i,l)
else o.drawSizedAlignedWrapped(V,e+L,t,r,0,s,o.ALIGN.HLEFT|o.ALIGN.VCENTER,c,i,l)
return(t+=i)-n}var R=108
function doSocialMenu(){var e=0
var t=g()
var r=P.button_height
var a=E()
var i=r
var o=Z.UI
var n=t-e
var s=a-r
if(m()){e+=(n-1e3)/2
n=1e3}var l=[]
var c=[]
for(var _ in v())if(h(_))l.push(I(_))
else if(f(_))c.push(I(_))
l.sort(cmpFriend)
if(!S)S=d({z:Z.UI,background_color:null,auto_hide:true})
var u={x:e,y:i,w:n,h:r+s-i}
S.begin(u)
i=6
if(window.FBInstant)i+=doFriendsReferralButton(0,i,o+1,n,R)
i+=doFriendList(l,U.SOCIAL_FRIENDS_NUMBER,0,i,o+1,n)
if(c.length)i+=doFriendList(c,U.SOCIAL_BLOCKED_NUMBER,0,i,o+1,n,true)
S.end(i)}},{"../glov/client/scroll_area.js":289,"../glov/client/social.js":296,"../glov/client/ui.js":306,"../glov/common/enums.js":321,"./fbinstant_worlds.js":80,"./layout.js":99,"./localization/localization":108,"./main.js":112,"./main_menu.js":113,"./menu.js":117,"./social_referral.js":153,"./styles.js":160,"./user_data.js":170,"./user_info_view.js":171,"./waygate_ui.js":179,"./world_comm.js":182}],153:[function(e,t,r){"use strict"
r.getReferralNumber=getReferralNumber
r.checkReferrer=checkReferrer
r.socialReferralStartup=socialReferralStartup
var a=e("../glov/client/net").netSubs
var i=e("../glov/client/urlhash.js")
var o
i.register({key:"referrer",change:function change(e){if(e)o=e}})
function getReferralNumber(){var e=a().getMyUserChannel()
if(!e)return 0
var t=e.getChannelData("public.referrals",{})
return Object.keys(t).length}function checkReferrer(){var e=a().getMyUserChannel()
if(!e)return
if(e.getChannelData("public.referrer"))return
if(!(o=o||i.get("referrer")))return
e.send("referrer_set",o,function(e){if(e)console.error("Failed to confirm referrer: "+e)})}function socialReferralStartup(){o=i.get("referrer")}},{"../glov/client/net":279,"../glov/client/urlhash.js":307}],154:[function(e,t,r){"use strict"
r.SOUNDSCAPE_DATA=void 0
var a={base_path:"soundscape/",default_fade_time:3e3,layers:{bgThirdMaster:{excl_group_master:true,odds:[0,1],period:17142,min_intensity:.01,files:[{file:"bgThird_woods_air_a",excl_group:"F"},{file:"bgThird_woods_air_a",excl_group:"Flyd"},{file:"bgThird_woods_air_f",excl_group:"Dm"},{file:"bgThird_woods_air_f",excl_group:"DpedEm"},{file:"bgThird_woods_air_gb",excl_group:"D"},{file:"bgThird_woods_air_d",excl_group:"Bb"},{file:"bgThird_woods_air_e",excl_group:"DpedC"}],tags:{home:{priority:1,files:[{file:"bass_whaledrum_motif_g_tag-home",excl_group:"G"},{file:"bass_whaledrum_motif_g_tag-home",excl_group:"Gm"},{file:"bass_whaledrum_motif_g_tag-home",excl_group:"Gped"}]},night:{priority:.9,files:[{file:"bgThird_woods_echo_e",excl_group:"DpedC"},{file:"bgThird_woods_echo_f",excl_group:"Dm"},{file:"bgThird_woods_echo_d",excl_group:"Bb"},{file:"bgThird_woods_echo_d3",excl_group:"Bb"},{file:"bgThird_woods_echo_a",excl_group:"F"},{file:"bgThird_woods_echo_Bb",excl_group:"Gm"}]},snow:{priority:.8,files:[{file:"bgThird_piano_d",excl_group:"Bb"},{file:"bgThird_piano_Gb",excl_group:"D"},{file:"bgThird_piano_g",excl_group:"DpedEm"},{file:"bgThird_piano_e",excl_group:"DpedC"},{file:"bgThird_piano_A",excl_group:"F"},{file:"bgThird_piano_B",excl_group:"Flyd"},{file:"bgThird_piano_g",excl_group:"FpedEb"},{file:"bgThird_piano_bb",excl_group:"FpedGm"},{file:"bgThird_piano_B",excl_group:"G"},{file:"bgThird_piano_A",excl_group:"Gped"}]},underground:{priority:1,period:8571,files:[{file:"bg_sync_underground_air_d",excl_group:"D"},{file:"bg_sync_underground_air_d_rr2",excl_group:"D"},{file:"bg_sync_underground_air_d",excl_group:"DpedC"},{file:"bg_sync_underground_air_d_rr2",excl_group:"DpedC"},{file:"bg_sync_underground_air_d",excl_group:"Dm"},{file:"bg_sync_underground_air_d",excl_group:"G"},{file:"bg_sync_underground_air_d",excl_group:"Gm"},{file:"bg_sync_underground_air_d_rr2",excl_group:"Gm"}]}}},colorLowHarps:{odds:[5,3,4],period:6e3,period_noise:2e3,min_intensity:.05,add_delay:3e3,files:[{file:"bgColor_harps_pp_bb4",excl_group:["Bb"]},{file:"bgColor_harps_pp_a4",excl_group:["Dm","D","F"]},{file:"bgColor_harps_pp_f4",excl_group:["Dm","F","Flyd","Bb"]},{file:"bgColor_harps_pp_d4",excl_group:["Dm","D","Flyd","G","Gm"]},{file:"bgColor_harps_pp_bb3",excl_group:["Bb"]},{file:"bgColor_harps_pp_a3",excl_group:["Dm","D","F"]}],tags:{night:{priority:1,odds:[2,1],min_intensity:.05,files:[{file:"color_night_guitar_thirds_GBb",excl_group:["Gm","FpedEb"]},{file:"color_night_guitar_thirds_Gb",excl_group:["G","Em"]},{file:"color_night_guitar_thirds_Ebg",excl_group:["Cm","FpedEb"]},{file:"color_night_guitar_thirds_ce",excl_group:["DpedC","Am"]},{file:"color_night_guitar_thirds_FAb",excl_group:["Fm","Db"]},{file:"color_night_guitar_thirds_Fa",excl_group:["Dm","F","Gped"]},{file:"color_night_guitar_thirds_Bbd",excl_group:["Bb","Gm","FpedEb"]},{file:"color_night_guitar_thirds_df",excl_group:["Dm","Bb","Fm"]}]},snow:{priority:1,odds:[0,3,2,1],files:[{file:"bgColor_harps_pp_bb4",excl_group:["Bb","Gm","FpedEb"]},{file:"bgColor_harps_pp_a4",excl_group:["Dm","D","F"]},{file:"bgColor_harps_pp_f4",excl_group:["Dm","F","Flyd","Bb","FpedEb"]},{file:"bgColor_harps_pp_d4",excl_group:["Dm","D","Flyd","G","Gm"]},{file:"bgColor_harps_pp_bb3",excl_group:["Bb","Gm","FpedEb"]},{file:"bgColor_harps_pp_a3",excl_group:["Dm","D","F","Gped"]}]}}},bg:{max:3,period:1e4,period_noise:5e3,min_intensity:.08,add_delay:2e3,files:[{file:"bg_strings_p_a3",excl_group:["Dm","D","F"]},{file:"bg_strings_p_b3",excl_group:["DpedEm","DpedC1"]},{file:"bg_strings_p_c4",excl_group:["F","DpedC"]},{file:"bg_strings_p_g3",excl_group:["F","DpedC","DpedEm"]},{file:"bg_strings_p_g4",excl_group:["F","DpedC","DpedEm"]},{file:"bg_strings_p_d4",excl_group:["Dm","D"]},{file:"bg_strings_p_aba4",excl_group:"Flyd"},{file:"bg_strings_p_Bb3",excl_group:["Gm","FpedEb"]},{file:"bg_strings_p_Eb4",excl_group:["FpedEb","Fm"]},{file:"bg_horn_swell_aba3",excl_group:"Flyd"},{file:"bg_horn_swell_a3",excl_group:["Dm","F"]},{file:"bg_strings_p_adlib_swells_a3",excl_group:["Dm","D","F","Bb"]}],tags:{snow:{priority:.9,files:[{file:"bg_snow_strings_p_a5",excl_group:["Dm","D","F"]},{file:"bg_snow_strings_p_b5",excl_group:["DpedEm","DpedC"]},{file:"bg_snow_strings_p_c6",excl_group:["F","DpedC"]},{file:"bg_snow_strings_p_g5",excl_group:["F","DpedC","DpedEm"]},{file:"bg_snow_strings_p_g6",excl_group:["F","DpedC","DpedEm"]},{file:"bg_snow_strings_p_d6",excl_group:["Dm","D"]},{file:"bg_snow_strings_p_aba6",excl_group:"Flyd"}]},night:{priority:1,files:[{file:"bg_harps_p_e4",excl_group:"DpedC"},{file:"bg_harps_p_f4",excl_group:["Dm","F","Fm"]},{file:"bg_harps_p_f3",excl_group:["Dm","F","Fm"]},{file:"bg_harps_p_d4",excl_group:["Bb","D","Dm"]},{file:"bg_harps_p_a3",excl_group:["F"]},{file:"bg_harps_p_Bb3",excl_group:["Gm","Bb"]},{file:"bg_harps_p_g4",excl_group:["Gm","G","DpedC"]},{file:"bg_harps_p_g3",excl_group:["Gm","G","DpedC"]},{file:"bg_harps_p_c4",excl_group:["DpedC"]},{file:"bg_harps_p_b3",excl_group:["G","FpedEb"]}]},underground:{priority:1,period:8571,odds:[3,1],files:[{file:"bg_underground_air_c",excl_group:["D"]},{file:"bg_underground_air_b",excl_group:["D","G"]},{file:"bg_underground_air_Gb",excl_group:["D"]}]}}},bgSync:{sync_with:"bgThirdMaster",odds:[1,2],min_intensity:.15,add_delay:5e3,files:[{file:"bg_harp_celesta_low",excl_group:["Dm","F"]},{file:"bg_harp_celesta_low2",excl_group:["Dm","F"]},{file:"bg_harp_celesta_lowest",excl_group:["Dm","F","Bb"]},{file:"bg_harp_celesta_low_dped",excl_group:["DpedC"]},{file:"bg_felt_celesta_low1",excl_group:["Dm","F"]},{file:"bg_felt_celesta_low2",excl_group:"D"},{file:"bg_felt_celesta_low3",excl_group:["F","Dm","Bb"]},{file:"color_harp_p_Dmaj",excl_group:["D","Bb"]},{file:"color_harp_p_gfd",excl_group:["F","Dm","Bb","G"]}],tags:{home:{priority:1,files:[{file:"bg_sync_phrase_gdcbfa_4-4_tag-home",excl_group:["G","Gped"]}]},snow:{priority:.9,odds:[0,1],files:[{file:"bg_sync_guitar_shimmer_abd",excl_group:["Em","DpedEm","Dm","D","G"]},{file:"bg_sync_guitar_shimmer_cdf",excl_group:["Dm","F","Fm","FpedEb","FpedGm","Gm","Bb"]},{file:"bg_sync_guitar_shimmer_gac",excl_group:["DpedC","F"]}]},night:{priority:.95,files:[]},underground:{priority:1,files:[]}}},bgThirdBrass:{sync_with:"bgThirdMaster",odds:[1,1],period:26e3,period_noise:5e3,min_intensity:.25,files:[{file:"bgThird_trombone_mp_gb3",excl_group:"D"},{file:"bgThird_trombone_mp_a2",excl_group:["Dm","F"]},{file:"bgThird_trombone_mp_a3",excl_group:["Dm","D","F"]},{file:"bgThird_trombone_mp_f3g3",excl_group:["F","Bb"]},{file:"bgThird_trombone_mp_f3",excl_group:["Dm","F","Bb"]},{file:"bgThird_trombone_mp_f-e",excl_group:["Dm","F"]},{file:"bgThird_trombone_mp_f4",excl_group:["Dm","F","Bb"]},{file:"bgThird_trombone_mp_e4",excl_group:["DpedC"]},{file:"bgThird_trombone_mp_e3",excl_group:["DpedEm"]}],tags:{snow:{priority:1,files:[]},underground:{priority:1,files:[]}}},bassLow:{odds:[0,1],sync_with:"bgSync",min_intensity:.2,max_intensity:.6,files:[{file:"bass_strings_5ths_p_f",excl_group:["F","Flyd"]},{file:"bass_strings_5ths_p_d",excl_group:["D","Dm"]},{file:"bass_str_bassoon_f",excl_group:["F","Flyd"]},{file:"bass_str_bassoon_d",excl_group:["D","Dm","DpedC","DpedEm"]},{file:"bass_str_bassoon_g",excl_group:["G","Gm"]},{file:"bass_str_bassoon_Bb",excl_group:["Bb","Dm"]},{file:"bass_strings_p_f",excl_group:["F","Flyd"]},{file:"bass_strings_p_d",excl_group:["D","Dm","DpedC","DpedEm"]},{file:"bass_strings_p_bb",excl_group:["Dm","F","Bb"]}],tags:{home:{priority:1,odds:[1,1],files:[]},night:{sync_with:"bgThirdMaster",priority:.8,min_intensity:.25,max_intensity:.5,add_delay:5200,files:[{file:"bass_pizz_soft_bs_cel_Dm",excl_group:["Dm"]},{file:"bass_pizz_soft_bs_cel_D5",excl_group:["Dm","D","DpedC"]},{file:"bass_pizz_soft_bs_cel_F5",excl_group:["Fm","FpedEb","F"]},{file:"bass_pizz_soft_bs_cel_Gm",excl_group:["Gm"]},{file:"bass_pizz_soft_bs_cel_Bb5",excl_group:["Dm","Bb"]},{file:"bass_pizz_soft_bs_cel_GmDesc",excl_group:["Gm","Bb"]}]},snow:{priority:.7,odds:[0,1],files:[{file:"bassLow_snow_piano_str_hp_G",excl_group:["G","Gped","Gm"]},{file:"bassLow_snow_piano_str_hp_F",excl_group:["F","Flyd","FpedEb"]},{file:"bassLow_snow_piano_str_hp_D",excl_group:["D","DpedC","DpedEm"]},{file:"bassLow_snow_piano_str_hp_Bb",excl_group:["Bb"]}]},underground:{priority:.9,sync_with:"bgThirdMaster",odds:[1,1],files:[{file:"bass_ug_whale_ppiano_phrase_g",excl_group:["G","Gm","Gped"]},{file:"bass_ug_whale_ppiano_phrase_f",excl_group:["F","Flyd","FpedEb"]},{file:"bass_ug_whale_ppiano_phrase_d",excl_group:["D","DpedC","DpedEm"]},{file:"bass_ug_whale_ppiano_phrase_Bb",excl_group:["Bb"]}]}}},bass:{odds:[0,1],sync_with:"bgThirdMaster",min_intensity:.6,files:[{file:"bass_strings_5ths_p_f",excl_group:["F","Flyd"]},{file:"bass_strings_5ths_p_d",excl_group:["D","Dm"]},{file:"bass_str_bassoon_f",excl_group:["F","Flyd","Fm"]},{file:"bass_str_bassoon_d",excl_group:["D","Dm","DpedC","DpedEm"]},{file:"bass_strings_p_f",excl_group:["F","Flyd"]},{file:"bass_strings_p_d",excl_group:["D","Dm","DpedC","DpedEm"]},{file:"bass_strings_p_bb",excl_group:["Dm","F","Bb"]},{file:"bass_strings_p_g",excl_group:["Gm","G"]}],tags:{night:{priority:.9,min_intensity:.5,files:[{file:"bass_strings_p_d",excl_group:["D","Dm","DpedC","DpedEm"]},{file:"bass_strings_p_f",excl_group:["Fm","FpedEb"]},{file:"bass_strings_p_bb",excl_group:["Dm","Bb"]},{file:"bass_strings_p_g",excl_group:["Gm","G"]}]},underground:{priority:1,files:[{file:"bass_str_bassoon_f",excl_group:["F","Flyd","Fm","FpedEb"]},{file:"bass_str_bassoon_d",excl_group:["D","Dm","DpedC","DpedEm"]},{file:"bass_str_bassoon_g",excl_group:["G","Gm"]},{file:"bass_str_bassoon_Bb",excl_group:["Bb"]}]}}},colorLowWoods:{odds:[3,1],period:45e3,period_noise:5e3,min_intensity:.3,max_intensity:.6,add_delay:3e3,files:[{file:"bgWoods_trills_p_ab",excl_group:"Flyd"},{file:"bgWoods_trills_p_dea",excl_group:["D","Dm","F"]},{file:"bgWoods_trills_p_fgc",excl_group:["Dm","F"]},{file:"bgWoods_trills_p_fd5",excl_group:["Dm","F"]},{file:"bgWoods_trills_p_fd4",excl_group:["Dm","F"]},{file:"bgWoods_trills_p_fa",excl_group:["Dm","F","Bb"]},{file:"bgWoods_trills_p_ac",excl_group:["D","Dm","F","Bb"]}],tags:{night:{priority:1,files:[]},underground:{priority:1,files:[]}}},colorRandom:{odds:[1,1],period:17142,period_noise:8571,min_intensity:.2,files:[],tags:{night:{priority:1,odds:[5,1],min_intensity:.3,max_intensity:.5,files:[]},underground:{priority:1,files:[{file:"color_underground_harp_celeste_G",excl_group:["G","Gm"]},{file:"color_underground_harp_celeste_Gb4",excl_group:["D"]},{file:"color_underground_harp_celeste_f4",excl_group:["Dm","D"]},{file:"color_underground_harp_celeste_e4",excl_group:["G","D","Gm"]},{file:"color_underground_harp_celeste_d4",excl_group:["D","G","Gm"]},{file:"color_underground_harp_celeste_C4",excl_group:["D"]},{file:"color_underground_harp_celeste_b3",excl_group:["D","G"]},{file:"color_underground_harp_celeste_Bb3",excl_group:["Bb","Gm"]},{file:"color_underground_harp_celeste_a3",excl_group:["D","G","Gm"]},{file:"color_underground_harp_celeste_g3",excl_group:["Gm","G"]},{file:"color_underground_harp_celeste_gb3",excl_group:["D"]},{file:"color_underground_harp_celeste_f3",excl_group:["Dm","G"]},{file:"color_underground_harp_celeste_e3",excl_group:["G","D","Gm"]},{file:"color_underground_harp_celeste_d3",excl_group:["D","G","Gm"]}]}}},colorSync:{odds:[3,1],min_intensity:.5,sync_with:"bgThirdMaster",files:[{file:"color_glock_p_Dmaj",excl_group:["D"]},{file:"color_glock_p_cda6",excl_group:["Dm","F","Bb"]},{file:"color_glock_p_cda5",excl_group:["Dm","F","Bb"]}],tags:{night:{priority:.8,odds:[1,1],min_intensity:.1,max_intensity:.25,files:[{file:"fg_night_flute_phrase3",excl_group:["Dm","Bb","Gm","DpedC"]},{file:"fg_night_flute_phrase2",excl_group:["Dm","Bb","Gm","DpedC"]},{file:"fg_night_flute_phrase1",excl_group:["Dm","Bb","Gm","DpedC"]},{file:"fg_night_flute_phrase4",excl_group:["Dm","Bb","Gm","DpedC"]}]},snow:{odds:[0,1],priority:.9,files:[{file:"bg_snow_celeste_Bbmaj",excl_group:["Bb"]},{file:"bg_snow_celeste_D",excl_group:["D"]},{file:"bg_snow_celeste_Dm",excl_group:["Dm","F","Bb"]},{file:"bg_snow_celeste_DpedC",excl_group:["DpedC"]},{file:"bg_snow_celeste_Em",excl_group:["Em","G"]},{file:"bg_snow_celeste_F",excl_group:["Dm","F","Bb"]},{file:"bg_snow_celeste_Flyd",excl_group:["Flyd"]},{file:"bg_snow_celeste_Fm",excl_group:["Fm"]},{file:"bg_snow_celeste_Fped",excl_group:["FpedEb"]},{file:"bg_snow_celeste_G",excl_group:["G"]},{file:"bg_snow_celeste_Gped",excl_group:["Gped"]},{file:"bg_snow_celeste_Gm",excl_group:["Gm","Bb"]}]},underground:{priority:1,odds:[0,1],files:[{file:"color_sync_third_underground_stutters_e3",excl_group:["DpedC"]},{file:"color_sync_third_underground_stutters_b3",excl_group:["G","Dm","D"]},{file:"color_sync_third_underground_stutters_Bb3",excl_group:["Gm"]},{file:"color_sync_third_underground_stutters_Gb3",excl_group:["D"]},{file:"color_sync_third_underground_stutters_f3",excl_group:["Dm"]}]}}},fgLo:{odds:[4,2],period:3e4,sync_with:"bgThirdMaster",period_noise:1e4,min_intensity:.3,max_intensity:.6,files:[{file:"fg_eh_phrase1_mp_dfa",excl_group:["Dm","Bb","F"]},{file:"fg_eh_phrase1_mp_fac",excl_group:["Dm","F","Bb"]},{file:"fg_eh_phrase1_mp_fad",excl_group:["Dm","F","Flyd","Bb"]},{file:"fg_eh_phrase1_mp_gb-ad",excl_group:["D"]},{file:"fg_eh_phrase1_mp_ace",excl_group:["DpedC","F"]}],tags:{night:{priority:1,odds:[5,1],min_intensity:.5,max_intensity:.7,files:[{file:"fg_night_bassoon_phrase_gaf",excl_group:["Dm","Bb","Gm","DpedC"]},{file:"fg_night_bassoon_phrase_efd",excl_group:["Dm","Gm","DpedC"]},{file:"fg_night_bassoon_phrase_cBbc",excl_group:["Fm","Bb"]},{file:"fg_night_bassoon_phrase_aga",excl_group:["Dm","DpedC","Bb"]},{file:"fg_night_bassoon_phrase_EbdEb",excl_group:["Fm"]},{file:"fg_night_bassoon_phrase_gfg",excl_group:["Gm","Fm"]}]},snow:{priority:1,files:[]},underground:{priority:1,odds:[8,1],files:[{file:"fg_underground_basoon_phrase_bg",excl_group:["G"]},{file:"fg_underground_basoon_phrase_cd",excl_group:["D"]},{file:"fg_underground_basoon_phrase_ae",excl_group:["D"]},{file:"fg_underground_basoon_phrase_da",excl_group:["D"]}]}}},fgHi:{odds:[2,1],sync_with:"bgThirdMaster",min_intensity:.6,max_intensity:1,files:[{file:"fg_fh_mf_phrase_deca1",excl_group:["Dm","Flyd","F","DpedC"]},{file:"fg_fh_mf_phrase_dacg1",excl_group:["Dm","F","Flyd","DpedC"]},{file:"fg_fh_mf_phrase_dac1",excl_group:["Dm","D","Bb","DpedC"]},{file:"fg_fh_mf_phrase_dacbba1",excl_group:["D"]}],tags:{night:{min_intensity:.7,priority:.8,files:[{file:"fg_horn_night_ac_down",excl_group:["Dm","Gm","DpedC","F"]},{file:"fg_horn_night_ad_up",excl_group:["Dm","DpedC","Bb","F","G"]},{file:"fg_horn_night_ad_down",excl_group:["Dm","DpedC","Bb","F","G"]},{file:"fg_horn_night_ae_down",excl_group:["G","F","Dm","DpedC"]},{file:"fg_horn_night_ae_up",excl_group:["G","F","Dm","DpedC"]},{file:"fg_horn_night_dg_down",excl_group:["Gm","G","F","Bb","DpedC"]},{file:"fg_horn_night_gd_up",excl_group:["Gm","G","F","Bb","DpedC"]}]},snow:{priority:.9,files:[{file:"fg_snow_flute_phrase_cgd",excl_group:["Bb","Flyd","F","DpedC"]},{file:"fg_snow_flute_phrase_beGb",excl_group:["D","DpedC"]}]},underground:{priority:1,odds:[8,1],files:[{file:"fg_underground_basoon_phrase_bg",excl_group:["G"]},{file:"fg_underground_basoon_phrase_cd",excl_group:["D"]},{file:"fg_underground_basoon_phrase_ae",excl_group:["D"]},{file:"fg_underground_basoon_phrase_da",excl_group:["D"]}]}}}}}
r.SOUNDSCAPE_DATA=a},{}],155:[function(e,t,r){"use strict"
r.StateMachine=r.State=void 0
var i=e("assert")
var a=function State(e){this.sm=void 0
this.id=void 0
this.allowed_transitions=void 0
this.sm=e}
r.State=a
var o=function(){function StateMachine(e,t,r){this.owner=void 0
this.state_map={}
this.observers=[]
this.states=[]
this.handling_cbs=[]
this.handling_cb_params=[]
this.owner=e
for(var a=0;a<t.length;a++)this.addState(new t[a](this))
i(this.state_map[r])
this.states.push(r)}var e=StateMachine.prototype
e.getOwner=function getOwner(){return this.owner}
e.addState=function addState(e){i(!this.state_map[e.id])
this.state_map[e.id]=e}
e.addObserver=function addObserver(e){i(e.reactTransit)
this.observers.push(e)}
e.validateTransition=function validateTransition(e,t){if(t===e)return void console.error("State machine attempting to transit to self: "+t)
i(this.state_map[t])
i(t in this.state_map[e].allowed_transitions)}
e.transit=function transit(e,t){this.validateTransition(this.states[0],t)
for(var r=0;r<this.observers.length;r++)this.observers[r].reactTransit(this,t)
this.state_map[this.states[0]].exit(e,t)
this.states[0]=t
this.state_map[this.states[0]].enter(e)}
e.push=function push(e,t){this.validateTransition(this.states[0],t)
this.state_map[this.states[0]].exit(e,t)
this.states.unshift(t)
this.state_map[this.states[0]].enter(e)}
e.pop=function pop(e,t){this.validateTransition(this.states[0],t)
this.state_map[this.states[0]].exit(e,t)
this.states.shift()
this.state_map[this.states[0]].enter(e)}
e.addHandlingCB=function addHandlingCB(e,t){this.handling_cbs.push(e)
this.handling_cb_params.push(t)}
e.tick=function tick(e){if(this.handling_cbs.length>0){for(var t=0;t<this.handling_cbs.length;++t)this.handling_cbs[t](this.owner,e,this.handling_cb_params[t])
this.handling_cbs=[]
this.handling_cb_params=[]}this.state_map[this.states[0]].handle(e)
return this.state_map[this.states[0]].update(e)}
e.getState=function getState(){return this.states[0]}
return StateMachine}()
r.StateMachine=o},{assert:void 0}],156:[function(e,t,r){"use strict"
r.statusGet=statusGet
r.clear=clear
r.push=push
r.get=r.tickStatus=void 0
var E=e("../glov/client/camera2d.js")
var y=e("../glov/client/engine.js")
var T=e("../glov/client/font.js")
var I=e("../glov/client/ui.js")
var a=e("../glov/common/util.js")
var S=a.easeIn
var A=a.easeOut
var w=e("../glov/common/vmath.js").vec4
var L=e("./styles.js").status_style
var R=Math.max,x=Math.min
var i=3e3
var O=500
var b=500
var N=8
var C={}
var o=0
var n=function(){function StatusImpl(e){this.key=void 0
this.idx=void 0
this.msg="undefined"
this.counter=0
this.fade_rate=1
this.bounce_counter=0
this.done=false
this.lifespan=i
this.pos=void 0
this.style=void 0
this.key=e
this.idx=++o}var e=StatusImpl.prototype
e.setMessage=function setMessage(e,t){if(void 0===t)t=i
this.msg=e
this.counter=0
this.lifespan=t
return this}
e.fade=function fade(e){if(e)this.fade_rate=e
this.counter=this.lifespan-O-y.frame_dt*this.fade_rate
this.bounce_counter=b
return this}
e.noBounce=function noBounce(){this.bounce_counter=b
return this}
e.setPos=function setPos(e,t){this.pos=[(e-E.x0())/E.w(),(t-E.y0())/E.h()]
return this}
e.remove=function remove(){if(!this.done){this.done=true
delete C[this.key]}return null}
StatusImpl.tickStatus=function tickStatus(e){var t=Object.keys(C)
for(var r=0;r<t.length;++r){var a=C[t[r]]
var i=y.frame_dt*a.fade_rate
a.counter+=i
a.bounce_counter+=i}t.sort(function(e,t){return C[e].idx-C[t].idx})
var o=.5*E.w()
var n=E.h()*(e||.67)
var s=Z.STATUS
var l=0
for(var c=t.length-1;c>=0;--c){var _=C[t[c]]
if(_.counter>=_.lifespan){_.done=true
delete C[t[c]]
continue}var u=L
var d=1
var f=_.lifespan-O
if(_.counter>f){d=1-S((_.counter-f)/O,2)
u=T.styleAlpha(u,d)}_.style=u
var v=o
var h=I.font_height
var p=n-l*h
if(_.pos){v=_.pos[0]*E.w()+E.x0()
p=_.pos[1]*E.h()+E.y0()
var m=y.font.getStringWidth(u,h,_.msg)
v=x(R(v,E.x0()+m/2+N),E.x1()-m/2-N)}else{if(_.bounce_counter<b)h*=2-A(_.bounce_counter/b,2);++l}var g=y.font.drawSizedAligned(u,v,p,s+1,h,T.ALIGN.HCENTER,0,0,_.msg)
I.drawRect(v-g/2-N,p,v+g/2+N,p+h,s,w(0,0,0,.5*d))}}
return StatusImpl}()
var s=n.tickStatus
r.tickStatus=s
function statusGet(e){var t=C[e]
if(!t)t=C[e]=new n(e)
return t}var l=statusGet
r.get=l
function clear(){C={}}var c=0
function push(e){return statusGet(String(++c)).setMessage(e)}},{"../glov/client/camera2d.js":241,"../glov/client/engine.js":250,"../glov/client/font.js":260,"../glov/client/ui.js":306,"../glov/common/util.js":330,"../glov/common/vmath.js":332,"./styles.js":160}],157:[function(e,t,r){"use strict"
r.STONE_TIER_DISTRO=r.ORE_DROPRATE=r.ORE_DISTRO=r.ORE_FREQ=r.STONE_TIER_NAMES=r.STONE_TIER_SCALAR=r.STONE_TIER_DEPTH=void 0
var a=e("assert")
var i=e("../common/materials_common").Mat
var n={0:{depth_delta:50,scalar:1},1:{depth_delta:40,scalar:1.5},2:{depth_delta:70,scalar:2},3:{depth_delta:70,scalar:2.5},4:{depth_delta:40,scalar:3},5:{depth_delta:70,scalar:3.5},6:{depth_delta:70,scalar:4},7:{depth_delta:70,scalar:4.5},8:{depth_delta:70,scalar:5},9:{depth_delta:Infinity,scalar:1}}
var s=[]
r.STONE_TIER_DEPTH=s
var l=[]
r.STONE_TIER_SCALAR=l
var o=[]
r.STONE_TIER_NAMES=o;(function(){var e=0
for(var t in n){var r=Number(t)
var a=n[r],i=a.depth_delta,o=a.scalar
e+=i
s[r]=e
l[r]=o}})()
var c=1/6
r.ORE_FREQ=c
var _=[null,i.COPPER,i.TIN,i.IRON,i.SILVER,i.EMBERYLLIUM,i.GOLD,i.COBALT,i.MYTHRIL,i.AETHERSTONE]
r.ORE_DISTRO=_
var u=[0,1,1,1,1,1,1,1,1,1]
r.ORE_DROPRATE=u
a.equal(_.length,u.length)
var d=[[-Infinity,[1,3,1,1,1,3,1,1,3]],[s[0],[2,2,2,2,2,2,2,2,2]],[s[1],[1,3,2,3,2,3,1,3,3]],[s[2],[1,5,2,5,4,5,5,4,5]],[s[3],[1,6,3,6,6,5,6,4,6]],[s[4],[7,7,3,6,7,5,7,4,7]],[s[5],[8,2,8,6,7,8,8,4,8]],[s[6],[1,9,3,9,9,8,9,9,8]],[s[7],[1,2,3,6,7,5,9,4,8]],[Infinity,null]]
r.STONE_TIER_DISTRO=d},{"../common/materials_common":201,assert:void 0}],158:[function(e,t,r){"use strict"
r.getProductIdGemCost=getProductIdGemCost
r.getOwnedAmount=getOwnedAmount
r.canPurchaseProduct=canPurchaseProduct
r.canPurchaseProductId=canPurchaseProductId
r.gemPurchase=gemPurchase
r.getProduct=r.getAllProducts=void 0
var a=e("../common/store_data")
r.getAllProducts=a.getAllProducts
r.getProduct=a.getProduct
function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]
for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))e[a]=r[a]}return e}).apply(this,arguments)}var _=e("assert")
var i=e("../glov/client/net")
var u=i.netDisconnected
var d=i.netSubs
var f=e("../glov/client/ui")
var o=e("../glov/client/walltime")
var v=e("../glov/common/util").nop
var n=e("../common/store_data")
var s=n.getProduct
r.getProduct=s
var l=n.validatePurchaseRules
var h=e("./analytics").logEvent
var p=e("./localization/localization").L
var m=e("./ui_util").GEM_SYMBOL
var c=e("./world_comm")
var g=c.getGemBalance
var E=c.getPerm
var y=e("./worlds_sound").playSound
function getProductIdGemCost(e){var t=s(e)
return t&&t.cost_gems}function getOwnedAmount(e){return Number(E("owned."+e)||0)}function canPurchaseProduct(e){return l(e,o(),getOwnedAmount)}function canPurchaseProductId(e){var t=s(e)
return t?canPurchaseProduct(t):false}function gemPurchase(t,e,r,a,i){var o=a||v
var n=getProductIdGemCost(t)
_(n)
var s=d().getMyUserChannel()
if(!s){f.modalDialog({title:p.DLG_ERROR_TITLE,text:p.DLG_CANNOT_PURCHASE_MSG})
return void o("ERR_DISCONNECTED")}var l=g()
var c=r
if(n>l){h("purchase_gems_fail",n,c,t,_extends({gems:l},i))
f.modalDialog({title:p.DLG_NEED_MORE_GEMS_TITLE,text:p.DLG_NEED_MORE_GEMS_MSG.$({description:e})+"\n\n  "+p.addColon(p.DLG_NEED_MORE_GEMS_CURRENT_AMOUNT_MSG)+"\t"+l+m+"\n  "+p.addColon(p.DLG_NEED_MORE_GEMS_COST_MSG)+"\t\t"+n+m+"\n\n"+p.DLG_FIND_MORE_GEMS_MSG,buttons:{OK:null}})
return void o("ERR_INSUFFICIENT_FUNDS")}f.modalDialog({title:p.DLG_PURCHASE_CONFIRMATION_TITLE,text:p.DLG_PURCHASE_CONFIRMATION_MSG.$({description:e})+"\n\n  "+p.addColon(p.DLG_NEED_MORE_GEMS_CURRENT_AMOUNT_MSG)+"\t"+l+m+"\n  "+p.addColon(p.DLG_NEED_MORE_GEMS_COST_MSG)+"\t\t"+n+m,buttons:{Yes:function Yes(){if(u()){f.modalDialog({title:p.DLG_ERROR_TITLE,text:p.DLG_PURCHASE_FAILED_CUSTOM_MSG.$({error:p.ERR_DISCONNECTED}),buttons:{ok:null}})
return void o("ERR_DISCONNECTED")}f.modalDialog({title:p.DLG_PROCESSING_PURCHASE_TITLE,text:p.MSG_PLEASE_WAIT})
var e=s.pak("purchase_gems")
e.writeAnsiString(t)
e.send(function(e){f.modalDialogClear()
if(e)f.modalDialog({title:p.DLG_ERROR_TITLE,text:p.DLG_PURCHASE_FAILED_CUSTOM_MSG.$({error:JSON.stringify(e)}),buttons:{ok:null}})
else{y("purchase")
h("purchase_gems",n,c,t,_extends({gems:l-n},i))
h("item_flow",1,void 0,void 0,{item:"gem",flow_type:"sink",amount:n,context:r,context_detail:t,wallet:l})
f.modalDialog({title:p.DLG_PURCHASE_SUCCESSFUL_TITLE,text:p.DLG_PURCHASE_SUCCESSFUL_MSG,buttons:{ok:null}})}o(e)})},No:function No(){h("purchase_gems_cancel",n,void 0,t,_extends({gems:l},i))
o("ERR_USER_CANCELED")}}})}},{"../common/store_data":208,"../glov/client/net":279,"../glov/client/ui":306,"../glov/client/walltime":308,"../glov/common/util":330,"./analytics":5,"./localization/localization":108,"./ui_util":168,"./world_comm":182,"./worlds_sound":187,assert:void 0}],159:[function(e,t,r){"use strict"
r.unstuckBlocked=unstuckBlocked
r.unstuck=unstuck
var a=e("./localization/localization").L
var i=e("./client_cmds.js").isElevated
var o=e("./editvolume_client.js").hasVolumeAdminAccessForPos
var s=e("./energy_well.js").possiblyApplyWaygateSickness
var l=e("../common/globals.js").CHUNK_SIZE
var c=e("./main.js")
var _=c.charControllerPos
var u=Math.cos,d=Math.max,f=Math.random,v=Math.round,h=Math.sin,p=Math.PI
var n=e("./proc_gen_biomes.js"),m=n.getElevationEstimate,g=n.getVerticalSliceWorldPos
var E=e("./settlement.js"),y=E.settlementCurrent,T=E.settlementLastBound
var I=e("./user_data.js"),S=I.userLastWaygateTime,A=I.worldReadOnly
var w=e("../glov/common/vmath.js").vec3
var L=e("./voxel_data.js").worldPosFromLocalPos
var R=e("../glov/client/walltime.js")
var x=e("./world_metadata.js"),O=x.adventureMode,b=x.worldMetadataFreePos
var N=0
function unstuckBlocked(){if(!b()&&!O())if(!c.chat_ui.getAccessObj().access.world_admin&&!o(_()))return a.$(a.CHATERROR_STUCK_NOT_ADMIN,"/stuck","/world_free_pos=0")
if(A())return"ERR_ACCESS_DENIED"
if(!O())return null
var e=R.seconds()
if(e-N<60)if(!i())return a.$(a.CHATERROR_STUCK_LESS_MINUTE,"/stuck")
if(e-S()<150)return null
if(y()&&y()===T())return null
return a.CHATERROR_STUCK_TRY_WAYGATE}function unstuck(){s()
N=R.seconds()
var e=f()*p*2
var t=(20+10*f())*l
for(var r=100;r>=0;--r){var a=u(e)
var i=h(e)
var o=L(w(),_())
o[0]+=i*t
o[1]+=a*t
var n=g(o)
if(n.mid_elevation>=n.owner_hexome.water_level||!r){o[2]=d(n.owner_hexome.water_level+2,m(o)+7*l)
c.char_controller.updatePosFromString(o[0]+","+o[1]+","+o[2]+","+v(180*e/p+180)+",0",false)
c.char_controller.setFallDamageShield(10)
return}e+=1
t+=1}}},{"../common/globals.js":197,"../glov/client/walltime.js":308,"../glov/common/vmath.js":332,"./client_cmds.js":34,"./editvolume_client.js":72,"./energy_well.js":73,"./localization/localization":108,"./main.js":112,"./proc_gen_biomes.js":133,"./settlement.js":148,"./user_data.js":170,"./voxel_data.js":175,"./world_metadata.js":186}],160:[function(e,t,r){"use strict"
r.getStyleForClient=getStyleForClient
r.getStyleForRole=getStyleForRole
r.style_hp_label_low=r.color_hp_low=r.style_hp_label_none=r.color_hp_none=r.touch_jump_button_colors=r.color_touch_sprint_inactive=r.color_touch_sprint_active=r.color_touch_dpad_cursor=r.color_touch_dpad_border=r.colors_disabled=r.colors_red=r.colors_light_gold=r.colors_gems=r.color_gems=r.colors_green=r.color_rollover_cover=r.color_photo_frame_shadow=r.color_unliked_rollover=r.color_liked_rollover=r.color_liked=r.color_yellow=r.color_red=r.color_green=r.color_locked_fade=r.color_gray80=r.color_white_30=r.color_white_50=r.color_white=r.color_black_30=r.color_black=r.color_transparent=r.colors_user_selected=r.color_remove_user_viewing=r.color_remove_user_alternate=r.color_remove_user_over=r.color_remove_user=r.color_user_self_score=r.color_user_viewing=r.color_user_alternate=r.color_user_over=r.color_line=r.stamina_style=r.status_style=r.style_progress_label=r.style_mode_label_disabled=r.style_mode_label=r.style_photo_label_touch=r.style_photo_label=r.style_gems=r.floater_style_disabled=r.floater_style_red=r.chat_style_banned=r.floater_style_banned_no_outline=r.floater_style_banned=r.chat_style_link_hover=r.chat_style_link=r.chat_style_system=r.chat_style_error=r.chat_style_spectator=r.floater_style_spectator_no_outline=r.floater_style_spectator=r.chat_style_world_admin=r.floater_style_world_admin_no_outline=r.floater_style_world_admin=r.chat_style_world_owner=r.floater_style_world_owner_no_outline=r.floater_style_world_owner=r.chat_style_sysadmin=r.floater_style_sysadmin_no_outline=r.floater_style_sysadmin=r.chat_style_default=r.floater_style_default_no_outline=r.floater_style_shadow=r.floater_style=r.floater_style_default=r.refreshing_style=r.inventory_style_warn=r.inventory_style=r.party_info_style=r.connection_lost_style=r.white_label_style=r.menu_header_style=r.overlay_title_style_full=r.overlay_title_style=r.subtitle_style=r.title_style=r.rollover_style=r.helper_text_style=r.menu_style_on_dark=r.menu_style=r.style_ready=r.label_warning_style=r.loading_style=r.label_disabled_style=r.sublabel_style=r.hint_style=r.label_style=r.STYLE_CHAT=r.STYLE_WITHOUT_OUTLINE=r.STYLE_WITH_OUTLINE=void 0
r.styles_per_role=r.color_cosmetic_bright_legendary=r.color_cosmetic_bright_epic=r.color_cosmetic_bright_rare=r.color_cosmetic_bright_common=r.color_cosmetic_base_legendary=r.color_cosmetic_base_epic=r.color_cosmetic_base_rare=r.color_cosmetic_base_common=r.customization_legendary=r.customization_epic=r.customization_rare=r.customization_common=r.flavour_text_style=r.sign_font_style=r.color_rarity=r.style_rarity=r.style_trophies=r.color_trophies=r.color_o2_bar=r.color_stamina_bar=r.style_hp_label_high=r.color_hp_high=r.style_hp_label_med=r.color_hp_med=void 0
var a=e("../glov/client/font.js")
var i=a.fontStyle
var o=a.styleAlpha
var n=a.styleColored
var s=e("../glov/client/ui.js")
var l=e("../glov/common/vmath.js")
var c=l.v4fromRGBA
var _=l.rovec4
var u=e("../common/roles_common").classifyRole
var d=0
r.STYLE_WITH_OUTLINE=d
var f=1
r.STYLE_WITHOUT_OUTLINE=f
var v=2
r.STYLE_CHAT=v
var h=n(null,255)
r.label_style=h
var p=n(null,8388863)
r.hint_style=p
var m=n(null,128)
r.sublabel_style=m
var g=n(null,128)
r.label_disabled_style=g
var E=n(null,128)
r.loading_style=E
var y=n(null,2147483903)
r.label_warning_style=y
var T=n(null,1090470143)
r.style_ready=T
var I=i(null,{color:255})
r.menu_style=I
var S=i(null,{color:4210752255})
r.menu_style_on_dark=S
var A=i(null,{color:2425393407})
r.helper_text_style=A
var w=i(h,{outline_width:1,outline_color:4294967295})
r.rollover_style=w
var L=i(null,{color:4294967295,outline_width:2.5,outline_color:255,glow_xoffs:3,glow_yoffs:3,glow_inner:.5,glow_outer:2.5,glow_color:33023})
r.title_style=L
var R=i(null,{color:4294967248,outline_width:2.5,outline_color:128,glow_xoffs:3,glow_yoffs:3,glow_inner:.5,glow_outer:2.5,glow_color:255})
r.subtitle_style=R
var x=i(null,{color:4294967295,glow_xoffs:1,glow_yoffs:1,glow_inner:-1.5,glow_outer:2.5,glow_color:128})
r.overlay_title_style=x
var O=i(x,{color:2155905279})
r.overlay_title_style_full=O
var b=i(null,{color:8447,glow_xoffs:1,glow_yoffs:1,glow_inner:-1.5,glow_outer:2.5,glow_color:128})
r.menu_header_style=b
var N=i(null,{color:4294967295,glow_xoffs:0,glow_yoffs:3,glow_inner:-1.5,glow_outer:2.5,glow_color:77})
r.white_label_style=N
var C=i(null,{outline_width:2,outline_color:255,color:3709870335})
r.connection_lost_style=C
var M=i(null,{outline_width:2,outline_color:255,color:4294967295})
r.party_info_style=M
var D=i(null,{color:255})
var P=n(r.inventory_style=D,2147483903)
r.inventory_style_warn=P
var k=i(null,{color:4294967295,outline_width:2,outline_color:255})
r.refreshing_style=k
var B=i(null,{color:4294967295,outline_width:1,outline_color:160})
var U=r.floater_style_default=B
r.floater_style=U
var G=i(B,{outline_color:255,glow_xoffs:1,glow_yoffs:1,glow_inner:-1.5,glow_outer:2.5,glow_color:255})
r.floater_style_shadow=G
var F=i(B,{outline_width:0,color:255})
r.floater_style_default_no_outline=F
var W=i(null,{color:4008636159,outline_width:1,outline_color:255})
r.chat_style_default=W
var j=i(null,{color:4278190335,outline_width:1,outline_color:160})
r.floater_style_sysadmin=j
var H=i(j,{outline_width:0})
r.floater_style_sysadmin_no_outline=H
var z=i(null,{color:4280549631,outline_width:1.2,outline_color:1241777407})
r.chat_style_sysadmin=z
var V=i(null,{color:2606348031,outline_width:1,outline_color:160})
r.floater_style_world_owner=V
var Y=i(V,{outline_width:0})
r.floater_style_world_owner_no_outline=Y
var q=i(null,{color:3429302271,outline_width:1.3,outline_color:806958335})
r.chat_style_world_owner=q
var K=i(null,{color:459708671,outline_width:1,outline_color:160})
r.floater_style_world_admin=K
var Z=i(K,{outline_width:0})
r.floater_style_world_admin_no_outline=Z
var X=i(null,{color:1687547391,outline_width:1.3,outline_color:35839})
r.chat_style_world_admin=X
var Q=i(null,{color:2863311615,outline_width:1,outline_color:160})
r.floater_style_spectator=Q
var J=i(Q,{outline_width:0,color:1195853823})
r.floater_style_spectator_no_outline=J
var $=i(null,{color:2998842879,outline_width:1.2,outline_color:255})
r.chat_style_spectator=$
var ee=i(null,{color:3707764991,outline_width:1,outline_color:255})
r.chat_style_error=ee
var te=i(null,{color:2863311615,outline_width:1,outline_color:255})
r.chat_style_system=te
var re=i(null,{color:1346437119,outline_width:1,outline_color:255})
r.chat_style_link=re
var ae=i(null,{color:65535,outline_width:1,outline_color:255})
r.chat_style_link_hover=ae
var ie=i(null,{color:2155905279,outline_width:1,outline_color:160})
r.floater_style_banned=ie
var oe=i(ie,{outline_width:0,color:1431655935})
r.floater_style_banned_no_outline=oe
var ne=i(ie,{color:2998842879,outline_width:1.2,outline_color:255})
r.chat_style_banned=ne
var se=i(null,{color:4278190335,outline_width:1,outline_color:160})
r.floater_style_red=se
var le=i(null,{color:2863311615,outline_width:1,outline_color:160})
r.floater_style_disabled=le
var ce=i(null,{color:1910702079,outline_width:1.5,outline_color:255})
r.style_gems=ce
var _e=i(null,{color:4294967295,outline_width:1,outline_color:255})
r.style_photo_label=_e
var ue=i(null,{color:4294967176,outline_width:1,outline_color:187})
r.style_photo_label_touch=ue
var de=i(null,{outline_width:2,outline_color:128,glow_xoffs:0,glow_yoffs:0,glow_inner:0,glow_outer:0,glow_color:0,color:4294967295})
var fe=o(r.style_mode_label=de,.5)
r.style_mode_label_disabled=fe
var ve=i(null,{outline_width:2,outline_color:255,glow_xoffs:0,glow_yoffs:0,glow_inner:0,glow_outer:0,glow_color:0,color:4294967295})
r.style_progress_label=ve
var he=i(null,{color:4294967295,outline_width:2,outline_color:128})
var pe=r.status_style=he
r.stamina_style=pe
var me=_(0,0,0,1)
r.color_line=me
var ge=_(0,0,0,.125)
r.color_user_over=ge
var Ee=_(0,0,0,.05)
r.color_user_alternate=Ee
var ye=_(1,1,1,.5)
r.color_user_viewing=ye
var Te=c(1958962568)
r.color_user_self_score=Te
var Ie=_(1,0,0,.25)
r.color_remove_user=Ie
var Se=_(1,0,0,.5)
r.color_remove_user_over=Se
var Ae=_(1,0,0,.125)
r.color_remove_user_alternate=Ae
var we=_(1,.5,.5,.75)
r.color_remove_user_viewing=we
var Le=s.makeColorSet([.33,.33,.33,1])
r.colors_user_selected=Le
var Re=_(0,0,0,0)
r.color_transparent=Re
var xe=_(0,0,0,1)
r.color_black=xe
var Oe=_(0,0,0,.3)
r.color_black_30=Oe
var be=_(1,1,1,1)
r.color_white=be
var Ne=_(1,1,1,.5)
r.color_white_50=Ne
var Ce=_(1,1,1,.3)
r.color_white_30=Ce
var Me=_(.8,.8,.8,1)
r.color_gray80=Me
var De=_(0,0,0,.8)
r.color_locked_fade=De
var Pe=_(.25,1,.25,1)
r.color_green=Pe
var ke=_(.75,0,0,1)
r.color_red=ke
var Be=_(1,1,.25,1)
r.color_yellow=Be
var Ue=_(.25,.8,.25,1)
r.color_liked=Ue
var Ge=_(.25,.7,.25,1)
r.color_liked_rollover=Ge
var Fe=_(.8,.8,.8,1)
r.color_unliked_rollover=Fe
var We=_(0,0,0,.2)
r.color_photo_frame_shadow=We
var je=_(0,0,0,.15)
r.color_rollover_cover=je
var He=s.makeColorSet(Pe)
r.colors_green=He
var ze=_(113/255,226/255,1,1)
r.color_gems=ze
var Ve=s.makeColorSet(ze)
r.colors_gems=Ve
var Ye=s.makeColorSet([241/255,229/255,172/255,1])
r.colors_light_gold=Ye
var qe=s.makeColorSet([1,.2,.2,1])
r.colors_red=qe
var Ke=s.makeColorSet([1,1,1,.5])
r.colors_disabled=Ke
var Ze=_(1,1,1,.25)
r.color_touch_dpad_border=Ze
var Xe=_(1,1,1,1)
r.color_touch_dpad_cursor=Xe
var Qe=_(1,1,1,1)
r.color_touch_sprint_active=Qe
var Je=_(.5,.5,.5,.5)
r.color_touch_sprint_inactive=Je
var $e=s.makeColorSet(_(1,1,1,.7))
r.touch_jump_button_colors=$e
var et=xe
r.color_hp_none=et
var tt=n(de,4278190335)
r.style_hp_label_none=tt
var rt=ke
r.color_hp_low=rt
var at=n(de,4286611711)
r.style_hp_label_low=at
var it=Be
r.color_hp_med=it
var ot=n(de,4294951167)
r.style_hp_label_med=ot
var nt=Pe
r.color_hp_high=nt
var st=n(de,4294967295)
r.style_hp_label_high=st
var lt=_(.25,1,.25,1)
r.color_stamina_bar=lt
var ct=_(.25,.5,1,1)
r.color_o2_bar=ct
var _t=[null,4291564031,2695674367,3011859455]
var ut=i(D,{outline_width:1,outline_color:160})
var dt=_t.map(function(e){return e&&c(e)})
r.color_trophies=dt
var ft=_t.map(function(e){return e&&i(ut,{color:e})})
r.style_trophies=ft
var vt=i(D,{glow_inner:0,glow_outer:1.5})
var ht=[D,D,i(vt,{glow_color:550519039}),i(vt,{glow_color:1082195967}),i(vt,{glow_color:3764453375})]
r.style_rarity=ht
var pt=[null,null,_(0,1,.2,.3),_(0,.4,1,.3),_(.7,.2,1,.3)]
r.color_rarity=pt
var mt=i(null,{color:4210752255,outline_width:1.5,outline_color:255})
r.sign_font_style=mt
var gt=i(null,{color:1431655935})
r.flavour_text_style=gt
var Et=i(null,{glow_xoffs:1,glow_yoffs:1,glow_inner:-1.5,glow_outer:2.5})
var yt=i(Et,{color:1083970815,glow_color:1083970815})
r.customization_common=yt
var Tt=i(Et,{color:208916991,glow_color:208916991})
r.customization_rare=Tt
var It=i(Et,{color:2450313727,glow_color:2450313727})
r.customization_epic=It
var St=i(Et,{color:3513453823,glow_color:3513453823})
r.customization_legendary=St
var At=_(.25,.61,.08,1)
r.color_cosmetic_base_common=At
var wt=_(.05,.45,.82,1)
r.color_cosmetic_base_rare=wt
var Lt=_(.57,.05,.82,1)
r.color_cosmetic_base_epic=Lt
var Rt=_(.91,.39,.05,1)
r.color_cosmetic_base_legendary=Rt
var xt=_(.72,.89,.11,1)
r.color_cosmetic_bright_common=xt
var Ot=_(.25,.72,.9,1)
r.color_cosmetic_bright_rare=Ot
var bt=_(.91,.49,.9,1)
r.color_cosmetic_bright_epic=bt
var Nt=_(.95,.71,.11,1)
r.color_cosmetic_bright_legendary=Nt
var Ct=[j,H,z]
var Mt=[B,F,W]
var Dt={SYSADMIN:Ct,TEAM:Ct,OWNER:[V,Y,q],ADMIN:[K,Z,X],BUILDER:Mt,AREABUILDER:Mt,READONLY:Mt,SPECTATOR:[Q,J,$],NONE:[ie,oe,ne]}
r.styles_per_role=Dt
function getStyleForClient(e,t){var r=u(e,true)
return Dt[r][t]}function getStyleForRole(e,t){return Dt[e][t]}},{"../common/roles_common":206,"../glov/client/font.js":260,"../glov/client/ui.js":306,"../glov/common/vmath.js":332}],161:[function(e,t,r){"use strict"
r.workerReady=workerReady
r.workerBatchQueued=workerBatchQueued
r.workerFlush=workerFlush
r.workerFlushAll=workerFlushAll
r.workerTaskCount=workerTaskCount
r.taskBatchId=taskBatchId
r.taskCreate=taskCreate
r.startup=startup
r.per_worker_data=r.BATCH_TIME=r.WORKER_MESH=r.WORKER_GEN=r.WORKER_LOD=void 0
var u=e("assert")
var a=e("../glov/client/engine.js")
var d=e("../glov/common/util.js").callEach
var o=e("../glov/client/worker_comm.js")
var i=2
r.WORKER_LOD=i
var n=1
r.WORKER_GEN=n
var s=0
r.WORKER_MESH=s
var l=["MeshWorker","GenWorker","LODWorker"]
var c=100
var _=(r.BATCH_TIME=c)/2
var f={}
r.per_worker_data=f
var v
var h=0
var p=[]
var m=0
function WorkerData(e){this.worker=e
this.in_flight_time=0
this.in_flight_count=0
this.in_flight_head=null
this.in_flight_tail=null
this.batched_time=0
this.batch_id=++m
this.batch=[]
this.batch_transfer=null}function workerReady(e){var t=p[e]
if(t.batched_time>c)return false
return t.in_flight_count<=1||t.in_flight_time<=_}function workerBatchQueued(e){return p[e].batch.length}function Task(e,t){this.time=e.time
var r="taskresp:"+e.type
this.cb=function(e){profilerStart(r)
t(e)
profilerStop(r)}
this.next=null
this.id=++h}function workerFlush(e){var t=p[e]
if(!t.batch.length)return
t.in_flight_count+=t.batch.length
var r=t.batch_transfer&&t.batch_transfer.length?t.batch_transfer:void 0
if(r)for(var a=0;a<r.length;++a)u(r[a])
o.sendmsg(e,"task_batch",{batch_id:t.batch_id,batch:t.batch},r)
t.batch_id=++m
t.batch=[]
t.batch_transfer=null
var i=t.batched_time
t.in_flight_time+=i
t.batched_time=0}function workerFlushAll(){for(var e=0;e<p.length;++e){var t=p[e]
if(t&&t.batch.length)workerFlush(e)}}function workerTaskCount(e){var t=p[e]
return t.in_flight_count+t.batch.length}function taskBatchId(e){return p[e].batch_id}function taskCreate(e,t){var r=new Task(e,t)
var a=p[e.worker]
a.batch.push({task_id:r.id,type:e.type,data:e.data})
if(a.in_flight_tail)a.in_flight_tail=a.in_flight_tail.next=r
else a.in_flight_tail=a.in_flight_head=r
a.batched_time+=e.time
if(e.transfer&&e.transfer.length)if(!a.batch_transfer)a.batch_transfer=e.transfer
else a.batch_transfer=a.batch_transfer.concat(e.transfer)
return r}var g=[]
function onTaskBatchDone(e,t){var r=t.results,a=t.tracking_data
u(r&&r.length)
f[e]=a
g.push({worker_index:e,results:r})}function tickTaskSched(){if(!g.length)return
var e=[]
for(var t=0;t<g.length;++t){var r=g[t]
var a=r.worker_index,i=r.results
var o=p[a]
for(var n=0;n<i.length;++n){var s=i[n],l=s.task_id,c=s.res
u(o.in_flight_head)
if(o.in_flight_head.id!==l){u(o.in_flight_head.id<=l)
while(o.in_flight_head&&o.in_flight_head.id<l){console.error("Discarding task #"+o.in_flight_head.id+" because we got the result for "+l+" first")
o.in_flight_head=o.in_flight_head.next}}u.equal(o.in_flight_head.id,l)
var _=o.in_flight_head
o.in_flight_head=_.next
o.in_flight_time-=_.time
o.in_flight_count--
e.push(_.cb.bind(_,c))}if(!o.in_flight_head)o.in_flight_tail=null}g.length=0
d(e)}function startup(){if(a.defines.NOWORKERS)return
o.addHandler("task_batch_done",onTaskBatchDone)
v=3
for(var e=0;e<v;++e){p.push(new WorkerData(e))
o.sendmsg(e,"set_name",l[e])}a.addTickFunc(tickTaskSched)}},{"../glov/client/engine.js":250,"../glov/client/worker_comm.js":311,"../glov/common/util.js":330,assert:void 0}],162:[function(e,t,r){"use strict"
var R=e("assert")
var a=e("../glov/common/util")
var i=a.defaults
var o=a.merge
var n=e("../glov/common/vmath")
var s=n.v3copy
var l=n.vec4
var x=e("../common/ids").TYPE_BLOCK
var c=e("../common/materials_common").Mat
var _=e("./atlas_params.json")
var u=e("./autogen/liquid_tiles_data")
var d=e("./autogen/tiles_data")
var f=e("./tiles_const").Tint
var v=e("./tiles_const")
var h=t.exports=o({},v.TILES)
t.exports.tile_name=[]
t.exports.tile_name_block=[]
t.exports.tile_info=[]
var p=t.exports.tile_code_name={}
var m=Object.keys(h)
for(var g=0;g<m.length;++g)p[h[m[g]]]=m[g]
var E=o({},v.LIQUID_TILES)
o(h,E)
t.exports.liquid_name=[]
var y=t.exports.liquid_code_name=[]
var T=Object.keys(E)
for(var I=0;I<T.length;++I)y[E[T[I]]]=T[I]
o(h,{HIT_LIQUID:256,PROP_PENDING:257,TINT_GRASS:f.GRASS,TINT_ORE:f.ORE,TINT_MAX:f.MAX});(function(){var e=Object.keys(h)
for(var t=0;t<e.length;++t)h["TILE_"+e[t]]=h[e[t]]})()
var S=function(){var e=[]
for(var t=0;t<14;++t)e.push(l(1,0,1,1))
return e}()
var O=t.exports.MAT_METAL_TINT={}
O[c.COPPER]=S[0]
O[c.IRON]=S[1]
O[c.TIN]=S[2]
O[c.BRONZE]=S[3]
O[c.SILVER]=S[4]
O[c.EMBERYLLIUM]=S[5]
O[c.GOLD]=S[6]
O[c.BRIGHTSTEEL]=S[7]
O[c.COBALT]=S[8]
O[c.MYTHRIL]=S[9]
O[c.AETHERSTONE]=S[10]
O[c.AETHERSTEEL]=S[11]
O[c.MUTTAL]=S[12]
var A=t.exports.tile_colors=[]
var w=t.exports.liquid_colors=[]
function rgb(e,t,r){return new Uint8Array([e,t,r])}A[h.STONE]=rgb(152,157,178)
A[h.STONE_LIGHT]=rgb(196,205,234)
A[h.STONE_DARK]=rgb(111,115,137)
A[h.STONE_RED]=rgb(155,116,101)
A[h.DIRT]=rgb(180,99,69)
A[h.SNOW]=rgb(201,240,253)
A[h.SAND]=rgb(250,255,177)
A[h.VEINIUM]=rgb(222,155,255)
A[h.GLASS]=rgb(199,225,242)
A[h.TILLED]=A[h.DIRT]
A[h.TILLED_WATERED]=A[h.DIRT]
A.def=rgb(255,0,255)
w[h.WATER]=rgb(0,98,228)
var L=t.exports.tile_map_default=o({},d)
L[h.COAL].tint_color=S[13]
R(L.prop)
for(var b=h.PROP_BASE;b<=h.PROP_MAX;++b)L[b]=i({debug:"PROP_"+(b-h.PROP_BASE)},L.prop)
delete L.prop
R(L.unknown)
L.unknown.tile_code="EMPTY"
for(var N=0;N<256;++N)if(!L[N])L[N]=L.unknown
var C=t.exports.tile_map_liquids=o({},u)
t.exports.DIG_RATE_DEFAULT=1
t.exports.DIG_RATE_PROP=.5
var M=t.exports.STONES=[h.STONE,h.STONE,h.STONE,h.STONE_DARK,h.STONE,h.STONE_LIGHT,h.STONE,h.STONE_LIGHT,h.STONE_LIGHT,h.STONE,h.STONE,h.STONE_DARK,h.STONE,h.STONE_LIGHT,h.STONE,h.STONE_LIGHT,h.STONE,h.STONE,h.STONE_RED,h.STONE,h.STONE]
t.exports.NUM_STONES=M.length
var D=t.exports.VNUDGE_BIT=128
function fillMaps(h,e,t){var p={}
var m={}
var g={}
var E={}
var y={}
var T={}
var I={}
var S={}
var A=256
var w=[]
var L=[]
var r=function _loop(e){var r=h[e]
var t=Number(e)
if(!r.inv&&r.limited_blueprint)r.inv=[r.limited_blueprint]
if(!r.inv){R(isFinite(t))
r.inv=[t]}if(!Array.isArray(r.inv))r.inv=[r.inv]
for(var a=0;a<r.inv.length;++a){var i=r.inv[a]
if("number"===typeof i)r.inv[a]={type:x,id:i}
else R(i.id)}if(r.variable_yield&&r.mat&&O[r.mat])r.tint_color=O[r.mat]
if(r.crafted)r.stamina_use=0
if(r.unlimited_only)R(r.limited_blueprint)
var o=!r.unlimited_only&&!r.unplaceable
if(o&&(1!==r.inv.length||r.inv[0].type!==x||r.inv[0].id!==t))o=false
r.allowed_in_inventory=o
if(r.mat&&!r.not_material_source){R(isFinite(t))
if(r.crafted){R(!L[r.mat])
L[r.mat]=t}else if(!r.unplaceable){R(!w[r.mat])
w[r.mat]=t}}var n=r.alpha||false
var s=r.alpha_cutout||false
var l=(r.tile1?0:r.tile4?3:2)<<5
var c=r.tint||0
var _=r.tint_color||void 0
var u=r.unlit||false
var d=r.doublesided||false
if(_){if(void 0!==I[r.def]&&I[r.def]!==_){var f=--A
S[f]=r.def
r.def=f}I[r.def]=_}function assignValues(e){p[e]=n
m[e]=n||s
T[e]=d
g[e]=l
if(c){R(void 0===E[e]||E[e]===c)
E[e]=c}y[e]=u}assignValues(r.def)
if(r.face){R(!_)
for(var v=0;v<r.face.length;++v)if(r.face[v])assignValues(r.face[v])}["above","below"].forEach(function(e){if(r[e]){R(!_)
for(var t in r[e])assignValues(r[e][t])}})}
for(var a in h)r(a)
if(e)for(var i=e;i<=t;++i)if(g[i])g[i]|=D
h.tile_rate=g
h.alpha_map=p
h.alpha_allow_map=m
h.doublesided_map=T
h.tint_map=E
h.tint_colors=I
h.unlit_map=y
h.material_map=w
h.material_crafted_map=L
h.tile_override=S}fillMaps(L,_.primary.nudge[0],_.primary.nudge[1])
fillMaps(C)
L.material_map[c.FANCY_STONE]=h.STONE_LIGHT
L.tile_invisible=h.INVISIBLE
L.tile_non_opaque=h.NON_OPAQUE
C.tile_invisible=h.INVISIBLE
C.tile_non_opaque=h.NON_OPAQUE
var P=t.exports.priority_liquid={}
P[0]=1
P[h.WATER_FLOW]=2
P[h.WATER]=3
var k=t.exports.priority_solid={}
k[h.GRASS]=1
k[h.TILLED]=2
k[h.DIRT]=3
t.exports.setMetalTints=function(e){R.equal(S.length,e.length-1)
for(var t=0;t<S.length;++t)s(S[t],e[t+1])}},{"../common/ids":198,"../common/materials_common":201,"../glov/common/util":330,"../glov/common/vmath":332,"./atlas_params.json":13,"./autogen/liquid_tiles_data":15,"./autogen/tiles_data":16,"./tiles_const":163,assert:void 0}],163:[function(e,t,r){"use strict"
r.FuelRate=r.Tint=r.LIQUID_TILES=r.TILES=void 0
var a={EMPTY:0,DIRT:1,GRASS:2,STONE:3,ORE_IN_STONE:4,COAL:5,WOOD:6,TILLED:8,TILLED_WATERED:9,SNOW:10,SAND:11,STONE_DARK:12,STONE_LIGHT:13,STONE_RED:14,DIRT_WITH_FLINT:16,WOOD_BARK:17,PLANKS_WOOD:18,BRICK_CLAY:19,BRICK_STONE:20,WOOD_LIGHT:21,WOOD_LIGHT_BARK:22,PLANKS_WOOD_LIGHT:23,WOOD_DARK:24,WOOD_DARK_BARK:25,PLANKS_WOOD_DARK:26,WOOD_RED:27,WOOD_RED_BARK:28,PLANKS_WOOD_RED:29,COLORED_HUE0:30,COLORED_HUE1:31,COLORED_HUE2:32,COLORED_HUE3:33,COLORED_HUE4:34,COLORED_HUE5:35,ORE_IN_STONE_LIGHT:36,ORE_IN_STONE_DARK:37,ORE_IN_STONE_RED:38,VEINIUM:39,ORE_IN_VEINIUM:40,CORAL:41,LEAVES1:100,LEAVES2:101,LEAVES3:102,LEAVES4:103,LEAVES5:104,NON_OPAQUE:105,GLASS:110,COPPER:120,TIN:121,IRON:123,SILVER:124,EMBERYLLIUM:125,GOLD:126,COBALT:128,MYTHRIL:129,AETHERSTONE:130,INTANGIBLE:200,PASSABLE_LEAVES:200,POROUS:201,INVISIBLE:220,PROP_MASK:240,PROP_VALUE:224,UNDIGABLE:224,PROP_BASE:224,PROP_MAX:239,AIR:255}
r.TILES=a
var i={LIQUID_RESERVED:1,WATER:2,WATER_FLOW:3}
r.LIQUID_TILES=i
var o;(function(e){e[e["GRASS"]=1]="GRASS"
e[e["ORE"]=2]="ORE"
e[e["MAX"]=3]="MAX"})((r.Tint=o)||(r.Tint=o={}))
var n;(function(e){e[e["WOOD"]=10]="WOOD"
e[e["PLANKS"]=20]="PLANKS"
e[e["LEAVES"]=100]="LEAVES"})((r.FuelRate=n)||(r.FuelRate=n={}))},{}],164:[function(e,t,r){"use strict"
r.TILES_UI_SORT=void 0
var a={DIRT:1e3,TILLED:1001,TILLED_WATERED:1002,GRASS:1003,WOOD_LIGHT:2e3,WOOD:2001,WOOD_DARK:2002,WOOD_RED:2003,PLANKS_WOOD_LIGHT:2100,PLANKS_WOOD:2101,PLANKS_WOOD_DARK:2102,PLANKS_WOOD_RED:2103,COLORED_HUE0:2200,COLORED_HUE1:2201,COLORED_HUE2:2202,COLORED_HUE3:2203,COLORED_HUE4:2204,COLORED_HUE5:2205,LEAVES1:3e3,LEAVES2:3001,LEAVES3:3002,LEAVES4:3003,LEAVES5:3004,PASSABLE_LEAVES:3005,STONE_LIGHT:4e3,STONE:4001,STONE_DARK:4002,STONE_RED:4003,VEINIUM:4004,BRICK_STONE:4100,SNOW:5e3,SAND:5001,CORAL:5002,BRICK_CLAY:5100,GLASS:5101,ORE_IN_STONE_LIGHT:6e3,ORE_IN_STONE:6001,ORE_IN_STONE_DARK:6002,ORE_IN_STONE_RED:6003,ORE_IN_VEINIUM:6004,COAL:6100,EMPTY:null,DIRT_WITH_FLINT:null,WOOD_BARK:null,WOOD_LIGHT_BARK:null,WOOD_DARK_BARK:null,WOOD_RED_BARK:null,NON_OPAQUE:null,COPPER:null,TIN:null,IRON:null,SILVER:null,EMBERYLLIUM:null,GOLD:null,COBALT:null,MYTHRIL:null,AETHERSTONE:null,INTANGIBLE:null,POROUS:null,INVISIBLE:null,PROP_MASK:null,PROP_VALUE:null,UNDIGABLE:null,PROP_BASE:null,PROP_MAX:null,AIR:null}
r.TILES_UI_SORT=a},{}],165:[function(e,t,r){"use strict"
r.todoIsInList=todoIsInList
r.todoTooltip=todoTooltip
r.todoDone=todoDone
r.todoListAdd=todoListAdd
r.todoListTick=todoListTick
r.todoListInit=todoListInit
r.TODO_SET=r.TODO_INCREMENT=r.TODO_TOGGLE=void 0
var n=1
r.TODO_TOGGLE=n
var a=2
r.TODO_INCREMENT=a
var s=3
r.TODO_SET=s
var z=e("assert")
var h=e("../glov/client/camera2d")
var V=e("../glov/client/engine")
var p=e("../glov/client/input")
var m=e("../glov/client/scroll_area").scrollAreaCreate
var i=e("../glov/client/sprites")
var g=i.spriteClipPause
var E=i.spriteClipResume
var Y=e("../glov/client/ui")
var o=e("../glov/common/util")
var l=o.clone
var y=o.easeIn
var c=e("../glov/common/vmath")
var q=c.unit_vec
var _=c.v3copy
var u=c.vec4
var K=e("../common/ids").TYPE_SETTLEMENT_UPGRADE
var X=e("./blueprint").blueprintGetDef
var T=e("./build_mode").doingDragPlace
var d=e("./inventory")
var Q=d.countAvailable
var J=d.countAvailableEx
var $=e("./inventory_ui").inventoryButton
var f=e("./item_info_view")
var ee=f.ITEM_INFO_VIEW_H
var I=f.ITEM_INFO_VIEW_W
var te=f.itemInfoViewShow
var v=e("./items")
var re=v.ITEM_CONTEXT_BUILD
var ae=v.ITEM_CONTEXT_ITEM
var ie=v.ITEM_CONTEXT_SETTLEMENT_UPGRADE
var oe=v.createItem
var ne=v.itemIsBlueprint
var S=v.satisfiesCostLoose
var A=e("./layout")
var w=A.menuUpperLeft
var L=A.quickbarOnTop
var se=e("./localization/localization").L
var R=e("./menu")
var le=R.menuActive
var ce=R.menuInteractGetProp
var x=e("./settlement").settlementLastBound
var _e=e("./settlement_edit").settlementProgress
var ue=e("./status")
var O=e("./styles")
var de=O.color_green
var fe=O.style_ready
var b=e("./tutorial")
var ve=b.tutorialHook
var N=b.tutorialState
var he=b.tutorialUnderMenuY1
var pe=e("./ui_util")
var C=e("./user_data")
var me=C.userDataSet
var ge=C.worldReadOnly
var M=e("./waygate_upgrade")
var Ee=M.WAYGATE_TIERS
var ye=M.WAYGATE_UPGRADES
var D=e("./world_metadata")
var Te=D.adventureMode
var Ie=D.unlimitedMode
var Se=Math.max,Ae=Math.min
var we
var Le
var Re
var xe=u(.8,.8,.8,1)
var Oe=u(0,0,0,.5)
var be=u(.7,.7,.7,1)
function sameTodoItem(e,t){if(e.context!==t.context)return false
if(e.context===ie)return e.inv.attr1===t.inv.attr1
return S(e.inv,t.inv)}function todoIsInList(e,t){var r={inv:e,context:t}
for(var a=0;a<we.length;++a)if(sameTodoItem(we[a],r))return true
return false}function todoTooltip(e,t){return todoIsInList(e,t)?se.TODO_REMOVE_PIN:se.TODO_ADD_PIN}function todoDone(e,t){if(!we)return
var r={inv:e,context:t}
for(var a=0;a<we.length;++a){var i=we[a]
if(sameTodoItem(i,r)){if(e.count<i.inv.count)i.inv.count-=e.count
else we.splice(a,1)
me("todo",we)}}}function todoListAdd(e,t,r){e=l(e);(e=oe(e)).added_time=V.frame_timestamp
if(r===s)e.added_frame=V.frame_index
var a={inv:e,context:t}
var i=false
for(var o=0;o<we.length;++o)if(sameTodoItem(we[o],a)){if(r===n)if(we[o].inv.added_frame>=V.frame_index-1)ue.push(se.STATUSMSG_CANNOT_REMOVE_TUTORIAL_TASK)
else{ue.push(se.$(se.STATUSMSG_REMOVED_TASK,e.getName()))
we.splice(o,1)}else{if(r===s){e.added_time=we[o].inv.added_time
we[o].inv=e}else we[o].inv.count+=e.count
if(0!==o)we.splice(0,0,we.splice(o,1)[0])}i=true
break}if(!i){if(r!==s)ue.push(se.$(se.STATUSMSG_ADDED_TASK,e.getName()))
we.splice(0,0,a)}me("todo",we)}var Ne=350
var Ce=16
var P=u()
function colorAlpha(e,t){if(1===t)return e
_(P,e)
P[3]=t
return P}function styleAlpha(e,t){if(1===t)return e
return Y.font.styleAlpha(e,t)}function todoListTick(e){var C=x()
if(Te()&&C){for(var t=we.length-1;t>=0;--t){var r=we[t]
if(r.context===ie){var a
var i=r.inv.attr1
if(i===(null==(a=N())?void 0:a.name))continue
if(C.unlocked_upgrades[i]||i.startsWith("tier")&&Number(i.slice(4))>C.tier+1)we.splice(t,1)}}if(N()){if(void 0===Le)Le=C.tier}else if(C.tier!==Le){if(void 0!==Le){var o=Ee[C.tier+1]
if(o)todoListAdd({type:K,id:-1,attr1:o.key},ie)}Le=C.tier}}if(ge()||Ie()||!we.length){if(Re)Re.resetScroll()
return}if(T()&&p.touch_mode||V.defines.NOUI)return
if(!Re)Re=m({z:Z.UI,background_color:null,auto_hide:true})
var n
var s=he()
if(L())s=Se(s,Y.button_height+60)
var M
if(w()){n=h.x0()
M=n+Ne+Re.barWidth()}else{n=h.x1()-Ne-Re.barWidth()
M=n-I}var D={x:n,y:s,w:Ne+Re.barWidth(),h:h.y1()-250-s,z:Z.TODO_LIST,disabled:e}
Re.begin(D)
var P=(n=0)+Ce
var k=Ne-2*Ce
var B=Y.font_height
var U=1.5*B
var G=2*B
var F=4
var W=k-F-G
var j=.75*W
var H=W-F-j
function drawSection(e,t,r,a,i){var o=we[r]
var n=o.inv,s=o.context
var l=e
var c
var _
var u=[]
if(s===ae){c=se.separateColon(se.LBL_CRAFT,n.getName())
z(n.isCrafted())
_=n.getCraftCost()
var d=le()&&ce({no_text:true})
if(d&&d.contents){var f=Object.keys(_)
f.sort()
for(var v=0;v<f.length-1;++v)u[v]=J(d,_[v],false,true)}}else if(s===re){c=se.separateColon(se.LBL_BUILD,n.getName())
_=n.cost
var h=ne(n)&&X(n.getBID())
if(h)if(!h.loaded)_=[]
else _=h.cost}else if(s===ie){z.equal(n.type,K)
var p=n.attr1
var m=ye[p]
c=se.separateColon(se.LBL_UNLOCK,m.name)
if(!C)_=Object.values(m.cost)
else{_=m.cost
var g=Object.keys(_)
g.sort()
var E=[]
for(var y=0;y<g.length;++y){var T=g[y]
var I=_[T]
u[y]=_e(C,p,T)
E.push(I)}_=E}}var S=styleAlpha(null,a)
Y.font.drawSizedAligned(S,P,e,t,U,Y.font.ALIGN.HCENTERFIT,k,0,c)
e+=U+F
var A=true
for(var w=0;w<_.length;++w){var L=_[w]
if(!L.is_item)L=_[w]=oe(L)
var R=L.getName()
var x=Q(L,false,true)+(u[w]||0)
Y.font.drawSizedAligned(S,P,e,t,B,Y.font.ALIGN.HFIT,j,0,R)
Y.font.drawSizedAligned(S,P+j+F,e,t,B,Y.font.ALIGN.HFIT|Y.font.ALIGN.HRIGHT,H,0,x+" / "+L.count)
var O={x:P+k-G,y:e,z:t,w:G,h:G,draw_only:true,base_name:"inv_empty",hide_count:true,colors:{regular:colorAlpha(q,a)}}
$(O,L)
if(x>=L.count)pe.sprite.draw({x:O.x,y:O.y,z:O.z+1,w:O.w,h:O.h,frame:pe.CHECK,color:colorAlpha(de,a)})
else A=false
Y.progressBar({x:P,y:e+B,z:t,w:W,h:G-B,progress:Ae(1,x/L.count),color:colorAlpha(be,a)})
e+=G+F}if(A){Y.font.drawSizedAligned(styleAlpha(fe,a),P,e,t,B,Y.font.ALIGN.HCENTERFIT,k,0,se.TODO_READY)
e+=B+F
ve("todo_ready_"+n.type+"_"+n.id+"_"+n.attr1)}var b={x:P-Ce/2,y:l-Ce/2,w:k+Ce,h:e-l+Ce,z:t-.1,color:Oe}
if(i){if(Y.buttonShared(b).ret){var N
if(2===(null==(N=Y.button_click)?void 0:N.button))if(n.added_frame>=V.frame_index-1)ue.push(se.STATUSMSG_CANNOT_REMOVE_TUTORIAL_TASK)
else{ue.push(se.$(se.STATUSMSG_REMOVED_TASK,n.getName()))
we.splice(r,1)
me("todo",we)}else te({x:M,y:e-ee/2+D.y,auto_close:true,inv:n.is_item?n:oe(n),context:s})}if(Y.button_mouseover)Y.drawRect2(b)}else if(a<1){b.color=colorAlpha(Oe,a)
Y.drawRect2(b)}return e}var l=!e
var c=(s=0)+Ce
var _=Z.TODO_LIST
var u=50
pe.sprite.draw({x:P+k-u+Ce/2,y:c-Ce/2,z:_,w:u,h:u,color:Oe,frame:pe.PIN})
for(var d=0;d<we.length;++d){if(0!==d){c+=4
Y.drawLine(P+4,c,P+k-8,c,_,1,1,xe)
c+=4}var f=we[d].inv
if(f.added_time&&V.frame_timestamp<f.added_time+1e3){var v=.5*y(1-(V.frame_timestamp-f.added_time)/1e3,2)
g()
drawSection(c,Z.TODO_LIST_FLASH,d,v,false)
E()}c=drawSection(c,_,d,1,l)}c+=Ce
Y.drawRect(n,s,n+Ne,c,_-.2,Oe)
Re.end(c)
D.h=Ae(D.h,c)
if(l)p.mouseOver(D)}function todoListInit(e){we=[]
if(e)for(var t=e.length-1;t>=0;--t)todoListAdd(e[t].inv,e[t].context,s)
Le=void 0}},{"../common/ids":198,"../glov/client/camera2d":241,"../glov/client/engine":250,"../glov/client/input":271,"../glov/client/scroll_area":289,"../glov/client/sprites":302,"../glov/client/ui":306,"../glov/common/util":330,"../glov/common/vmath":332,"./blueprint":24,"./build_mode":27,"./inventory":94,"./inventory_ui":95,"./item_info_view":97,"./items":98,"./layout":99,"./localization/localization":108,"./menu":117,"./settlement":148,"./settlement_edit":149,"./status":156,"./styles":160,"./tutorial":166,"./ui_util":168,"./user_data":170,"./waygate_upgrade":180,"./world_metadata":186,assert:void 0}],166:[function(e,t,r){"use strict"
r.tutorialHook=tutorialHook
r.tutorialPosHook=tutorialPosHook
r.tutorialPostStateTick=tutorialPostStateTick
r.tutorialReset=tutorialReset
r.tutorialStartByName=tutorialStartByName
r.tutorialState=tutorialState
r.tutorialStartup=tutorialStartup
r.tutorialInit=tutorialInit
r.tutorialUnderMenuY1=tutorialUnderMenuY1
r.tutorialLeaveWorld=tutorialLeaveWorld
r.tutorialForcingMenu=tutorialForcingMenu
r.tutorialTick=tutorialTick
var a=e("assert")
var L=e("../glov/client/camera2d")
var i=e("../glov/client/cmds").cmd_parse
var R=e("../glov/client/engine")
var o=e("../glov/client/font").fontStyle
var x=e("../glov/client/input")
var d=e("../glov/client/spot").spotGet
var O=e("../glov/client/ui")
var n=e("../glov/common/util.js").callEach
var s=e("../glov/common/verify")
var l=e("../glov/common/vmath")
var f=l.v2add
var c=l.v2addScale
var v=l.v2copy
var b=l.v2set
var _=l.v3copy
var u=l.v3distSq
var N=l.vec2
var h=l.vec3
var p=l.vec4
var m=l.zero_vec
var g=e("../common/ids")
var E=g.ITEM_CORD
var y=g.ITEM_PICKAX
var T=g.ITEM_SAWMILL
var I=g.ITEM_STONECUTTER_SIMPLE
var S=g.ITEM_TOOL_HEAD
var A=g.ITEM_WORKBENCH
var w=g.TYPE_ITEM
var C=g.TYPE_RECIPE
var M=g.TYPE_SETTLEMENT_UPGRADE
var D=e("../common/materials_common").Mat
var P=e("../common/world_trans").decodeWorldPos
var k=e("./analytics").logEvent
var B=e("./build_menu")
var U=B.SUB_SETTLEMENT
var G=B.getBuildMenuSubPage
var F=e("./chunk_searcher").ChunkSearcher
var W=e("./debug")
var j=e("./fbinstant_worlds").fbInviteAsync
var H=e("./inventory")
var z=H.INV_EQUIP
var V=H.countAvailable
var Y=e("./items")
var q=Y.ITEM_CONTEXT_BUILD
var K=Y.ITEM_CONTEXT_ITEM
var X=Y.ITEM_CONTEXT_SETTLEMENT_UPGRADE
var Q=Y.createItem
var J=e("./layout")
var $=J.CORNER_BUTTON_MARGIN
var ee=J.layoutCameraPop
var te=J.layoutCameraPush
var re=J.menuUpperLeft
var ae=e("./localization/localization").L
var ie=e("./main").charControllerPos
var oe=e("./menu")
var ne=oe.BUILD
var se=oe.FACTORY
var le=oe.WAYGATE_EDIT
var ce=oe.getMenuPage
var _e=oe.isBuildMenu
var ue=oe.menuActive
var de=oe.menuInteractGetProp
var fe=oe.prefixShortcutKey
var ve=oe.setMenuPageLayout
var he=e("./photo_mode").photoModeActive
var pe=e("./props.js").createIndicatorProp
var me=e("./quickbar.js").itemInQuickbar
var ge=e("./race_ui").isRacePanelInColumn
var Ee=e("./settlement")
var ye=Ee.settlementCurrent
var Te=Ee.settlementGetLazyAsync
var Ie=Ee.settlementLastBound
var Se=e("./settlement_edit").CRAFTING_ICON_SIZE
var Ae=e("./share_menu").isShareButtonInColumn
var we=e("./status")
var Le=e("./styles").menu_header_style
var Re=e("./todo_list")
var xe=Re.TODO_SET
var Oe=Re.todoDone
var be=Re.todoListAdd
var Ne=e("./ui_util")
var Ce=e("./user_data")
var Me=Ce.userDataGet
var De=Ce.userDataSet
var Pe=Ce.worldReadOnly
var ke=e("./voxel_data.js")
var Be=ke.drawPropQueued
var Ue=ke.localPosFromWorldPos
var Ge=e("./waygate_ui").waygateUIIsSettlement
var Fe=e("./world_comm").getWorldID
var We=e("./world_metadata").adventureMode
var je=e("./worlds_sound").playSound
var He=Math.PI,ze=Math.abs,Ve=Math.sin
var Ye=80
var qe=p(.16,1,0,.75)
var Ke={}
var Ze={}
function tutorialHook(e,t,r){(r?Ke:Ze)[e]=void 0!==t?t:true}function checkHook(e){return Boolean(Ke[e]||Ze[e])}function checkFactoryAndRecipe(e,t){var r=de({no_text:true})
return Boolean(ce()===se&&r&&r.item_id===e&&(!t||r.factory_recipe===t))}var Xe={all:function all(){return true},build_menu:_e,build_menu_and_settlement_tab:function build_menu_and_settlement_tab(){return _e()&&G()===U},current_settlement:Ge,factory_aetherbench:function factory_aetherbench(){return checkFactoryAndRecipe(A)},factory_aetherbench_and_recipe_cord:function factory_aetherbench_and_recipe_cord(){return checkFactoryAndRecipe(A,"cord")},gameplay:function gameplay(){return!ue()&&!he()},menu:function menu(){return ue()}}
var Qe={build_menu:ne,build_menu_and_settlement_tab:ne,current_settlement:le,factory_aetherbench:se,factory_aetherbench_and_recipe_cord:se,menu:le}
function craftingItem(e){return checkHook("crafting_"+w+"_"+e)||checkHook("available_to_take_"+w+"_"+e)}function haveMatsItem(e,t){return checkHook("todo_ready_"+w+"_"+e+"_"+(t||0))}function haveMatsProp(e,t){return checkHook("todo_ready_"+w+"_"+e+"_"+(t||0))||checkHook("transacting_build_prop_"+e)}function haveMatsSettlementUnlock(e){return checkHook("todo_ready_"+M+"_-1_"+e)}function haveMatsRecipe(e){return checkHook("todo_ready_"+C+"_-1_"+e)}var Je={crafting_cord:function crafting_cord(){return craftingItem(E)},have_mats_aetherbench:function have_mats_aetherbench(){return haveMatsProp(A)},have_mats_stonecutter:function have_mats_stonecutter(){return haveMatsProp(I)},have_mats_sawmill:function have_mats_sawmill(){return haveMatsProp(T)},have_mats_cord:function have_mats_cord(){return haveMatsItem(E)},have_mats_tier1:function have_mats_tier1(){return haveMatsSettlementUnlock("tier1")},have_mats_tier2:function have_mats_tier2(){return haveMatsSettlementUnlock("tier2")},have_mats_stone_tool_head:function have_mats_stone_tool_head(){return haveMatsRecipe("stone_tool_head")},have_mats_pickax:function have_mats_pickax(){return haveMatsRecipe("pickax")},in_qbar_aetherbench:function in_qbar_aetherbench(){return me(A)},in_qbar_stonecutter:function in_qbar_stonecutter(){return me(I)},in_qbar_sawmill:function in_qbar_sawmill(){return me(T)},settlement_no_current:function settlement_no_current(){return!ye(true)},settlement_no_access:function settlement_no_access(){var e=ye(true)
return e&&!e.buildAllowed()},settlement_not_last_bound:function settlement_not_last_bound(){return ye(true)!==Ie()}}
var $e={}
function tutorialPosHook(e,t){$e[e]=t}var et;(function(e){e[e["DOWN"]=0]="DOWN"
e[e["LEFT"]=He/2]="LEFT"
e[e["UP"]=He]="UP"
e[e["RIGHT"]=3*He/2]="RIGHT"})(et=et||{})
var tt=N(1,0)
var rt=N(0,.5)
var at=N(1,.5)
var it=N(.5,1)
var ot=N(1,1)
function isSpotPos(e){return Boolean(e.spot_key)}var nt=[]
function addTutorialPostStateTick(e){(nt=nt||[]).push(e)}function tutorialPostStateTick(){if(nt.length>0){n(nt)
nt.length=0}}var st
var lt=h()
function drawWorldIndicator(t,r){addTutorialPostStateTick(function(){var e=st
if(t(lt)){if(!r)Ue(lt,lt)
Be(e,lt)}})}function drawSettlementWorldIndicator(){drawWorldIndicator(function(e){var t=ye(true)
if(!t)return false
_(e,t.world_pos)
e[2]+=2
return true},false)}function vdHasProp(e,t){var r=e.props
for(var a in r)if(r[a].item_id===t)return r[a]
return null}var ct=h()
var _t=h()
var ut
function searchProp(i){var o=null
ut.setStart(ie())
if(ut.done)ut.reset()
var n=0
var s=0
ut.search(function(e){var t=null
n++
ut.addWork(2)
var r=vdHasProp(e,i)
if(r){s++
P(ct,r.chunk_id,r.pos_idx)
Ue(_t,ct)
var a=u(ut.start,_t)
if(a<ut.closest_dist){o=r
t={closest_chunk:e,closest_dist:a,closest_offs:_t}}}return t})
if(R.defines.TUTORIAL_SEARCH){W.addText("Checks:")
W.addText("  Chunks Checked: "+n)
W.addText("  Chunks With Prop: "+s)
W.addText("Time: "+(R.hrnow()-ut.search_start_time).toFixed(3))
W.addText("Distance: "+ut.last_closest_dist.toFixed(1)+"/"+ut.range)
W.addText("Walk: "+ut.chunk_walk+" / "+ut.done)}return o}function drawPropWorldIndicator(r){drawWorldIndicator(function(e){var t=searchProp(r)
if(!t||Infinity===ut.last_closest_dist)return false
_(e,ut.last_closest_offs)
c(e,e,t.size,.5)
c(e,e,st.size,-.5)
e[2]+=t.size[2]+.5
return true},true)}var dt=ae.reactive(function(){return fe("B",ae.LBL_BUILD_MENU,true)})
var ft=ae.separate("\n\n",ae.TUTORIAL_LOST_FRONTIER_MSG,ae.TUTORIAL_LOST_FRONTIER_MSG_NO_SETTLEMENT)
var vt=ae.separate("\n\n",ae.TUTORIAL_LOST_FRONTIER_MSG,ae.TUTORIAL_LOST_FRONTIER_MSG_NO_ACCESS)
var ht=ae.separate("\n\n",ae.TUTORIAL_LOST_FRONTIER_MSG,ae.TUTORIAL_LOST_FRONTIER_MSG_SET_HOME.$({button:ae.BTN_SETTLEMENT_SET_AS_HOME}))
var pt=ae.separate("\n\n",ae.TUTORIAL_LOST_FRONTIER_MSG,ae.TUTORIAL_LOST_FRONTIER_MSG_SELECT)
var mt=ae.separate("",ae.TUTORIAL_AETHERBENCH_BUILD_MENU_MSG_1,"\n\n",ae.TUTORIAL_AETHERBENCH_BUILD_MENU_MSG_2_GENERIC)
var gt=ae.separate("",ae.TUTORIAL_AETHERBENCH_BUILD_MENU_MSG_1,"\n\n",ae.TUTORIAL_AETHERBENCH_BUILD_MENU_MSG_2_KEYBOARD.$({build_menu:dt}))
var Et=ae.separate("\n\n",ae.TUTORIAL_AETHERBENCH_MATERIALS_MSG_1,ae.TUTORIAL_AETHERBENCH_MATERIALS_MSG_2.$({wood:10,stone:4}))
var yt=ae.separate("\n\n",ae.TUTORIAL_STONECUTTERY_BUILD_MSG.$({build_menu:ae.LBL_BUILD_MENU}),ae.TUTORIAL_STONECUTTERY_PLACE_PROP_MSG_NOTE)
var Tt=ae.separate("\n\n",ae.TUTORIAL_STONECUTTERY_BUILD_MSG.$({build_menu:dt}),ae.TUTORIAL_STONECUTTERY_PLACE_PROP_MSG_NOTE)
var It=ae.separate("\n\n",ae.TUTORIAL_STONECUTTERY_MATERIALS_MSG_1,ae.TUTORIAL_STONECUTTERY_MATERIALS_MSG_2.$({cord:2,stone:10}))
var St=ae.separate("",ae.TUTORIAL_WOODCUTTERY_BUILD_MSG.$({build_menu:ae.LBL_BUILD_MENU}),"\n\n  ",ae.TUTORIAL_WOODCUTTERY_PLACE_PROP_MSG_NOTE)
var At=ae.separate("",ae.TUTORIAL_WOODCUTTERY_BUILD_MSG.$({build_menu:dt}),"\n\n  ",ae.TUTORIAL_WOODCUTTERY_PLACE_PROP_MSG_NOTE)
var wt=ae.separate("\n\n",ae.TUTORIAL_WOODCUTTERY_MATERIALS_MSG_1,ae.TUTORIAL_WOODCUTTERY_MATERIALS_MSG_2.$({heads:1,wood:20}))
var Lt=300
var Rt=0
var xt=0
var Ot=false
var bt=[null,{name:"share_url",prompts:[{context:"all",msg:ae.TUTORIAL_SHARE_URL_MSG,indicators:[{dir:et.UP,pos_hook_key:"tut_window_left"}],pos:{pos_hook_key:"tut_top_center"}}],show_as_visitor:true,dismiss:true,auto_dismiss:30,no_interrupt:true,done:function done(){return false},next:null},{name:"fb_share",prompts:[{context:"all",title:ae.TUTORIAL_INVITE_FRIENDS_TITLE,msg:ae.TUTORIAL_INVITE_FRIENDS_MSG,pos:{pos_hook_key:"tut_top_center"}}],show_as_visitor:true,dismiss:true,auto_dismiss:15,no_interrupt:true,done:function done(){return false},action:function action(){return void j(Fe())},action_text:ae.BTN_INVITE_TO_WORLD,next:null},{main:true,unskippable:true,name:"adventure_start",title:ae.TUTORIAL_LOST_FRONTIER_TITLE,prompts:[{context:"gameplay",conditions:["settlement_no_current"],title:ae.TUTORIAL_LOST_FRONTIER_TITLE,msg:ft},{context:"gameplay",conditions:["settlement_no_access"],title:ae.TUTORIAL_LOST_FRONTIER_TITLE,msg:vt},{context:"gameplay",conditions:["settlement_not_last_bound"],title:ae.TUTORIAL_LOST_FRONTIER_TITLE,msg:ht},{context:"gameplay",title:ae.TUTORIAL_LOST_FRONTIER_TITLE,msg:pt,draw:drawSettlementWorldIndicator}],done:function done(){var e=ye(true)
return e&&e.buildAllowed()&&e===Ie()&&Ge()}},{main:true,name:"tier1",prompts:[{context:"current_settlement",conditions:["have_mats_tier1"],title:ae.TUTORIAL_PUT_RESOURCES_TITLE,msg:ae.TUTORIAL_UPGRADE_SETTLEMENT_FIRST_PUT_MSG_KEYBOARD,msg_touch:ae.TUTORIAL_UPGRADE_SETTLEMENT_FIRST_PUT_MSG_GENERIC,w:Lt,indicators:[{dir:et.RIGHT,pos_hook_key:"required_items_before",offset:N(-Ye,Se/2-Ye/2)},{dir:et.RIGHT,pos_hook_key:"inventory_slots",offset:N(-Ye,-Ye/2)}],pos:{pos_hook_key:"required_items_after"}},{context:"gameplay",conditions:["have_mats_tier1"],title:ae.TUTORIAL_GO_TO_SETTLEMENT_TITLE,msg:ae.separate("\n\n",ae.TUTORIAL_UPGRADE_SETTLEMENT_MSG,ae.TUTORIAL_UPGRADE_SETTLEMENT_MSG_HINT),draw:drawSettlementWorldIndicator},{context:"gameplay",title:ae.TUTORIAL_UPGRADE_SETTLEMENT_MATERIALS_TITLE,msg:ae.TUTORIAL_UPGRADE_SETTLEMENT_MATERIALS_MSG}],todo:{inv:{type:M,id:-1,attr1:"tier1"},context:X},done:function done(){var e
return(null==(e=ye())?void 0:e.tier)>=1}},{main:true,name:"tier2_workbench",title:ae.TUTORIAL_AETHERBENCH_BUILD_TITLE,prompts:[{context:"gameplay",conditions:["in_qbar_aetherbench","have_mats_aetherbench"],title:ae.TUTORIAL_AETHERBENCH_BUILD_TITLE,msg:ae.separate("\n\n",ae.TUTORIAL_AETHERBENCH_PLACE_PROP_MSG_KEYBOARD,ae.TUTORIAL_AETHERBENCH_PLACE_PROP_MSG_NOTE),msg_touch:ae.separate("\n\n",ae.TUTORIAL_AETHERBENCH_PLACE_PROP_MSG_GENERIC,ae.TUTORIAL_AETHERBENCH_PLACE_PROP_MSG_NOTE)},{context:"menu",conditions:["in_qbar_aetherbench","have_mats_aetherbench"]},{context:"build_menu_and_settlement_tab",conditions:["have_mats_aetherbench"],indicators:[{dir:et.UP,spot_key:"build_menu_workbench",anchor:it,offset:N(-Ye/2,0)}],title:ae.TUTORIAL_AETHERBENCH_SELECT_PROP_TITLE,msg:ae.TUTORIAL_AETHERBENCH_SELECT_PROP_MSG_KEYBOARD.$({build_menu:dt}),msg_touch:ae.TUTORIAL_AETHERBENCH_SELECT_PROP_MSG_GENERIC.$({build_menu:ae.LBL_BUILD_MENU}),pos:{spot_key:"build_menu_workbench",anchor:ot}},{context:"build_menu",conditions:["have_mats_aetherbench"],indicators:[{dir:et.LEFT,spot_key:"build_menu_tab_"+U,anchor:at,offset:N(0,-Ye/2)}],title:ae.TUTORIAL_OPEN_SETTLEMENT_TAB_TITLE,msg:ae.TUTORIAL_AETHERBENCH_SETTLEMENT_TAB_MSG,pos:{spot_key:"build_menu_tab_"+U,anchor:ot}},{context:"menu",conditions:["have_mats_aetherbench"],indicators:[{dir:et.UP,spot_key:"menu_tab_button_"+ne,anchor:it,offset:N(-Ye/2,0)}],title:ae.TUTORIAL_OPEN_BUILD_MENU_TITLE,msg:ae.TUTORIAL_AETHERBENCH_BUILD_TAB_MSG,pos:{spot_key:"menu_tab_button_"+ne,anchor:ot}},{context:"gameplay",conditions:["have_mats_aetherbench"],title:ae.TUTORIAL_OPEN_BUILD_MENU_TITLE,title_touch:ae.TUTORIAL_OPEN_MENU_TITLE,msg:gt,msg_touch:mt},{context:"gameplay",title:ae.TUTORIAL_AETHERBENCH_MATERIALS_TITLE,msg:Et}],todo:{inv:{type:w,id:A},context:q},done:function done(){return checkHook("build_prop_"+A)||checkHook("factory_"+A)}},{main:true,name:"tier2_cord",title:ae.TUTORIAL_CORD_CRAFT_TITLE,prompts:[{context:"factory_aetherbench",conditions:["crafting_cord"],force_menu:true,title:ae.TUTORIAL_CORD_CRAFT_TITLE,msg:ae.TUTORIAL_CORD_TAKE_MSG,w:Lt,pos:{spot_key:"1,0",anchor:tt,offset:N(10,0)}},{context:"factory_aetherbench_and_recipe_cord",conditions:["have_mats_cord"],title:ae.TUTORIAL_CORD_CRAFT_TITLE,msg:ae.TUTORIAL_CORD_PUT_MSG,w:Lt,pos:{spot_key:"1,0",anchor:tt,offset:N(10,0)},indicators:[{dir:et.RIGHT,spot_key:"1,0",anchor:rt,offset:N(-Ye,-Ye/2)},{dir:et.RIGHT,spot_key:"1,1",anchor:rt,offset:N(-Ye,-Ye/2)},{dir:et.RIGHT,pos_hook_key:"inventory_slots",offset:N(-Ye,-Ye/2)}]},{context:"gameplay",conditions:["have_mats_cord"],title:ae.TUTORIAL_GO_TO_AETHERBENCH_TITLE,msg:ae.separate("\n\n",ae.TUTORIAL_CORD_CRAFT_MSG_1,ae.TUTORIAL_CORD_CRAFT_MSG_2),draw:function draw(){return drawPropWorldIndicator(A)}},{context:"gameplay",title:ae.TUTORIAL_CORD_MATERIALS_TITLE,msg:ae.separate("\n\n",ae.TUTORIAL_CORD_MATERIALS_MSG_1,ae.TUTORIAL_CORD_MATERIALS_MSG_2)}],todo:{inv:{type:w,id:E},context:K},done:function done(){return V(Q({type:w,id:E}))}},{main:true,name:"tier2_stonecutter",title:ae.TUTORIAL_STONECUTTERY_BUILD_TITLE,prompts:[{context:"gameplay",conditions:["in_qbar_stonecutter","have_mats_stonecutter"],title:ae.TUTORIAL_STONECUTTERY_BUILD_TITLE,msg:ae.separate("\n\n",ae.TUTORIAL_STONECUTTERY_PLACE_PROP_MSG_KEYBOARD,ae.TUTORIAL_STONECUTTERY_PLACE_PROP_MSG_NOTE),msg_touch:ae.separate("\n\n",ae.TUTORIAL_STONECUTTERY_PLACE_PROP_MSG_GENERIC,ae.TUTORIAL_STONECUTTERY_PLACE_PROP_MSG_NOTE)},{context:"gameplay",conditions:["have_mats_stonecutter"],title:ae.TUTORIAL_STONECUTTERY_BUILD_TITLE,msg:Tt,msg_touch:yt},{context:"gameplay",title:ae.TUTORIAL_STONECUTTERY_MATERIALS_TITLE,msg:It}],todo:{inv:{type:w,id:I},context:q},done:function done(){return checkHook("build_prop_"+I)||checkHook("factory_"+I)}},{main:true,name:"tier2_tool_head",title:ae.TUTORIAL_STONETOOLHEAD_CRAFT_TITLE,prompts:[{context:"gameplay",conditions:["have_mats_stone_tool_head"],title:ae.TUTORIAL_STONETOOLHEAD_CRAFT_TITLE,msg:ae.separate("\n\n  ",ae.TUTORIAL_STONETOOLHEAD_CRAFT_MSG,ae.TUTORIAL_STONETOOLHEAD_CRAFT_MSG_NOTE),draw:function draw(){return drawPropWorldIndicator(I)}},{context:"gameplay",title:ae.TUTORIAL_STONETOOLHEAD_MATERIALS_TITLE,msg:ae.separate("\n\n",ae.TUTORIAL_STONETOOLHEAD_MATERIALS_MSG_1,ae.TUTORIAL_STONETOOLHEAD_MATERIALS_MSG_2)}],todo:{inv:{type:C,id:-1,attr1:"stone_tool_head"},context:K},done:function done(){return checkHook("crafting_"+w+"_"+S)||V(Q({type:w,id:S,attr1:D.STONE}))}},{main:true,name:"tier2_turn_in",prompts:[{context:"gameplay",conditions:["have_mats_tier2"],title:ae.TUTORIAL_UPGRADE_SETTLEMENT_TITLE,msg:ae.TUTORIAL_UPGRADE_SETTLEMENT_SECOND_MSG,draw:drawSettlementWorldIndicator},{context:"gameplay",title:ae.TUTORIAL_UPGRADE_SETTLEMENT_TITLE,msg:ae.TUTORIAL_UPGRADE_SETTLEMENT_SECOND_MSG}],todo:{inv:{type:M,id:-1,attr1:"tier2"},context:X},done:function done(){var e
return(null==(e=ye())?void 0:e.tier)>=2}},{main:true,name:"tier3_woodcutter",title:ae.TUTORIAL_WOODCUTTERY_BUILD_TITLE,prompts:[{context:"gameplay",conditions:["in_qbar_sawmill","have_mats_stonecutter"],title:ae.TUTORIAL_WOODCUTTERY_BUILD_TITLE,msg:ae.separate("\n\n",ae.TUTORIAL_WOODCUTTERY_PLACE_PROP_MSG_KEYBOARD,ae.TUTORIAL_WOODCUTTERY_PLACE_PROP_MSG_NOTE),msg_touch:ae.separate("\n\n",ae.TUTORIAL_WOODCUTTERY_PLACE_PROP_MSG_GENERIC,ae.TUTORIAL_WOODCUTTERY_PLACE_PROP_MSG_NOTE)},{context:"gameplay",conditions:["have_mats_sawmill"],title:ae.TUTORIAL_WOODCUTTERY_BUILD_TITLE,msg:At,msg_touch:St},{context:"gameplay",title:ae.TUTORIAL_WOODCUTTERY_MATERIALS_TITLE,msg:wt}],todo:{inv:{type:w,id:T},context:q},done:function done(){return checkHook("build_prop_"+T)||checkHook("factory_"+T)}},{main:true,name:"tier3_pickax",title:ae.TUTORIAL_PICKAX_CRAFT_TITLE,prompts:[{context:"gameplay",conditions:["have_mats_pickax"],title:ae.TUTORIAL_PICKAX_CRAFT_TITLE,msg:ae.separate("",ae.TUTORIAL_PICKAX_CRAFT_MSG,"\n\n",ae.TUTORIAL_PICKAX_CRAFT_MSG_HINT),draw:function draw(){return drawPropWorldIndicator(A)}},{context:"gameplay",title:ae.TUTORIAL_PICKAX_MATERIALS_TITLE,msg:ae.separate("\n\n",ae.TUTORIAL_PICKAX_MATERIALS_MSG_1,ae.TUTORIAL_PICKAX_MATERIALS_MSG_2,ae.TUTORIAL_PICKAX_MATERIALS_MSG_HINT)}],todo:{inv:{type:C,id:-1,attr1:"pickax"},context:K},done:function done(){return checkHook("crafting_"+w+"_"+y)||z.contents[0]}},{main:true,name:"final",prompts:[{context:"gameplay",title:ae.TUTORIAL_COMPLETE_TITLE,msg:ae.separate("\n\n",ae.TUTORIAL_COMPLETE_MSG,ae.TUTORIAL_COMPLETE_MSG_NEXT_STEPS)}],dismiss:true,auto_dismiss:30},{main:true,name:"finished",prompts:[]}]
var Nt=o(null,{color:255,outline_width:1,outline_color:3149642751})
function tutorialSet(e,t){Ot=false
Ke={}
Rt=e
if(t){var r=bt[e]
De("tut",r&&r.name||void 0)}}function tutorialReset(e){tutorialSet(0,e)}function isTutorialState(e){for(var t=0;t<bt.length;++t){var r=bt[t]
if(r&&r.name===e)return true}return false}function tutorialStartByName(e,t,r){if(!e){tutorialReset(t)
return}for(var a=0;a<bt.length;++a){var i=bt[a]
if(i&&i.name===e){if(Rt&&i.no_interrupt&&!r)return
tutorialSet(a,t)
xt=0
return}}if(s("none"===e,"Tried to start unknown tutorial "+e))tutorialReset()}function tutorialState(){return bt[Rt]}var Ct
var Mt=50
var Dt=40
function tutorialStartup(){Ct=O.font
st=pe();(ut=new F(Mt)).setRange(Dt)}var Pt={tier1_turn_in:"tier1",tier2_cord2:"tier2_cord",tier2_cord3:"tier2_cord",tier2_tool_head2:"tier2_tool_head",tier3_pickax2:"tier3_pickax",tier3_pickax3:"tier3_pickax"}
function tutorialInit(e,t){if(!e&&We()){var r=t||"default"
if("default"===r)Te(r,function(e){if(!(e.tier>1))tutorialStartByName("adventure_start")})}if(e)tutorialStartByName(Pt[e]||e)}function promptIsInMenu(e){return Boolean(e.context&&Qe[e.context])}function advanceState(e){var t=bt[Rt]
a(e||t)
if(t)if(void 0!==t.next)tutorialStartByName(t.next||void 0,t.main)
else{xt=0
tutorialSet(Rt+1,t.main)}}function regressState(e){var t=bt[Rt]
a(e||t)
if(t){xt=0
tutorialSet(Rt-1,t.main)}}var kt=N()
var Bt
function tutorialUnderMenuY1(){return Bt}var Ut=false
function tutorialLeaveWorld(){if(Ut){Ut=false
O.modalDialogClear()}}var Gt=N()
function getTutRealPos(e){var t
if(isSpotPos(e)){var r=e.spot_key,a=e.anchor,i=e.offset
a=a||m
var o=d(r,true)
if(o){var n=o.dom_pos,s=o.w,l=o.h
Gt[0]=n.x
Gt[1]=n.y
L.domToVirtual(Gt,Gt)
Gt[0]+=s*a[0]
Gt[1]+=l*a[1]
t=i}else return null}else{var c=e.pos_hook_key,_=e.offset
var u=$e[c]
if(u){v(Gt,u)
t=_}else return null}if(t)f(Gt,Gt,t)
return Gt}function drawUIIndicator(e){var t=getTutRealPos(e)
if(t){var r=e.dir
var a=0
var i=0
var o=0
var n=0
switch(r){case et.LEFT:o=a=1
break
case et.UP:n=a=i=1
break
case et.RIGHT:o=-(i=1)
break
default:et.DOWN
n=-1}var s=30*ze(Ve(.005*R.getFrameTimestamp()))
Ne.sprite.draw({x:t[0]+a*Ye+o*s,y:t[1]+i*Ye+n*s,z:Z.TUT_INDICATOR,rot:r,w:Ye,h:Ye,color:qe,frame:Ne.ARROW})}}function calculateTutorialUnderMenuPos(e){if(re())kt[0]=L.x0()+(Ot?10:0)
else kt[0]=L.x1()-(Ot?O.button_height+10:e)
kt[1]=O.button_height+16
if(Ae())kt[1]+=O.button_height+$
if(ge())kt[1]+=O.button_height+$}var Ft=false
function tutorialForcingMenu(){return Ft}var Wt=false
function tutorialTickEnd(){Ze={}
$e={}
if(Wt){ee()
Wt=false}}function tutorialTickEndEarly(){calculateTutorialUnderMenuPos(0)
Bt=kt[1]
tutorialTickEnd()}var jt=450
var Ht=24
var zt=16
var Vt=0
var Yt=50
var qt=N()
function tutorialTick(){Ft=false
var e=bt[Rt]
if(!e||!e.show_as_visitor&&Pe()){tutorialTickEndEarly()
return}var t=false
while(true){var r=e.todo
if(r&&!ue())be(r.inv,r.context,xe)
if(e.done&&e.done()){if(r)Oe(r.inv,r.context)
if(!t){t=true
if(e.title){we.push(ae.separateColon(ae.LBL_COMPLETED,e.title))
je("tutorial_step_complete")}}advanceState()
if(!(e=bt[Rt])){tutorialTickEndEarly()
return}}else break}var a
var i
for(var o=0;o<e.prompts.length;++o){a=e.prompts[o]
if(Xe[a.context]()){var n=false
if(a.conditions)for(var s=0;s<a.conditions.length;++s)if(!Je[a.conditions[s]]())n=true
if(!n){i=x.touch_mode&&a.msg_touch||a.msg
if(promptIsInMenu(a))if(t)i=void 0
else Ft=a.force_menu||false
break}}}if(!a){tutorialTickEndEarly()
return}var l=a.w||jt
var c=l-2*zt
var _=(l-50)/2
var u=N()
calculateTutorialUnderMenuPos(l)
var d=a.pos||{pos_hook_key:"tut_under_menu"}
var f=kt[0]
var v=kt[1]
var h=v
var p=false
if(!Ot){if(promptIsInMenu(a)){te()
Wt=true
ve(Qe[a.context])}b(u,L.x0()+(L.w()-l)/2,L.y0())
tutorialPosHook("tut_top_center",u)
tutorialPosHook("tut_under_menu",kt)
var m=getTutRealPos(d)
if(m){f=m[0]
h=(v=m[1])+zt}else i=void 0}if(i){var g=Ct.numLines(Nt,c,Vt,Ht,i)*Ht+1.5*Ht+2*zt+8
if(!Ot&&a.draw)a.draw()
if(Ot){p=true
if(O.buttonImage({x:f,y:h,z:Z.MENUBUTTON,img:Ne.sprite,frame:Ne.QUESTION_MARK,tooltip:ae.TLTP_SHOW_TUTORIAL})){Ot=false
if(promptIsInMenu(a)){Bt=h+O.button_height+zt
tutorialTickEnd()
return}}h+=O.button_height+zt}else{var E=x.touch_mode&&a.title_touch||a.title||e.title||ae.TUTORIAL_HINT_TITLE
var y=ae.separate(" ","~",E,"~")
O.title_font.drawSizedAligned(Le,f+zt,h,Z.TUT,1.5*Ht,Ct.ALIGN.HCENTERFIT,l-2*zt,0,y)
h+=1.5*Ht+8
h+=Ct.drawSizedWrapped(Nt,f+zt,h,Z.TUT,c,Vt,Ht,i)
h+=8
if(e.dismiss){g+=Yt
var T=ae.BTN_DISMISS
var I=false
if(e.auto_dismiss){if(!xt)xt=1e3*e.auto_dismiss
else if((xt-=R.frame_dt)<=0){xt=0
I=true}T=ae.addParenthesesAfter(T,(xt/1e3).toFixed(0))}if(O.buttonText({x:f+l-_-zt,y:h,z:Z.TUT,w:_,h:Yt,text:T})||I)advanceState()}else if(e.main&&!e.unskippable){g+=Yt
if(O.buttonText({x:f+zt,y:h,z:Z.TUT,w:_,h:Yt,text:ae.BTN_HIDE}))Ot=true
if(O.buttonText({x:f+_+2*zt,y:h,z:Z.TUT,w:_,h:Yt,text:a.skip_freely?ae.BTN_SKIP:ae.addEllipsis(ae.BTN_SKIP)}))if(a.skip_freely)advanceState()
else{Ut=true
O.modalDialog({title:ae.DLG_SKIP_TUTORIAL_TITLE,text:ae.DLG_SKIP_TUTORIAL_MSG_ALREADY_KNOW+"\n\n"+ae.DLG_SKIP_TUTORIAL_MSG_OPTIONS,buttons:{skip_step:{label:ae.BTN_SKIP_STEP,cb:function cb(){Ut=false
advanceState()},in_event_cb:!x.touch_mode?x.pointerLockEnter:null},skip_all:{label:ae.BTN_SKIP_ALL,cb:function cb(){Ut=false
tutorialStartByName("finished",true)
k("tutorial_skip_all",Number(Rt))},in_event_cb:!x.touch_mode?x.pointerLockEnter:null},cancel:{cb:function cb(){Ut=false},in_event_cb:!x.touch_mode?x.pointerLockEnter:null}}})}}if(e.action&&e.action_text)if(O.buttonText({x:f+l-2*_-2*zt,y:h,z:Z.TUT,w:_,h:Yt,text:e.action_text})){e.action()
Rt=0}O.panel({x:f,y:v,z:Z.TUT-1,w:l,h:g,pixel_scale:.5*O.panel_pixel_scale})
h=v+g+zt}tutorialPosHook("tut_window_left",b(qt,f-Ye,0))
var S=a.indicators
if(S&&!Ot)for(var A=0;A<S.length;++A)drawUIIndicator(S[A])}var w="tut_under_menu"===d.pos_hook_key||p
Bt=w?h:kt[1]
tutorialTickEnd()}i.register({cmd:"tut",access_show:["sysadmin"],help:"(Hidden) Get/set current tutorial stage",usage:"  Get tutorial stage: /tut\n  Set tutorial stage: /tut [<STAGE_NAME>|PREVIOUS|NEXT|RESET]",prefix_usage_with_help:true,func:function func(e,t){if(e){var r=e.toLowerCase()
if("previous"===r)regressState(true)
else if("next"===r)advanceState(true)
else if("reset"===r)tutorialStartByName("adventure_start",true)
else if(isTutorialState(e))tutorialStartByName(e,true,true)
else return void t("Invalid Tutorial State.")}t(null,"Tutorial state = "+JSON.stringify(Me("tut")))}})},{"../common/ids":198,"../common/materials_common":201,"../common/world_trans":213,"../glov/client/camera2d":241,"../glov/client/cmds":244,"../glov/client/engine":250,"../glov/client/font":260,"../glov/client/input":271,"../glov/client/spot":300,"../glov/client/ui":306,"../glov/common/util.js":330,"../glov/common/verify":331,"../glov/common/vmath":332,"./analytics":5,"./build_menu":26,"./chunk_searcher":33,"./debug":62,"./fbinstant_worlds":80,"./inventory":94,"./items":98,"./layout":99,"./localization/localization":108,"./main":112,"./menu":117,"./photo_mode":128,"./props.js":141,"./quickbar.js":142,"./race_ui":144,"./settlement":148,"./settlement_edit":149,"./share_menu":150,"./status":156,"./styles":160,"./todo_list":165,"./ui_util":168,"./user_data":170,"./voxel_data.js":175,"./waygate_ui":179,"./world_comm":182,"./world_metadata":186,"./worlds_sound":187,assert:void 0}],167:[function(e,t,r){"use strict"
function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]
for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))e[a]=r[a]}return e}).apply(this,arguments)}var a={block_break_dirt:[{file:"blocks/block_dirt_destroy1",volume:1},{file:"blocks/block_dirt_destroy2",volume:1},{file:"blocks/block_dirt_destroy3",volume:1},{file:"blocks/block_dirt_destroy4",volume:1}],block_place_dirt:["blocks/block_dirt_place1","blocks/block_dirt_place2","blocks/block_dirt_place3","blocks/block_dirt_place4"],block_break_stone:["blocks/block_stone_destroy1","blocks/block_stone_destroy2","blocks/block_stone_destroy3","blocks/block_stone_destroy4"],block_place_stone:["blocks/block_stone_place1","blocks/block_stone_place2","blocks/block_stone_place3","blocks/block_stone_place4"],block_break_wood:["blocks/block_wood_destroy1","blocks/block_wood_destroy2","blocks/block_wood_destroy3","blocks/block_wood_destroy4"],block_place_wood:["blocks/block_wood_place1","blocks/block_wood_place2","blocks/block_wood_place3","blocks/block_wood_place4"],block_break_metal:["blocks/block_metal_destroy1","blocks/block_metal_destroy2","blocks/block_metal_destroy3","blocks/block_metal_destroy4"],block_place_metal:["blocks/block_metal_place1","blocks/block_metal_place2","blocks/block_metal_place3","blocks/block_metal_place4"],block_break_coal:["blocks/block_coal_destroy1","blocks/block_coal_destroy2","blocks/block_coal_destroy3","blocks/block_coal_destroy4"],block_place_coal:["blocks/block_coal_place1","blocks/block_coal_place2","blocks/block_coal_place3","blocks/block_coal_place4"],character_enter_water:["character/footstep_enter_water1","character/footstep_enter_water2"],character_enter_flying:{file:"character/character_enter_flying",volume:.7},character_exit_flying:{file:"character/character_exit_flying",volume:.7},jump:["character/jump1","character/jump2","character/jump3"],land_dirt:["character/land_dirt1","character/land_dirt2","character/land_dirt3"],land_wood:["character/land_wood1","character/land_wood2","character/land_wood3"],land_stone:["character/land_stone1","character/land_stone2","character/land_stone3"],land_metal:["character/land_metal1","character/land_metal2","character/land_metal3"],fall_damage:["character/fall_damage1","character/fall_damage2"],pickup:["items/pickup1","items/pickup2","items/pickup3"],pickup_gem:["items/pickup_crystal1","items/pickup_crystal2"],plant_harvest:["items/harvest_plant1","items/harvest_plant2","items/harvest_plant3","items/harvest_plant4"],bucket_fill:["items/bucket_fill1","items/bucket_fill2"],bucket_place_liquid:["items/bucket_place_liquid1","items/bucket_place_liquid2"],bucket_water_crops:["items/bucket_water_crops1","items/bucket_water_crops2"],chest_open:"props/chest_open",door_open:["props/door_open1","props/door_open2"],door_close:["props/door_close1","props/door_close2"],waygate_upgrade:"fanfares/fanfare_waygate_upgrade",button_click:{file:"ui/ui_button",volume:1},rollover:"ui/ui_rollover",msg_err:"ui/msg_err",msg_in:"ui/msg_in",msg_out:"ui/msg_out",msg_out_err:"ui/msg_out_err",user_join:"ui/user_join",user_leave:"ui/user_leave",purchase:["items/pickup_crystal1","items/pickup_crystal2"],silence:"silence"}
var i={factory_open:"legacy/items/pickup_old",race_start:"legacy/ui/msg_out",race_end:"legacy/ui/msg_in",tool_break:"legacy/ui/msg_out_err",land_coal:a.land_stone,prop_place_wood:a.block_place_wood,prop_place_stone:a.block_place_stone,prop_place_dirt:a.block_place_dirt,prop_place_metal:a.block_place_metal,prop_place_coal:a.block_place_coal,hoe:a.block_place_dirt,crop_harvest:a.block_break_dirt,race_ready:a.block_place_dirt,plant_harvest_empty:a.plant_harvest,energy_well_drink:a.pickup_gem,tutorial_step_complete:a.pickup_gem}
o=o||{}
var o=_extends({},a,i)
t.exports=o},{}],168:[function(e,t,r){"use strict"
r.getUIUtilSprite=getUIUtilSprite
r.getUIUtilSpriteCentered=getUIUtilSpriteCentered
r.uiUtilStartup=uiUtilStartup
r.STAMINA_SYMBOL=r.INFINITY_SYMBOL=r.GEM_SYMBOL=r.BLANK=r.FILTER=r.TROPHY=r.LIKE_ACTIVE=r.LIKE=r.GEMS=r.USER_PROFILE=r.SOCIAL=r.SORT=r.EDIT=r.WORLD_INFO=r.PLAYER=r.BLUEBOX_EDIT=r.BLUEBOX_PRE_EDIT=r.BLUEBOX_PRE_BUILD=r.BLUEBOX_BUILD=r.HOME=r.BUILD=r.ARROW=r.CHECK=r.GATHERING_TOOLS=r.EMPTY_BLUEPRINT=r.SEARCH=r.BLUEPRINTS=r.TIME=r.ENERGY_WELL=r.VIEWS=r.WAYGATE=r.ADVENTURE_MODE=r.SPRINT=r.PIN=r.PINNED=r.TAB_TOOLS=r.TELEPORT=r.RESIZE=r.LOCK=r.QUESTION_MARK=r.HANDS=r.BROKEN=r.SETTLEMENT_PROPS=r.TRASH=r.PROPS=r.CRAFTED_BLOCKS=r.RAW_BLOCKS=r.SETTINGS=r.OUTPUT=r.INPUT=r.SLOT_SHOVEL=r.SLOT_HATCHET=r.SLOT_PICKAX=r.CONTAINER=r.CRAFTING=r.INVENTORY=r.X=r.MENU=r.SHARE=r.CROSSHAIR=r.sprite_centered=r.sprite=void 0
var a=e("../glov/client/sprites").spriteCreate
var i
r.sprite=i
var o
r.sprite_centered=o
function getUIUtilSprite(){return i}function getUIUtilSpriteCentered(){return o}function uiUtilStartup(){r.sprite=i=a({url:"img/ui_util.png",ws:[1,1,1,1,1,1,1,1],hs:[1,1,1,1,1,1,1,1],filter_min:gl.LINEAR_MIPMAP_LINEAR,filter_mag:gl.LINEAR})
r.sprite_centered=o=a({url:"img/ui_util.png",ws:[1,1,1,1,1,1,1,1],hs:[1,1,1,1,1,1,1,1],origin:[.5,.5],filter_min:gl.LINEAR_MIPMAP_LINEAR,filter_mag:gl.LINEAR})}var n=0
r.CROSSHAIR=n
var s=2
r.SHARE=s
var l=3
r.MENU=l
var c=4
r.X=c
var _=5
r.INVENTORY=_
var u=6
r.CRAFTING=u
var d=7
r.CONTAINER=d
var f=8
r.SLOT_PICKAX=f
var v=9
r.SLOT_HATCHET=v
var h=10
r.SLOT_SHOVEL=h
var p=11
r.INPUT=p
var m=12
r.OUTPUT=m
var g=13
r.SETTINGS=g
var E=14
r.RAW_BLOCKS=E
var y=15
r.CRAFTED_BLOCKS=y
var T=16
r.PROPS=T
var I=17
r.TRASH=I
var S=18
r.SETTLEMENT_PROPS=S
var A=19
r.BROKEN=A
var w=20
r.HANDS=w
var L=21
r.QUESTION_MARK=L
var R=22
r.LOCK=R
var x=23
r.RESIZE=x
var O=24
r.TELEPORT=O
var b=26
r.TAB_TOOLS=b
var N=27
r.PINNED=N
var C=28
r.PIN=C
var M=30
r.SPRINT=M
var D=32
r.ADVENTURE_MODE=D
var P=33
r.WAYGATE=P
var k=34
r.VIEWS=k
var B=36
r.ENERGY_WELL=B
var U=37
r.TIME=U
var G=40
r.BLUEPRINTS=G
var F=41
r.SEARCH=F
var W=42
r.EMPTY_BLUEPRINT=W
var j=43
r.GATHERING_TOOLS=j
var H=44
r.CHECK=H
var z=45
r.ARROW=z
var V=46
r.BUILD=V
var Y=47
r.HOME=Y
var q=48
r.BLUEBOX_BUILD=q
var K=49
r.BLUEBOX_PRE_BUILD=K
var Z=50
r.BLUEBOX_PRE_EDIT=Z
var X=51
r.BLUEBOX_EDIT=X
var Q=52
r.PLAYER=Q
var J=53
r.WORLD_INFO=J
var $=54
r.EDIT=$
var ee=55
r.SORT=ee
var te=56
r.SOCIAL=te
var re=57
r.USER_PROFILE=re
var ae=58
r.GEMS=ae
var ie=59
r.LIKE=ie
var oe=60
r.LIKE_ACTIVE=oe
var ne=61
r.TROPHY=ne
var se=62
r.FILTER=se
var le=63
r.BLANK=le
var ce="♦"
r.GEM_SYMBOL=ce
var _e="∞"
r.INFINITY_SYMBOL=_e
var ue="⚡"
r.STAMINA_SYMBOL=ue},{"../glov/client/sprites":302}],169:[function(e,t,r){"use strict"
r.getUIUtil2Sprite=getUIUtil2Sprite
r.uiUtil2Startup=uiUtil2Startup
r.EXCLAMATION=r.EYES=r.HAIR=r.SKIN=r.PAINT=r.LEGS=r.ARMS=r.TORSO=r.HEAD=r.COSTUME=r.CUSTOMIZE=r.sprite=void 0
var a=e("../glov/client/sprites").spriteCreate
var i
r.sprite=i
function getUIUtil2Sprite(){return i}function uiUtil2Startup(){r.sprite=i=a({url:"img/ui_util_2.png",ws:[1,1,1,1,1,1,1,1],hs:[1,1,1,1,1,1,1,1],filter_min:gl.LINEAR_MIPMAP_LINEAR,filter_mag:gl.LINEAR})}var o=0
r.CUSTOMIZE=o
var n=1
r.COSTUME=n
var s=2
r.HEAD=s
var l=3
r.TORSO=l
var c=4
r.ARMS=c
var _=5
r.LEGS=_
var u=6
r.PAINT=u
var d=7
r.SKIN=d
var f=8
r.HAIR=f
var v=9
r.EYES=v
var h=10
r.EXCLAMATION=h},{"../glov/client/sprites":302}],170:[function(e,t,r){"use strict"
r.isPlayAsViewer=isPlayAsViewer
r.userDataStartWaiting=userDataStartWaiting
r.userDataIsWaiting=userDataIsWaiting
r.userDataGet=userDataGet
r.worldReadOnlyBypassPlayingAs=worldReadOnlyBypassPlayingAs
r.worldReadOnly=worldReadOnly
r.userAccessLevel=userAccessLevel
r.shouldHaveAvatar=shouldHaveAvatar
r.flyingAllowed=flyingAllowed
r.blueprintAllowed=blueprintAllowed
r.waygateEditAllowed=waygateEditAllowed
r.editOutsideVolumeAllowed=editOutsideVolumeAllowed
r.establishSettlementAllowed=establishSettlementAllowed
r.areaClearAllowed=areaClearAllowed
r.manageVolumesAllowed=manageVolumesAllowed
r.raceJoinAllowed=raceJoinAllowed
r.raceEditAllowed=raceEditAllowed
r.followUserAllowed=followUserAllowed
r.playAsViewerSet=playAsViewerSet
r.userDataSetEx=userDataSetEx
r.userDataSet=userDataSet
r.userDataPredict=userDataPredict
r.userDataGemsFound=userDataGemsFound
r.userDataLeaveWorld=userDataLeaveWorld
r.setAccessLevel=setAccessLevel
r.userAttribGet=userAttribGet
r.userAttribs=userAttribs
r.userAttribGetFixed=userAttribGetFixed
r.userAttribModBatched=userAttribModBatched
r.userDataSetOnNextAttribFlush=userDataSetOnNextAttribFlush
r.userAttribModTrans=userAttribModTrans
r.userAttribModMaxBatched=userAttribModMaxBatched
r.userAttribModMaxTrans=userAttribModMaxTrans
r.userAttribUndoTransactionOp=userAttribUndoTransactionOp
r.userStaminaMax=userStaminaMax
r.userStaminaCur=userStaminaCur
r.userStaminaMod=userStaminaMod
r.userO2Max=userO2Max
r.userO2Cur=userO2Cur
r.userAttribGetDigRate=userAttribGetDigRate
r.staminaUsageScale=staminaUsageScale
r.setStaminaUsageScaleMod=setStaminaUsageScaleMod
r.userAttribGetSprintingStaminaScale=userAttribGetSprintingStaminaScale
r.userAttribTick=userAttribTick
r.userLastEnergyWellTime=userLastEnergyWellTime
r.userLastWaygateTime=userLastWaygateTime
r.userHomeSettlementID=userHomeSettlementID
r.init=init
r.stamina_mods_table=r.BLOOD_MOON_MOD=r.MORALE_BOOST_MOD=r.STAMINA_BASE_MAX=void 0
var a=1e4
r.STAMINA_BASE_MAX=a
var i=0
r.MORALE_BOOST_MOD=i
var o=1
r.BLOOD_MOON_MOD=o
var n=[["Team Morale Bonus",.15,false],["Blessed By The Moon",.2,false]]
r.stamina_mods_table=n
r.isWaiting=userDataIsWaiting
r.get=userDataGet
r.set=userDataSet
var _=e("./localization/localization").L
var s=e("../common/roles_common").classifyRole
var l=e("./analytics.js").logEvent
var c=e("assert")
var u=e("./build_mode.js").doStamina
var d=e("./crafting_mods.js"),f=d.CMODS,v=d.CMOD_TABLE
var h=e("../glov/common/dot-prop.js")
var p=e("./editvolume_client.js").updateEditVolumes
var m=e("./energy_well.js").energyWellFixupTimes
var g=e("../glov/client/engine.js")
var E=e("../glov/client/error_report.js").errorReportSetDynamicDetails
var y=e("./huds.js").showStaminaDamage
var T=e("./inventory.js").inventoryLoad
var I=e("./main.js")
var S=I.getFrameTransaction
var A=e("../glov/client/net.js").netDisconnected
var w=Math.min,L=Math.round
var R=e("./quickbar.js").quickbarLoad
var x=e("./red_dot.js").redDotWorldInit
var O=e("./status.js")
var b=e("./todo_list.js").todoListInit
var N=e("./tutorial.js").tutorialInit
var C=e("../glov/common/util.js"),M=C.clamp,D=C.empty
var P=e("./voxel_chunk_manager.js").releaseClaimed
var k=e("./world_comm.js"),B=k.getWorldID,U=k.worldGetClients,G=k.worldGetRoles,F=k.worldRefreshUserData,W=k.worldSetUserData
var j=e("../common/world_constants.js"),H=j.ACCESS_SPECTATOR,z=j.ACCESS_READONLY,V=j.ATTRIB_FIXED_MAX,Y=j.THRESHOLD_ACCESS_AVATAR,q=j.THRESHOLD_ACCESS_MODIFY,K=j.THRESHOLD_ACCESS_MANAGE_VOLUMES,Z=j.WAYGATE_FLAG_SETTLEMENT
var X=e("./world_metadata.js")
var Q=X.adventureMode,J=X.unlimitedMode,$=X.worldAccessAreaClear,ee=X.worldAccessExvolume,te=X.worldAccessSettlement,re=X.worldHasGems,ae=X.worldMetadataWaygate,ie=X.worldMetadataFreePos
var oe=true
var ne
var se
var le
var ce=false
var _e=false
var ue={pos:1,pos_adv:1,wg:1,home:1,quickbar:1,wg_time:1,well_time:1,reddot:1,tut:1,todo:1,race_data:1,inventory:1,equip:1,gems_claimed:1,liked:1,used_free_settlement:1}
var de=false
function isPlayAsViewer(){return de}function userDataStartWaiting(e){oe=true
se=ne=null
de=false
c(!ce||e)}function userDataIsWaiting(){return oe}function userDataGet(e){c(!oe)
if(ue[e])return ne[e]
else{var t=e.split(".")[0]
c(ue[t])
return h.get(ne,e)}}function worldReadOnlyBypassPlayingAs(){return oe||!(ne.access_level>=q)}function worldReadOnly(){return oe||!(ne.access_level>=q)||de}function userAccessLevel(){if(oe)return H
var e=ne.access_level
if(de)e=w(e,z)
return e}function shouldHaveAvatar(){return userAccessLevel()>=Y}function flyingAllowed(){return oe||userAccessLevel()>=X.world_data.access_fly}function blueprintAllowed(){return!oe&&userAccessLevel()>=X.world_data.access_blueprint}function waygateEditAllowed(){return!oe&&userAccessLevel()>=X.world_data.access_waygate}function editOutsideVolumeAllowed(){return!oe&&userAccessLevel()>=ee()}function establishSettlementAllowed(){return!oe&&Q()&&userAccessLevel()>=te()}function areaClearAllowed(){return!oe&&J()&&userAccessLevel()>=$()}function manageVolumesAllowed(){return!oe&&userAccessLevel()>=K&&editOutsideVolumeAllowed()}function raceJoinAllowed(){return!oe&&userAccessLevel()>=X.world_data.access_race_join}function raceEditAllowed(){return!worldReadOnly()&&userAccessLevel()>=X.world_data.access_race_edit}function followUserAllowed(){return ie()}var fe
function playAsViewerSet(e){c(de!==e)
if(de=e){P()
fe=I.char_controller.getPosString()}else{c(fe)
if(u())I.char_controller.updatePosFromString(fe,false)}p()}var ve=0
var he=0
var pe=1e3
function doFlush(){ve=g.frame_timestamp
c(ce)
function finalCb(){--he}for(var e in le){he++
W(e,ne[e],finalCb)}le={}
ce=false}var me=false
function tick(){profilerStart("tick")
if(he<0)he=0
if(!ce||!I.omp)me=false
else if(A()||oe||he||g.frame_timestamp-ve<pe)setTimeout(tick,pe/2)
else{doFlush()
me=false}profilerStop("tick")}function startTick(){if(me)return
me=true
tick()}function userDataSetEx(e,t,r){c(!oe)
c(ue[e])
c(_e)
ne[e]=ne[e]||{}
ne[e][t]=r
var a=JSON.stringify(ne[e])
if(a===se[e])return
se[e]=a
le[e]=true
ce=true
startTick()}function userDataSet(e,t){c(!oe)
c(ue[e])
c(_e)
var r=JSON.stringify(t)
if(r===se[e])return
ne[e]=t
se[e]=r
le[e]=true
ce=true
startTick()}function userDataPredict(e,t,r){c(!oe)
h.set(ne,e,t)
if(ue[e]&&r)se[e]=JSON.stringify(t)}function userDataGemsFound(){return Object.keys(ne.gems_claimed||{}).length}function userDataLeaveWorld(){if(ce)if(A()){ce=false
le={}}else doFlush()
_e=false}function setAccessLevel(e){if(!ne)return
ne.access_level=e
p()}var ge
var Ee
function userAttribGet(e){return ge[e]||0}function userAttribs(){return ge}function userAttribGetFixed(e){return userAttribGet(e)/V}function userAttribGetTimedMod(e){var t=1
for(var r in ge)if(r.startsWith(f.TIMED))if(r.split("_")[1]===e)t+=v[r]-1
return t}var ye
function userStaminaInit(){ye=L(a*userAttribGetTimedMod(f.STAMINA_CAPACITY))}function userAttribModBatched(e,t){ge[e]=(ge[e]||0)+t
if(!ge[e])delete ge[e]
Ee[e]=(Ee[e]||0)+t
if(!Ee[e])delete Ee[e]
if("stamina"===e||e.startsWith("t_stamcap"))userStaminaInit()}var Te
function userDataSetOnNextAttribFlush(e,t){c(ue[e])
if(!Te)Te={}
userDataPredict(e,t,false)
Te[e]=t}function handleUserAttribTransComplete(e){if(e)F()}var Ie=0
function flushBatched(e,t){var r=false
for(var a in Ee){var i=Ee[a]
c(i)
if(!t)t=e.transPre()
t.opUserAttrib(a,i)
r=true}if(r)Ee={}
if(Te){for(var o in Te)userDataSet(o,Te[o])
Te=null}Ie=g.frame_timestamp
if(t)t.onComplete(handleUserAttribTransComplete)}function userAttribModTrans(e,t,r){flushBatched(e.tset)
c(r)
var a=(ge[t]||0)+r
c(a>=0)
if(a)ge[t]=a
else delete ge[t]
e.opUserAttrib(t,r)
e.onComplete(handleUserAttribTransComplete)}function userAttribModMaxBatched(e,t){var r=ge[e]||0
if(t>r)userAttribModBatched(e,t-r)}function userAttribModMaxTrans(e,t,r){var a=ge[t]||0
if(r>a)userAttribModTrans(e,t,r-a)}function userAttribUndoTransactionOp(e){ge[e.attrib]=(ge[e.attrib]||0)-e.delta
if(!ge[e.attrib])delete ge[e.attrib]}function userStaminaMax(){return ye}function userStaminaCur(){return L(userAttribGetFixed("stamina")*a)}function staminaToAttrib(e){return L(e/a*V)}function userStaminaMod(e,t){var r=userAttribGet("stamina")
var a=staminaToAttrib(M(userStaminaCur()+t,0,ye))
if(a===r)return
var i=a-r
if(e)userAttribModTrans(e,"stamina",i)
else userAttribModBatched("stamina",i)}function userO2Max(){return 100}function userO2Cur(){return(1-userAttribGetFixed("o2"))*userO2Max()}function userAttribGetDigRate(){return userAttribGetTimedMod(f.DIG_RATE)}function staminaUsageScale(){var e=1
for(var t=0;t<n.length;t++){var r=n[t]
if(r[2])e-=r[1]}return e}function setStaminaUsageScaleMod(e,t){n[e][2]=t}function userAttribGetSprintingStaminaScale(){return 1/userAttribGetTimedMod(f.SPRINTING_STAMINA)*staminaUsageScale()}function userAttribGetO2UsageScale(){return 1/userAttribGetTimedMod(f.O2_CAPACITY)}var Se=1e3
var Ae=1/(1e3*20)
var we=-1/(1e3*5)
var Le=100
function userAttribTick(e){var t=0
if(u()){var r=userAttribGet("o2")
t=r/V
var a=e?Ae*userAttribGetO2UsageScale():we
t=M(t+g.frame_dt*a,0,1)
var i=L(t*V)
if(i!==r)userAttribModBatched("o2",i-r)}if((Se-=g.frame_dt)>0||A()||worldReadOnly())return
if((Se+=1e3)<0)Se=0
if(u()){var o=userStaminaCur()-userStaminaMax()
if(o>0)userStaminaMod(null,-o)}if(t>=1&&u()){var n=L(Le*staminaUsageScale())
userStaminaMod(null,-n)
y(n,"drowning")}for(var s in ge)if(s.startsWith(f.TIMED)){var l=v[s]
if(!l){O.push(_.$(_.STATUSMSG_UNKNOWN_USERATTRIB,"user_attrib",s))
userAttribModBatched(s,-ge[s])
continue}var c=1
if(ge[s]<0)c=ge[s]
userAttribModBatched(s,-c)
if(s.split("_")[1]===f.STAMINA)userStaminaMod(null,l*c)}if(D(Ee))Ie=g.frame_timestamp
else if(g.frame_timestamp-Ie>1e4)flushBatched(null,S())}function userLastEnergyWellTime(){return ne.well_time||0}function userLastWaygateTime(){return ne.wg_time||0}function userHomeSettlementID(){var e=ne.home||"default"
var t=ae(e)
if(!t||!(t.flags&Z))e="default"
return e}function logGamePlayStart(){var e={}
var t=B()
e.gems=re()
e.players=Object.keys(U()).length
e.role=s(G(),false)
e.world_mode="un"
if(Q())e.world_mode="lf"
e.access_level=ne.access_level
l("game_play_start",1,null,String(t),e)}var Re=false
function userDataStartup(){Re=true
E("user_data",function(){return JSON.stringify(ne)})}function init(e){if(!Re)userDataStartup()
c(oe)
c(e)
c(I.omp)
_e=true
ge=(ne=e).attribs=e.attribs||{}
userStaminaInit()
Ee={}
Te=null
se={}
le={}
ce=false
he=0
for(var t in ne)se[t]=JSON.stringify(ne[t])
if(!I.omp)ne.access_level=Infinity
oe=false
x(e.reddot||{})
m()
N(e.tut)
b(e.todo)
T()
R()
logGamePlayStart()}},{"../common/roles_common":206,"../common/world_constants.js":212,"../glov/client/engine.js":250,"../glov/client/error_report.js":255,"../glov/client/net.js":279,"../glov/common/dot-prop.js":319,"../glov/common/util.js":330,"./analytics.js":5,"./build_mode.js":27,"./crafting_mods.js":58,"./editvolume_client.js":72,"./energy_well.js":73,"./huds.js":87,"./inventory.js":94,"./localization/localization":108,"./main.js":112,"./quickbar.js":142,"./red_dot.js":146,"./status.js":156,"./todo_list.js":165,"./tutorial.js":166,"./voxel_chunk_manager.js":174,"./world_comm.js":182,"./world_metadata.js":186,assert:void 0}],171:[function(e,t,r){"use strict"
r.formatPresence=formatPresence
r.userInfoGet=userInfoGet
r.userInfoIsWorldsTeam=userInfoIsWorldsTeam
r.userGetWorldAndPos=userGetWorldAndPos
r.userInfoViewClear=userInfoViewClear
r.userInfoViewing=userInfoViewing
r.viewUser=viewUser
r.userInfoViewTick=userInfoViewTick
r.USER_VIEW_H=r.USER_VIEW_W=void 0
var de=600
r.USER_VIEW_W=de
var fe=445
r.USER_VIEW_H=fe
var ve=200
var he=e("../glov/client/camera2d.js")
var pe=e("../glov/client/engine.js")
var me=e("../glov/client/input.js")
var a=e("../glov/client/input.js")
var ge=a.mouseDownAnywhere
var Ee=a.mouseDownOverBounds
var i=e("../glov/client/net.js")
var ye=i.netDisconnected
var Te=i.netSubs
var Ie=e("../glov/client/selection_box.js").dropDownCreate
var o=e("../glov/client/social.js")
var Se=o.friendAdd
var Ae=o.friendBlock
var we=o.friendIsBlocked
var Le=o.friendRemove
var Re=o.friendUnblock
var xe=o.getExternalFriendInfos
var Oe=o.getUserProfileImage
var be=o.isFriend
var Ne=e("../glov/client/ui.js")
var n=e("../glov/common/enums.js")
var Ce=n.ID_PROVIDER_FB_INSTANT
var s=n.PRESENCE_ACTIVE
var l=n.PRESENCE_INACTIVE
var Me=e("../glov/common/util.js").nop
var c=e("../glov/common/vmath.js").vec2
var De=e("../common/world_constants").ACCESS_OWNER
var _=e("./access_control.js")
var Pe=_.accessControlGetUser
var ke=_.accessControlGetUserContext
var Be=e("./analytics.js").logEvent
var Ue=e("./fbinstant_worlds.js").fbInviteCreateAsync
var Ge=e("./localization/localization").L
var Fe=e("./main.js")
var We=e("./main_menu.js").getWorldInfo
var je=e("./menu.js")
var u=e("./styles.js")
var He=u.color_line
var ze=u.floater_style_sysadmin_no_outline
var Ve=u.label_style
var Ye=u.menu_header_style
var qe=u.sublabel_style
var Ke=e("./user_data").followUserAllowed
var d=e("./waygate_ui.js")
var Ze=d.calcWGLinkWidth
var Xe=d.waygateLinkUI
var Qe=d.waygateUIIsAccessControl
var f=e("./world_comm.js")
var Je=f.getWorldID
var v=f.worldGetClients
var $e=f.worldTargetGo
var h=e("./world_info_view.js")
var et=h.FLOATER_STYLE_ROLE_NO_OUTLINE
var tt=h.access_items_admin
var rt=h.access_items_owner
var at=h.access_labels
var it=h.access_labels_for_volumes
var ot=h.refreshUserAndAccessList
var nt=h.refreshUserInfo
var st=h.volume_access_items_for_volume_admin
var lt=h.volume_access_items_for_volume_owner
var ct=h.volume_access_items_for_world_admin
var _t=h.worldCmdParseGated
var ut=h.worldInfoGetContext
var dt=h.worldInfoGetUser
var ft=h.worldInfoModifyingAccess
var vt=null
function getWorldName(e){var t=e&&e.world_id
if(t){var r=We(t,false)
if(!r||!r.user_access)return Ge.LBL_UNKNOWN_WORLD_NAME
if(r&&r.name)return r.name}return Ge.$(Ge.LBL_NUMBERED_WORLD,t?t:Ge.LBL_UNKNOWN_WORLD_ID)}function formatPresence(e){if(!e)return Ge.PRESENCE_OFFLINE
var t
switch(e.state){case"loading":case"menus":t=Ge.PRESENCE_IN_MENUS
break
case"view":t=Ge.separateColon(Ge.PRESENCE_VIEWING,getWorldName(e.payload))
break
case"build":t=Ge.separateColon(Ge.PRESENCE_BUILDING,getWorldName(e.payload))
break
case"explore":t=Ge.separateColon(Ge.PRESENCE_LOST_FRONTIER,getWorldName(e.payload))
break
default:t=Ge.PRESENCE_UNKNOWN}if(e.active===l)t=Ge.$(Ge.PRESENCE_ALSO_IDLE,t)
return t}function getNewestPresenceData(e){if(!e)return null
var t=null
for(var r in e){var a=e[r]
if(!t||a.active===s&&t.active!==s||a.active===t.active&&a.id>t.id)t=a}return t}function userInfoGet(e){var t=Te().getChannelImmediate("user."+e)
return{user_id:e,display_name:t.getChannelData("public.display_name"),presence_data:getNewestPresenceData(t.presence_data)}}function userInfoIsWorldsTeam(e){var t=Te().getChannelImmediate("user."+e).getChannelData("public.permissions")
return t&&(t.team||t.sysadmin)}function userGetWorldAndPos(e,t,r){var a=Te().getChannelImmediate("user."+e).pak("worldpos_get")
a.writeAnsiString(t||"")
a.send(r)}var p
var m
function userInfoViewClear(){if(vt){m=vt.user_id
p=pe.frame_index}vt=null}function userInfoViewing(e){return vt&&vt.user_id===e}function viewUser(e){var t=e.x,r=e.y,a=e.user_id
if(vt&&vt.user_id===a||p===pe.frame_index&&m===a){vt=null
return}vt={pos:c(),orig_pos:t||r?c():null,user_id:a,frame:pe.frame_index}
if(t||r)he.virtualToCanvas(vt.orig_pos,[t,r])}function getUserClientIds(e){var t=v()
for(var r in t){var a=t[r].ids
if(a&&a.user_id===e)return a}return null}var ht=false
var pt
var mt=8
var gt=300
var Et=48
var yt=90
var Tt=5
var It=100
function userInfoViewTick(){var e
if(!vt)return
var t=vt,r=t.user_id,a=t.pos,i=t.orig_pos,o=t.frame
if(i)he.canvasToVirtual(a,i)
else{a[0]=he.x0()+(he.w()-de)/2
a[1]=he.y0()+(he.h()-fe)/2}if(a[0]+de>he.x1())a[0]=he.x1()-de
if(a[1]+fe+ve>he.y1())a[1]=he.y1()-fe-ve
if(a[0]<0)a[0]=0
if(a[1]<0)a[1]=0
var n=Z.USER_INFO_VIEW
var s=a[0]
var l=s+mt
var c=de-2*mt
var _=a[1]
var u=_+mt
var d=Ne.font,f=Ne.title_font
var v=l+c/2
var h=Qe()
var p=userInfoGet(r)
var m=be(r)
var g=we(r)
var E=r===Te().loggedIn()
var y=p.display_name||r
var T=getUserClientIds(r)
var I=T&&T.roles
var S=I&&(I.sysadmin||I.team)
var A=Oe(r)
A.img.draw({x:l+Tt,y:u,z:n,w:yt,h:yt,frame:A.frame,color:A.img_color})
var w=l+yt+Tt
var L=c-2*yt-2*Tt
d.drawSizedAligned(Ye,w,u,n,1.5*Ne.font_height,d.ALIGN.HCENTERFIT,L,0,y)
u+=1.5*Ne.font_height
if(S){d.drawSizedAligned(ze,w,u,n,.75*Ne.font_height,d.ALIGN.HCENTERFIT,L,0,Ge.USERINFO_WORLDSTEAM)
u+=.75*Ne.font_height}d.drawSizedAligned(qe,w,u,n,.75*Ne.font_height,d.ALIGN.HCENTERFIT,L,0,Ge.separateColon(Ge.LBL_USER_ID,r))
if(me.click({x:l,y:u,w:c,h:Ne.font_height,button:0}))Ne.provideUserString('"'+y+'"',r)
u+=.75*Ne.font_height
var R=null==(e=xe(r))?void 0:e[Ce]
var x=null==R?void 0:R.name
if(x){d.drawSizedAligned(qe,w,u,n,.75*Ne.font_height,d.ALIGN.HCENTERFIT,L,0,Ge.$(Ge.USERINFO_MY_FRIEND_FB,x))
u+=.75*Ne.font_height}var O=l+(c-gt)/2
var b=false
if(!h&&!g){var N,C
var M=p.presence_data
var D=!E&&(null==M?void 0:null==(N=M.payload)?void 0:N.world_id)
var P=D===Je()
var k=D&&(P||(null==(C=We(D,false))?void 0:C.user_access))
var B=P&&Ke()
if(k&&(B||!P)){var U=Ze(Et)
var G=w+U+8
var F=L-U-8
var W=d.drawSizedAligned(qe,G,u,n,.75*Ne.font_height,d.ALIGN.HCENTERFIT|d.ALIGN.VCENTER,F,Et,formatPresence(M))
var j={wid:D,uid:r}
if(Xe({x:G+F/2-W/2-U-8,y:u,z:n,h:Et,target:j,ctx:"user"+r,url:"u/"+r+"/go",overlay_mode:true,overlay_users:true,teleport_icon:B})){Fe.menuExit()
if(!E)$e(j)
b=true}u+=Et}else{d.drawSizedAligned(qe,w,u,n,.75*Ne.font_height,d.ALIGN.HCENTERFIT,L,0,formatPresence(M))
u+=.75*Ne.font_height
u+=8}}u+=8
function userContextButton(e,t){t=t||!Te().loggedIn()||ye()
var r=Ne.buttonText({x:O,y:u,z:n,w:gt,h:Et,disabled:t,text:e})
u+=Et+8
return r}function handleUserModResp(e,t){ht=false
Fe.chat_ui.handleCmdParse(e,t)}var H
var z
if(h){H=ke()
z=Pe(H,r,y)}else{H=ut(Je())
z=dt(H,r,y)}if(E&&!z.allow_actions)d.drawSizedAligned(qe,v,u,n,Ne.font_height,d.ALIGN.HVCENTER,0,3*(_+fe-u)/4,Ge.USERINFO_THIS_ME)
else if(!h)if(g){d.drawSizedAligned(Ve,v,u,n,Ne.font_height,d.ALIGN.HCENTER,0,0,Ge.USERINFO_USER_BLOCKED)
u+=Ne.font_height+8
if(userContextButton(Ge.BTN_UNBLOCK_USER,ht)){ht=true
Be("friend_blocked_button",1,"button")
Re(r,handleUserModResp)}}else if(R){var V=d.drawSizedAligned(Ve,v-(It+8)/2,u+Et/2,n,Ne.font_height,d.ALIGN.VCENTER|d.ALIGN.HCENTER,0,0,Ge.FRIENDLIST_FB_FRIEND)
if(Ne.buttonText({x:v+(V+8-It)/2,y:u,z:n,w:It,h:Et,disabled:!Te().loggedIn(),text:Ge.BTN_INVITE_PLAY}))Ue(r)
u+=Et+8}else if(m){d.drawSizedAligned(Ve,v,u,n,Ne.font_height,d.ALIGN.HCENTER,0,0,Ge.FRIENDLIST_USER_IS_ADDED)
u+=Ne.font_height+8
if(userContextButton(Ge.BTN_REMOVE_FRIEND,ht)){ht=true
Be("friend_remove_button",1,"button")
Le(r,handleUserModResp)}}else{if(userContextButton(Ge.BTN_ADD_FRIEND,ht)){ht=true
Be("friend_added_button",1,"button")
Se(r,handleUserModResp)}if(userContextButton(Ge.BTN_BLOCK_USER,ht)){ht=true
Be("friend_block_button",1,"button")
Ae(r,handleUserModResp)}}var Y=pe.frame_index!==o
if(z.allow_actions){u+=8
Ne.drawLine(v-40,u,v+40,u,n+.1,2,1,He)
u+=12
var q
if(h)q=Ge.LBL_AREA_ADMIN_ACTIONS
else q=Ge.separateColon(Ge.LBL_ADMIN_ACTIONS,H.world_info.name)
f.drawSizedAligned(Ye,l,u,n,Ne.font_height,d.ALIGN.HCENTERFIT,c,0,q)
u+=Ne.font_height+12
var K=z,X=K.access,Q=K.access_from_default
if(K.loading){d.drawSizedAligned(Ve,v,u,n,Ne.font_height,d.ALIGN.HVCENTER,0,Et,Ge.USERINFO_LOADING)
u+=Et}else{var J=(Et-Ne.font_height)/2
d.drawSizedAligned(Ve,v-8,u,n,Ne.font_height,d.ALIGN.HRIGHT,0,0,Ge.addColon(Ge.LBL_CURRENT_ACCESS))
var $=et[X]
var ee=(h?it:at)[X]
d.drawSizedAligned($,v,u,n,Ne.font_height,d.ALIGN.HLEFT|d.ALIGN.HFIT,c/2,0,Q?Ge.separateColon(Ge.LBL_DEFAULT,ee):ee)
u+=Ne.font_height+4
var te
if(h){var re=H,ae=re.is_world_admin,ie=re.is_volume_owner
te=ae?ct:ie?lt:st}else te=H.my_role_rank>=De?rt:tt
d.drawSizedAligned(Ve,v-8,u+J,n,Ne.font_height,d.ALIGN.HRIGHT,0,0,Ge.addColon(Ge.LBL_CHANGE_ACCESS))
if(!pt)pt=Ie({items:te,z:n,width:gt/2,entry_height:Et})
var oe=ft()
if(!oe&&!pt.dropdown_visible){var ne=-1
var se=X
if(Q)se="DEFAULT"
for(var le=0;le<te.length;++le)if(te[le].tag===se)ne=le
if(-1!==ne)pt.selected=ne}var ce={x:v,y:u,disabled:oe}
if(pt.items.length!==te.length)ce.items=te
if(pt.dropdown_visible)Y=false
pt.run(ce)
if(pt.was_clicked&&!oe){var _e=pt.getSelected().tag
if(h)_t("world_volume_access "+H.mcid+" "+H.volume_id+" "+r+" "+_e,Me)
else _t("world_access "+r+" "+_e,ot)}u+=Et+4
if(!h&&T)if(userContextButton(Ge.BTN_KICK_FROM_WORLD,oe))_t("kick "+r,nt)}}if(!z.allow_actions&&h&&!E)d.drawSizedAligned(qe,s,u,n,Ne.font_height,d.ALIGN.HVCENTER|d.ALIGN.HWRAP,de,3*(_+fe-u)/4,Ge.USERINFO_NOT_ALLOWED_TO_CHANGE_ACCESS)
var ue={x:s,y:_,w:de,h:fe}
if(me.drag(ue));if(Y&&!je.active()&&!Ee(ue)&&ge())b=true
if(Y&&Fe.chat_ui.isFocused())b=true
if(Y&&me.click({peek:true})||me.keyDownEdge(me.KEYS.ESC)||b)userInfoViewClear()
Ne.panel({x:s,y:_,z:n-1,w:de,h:fe,pixel_scale:.25,color:je.panel_color_popup})}},{"../common/world_constants":212,"../glov/client/camera2d.js":241,"../glov/client/engine.js":250,"../glov/client/input.js":271,"../glov/client/net.js":279,"../glov/client/selection_box.js":290,"../glov/client/social.js":296,"../glov/client/ui.js":306,"../glov/common/enums.js":321,"../glov/common/util.js":330,"../glov/common/vmath.js":332,"./access_control.js":2,"./analytics.js":5,"./fbinstant_worlds.js":80,"./localization/localization":108,"./main.js":112,"./main_menu.js":113,"./menu.js":117,"./styles.js":160,"./user_data":170,"./waygate_ui.js":179,"./world_comm.js":182,"./world_info_view.js":184}],172:[function(e,t,r){"use strict"
r.partyWaitingData=partyWaitingData
r.partyIsActive=partyIsActive
r.partyGetParticipants=partyGetParticipants
r.partyIsHost=partyIsHost
r.partyGetHost=partyGetHost
r.partyHasJoinedWorld=partyHasJoinedWorld
r.partyLeave=partyLeave
r.partyJoin=partyJoin
r.partySetUserWorld=partySetUserWorld
r.userPartyInit=userPartyInit
var i=e("assert")
var o=e("../glov/client/external_users_client").externalUsersPartyId
var a=e("../glov/client/net")
var n=a.netClientId
var s=a.netDisconnected
var l=a.netSubs
var c=a.netUserId
var _=e("../glov/common/external_users_common").ERR_NOT_AVAILABLE
var u=e("./user_info_view").userGetWorldAndPos
var d=3e3
var f=false
var v
var h=false
var p=0
function partyWaitingData(){return f}function partyIsActive(){return Boolean(v)}function partyGetParticipants(){return v?v.participants:[]}function partyIsHost(){return Boolean(v&&v.is_host)}function updateHostPosition(){var r=v&&v.participants[0]
if(!r||r.querying_pos||!r.world_id||partyIsHost()||r.pos_valid_time&&Date.now()<r.pos_valid_time)return
r.querying_pos=true
r.pos_str=""
u(r.user_id,r.client_id,function(e,t){r.querying_pos=false
r.pos_str=""
r.pos_valid_time=Date.now()+d
if(e||!v||r!==v.participants[0])return
if(!(t&&t.world_id&&t.pos_str)){if(r.world_id)console.warn("The host is in a world but the current user doesn't have permissions to check where")
return}r.world_id=t.world_id
r.pos_str=t.pos_str})}function partyGetHost(){updateHostPosition()
return v&&v.participants[0]}function partyHasJoinedWorld(){return h}function onPartyChannelData(e){var t=e
i(t.public.participants)
i(v)
var r=v.participants[0]
v.participants=t.public.participants
var a=v.participants[0]
if(a){v.is_host=a.user_id===c()&&a.client_id===n()
if(!v.is_host){if(r&&r.user_id===a.user_id&&r.client_id===a.client_id&&r.world_id===a.world_id)v.participants[0]=r
updateHostPosition()}}}function partyLeave(){f=false
if(v){v.channel.removeListener("channel_data",onPartyChannelData)
v=void 0}p++}function partyJoin(e){partyLeave();(v={id:e,channel:l().getChannel("party."+e,true),is_host:false,participants:[]}).channel.on("channel_data",onPartyChannelData)
f=false}function partySetUserWorld(e){if(v&&!s())v.channel.send("set_user_world",e,function(e){if(e)console.error(e)})
h=true}function onLogin(){f=true
var r=l().getLoginProvider()
if(!r){f=false
return}var a=++p
o(r,function(e,t){if(a!==p)return
if(e||!t){if(e&&e!==_)console.error(e)
f=false
return}partyJoin(r+"_"+t)})}function userPartyInit(){l().on("login",onLogin)
l().on("logout",partyLeave)}},{"../glov/client/external_users_client":256,"../glov/client/net":279,"../glov/common/external_users_common":322,"./user_info_view":171,assert:void 0}],173:[function(e,t,r){"use strict"
r.makeAtlas=makeAtlas
var o=e("../common/atlas_common.js")
var n=e("../glov/client/engine.js")
var s=e("./tiles.js").tile_map_default
function canvasAllocator(e,t){var r=document.createElement("canvas")
r.width=e
r.height=t
var i=r.getContext("2d")
i.fillStyle="#000"
r.preClearRect=function(e,t,r,a){i.fillRect(e,t,r,a)}
r.drawImage=i.drawImage.bind(i)
return r}function makeAtlas(e,t,r){var a
var i="default"===e.tile_map?s.alpha_allow_map:null
if(n.webgl2)a=o.makeArray(e,i,r,canvasAllocator)
else a=o.makeAtlas(e,i,r,canvasAllocator)
return a}},{"../common/atlas_common.js":191,"../glov/client/engine.js":250,"./tiles.js":162}],174:[function(e,t,c){"use strict"
c.getViewDist=getViewDist
c.getFrustumPlanes=getFrustumPlanes
c.getThisFrameFrustumPlanes=getThisFrameFrustumPlanes
c.listAddMesh=listAddMesh
c.listRemoveMesh=listRemoveMesh
c.reload=reload
c.getKnownBounds=getKnownBounds
c.resetView=resetView
c.updateChunks=updateChunks
c.drawDebug=drawDebug
c.releaseClaimed=releaseClaimed
c.tickVCM=tickVCM
c.drawChunkManDebug=drawChunkManDebug
c.reset=reset
c.nearbyChunksWaiting=nearbyChunksWaiting
c.restartStreaming=restartStreaming
c.startStreaming=startStreaming
c.load_start=c.list_need_tick=c.list_need_update=c.list_need_draw=c.chunk_cur_pos=c.claim_dist_sq=c.view_dist=c.STREAM_ABS_DIST=c.PRIORITY_IMMEDIATE=c.PRIORITY_NORMAL=void 0
var r=1
c.PRIORITY_NORMAL=r
var a=2
c.PRIORITY_IMMEDIATE=a
var _=1
var u=_+4
c.STREAM_ABS_DIST=u
var d=e("assert")
var i=e("../glov/client/browser.js").is_discrete_gpu
var f=e("./build_mode.js").unlimitedMode
var o=e("./camera.js"),n=o.getActiveController,s=o.getChunkViewMatrix,g=o.getCurrentCameraPos,E=o.getCurrentCameraTargetDir
var l=e("../glov/client/cmds.js").cmd_parse
var v=e("./debug.js")
var h=e("../common/globals.js"),y=h.CHUNK_SIZE,p=h.ID_FACTOR,m=h.ID2
var T=e("./lists.js").listCreate
var I=e("gl-mat4/multiply")
var S=e("../glov/client/net.js").netDisconnected
var A=e("gl-mat4/perspective")
var w=Math.floor,L=Math.max,R=Math.min,x=Math.round,O=Math.sqrt
var b=e("./megachunk_client.js")
var N=e("../common/megachunk_common.js").chunkPosFromId
var C=e("../glov/client/models.js")
var M=e("./proc_gen_debug.js")
var D=e("../glov/common/vmath.js"),P=D.mat4,k=D.unit_vec,B=D.vec2,U=D.vec3,G=D.vec4,F=D.v3addScale,W=D.v3distSq,j=D.v3lengthSq
var H=e("../glov/client/engine.js")
var z=e("../glov/client/shaders.js")
var V=e("./task_sched.js"),Y=V.WORKER_GEN,q=V.workerFlush,K=V.workerReady
var Z=e("../glov/client/textures.js")
var X=e("./world_claims.js"),Q=X.CLAIM_BY_SELF,J=X.claimFinalize,$=X.getClaimCount,ee=X.unclaim
var te=e("./user_data.js").worldReadOnly
var re=e("../glov/common/verify.js")
var ae=e("./voxel_data.js")
var ie=e("./voxel_gen.js").voxelGensInProgress
var oe=e("./voxel_mesh.js"),ne=oe.voxelMeshBusy,se=oe.voxelMeshDataSends,le=oe.voxelMeshesInProgress,ce=oe.voxelMeshFlush
var _e
var ue=16
var de=i?15:8
var fe=.75*(c.view_dist=de)*(.75*de)
c.claim_dist_sq=fe
var ve=300
var he=1
var pe=5
var me=pe
var ge=2
var Ee=8
var ye=ge
var Te=U(-.5,-.5,.5)
c.chunk_cur_pos=Te
var Ie=0
var Se=P()
var Ae
var we=P()
var Le=0
var Re=0
var xe=0
var Oe=0
var be
var Ne
var Ce
var Me
c.list_need_draw=Me
var De
c.list_need_update=De
var Pe
var ke
c.list_need_tick=ke
var Be
var Ue=0
var Ge=0
function getViewDist(){return de}function planeNormalize(e,t,r,a,i){var o=t*t+r*r+a*a
if(o>0){var n=1/O(o)
e[0]=t*n
e[1]=r*n
e[2]=a*n
e[3]=i*n}else{e[0]=0
e[1]=0
e[2]=0
e[3]=0}}var Fe=[G(),G(),G(),G(),G()]
var We=U()
var je
function getFrustumPlanes(e,t){je=H.frame_index
var r=we
var a=r[0]
var i=r[1]
var o=r[3]
var n=r[4]
var s=r[5]
var l=r[7]
var c=r[8]
var _=r[9]
var u=r[11]
var d=r[12]
var f=r[13]
var v=r[15]
planeNormalize(Fe[0],o+a,l+n,u+c,-(v+d))
planeNormalize(Fe[1],o-a,l-n,u-c,-(v-d))
planeNormalize(Fe[2],o-i,l-s,u-_,-(v-f))
planeNormalize(Fe[3],o+i,l+s,u+_,-(v+f))
var h=E()
F(We,ae.origin_chunk,g(),1/y)
F(We,We,h,H.ZFAR/y)
var p=h[0]*We[0]+h[1]*We[1]+h[2]*We[2]
planeNormalize(Fe[4],-h[0],-h[1],-h[2],-p)
if(e)Fe[4][3]+=H.ZFAR/y-e
if(t)for(var m=0;m<Fe.length;++m)Fe[m][3]-=t}function getThisFrameFrustumPlanes(){d.equal(je,H.frame_index)
return Fe}function v3distSkewSq(e,t){return(e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])+(e[2]-t[2])*(e[2]-t[2])*4}function cmpChunkDist(e,t){var r=v3distSkewSq(Te,e.pos)
return v3distSkewSq(Te,t.pos)-r}function listPrepare(e,t){if(e.getVisible){getFrustumPlanes(me,t?ye:0)
e.getVisible(Fe,cmpChunkDist)}else e.prepare()}function getChunkWorld(e,t,r){var a=(r*p+t)*p+e
var i=_e[a]
if(!i){(i=_e[a]=ae.createWorldVD(e,t,r,a)).in_list_gen=true
Ie++
be.add(i)}return i}function listAddMesh(e){d(!e.in_list_mesh)
d(e.did_gen)
if(!e.data&&!e.liquid){d(!e.geom)
d(!e.geom_alpha)
d(!e.geom_liquid)
e.mesh_dirty=0
e.fadeIn()
return}d(e.data||e.liquid)
d(e.did_gen||e.gen_in_progress)
if(e.mesh_dirty===r)Ce.add(e)
else Ne.add(e)
e.in_list_mesh=true}function listRemoveMesh(e){if(e.in_list_mesh){d(e.mesh_dirty)
if(e.mesh_dirty===a)Ne.remove(e)
else Ce.remove(e)
e.in_list_mesh=false}}function unload(e){if(e.in_list_gen)be.remove(e)
listRemoveMesh(e)
if(e.in_list_draw)Me.remove(e)
if(e.in_list_update)De.remove(e)
if(e.in_list_tick)ke.remove(e)
e.unload();--Ie}function reload(e){var t=e.pos,r=t[0],a=t[1],i=t[2]
unload(e)
getChunkWorld(r,a,i)}var He=[B(),B(),B()]
var ze=0
var Ve=0
var Ye=0
function getKnownBounds(){return He}var qe=U()
function updateChunkCurPos(){var e=n().getCameraPos()
if(H.DEBUG){var t=(de+2)*y
d(j(e)<t*t||W(n().pos,e)<y*y*4)}F(qe,ae.origin_chunk,e,1/y)
F(Te,qe,k,-.5)}var Ke=8e3
var Ze=new Int32Array(3)
var Xe
var Qe
var Je
function streamInOutContinuous(){profilerStart("streamInOutContinuous")
var e=ae.origin_chunk
var t=de*de/225*Ke
var r=x(H.frame_dt/1e3*t)
var o={}
var n={}
function finish(){profilerStart("unload")
for(var e in n){e=Number(e)
var t=_e[e]
delete _e[e]
n[e]=t}for(var r in n)unload(n[r])
profilerStopStart("alloc")
for(var a in o){a=Number(a)
var i=N(a)
getChunkWorld(i[0],i[1],i[2])}profilerStop()}while(r){if(!ze){var a=void(Je=0)
for(var i=0;i<3;++i){if(He[i][0]>He[i][1]){finish()
re.equal(Object.keys(_e).length,0)
console.warn("Streamed out everything, resetting chunk view frame")
resetView()
return profilerStop("streamInOutContinuous")}var s=He[i][1]+1-(e[i]+de)
if(s<0||s>_){Je+=s<0?-w(s):w(s-_+1)
if(!a||a<0&&s<a||s>0&&s>a){a=s
Ve=i
Ye=1}}var l=e[i]-de-He[i][0]
if(l<0||l>_){Je+=l<0?-w(l):w(l-_+1)
if(!a||a<0&&l<a||l>0&&l>a){a=l
Ve=i
Ye=0}}}if(!a){finish()
return profilerStop("streamInOutContinuous")}if(a<0){ze=1
He[Ve][Ye]+=Ye?1:-1}else{if(a>u){finish()
console.warn("Too far to incrementally stream "+a+", resetting chunk view frame")
resetView()
return profilerStop("streamInOutContinuous")}ze=-1}Xe=0===Ve?1:0
Qe=2===Ve?1:2
Ze[Ve]=He[Ve][Ye]
Ze[Xe]=He[Xe][0]+0
Ze[Qe]=He[Qe][0]+0}do{var c=Ze[0]+Ze[1]*p+Ze[2]*m
if(-1===ze)if(o[c])delete o[c]
else{if(H.DEBUG)d(_e[c])
n[c]=true}else if(n[c])delete n[c]
else{if(H.DEBUG)d(!_e[c])
o[c]=true}--r
Ze[Xe]++
if(Ze[Xe]>He[Xe][1]){Ze[Xe]=He[Xe][0]+0
Ze[Qe]++}if(Ze[Qe]>He[Qe][1]){if(-1===ze)He[Ve][Ye]+=Ye?-1:1
ze=0
break}}while(r)}finish()
return profilerStop("streamInOutContinuous")}function resetView(){if(!_e)return
profilerStart("resetView")
var e=de
var t=-e
var r=ae.origin_chunk[0]
var a=ae.origin_chunk[1]
var i=ae.origin_chunk[2]
for(var o=0;o<3;++o){He[o][0]=ae.origin_chunk[o]+t
He[o][1]=ae.origin_chunk[o]+e}var n={}
for(var s=t;s<=e;++s)for(var l=t;l<=e;++l)for(var c=t;c<=e;++c)n[getChunkWorld(r+c,a+l,i+s).chunk_id]=true
for(var _ in _e)if(!n[_])unload(_e[_])
ze=0
profilerStop("resetView")}function doOneGen(){var t=be.preparedPop()
d(t.in_list_gen)
t.in_list_gen=false
be.remove(t);++Ue
t.doGen(function(e){d(!t.disposed)
d(!t.in_list_gen)
if(e){console.error("Error gening chunk "+t.chunk_id+": "+e)
if("ERR_FAILALL_DISCONNECT"!==e&&!String(e).includes("not on channel"))throw e
t.in_list_gen=true
be.add(t)}})
return t}function doOneMesh(e,t){++Ge
t.doMesh(e)}function updateMatrices(){Ae=s()
A(Se,H.fov_y,H.width/H.height,H.ZNEAR/y,H.ZFAR/y)
I(we,Se,Ae)}function expectedGenCount(){return 100*(me+3)}var $e=1
var et=2
function updateChunksMeshLocal(e){Re=L(Re,Ce.length())
listPrepare(Ce,false)
Oe=Ce.preparedLength()
while(Ce.preparedLength()){var t=Ce.preparedPop()
listRemoveMesh(t)
doOneMesh(true,t)
if(Date.now()>=e)return $e}return 0}function updateChunksMeshWorkers(){if(ne())return et
Re=L(Re,Ce.length())
listPrepare(Ce,false)
Oe=Ce.preparedLength()
while(Ce.preparedLength()){var e=Ce.preparedPop()
listRemoveMesh(e)
d(_e[e.chunk_id]===e)
d.equal(e.gened_neighbors,ae.NEIGHBOR_MASK_ALL)
d(e.did_gen)
doOneMesh(false,e)
if(ne())return $e}return 0}function updateChunksMesh(e){while(Ne.arr.length){var t=Ne.arr.pop()
d(t.in_list_mesh)
t.in_list_mesh=false
doOneMesh(true,t)}if(H.defines.NOWORKERS||H.defines.NOMESHWORKERS)return updateChunksMeshLocal(e)
else{var r=updateChunksMeshWorkers()
ce()
return r}}function updateChunksGenLocal(e){var t=Date.now()
listPrepare(be,true)
xe=be.preparedLength()
e+=Date.now()-t
while(be.preparedLength()){doOneGen()
if(Date.now()>=e)return $e}return 0}function updateChunksGenWorkers(){if(!K(Y)){q(Y)
return et}listPrepare(be,true)
xe=be.preparedLength()
while(be.preparedLength()){doOneGen()
if(!K(Y))return $e}return 0}var tt
var rt
c.load_start=rt
function updateChunks(e){var t=Date.now()
if(ye>ge){if(!tt){M.dumpPerf()
console.log("gen and mesh done in "+(t-rt)+"ms")
tt=true}e/=2}updateMatrices()
var r=t+e
var a=r
if(e===ue)a=t+R(e,.5*H.frame_dt)
if(!(H.frame_index%60))Re=Le=0
if(updateChunksMesh(a)){xe=L(xe,1)
return}Le=L(Le,be.length())
var i
if(!H.defines.NOWORKERS){i=updateChunksGenWorkers()
q(Y)}else i=updateChunksGenLocal(r)
if(i){Oe=L(Oe,1)
if(i!==et&&be.preparedLength()>=expectedGenCount())if(ye>ge)ye--
else me=L(he,me-1)
return}if(me===de+1){if(!ie())ye=R(ye+1,Ee)}else me=R(de+1,me+1)}var at=P()
var it=G(1,0,0,1)
var ot=G(1,1,0,1)
var nt=G(0,0,1,1)
var st=G(0,1,1,1)
var lt=G(0,1,0,1)
var ct=G(1,0,1,1)
function drawDebug(){at[0]=at[5]=at[10]=4
gl.disable(gl.BLEND)
var e=C.models.box
Z.bind(0,Z.textures.white)
for(var t in _e){var r=_e[t]
if(r.shift_gen!==ae.shift_gen)r.updateMat()
at[12]=r.mat[12]+6+1
at[13]=r.mat[13]+6+1
at[14]=r.mat[14]+6+1
H.updateMatrices(at)
z.bind(C.default_vshader,C.default_fshader,{color:!r.did_gen?it:!r.data&&!r.liquid?r.in_list_draw?ct:nt:r.mesh_dirty?ot:!r.geom&&!r.geom_alpha&&!r.props&&!r.geom_liquid?st:lt})
e.drawGeom(at)}}function releaseClaimed(){if(!Pe||!Pe.length)return
for(var e=0;e<Pe.length;++e){var t=Pe[e]
if(t.claimed===Q)ee(t)}J()}var _t=0
var ut=[]
var dt
var ft
var vt
var ht=[]
var pt=[]
var mt=de*de
var gt=3
var Et=false
var yt
function resetDynamicRenderDistance(){mt=de*de}function tickVCM(){updateChunkCurPos()
if(!S()){if(!te()&&!(_t&&f())){profilerStart("VD:updateState")
ae.updatePrepare()
for(var e=0;e<Pe.length;++e)Pe[e].updateState()
ae.updateFinalize()
profilerStop("VD:updateState")}else if(Pe.length)releaseClaimed()
profilerStart("VD:tick")
for(var t=0;t<Be.length;++t)Be[t].tick()
profilerStop("VD:tick")}streamInOutContinuous()
profilerStart("gen&mesh")
updateChunks(ue)
profilerStopStart("draw setup")
gl.disable(gl.BLEND)
ae.drawBulkStart()
ht=[]
pt=[]
var r=dt=0
ft=0
Me.tree.finalize()
getFrustumPlanes(0,0)
var a=Me.tree.getVisibleNodes(Fe,ut,0)
profilerStopStart("draw nodes")
for(var i=0;i<a;++i){if(ut[i].drawable_props)ht.push(ut[i]);++dt
ut[i].draw()}profilerStopStart("draw props")
var o=de*de
mt+=gt
vt=ht.length
if(yt=mt<o||Et){for(var n=0;n<ht.length;++n){ht[n].distance=W(Te,ht[n].pos)
if(ht[n].distance<mt)pt.push(ht[n])}pt.sort(function(e,t){return e.distance-t.distance})
for(var s=0;s<pt.length;++s){var l=pt[s].drawProps()
ft+=l
r=L(r,l)
if(ft>ve){mt=pt[s].distance+gt
break}}}else for(var c=0;c<ht.length;++c){var _=ht[c].drawProps()
r=L(r,_)
ft+=_}Et=ft>ve+r
ae.drawBulkEnd()
profilerStop()}function drawChunkManDebug(){if(H.defines.CHUNKMAN){v.addText(["Chunks Need Gen: "+xe+" / "+be.length()+" ("+Le+")","Chunks Gen Queued: "+ie(),"Chunks Need Mesh: "+Ce.length()+" ("+Re+")","Chunks Mesh Queued: "+le()+"  Data Sends: "+se(),"Chunks Need Update: "+Pe.length+" ("+$()+" claimed)","Chunks Need Tick: "+Be.length,"Chunks Draw: "+dt+" / "+Me.length(),"Chunks Active: "+Ie,"Chunks Gen'd: "+Ue+" ("+ae.timing.gen+"ms)","Chunks Mesh'd: "+Ge+" ("+ae.timing.mesh+"ms)","Chunk Gen Dist: "+me+" +/-"+ye,"Dynamic Props: "+vt+" Chunks, "+ft+" props/calls"+(yt?" (sort to "+mt.toFixed(0)+")":""),"Stream State: "+ze+(ze?" "+Ve+":"+Ye+" ("+Je+")":"")].join("\n"))
dt=0}}function reset(){me=pe
Ue=Ge=Ie=0
be=T({type:"hybrid4",name:"need_gen",log_rebuilds:true})
Ce=T({type:"fifo",name:"need_mesh_normal"})
Ne=T({type:"lifo",name:"need_mesh_high"})
c.list_need_draw=Me=T({type:"aabbtree",name:"need_draw"})
c.list_need_update=De=T({type:"lifo",name:"need_update"})
Pe=De.arr
c.list_need_tick=ke=T({type:"lifo",name:"need_tick"})
Be=ke.arr
_e=ae.chunk_map}var Tt
var It=81
function nearbyChunksWaiting(){var e=(Tt=Tt.filter(function(e){return!e.vd.did_gen&&e.vd.reused===e.reused})).length
if(e||me<pe)me=pe
if(me===pe)e+=xe+Oe
return e}function queueNearbyLoads(){Tt=[]
updateChunkCurPos()
Te[2]-=.5
updateMatrices()
listPrepare(be,true)
var e=It
while(e&&be.preparedLength()){var t=doOneGen()
Tt.push({reused:t.reused,vd:t});--e}if(!H.defines.NOWORKERS)q(Y)
var r=Date.now()-rt
console.log("Initial view reset in "+r+"ms, waiting for "+Tt.length+" loads...")}function restartStreaming(){c.load_start=rt=Date.now()
tt=false
me=pe
ye=ge
resetDynamicRenderDistance()
resetView()
queueNearbyLoads()}function startStreaming(){c.load_start=rt=Date.now()
tt=false
me=pe
ye=ge
resetDynamicRenderDistance()
var e=de
var t=-e
var r=ae.origin_chunk[0]
var a=ae.origin_chunk[1]
var i=ae.origin_chunk[2]
for(var o=0;o<3;++o){He[o][0]=ae.origin_chunk[o]+t
He[o][1]=ae.origin_chunk[o]+e}for(var n=t;n<=e;++n)for(var s=t;s<=e;++s)for(var l=t;l<=e;++l)getChunkWorld(r+l,a+s,i+n)
ze=0
queueNearbyLoads()}l.registerValue("view_dist",{type:l.TYPE_INT,label:"View Distance",range:[5,30],set:function set(e){c.view_dist=de=e
var t=L(1,.75*de)
c.claim_dist_sq=fe=t*t
if(rt){resetView()
b.shift()}resetDynamicRenderDistance()},get:function get(){return de},store:true})
l.registerValue("max_dynamic_draw_calls",{type:l.TYPE_INT,label:"Dynamic draw calls",range:[10,Infinity],set:function set(e){ve=e},get:function get(){return ve},store:true})
l.registerValue("view_dist_temp",{type:l.TYPE_INT,label:"View Distance (not persisted, may crash)",range:[3,1e3],set:function set(e){c.view_dist=de=e
var t=L(1,.75*R(de,30))
c.claim_dist_sq=fe=t*t
resetView()
b.shift()
resetDynamicRenderDistance()},get:function get(){return de},store:false})
l.registerValue("sim_pause",{type:l.TYPE_INT,label:"Pause Simulation",help:"Pause all local simulation (water, crops, physics, etc)",range:[0,1],set:function set(e){_t=e},get:function get(){return _t},store:H.DEBUG})},{"../common/globals.js":197,"../common/megachunk_common.js":202,"../glov/client/browser.js":239,"../glov/client/cmds.js":244,"../glov/client/engine.js":250,"../glov/client/models.js":278,"../glov/client/net.js":279,"../glov/client/shaders.js":293,"../glov/client/textures.js":304,"../glov/common/verify.js":331,"../glov/common/vmath.js":332,"./build_mode.js":27,"./camera.js":28,"./debug.js":62,"./lists.js":104,"./megachunk_client.js":116,"./proc_gen_debug.js":135,"./task_sched.js":161,"./user_data.js":170,"./voxel_data.js":175,"./voxel_gen.js":177,"./voxel_mesh.js":178,"./world_claims.js":181,assert:void 0,"gl-mat4/multiply":void 0,"gl-mat4/perspective":void 0}],175:[function(e,t,l){"use strict"
l.setFlashlight=setFlashlight
l.tileMapIdentityTinted=tileMapIdentityTinted
l.VoxelData=VoxelData
l.createWorldVD=createWorldVD
l.createUtilVD=createUtilVD
l.chunkIdFromLocalIntPos=chunkIdFromLocalIntPos
l.andGetLocalPos=andGetLocalPos
l.chunkIdFromLocalFloatPos=chunkIdFromLocalFloatPos
l.posPairFromLocalIntPos=posPairFromLocalIntPos
l.getLocalPosFromChunkID=getLocalPosFromChunkID
l.getWorldPosFromChunkID=getWorldPosFromChunkID
l.worldPosFromLocalPos=worldPosFromLocalPos
l.localPosFromWorldPos=localPosFromWorldPos
l.getLocalPosFromPosPair=getLocalPosFromPosPair
l.getVDFromLocalPos=getVDFromLocalPos
l.getTileLocal=getTileLocal
l.getTilePosPair=getTilePosPair
l.queuedPlaceSet=queuedPlaceSet
l.queuedPlaceClear=queuedPlaceClear
l.queuedPlaceReset=queuedPlaceReset
l.getTileLocalOrQueuedPlace=getTileLocalOrQueuedPlace
l.getTileRelative=getTileRelative
l.andGetLiquid=andGetLiquid
l.andGetLightDebug=andGetLightDebug
l.markChunkSpoiled=markChunkSpoiled
l.markChunkUnspoiled=markChunkUnspoiled
l.transSetTileDirect=transSetTileDirect
l.transSetTileLocal=transSetTileLocal
l.transSetTileRelative=transSetTileRelative
l.setTileRelative=setTileRelative
l.getPropDirect=getPropDirect
l.setPropDirect=setPropDirect
l.removePropDirect=removePropDirect
l.replacePropDirect=replacePropDirect
l.propUpdate=propUpdate
l.getPropLocalExact=getPropLocalExact
l.getPropLocal=getPropLocal
l.getPropRelativeFromTile=getPropRelativeFromTile
l.andGetProp=andGetProp
l.getPropRelative=getPropRelative
l.removeProp=removeProp
l.ensurePristineSendProp=ensurePristineSendProp
l.assertPropPristineSend=assertPropPristineSend
l.transPropRemove=transPropRemove
l.transSetPropLocal=transSetPropLocal
l.transPropUpdate=transPropUpdate
l.transPropUpdateField=transPropUpdateField
l.transBagAdd=transBagAdd
l.transItemAnim=transItemAnim
l.getPropLighting=getPropLighting
l.getPropLighting2Prop=getPropLighting2Prop
l.voxelDataDirtyCacheStart=voxelDataDirtyCacheStart
l.voxelDataDirtyCacheEnd=voxelDataDirtyCacheEnd
l.propStateUpdate=propStateUpdate
l.propInWorld=propInWorld
l.exportCombinedGeometry=exportCombinedGeometry
l.drawProp=drawProp
l.drawPropQueued=drawPropQueued
l.drawBulkStart=drawBulkStart
l.drawBulkEnd=drawBulkEnd
l.updatePrepare=updatePrepare
l.updateFinalize=updateFinalize
l.liquidUpdateDefer=liquidUpdateDefer
l.remeshAll=remeshAll
l.initModeBasedSettings=initModeBasedSettings
l.reset=reset
l.drawSingleVoxel=drawSingleVoxel
l.drawSingleVoxelTextured=drawSingleVoxelTextured
l.shift=shift
l.VoxelSimpleDrawable=VoxelSimpleDrawable
l.loadGoxel=loadGoxel
l.createSimpleDrawable=createSimpleDrawable
l.tickVD=tickVD
l.applyBevelParamWorld=applyBevelParamWorld
l.applyBevelParamCharacters=applyBevelParamCharacters
l.applyBevelValue=applyBevelValue
l.recalcAtlasParams=recalcAtlasParams
l.startup=startup
l.chunksGenedNear=l.atlas_params_voxel_util_fp=l.atlas_params_voxel_util_vp=l.voxel_util_atlas_params=l.primary_atlas_params=l.NEIGHBOR_MASK_ALL=l.beamcast3DLocal2=l.beamcast3DLocal=l.raycast3DLocalCB=l.raycast3DLocal=l.raycastLocal=l.gatherProps=l.gen_miss=l.shift_gen=l.bevel_available=l.bevel_value=l.lighting_value=l.chunk_map=l.flashlight=l.timing=l.pack_tex_params=l.pack_textures=l.white_mask=l.pack_texture=l.origin_chunk=void 0
function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]
for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))e[a]=r[a]}return e}).apply(this,arguments)}var h=new Int32Array([0,0,0])
l.origin_chunk=h
var w=e("assert")
var r=e("../glov/client/browser").is_discrete_gpu
var a=e("../glov/client/cmds").cmd_parse
var _=e("../glov/client/draw_list")
var I=e("../glov/client/engine")
var S=e("../glov/client/error_report").hasCrashed
var i=e("../glov/client/geom")
var o=e("../glov/client/hsv").hsvToRGB
var n=e("../glov/client/perf").perf_mem_counters
var s=e("../glov/client/quat").unit_quat
var c=e("../glov/client/settings")
var v=e("../glov/client/shaders")
var p=e("../glov/client/textures")
var u=e("../glov/common/util")
var m=u.clamp
var d=u.defaults
var f=u.easeOut
var g=u.empty
var E=u.inherits
var y=u.isInteger
var T=u.nop
var A=u.randomNot
var L=u.toNumber
var R=e("../glov/common/vmath")
var M=R.half_vec
var x=R.mat4
var D=R.unit_vec
var O=R.v2scale
var P=R.v3add
var k=R.v3addScale
var B=R.v3copy
var b=R.v3distSq
var U=R.v3dot
var G=R.v3floor
var N=R.v3iAdd
var F=R.v3iFloor
var C=R.v3same
var W=R.v3scale
var j=R.v3scaleFloor
var H=R.v3set
var z=R.v3sub
var V=R.v4copy
var Y=R.v4set
var q=R.vec1
var K=R.vec2
var Z=R.vec3
var X=R.vec4
var Q=R.zero_vec
var J=e("../common/globals")
var $=J.CHUNK_SIZE
var ee=J.CS2
var te=J.CS3
var re=J.ID2
var ae=J.ID_FACTOR
var ie=e("../common/ids").TYPE_ITEM
var oe=e("../common/materials_common").Mat
var ne=e("../common/voxel_data_common")
var se=ne.ANIM_TYPE_POS
var le=ne.LIGHT_DECREASE
var ce=ne.LIGHT_INCREASE
var _e=ne.TORCH_DECREASE
var ue=ne.TORCH_INCREASE
var de=ne.UNCHUNKED_ID
var fe=ne.VoxelDataBase
var ve=ne.voxel_data_mem_tracker
var he=e("../common/world_trans")
var pe=he.decodeChunkPos
var me=he.encodeChunkPos
var ge=he.worldTransSetPropCheck
var Ee=e("./atlas_params.json")
var ye=e("./biome_types")
var Te=e("./client_entities").getMyEntID
var Ie=e("./editvolume_clear").editVolumeClearContentsInProgress
var Se=e("./editvolume_client")
var Ae=Se.chunkInEditBounds
var we=Se.inEditBounds
var Le=e("./item_anims")
var Re=e("./items").createItem
var xe=e("./light_calc")
var Oe=xe.LIGHT_FADE_HORIZ
var be=xe.sun_table
var Ne=xe.torch_table
var Ce=e("./line3d").pointLineDist
var Me=e("./liquid")
var De=e("./liquid")
var Pe=De.liquidStartup
var ke=De.liquidUpdateDeferInternal
var Be=De.liquidUpdateFinalize
var Ue=De.liquidUpdatePrepare
var Ge=De.liquidUpdateReset
var Fe=De.updateLiquid
var We=e("./localization/localization").L
var je=e("./lods")
var He=e("./main")
var ze=e("./megachunk_client")
var Ve=e("./megachunk_client").detailGenAttachChoices
var Ye=e("./mesh_calc")
var qe=Ye.BYTES_PER_VERT
var Ke=Ye.meshCalc
var Ze=Ye.meshCalcReset
var Xe=e("./mesh_exporter").meshExport
var Qe=e("./proc_gen_biomes")
var Je=Qe.getChunkTintColor
var $e=Qe.getVSTintColors
var et=e("./props")
var tt=et.propCreate
var rt=et.propFromJSON
var at=e("./sky").skyGetTorchColors
var it=e("./status")
var ot=e("./tiles")
var nt=e("./tiles")
var st=nt.TILE_HIT_LIQUID
var lt=nt.TILE_INTANGIBLE
var ct=nt.TILE_NON_OPAQUE
var _t=nt.TILE_PROP_BASE
var ut=nt.TILE_PROP_MAX
var dt=nt.TILE_TINT_GRASS
var ft=nt.TILE_TINT_MAX
var vt=nt.TILE_TINT_ORE
var ht=nt.TILE_UNDIGABLE
var pt=e("./user_data").worldReadOnly
var mt=e("./voxel_chunk_manager")
var gt=e("./voxel_chunk_manager")
var Et=gt.PRIORITY_IMMEDIATE
var yt=gt.PRIORITY_NORMAL
var Tt=e("./voxel_gen")
var It=Tt.voxelGen
var St=Tt.voxelGenAttachHexomeChoices
var At=Tt.voxelGenReset
var wt=e("./voxel_mesh")
var Lt=wt.voxelMesh
var Rt=wt.voxelMeshNotifyLoaded
var xt=wt.voxelMeshReset
var Ot=wt.voxelMeshStartup
var bt=wt.voxelMeshUnload
var Nt=e("./world_claims")
var Ct=Nt.CLAIM_BY_SELF
var Mt=Nt.CLAIM_UNKNOWN
var Dt=Nt.claim
var Pt=Nt.claimFinalize
var kt=Nt.unclaim
var Bt=e("./world_comm")
var Ut=Bt.getPerm
var Gt=Bt.refreshProp
var Ft=Bt.worldGetTile
var Wt=Bt.worldReconnected
var jt=e("./world_metadata")
var Ht=jt.adventureMode
var zt=jt.worldSeed
var Vt=Math.ceil,Yt=Math.floor,qt=Math.max,Kt=Math.min
w(qe)
w(Et)
n.chunks=ve
var Zt
var Xt
var Qt
var Jt
var $t
var er
var tr
var rr
var ar
var ir
var or
var nr
l.pack_texture=nr
var sr
var lr
l.white_mask=lr
var cr=[]
l.pack_textures=cr
var _r
var ur
var dr
var fr
l.pack_tex_params=fr
var vr={mesh:0,gen:0}
l.timing=vr
var hr=0
l.flashlight=hr
function setFlashlight(e){l.flashlight=hr=e}var pr=[]
l.chunk_map=pr
var mr=1
var gr=1
l.lighting_value=gr
var Er=r?1:0
l.bevel_value=Er
var yr
l.bevel_available=yr
var Tr=500
var Ir=[[1,2],[0,2],[0,1]]
var Sr=function(){var e={}
for(var t=0;t<256;++t)e[t]={def:t}
e.tile_invisible=e.tile_non_opaque=256
return e}()
function tileMapIdentityTinted(e,t){t=t||256
var r={}
var a={}
var i={}
for(var o=0;o<t;++o){r[o]=Sr[o]
a[o]=96
i[o]=o>=e?62:63}r.tile_rate=a
r.tile_override=i
r.tile_invisible=r.tile_non_opaque=t
return r}var Ar=tileMapIdentityTinted(256)
var wr=0
l.shift_gen=wr
var Lr=X()
var Rr=Z()
var xr=.3
var Or=.01
function VoxelData(e,t,r,a,i){this.pos=new Int32Array(3)
this.pos_world=new Int32Array(3)
this.mat=x()
this.reused=0
this.light_torch=null
this.light_sun=null
this.color=X(1,1,1,1)
this.cutout=q(xr)
this.shader_params={atlas_params_vp:Lr,atlas_params_fp:Rr,color:this.color,cutout:this.cutout}
this.mem_tracker=ve
this.mem_tracker.count++
this.init(e,t,r,a,i)}E(VoxelData,fe)
VoxelData.prototype.init=function(e,t,r,a,i){this.baseInit(e,t,r,a,i);++this.reused
this.main_world=a!==de
this.vsid=t*ae+e
this.mcid=void 0
this.disposed=false
this.geom=null
this.geom_alpha=null
this.geom_liquid=null
this.shift_gen=0
this.did_gen=false
this.did_mesh=false
this.load_timestamp=0
this.gen_in_progress=false
this.mesh_dirty=0
this.gened_neighbors=0
this.tile_map=ot.tile_map_default
this.liquid_unstable=true
this.last_liquid_tick=0
this.has_updatable_prop=false
this.in_list_gen=false
this.in_list_mesh=false
this.in_list_draw=false
this.in_list_update=false
this.in_list_tick=false
this.did_prop_check=false
this.full=false
this.claimed=Mt
this.claim_throttle=0
this.mesh_in_flight=false
this.geom_ver_meshing=0
this.ver_data=1
this.ver_meshing=1
this.ver_props=1
this.light_dirty=0
this.lighting_batch_id=0
this.sent_pristine=false
this.baked_props=null
this.drawable_props=null
this.has_ore=false
this.has_ore_ver=0}
VoxelData.prototype.updateMat=function(){this.mat[12]=(this.pos[0]-h[0])*$-1
this.mat[13]=(this.pos[1]-h[1])*$-1
this.mat[14]=(this.pos[2]-h[2])*$-1
this.shift_gen=wr}
var br=8e3
var Nr=[]
function createWorldVD(e,t,r,a,i){if(Nr.length){var o=Nr.pop()
o.init(e,t,r,a,i)
return o}return new VoxelData(e,t,r,a,i)}function createUtilVD(e,t){var r=new VoxelData(0,0,0,de,e)
r.cutout[0]=Or
r.alloc(t)
return r}VoxelData.prototype.deserializeProp=function(e){var t=rt(e[3])
t.chunk_id=this.chunk_id
t.setPos(e)
return t}
VoxelData.prototype.serializeProp=function(e){return[e.pos[0],e.pos[1],e.pos[2],e]}
VoxelData.prototype.deserialize=function(e){var t=fe.prototype.deserialize.call(this,e)
if(t){if(this.main_world){this.updateHasUpdatableProp(false)
this.updateHasTickableProp(false)
this.liquid_unstable=true}this.dirty()}return t}
var Cr=new Int32Array(3)
var Mr=new Int32Array(3)
function chunkIdFromLocalIntPos(e){Cr[0]=Yt(e[0]/$)
Cr[1]=Yt(e[1]/$)
Cr[2]=Yt(e[2]/$)
Mr[0]=e[0]-Cr[0]*$
Mr[1]=e[1]-Cr[1]*$
Mr[2]=e[2]-Cr[2]*$
Cr[0]+=h[0]
Cr[1]+=h[1]
Cr[2]+=h[2]
return(Cr[2]*ae+Cr[1])*ae+Cr[0]}function andGetLocalPos(){return Mr}function chunkIdFromLocalFloatPos(e,t){Cr[0]=Yt(t[0]/$)
Cr[1]=Yt(t[1]/$)
Cr[2]=Yt(t[2]/$)
e[0]=t[0]-Cr[0]*$
e[1]=t[1]-Cr[1]*$
e[2]=t[2]-Cr[2]*$
Cr[0]+=h[0]
Cr[1]+=h[1]
Cr[2]+=h[2]
return(Cr[2]*ae+Cr[1])*ae+Cr[0]}function posPairFromLocalIntPos(e){Cr[0]=Yt(e[0]/$)
Cr[1]=Yt(e[1]/$)
Cr[2]=Yt(e[2]/$)
Mr[0]=e[0]-Cr[0]*$
Mr[1]=e[1]-Cr[1]*$
Mr[2]=e[2]-Cr[2]*$
Cr[0]+=h[0]
Cr[1]+=h[1]
Cr[2]+=h[2]
return[(Cr[2]*ae+Cr[1])*ae+Cr[0],(Mr[2]*$+Mr[1])*$+Mr[0]]}VoxelData.prototype.getLocalPos=function(e){e[0]=(this.pos[0]-h[0])*$
e[1]=(this.pos[1]-h[1])*$
e[2]=(this.pos[2]-h[2])*$
return e}
function getLocalPosFromChunkID(e,t,r){var a=pr[t]
if(a){z(e,a.pos,h)
k(e,r,e,$)}else w(0)}function getWorldPosFromChunkID(e,t,r){var a=pr[t]
if(a)P(e,a.pos_world,r)
else w(0)}function worldPosFromLocalPos(e,t){return k(e,t,h,$)}function localPosFromWorldPos(e,t){return k(e,t,h,-$)}function getLocalPosFromPosPair(e,t){getLocalPosFromChunkID(e,t[0],pe(t[1]))}function getVDFromLocalPos(e){var t=chunkIdFromLocalIntPos(e)
return pr[t]}var Dr=0
l.gen_miss=Dr
var Pr
var kr
function getTileLocal(e,t,r){var a=chunkIdFromLocalIntPos(e)
var i=Pr=pr[a]
if(!i||!i.did_gen){l.gen_miss=Dr+=1
return kr=t}if(!r&&!i.data||r&&!i.liquid)return kr=0
return kr=i.get(Mr,r)}function getTilePosPair(e,t,r){w(e[1]>=0&&e[1]<4096)
var a=pr[e[0]]
if(!a||!a.did_gen)return t
var i=r?a.liquid:a.data
if(!i)return 0
return i[e[1]]}var Br={}
function queuedPlaceSet(e,t){w(t)
var r=chunkIdFromLocalIntPos(e)
var a=Br[r]
if(!a)a=Br[r]={}
var i=Mr[0]+Mr[1]*ae+Mr[2]*re
w(!a[i])
a[i]=t}function queuedPlaceClear(e){var t=chunkIdFromLocalIntPos(e)
var r=Br[t]
w(r)
var a=Mr[0]+Mr[1]*ae+Mr[2]*re
w(r[a])
delete r[a]
if(g(r))delete Br[t]}function queuedPlaceReset(){Br={}}function getTileLocalOrQueuedPlace(e,t,r){var a=chunkIdFromLocalIntPos(e)
var i=Pr=pr[a]
if(!i||!i.did_gen){l.gen_miss=Dr+=1
return t}var o
if(!r&&!i.data||r&&!i.liquid)o=0
else o=i.get(Mr,r)
if(!o){var n=Br[a]
if(n){var s=Mr[0]+Mr[1]*ae+Mr[2]*re
if(n[s])o=n[s]}}return kr=o}function getTileRelative(e,t,r,a){w.equal(typeof e,"number")
B(Mr,t)
var i=Yt(Mr[0]/$)
Mr[0]-=$*i
e+=i
i=Yt(Mr[1]/$)
Mr[1]-=$*i
e+=i*ae
i=Yt(Mr[2]/$)
Mr[2]-=$*i
var o=Pr=pr[e+=i*re]
if(!o||!o.did_gen){l.gen_miss=Dr+=1
return r}if(!a&&!o.data||a&&!o.liquid)return 0
return kr=o.get(Mr,a)}function andGetLiquid(e){var t=Pr
if(!t||!t.did_gen)return e
if(!t.liquid)return 0
return t.get(Mr,true)}function andGetLightDebug(){var e=Pr
if(!e||!e.did_gen)return{}
var t=Mr[2]*ee+Mr[1]*$+Mr[0]
return{torch:e.light_torch?e.light_torch[t]:-1,sun:e.light_sun?e.light_sun[t]:-1}}function neighborLightingGet(e,t,r){var a=pr[t]
var i=a&&a[e]
return i&&i[r]||0}function predictLighting(e,t,r){var a=e[t]
var i=0
if(15!==Mr[2]){if(a)i=qt(i,a[r+ee])}else i=qt(i,neighborLightingGet(t,e.chunk_id+re,r-3840))
if(255===i&&"light_sun"===t){if(!a)a=e[t]=new Uint8Array(te)
a[r]=i
return}if(0!==Mr[0]){if(a)i=qt(i,a[r-1])}else i=qt(i,neighborLightingGet(t,e.chunk_id-1,r+15))
if(15!==Mr[0]){if(a)i=qt(i,a[r+1])}else i=qt(i,neighborLightingGet(t,e.chunk_id+1,r-15))
if(0!==Mr[1]){if(a)i=qt(i,a[r-16])}else i=qt(i,neighborLightingGet(t,e.chunk_id-ae,r+240))
if(15!==Mr[1]){if(a)i=qt(i,a[r+16])}else i=qt(i,neighborLightingGet(t,e.chunk_id+ae,r-240))
if(0!==Mr[2]){if(a)i=qt(i,a[r-ee])}else i=qt(i,neighborLightingGet(t,e.chunk_id-re,r+3840))
if((i-=Oe)>0){if(!a)a=e[t]=new Uint8Array(te)
a[r]=i}}function markChunkSpoiled(e){var t=pr[e]
if(t)t.sent_pristine=true}function markChunkUnspoiled(e){var t=pr[e]
if(t){dirty(e,63,0,63)
mt.reload(t)
t=pr[e]
w(!t.sent_pristine)}}function ensurePristineSend(e,t){if(!t.sent_pristine){t.sent_pristine=true
if(!ze.isSpoiled(t.pos,null)){e.tset.sendPristine(t.chunk_id,t.serialize())
St(e,t)
Ve(e,t)}}}function transSetTileInternal(e,i,o,n,t,r,a){var s=pr[i]
if(!s||!s.did_gen){w(false)
return null}w(!s.disposed)
if(He.omp){ensurePristineSend(e,s)
ze.onTransSetTile(s.pos)}if(void 0===r)if(n&&!s.liquid||!n&&!s.data)r=0
else r=s.get(Mr,n)
var l=me(Mr)
var c=e.opSet(i,l,o,n,t,r)
if(a){s.alloc(n)
var _=yt
if(!o&&!n)_=Et
s.set(Mr,o,n,_)
if(_===Et&&gr){predictLighting(s,"light_sun",l)
predictLighting(s,"light_torch",l)}}var u=s.reused
if(a)e.onComplete(function(e){if(s.reused!==u)return
if(e){console.log("Error after set @"+i+","+l+","+n+", refreshing tile...")
Ft(i,l,n,function(e,t){if(s.reused!==u)return
if(e)console.log("Additional error refreshing tile")
else{var r=t
w.equal(typeof t,"number")
var a=s.getDirect(l,n)||0
if(a!==r){s.alloc(n)
s.set(pe(l),r,n)}console.log("Refresh complete @"+i+","+l+","+n+" set="+o+" local="+a+" server="+r)}})
var t=s.getPropDirect(l)
if(t)Gt(t,i,pe(l))}})
return c}function transSetTileDirect(e,t,r,a,i,o,n,s){B(Mr,r)
return transSetTileInternal(e,t.chunk_id,a,i,o,n,s)}function transSetTileLocal(e,t,r,a,i,o,n){w(we(t))
return transSetTileInternal(e,chunkIdFromLocalIntPos(t),r,a,i,o,n)}function transSetTileRelative(e,t,r,a,i,o,n){w.equal(typeof t,"number")
B(Mr,r)
var s=Yt(Mr[0]/$)
Mr[0]-=$*s
t+=s
s=Yt(Mr[1]/$)
Mr[1]-=$*s
t+=s*ae
s=Yt(Mr[2]/$)
Mr[2]-=$*s
return transSetTileInternal(e,t+=s*re,a,i,o,void 0,n)}function setTileRelative(e,t,r,a){w.equal(typeof e,"number")
B(Mr,t)
var i=Yt(Mr[0]/$)
Mr[0]-=$*i
e+=i
i=Yt(Mr[1]/$)
Mr[1]-=$*i
e+=i*ae
i=Yt(Mr[2]/$)
Mr[2]-=$*i
var o=pr[e+=i*re]
if(!o||!o.did_gen)return
w(!o.disposed)
if(!r&&(a?!o.liquid:!o.data))return
o.alloc(a)
o.set(Mr,r,a)}function getPropDirect(e,t){var r=pr[e]
if(!r||!r.did_gen)return null
return r.getProp(t)}function setPropDirect(e,t,r){var a=pr[e]
if(!a||!a.did_gen)return
a.setProp(t,r)}function removePropDirect(e,t){var r=pr[e]
if(!r||!r.did_gen)return
r.setProp(t,null)}function replacePropDirect(e,t,r){var a=pr[e]
w(a)
a.replaceProp(t,r)}var Ur=Z()
function propUpdate(e){pr[e.chunk_id].dirty()}function getPropLocalExact(e){var t=chunkIdFromLocalIntPos(e)
var r=pr[t]
if(!r||!r.did_gen)return null
if(!r.props)return null
return r.getProp(Mr)}var Gr={}
function autoCleanPropTile(e,t){w(y(e[0])&&y(e[1])&&y(e[2]))
if(pt()||S()||Wt())return
var r=e.join(",")
if(!Gr[r]){Gr[r]=true
it.push(We.$(We.STATUSMSG_ORPHANED_TILEPROP,"TILE_PROP"))
transSetTileLocal(He.getFrameTransaction(),e,0,false,false,t)}}function autoRestorePropTile(e,t,r){w(y(e[0])&&y(e[1])&&y(e[2]))
if(pt()||S()||Wt())return
var a=e.join(",")
if(!Gr[a]){Gr[a]=true
it.push(We.$(We.STATUSMSG_PROP_WOUT_TILEPROP,"TILE_PROP"))
transSetTileLocal(He.getFrameTransaction(),e,t,false,false,r||0)}}var Fr=new Int32Array(3)
function getPropLocal(e){var t=getTileLocal(e,0,false)
if(t<_t||t>ut)return null
var r=t-_t
var a=false
for(var i=r;i>=0;--i){Fr[2]=e[2]-i
for(var o=r-i;o>=0;--o){Fr[1]=e[1]-o
var n=r-i-o
Fr[0]=e[0]-n
var s=chunkIdFromLocalIntPos(Fr)
var l=pr[s]
if(!l||!l.did_gen)a=true
else if(l.props){var c=l.getProp(Mr)
if(c&&c.size[0]>n&&c.size[1]>o&&c.size[2]>i)return c}}}if(a)return null
autoCleanPropTile(e,t)
return null}var Wr=Z()
function getPropRelativeFromTile(e,t,r){w(r>=_t&&r<=ut)
w(t[0]>=0&&t[0]<$)
w(t[1]>=0&&t[1]<$)
w(t[2]>=0&&t[2]<$)
var a=r-_t
var i=false
for(var o=a;o>=0;--o){Fr[2]=t[2]-o
var n=e
if(Fr[2]<0){Fr[2]+=$
n-=re}for(var s=a-o;s>=0;--s){Fr[1]=t[1]-s
var l=n
if(Fr[1]<0){Fr[1]+=$
l-=ae}var c=a-o-s
Fr[0]=t[0]-c
var _=l
if(Fr[0]<0){Fr[0]+=$;--_}var u=pr[_]
if(!u||!u.did_gen)i=true
else if(u.props){var d=u.getProp(Fr)
if(d&&d.size[0]>c&&d.size[1]>s&&d.size[2]>o)return d}}}if(i)return null
getLocalPosFromChunkID(Wr,e,t)
autoCleanPropTile(Wr,r)
return null}function andGetProp(){return getPropRelativeFromTile(Pr.chunk_id,Mr,kr)}function getPropRelative(e,t){var r=getTileRelative(e,t)
if(r>=_t&&r<=ut)return andGetProp()
return null}var jr=function(){var u=Z()
var d=Z()
function chunkPosFromLocalPos(e){j(e,e,1/$)
N(e,h)}return function gatherPropsFn(e,t,r){k(u,t,D,-r)
chunkPosFromLocalPos(u)
k(d,t,D,r)
chunkPosFromLocalPos(d)
r*=r
var a=[]
for(var i=u[2];i<=d[2];++i)for(var o=u[1];o<=d[1];++o)for(var n=u[0];n<=d[0];++n){var s=pr[n+o*ae+i*re]
if(!s)continue
var l=s.props
if(!l)continue
for(var c in l){var _=l[c]
if(!_)continue
if(!e(_))continue
_.getLocalPos(Mr)
if(b(Mr,t)>r)continue
a.push(_)}}return a}}()
l.gatherProps=jr
function removeProp(e){var t=e.pos
for(var r=0;r<e.size[2];++r){Ur[2]=t[2]+r
for(var a=0;a<e.size[1];++a){Ur[1]=t[1]+a
for(var i=0;i<e.size[0];++i){Ur[0]=t[0]+i
setTileRelative(e.chunk_id,Ur,0,false)}}}pr[e.chunk_id].setProp(t,null)}var Hr=function(){var f=new Int32Array(3)
var v=new Int32Array(3)
return function raycastLocalFn(e,t,r,a,i,o){a=Vt((a+$-1)/$)
var n=chunkIdFromLocalIntPos(t)
var s=r[0]?0:r[1]?1:2
var l=r[s]
f[0]=Mr[0]
f[1]=Mr[1]
f[2]=Mr[2]
var c=(r[2]*ae+r[1])*ae+r[0]
while(a){var _=pr[n]
if(_&&_.did_gen&&!_.data&&(!i||!_.liquid));else while(f[s]>=0&&f[s]<$){if(!_||!_.did_gen){B(e,t)
return-1}var u=_.data&&_.get(f,false)
if(u>=_t&&u<=ut){var d=getPropRelativeFromTile(_.chunk_id,f,u)
if(d&&o)o[d.uid]=d
if(d&&d.inv.tangible_height&&_.getLocalPos(v)[2]+f[2]>=d.getLocalPos()[2]+d.inv.tangible_height)u=0
if(!d||d.isIntangible())u=0}else if(u>=lt)u=0
if(!u&&i&&_.liquid&&_.get(f,true))u=st
if(u){if(e){z(e,_.pos,h)
W(e,e,$)
N(e,f)}return u}f[s]+=l}n+=c;--a
if(l>0)f[s]=0
else f[s]=$-1}return 0}}()
l.raycastLocal=Hr
var zr=function(){var g=new Int32Array(3)
var E=new Int32Array(3)
var y=Z()
var T=Z()
return function raycast3DLocalFn(e,t,r,a,i,o,n,s,l){var c=s?getTileLocalOrQueuedPlace:getTileLocal
var _=s?-1:0
G(g,a)
for(var u=0;u<3;++u)if(!i[u]){E[u]=0
y[u]=o+1}else if(i[u]<0){E[u]=-1
y[u]=(g[u]-a[u])/i[u]
T[u]=-1/i[u]}else{y[u]=(g[u]+1-a[u])/i[u]
E[u]=1
T[u]=1/i[u]}var d=0
var f=0
var v=0
var h=null
var p
do{var m=y[0]<y[1]?0:1
if(y[2]<y[m])m=2
if(y[m]>o)break
v=y[f=m]
g[m]+=E[m]
y[m]+=T[m]
if((d=c(g,_,false))>=_t&&d<=ut)if((h=getPropLocal(g))&&(!h.inv.clickable||l&&l[h.item_id])){h=null
d=0}if(n&&(p=andGetLiquid()))if(!d)d=st}while(!d)
B(t,g)
t[f]-=E[f]
B(e,g)
k(r,a,i,v)
return d?{tile:d,prop:h,liquid:p}:0}}()
l.raycast3DLocal=zr
var Vr=function(){var l=new Int32Array(3)
var c=new Int32Array(3)
var _=Z()
var u=Z()
return function raycast3DLocalCBFn(e,t,r,a){var i=-1
G(l,e)
for(var o=0;o<3;++o)if(!t[o]){c[o]=0
_[o]=r+1}else if(t[o]<0){c[o]=-1
_[o]=(l[o]-e[o])/t[o]
u[o]=-1/t[o]}else{_[o]=(l[o]+1-e[o])/t[o]
c[o]=1
u[o]=1/t[o]}var n=0
do{var s=_[0]<_[1]?0:1
if(_[2]<_[s])s=2
if(_[s]>r)break
l[s]+=c[s]
_[s]+=u[s]
n=a(getTileLocal(l,i,false),l)}while(!n)
return n}}()
l.raycast3DLocalCB=Vr
var Yr=function(){var g=new Int32Array(3)
var E=new Int32Array(3)
var y=new Int32Array(3)
var T=Z()
var I=Z()
var S=Z()
return function beamcast3DLocalFn(e,t,r,a,i,o,n){k(S,t,i,-.5)
N(S,M)
G(g,S)
for(var s=0;s<3;++s)if(!r[s]){y[s]=0
T[s]=a+1}else if(r[s]<0){y[s]=-1
T[s]=(g[s]-S[s])/r[s]
I[s]=-1/r[s]}else{T[s]=(g[s]+1-S[s])/r[s]
y[s]=1
I[s]=1/r[s]}var l=0
var c=a
do{var _=T[0]<T[1]?0:1
if(T[2]<T[_])_=2
if(T[_]>c)break
var u=false
var d=Ir[_][0]
var f=Ir[_][1]
E[_]=g[_]+(y[_]>0?o?0:i[_]:o?i[_]-1:-1)
e:for(var v=0;v<i[d];++v){E[d]=g[d]+v
for(var h=0;h<i[f];++h){E[f]=g[f]+h
var p=getTileLocalOrQueuedPlace(E,0,false)
if(p>=_t&&p<=ut){var m=andGetProp()
if(!m||!m.inv.clickable||n&&m.isIntangible())p=0}if(p){l=p
u=true
if(!o)c=0
else c=Kt(c,Kt(T[_]+I[_],qt(T[d],T[f])))
break e}}}if(!u)g[_]+=y[_]
T[_]+=I[_]}while(true)
B(e,g)
return l}}()
l.beamcast3DLocal=Yr
var qr=function(){var A=new Int32Array(3)
var w=new Int32Array(3)
var L=new Int32Array(3)
var R=Z()
var x=Z()
var O=Z()
var b=Z()
var N=Z()
var C=Z()
return function beamcast3DLocal2Fn(e,r,a,t,i,o){var n=Vt(2*i)+1
k(O,r,D,-.5*n)
G(A,O)
for(var s=0;s<3;++s)if(!a[s]){L[s]=0
R[s]=t+1}else if(a[s]<0){L[s]=-1
R[s]=(A[s]-O[s])/a[s]
x[s]=-1/a[s]}else{R[s]=(A[s]+1-O[s])/a[s]
L[s]=1
x[s]=1/a[s]}var l
var c
function checkSample(){var e=getTileLocal(w,0,false)
if(e>=ht)if(e>=_t&&e<=ut){var t=andGetProp()
if(!t||!t.inv.mineable)return false}else return false
else if(!e)return false
P(b,w,M)
z(N,b,r)
if((l=Ce(r,a,b))>i)return false
if((c=U(N,a))<=0)return false
if(c<2*l)return false
return true}var _=false
e:for(var u=0;u<n;++u){w[2]=A[2]+u
for(var d=0;d<n;++d){w[1]=A[1]+d
for(var f=0;f<n;++f){w[0]=A[0]+f
if(checkSample()){_=true
break e}}}}if(!_)e:do{var v=R[0]<R[1]?0:1
if(R[2]<R[v])v=2
if(R[v]>t)return false
var h=Ir[v][0]
var p=Ir[v][1]
w[v]=A[v]+(L[v]>0?n:-1)
for(var m=0;m<n;++m){w[h]=A[h]+m
for(var g=0;g<n;++g){w[p]=A[p]+g
if(checkSample())break e}}A[v]+=L[v]
R[v]+=x[v]}while(true)
k(C,r,a,c)
var E=c
B(o,w)
F(C)
var y=Vt(i)
for(var T=-y;T<=y;++T){w[2]=C[2]+T
for(var I=-y;I<=y;++I){w[1]=C[1]+I
for(var S=-y;S<=y;++S){w[0]=C[0]+S
if(checkSample())if(c<E){B(o,w)
E=c}}}}k(e,r,a,E)
return true}}()
l.beamcast3DLocal2=qr
function ensurePristineSendProp(e,t){w(!t.user_inv_type)
var r=pr[t.chunk_id]
w(r&&r.did_gen)
ensurePristineSend(e,r)}function assertPropPristineSend(e){var t=pr[e.chunk_id]
w(t)
w(t.sent_pristine)}var Kr=new Int32Array(3)
function transPropRemove(e,t,r,a){t.getLocalPos(Kr)
var i=pr[t.chunk_id]
for(var o=0;o<t.size[2];++o){Ur[2]=Kr[2]+o
for(var n=0;n<t.size[1];++n){Ur[1]=Kr[1]+n
for(var s=0;s<t.size[0];++s){Ur[0]=Kr[0]+s
var l=getTileLocal(Ur)
if(l>=_t&&l<=ut)transSetTileLocal(e,Ur,0,false,a,l,r)}}}if(r)i.setProp(t.pos,null)
var c=e.opPropSet(t.version,t.chunk_id,t.pos,null)
if(r)c.pred=true}function transSetPropLocal(e,t,r,a,i){var o=r.onFlow!==T
var n=chunkIdFromLocalIntPos(t)
var s=pr[n]
w(s)
w(s.did_gen)
ensurePristineSend(e,s)
var l=!i&&s.getProp(Mr)
w(!l)
var c=e.opPropSet(l?l.version:0,n,Mr,r)
if(a){c.pred=true
s.setProp(Mr,r)}for(var _=0;_<r.size[2];++_){Ur[2]=t[2]+_
for(var u=0;u<r.size[1];++u){Ur[1]=t[1]+u
for(var d=0;d<r.size[0];++d){Ur[0]=t[0]+d
transSetTileLocal(e,Ur,_t+d+u+_,false,false,0,a)
if(o)transSetTileLocal(e,Ur,0,true,false,void 0,a)}}}}var Zr=new Int32Array(3)
function transPropUpdate(e,t,r){if(r){getLocalPosFromChunkID(Zr,t.chunk_id,t.pos)
for(var a=0;a<3;++a){var i=Ir[a][0]
var o=Ir[a][1]
for(var n=t.last_size[a];n<t.size[a];++n){Ur[a]=Zr[a]+n
for(var s=0;s<t.size[i];++s){Ur[i]=Zr[i]+s
for(var l=0;l<t.size[o];++l){Ur[o]=Zr[o]+l
transSetTileLocal(e,Ur,_t+s+l+n,false,false,void 0)}}}for(var c=t.last_size[a]-1;c>=t.size[a];--c){Ur[a]=Zr[a]+c
for(var _=0;_<t.last_size[i];++_){Ur[i]=Zr[i]+_
for(var u=0;u<t.last_size[o];++u){Ur[o]=Zr[o]+u
transSetTileLocal(e,Ur,0,false,false,void 0)}}}}B(t.last_size,t.size)}ensurePristineSendProp(e,t)
var d=t.version
t.version=A(d,1e4)
e.opPropSet(d,t.chunk_id,t.pos,t).pred=true}function transPropUpdateField(e,t,r,a,i){var o=t[a]
if(void 0===o)o=null
if(t[a]===i)return
var n=pr[t.chunk_id]
w(n&&n.did_gen)
ensurePristineSend(e,n)
t[a]=i
e.opPropMod(t.chunk_id,t.pos,r,o,i,t.item_id).pred=true
t.updateDrawable()}function transBagAdd(e,t){var r=chunkIdFromLocalIntPos(t.target_pos)
if(He.omp&&!ze.isSpoiled(Cr,null))ensurePristineSend(e,pr[r])
e.opBagAdd(r,Mr,t)}var Xr=Z()
function transItemAnim(e,t){w(t.style)
w(t.src_type)
w(t.target_type)
w(t.items&&t.items.length)
var r=t.src
var a=0
if(t.src_type===se){a=chunkIdFromLocalFloatPos(Xr,t.src)
r=Xr}else if(!r)t.src=r=Te()
var i=t.target
var o=0
if(t.target_type===se){o=chunkIdFromLocalIntPos(t.target)
i=Mr}else if(!i)t.target=i=Te()
var n=e.opItemAnim(t.style,t.from_center,t.src_type,a,r,t.target_type,o,i,t.items)
if(t.pred){n.pred=true
Le.add(t)}}VoxelData.prototype.releaseProps=function(){if(this.props){for(var e in this.props){var t=this.props[e]
t.removed=true
if(t.onRemove)t.onRemove()}this.props=null}}
VoxelData.prototype.dispose=function(){this.disposed=true
if(this.geom){this.geom.dispose()
this.geom=null}if(this.geom_alpha){this.geom_alpha.dispose()
this.geom_alpha=null}if(this.geom_liquid){this.geom_liquid.dispose()
this.geom_liquid=null}this.data=null
this.liquid=null
this.light_torch=null
this.light_sun=null
this.releaseProps()
this.setMemUsage(0)
kt(this)}
VoxelData.prototype.updateInUpdateStateList=function(){var e=this.liquid||this.has_updatable_prop
if(!e&&this.in_list_update){this.in_list_update=false
mt.list_need_update.remove(this)}else if(e&&!this.in_list_update){this.in_list_update=true
mt.list_need_update.add(this)}}
VoxelData.prototype.updateHasUpdatableProp=function(e){if(!(this.has_updatable_prop=e)&&this.props)for(var t in this.props){var r=this.props[t]
if(r&&r.updateState){this.has_updatable_prop=true
break}}this.updateInUpdateStateList()}
VoxelData.prototype.updateInTickList=function(){var e=this.has_tickable_prop
if(!e&&this.in_list_tick){this.in_list_tick=false
mt.list_need_tick.remove(this)}else if(e&&!this.in_list_tick){this.in_list_tick=true
mt.list_need_tick.add(this)}}
VoxelData.prototype.updateHasTickableProp=function(e){if(!(this.has_tickable_prop=e)&&this.props)for(var t in this.props){var r=this.props[t]
if(r&&r.tick){this.has_tickable_prop=true
break}}this.updateInTickList()}
VoxelData.prototype.updateHasLiquid=function(e){if(!e&&this.liquid){var t=false
for(var r=0;r<this.liquid.length;++r)if(this.liquid[r]){t=true
break}if(!t){this.liquid=null
if(this.geom_liquid){this.geom_liquid.dispose()
this.geom_liquid=null
this.updateInDrawList()}if(!this.data&&this.mesh_dirty){if(this.in_list_mesh)mt.listRemoveMesh(this)
this.mesh_dirty=0}}}this.updateInUpdateStateList()}
function checkPropTiles(e){var t=e.chunk_id,r=e.props
e.did_prop_check=true
if(!r)return
if(pt()||S())return
for(var a in r){var i=r[a]
var o=i.size,n=i.pos
var s=n[0],l=n[1],c=n[2]
for(var _=0;_<o[2];++_){var u=c+_<$
for(var d=0;d<o[1];++d){var f=l+d<$
for(var v=0;v<o[0];++v){var h=s+v<$
var p=_t+v+d+_
var m=((c+_)*$+l+d)*$+s+v
var g=e
if(!(h&&f&&u)){var E=t
if(!h){E++
m-=$}if(!f){E+=ae
m-=ee}if(!u){E+=re
m-=te}w(m>=0&&m<te)
var y=pr[E]
w(y)
w(y.did_gen)
g=y}var T=g.data&&g.data[m]
if(T!==p)if(e.sent_pristine&&!(T>=_t&&T<=ut)){getLocalPosFromChunkID(Wr,t,n)
Wr[0]+=v
Wr[1]+=d
Wr[2]+=_
autoRestorePropTile(Wr,p,T)}else if(!e.sent_pristine||I.DEBUG)window.onerror((g.sent_pristine?"":"procgen")+" prop tile mismatch ("+p+","+T+") at "+g.chunk_id+","+m+" in seed:"+zt(),"voxel_data.js",0,0)}}}}}var Qr=[-re-ae-1,-re-ae,-re-ae+1,-re-1,-re,1-re,-re+ae-1,-re+ae,-re+ae+1,-ae-1,-ae,1-ae,-1,1,ae-1,ae,ae+1,re-ae-1,re-ae,re-ae+1,re-1,re,re+1,re+ae-1,re+ae,re+ae+1]
w.equal(Qr.length,26)
var Jr=67108863
l.NEIGHBOR_MASK_ALL=Jr
var $r=Qr.map(function(e,t){return 1<<t})
var ea=Qr.map(function(e,t){return~(1<<t)})
function getNeighborGenMask(e){var t=0
for(var r=0;r<26;++r){var a=pr[e-Qr[r]]
if(a&&a.did_gen)t|=1<<r}return t}function updateNeighborMasks(e,t){for(var r=0;r<26;++r){var a=pr[e+Qr[r]]
if(a)if(t){if((a.gened_neighbors|=$r[r])===Jr){if(!a.did_prop_check&&a.did_gen)checkPropTiles(a)
if(a.mesh_dirty)if(!a.in_list_mesh&&!a.mesh_in_flight)mt.listAddMesh(a)}}else{a.gened_neighbors&=ea[r]
if(a.in_list_mesh)mt.listRemoveMesh(a)}}}VoxelData.prototype.allNeighborsGened=function(){if(!this.did_gen)return false
if(this.gened_neighbors===Jr)return true
this.gened_neighbors=getNeighborGenMask(this.chunk_id)
return this.gened_neighbors===Jr}
VoxelData.prototype.recycle=function(){this.dispose();++this.reused
if(Nr.length<br)Nr.push(this)
else this.mem_tracker.count--}
VoxelData.prototype.unload=function(){delete pr[this.chunk_id]
if(this.did_gen)updateNeighborMasks(this.chunk_id,false)
bt(this)
this.recycle()}
var ta=Z()
VoxelData.prototype.setDataMembers=function(e){w(!this.data)
this.data=e.data
w(!this.liquid)
this.liquid=e.liquid
this.full=e.full
w(!this.props)
if(e.props){this.props={}
for(var t in e.props){var r=e.props[t]
var a=r.size,i=r.rot,o=r.contents,n=r.proc_genned
w(a)
t=Number(t)
w(!this.props[t])
r.type=ie
var s=tt(Re(r))
s.setRot(i)
if(o)s.contents=o.map(Re)
if(!C(a,s.size))window.onerror("procgen prop mismatched size ("+a.join()+"!="+s.size.join()+" "+this.chunk_id+","+t+" in seed:"+zt(),"voxel_data.js",0,0)
s.chunk_id=this.chunk_id
H(ta,15&t,(240&t)>>4,(3840&t)>>8)
s.setPos(ta)
s.proc_genned=n
if((this.props[t]=s).baked){if(!this.baked_props)this.baked_props={}
this.baked_props[t]=s.baked}if(s.draw){if(!this.drawable_props)this.drawable_props={}
this.drawable_props[t]=s}if(s.updateState)this.updateHasUpdatableProp(true)
if(s.tick)this.updateHasTickableProp(true)}}this.updateInUpdateStateList()
this.dirty()
if(e.liquid_stable)this.liquid_unstable=false
vr.gen+=e.gen_time}
VoxelData.prototype.assertInChunkMap=function(){w(pr[this.chunk_id]===this)}
VoxelData.prototype.doGen=function(t){var r=this
w(!this.disposed)
w(!this.did_gen)
w(!this.data)
this.assertInChunkMap()
It(this,function(e){if(e)return void t(e)
w(r.did_gen)
r.updateHasLiquid(false)
r.assertInChunkMap()
updateNeighborMasks(r.chunk_id,true)
Rt(r)
t()})}
function sqr(e){return e*e}function getPropLighting(e,t,r){if(!gr){e.scale_lights=false
return}G(Mr,t)
var a=posPairFromLocalIntPos(Mr)
var i=pr[a[0]]
if(!i){if(!r)e.scale_lights=false
return}var o=a[1]
var n=i.light_torch,s=i.light_sun
if(!i.data&&!n&&!s){if(r){if(e.scale_lights){var l=5e-4*I.frame_dt
var c=e.torch_target-e.torch_factor
e.torch_factor+=m(c,-l,l)
c=e.sun_target-e.sun_factor
e.sun_factor+=m(c,-l,l)
return}e.torch_target=0
e.sun_target=1}e.scale_lights=true
e.torch_factor=0
e.sun_factor=1
return}var _=n?sqr(Ne[n[o]]/255):0
var u=s?sqr(be[s[o]]/255):0
if(r){var d=5e-4*I.frame_dt
if(!n&&!s&&!i.did_mesh){if(e.scale_lights){var f=e.torch_target-e.torch_factor
e.torch_factor+=m(f,-d,d)
f=e.sun_target-e.sun_factor
e.sun_factor+=m(f,-d,d)}return}e.torch_target=_
e.sun_target=u
if(e.scale_lights){var v=_-e.torch_factor
e.torch_factor+=m(v,-d,d)
v=u-e.sun_factor
e.sun_factor+=m(v,-d,d)
return}}e.scale_lights=true
e.torch_factor=_
e.sun_factor=u}function getPropLighting2(e,t){var r=t.draw_opts
if(!gr){r.scale_lights=false
return}r.scale_lights=true
var a=t.pos_idx
var i=e.light_torch,o=e.light_sun
r.torch_factor=i?sqr(Ne[i[a]]/255):0
r.sun_factor=o?sqr(be[o[a]]/255):0}function getPropLighting2Prop(e){getPropLighting2(pr[e.chunk_id],e)}VoxelData.prototype.updatePropLights=function(e){var t=this.light_torch,r=this.light_sun
if(!this.drawable_props)return
for(var a in this.drawable_props){var i=this.drawable_props[a]
if(e){i.draw_opts.scale_lights=true
i.draw_opts.torch_factor=t?sqr(Ne[t[a]]/255):0
i.draw_opts.sun_factor=r?sqr(be[r[a]]/255):0}else i.draw_opts.scale_lights=false}}
VoxelData.prototype.fadeIn=function(){if(!this.load_timestamp)this.load_timestamp=I.frame_timestamp}
VoxelData.prototype.setMeshData=function(e,t){w(t.ver_meshing)
w(t.ver_meshing!==this.geom_ver_meshing)
if(t.mesh_time)vr.mesh+=t.mesh_time
if(t.ver_meshing<this.geom_ver_meshing)return
this.geom_ver_meshing=t.ver_meshing
this.fadeIn()
if(this.geom_liquid){this.geom_liquid.dispose()
this.geom_liquid=null}if(this.geom){this.geom.dispose()
this.geom=null}if(this.geom_alpha){this.geom_alpha.dispose()
this.geom_alpha=null}if(t.data)this.geom=i.createQuads(dr,t.data)
if(t.alpha)this.geom_alpha=i.createQuads(dr,t.alpha)
if(t.liquid)this.geom_liquid=i.createQuads(dr,t.liquid)
if(t.lighting){this.light_sun=t.light_sun
this.light_torch=t.light_torch
this.updatePropLights(true)}else this.updatePropLights(false)
if(e&&e.for_baking){w(t.data)
this.baked_mesh_data=t.data
w(!t.alpha)}}
VoxelData.prototype.updateInDrawList=function(){var e=this.shouldDraw()
if(e&&!this.in_list_draw){this.in_list_draw=true
mt.list_need_draw.add(this)}else if(!e&&this.in_list_draw){this.in_list_draw=false
mt.list_need_draw.remove(this)}}
VoxelData.prototype.doMesh=function(t){var r=this
w(!this.disposed)
w(this.mesh_dirty)
this.mesh_dirty=0
if(!this.data&&!this.liquid)return
if(!t){w(!this.mesh_in_flight)
this.mesh_in_flight=true}Lt(this,{ao:mr,lighting:gr},t,function(e){if(!t){w(r.mesh_in_flight)
r.mesh_in_flight=false}if(e){console.error("Error meshing chunk "+r.chunk_id+": "+e)
throw e}if(t&&gr&&!r.mesh_dirty&&!(I.defines.NOWORKERS||I.defines.NOMESHWORKERS)){r.ver_meshing++
r.mesh_dirty=yt}if(r.mesh_dirty&&!r.in_list_mesh&&!r.mesh_in_flight&&r.gened_neighbors===Jr){w(r.did_gen)
mt.listAddMesh(r)}r.did_mesh=true
r.updateInDrawList()})}
VoxelData.prototype.get3=function(e,t,r,a){if(e<0||t<0||r<0||e>=this.size[0]||t>=this.size[1]||r>=this.size[2])return 0
var i=r*this.stride2+t*this.stride1+e
if(a)return this.liquid[i]
else return this.data[i]}
var ra=new Uint8Array(3)
VoxelData.prototype.getDelta=function(e,t,r){ra[0]=e[0]+t[0]
ra[1]=e[1]+t[1]
ra[2]=e[2]+t[2]
return this.get(ra,r)}
var aa=function(){var e=new Array(64)
for(var t=0;t<64;++t){var r=e[t]=[0]
if(1&t)r.push(-1)
if(2&t)r.push(1)
var a=r.length
if(4&t)for(var i=a-1;i>=0;--i)r.push(r[i]-ae)
if(8&t)for(var o=a-1;o>=0;--o)r.push(r[o]+ae)
a=r.length
if(16&t)for(var n=a-1;n>=0;--n)r.push(r[n]-re)
if(32&t)for(var s=a-1;s>=0;--s)r.push(r[s]+re)
r.splice(0,1)}return e}()
VoxelData.prototype.dirty=function(e){if(this.data||this.liquid){this.ver_meshing++
if(!this.main_world)return
if((e=e||yt)>=this.mesh_dirty){if(this.mesh_in_flight){if(e>this.mesh_dirty){w(!this.in_list_mesh)
if(e===Et){this.mesh_dirty=e
mt.listAddMesh(this)}}}else if(!this.in_list_mesh){if(this.gened_neighbors!==Jr)this.gened_neighbors=getNeighborGenMask(this.chunk_id)
if(this.gened_neighbors===Jr){if(!this.did_prop_check)checkPropTiles(this)
this.mesh_dirty=e
mt.listAddMesh(this)}}else if(e>this.mesh_dirty&&e===Et){mt.listRemoveMesh(this)
this.mesh_dirty=e
mt.listAddMesh(this)}if(this.mesh_dirty!==e)this.mesh_dirty=e}}else{this.did_prop_check=true
this.fadeIn()}}
var ia=null
function voxelDataDirtyCacheStart(){ia={}}function voxelDataDirtyCacheEnd(){ia=null}function dirty(e,t,r,a){if(ia){var i=[e,t,r,a].join()
if(ia[i])return
ia[i]=true}var o=aa[r]
for(var n=0;n<o.length;++n){var s=e+o[n]
var l=pr[s]
if(l)l.dirty(Et)}o=aa[t]
for(var c=0;c<o.length;++c){var _=e+o[c]
var u=pr[_]
if(u)u.dirty(yt)}o=aa[a]
for(var d=0;d<o.length;++d){var f=e+o[d]
var v=pr[f]
if(v&&!v.liquid_unstable){v.liquid_unstable=true
v.last_liquid_tick=Me.liquid_tick_idx}}}VoxelData.prototype.setUnchecked=function(e,t){this.data[e[2]*this.stride2+e[1]*this.stride1+e[0]]=t}
VoxelData.prototype.setUncheckedLiquid=function(e,t){this.liquid[e[2]*this.stride2+e[1]*this.stride1+e[0]]=t}
VoxelData.prototype.set=function(e,t,r,a){w(!(e[0]<0||e[1]<0||e[2]<0||e[0]>=this.size[0]||e[1]>=this.size[1]||e[2]>=this.size[2]))
var i=e[2]*this.stride2+e[1]*this.stride1+e[0]
var o
if(r){if(this.liquid[i]===t)return
this.liquid[i]=t
this.updateHasLiquid(t)}else{if((o=this.data[i])===t)return
this.data[i]=t}if(!this.main_world)return
if(!t)this.full=false
if(!r){var n=o&&o<ct
var s=t&&t<ct
var l=0
if(n&&!s)l|=ce
else if(s&&!n)l|=le
this.light_dirty|=l}this.ver_data++
this.liquid_unstable=true
this.last_liquid_tick=Me.liquid_tick_idx
this.dirty(a)
var c=0
if(0===e[0])c|=1
else if(e[0]===this.size[0]-1)c|=2
if(0===e[1])c|=4
else if(e[1]===this.size[1]-1)c|=8
if(0===e[2])c|=16
else if(e[2]===this.size[2]-1)c|=32
var _=0
if(gr)_=63
else if(mr>1){var u=mr
if(e[0]<u)_|=1
else if(e[0]>this.size[0]-u)_|=2
if(e[1]<u)_|=4
else if(e[1]>this.size[1]-u)_|=8
if(e[2]<u)_|=16
else if(e[2]>this.size[2]-u)_|=32}else _=c
if(_)dirty(this.chunk_id,_,a===Et?c:0,c)}
var oa=new Uint8Array(3)
VoxelData.prototype.set3=function(e,t,r,a,i){oa[0]=e
oa[1]=t
oa[2]=r
return this.set(oa,a,i)}
VoxelData.prototype.shouldDraw=function(){return this.did_mesh&&(this.geom||this.geom_alpha||this.geom_liquid||this.drawable_props)}
VoxelData.prototype.setProp=function(e,t){w(!(e[0]<0||e[1]<0||e[2]<0||e[0]>=this.size[0]||e[1]>=this.size[1]||e[2]>=this.size[2]))
w(!this.disposed)
var r=e[2]*this.stride2+e[1]*this.stride1+e[0]
if(!t){w(this.props)
var a=this.props[r]
w(a)
a.removed=true
if(a.onRemove)a.onRemove()
delete this.props[r]
if(g(this.props))this.props=null
if(a.baked){w(this.baked_props[r])
delete this.baked_props[r]
if(g(this.baked_props))this.baked_props=null}else w(!this.baked_props||!this.baked_props[r])
if(a.draw){w(this.drawable_props[r])
delete this.drawable_props[r]
if(g(this.drawable_props)){this.drawable_props=null
if(this.in_list_draw&&!this.shouldDraw()){this.in_list_draw=false
mt.list_need_draw.remove(this)}}}else w(!this.drawable_props||!this.drawable_props[r])
if(this.has_updatable_prop)this.updateHasUpdatableProp(false)
if(this.has_tickable_prop)this.updateHasTickableProp(false)
if(a.emit)this.lightDirty(false)}else{if(!this.props)this.props={}
w(!this.props[r])
t.chunk_id=this.chunk_id
t.setPos(e)
if((this.props[r]=t).baked){if(!this.baked_props)this.baked_props={}
this.baked_props[r]=t.baked}if(t.draw){if(!this.drawable_props){this.drawable_props={}
if(!this.in_list_draw&&this.shouldDraw()){this.in_list_draw=true
mt.list_need_draw.add(this)}}this.drawable_props[r]=t}if(t.updateState)this.updateHasUpdatableProp(true)
if(t.tick)this.updateHasTickableProp(true)
getPropLighting2(this,t)
if(t.emit)this.lightDirty(true)}++this.ver_props
this.dirty()}
VoxelData.prototype.lightDirty=function(e){if(e)this.light_dirty|=ue
else this.light_dirty|=_e
if(gr){var t=63
dirty(this.chunk_id,t,0,0)}this.ver_data++}
VoxelData.prototype.replaceProp=function(e,t){w(this.props)
t.chunk_id=this.chunk_id
t.setPos(e)
var r=t.pos_idx
var a=this.props[r]
w(a)
if((this.props[r]=t).draw){w(this.drawable_props)
w(this.drawable_props[r])
this.drawable_props[r]=t}else w(!this.drawable_props||!this.drawable_props[r])
var i=false
if(t.baked){w(this.baked_props)
w(this.baked_props[r])
i=this.baked_props[r].key!==t.baked.key
this.baked_props[r]=t.baked}else w(!this.baked_props||!this.baked_props[r])
if(t.updateState)this.updateHasUpdatableProp(true)
if(t.tick)this.updateHasTickableProp(true)
getPropLighting2(this,t)
if(a.emit&&!t.emit)this.lightDirty(false)
else if(t.emit&&!a.emit)this.lightDirty(true);++this.ver_props
if(i)this.dirty()}
VoxelData.prototype.propStateUpdate=function(e){var t=e.pos_idx
w.equal(this.props[t],e)
if(e.draw){if(!this.drawable_props){this.drawable_props={}
if(!this.in_list_draw&&this.shouldDraw()){this.in_list_draw=true
mt.list_need_draw.add(this)}}this.drawable_props[t]=e}else if(this.drawable_props&&this.drawable_props[t]){delete this.drawable_props[t]
if(g(this.drawable_props)){this.drawable_props=null
if(this.in_list_draw&&!this.shouldDraw()){this.in_list_draw=false
mt.list_need_draw.remove(this)}}}if(e.baked){if(!this.baked_props)this.baked_props={}
this.baked_props[t]=e.baked}else if(this.baked_props&&this.baked_props[t]){delete this.baked_props[t]
if(g(this.baked_props))this.baked_props=null}if(e.updateState){if(!this.has_updatable_prop)this.updateHasUpdatableProp(true)}else if(this.has_updatable_prop)this.updateHasUpdatableProp(false)
if(e.tick){if(!this.has_tickable_prop)this.updateHasTickableProp(true)}else if(this.has_tickable_prop)this.updateHasTickableProp(false)}
function propStateUpdate(e){pr[e.chunk_id].propStateUpdate(e)}function propInWorld(e){if(!e)return false
var t=pr[e.chunk_id]
if(!t||!t.props)return false
return t.props[e.pos_idx]===e}VoxelData.prototype.updateGeometrySimple=function(e){var t=Date.now()
if(false!==(e=e||{}).ao)e.ao=3
e.not_world=true
var r={ver_meshing:this.ver_meshing}
if(this.data){e.liquid=false
Ke(this,r,e)}if(this.liquid){e.liquid=true
Ke(this,r,e)}r.mesh_time=Date.now()-t
this.setMeshData(e,r)}
VoxelData.prototype.updateAndReturnGeometry=function(e){var t={ver_meshing:this.ver_meshing}
if(this.data){Ke(this,t,{skip_greedy_meshing:true,need_offs:true})
var r=new Uint16Array(t.data.length)
r.set(t.data,0)
for(var a=0;a<t.data.length;a+=qe){r[0+a]+=16*e[0]*7
r[1+a]+=16*e[1]*7
r[2+a]+=16*e[2]*7}return r}return null}
var na
function defaultTint(e){var t=na[e]
w(t)
return t}function initDefaultTint(){function map(e){return o(X(0,0,0,1),e[0],e[1],e[2])}na=[]
var e=ye.BIOMES.FLAT
na[dt]=map(e.tint_grass_hsv)
na[vt]=ot.MAT_METAL_TINT[oe.GOLD]}VoxelData.prototype.worldZ=function(){return this.pos[2]*$}
var sa=[]
for(var la=0;la<ft;++la)sa.push(new Array(4))
var ca=K()
VoxelData.prototype.tintGen=function tintGen(e){if(!this.main_world){var t=defaultTint(e)
return[t,t,t,t]}var r=sa[e]
O(ca,this.pos,$)
r[0]=$e(this.vsid,ca,e)
ca[0]+=$
r[1]=$e(this.vsid+1,ca,e)
ca[1]+=$
r[2]=$e(this.vsid+ae+1,ca,e)
ca[0]-=$
r[3]=$e(this.vsid+ae,ca,e)
return r}
VoxelData.prototype.tintGenSingle=function tintGenSingle(e){if(!this.main_world)return defaultTint(e)
return Je(this.pos,e)}
VoxelData.prototype.meshCalcWorld=function(e){var t=Date.now()
var r={}
e.did_lighting=true
e.need_offs=true
if(this.data){e.liquid=false
Ke(this,r,e)}if(this.liquid){e.liquid=true
Ke(this,r,e)}if(e.lighting){r.lighting=true
r.light_sun=this.light_sun
r.light_torch=this.light_torch}r.mesh_time=Date.now()-t
return r}
function calcAtlasParams(e,t,r){var a=r.tiles_per_row,i=r.tile_res,o=r.pad,n=r.tex_w,s=r.tex_h,l=r.tex_res
n=n||l
s=s||l
l=l||(n+s)/2
var c=1/a
var _=i+2*o
var u=_/n
var d=_/s
var f=u*a
var v=I.webgl2?0:o/n
var h=I.webgl2?1:i/n
var p=I.webgl2?1:i/s
if(I.webgl2){Y(e,1,0,0,0)
e.tiles_per_row=1}else{Y(e,c,f,d,v)
e.tiles_per_row=a}if(I.webgl2)Y(t,0,0,0,0)
else Y(t,h,p,u,0)}var _a=Ee.primary
l.primary_atlas_params=_a
var ua=Ee.util
l.voxel_util_atlas_params=ua
var da=X()
l.atlas_params_voxel_util_vp=da
var fa=Z()
l.atlas_params_voxel_util_fp=fa
var va=false
var ha=false
var pa=[]
var ma=[]
var ga=Z()
VoxelData.prototype.drawProps=function(){if(ha&&1!==this.color[3]){ma.push(this)
return 0}var e=0
for(var t in this.drawable_props){var r=this.drawable_props[t]
ga[0]=this.mat[12]+1+r.pos[0]+r.draw_offs[0]
ga[1]=this.mat[13]+1+r.pos[1]+r.draw_offs[1]
ga[2]=this.mat[14]+1+r.pos[2]+r.draw_offs[2]
r.draw_opts.color=this.color
e+=r.draw(ga)||1}return e}
function exportCombinedGeometry(e,t){Xe(e,Lr,Rr,t)}function drawPropBase(e,t,r){if(e.draw)e.draw(t)
if(e.baked&&e.baked.key)e.drawBaked(r)}function drawProp(t,r){ga[0]=r[0]+t.draw_offs[0]
ga[1]=r[1]+t.draw_offs[1]
ga[2]=r[2]+t.draw_offs[2]
if(t.draw_opts&&t.draw_opts.color&&1!==t.draw_opts.color[3]){var a=r
r=ga.slice(0)
t.mat[12]=r[0]
t.mat[13]=r[1]
t.mat[14]=r[2]
_.alphaQueue({mat:t.mat,drawAlpha:function drawAlpha(e){t.draw_opts.sort_z=e
drawPropBase(t,r,a)}})}else drawPropBase(t,ga,r)}function drawPropQueued(e,t){_.opaqueQueue(drawProp.bind(null,e,t.slice(0)))}var Ea=X(.1,.1,.1,1)
var ya=X(.75,.25,.25,1)
var Ta=X(1,1,1,1)
var Ia=false
VoxelData.prototype.updateColor=function(){if(Ia)if(I.defines.CLAIM&&this.claimed!==Ct)B(this.color,Ea)
else if(I.defines.SPOILED&&ze.isSpoiledDebug(this.pos,null))B(this.color,ya)
else B(this.color,Ta)
this.color[3]=1
if(this.load_timestamp&&this.load_timestamp>He.loading_finished_timestamp){var e=I.frame_timestamp-this.load_timestamp
if(e<Tr){var t=f(e/Tr,2)
this.color[3]=t}}}
VoxelData.prototype.drawAlpha=function(e){w(this.geom_alpha||this.geom_liquid)
I.projectionZBias(.01,qt(e+16,16))
I.updateMatrices(this.mat)
p.bindArray(cr)
v.bind(Qt,ar,this.shader_params)
if(this.geom_alpha)this.geom_alpha.draw()
if(this.geom_liquid){gl.cullFace(gl.FRONT)
this.geom_liquid.draw()
gl.cullFace(gl.BACK)
this.geom_liquid.draw()}I.projectionZBias(0)}
function drawBulkStart(){p.bindArray(cr)
va=true
ha=Boolean(c.fade_chunks)
if(I.defines.CLAIM||I.defines.SPOILED)Ia=true}function drawFadingChunks(){if(!I.defines.NOCHUNKS)for(var e=0;e<pa.length;++e){var t=pa[e]
I.updateMatrices(t.mat)
v.bind(Qt,rr,t.shader_params)
t.geom.draw()}if(!I.defines.NOPROPS)for(var r=0;r<ma.length;++r)ma[r].drawProps()}function drawBulkEnd(){w(p.isArrayBound(cr))
ha=va=false
if(pa.length||ma.length){gl.colorMask(false,false,false,false)
var e=rr
if(!I.defines.NODEPTHONLY)rr=or
drawFadingChunks()
gl.colorMask(true,true,true,true)
gl.depthMask(false)
gl.depthFunc(gl.EQUAL)
gl.enable(gl.BLEND)
rr=e
drawFadingChunks()
gl.disable(gl.BLEND)
gl.depthMask(true)
gl.depthFunc(gl.LEQUAL)
pa.length=0
ma.length=0}}VoxelData.prototype.draw=function(){if(this.shift_gen!==wr)this.updateMat()
this.updateColor()
if(this.geom&&!I.defines.NOCHUNKS)if(ha&&1!==this.color[3])pa.push(this)
else{I.updateMatrices(this.mat)
if(!va)p.bindArray(cr)
v.bind(Qt,rr,this.shader_params)
this.geom.draw()}if((this.geom_alpha||this.geom_liquid)&&!I.defines.NOCHUNKSALPHA)_.alphaQueue(this)}
var Sa=5
a.registerValue("liquid_per_tick",{type:a.TYPE_INT,label:"Liquid updates per tick",range:[1,100],help:"Limit number of liquid updates per tick",get:function get(){return Sa},set:function set(e){Sa=e},store:false})
var Aa=1
var wa
var La
function updatePrepare(){La=Ue()&&!Ie()
wa=Sa}function updateFinalize(){Be()
Pt()
if(wa&&La)++Aa}function liquidUpdateDefer(e){var t=pr[e]
if(!t||!t.did_gen)return
ke(t)}VoxelData.prototype.updateState=function(){if(this.gened_neighbors!==Jr){if(this.claimed===Ct)kt(this)
return}var e=b(this.pos,h)>=mt.claim_dist_sq
if(!Ae(this))e=true
if(e){if(this.claimed===Ct)kt(this)
return}if(this.claimed===Mt&&(!this.claim_throttle||I.frame_timestamp>this.claim_throttle))Dt(this)
if(this.claimed!==Ct)return
if(this.has_updatable_prop)for(var t in this.props){var r=this.props[t]
if(r.updateState)r.updateState()}if(this.liquid&&this.liquid_unstable&&La&&wa)if(this.liquid_update_gen===Aa);else{this.liquid_update_gen=Aa
if(Fe(this))--wa}}
VoxelData.prototype.tick=function(){if(this.has_tickable_prop)for(var e in this.props){var t=this.props[e]
if(t.tick)t.tick()}}
var Ra=function(){var i=Z()
var o=[Z(-$/2,-$/2,-$/2),Z(-$/2,-$/2,$/2),Z(-$/2,$/2,-$/2),Z(-$/2,$/2,$/2),Z($/2,-$/2,-$/2),Z($/2,-$/2,$/2),Z($/2,$/2,-$/2),Z($/2,$/2,$/2)]
return function chunksGenedNearFn(e){for(var t=0;t<o.length;++t){P(i,e,o[t])
var r=chunkIdFromLocalFloatPos(Mr,i)
var a=pr[r]
if(!a||!a.did_gen)return false}return true}}()
l.chunksGenedNear=Ra
var xa={}
function remeshAll(){for(var e in pr){var t=pr[e]
if(t.geom||t.geom_alpha)t.dirty(yt)}for(var r in xa)xa[r].dispose()
xa={}}a.registerValue("ao",{type:a.TYPE_INT,label:"AO",range:[0,15],help:"(Admin) Enable various Ambient Occlusion modes",access_run:["sysadmin"],get:function get(){return mr},set:function set(e){mr=e
remeshAll()},store:false})
function lightingValueFilter(e){if(Ht()&&!e&&!Ut("sysadmin"))e=1
return e}function initModeBasedSettings(){l.lighting_value=gr=lightingValueFilter(gr)}a.registerValue("lighting",{type:a.TYPE_INT,label:"Lighting",range:[0,2],get:function get(){return gr},set:function set(e){e=lightingValueFilter(e)
if(gr!==e){l.lighting_value=gr=e
remeshAll()}},store:false})
function reset(){H(h,0,0,0)
for(var e in pr)pr[e].recycle()
l.chunk_map=pr=[]
mt.reset()
Ze(pr)
At()
xt()
je.reset()
Gr={}
Ge()
l.flashlight=0}var Oa=q(1)
var ba=Z()
var Na=q()
var Ca={}
function scaleLightVec(e,t,r){var a=Ca[t]
if(!a)a=Ca[t]=Z()
e[t]=W(a,v.globals[t],r)}function voxelPrepDrawParams(e,t,r){if(!t){e.minimum_ambient=Oa
e.light_torch_top=e.light_torch_bot=e.light_torch_mid=Q}else if(r&&r.scale_lights)if(r.monochrome){var a=qt(v.globals.light_sun_key[0]+v.globals.light_sun_top[0],v.globals.light_sun_key[1]+v.globals.light_sun_top[1],v.globals.light_sun_key[2]+v.globals.light_sun_top[2])
a=Kt(r.sun_factor*a,1)
if(I.defines.OLDLIGHT)e.ambient=e.light_diffuse=Q
else e.light_sun_key=e.light_sun_top=e.light_sun_back=Q
Na[0]=qt(v.globals.minimum_ambient[0],a)
e.minimum_ambient=Na
W(ba,D,r.torch_factor)
e.light_torch_top=e.light_torch_bot=e.light_torch_mid=ba}else if(I.defines.OLDLIGHT){scaleLightVec(e,"light_diffuse",r.sun_factor)
scaleLightVec(e,"ambient",r.sun_factor)
scaleLightVec(e,"light_torch_mid",r.torch_factor)}else{scaleLightVec(e,"light_sun_key",r.sun_factor)
scaleLightVec(e,"light_sun_top",r.sun_factor)
scaleLightVec(e,"light_sun_back",r.sun_factor)
scaleLightVec(e,"light_torch_top",r.torch_factor)
scaleLightVec(e,"light_torch_mid",r.torch_factor)
scaleLightVec(e,"light_torch_bot",r.torch_factor)}else e.light_torch_top=e.light_torch_bot=e.light_torch_mid=Q}function drawSingleVoxelDirect(e){var t=this.color,r=this.lit,a=this.mat,i=this.z_bias,o=this.draw_opts,n=this.vd,s=this.face,l=this.opaque
if(a===n.mat){var c=this.pos,_=this.size
a[0]=_[0]
a[5]=_[1]
a[10]=_[2]
a[12]=c[0]
a[13]=c[1]
a[14]=c[2]}if(i)I.projectionZBias(i,qt(e+16,16))
I.updateMatrices(a)
if(!va)p.bindArray(cr)
var u={atlas_params_vp:Lr,atlas_params_fp:Rr,color:t||D,cutout:n.cutout}
voxelPrepDrawParams(u,r,o)
v.bind(Qt,l?rr:ar,u)
if(n.geom)if(void 0!==s)n.geom.drawSub(6*s,2)
else n.geom.draw()
if(n.geom_alpha)n.geom_alpha.draw()
if(n.geom_liquid)n.geom_liquid.draw()
if(i)I.projectionZBias(0)}function drawSingleVoxel(e){var t=e.tile+(e.is_liquid?256:0)
var r=xa[t]
if(!r){(r=xa[t]=createUtilVD(new Int8Array([1,1,1]),e.is_liquid)).cutout[0]=xr
r.ver_meshing++
if(e.is_liquid){r.setUncheckedLiquid(Q,e.tile)
r.updateGeometrySimple({liquid:true})}else{r.setUnchecked(Q,e.tile)
r.updateGeometrySimple()}}e.vd=r
if(!e.mat){e.size=e.size||D
r.mat[12]=e.pos[0]
r.mat[13]=e.pos[1]
r.mat[14]=e.pos[2]
e.mat=r.mat}e.drawAlpha=drawSingleVoxelDirect
if(e.opaque)e.drawAlpha()
else _.alphaQueue(e)}var Ma=null
var Da=X()
var Pa=Z()
var ka=K()
function drawSingleVoxelTexturedDirect(e){var t=this.tile,r=this.color,a=this.texs,i=this.lit,o=this.mat,n=this.blend,s=this.draw_opts,l=this.z_bias
var c=this.atlas_params_vp||Da
var _=this.atlas_params_fp||Pa
if(o===Ma.mat){var u=this.pos,d=this.size
o[0]=d[0]
o[5]=d[1]
o[10]=d[2]
o[12]=u[0]
o[13]=u[1]
o[14]=u[2]}if(l)I.projectionZBias(l,qt(e+16,16))
I.updateMatrices(o)
if(!va)p.bindArray(a)
c[0]=t/c.tiles_per_row
ka[0]=n
var f={atlas_params_vp:c,atlas_params_fp:_,color:r||D,blend:ka,cutout:Ma.cutout}
voxelPrepDrawParams(f,i,s)
v.bind(Qt,n?ir:ar,f)
Ma.geom.draw()
if(l)I.projectionZBias(0)}function drawSingleVoxelTextured(e){if(!Ma){(Ma=createUtilVD(new Int8Array([1,1,1]))).tile_map=Sr
Ma.setUnchecked(Q,1)
Ma.updateGeometrySimple()
w(Ma.geom)
w(!Ma.geom_alpha)
w(!Ma.geom_liquid)}if(!e.texs)e.texs=[e.tex,sr]
if(!e.mat){e.size=e.size||D
Ma.mat[12]=e.pos[0]
Ma.mat[13]=e.pos[1]
Ma.mat[14]=e.pos[2]
e.mat=Ma.mat}e.drawAlpha=drawSingleVoxelTexturedDirect
if(e.opaque)e.drawAlpha()
else _.alphaQueue(e)}function shift(e){N(h,e)
l.shift_gen=wr+=1}function VoxelSimpleDrawable(e,t,r,a){this.vd=e
this.origin_offset=Z()
this.inv_origin_offset=Z()
this.setOriginOffset(t)
w(r)
this.tex=r
this.tex_unowned=Boolean(a)}VoxelSimpleDrawable.prototype.setOriginOffset=function(e){B(this.origin_offset,e)
W(this.inv_origin_offset,this.origin_offset,-1)}
VoxelSimpleDrawable.prototype.dispose=function(){this.vd.dispose()
if(!this.tex_unowned)this.tex.dispose()}
var Ba=e("gl-mat4/translate")
var Ua=e("../glov/client/mat4ScaleRotateTranslate")
VoxelSimpleDrawable.prototype.draw=function(e,t,r,a){a=a||{}
var i=this.vd
t=t||s
Ua(i.mat,r=r||1,t,e)
this.drawMat(i.mat,a)}
VoxelSimpleDrawable.prototype.drawMat=function(e,t){var r=this.vd
Ba(r.mat,e,this.inv_origin_offset)
e=r.mat
var a=t.z_bias,i=t.sort_z
if(a&&i)I.projectionZBias(.01,qt(i+16,16))
I.updateMatrices(e)
if(!va){p.bind(0,this.tex)
for(var o=1;o<cr.length;++o)p.bind(o,cr[o])}var n=t.color||D
var s={atlas_params_vp:Lr,atlas_params_fp:Rr,color:n,cutout:r.cutout}
if(t.nofog||t.unlit)s.fog_params=Q
voxelPrepDrawParams(s,!t.unlit,t)
v.bind(Qt,ar,s)
if(!t.alpha_queue){if(r.geom)r.geom.draw()
if(r.geom_alpha)r.geom_alpha.draw()
if(r.geom_liquid)r.geom_liquid.draw()}else{var l=false
var c=t.flipped&&1===n[3]&&(r.geom||r.drawable_props&&!t.noprops)
if(c){c=true
gl.cullFace(gl.FRONT)}if(r.geom)if(1!==n[3])l=s.do_geom=true
else r.geom.draw()
if(r.drawable_props&&!t.noprops)r.drawProps()
if(r.geom_alpha||r.geom_liquid)l=true
if(l)_.alphaQueue({mat:e,drawAlpha:this.drawAlpha2.bind(this,e,s,t)})
if(c)gl.cullFace(gl.BACK)}if(a&&i)I.projectionZBias(0)}
VoxelSimpleDrawable.prototype.drawAlpha2=function(e,t,r,a){var i=this.vd
if(r.flipped)gl.cullFace(gl.FRONT)
if(r.scale_lights)voxelPrepDrawParams(t,!r.unlit,r)
I.projectionZBias(.01,qt(a+16,16))
I.updateMatrices(e)
if(!va){p.bind(0,this.tex)
for(var o=1;o<cr.length;++o)p.bind(o,cr[o])}v.bind(Qt,ar,t)
if(t.do_geom)i.geom.draw()
if(i.geom_alpha)i.geom_alpha.draw()
if(i.geom_liquid){gl.cullFace(gl.FRONT)
i.geom_liquid.draw()
gl.cullFace(gl.BACK)
i.geom_liquid.draw()}I.projectionZBias(0)
if(r.flipped)gl.cullFace(gl.BACK)}
function loadGoxel(e,t){t=t||{}
var r=e.split("\n")
var a=[]
a.push("ff00ff")
var i={}
var o=Z(Infinity,Infinity,Infinity)
var n=Z(-Infinity,-Infinity,-Infinity)
var s=[]
for(var l=0;l<r.length;++l){var c=r[l].trim()
if(!c||"#"===c[0])continue
var _=c.split(" ")
w.equal(_.length,4)
var u=Z(Number(_[0]),Number(_[1]),Number(_[2]))
for(var d=0;d<3;++d){o[d]=Kt(o[d],u[d])
n[d]=qt(n[d],u[d]+1)}var f=_[3]
w.equal(f.length,6)
var v=i[f]
if(!v){v=i[f]=a.length
a.push(f)}s.push([u,v])}var h=Z()
k(h,D,o,-1)
var p=Z()
z(p,n,o)
k(p,p,D,2)
if(t.ground){p[2]--
h[2]--}w(qt(qt(p[0],p[1]),p[2])<128)
var m=createUtilVD(p=new Int8Array(p))
var g=new Int8Array(3)
for(var E=0;E<s.length;++E){var y=s[E]
P(g,y[0],h)
m.setUnchecked(g,y[1])}m.tile_map=Ar
t.tint_colors=[]
w(a.length<=256)
for(var T=0;T<a.length;++T){var I=Z()
var S=a[T]
for(var A=0;A<3;++A)I[A]=parseInt(S.slice(2*A,2*A+2),16)/255
t.tint_colors[T]=I}m.updateGeometrySimple(t)
if(t.origin_offset)N(h,t.origin_offset)
return new VoxelSimpleDrawable(m,h,nr,true)}function createSimpleDrawable(e,t){return new VoxelSimpleDrawable(e,t,nr,true)}var Ga=Z(1,1,1)
var Fa=Z(1,1,1)
var Wa=Z(1,1,1)
var ja=Z(1,1,1)
var Ha=5e-4
var za=q(1)
function tickVD(){at(Ga,Fa,Wa)
W(ja,Fa,l.flashlight)
za[0]=I.frame_timestamp*Ha}var Va=X(5,20,0,0)
var Ya=X(0,0,0,0)
var qa=X()
var Ka=X()
function applyBumpParam(){if(0===qa[1])Y(Ka,0,0,0,0)
else Y(Ka,1/(qa[1]-qa[0]),-qa[0]/(qa[1]-qa[0]),0,0)}a.register({cmd:"bump_fade",help:"Set bumpmap fade parameters",usage:"$HELP\nUsage: /bump_fade fade_start fade_end\n  Fade start/end distance in voxels\n  Default: "+Va[0].toFixed(0)+" "+Va[1].toFixed(0)+" (WebGL1)\n  Default: "+Ya[0].toFixed(0)+" "+Ya[1].toFixed(0)+" (WebGL2)",func:function func(e,t){var r=e.split(" ")
if(2===r.length){V(qa,r.map(L))
applyBumpParam()}return t(null,"bump_fade = "+qa[0].toFixed(2)+" "+qa[1].toFixed(2))}})
var Za=new Float32Array([.05,.1,.2,.4,200])
var Xa=X()
function applyBevelParamWorld(){Y(Xa,1-Za[0],1-Za[1],1-Za[3],1/Za[4])}function applyBevelParamCharacters(){Y(Xa,1-Za[2],1-Za[2],1-Za[3],1/Za[4])}applyBevelParamWorld()
a.register({cmd:"bevel_param",help:"Set bevel parameters",usage:"$HELP\nUsage: /bevel_param near_vox near_sepx near_char far_all distance\n  Near and Far between 0.01 and 0.49\n  Distance in voxels\n  Default: "+Za[0].toFixed(2)+" "+Za[1].toFixed(2)+" "+Za[2].toFixed(2)+" "+Za[3].toFixed(2)+" "+Za[4].toFixed(0),func:function func(e,t){var r=e.split(" ")
if(5===r.length){for(var a=0;a<r.length;++a)Za[a]=Number(r[a])
applyBevelParamWorld()}return t(null,"bevel_param = "+Za[0].toFixed(2)+" "+Za[1].toFixed(2)+" "+Za[2].toFixed(2)+" "+Za[3].toFixed(2)+" "+Za[4].toFixed(0))}})
v.addReservedDefine("BEVEL")
function applyBevelValue(e){var t=(Er||e)&&yr
var r=t?ur:_r
if(r){cr.length=r.length
for(var a=0;a<r.length;++a)cr[a]=r[a]
if(t){Qt=Zt
rr=Jt
ar=er}else{Qt=Xt
rr=$t
ar=tr}}}c.register({bevel:{type:a.TYPE_INT,label:"Bevel",range:[0,1],help:"Enable corner rounding",default_value:Er,on_change:function on_change(e){l.bevel_value=Er=c.bevel
applyBevelValue()}},fade_chunks:{type:a.TYPE_INT,label:"Fade Chunks",range:[0,1],help:"Enable fading of chunks",default_value:1}})
function recalcAtlasParams(e,t,r,a){if("primary"===e){calcAtlasParams(Lr,Rr,_extends({},_a,{tile_res:t,tex_w:r,tex_h:a}))
V(Da,Lr)
V(Pa,Rr)}else if("util"===e)calcAtlasParams(da,fa,_extends({},ua,{tile_res:t,tex_w:r,tex_h:a}))}function disableBevelOnError(){l.bevel_available=yr=false}function startup(){v.addGlobal("light_torch_top",Ga)
v.addGlobal("light_torch_mid",Fa)
v.addGlobal("light_torch_bot",Wa)
v.addGlobal("light_flashlight",ja)
v.addGlobal("sway_offset",za)
Zt=v.create({filename:"shaders/voxel_pack.vp",defines:["BEVEL"],non_fatal:true})
Xt=v.create({filename:"shaders/voxel_pack.vp",defines:[]})
Jt=v.create({filename:"shaders/voxel_pack.fp",defines:["BEVEL"],non_fatal:true})
$t=v.create({filename:"shaders/voxel_pack.fp",defines:[]})
er=v.create({filename:"shaders/voxel_pack.fp",defines:["SOFTALPHA","BEVEL"],non_fatal:true})
tr=v.create({filename:"shaders/voxel_pack.fp",defines:["SOFTALPHA"]})
ir=v.create("shaders/voxel_pack_blend.fp")
or=v.create("shaders/voxel_pack_depth.fp")
l.bevel_available=yr=Zt.valid&&Jt.valid&&er.valid
if(I.webgl2){l.pack_tex_params=fr={target:gl.TEXTURE_2D_ARRAY,filter_mag:gl.LINEAR,filter_min:gl.LINEAR_MIPMAP_LINEAR}
var e=new Uint8Array(768)
for(var t=0;t<256;++t){e[3*t]=255
e[3*t+1]=0
e[3*t+2]=0}sr=p.load({name:"red_mask",width:1,height:256,target:gl.TEXTURE_2D_ARRAY,filter_mag:gl.LINEAR,filter_min:gl.LINEAR,format:p.format.RGB8,data:e})
var r=new Uint8Array(768)
for(var a=0;a<r.length;++a)r[a]=255
l.white_mask=lr=p.load({name:"white_mask",width:1,height:256,target:gl.TEXTURE_2D_ARRAY,filter_mag:gl.LINEAR,filter_min:gl.LINEAR,format:p.format.RGB8,data:r})}else{l.pack_tex_params=fr={target:gl.TEXTURE_2D,filter_mag:gl.NEAREST,filter_min:gl.NEAREST}
sr=p.load({name:"red_mask",width:2,height:2,filter_mag:gl.NEAREST,filter_min:gl.NEAREST,format:p.format.RGB8,data:new Uint8Array([255,0,0,255,0,0,255,0,0,255,0,0])})
l.white_mask=lr=p.textures.white}l.pack_texture=nr=p.load(d({url:I.webgl2?"img/voxels.array.png":"img/voxels.atlas.png"},fr))
var i=p.load(d({url:I.webgl2?"img/voxels_mask.array.png":"img/voxels_mask.atlas.png"},fr))
var o=p.load(d({url:I.webgl2?"img/voxels_normal.array.png":"img/voxels_normal.atlas.png"},fr));(ur=(_r=[nr,i]).slice(0)).push(o)
applyBevelValue()
calcAtlasParams(Lr,Rr,_a)
calcAtlasParams(da,fa,ua)
V(Da,Lr)
V(Pa,Rr)
dr=[[v.semantic.POSITION,gl.UNSIGNED_BYTE,4,false],[v.semantic.ATTR1,gl.UNSIGNED_BYTE,4,false],[v.semantic.ATTR2,gl.UNSIGNED_BYTE,4,true],[v.semantic.ATTR3,gl.UNSIGNED_BYTE,4,true]]
Pe()
v.addGlobal("bevel_param",Xa)
V(qa,I.webgl2?Ya:Va)
applyBumpParam()
v.addGlobal("bump_param",Ka)
initDefaultTint()
ge(assertPropPristineSend)
v.prelink(Xt,$t)
v.prelink(Xt,tr)
v.prelink(Xt,ir)
v.prelink(Xt,or)
if(yr){v.prelink(Zt,Jt,void 0,disableBevelOnError)
v.prelink(Zt,er,void 0,disableBevelOnError)
v.prelink(Zt,ir,void 0,disableBevelOnError)
v.prelink(Zt,or,void 0,disableBevelOnError)}Ot()}},{"../common/globals":197,"../common/ids":198,"../common/materials_common":201,"../common/voxel_data_common":209,"../common/world_trans":213,"../glov/client/browser":239,"../glov/client/cmds":244,"../glov/client/draw_list":246,"../glov/client/engine":250,"../glov/client/error_report":255,"../glov/client/geom":263,"../glov/client/hsv":269,"../glov/client/mat4ScaleRotateTranslate":277,"../glov/client/perf":281,"../glov/client/quat":287,"../glov/client/settings":291,"../glov/client/shaders":293,"../glov/client/textures":304,"../glov/common/util":330,"../glov/common/vmath":332,"./atlas_params.json":13,"./biome_types":20,"./client_entities":35,"./editvolume_clear":71,"./editvolume_client":72,"./item_anims":96,"./items":98,"./light_calc":100,"./line3d":102,"./liquid":103,"./localization/localization":108,"./lods":109,"./main":112,"./megachunk_client":116,"./mesh_calc":118,"./mesh_exporter":119,"./proc_gen_biomes":133,"./props":141,"./sky":151,"./status":156,"./tiles":162,"./user_data":170,"./voxel_chunk_manager":174,"./voxel_gen":177,"./voxel_mesh":178,"./world_claims":181,"./world_comm":182,"./world_metadata":186,assert:void 0,"gl-mat4/translate":void 0}],176:[function(e,t,r){"use strict"
r.loadXRAW=loadXRAW
r.reloadXRAW=reloadXRAW
r.loadAsyncModelBinary=loadAsyncModelBinary
r.voxelDataXRAWStartup=voxelDataXRAWStartup
var x=e("assert")
var n=e("../glov/client/fetch").fetch
var a=e("../glov/client/filewatch").filewatchOn
var s=e("../glov/client/net").netDisconnected
var i=e("../glov/client/textures").texturesUnloadDynamic
var l=e("../glov/client/urlhash").getURLBase
var o=e("../glov/client/webfs")
var c=o.webFSGetFile
var _=o.webFSGetFileNames
var u=e("../glov/common/util")
var d=u.merge
var f=u.nop
var v=e("../glov/common/vmath")
var O=v.unit_vec
var b=v.v3addScale
var N=v.v3copy
var C=v.v3iAdd
var M=v.v3iMax
var D=v.v3iMin
var P=v.v3set
var k=v.vec3
var B=v.zero_vec
var h=e("./baking").resetBakeRules
var U=e("./palette").paletteGet
var G=e("./voxel_data")
var p=e("./voxel_data")
var F=p.VoxelSimpleDrawable
var W=p.createUtilVD
var m=p.remeshAll
var j=Math.max
var g="models/"
var E="models_streamed/"
var y=4
var T;(function(e){e[e["NOT_LOADED"]=0]="NOT_LOADED"
e[e["LOADING"]=1]="LOADING"
e[e["LOADED"]=2]="LOADED"})(T=T||{})
function isVoxelModelShell(e){return!e.binary}var H={}
function loadXRAW(e,t){var r=t
var a=H[e]
if(!a||isVoxelModelShell(a))x(false,"Attempted to synchronously load nonexistant VoxelModel: "+e)
x(r)
x(r.palette)
var i=U(r.palette)
x(i)
x(i.tile_map)
var o=a.binary
var n=0
function eat(e){x.equal(o[n++],e)}var s=79===o[0]||67===o[0]||80===o[0]||84===o[0]
var l
var c
var _
var u=[0,0,0]
var d
var f=k()
if(r.origin_offset)N(f,r.origin_offset)
var v
if(r.for_baking){v=N(k(),r.bake_offset||B)
if(!r.origin_offset&&r.bake_offset){var h=r.size||O
P(f,h[0]/2-r.bake_offset[0]/7,h[1]/2-r.bake_offset[1]/7,-r.bake_offset[2]/7)}}if(s){n++
l=o[n++]
c=o[n++]
_=o[n++]
var p=r.noscale||r.for_baking?1/7:1
if(80===o[d=0]){f[0]=o[n++]*p
f[1]=o[n++]*p
f[2]=o[n++]*p}if(84===o[0]){f[0]=o[n++]
f[1]=o[n++]
f[2]=o[n++]
r.tool_pos=k()
r.tool_pos[0]=o[n++]-f[0]
r.tool_pos[1]=o[n++]-f[1]
r.tool_pos[2]=o[n++]-f[2]
f[0]*=p
f[1]*=p
f[2]*=p}u[0]=o[n++]
u[1]=o[n++]
u[2]=o[n++]
if(v)C(v,u)
b(f,f,u,-p)}else{eat(88)
eat(82)
eat(65)
eat(87)
x.equal(o[n++],0)
var m=o[n++]
x(4===m)
x.equal(o[n++],8)
x.equal(o[n++],8)
l=o[n++]
eat(0)
eat(0)
eat(0)
c=o[n++]
eat(0)
eat(0)
eat(0)
_=o[n++]
eat(0)
eat(0)
eat(0)
d=o[n++]+(o[n++]<<8)
x(d<=256)
eat(0)
eat(0)}x(j(j(l,c),_)<128)
var g=new Uint8Array([l,c,_])
var E=W(g)
var y=E.minpos=new Uint8Array([l-1,c-1,_-1])
var T=E.maxpos=new Uint8Array([0,0,0])
var I=new Int8Array(3)
for(var S=0;S<_;++S){I[2]=S
for(var A=0;A<c;++A){I[1]=A
for(var w=0;w<l;++w){var L=o[n++]
if(L){I[0]=w
M(T,I)
D(y,I)
E.setUnchecked(I,L)}}}}if(n!==o.length)n+=4*d
E.tile_map=i.tile_map
r.tint_colors=i
E.updateGeometrySimple(r)
var R=new F(E,f,G.pack_texture,true)
if((R.opts=r).for_baking)R.baked={bake_offset:v,size:r.size||O,data:E.baked_mesh_data}
if(!a.vmds)a.vmds=[]
a.vmds.push({opts:r,vsd:R})
return R}function reloadModelVSDs(e,t){for(var r=0;r<t.length;++r){var a=t[r]
var i=loadXRAW(e,a.opts)
var o=t.pop()
x.equal(i,o.vsd)
var n=a.vsd
var s=n.baked
n.dispose()
d(n,i)
if(s){n.baked=s
d(n.baked,i.baked)}}}function reloadXRAW(e,t){var r=0
t=t||false
function reloadAndCountModelVSDs(e){var t=H[e]
if(t&&t.status===T.LOADED&&t.vmds){reloadModelVSDs(e,t.vmds)
r+=t.vmds.length}}if(!e)Object.keys(H).forEach(function(e){if(H[e].streamed===t)reloadAndCountModelVSDs(e)})
else reloadAndCountModelVSDs(e)
console.log("Reloaded "+r+" models")
if(r){h()
m()
i()}}function loadModelBinary(e){var t=c(e)
var r=e.slice(g.length)
var a=H[r]
if(!a)H[r]={streamed:false,status:T.LOADED,attempts:0,last_attempt:0,binary:t}
else{x(!a.streamed)
a.binary=t}}function loadAsyncModelBinary(a,e,t){var i=H[a]
var r=Date.now()
var o=e||f
if(!i)i=H[a]={streamed:true,status:T.NOT_LOADED,attempts:0,last_attempt:0}
if(!t)if(i.status===T.LOADED){o()
return true}else if(i.status===T.LOADING){o("ERR_LOADING_IN_FLIGHT")
return false}else if(r-i.last_attempt<i.attempts*i.attempts*100){o("ERR_TOO_MANY_ATTEMPTS")
return false}if(s()){i.attempts=0
o("ERR_DISCONNECTED")
return false}i.status=T.LOADING
n({url:""+l()+E+a,response_type:"arraybuffer"},function(e,t){x(i)
if(e){i.status=T.NOT_LOADED;++i.attempts
i.last_attempt=Date.now()
console.error("Failed to load model: "+a+": "+e)
if(i.attempts===y)x(false,"Exhausted attempts to load model: "+a+" ("+e+")")
o(e)
return}i.status=T.LOADED
var r=new Uint8Array(t)
i.binary=r
o()})
return false}function reloadModel(e){loadModelBinary(e)
reloadXRAW(e.slice(g.length))}function reloadAsyncModel(e){var t=e.slice(E.length)
var r=H[t]
if(r)r.attempts=0
loadAsyncModelBinary(t,function(e){if(e){console.error("Failed to reload model: "+t)
return}reloadXRAW(t,true)},true)}function voxelDataXRAWStartup(){var e=_("models")
for(var t=0;t<e.length;++t)loadModelBinary(e[t])
a(g,reloadModel)
a(E,reloadAsyncModel)}},{"../glov/client/fetch":258,"../glov/client/filewatch":259,"../glov/client/net":279,"../glov/client/textures":304,"../glov/client/urlhash":307,"../glov/client/webfs":309,"../glov/common/util":330,"../glov/common/vmath":332,"./baking":17,"./palette":123,"./voxel_data":175,assert:void 0}],177:[function(e,t,r){"use strict"
r.voxelGenQueueContinentData=voxelGenQueueContinentData
r.seedWorld=seedWorld
r.voxelGensInProgress=voxelGensInProgress
r.voxelGenReset=voxelGenReset
r.voxelGenAttachHexomeChoices=voxelGenAttachHexomeChoices
r.voxelGenQueueHexomeChoices=voxelGenQueueHexomeChoices
r.voxelGenQueueDetailData=voxelGenQueueDetailData
r.voxelGenUnsubMegachunk2Ds=voxelGenUnsubMegachunk2Ds
r.voxelGenGetDetailDebugData=voxelGenGetDetailDebugData
r.voxelGen=voxelGen
r.hexome_choice_cache=void 0
var o=e("assert")
var a=e("./continent.js").continentHandleData
var i=e("./continent_loader.js"),n=i.continentLoaderReadyChunkPos,s=i.continentLoaderSeedWorld,l=i.continentLoaderWhenReadyChunkPos
var c=e("../glov/client/engine.js")
var _=e("./lods.js"),u=_.lodQueueContinentData,d=_.lodQueueHexomeChoices
var f=e("./megachunk_client.js"),v=f.hexomeChoiceGet,h=f.hexomeChoiceReady,p=f.hexomeChoiceSet,m=f.megachunk2DReady,g=f.megachunk2DHasZMap,E=f.isSpoiled
var y=e("./proc_gen.js")
var T=e("./proc_gen_biomes.js")
var I=T.choiceDataSet
var S=e("./proc_gen_constants.js").HEX_HEIGHT
var A=e("./proc_gen_details.js").detailGenSetData
var w=e("./sky.js").skyReinit
var L=e("./task_sched.js"),R=L.WORKER_GEN,x=L.taskCreate,O=L.workerFlush,b=L.workerFlushAll
var N=e("./voxel_data.js")
var C=e("./voxel_mesh.js"),M=C.voxelMeshQueueContinentData,D=C.voxelMeshQueueZMaps,P=C.voxelMeshQueueHexomeChoices
var k=e("./world_comm.js")
var B=e("../glov/client/worker_comm.js")
var U=e("./world_metadata.js").worldMetadata
var G
var F
var W
var j
var H
var z
var V=5*S
function voxelGenQueueContinentData(e){W.push(e)
M(e)
u(e)
a([e])}function seedWorld(){var e=U()
o(e)
o(e.seed)
o(e.world_type)
console.log("Using world seed "+e.seed+" for "+e.world_type+" world "+e.name)
y.seedWorld(e)
s(e)
b()
B.sendmsg(B.ALL,"seed",e)
if(!G)G=T.getHexomeIDsFromChunkPos
w()}var Y=0
function voxelGensInProgress(){return Y}var q
r.hexome_choice_cache=q
var K
var Z=0
function voxelGenReset(){K={}
r.hexome_choice_cache=q={}
F=[]
W=[]
j=[]
H=null
z={};++Z}function voxelGenAttachHexomeChoices(e,t){var r=G(t.pos)
for(var a=0;a<r.length;++a){var i=r[a]
if(!v(i))if(!q[i]);else{p(i,q[i])
e.tset.sendHexomeChoice(i,q[i])}}}function voxelGenQueueHexomeChoices(e){F.push(e)
P(e)
d(e)
for(var t in e)I(t,e[t])}function voxelGenQueueDetailData(e,t){A(e,t)
j.push(e,t)}function voxelGenUnsubMegachunk2Ds(e){if(H)H=H.concat(e)
else H=e}function voxelGenGetDetailDebugData(t){if(!z[t]){z[t]=[]
var r=Z
x({worker:R,time:0,type:"detail_debug",data:t},function(e){if(r!==Z)return
z[t]=e})
O(R)}return z[t]}var X=.375
var Q=4
function voxelGenWorkerAssign(e){var t=e.vsid
if(K[t])return X
K[t]=1
return Q}function requestGen(e){var t=e.vd,r=e.handleRequestGen
e.reset_generation=Z
o(n(t.pos,V))
var a={chunk_id:t.chunk_id,pos:t.pos,has_zmap:g(t.pos)}
if(c.defines.NOWORKERS)r(y.gen(a))
else{if(F.length){a.hexome_choices=F
F=[]}if(W.length){a.continents=W
W=[]}if(j.length){a.details=j
j=[]}if(H){a.mc2d_unsubs=H
H=null}var i=voxelGenWorkerAssign(t)
x({worker:R,time:i,type:"gen",data:a},r)}}var J=[]
var $=function(){function VoxelGenRequestor(){this.data=null
this.cbWrap=this.cbWrapInternal.bind(this)
this.handleRequestFromServer=this.handleRequestFromServerInternal.bind(this)
this.whenReadyHandleIsSpoiled=this.whenReadyHandleIsSpoiledInternal.bind(this)
this.whenReadyHandleMegachunk2D=this.whenReadyHandleMegachunk2DInternal.bind(this)
this.whenReadyHandleContinentLoader=this.whenReadyHandleContinentLoaderInternal.bind(this)
this.handleWhenReady=this.handleWhenReadyInternal.bind(this)
this.handleRequestGen=this.handleRequestGenInternal.bind(this)
this.handleIsSpoiledAfterData=this.handleIsSpoiledAfterDataInternal.bind(this)}var e=VoxelGenRequestor.prototype
e.init=function init(e,t){this.vd=e
this.cb=t
this.reused=e.reused}
e.cbWrapInternal=function cbWrapInternal(e){var t=this.vd,r=this.reused,a=this.cb;--Y
if(t.reused===r){t.assertInChunkMap()
t.gen_in_progress=false
a(e)}J.push(this)}
e.whenReadyStart=function whenReadyStart(){var e=this.vd
E(e.pos,this.whenReadyHandleIsSpoiled)}
e.whenReadyHandleIsSpoiledInternal=function whenReadyHandleIsSpoiledInternal(e){var t=this.vd,r=this.reused
if(t.reused!==r)return this.cbWrap()
this.spoiled_result=e
m(t.pos,this.whenReadyHandleMegachunk2D)}
e.whenReadyHandleMegachunk2DInternal=function whenReadyHandleMegachunk2DInternal(){var e=this.vd,t=this.reused
if(e.reused!==t)return this.cbWrap()
l(e.pos,V,this.whenReadyHandleContinentLoader)}
e.whenReadyHandleContinentLoaderInternal=function whenReadyHandleContinentLoaderInternal(){var e=this.vd,t=this.reused
if(e.reused!==t)return this.cbWrap()
h(this.handleWhenReady)}
e.handleWhenReadyInternal=function handleWhenReadyInternal(){var e=this.vd,t=this.reused
if(e.reused!==t)return this.cbWrap()
e.assertInChunkMap()
if(this.spoiled_result)return this.requestFromServer()
requestGen(this)}
e.requestFromServer=function requestFromServer(){k.getChunk(this.vd.chunk_id,this.handleRequestFromServer)}
e.handleRequestFromServerInternal=function handleRequestFromServerInternal(e,t){var r=this.vd,a=this.reused,i=this.cbWrap
if(r.reused!==a)return i(e)
r.assertInChunkMap()
if(e)return i(e)
r.did_gen=true
r.sent_pristine=true
if(r.deserialize(t))return i()
console.log(t)
return i("Bad serialization data received")}
e.handleRequestGenInternal=function handleRequestGenInternal(e){var t=this.vd,r=this.reused
if(this.reset_generation===Z){if(e.zmaps)D(e.zmaps)
if(e.hexome_choices)for(var a=0;a<e.hexome_choices.length;++a){var i=e.hexome_choices[a]
q[i.hid]=i.data}}if(t.reused!==r){N.timing.gen+=e.gen_time
this.cbWrap()
return}t.assertInChunkMap()
this.data=e
E(t.pos,this.handleIsSpoiledAfterData)}
e.handleIsSpoiledAfterDataInternal=function handleIsSpoiledAfterDataInternal(e){var t=this.vd,r=this.reused,a=this.data
this.data=null
if(t.reused!==r){N.timing.gen+=a.gen_time
return this.cbWrap()}t.assertInChunkMap()
if(e){N.timing.gen+=a.gen_time
this.requestFromServer()
return}t.did_gen=true
t.setDataMembers(a)
this.cbWrap()}
return VoxelGenRequestor}()
function allocVoxelGenRequestor(e,t){var r
if(J.length)r=J.pop()
else r=new $(e,t)
r.init(e,t)
return r}function voxelGen(e,t){o(!e.gen_in_progress)
o(!e.did_gen)
e.assertInChunkMap()
e.gen_in_progress=true;++Y
allocVoxelGenRequestor(e,t).whenReadyStart()}},{"../glov/client/engine.js":250,"../glov/client/worker_comm.js":311,"./continent.js":37,"./continent_loader.js":38,"./lods.js":109,"./megachunk_client.js":116,"./proc_gen.js":132,"./proc_gen_biomes.js":133,"./proc_gen_constants.js":134,"./proc_gen_details.js":136,"./sky.js":151,"./task_sched.js":161,"./voxel_data.js":175,"./voxel_mesh.js":178,"./world_comm.js":182,"./world_metadata.js":186,assert:void 0}],178:[function(e,t,r){"use strict"
r.voxelMeshQueueZMaps=voxelMeshQueueZMaps
r.voxelMeshRequestZMap=voxelMeshRequestZMap
r.voxelMeshUnsubMegachunk2Ds=voxelMeshUnsubMegachunk2Ds
r.voxelMeshesInProgress=voxelMeshesInProgress
r.voxelMeshDataSends=voxelMeshDataSends
r.voxelMeshBusy=voxelMeshBusy
r.voxelMeshReset=voxelMeshReset
r.voxelMeshStartup=voxelMeshStartup
r.voxelMeshQueueHexomeChoices=voxelMeshQueueHexomeChoices
r.voxelMeshQueueContinentData=voxelMeshQueueContinentData
r.voxelMeshUnload=voxelMeshUnload
r.voxelMeshNotifyLoaded=voxelMeshNotifyLoaded
r.voxelMesh=voxelMesh
r.voxelMeshFlush=voxelMeshFlush
r.voxelMeshGetZMapDebugData=voxelMeshGetZMapDebugData
var I=e("assert")
var a=e("../glov/client/cmds.js").cmd_parse
var s=e("../glov/client/engine.js")
var i=e("../common/globals.js"),l=i.CHUNK_SIZE,S=i.ID_FACTOR,c=i.ID2
var o=e("./lods.js").lodOnZMap
var _=Math.floor,u=Math.max,d=Math.min
var n=e("./megachunk_client.js").handleZMapData
var f=e("./mesh_calc.js").meshCalcMaxPropsPerChunk
var v=e("../glov/client/settings.js")
var h=e("./task_sched.js"),A=h.WORKER_MESH,w=h.taskBatchId,L=h.taskCreate,p=h.workerBatchQueued,m=h.workerFlush,g=h.workerReady
var R=e("../glov/common/verify.js")
var E=e("./voxel_chunk_manager.js").getKnownBounds
var x=e("./voxel_data.js")
var y=x.remeshAll
var T=e("../glov/common/util.js").nop
var O=e("../common/voxel_data_common.js"),b=O.UNCHUNKED_ID,N=O.ZMAP_UNDERGROUND
var C=1
var M=.125
var D=25
var P=0
var k=0
var B
var U=1+S+c
var G=0
var F=1
var W=2
var j
var H
var z
var V
var Y
var q
var K
var Z
var X
var Q
var J
function voxelMeshQueueZMaps(e){for(var t=0;t<e.length;++t){var r=e[t]
if(r.data!==N)o({vsid:r.vsid,data:r.data,from:"procgen"})}if(K)K=K.concat(e)
else K=e}function voxelMeshRequestZMap(e){Z.push(e)}function voxelMeshUnsubMegachunk2Ds(e){if(X)X=X.concat(e)
else X=e}function voxelMeshesInProgress(){return P}function voxelMeshDataSends(){return k}function voxelMeshBusy(){return!g(A)}var $=0
function voxelMeshReset(){B=x.chunk_map
z=(H=[{},{},{}])[G]
V=H[F]
Y=H[W]
j=[]
q=[]
Z=[]
X=K=null
Q=[]
J=[];++$
if(!s.defines.NOWORKERS)L({worker:A,time:0,type:"mesh_reset"},T)}function voxelMeshStartup(){f(v.max_props_per_chunk)
if(!s.defines.NOWORKERS)L({worker:A,time:0,type:"max_props_per_chunk",data:v.max_props_per_chunk},T)}v.register({max_props_per_chunk:{label:"Maximum Props per Chunk",default_value:400,type:a.TYPE_INT,range:[0,4096],access_show:["sysadmin"],store:false,on_change:function on_change(e){f(v.max_props_per_chunk)
if($){if(!s.defines.NOWORKERS)L({worker:A,time:0,type:"max_props_per_chunk",data:v.max_props_per_chunk},T)
y()}}}})
function voxelMeshQueueHexomeChoices(e){Q.push(e)}function voxelMeshQueueContinentData(e){J.push(e)}function voxelMeshUnload(e){var t=e.chunk_id
I(t!==b)
var r=false
for(var a=0;a<H.length;++a)if(void 0!==H[a][t]){r=true
delete H[a][t]}if(r)j.push(t)}function voxelMeshNotifyLoaded(e){if(!e.full)q.push(e.chunk_id)}function handleLightingDirty(e,t){var r=E()[2]
for(var a in t){var i=t[a]
a=Number(a)
var o=u(r[0],i[0])
var n=d(r[1],i[1])
for(var s=o;s<=n;++s){var l=B[a+s*c]
if(l&&!l.mesh_dirty&&l.lighting_batch_id<e&&(l.data||l.liquid))l.dirty()}}}function handleResultShared(e,t){--P
if(e===$){if(t.lighting_dirty)if(x.lighting_value)handleLightingDirty(t.lighting_batch_id,t.lighting_dirty)
if(t.zmap_data)n(t.zmap_data)
if(t.extra_lighting)for(var r in t.extra_lighting){var a=B[r]
if(!a)continue
var i=t.extra_lighting[r]
I(!i.light_torch||i.light_torch instanceof Uint8Array)
I(!i.light_sun||i.light_sun instanceof Uint8Array)
a.light_torch=i.light_torch
a.light_sun=i.light_sun}}}function addQueuedEvents(e){var t
if(K){if(x.lighting_value){e.zmap_updates=K
for(var r=0;r<K.length;++r){var a=K[r]
if(a.data.buffer){if(!t)t=[]
t.push(a.data.buffer)}}}K=null}if(Z.length){e.zmap_requests=Z
Z=[]}if(X){e.mc2d_unsubs=X
X=null}if(Q.length){e.hexome_choices=Q
Q=[]}if(J.length){e.continents=J
J=[]}return t}function voxelMesh(t,r,e,a){I(t.did_prop_check);++P
var i=t.reused
var o=$
function handleResult(e){handleResultShared(o,e)
if(t.reused===i){if(e.data&&!R(e.data instanceof Uint8Array))e.data=new Uint8Array(e.data)
if(e.alpha&&!R(e.alpha instanceof Uint8Array))e.alpha=new Uint8Array(e.alpha)
if(e.liquid&&!R(e.liquid instanceof Uint8Array))e.liquid=new Uint8Array(e.liquid)
if(e.light_torch&&!R(e.light_torch instanceof Uint8Array))e.light_torch=new Uint8Array(e.light_torch)
if(e.light_sun&&!R(e.light_sun instanceof Uint8Array))e.light_sun=new Uint8Array(e.light_sun)
t.setMeshData(r,e)
a()}}var n=[]
function sendData(e,t){if(t.data){if(z[e]!==t.ver_data)n.push({type:G,chunk_id:e,ver_data:t.ver_data,data:t.data,light_dirty:t.light_dirty})}else if(0!==z[e])n.push({type:G,chunk_id:e,ver_data:0,light_dirty:t.light_dirty})
if(t.liquid){if(V[e]!==t.ver_data)n.push({type:F,chunk_id:e,ver_data:t.ver_data,data:t.liquid})}else if(0!==V[e])n.push({type:F,chunk_id:e,ver_data:0})
if(t.baked_props){if(Y[e]!==t.ver_props)n.push({type:W,chunk_id:e,ver_data:t.ver_props,data:t.baked_props})}else if(0!==Y[e])n.push({type:W,chunk_id:e,ver_data:0})}if(e)handleResult(t.meshCalcWorld(r))
else{var s=t.chunk_id
I(s!==b)
t.lighting_batch_id=w(A)
var l=t.full
for(var c=0;c<=2;++c)for(var _=0;_<=2;++_)for(var u=0;u<=2;++u){var d=s+(c*S+_)*S+u-U
var f=B[d]
I(f)
I(f.did_gen)
l=l&&f.full
sendData(d,f)}if(l)return handleResult({ver_meshing:t.ver_meshing})
var v={chunk_id:s,ver_meshing:t.ver_meshing,opts:r}
var h=addQueuedEvents(v)
if(x.lighting_value){for(var p=0;p<q.length;++p){var m=q[p]
var g=B[m]
if(g)sendData(m,g)}q.length=0}var E=C
if(n.length){v.chunks=[]
for(var y=0;y<n.length;++y){var T=n[y]
v.chunks.push(T)
if(T.data){k++
E+=M}if(T.type===G&&T.light_dirty)B[T.chunk_id].light_dirty=0
H[T.type][T.chunk_id]=T.ver_data}}if(j.length){v.unloads=j
j=[]}L({worker:A,time:E,type:"mesh",data:v,transfer:h},handleResult)}}function voxelMeshFlush(){I(!s.defines.NOWORKERS)
if((K||X||Z.length||j.length)&&(g(A)||p(A))){++P
var e={chunk_id:b,opts:null}
var t=addQueuedEvents(e)
L({worker:A,time:D,type:"mesh",data:e,transfer:t},handleResultShared.bind(null,$))}m(A)}var ee={}
function voxelMeshGetZMapDebugData(e){I(!s.defines.NOWORKERS)
var t=_(e[0]/l)
var r=_(e[1]/l)
var a=t+r*S
var i=e[0]-t*l+(e[1]-r*l)*l
var o=a+"_"+i
var n=ee[o]
if(!n)n=ee[o]={ts:0,v:"."}
if(n.ts<s.frame_timestamp-1e3){n.ts=s.frame_timestamp
L({worker:A,time:0,type:"zmap_debug",data:{vsid:a,idx:i}},function(e){n.v=e})
m(A)}return n.v}},{"../common/globals.js":197,"../common/voxel_data_common.js":209,"../glov/client/cmds.js":244,"../glov/client/engine.js":250,"../glov/client/settings.js":291,"../glov/common/util.js":330,"../glov/common/verify.js":331,"./lods.js":109,"./megachunk_client.js":116,"./mesh_calc.js":118,"./task_sched.js":161,"./voxel_chunk_manager.js":174,"./voxel_data.js":175,assert:void 0}],179:[function(e,t,r){"use strict"
r.waygateUIStartup=waygateUIStartup
r.waygateUIInit=waygateUIInit
r.waygateUIIsSettlement=waygateUIIsSettlement
r.waygateUIIsAccessControl=waygateUIIsAccessControl
r.waygateTexture=waygateTexture
r.calcWGLinkWidth=calcWGLinkWidth
r.waygateLinkUI=waygateLinkUI
r.drawHLine=drawHLine
r.waygateEditTitle=waygateEditTitle
r.doEnergyWell=doEnergyWell
r.waygateEditRemote=waygateEditRemote
r.doWaygateEdit=doWaygateEdit
r.doWaygateTargets=doWaygateTargets
r.waygateSuppressAutoActivate=waygateSuppressAutoActivate
r.waygateUITick=waygateUITick
r.SUBLABEL_H=r.SUBLINE_W=r.LINE_W=r.SUBTITLE_H=r.TITLE_H=r.PAD=r.FONT_HEIGHT=void 0
var a=36
r.FONT_HEIGHT=a
var i=8
r.PAD=i
var u=1.5*a
r.TITLE_H=u
var S=1.25*a
r.SUBTITLE_H=S
var d=382
var A=.5*(r.LINE_W=d)
r.SUBLINE_W=A
var f=24
r.SUBLABEL_H=f
var F="exit"
var ee=e("assert")
var v=e("../glov/client/camera2d")
var te=e("../glov/client/engine")
var w=e("../glov/client/input")
var re=e("../glov/client/link").link
var o=e("../glov/client/net")
var L=o.netClient
var W=o.netSubs
var R=e("../glov/client/scroll_area").scrollAreaCreate
var j=e("../glov/client/selection_box").dropDownCreate
var h=e("../glov/client/settings")
var ae=e("../glov/client/sprites")
var n=e("../glov/client/sprites").spriteCreate
var s=e("../glov/client/textures")
var p=e("../glov/client/transition")
var ie=e("../glov/client/ui")
var oe=e("../glov/client/urlhash")
var l=e("../glov/common/util")
var c=l.defaults
var ne=l.easeInOut
var se=l.easeOut
var m=l.fract
var H=l.isInteger
var le=l.nop
var _=e("../glov/common/verify")
var g=e("../glov/common/vmath")
var ce=g.unit_vec
var E=g.v3distSq
var _e=g.v4lerp
var y=g.vec4
var T=e("../common/ids").ITEM_WAYGATE
var I=e("../common/waygate_common")
var x=I.MAX_WAYGATE_TARGETS
var O=I.WAYGATE_ID_LEN
var b=I.WAYGATE_NAME_LEN
var N=I.waygateImagePath
var C=I.waygate_invalid_ids
var M=I.waygate_invalid_regex
var D=I.waygate_valid_regex
var P=e("../common/world_constants")
var z=P.VOLUME_SETTLEMENT_PREFIX
var V=P.WAYGATE_FLAG_LISTED
var k=P.WAYGATE_FLAG_SETTLEMENT
var B=P.WAYGATE_SETTLEMENT_AUTO
var U=e("./access_control")
var G=U.accessControlRun
var Y=U.accessControlStartup
var q=e("./analytics").logEvent
var K=e("./build_mode")
var X=K.doStamina
var Q=K.unlimitedMode
var J=e("./editvolume_client")
var $=J.manageVolumeAllowedForPos
var ue=J.settlementEstablishAllowed
var de=e("./energy_well")
var fe=de.energyWellCharged
var ve=de.energyWellChargedTime
var he=de.energyWellDrink
var pe=de.energyWellInit
var me=de.energyWellRun
var ge=de.energyWellShouldAutoDrink
var Ee=de.energyWellStartup
var ye=e("./fbinstant_worlds")
var Te=ye.fbShareWorld
var Ie=ye.fbShareWorldLink
var Se=e("./file_management").uploadInProgress
var Ae=e("./fx_util")
var we=Ae.fxUtilGlow
var Le=Ae.fxUtilGradient
var Re=e("./layout").layoutCameraCurX1
var xe=e("./localization/localization").L
var Oe=e("./main")
var be=e("./main")
var Ne=be.blockImageUpload
var Ce=be.menuExit
var Me=be.returnToMainMenu
var De=e("./main_menu").getWorldInfo
var Pe=e("./menu")
var ke=e("./menu")
var Be=ke.menuInteractGetPos
var Ue=ke.menuInteractGetProp
var Ge=ke.menuY1
var Fe=e("./photo_mode")
var We=Fe.errorModalDialog
var je=Fe.photoCapture
var He=Fe.setImageUploadFalse
var ze=Fe.validatePhotoCapture
var Ve=e("./platform_share_urls").getPlatformWorldShareLink
var Ye=e("./prop_edit")
var qe=Ye.BUTTON_H
var Ke=Ye.BUTTON_W
var Ze=Ye.saveProp
var Xe=Ye.savingMessage
var Qe=e("./props.js").PIEB_CHECK_CUR_SIZE
var Je=e("./rand_seed")
var $e=e("./settlement").settlementLastBound
var et=e("./settlement_edit")
var tt=et.settlementEditInit
var rt=et.settlementEditRun
var at=et.settlementEditStartup
var it=e("./status")
var ot=e("./styles")
var nt=ot.color_black
var st=ot.color_trophies
var lt=ot.hint_style
var ct=ot.label_style
var _t=ot.menu_header_style
var ut=ot.overlay_title_style
var dt=ot.overlay_title_style_full
var ft=ot.style_gems
var vt=ot.sublabel_style
var ht=e("./ui_util")
var pt=e("./ui_util").STAMINA_SYMBOL
var mt=e("./user_data")
var gt=mt.userDataPredict
var Et=mt.userHomeSettlementID
var yt=mt.waygateEditAllowed
var Tt=e("./world_comm")
var It=Tt.getWorldChannel
var St=Tt.getWorldID
var At=Tt.myUserCmdParse
var wt=Tt.worldSend
var Lt=Tt.worldTargetGo
var Rt=e("./world_info_view")
var xt=Rt.cmpWaygateID
var Ot=Rt.cmpWaygateInit
var bt=e("./world_metadata")
var Nt=bt.adventureMode
var Ct=bt.worldMetadata
var Mt=bt.worldMetadataWaygate
var Dt=bt.worldMetadataWaygates
var Pt=Math.ceil,kt=Math.floor,Bt=Math.max,Ut=Math.min
var Gt
var Ft
var Wt={}
var jt
var Ht
function waygateUIStartup(){ie.loadUISprite("rect",[10,44,10],[10,44,10])
ie.loadUISprite("rect_shadow",[10,44,10],[10,44,10])
Ht=n({name:"sheen",wrap_s:gl.CLAMP_TO_EDGE,wrap_t:gl.CLAMP_TO_EDGE})
Gt=ie.font
Ft=ie.title_font
jt={filter_mag:gl.LINEAR,filter_min:gl.LINEAR_MIPMAP_LINEAR,wrap_s:gl.CLAMP_TO_EDGE,wrap_t:gl.CLAMP_TO_EDGE};["procgen","new"].forEach(function(e){Wt[e]={preview:s.load(c({url:"img/placeholder/"+e+"_preview.jpg"},jt)),thumb:s.load(c({url:"img/placeholder/"+e+"_thumb.png"},jt))}})
jt.soft_error=true
jt.auto_unload=true
at()
Ee()
Y()}function waygateGetMetadataFromProp(e){var t=Dt()
for(var r in t){var a=t[r]
if(e.chunk_id===a.pos[0]&&e.pos_idx===a.pos[1]){var i=Boolean(a.flags&k)
return{wgid:r,wg:a,is_settlement:i,is_unbound:Nt()&&i&&r!==Et()}}}return null}var zt
function waygateGetMetadataRemote(){var e=zt
var t=Mt(e)
if(!t)return null
var r=Boolean(t.flags&k)
return{wgid:e,wg:t,is_settlement:r,is_unbound:Nt()&&r&&e!==Et()}}var Vt=1
var Yt=2
var qt=3
var Kt=4
var Zt=Vt
function waygateUIInit(e){Zt=Vt
var t
var r
if(e)t=waygateGetMetadataRemote()
else{zt=null
if((r=Ue())&&r.item_id===T)t=waygateGetMetadataFromProp(r)}if(t&&t.is_settlement)if(X()&&r&&ge(r))Zt=qt
else Zt=Yt
tt()
pe()}function waygateUIIsSettlement(){return Pe.page===Pe.WAYGATE_EDIT&&Zt===Yt}function waygateUIIsAccessControl(){return Pe.page===Pe.WAYGATE_EDIT&&Zt===Kt||Pe.page===Pe.ACCESS_CONTROL}function showError(e,t){if(!t){Xe(xe.MSG_SAVED)
return}ie.modalDialog({title:e,text:t,buttons:{OK:null}})}function stillHere(){var e=Ue()
if(!e){ie.modalDialog({title:xe.LBL_ERROR,text:xe.ERR_WAYGATE_DISAPPEARED,buttons:{OK:null}})
return null}return e}function bestImageID(){var e=Dt()
var t=Ct()
var r=t&&t.image&&t.image.sets||{}
var a={}
for(var i in e){var o=e[i]
if(o.imgid)a[o.imgid]=true}var n=0
var s=Infinity
for(var l in r){var c=Number(l)
if(!a[l])n=Bt(n,c)
s=Ut(s,c)}if(n)return n
return 0}function confirmAssign(e,r,a){var t=stillHere()
if(t){var i
if(!Mt(e)&&e!==B)i=bestImageID()
var o={wgid:e,chunk_id:t.chunk_id,pos_idx:t.pos_idx,rot:t.rot}
if(i)o.imgid=i
wt("waygate_set",o,function(e,t){if(e){ie.modalDialog({title:r||xe.LBL_ERROR,text:e,buttons:{OK:null}})
return void Oe.chat_ui.addChatError(e)}if(t.home)gt("home",t.home,true)
if(t.wg)gt("wg",t.wg,true)
if(a)Zt=a})}}function waygateAssignID(e){if(!stillHere())return
if(!e.match(D)||e.match(M)||C[e]){ie.modalDialog({title:xe.LBL_ERROR,text:xe.ERR_INVALID_WGID,buttons:{OK:null}})
return}if(Dt()[e])ie.modalDialog({title:xe.DLG_ASSIGN_WGID_TITLE,text:"default"===e?xe.DLG_ASSIGN_WGID_DEF_MSG_CONFIRM+"\n\n"+xe.DLG_ASSIGN_WGID_DEF_MSG_SCREENSHOT:xe.$(xe.DLG_ASSIGN_WGID_ALREADY_MSG_CONFIRM,e)+"\n\n"+xe.DLG_ASSIGN_WGID_ALREADY_MSG_LINKS,buttons:{Yes:function Yes(){confirmAssign(e)},No:null}})
else confirmAssign(e)}function waygateAssignIDPrompt(){var e=1
var t=Dt()
while(t[e])e++
ie.modalTextEntry({edit_text:String(e),max_len:O,title:xe.DLG_LINKABLE_WGID_TITLE,text:xe.DLG_LINKABLE_WGID_MSG,buttons:{OK:function OK(e){waygateAssignID(e.toLowerCase().trim())},Cancel:null}})}function waygateEstablishSettlement(){ie.modalDialog({title:xe.DLG_ESTABLISH_SETTLEMENT_TITLE,text:xe.DLG_ESTABLISH_SETTLEMENT_MSG_HOME+"\n\n"+xe.DLG_ESTABLISH_SETTLEMENT_MSG_CONFIRM,buttons:{yes:function yes(){confirmAssign(B,xe.DLG_ERROR_ESTABLISHING_SETTLEMENT,Yt)},cancel:null}})}function waygateMoveSettlement(){ee($e().settlement_id)
ie.modalDialog({title:xe.DLG_MOVE_SETTLEMENT_TITLE,text:xe.DLG_MOVE_SETTLEMENT_MSG_WARNING+"\n\n"+xe.DLG_MOVE_SETTLEMENT_MSG_CONFIRM,buttons:{yes:function yes(){if($e())confirmAssign($e().settlement_id,xe.DLG_ERROR_MOVING_SETTLEMENT,Yt)},cancel:null}})}function waygateRename(e,t){if(!It())return void showError(xe.DLG_ERROR_RENAMING_WG_TITLE,xe.ERR_WORLD_DISCONNECTED)
wt("waygate_mod",{wgid:e,key:"name",value:t},showError.bind(null,xe.DLG_ERROR_RENAMING_WG_TITLE))}function waygateTexture(e,t,r){var a=N(e,t,r)
return s.load(c({url:a},jt))}var Xt=.2
var Qt=2*Xt
var Jt=.02
var $t=.175
var er=2*$t
var tr=y(0,0,0,1)
var rr=y(1,1,1,1)
var ar=y(0,0,0,.25)
var ir=y(0,0,0,.5)
var or=y(0,1,0,1)
var nr=y(1,1,1,.2)
var sr=y(1,1,1,.1)
var lr=y(0,.2,1,1.2)
var cr=y(0,.5,1,1.5)
var _r=.005
var ur=.05
var dr=y(1,1,1,1)
var fr={}
function getState(e,t,r){var a=te.frame_index
var i=["wglui",e,t,r].join("_")
var o=fr[i]
if(!o)o=fr[i]={key:i,color:y(),uvs:y()}
_(o.frame!==a)
if(o.frame!==a-1){o.active=0
o.reset=true}else o.reset=false
o.frame=a
return o}function calcWGLinkWidth(e){return 4*e/3}var vr={}
var hr={}
function waygateLinkUI(e){profilerStart("waygateLinkUI")
var t=e.x,r=e.y,a=e.z,i=e.w,o=e.h,n=e.target,s=e.style,l=e.max_grow,c=e.ctx,_=e.url,u=e.no_overlay,d=e.world_data,f=e.name_guess,v=e.frozen
ee(c)
a=(a||Z.UI)+22
l=l||ur
s=s||"thumb"
if(!i)i=e.w=calcWGLinkWidth(o)
var h="preview"===s&&!u
var p=void 0===e.overlay_mode?h:e.overlay_mode
var m=void 0===e.overlay_users?h:e.overlay_users
var g=void 0===e.overlay_title?h:e.overlay_title
var E=p||m||g
var y=n.wid||St()
var T=n.wgid||"default"
if("info"===T)T="default"
var I=getState(y,T,c)
var S="info"===T||"default"===T
var A="NEW"===y?null:y!==St()?d||De(y,!S):Ct()
var w=A?A.name||f||xe.LBL_UNKNOWN_WORLD_NAME:f
if(A&&A.name&&f&&f!==A.name&&!hr[y]){hr[y]=true
At("world_name_fix "+y+" "+A.name,le)}var L
if(!A)L=xe.WGLINK_LOADING
if(!L&&A.err)L=A.err
var R=!L&&A.waygates&&A.waygates[T]
if(v)L=xe.WGLINK_FROZEN
if(!L&&!R&&"default"!==T)L=xe.WGLINK_NOT_FOUND
if(!L&&E&&A&&A.full)L=xe.WGLINK_FULL
var x
var O=tr
if("NEW"===y){w=xe.LBL_NEW_WORLD
L=null
x=Wt.new[s]
O=rr}else x=waygateTexture(A,s,T)
if(!x||!x.loaded)x=Wt.procgen[s]
var b=ie.buttonShared(e)
profilerStart("display")
if("rollover"===b.state||"down"===b.state)I.active=Ut(1,I.active+_r*te.frame_dt)
else I.active=Bt(0,I.active-_r*te.frame_dt)
var N=se(I.active,2)
a+=10*N
_e(I.color,N,sr,nr)
_e(I.uvs,N,cr,lr)
var C=l*N
var M=1+2*C
t-=C*i
r-=C*o
i*=M
o*=M
if(L)Gt.drawSizedAligned(ct,t,r,a,ie.font_height*M,Gt.ALIGN.HCENTERFIT|Gt.ALIGN.VCENTER,i,o,L)
if((A||w)&&E){var D=("thumb"===s?Qt:Xt)*o
if(g){var P=.05*i
var k=i-2*P
var B=t+P
var U=r+o*Jt
var G=Gt.drawSizedAligned(A&&A.full?dt:ut,B,U,a+.3,D,Gt.ALIGN.HFIT|Gt.ALIGN.HRIGHT,k,D,w)
ie.drawRect(B+k-G-P,r,t+i,U+D,a+.25,ir)}if(m){var F=A&&A.players||0
if(!F&&A===Ct()){var W=De(y,!S)
if(W)F=W.players||0}if("thumb"===s&&1===F)F=0
if(F){var j=("thumb"===s?er:$t)*o
var H={x:t,y:r+o-1.2*j,w:j,h:j,z:a+.3,frame:ht.PLAYER,color:or}
ht.sprite.draw(H)
if(F>1){H.x+=.55*j
H.z-=.01
ht.sprite.draw(H)
if(F>5){H.x+=.55*j
H.z-=.01
ht.sprite.draw(H)}}}}if(e.teleport_icon){var z=.75*o
var V={x:t+.5*(i-z),y:r+.5*(o-z),z:a+.3,w:z,h:z,frame:ht.TELEPORT}
ht.sprite.draw(V)}if(p){var Y=t+.965*i
var q=r+.965*o
if(A&&!A.err&&!A.unlimited){ht.sprite.draw({x:Y-D,y:q-D,z:a+.3,w:D,h:D,frame:ht.ADVENTURE_MODE})
Y-=1.25*D}if(A&&A.gems)Y-=Gt.drawSizedAligned(ft,Y,q,a+.3,D,Gt.ALIGN.HRIGHT|Gt.ALIGN.VBOTTOM,0,0,"♦")+.25*D
if(A&&A.trophy)ht.sprite.draw({x:Y-D,y:q-D,z:a+.3,w:D,h:D,frame:ht.TROPHY,color:st[A.trophy]})}}if(x.loaded||x.err){var K=300
var X=ce
if(I.reset||!I.last_tex||I.last_tex_time&&I.last_tex_time<te.frame_timestamp-K){I.last_tex=x
I.last_tex_time=0}else if(x!==I.last_tex){if(!I.last_tex_time)I.last_tex_time=te.frame_timestamp
ae.queueraw([I.last_tex],t,r,a,i,o,0,0,1,1,ce)
var Q=(te.frame_timestamp-I.last_tex_time)/K
dr[3]=ne(Q,2)
X=dr}ae.queueraw([x],t,r,a+.01,i,o,0,0,1,1,X)}vr.x=t
vr.y=r
vr.w=i
vr.h=o
vr.z=a+.4
vr.color=I.color
vr.uvs=I.uvs
Ht.draw(vr)
var J=5
var $=1
if(o<100)J*=$=.5
ie.drawBox({x:t-J,y:r-J,w:i+2*J,h:o+2*J,z:a+.5},ie.sprites.rect,$,O)
if(!e.disabled){ie.drawBox({x:t-J+2,y:r-J+2,w:i+2*J,h:o+2*J,z:a-20},ie.sprites.rect_shadow,1,ar)
if(_){profilerStopStart("link")
if(re({key:I.key,x:e.x,y:e.y,w:e.w,h:e.h,internal:true,url:""+oe.getURLPageBase()+_}))b.ret=true}}profilerStop()
profilerStop("waygateLinkUI")
return b.ret}function drawHLine(e,t,r){ie.drawLine(e-.5*r,t+=4,e+.5*r,t,Z.UI,1,1,nt)
return t+4}var pr=[]
var mr=[]
var gr=false
var Er
var yr=[ht.WAYGATE,xe.LBL_WG_CONFIGURATION]
var Tr=[ht.HOME,xe.LBL_SETTLEMENT_MNG,xe.WGUI_SETTLEMENT_MNG_SUBTITLE]
var Ir=[ht.ENERGY_WELL,xe.LBL_ENERGY_WELL,xe.$(xe.WGUI_ENERGY_WELL_SUBTITLE,pt)]
var Sr=[ht.ENERGY_WELL,xe.LBL_ENERGY_WELL_STATUS,xe.$(xe.WGUI_ENERGY_WELL_REMOTE_SUBTITLE,pt)]
var Ar=[ht.LOCK,xe.LBL_AREA_ACCESS_CONTROL,null]
function waygateEditTitle(){var e=Ue()
if(!e||!e.isWaygate())return null
var t=waygateGetMetadataFromProp(e)
if(null==t?void 0:t.is_settlement)if(e.waygateEditAllowed())return xe.LBL_WG_AND_SETTLEMENT_MNG
else return xe.LBL_SETTLEMENT_MNG
else return xe.LBL_WG_CONFIGURATION}var wr
function waygateEditShowTitle(e,t,r,a){var i=Re()-t
var o=t
var n=o+i/2
var s=e[1]
if(e===Tr){var l
if(null!=a&&a.wgid){var c
l=null==(c=Mt(a.wgid))?void 0:c.name}if(l)s=xe.$(xe.LBL_NAMED_SETTLEMENT,l)}wr=s
if(!h.split_waygate){Ft.drawSizedAligned(_t,o,r,Z.UI,u,Gt.ALIGN.HCENTERFIT,i,0,s)
r+=u}var _=e[2]
if(_){Gt.drawSizedAligned(vt,o,r,Z.UI,f,Gt.ALIGN.HCENTERFIT,i,0,_)
r+=f}if(!h.split_waygate||_)r=drawHLine(n,r,d)
return r}var Lr=1.5*Ke
var Rr=1.5*Ke+qe
function waygateEditRun(e,C,M,D){var P=Z.UI
var t=Re()-e
var r=e
var k=r+t/2
var a=Boolean(D)
var i=D&&D.is_settlement
Ft.drawSizedAligned(_t,r,C,Z.UI,S,Gt.ALIGN.HCENTERFIT,t,0,Nt()?xe.LBL_ENTRYWAY_SETTLEMENT:xe.LBL_ENTRYWAY)
C+=S+8
var o=false
if(!a){ee(M)
if(Q()){Gt.drawSizedAligned(ct,r,C,Z.UI,ie.font_height,Gt.ALIGN.HCENTERFIT,t,0,xe.WGUI_ENTRYWAY_REQUIREMENT)
C+=ie.font_height+4
if(ie.buttonText({x:k-Ke-4,y:C,z:P,w:Ke,h:qe,text:xe.addEllipsis(xe.BTN_ASSIGN_WGID)}))waygateAssignIDPrompt()
if(ie.buttonText({x:k+4,y:C,z:P,w:Ke,h:qe,text:xe.addEllipsis(xe.BTN_SET_DEFAULT_WG)}))waygateAssignID("default")
C+=qe+8}else{var n=1.5*Ke
var s=ue(M.getLocalPos())
var l=Boolean($e())
if(!s){l=l&&ue(M.getLocalPos(),""+z+Et())
Gt.drawSizedAligned(ct,r,C,Z.UI,ie.font_height,Gt.ALIGN.HCENTERFIT,t,0,l?xe.WGUI_SETTLEMENT_OVERLAP:xe.WGUI_SETTLEMENT_OVERLAP_NO_MOVE)
C+=ie.font_height+8}if(ie.buttonText({x:k-n-4,y:C,z:P,w:n,h:qe,text:xe.addEllipsis(xe.BTN_ESTABLISH_SETTLEMENT),disabled:!s}))waygateEstablishSettlement()
if(ie.buttonText({x:k+4,y:C,z:P,w:n,h:qe,text:xe.addEllipsis(xe.BTN_MOVE_SETTLEMENT),disabled:!l}))waygateMoveSettlement()
C+=qe+8}}else{var c=D.wgid,_=D.wg
if(!(o="default"===c)&&!i){Gt.drawSizedAligned(ct,k-8,C,Z.UI,ie.font_height,Gt.ALIGN.HRIGHT|Gt.ALIGN.VCENTER,0,qe,xe.separateColon(xe.LBL_WAYGATE_ID,c))
if(ie.buttonText({x:k,y:C,z:P,w:Ke,h:qe,text:xe.addEllipsis(xe.BTN_REMOVE_WGID)}))ie.modalDialog({title:xe.DLG_REMOVE_WGID_TITLE,text:xe.DLG_REMOVE_WGID_MSG,buttons:{Yes:function Yes(){if(!It())return void showError(xe.DLG_ERROR_REMOVING_WGID_TITLE,xe.ERR_WORLD_DISCONNECTED)
Oe.chat_ui.cmdParse("waygate_remove "+c,showError.bind(null,xe.DLG_ERROR_REMOVING_WGID_TITLE))},No:null}})
C+=qe+8}if(i){Gt.drawSizedAligned(ct,r,C,Z.UI,ie.font_height,Gt.ALIGN.HCENTERFIT,t,0,xe.WGUI_WG_IS_SETTLEMENT)
C+=ie.font_height+8
if(!o){if(ie.buttonText({x:k-Ke/2,y:C,z:P,w:Ke,h:qe,text:xe.addEllipsis(xe.BTN_DESTROY_SETTLEMENT)}))ie.modalDialog({title:xe.DLG_DESTROY_SETTLEMENT_TITLE,text:xe.DLG_DESTROY_SETTLEMENT_MSG_WARNING+"\n\n"+xe.DLG_DESTROY_SETTLEMENT_MSG_CONFIRM,buttons:{Yes:function Yes(){if(!It())return void showError(xe.DLG_ERROR_DESTROYING_SETTLEMENT_TITLE,xe.ERR_WORLD_DISCONNECTED)
Oe.chat_ui.cmdParse("waygate_remove "+c,showError.bind(null,xe.DLG_ERROR_DESTROYING_SETTLEMENT_TITLE))},No:null}})
C+=qe+8}}Gt.drawSizedAligned(ct,k-8,C,Z.UI,ie.font_height,Gt.ALIGN.HRIGHT|Gt.ALIGN.VCENTER,0,qe,xe.addColon(xe.LBL_NAME))
Gt.drawSizedAligned(ct,k,C,Z.UI,ie.font_height,Gt.ALIGN.HCENTERFIT|Gt.ALIGN.VCENTER,Ke-qe-8,qe,_.name)
if(ie.buttonImage({x:k+Ke-qe,y:C,z:P,img:ht.sprite,frame:ht.EDIT,w:qe,h:qe}))ie.modalTextEntry({edit_text:_.name,title:xe.DLG_WG_NAME_TITLE,text:xe.DLG_WG_NAME_MSG,max_len:b,buttons:{OK:function OK(e){waygateRename(c,e.trim()||xe.WGUI_NEW_WAYGATE)},Cancel:null}})
C+=qe+8
var u=(Ke-4)/2
Gt.drawSizedAligned(ct,k-8,C,Z.UI,ie.font_height,Gt.ALIGN.HRIGHT|Gt.ALIGN.VCENTER,0,qe,xe.addColon(xe.LBL_LISTED))
var d=_.flags&V
var f=yt()
if(ie.buttonText({x:k,y:C,z:P,w:Ke-u-4,h:qe,text:d?xe.BTN_YES.upper():xe.BTN_NO.upper(),tooltip:xe.WGUI_LISTED_WG_LINKED,disabled:d&&o||!f}))wt("waygate_mod",{wgid:c,key:"listed",value:!d},showError.bind(null,xe.DLG_ERROR_EDITING_WG_TITLE))
if(ie.buttonText({x:k+Ke-u,y:C,z:P,w:u,h:qe,text:xe.BTN_GET_LINK,disabled:!d})){var v=St()
if(window.FBInstant)Ie(v,c)
else{ie.provideUserString(xe.DLG_SHARE_WG_TITLE,Ve(v,c))
q("share_link",1,null,String(v),{wgid:c})}}if(window.FBInstant&&ie.buttonText({x:k+Ke+u+8-u,y:C,z:P,w:u,h:qe,text:xe.BTN_SHARE,disabled:!d}))Te(St(),c)
if(d&&oe.get("wg")!==c)oe.set("wg",c)
else if(!d&&oe.get("wg")===c)oe.set("wg","")
C+=qe+8
var h=2*qe
Gt.drawSizedAligned(ct,k-8,C,Z.UI,ie.font_height,Gt.ALIGN.HRIGHT|Gt.ALIGN.VCENTER,0,h,xe.addColon(xe.LBL_SCREENSHOT))
var p=Ne()
var m=Se()||gr||p
var g={x:k,y:C,z:Z.UI,h:h,target:{wid:St(),wgid:c},disabled:true,ctx:"waygate_edit",no_overlay:true}
waygateLinkUI(g)
var E=g.w
var y=k+E+8
var T=Ke-(E+8)
if(ie.buttonText({x:y,y:C+(h-qe)/2,z:P,w:T,h:qe,text:p?xe.BTN_NOT_AVAILABLE:m?xe.BTN_PROCESSING:xe.addEllipsis(_.imgid?xe.BTN_CHANGE:xe.BTN_SET),disabled:m,in_event_cb:w.pointerLockEnter})){var I=St()
je(true,function(e,t){if(ze(e,I,t)){var r=L().pak("waygate_set_images")
r.writeAnsiString(I)
r.writeInt(t.full.id)
r.writeInt(t.preview.id)
r.writeInt(t.thumb.id)
r.send(function(e,t){if(e||!It()){He()
We(xe.DLG_ERROR_IMAGE_UPLOAD_TITLE,e||xe.ERR_WORLD_DISCONNECTED)}else wt("waygate_mod",{wgid:c,key:"imgid",value:t},function(e){He()
if(e)We(xe.DLG_ERROR_SETTING_WG_IMG_TITLE,e)
else Xe(xe.STATUSMSG_WG_IMG_SAVED)})})}})}C+=h+8
if(o||i){C+=8
if(i){Gt.drawSizedAligned(lt,r,C,Z.UI,ie.font_height,Gt.ALIGN.HCENTERFIT,t,0,xe.WGUI_WG_ADVENTURE_HINT_1)
C+=ie.font_height+8
Gt.drawSizedAligned(lt,r,C,Z.UI,ie.font_height,Gt.ALIGN.HCENTERFIT,t,0,xe.WGUI_WG_ADVENTURE_HINT_2)
C+=ie.font_height+8}else{Gt.drawSizedAligned(lt,r,C,Z.UI,ie.font_height,Gt.ALIGN.HCENTERFIT,t,0,xe.WGUI_UNLIMITED_HINT_1)
C+=ie.font_height+8
Gt.drawSizedAligned(lt,r,C,Z.UI,ie.font_height,Gt.ALIGN.HCENTERFIT,t,0,xe.WGUI_UNLIMITED_HINT_2)
C+=ie.font_height+8}if(o){Gt.drawSizedAligned(ct,r,C,Z.UI,ie.font_height,Gt.ALIGN.HCENTERFIT,t,0,xe.WGUI_THIS_IS_DEFAULT_WG)
C+=ie.font_height+8}}}C=drawHLine(k,C,A)
Ft.drawSizedAligned(_t,r,C,Z.UI,S,Gt.ALIGN.HCENTERFIT,t,0,xe.LBL_EXITWAY_TARGETS)
C+=S+8
if(i){Gt.drawSizedAligned(ct,r,C,Z.UI,ie.font_height,Gt.ALIGN.HCENTERFIT,t,0,xe.WGUI_SETTLE_CANNOT_EXITWAY)
C+=ie.font_height+8
return}if(o){Gt.drawSizedAligned(ct,r,C,Z.UI,ie.font_height,Gt.ALIGN.HCENTERFIT,t,0,xe.WGUI_DEFAULT_WG_CANNOT_EXITWAY)
C+=ie.font_height+8
return}if(!Q()){Gt.drawSizedAligned(ct,r,C,Z.UI,ie.font_height,Gt.ALIGN.HCENTERFIT,t,0,xe.WGUI_LF_WG_EXITWAY_FUTURE)
C+=ie.font_height+8
return}if(!M){Gt.drawSizedAligned(ct,r,C,Z.UI,ie.font_height,Gt.ALIGN.HCENTERFIT,t,0,xe.WGUI_MUST_VISIT_EDIT_EXITWAY)
C+=ie.font_height+8
return}var B=M.trans_busy||M.prediction_locked
var U=M.waygate_targets
if(!Array.isArray(U))U=[]
if(U.length>0){if(ie.buttonText({x:k-Ke/2,y:C,z:P,w:Ke,h:qe,text:1===M.exitway_access?xe.BTN_EXITWAY_BUILDERS:xe.BTN_EXITWAY_PUBLIC,disabled:B})){if(1===M.exitway_access)M.exitway_access=0
else M.exitway_access=1
Ze(M)}C+=qe+8}if(!Er)Er=R({z:Z.UI,background_color:null,auto_hide:true})
Er.keyboardScroll()
Er.begin({x:r,y:C,w:t,h:Ge()-C})
r=C=0
function updateTargets(){M.waygate_targets=U
Ze(M)}var G=null
U.forEach(function(e,t){var r=e.wid?De(e.wid,true):Ct()
if(r&&!r.err){var a=pr[t]
if(a&&a.dropdown_visible)G=t
if((a=mr[t])&&a.dropdown_visible)G=t}})
U.forEach(function(r,e){var t=B||null!==G&&G!==e
if(ie.buttonText({x:k-Lr-4-qe-4,y:C,z:P,w:qe,h:qe,text:"X",tooltip:xe.WGUI_REMOVE_WG_TARGET,disabled:t})){U.splice(e,1)
updateTargets()
C+=qe+8
return}var a=mr[e]
if(!a)a=mr[e]=j({items:[],z:Z.UI,width:Lr,entry_height:qe})
var i=[{name:xe.addParenthesesAfter(xe.LBL_THIS_WORLD,St()),tag:void 0},{name:xe.addEllipsis(xe.LBL_OTHER),tag:"other"},{name:xe.BTN_EXIT_TO_MAIN_MENU,tag:F}]
var o={}
o[St()]=true
var n=W().getMyUserChannel()
var s=n&&n.data&&n.data.public||{}
var l=s.worlds||{}
var c=Object.keys(l)
c.sort(function(e,t){var r=De(e,false)
var a=De(t,false)
if(r){if(a){var i=(r.frozen?1:0)-(a.frozen?1:0)
if(i)return i
return l[t].created-l[e].created}return-1}else return 1})
for(var _=0;_<c.length;++_){var u=c[_]
if(!o[u]){o[u]=true
var d=De(u,false)
i.push({name:xe.separateColon(xe.LBL_MINE,d&&!d.err&&d.name?xe.addParenthesesAfter(d.name,u):"#"+u),tag:u})}}var f=s.recent||{};(c=Object.keys(f).filter(function(e){return!o[e]})).sort(function(e,t){return f[t].when-f[e].when})
c=c.slice(0,2)
for(var v=0;v<c.length;++v){var h=c[v]
if(!o[h]){o[h]=true
var p=De(h,false)
i.push({name:xe.separateColon(xe.LBL_RECENT,p&&!p.err&&p.name?xe.addParenthesesAfter(p.name,h):"#"+h),tag:h})}}var m
if(!r.wid||r.wid===St())m=0
else{for(var g=0;g<i.length;++g)if(i[g].tag===r.wid)m=g
if(void 0===m){var E=De(r.wid,false)
if(E&&!E.err&&E.name)i.push({name:E.name+" ("+r.wid+")",tag:r.wid})
else i.push({name:xe.$(xe.LBL_NUMBERED_WORLD,r.wid),tag:r.wid})
m=i.length-1}}a.run({x:k-Lr-4,y:C,disabled:t,items:i,initial_selection:m})
var y=a.getSelected().tag||void 0
if(!B&&y!==r.wid&&!a.dropdown_visible)if("other"===y){a.selected=m
ie.modalTextEntry({edit_text:r.wid||"",title:xe.DLG_WAYGATE_TARGET_TITLE,text:xe.DLG_WAYGATE_TARGET_MSG,max_len:20,buttons:{Current:function Current(){a.reset_selection=true
if(stillHere()===M){r.wid=void 0
r.wgid=void 0
updateTargets()}},OK:function OK(e){a.reset_selection=true
var t=Number(e)
if(!H(t))return void showError(null,xe.DLG_INVALID_WORLD_ID_TITLE)
if(stillHere()===M){r.wid=String(t)
r.wgid=void 0
updateTargets()}},Cancel:null}})}else{r.wid=y||void 0
r.wgid=void 0
updateTargets()}var T=r.wid===F?null:r.wid?De(r.wid,true):Ct()
if(r.wid===F);else if(!T||T.err)Gt.drawSizedAligned(ct,k,C,P,ie.font_height,Gt.ALIGN.VCENTER,0,qe,T&&T.err?xe.$(xe.WGTARGET_INVALID_WORLD_ID,T.err):xe.WGTARGET_EXITWAY_LOADING)
else{var I=pr[e]
if(!I)I=pr[e]=j({items:[],z:Z.UI,width:Rr,entry_height:qe})
var S=[{name:xe.LBL_DEFAULT_WAYGATE,tag:void 0},{name:xe.LBL_SHOW_WORLD_INFO,tag:"info"}]
var A=T.waygates||{}
var w=Object.keys(A)
Ot(A,null)
w.sort(xt)
for(var L=0;L<w.length;++L){var R=w[L]
if("default"===R||!r.wid&&D&&D.wgid&&D.wgid===R)continue
var x=A[R]
if(x.flags&V||!r.wid)S.push({name:x.name+" ("+R+(x.flags&V?"":"*")+")",tag:R})}var O
if(!r.wgid)O=0
else for(var b=0;b<S.length;++b)if(S[b].tag===r.wgid)O=b
I.run({x:k+4,y:C,disabled:t,items:S,initial_selection:O})
var N=I.getSelected().tag||void 0
if(!B&&N!==r.wgid&&!I.dropdown_visible){r.wgid=N
updateTargets()}}C+=qe+8})
if(Object.keys(U).length<x){if(ie.buttonText({x:k-Ke/2,y:C,z:P,w:Ke,h:qe,text:xe.BTN_ADD_NEW_TARGET,disabled:B})){U.push({})
updateTargets()}C+=qe+8}Er.end(C)}function doEnergyWell(e){var t=ie.button_height
var r=Ue()
if(!r||!r.isEnergyWell()){Ce()
return Ir[1]}var a=waygateGetMetadataFromProp(r)
t=waygateEditShowTitle(Ir,e,t,a)
me(e,t,r,a,false)
return wr}function waygateEditRemote(e){zt=e
Pe.init(Pe.WAYGATE_EDIT_REMOTE,null)}function doWaygateEdit(e,t){var r=ie.button_height
var a=Z.UI
var i=r
var o=e-ie.button_height
var n
var s
var l=false
if(t){if(!(n=waygateGetMetadataRemote())){Ce()
return null}if(Zt!==Vt&&!n.is_settlement)Zt=Vt}else{n=(s=Ue())&&waygateGetMetadataFromProp(s)
if(!s||!s.isWaygate()){Ce()
return null}l=$(Be())}var c=t&&yt()||!t&&s.waygateEditAllowed()
var _=null==n?void 0:n.is_settlement
if(!_&&!c){Ce()
return null}if(null!=n&&n.is_unbound)if(Zt===qt)Zt=Yt
var u
function tabButton(e,t){var r=Zt===e
if(Nt()){if(ie.buttonImage({x:o-4,y:i,z:r?a:a-20,z_bias:r?null:{down:20},shrink:.7,img:ht.sprite,frame:t[0],colors:r?Pe.tab_colors_selected:Pe.tab_colors_unselected,disabled:false,base_name:r?"tab_horiz":"tab_inactive",tooltip:t[1],drag_over:true})){r=true
Zt=e}i+=ie.button_height}if(r)u=t}if(c)tabButton(Vt,yr)
if(_){tabButton(Yt,Tr)
if(!(null!=n&&n.is_unbound))tabButton(qt,t?Sr:Ir)}if(l)tabButton(Kt,Ar)
o=e
i=r
if(!u)return xe.LBL_UNKNOWN_MENU
i=waygateEditShowTitle(u,o,i,n)
if(Zt===Yt)rt(o,i,n,t)
else if(Zt===qt)me(o,i,s,n,t)
else if(Zt===Kt)G(o,i,l)
else waygateEditRun(o,i,s,n)
return wr}function waygateLabel(e){var t=e.wgid||"default"
var r="info"===t||"default"===t
var a=(e.wid?De(e.wid,!r):Ct())||{}
var i=a.name||xe.$(xe.LBL_NUMBERED_WORLD,e.wid)
var o=a.waygates||{}
if("info"===t||"default"===t&&e.wid&&e.wid!==St())return i
else{var n=o[t]
var s=n&&n.name||xe.$(xe.WGUI_UNKNOWN_WAYGATE,t)
return e.wid?xe.$(xe.WGUI_WG_IN_WORLD,s,i):s}}var xr=106
function doWaygateTargets(){var e=ie.button_height
var n=Z.UI
var t=0
var r=Re()-t
var s=e
var a=t
var l=a+r/2
var i=xe.LBL_WAYGATE_TARGETS
var o=Ue()
var c=o&&o.waygate_targets
if(!o||!o.isWaygate()||!c||!c.length){Ce()
return i}s+=12
if(!Er)Er=R({z:Z.UI,background_color:null,auto_hide:true})
Er.keyboardScroll()
Er.begin({x:a,y:s,w:r,h:Ge()-s})
a=s=0
c.forEach(function(e,t){var r=e.wgid||"default"
var a="info"===r||"default"===r
var i=e.wid===F?null:e.wid?De(e.wid,!a):Ct()
if(e.wid===F){if(ie.buttonText({x:l-ie.button_width/2,y:s,h:xr,font_height:36,text:xe.BTN_EXIT_TO_MAIN_MENU}))Oe.returnToMainMenu()}else if(!i)Gt.drawSized(ct,l,s,n,ie.font_height,xe.WGTARGET_EXITWAY_LOADING)
else if(i.err)Gt.drawSized(ct,l,s,n,ie.font_height,xe.$(xe.WGTARGET_INVALID_WORLD_ID,i.err))
else{var o=waygateLabel(e)
Gt.drawSizedAligned(ct,l-8,s,Z.UI,ie.font_height,Gt.ALIGN.VCENTER|Gt.ALIGN.HRIGHT,0,xr,o)
if(waygateLinkUI({x:l,y:s,h:xr,in_event_cb:w.pointerLockEnter,target:e,style:"preview",no_overlay:true,overlay_mode:e.wid?true:void 0,ctx:"waygate_target_"+t})){Oe.menuExit()
Lt(e)}}s+=xr+8})
Er.end(s)
return i}var Or=30
var br=Je.createFast()
var Nr=y(.53,.3,.8,1)
var Cr=y(1,1,1,1)
function drawWaygateFX(e){v.push()
v.setNormalized()
Nr[3]=e
var t=.75*Bt(0,1.5*e-.5)
Cr[3]=t
ae.queueraw(Le(),.5,0,Z.WAYGATE_FX+1,.5,1,0,0,1,1,Nr)
ae.queueraw(Le(),0,0,Z.WAYGATE_FX+1,.5,1,1,0,0,1,Nr)
var r=br
r.reseed(1234)
var a=te.frame_timestamp
for(var i=0;i<Or;++i){var o=r.random()
var n=a*(.001+.001*r.random())+o
var s=kt(n)
n=1-(n-s)
var l=m(r.random()+.31*s)
var c=r.floatBetween(.02,.03)
var _=r.floatBetween(.25,.5)
ae.queueraw(we(),l,3*n-1,Z.WAYGATE_FX,c,_,0,0,1,1,Cr)}v.pop()}var Mr=3e3
var Dr=0
var Pr
var kr=0
var Br=null
var Ur=0
function waygateSuppressAutoActivate(){Ur=500}function waygateUITick(e){var t=e?Oe.char_controller.getPropsOn():{}
var r=null
for(var a in t){var i=t[a]
if(i.item_id===T)if(r){if(E(Oe.char_controller.feet_pos,i.getLocalPos())<E(Oe.char_controller.feet_pos,r.getLocalPos()))r=i}else r=i}var o=r&&r.waygate_targets
var n=r&&waygateGetMetadataFromProp(r)
var s=n&&n.is_settlement
if(o){if(n&&("default"===n.wgid||s))o=null
if(o)if(1===r.exitway_access&&!r.inEditBounds(Qe)){it.get("waygate").setMessage(xe.STATUSMSG_EXITWAY_INACCESSIBLE).fade()
o=null}}var l=s&&n.wgid===Et()
var c=o&&o.length
var _=true
if(Ur){Ur=Bt(0,Ur-te.frame_dt)
if(r)Br=r}if(Br&&r===Br)_=false
else if(e)Br=null
if(l)if(!ge(r))l=false
else if(!fe(r)){it.get("waygate").setMessage(xe.$(xe.STATUSMSG_WELL_RECHARGING,ve(r))).fade()
l=false}if(!c&&!l)_=false
if(!_){if(Pr){Pr.remove()
Pr=null}kr=0
if(Dr)if(Dr=Bt(0,Dr-.01*te.frame_dt))drawWaygateFX(Dr)
return}if(!kr)kr=Mr
var u
var d
var f=Pt(kr/1e3)
if(l)u=xe.$(xe.STATUSMSG_DRINKING_WELL,f)
else if(1===o.length){var v=d=o[0]
if(v.wid===F)u=xe.$(xe.STATUSMSG_EXITING,waygateLabel(v),f)
else u=xe.$(xe.STATUSMSG_WAYGATING_TO,waygateLabel(v),f)}else u=xe.$(xe.STATUSMSG_WAYGATING_CHOICES,f);(Pr=it.get("waygate")).setMessage(u)
drawWaygateFX(Dr=1-kr/Mr)
if(te.frame_dt<kr)kr-=te.frame_dt
else{Br=r
kr=0
Pr.remove()
Pr=null
if(l)he()
else if(d)if(d.wid===F){p.queue(Z.TRANSITION_FINAL,p.fade(350))
Me()}else Lt(d)
else Oe.toggleMenuPage(Pe.WAYGATE_TARGETS,r.interactDetails())}}},{"../common/ids":198,"../common/waygate_common":210,"../common/world_constants":212,"../glov/client/camera2d":241,"../glov/client/engine":250,"../glov/client/input":271,"../glov/client/link":273,"../glov/client/net":279,"../glov/client/scroll_area":289,"../glov/client/selection_box":290,"../glov/client/settings":291,"../glov/client/sprites":302,"../glov/client/textures":304,"../glov/client/transition":305,"../glov/client/ui":306,"../glov/client/urlhash":307,"../glov/common/util":330,"../glov/common/verify":331,"../glov/common/vmath":332,"./access_control":2,"./analytics":5,"./build_mode":27,"./editvolume_client":72,"./energy_well":73,"./fbinstant_worlds":80,"./file_management":82,"./fx_util":86,"./layout":99,"./localization/localization":108,"./main":112,"./main_menu":113,"./menu":117,"./photo_mode":128,"./platform_share_urls":130,"./prop_edit":140,"./props.js":141,"./rand_seed":145,"./settlement":148,"./settlement_edit":149,"./status":156,"./styles":160,"./ui_util":168,"./user_data":170,"./world_comm":182,"./world_info_view":184,"./world_metadata":186,assert:void 0}],180:[function(e,t,r){"use strict"
r.waygateUpgradeStartup=waygateUpgradeStartup
r.WAYGATE_SICKNESS_DURATION=r.WAYGATE_SAFE_TIME=void 0
var a=3600
var i=r.WAYGATE_SAFE_TIME=a
r.WAYGATE_SICKNESS_DURATION=i
var d=e("assert")
var f=e("../common/ids").TYPE_ITEM
var o=e("../common/waygate_upgrade_common")
var n=o.WAYGATE_TIERS
var v=o.WAYGATE_UPGRADES
var h=o.waygateUpgradeCommonStartup
var s=e("./crafting_recipes")
var p=s.craftingRecipes
var m=s.craftingRecipesStartup
var l=e("./items")
var g=l.createItem
var E=l.itemPrototypePoke
var y=e("./tiles")
r.WAYGATE_TIERS=n
r.WAYGATE_UPGRADES=v
function waygateUpgradeStartup(){m()
h(g,y)
var e=p()
for(var t in v){var r=v[t]
var a=r.unlocks,i=r.unlocks_recipes
if(a||i){var o=[]
if(a)for(var n=0;n<a.length;++n){var s=a[n]
var l=g({type:f,id:s})
if(l.unlock_display_item)l=g(l.unlock_display_item)
o.push(l)
E(s,"is_settlement_locked",true)}if(i)for(var c=0;c<i.length;++c){var _=e[i[c]]
d(_&&_.icon)
_.is_settlement_locked=true
var u=_.icon
o.push(u)}r.unlock_items=o}}}},{"../common/ids":198,"../common/waygate_upgrade_common":211,"./crafting_recipes":59,"./items":98,"./tiles":162,assert:void 0}],181:[function(e,t,r){"use strict"
r.onWorldUnclaimed=onWorldUnclaimed
r.getClaimCount=getClaimCount
r.claimReset=claimReset
r.claimFinalize=claimFinalize
r.claim=claim
r.unclaim=unclaim
r.claimReconnect=claimReconnect
r.CLAIM_NAME=r.CLAIM_BY_SELF=r.CLAIM_BY_OTHER=r.CLAIM_UNKNOWN=r.CLAIM_PENDING=void 0
var n=-2
r.CLAIM_PENDING=n
var s=-1
r.CLAIM_UNKNOWN=s
var l=0
r.CLAIM_BY_OTHER=l
var c=1
r.CLAIM_BY_SELF=c
var _=e("assert")
var u=e("../glov/client/engine.js")
var a=e("./main.js")
var i=e("../glov/client/net.js").netDisconnected
var d=e("./voxel_data.js")
var f=e("./world_comm.js").worldSend
function onWorldUnclaimed(e){_(Array.isArray(e))
e.forEach(function(e){var t=d.chunk_map[e]
if(t){_(t.claimed!==c)
if(t.claimed!==n)t.claimed=s}})}var o=[];(r.CLAIM_NAME=o)[n]="CLAIM_PENDING"
o[s]="CLAIM_UNKNOWN"
o[l]="CLAIM_BY_OTHER"
o[c]="CLAIMED"
var v
function getClaimCount(){return v}var h
var p
var m
function claimReset(){h=[]
p=[]
m={}
v=0}claimReset()
function sendClaims(){var o=p
p=[]
if(!a.omp)return
for(var e=0;e<o.length;++e){var t=o[e]
var r=d.chunk_map[t]
_(r)
_.equal(r.claimed,n)}f("claim",o,function(e,t){if(e){console.error("Error claiming chunks",e)
o.forEach(function(e){var t=d.chunk_map[e]
if(t){t.claimed=s
t.claim_throttle=u.frame_timestamp+5e3}})
return}_.equal(t.length,o.length)
for(var r=0;r<t.length;++r){var a=o[r]
if(m[a]){if(!--m[a])delete m[a]
continue}var i=d.chunk_map[a]
if(i){_.equal(i.claimed,n)
if(t[r]){++v
i.claimed=c}else i.claimed=l}}})}function sendUnclaims(){var e=h
h=[]
if(!a.omp||i())return
f("unclaim",e,function(e,t){if(e)console.error("Error unclaiming chunks",e)})}function claimFinalize(){if(p.length)sendClaims()
if(h.length)sendUnclaims()}function claim(e){_.equal(e.claimed,s)
if(!a.omp){++v
e.claimed=c
return}if(i())return
e.claimed=n
p.push(e.chunk_id)}function unclaim(e){if(e.claimed===c||e.claimed===n){if(e.claimed===n){_(e.disposed)
m[e.chunk_id]=(m[e.chunk_id]||0)+1}if(a.omp)h.push(e.chunk_id)
if(e.claimed===c)--v
e.claimed=s}}function claimReconnect(){for(var e in d.chunk_map){var t=d.chunk_map[e]
if(t.claimed===c)--v
t.claimed=s}}},{"../glov/client/engine.js":250,"../glov/client/net.js":279,"./main.js":112,"./voxel_data.js":175,"./world_comm.js":182,assert:void 0}],182:[function(e,t,I){"use strict"
I.worldAutoConnect=worldAutoConnect
I.worldAutoConnectIsReconnect=worldAutoConnectIsReconnect
I.getWorldID=getWorldID
I.getWorldChannel=getWorldChannel
I.worldReconnected=worldReconnected
I.worldAutoConnectClear=worldAutoConnectClear
I.worldGoByURL=worldGoByURL
I.getClientID=getClientID
I.worldIsWaiting=worldIsWaiting
I.whenConnected=whenConnected
I.getChunk=getChunk
I.worldGetTile=worldGetTile
I.worldSetUserData=worldSetUserData
I.transDelay=transDelay
I.getUserData=getUserData
I.worldSend=worldSend
I.worldPak=worldPak
I.refreshProp=refreshProp
I.worldTransactionsInProgress=worldTransactionsInProgress
I.transact=transact
I.getGemBalance=getGemBalance
I.worldClaimGem=worldClaimGem
I.getPerm=getPerm
I.worldGetRoles=worldGetRoles
I.worldGetClients=worldGetClients
I.worldBuzzerStart=worldBuzzerStart
I.worldBuzzerAbandon=worldBuzzerAbandon
I.worldBuzzerSubmit=worldBuzzerSubmit
I.worldBuzzerRemove=worldBuzzerRemove
I.worldRefreshUserData=worldRefreshUserData
I.joinWorld=joinWorld
I.worldTargetGo=worldTargetGo
I.worldCommStartup=worldCommStartup
I.leaveWorld=leaveWorld
I.worldCmdParse=worldCmdParse
I.myUserCmdParse=myUserCmdParse
I.myUserCmdParseWrap=myUserCmdParseWrap
I.trans_in_progress=I.is_reconnected=I.world_id=I.world_channel=void 0
var F=e("assert")
var r=e("../glov/client/client_config.js").PLATFORM_MSSTART
var a=e("../glov/client/cmds.js").cmd_parse
var o=e("../glov/client/engine.js")
var i=e("../glov/client/error_report.js")
var n=i.errorReportSetDetails
var s=i.errorReportSetDynamicDetails
var l=e("../glov/client/fscreen.js").fscreenActive
var c=e("../glov/client/input.js")
var _=e("../glov/client/local_storage.js")
var u=e("../glov/client/net.js")
var d=u.netClient
var f=u.netClientId
var v=u.netDisconnected
var h=u.netSubs
var p=u.netUserId
var m=e("../glov/client/perf.js").perfSetAutoChannel
var g=e("../glov/client/settings.js")
var E=e("../glov/client/subscription_manager.js").isFirstSession
var y=e("../glov/client/ui.js")
var T=e("../glov/client/urlhash.js")
var S=e("../glov/common/util.js")
var A=S.callEach
var w=S.msToTimeString
var L=S.nop
var R=S.ridx
var W=e("../glov/common/verify.js")
var x=e("../glov/common/vmath.js")
var j=x.v3same
var O=x.vec3
var b=e("../common/permissions.js")
var N=e("../common/store_data.js").PRODUCT_ITEM_ID_GEM
var C=e("../common/voxel_data_common.js")
var M=C.ANIM_TYPE_POS
var H=C.TRANSACT_BAG_ADD
var z=C.TRANSACT_INV_ATTRIB
var V=C.TRANSACT_INV_MOD
var Y=C.TRANSACT_ITEM_ANIM
var q=C.TRANSACT_PROP_INV_MOD
var K=C.TRANSACT_PROP_MOD
var Z=C.TRANSACT_PROP_SET
var X=C.TRANSACT_STAT
var Q=C.TRANSACT_USER_ATTRIB
var J=C.TRANSACT_VOLUME_MOD
var $=C.TRANSACT_VOXEL_SET
var ee=C.TRANSACT_VOXEL_SET_RANGE
var D=C.TRANS_INV_EQUIP
var P=C.TRANS_INV_PLAYER
var k=e("../common/world_constants.js")
var B=k.ACCESS_OWNER
var U=k.THRESHOLD_ACCESS_MODIFY
var G=k.WAYGATE_FLAG_LISTED
var te=k.WAYGATE_FLAG_SETTLEMENT
var re=e("../common/world_trans.js")
var ae=re.createTransSet
var ie=re.decodeChunkPos
var oe=re.encodeChunkPos
var ne=e("./analytics.js")
var se=ne.analyticsAddFieldFunction
var le=ne.logEvent
var ce=ne.logEventOnce
var _e=e("./blueprint.js").blueprintUnsubscribeAll
var ue=e("./build_mode.js")
var de=ue.applyDigProgress
var fe=ue.doStamina
var ve=ue.protectBlockIdx
var he=e("./client_cmds.js")
var pe=he.isElevated
var me=he.waygateGo
var ge=he.waygateToPosStr
var Ee=e("./client_entities.js").clientEntitiesJoinWorld
var ye=e("./continent_loader.js").continentLoaderLeaveWorld
var Te=e("./editvolume_client.js").resetEditVolumes
var Ie=e("./energy_well.js").possiblyApplyWaygateSickness
var Se=e("./fbinstant_worlds.js").fbPostPassiveToContext
var Ae=e("./inventory.js")
var we=e("./inventory.js")
var Le=we.INV_EQUIP
var Re=we.INV_PLAYER
var xe=we.debugTools
var Oe=e("./item_anims.js")
var be=e("./localization/localization").L
var Ne=e("./main.js")
var Ce=e("./main_menu.js")
var Me=e("./main_menu.js").getWorldInfo
var De=e("./megachunk_client.js")
var Pe=e("./megachunk_client.js")
var ke=Pe.detailGenUnspoil
var Be=Pe.onVolumeMod
var Ue=e("./menu.js")
var Ge=e("./menu.js")
var Fe=Ge.WORLD_INFO_VIEW
var We=Ge.exitSpecificMenu
var je=e("./mobs.js").otherPlayerAnim
var He=e("./props.js")
var ze=e("./social_referral.js").checkReferrer
var Ve=e("./status.js")
var Ye=e("./tiles.js")
var qe=Ye.TILE_PROP_BASE
var Ke=Ye.TILE_PROP_MAX
var Ze=e("./tutorial.js")
var Xe=Ze.tutorialLeaveWorld
var Qe=Ze.tutorialStartByName
var Je=Ze.tutorialState
var $e=e("./ui_util.js").GEM_SYMBOL
var et=e("./user_data.js")
var tt=e("./user_data.js")
var rt=tt.isPlayAsViewer
var at=tt.isWaiting
var it=tt.playAsViewerSet
var ot=tt.raceJoinAllowed
var nt=tt.userAttribUndoTransactionOp
var st=tt.userDataGet
var lt=tt.userDataLeaveWorld
var ct=tt.userDataPredict
var _t=tt.userDataSet
var ut=tt.userDataStartWaiting
var dt=tt.worldReadOnly
var ft=e("./user_party").partySetUserWorld
var vt=e("./voxel_chunk_manager.js").releaseClaimed
var ht=e("./voxel_data.js")
var pt=e("./voxel_data.js")
var mt=pt.getLocalPosFromChunkID
var gt=pt.getPropDirect
var Et=pt.getTilePosPair
var yt=pt.getTileRelative
var Tt=pt.liquidUpdateDefer
var It=pt.markChunkSpoiled
var St=pt.removePropDirect
var At=pt.replacePropDirect
var wt=pt.setPropDirect
var Lt=pt.setTileRelative
var Rt=pt.transSetTileDirect
var xt=pt.voxelDataDirtyCacheEnd
var Ot=pt.voxelDataDirtyCacheStart
var bt=e("./voxel_mesh.js").voxelMeshFlush
var Nt=e("./world_claims.js")
var Ct=Nt.claimReconnect
var Mt=Nt.claimReset
var Dt=Nt.onWorldUnclaimed
var Pt=e("./world_metadata.js")
var kt=e("./world_metadata.js")
var Bt=kt.adventureMode
var Ut=kt.unlimitedMode
var Gt=kt.worldMetadata
var Ft=kt.worldMetadataFreePos
var Wt=kt.worldMetadataSet
var jt=kt.worldMetadataUpdate
var Ht=kt.worldMetadataWaygate
var zt=kt.worldRaceAsVisitor
var Vt=Math.PI
var Yt=1500
var qt
I.world_channel=qt
var Kt
I.world_id=Kt
var Zt=false
I.is_reconnected=Zt
var Xt=0
var Qt=false
var Jt=false
function worldAutoConnect(){return Jt}var $t=false
function worldAutoConnectIsReconnect(){return $t}function getWorldID(){return Kt}function getWorldChannel(){return qt}function worldReconnected(){return Zt}function worldAutoConnectClear(){T.setMulti({w:"",wg:"",u:"",action:""})
Jt=false}s("world",function(){return Kt||void 0})
T.register({key:"w",push:true,title:function title(e){var t
if(e===Kt)t=Gt()
else if(d()){var r="info"===T.get("wg")
t=Me(e,r)}if(t&&t.name)return t.name
return"World #"+e}})
T.register({key:"wg",push:false,hide_values:{default:1,undefined:1}})
T.register({key:"u"})
T.register({key:"action"})
T.route("w/:w")
T.route("w/:w/:wg")
T.route("u/:u/:action")
function worldCommOnURLChange(e){var t=T.get("w")
F(!t||"string"===typeof t)
var r=T.get("wg")
var a="go"===T.get("action")&&T.get("u")
if(t&&"info"===r){Ne.toggleMenuPage(Fe,t)
return}We(Fe)
if(t||a)if(t===Kt&&!e&&Gt()){if(r){var i=me(r,{listed_only:true,from_url:true})
if(i){Ne.chat_ui.addChatError(be.$(be.CHATERROR_ACCESSING_WAYGATE,r,i))
T.set("wg","")}}}else{Jt=true
$t=false
Ne.returnToMainMenu()}else if(Kt)Ne.returnToMainMenu()}function worldGoByURL(e,t){T.setMulti({w:e,wg:t,pos:""})
worldCommOnURLChange()}g.register({full_world_resync:{help:"(Admin) Do a full resync upon reconnect",default_value:1,type:a.TYPE_INT,range:[0,1],access_run:["sysadmin"]}})
function getClientID(){if(!Ne.omp)return"local"
return f()}var er=[]
function checkExpectedPropInvMod(e){F.equal(e.length,10)
e:for(var t=0;t<er.length;++t){var r=er[t]
F.equal(r.length,10)
for(var a=0;a<9;++a)if(r[a]!==e[a])continue e
R(er,t)
return true}return false}var tr=[]
function checkExpectedPropMod(e){F.equal(e.length,8)
e:for(var t=0;t<tr.length;++t){var r=tr[t]
F.equal(r.length,8)
for(var a=0;a<7;++a)if(r[a]!==e[a])continue e
R(tr,t)
return true}return false}var rr=[]
function checkExpectedItemAnim(e){F.equal(e.length,7)
e:for(var t=0;t<rr.length;++t){var r=rr[t]
F.equal(r.length,7)
for(var a=0;a<9;++a)if(r[a]!==e[a])continue e
R(rr,t)
return true}return false}function clearExpected(e,t){var r=false
for(var a=er.length-1;a>=0;--a){var i=er[a]
if(i[7]===e&&i[8]===t){R(er,a)
r=true}}for(var o=tr.length-1;o>=0;--o){var n=tr[o]
if(n[4]===e&&n[5]===t){R(tr,o)
r=true}}return r}function worldIsWaiting(){return De.countWaiting()}var ar=[]
function whenConnected(e){if(!v())return void e()
ar.push(e)}var ir=null
function getChunk(e,t){whenConnected(function(){if(ir){ir.chunk_ids.push(e)
ir.cbs.push(t)
if(ir.chunk_ids.length>=64)ir=null
return}var a=ir={chunk_ids:[e],cbs:[t]}
Ne.addBatchedSend(function(){ir=null
if(!Ne.omp){for(var e=0;e<a.cbs.length;++e)a.cbs[e]("ERR_DISCONNECTED")
return}qt.send("vd_get",a.chunk_ids,function(e,t){for(var r=0;r<a.cbs.length;++r)a.cbs[r](e,t&&t[r])})})})}function worldResync(){console.log("World out of sync, resyncing...")
Ve.push(be.STATUSMSG_OUT_OF_SYNC)
worldCommOnURLChange(true)}a.register({cmd:"world_resync",access_show:["hidden"],func:worldResync})
function worldGetTile(e,t,r,a){whenConnected(function(){qt.send("vd_get_tile",[e,t,r?1:0],function(e,t){a(e,t)
if("ERR_UNSPOILED_CHUNK"===e)worldResync()})})}function worldSetUserData(e,t,r){qt.send("set_user",{key:e,value:t},r)}function transDelay(e){if(o.defines.TRANSDELAY)setTimeout(e,Yt)
else e()}function getUserData(e,t){F(Ne.omp)
transDelay(function(){qt.send("get_user",e,t)})}function worldSend(e,t,r){qt.send(e,t,r)}function worldPak(e){return qt.pak(e)}function getVoxel(e,t,r){F(Ne.omp)
transDelay(function(){qt.send("get_vox",{chunk_id:e,pos_idx:oe(t)},r)})}var or=function(){var t=new Int32Array(3)
var r=O()
return function itemAnimFromTransFn(e){if(e.target_type===M){if(!ht.chunk_map[e.target_chunk_id])return
mt(t,e.target_chunk_id,e.target_pos)
e.target=t}if(e.src_type===M){if(!ht.chunk_map[e.src_chunk_id])return
mt(r,e.src_chunk_id,e.src_pos)
e.src=r}else je(e.src)
Oe.add(e)}}()
function transOpApply(e,t,r,a){switch(e){case ee:var i=t.get(r)
var o=i[1]
var n=i[2]
var s=i[3]
var l=i[4]
var c=i[6]
var _=1&l
var u=2&l
for(var d=0;d<c;++d){var f=n+d
var v=ie(f)
if(_&&!u)if(s!==yt(o,v,0,_))Tt(o)
Lt(o,v,s,_)
ve(o,f)}It(o)
break
case $:var h=t.get(r)
var p=h[1]
var m=h[2]
var g=ie(m)
var E=h[3]
var y=h[4]
var T=1&y
if(T&&!(2&y))if(E!==yt(p,g,0,T))Tt(p)
Lt(p,g,E,T)
ve(p,m)
It(p)
break
case Z:var I=t.get(r)
var S=I[1]
var A=I[3]
var w=I[4]
var L=ie(w)
var R=gt(A,L)
if(R)Oe.setLastModProp(R)
if(S){var x=false
if(clearExpected(A,w))x=true
var O=He.fromJSON(JSON.parse(S),R)
if(R)if(j(R.size,O.size)&&R.draw===O.draw)At(A,L,O)
else{St(A,L)
wt(A,L,O)}else wt(A,L,O)
if(x)if(Et([A,w])!==qe)refreshProp(O,A,L)}else if(R)St(A,L)
ve(A,w)
It(A)
break
case K:var b=t.getPropMod(r)
var N=ie(b.pos_idx)
var C=gt(b.chunk_id,N)
if(C&&C.item_id===b.item_id){if(!checkExpectedPropMod(t.get(r))){C.applyFieldMod(b.field,b.new_value)
if(!C.in_list_mod){C.in_list_mod=true
a.push(C)}}C.version=b.version}It(b.chunk_id)
break
case H:F(!Ne.omp)
break
case V:case q:var M=t.getInvMod(r)
var D=false
if(e===q){It(M.prop_chunk_id)
if(checkExpectedPropInvMod(t.get(r)))D=true}Ae.applyTransactionOp(M,D)
if(M.cb)M.cb()
break
case z:case Q:F(false)
break
case Y:if(checkExpectedItemAnim(t.get(r)))break
var P=t.getItemAnim(r)
if(W(P))or(P)
break
case X:F(false)
break
case J:var k=t.get(r)
F.equal(k.length,4)
var B=k[1]
var U=k[2]
var G=k[3]
Be(G,B,U)
break
default:F(false)}}function transSetApply(e){var t=[]
for(var r=0;r<e.numTransactions();++r){var a=e.get(r)
for(var i=0;i<a.numOps();++i)transOpApply(a.get(i)[0],a,i,t)
F(!a.cbs)}for(var o=0;o<t.length;++o){var n=t[o]
n.in_list_mod=false
if(!n.removed)n.updateDrawable()}}function refreshInventory(e,r){var t=e===P?"inventory":"equip"
var a=e===P?Re:Le
if(Ae.locked(a)){F(!r)
return}function onData(e,t){if(!Ae.locked(a)){F(!r)
return}if(e){console.error("Error refreshing inventory",e)
Ae.setLock(a,false)}else{F(t)
Ae.reload(a,t,void 0)
console.log("Inventory refreshed.")}if(r)r()}console.log("Refreshing inventory after prediction failure...")
Ae.setLock(a,true)
whenConnected(function(){if(!Ne.omp)return
getUserData(t,onData)})}a.register({cmd:"inventory_refresh",access_show:["sysadmin"],help:"(Debug) Trigger an inventory refresh",func:function func(e,t){refreshInventory("equip"===e?D:P,t)}})
a.register({cmd:"inventory_size",help:"(Admin) Show or adjust inventory size",access_run:["sysadmin"],func:function func(e,r){qt.cmdParse("world_inventory_size "+e,function(e,t){if(e)return void r(e)
refreshInventory(P,r)})}})
function refreshProp(n,s,l){if(n&&Ae.locked(n))return
if(n)Ae.setLock(n,true)
console.log("Refreshing prop after prediction failure...")
var c=ht.chunk_map[s]
if(!c)return
var _=c.reused
whenConnected(function(){if(c.reused!==_)return
getVoxel(s,l,function(e,t){if(c.reused!==_)return
if(n)F(Ae.locked(n))
if(e||!t){console.error("Error refreshing prop "+s+" "+l,e)
if(n)Ae.setLock(n,false)}else{var r=yt(s,l,0,false)
var a=t.tile>=qe&&t.tile<=Ke
if(t.prop&&!a){Ve.push(be.STATUSMSG_ORPHANED_PROP)
Rt(Ne.getFrameTransaction(),c,l,qe,false,false,t.tile,true)
a=true}if(!a){if(n){if(gt(n.chunk_id,n.pos)===n)wt(s,l,null)}else if(r>=qe&&r<=Ke);}else{var i=gt(s,l)
if(t.prop)if(i&&i===n&&Array.isArray(t.prop.d)&&n.inv.is_container){n.reloadContents(t.prop.d)
n.version=t.prop.v||1}else{if(i)St(s,l)
var o=He.fromJSON(t.prop)
wt(s,l,o)}else F(!n||!gt(n.chunk_id,n.pos)||t.tile>qe)
if(!t.prop&&t.tile===qe)Rt(Ne.getFrameTransaction(),c,l,0,false,false,t.tile,true)
else if(r!==t.tile)Lt(s,l,t.tile,false)}console.log("Refreshed prop "+s+" "+l+" = "+JSON.stringify(t))}})})}var nr=0
I.trans_in_progress=nr
function worldTransactionsInProgress(){return nr}function transact(E,y){var T=[]
for(var e=0;e<E.numTransactions();++e){var t=true
var r=E.get(e)
r.submitted=true
n("trans_compact_debug",JSON.stringify(r))
r.compact()
n("trans_compact_debug",void 0)
for(var a=0;a<r.numOps();++a){var i=r.get(a)
if(!i.pred){if(i[0]!==X)t=false
continue}if(i[0]===q)er.push(i)
else if(i[0]===Y)rr.push(i)
else if(i[0]===K)tr.push(i)
else t=false}T.push(t)}I.trans_in_progress=nr+=1
function doit(){qt.send("world_trans",E,function(e,t){I.trans_in_progress=--nr
if(e){t=new Array(E.numTransactions())
for(var r=0;r<t.length;++r)t[r]=e
if(E.hasPristineSends()){for(var a in E.pristine_sends)if(!De.hasMegachunkForChunkId(a)){var i=ht.chunk_map[a]
if(i)i.sent_pristine=false}else if(!De.isSpoiledByChunkId(a)){var o=ht.chunk_map[a]
if(o)o.sent_pristine=false}for(var n in E.hexome_choices)De.hexomeChoiceSet(n,null)
for(var s in E.detail_data)ke(s)}}else F.equal(t.length,E.numTransactions())
for(var l=0;l<t.length;++l){var c=t[l]
var _=E.get(l)
if(T[l]&&c){var u=true
for(var d=0;d<_.numOps();++d){var f=_.get(d)
if(f[0]===q){if(checkExpectedPropInvMod(f))u=false}else if(f[0]===Y){if(checkExpectedItemAnim(f))u=false}else if(f[0]===K)if(checkExpectedPropMod(f))u=false}if(u){console.log('Transaction Error "'+c+'" while applying '+JSON.stringify(_)+", but all ops already applied, ignoring.")
c=null}}if(c){console.log('Transaction Error "'+c+'" while applying '+JSON.stringify(_))
if(!_.silent_error)Ve.push(be.$(be.STATUSMSG_TRANSACTION_FAILED,c))}for(var v=0;v<_.numOps();++v){var h=_.get(v)
var p=h.cb
switch(h[0]){case V:case q:h=_.getInvMod(v)
if(c){if(h.pred)if(void 0!==h.prop_chunk_id)refreshProp(gt(h.prop_chunk_id,h.prop_pos),h.prop_chunk_id,h.prop_pos)
else refreshInventory(h.user_inv_type)}else if(!h.pred)if(void 0!==h.prop_chunk_id);else Ae.applyTransactionOp(h)
break
case z:if(c)refreshInventory((h=_.getInvAttrib(v)).user_inv_type)
break
case Q:if(c){h=_.getUserAttrib(v)
nt(h)}break
case Z:if(c)if(h.pred||true){var m=h[3]
var g=ie(h[4])
refreshProp(gt(m,g),m,g)}break
case K:if(c)if((h=_.getPropMod(v)).pred)refreshProp(gt(h.chunk_id,h.pos),h.chunk_id,h.pos)}if(p)p(c)}if(_.cbs)_.callCallbacks(c)}if(y)y(t)})}transDelay(doit)}function onWorldTransApply(e){var t=ae()
t.fromJSON(e)
Ot()
transSetApply(t)
xt()}function onWorldSpoiled(e){F.equal(typeof e,"number")
De.spoil(e)}function onWorldUnspoiled(e){F(Array.isArray(e))
F(e.length)
F.equal(typeof e[0],"number")
for(var t=0;t<e.length;++t){var r=e[t]
De.unspoil(r)
ht.markChunkUnspoiled(r)}bt()}function onWorldDig(e){de(e)}function onWorldSetPos(e){e[3]*=180/Vt
e[4]*=180/Vt
Ne.char_controller.updatePosFromString(String(e),false)}function onWorldSetPosWG(e){Ie()
Ne.char_controller.updatePosFromString(ge({pos:e}),false)}function getHomeWGID(e){var t
if(e)t=e.home
else t=et.get("home")
var r=Ht(t)
if(r&&r.flags&te)return t
return"default"}function onWorldSetAccess(e){var t=fe()
et.setAccessLevel(e.level)
if(!e.level){Ne.chat_ui.addChatError(e.msg||be.CHATERROR_ACCESS_REVOKED)
Ne.returnToMainMenu()}else if(et.worldReadOnly())vt()
else if(Ut())xe()
if(!t&&fe())me(getHomeWGID(null),{})}function sameWorldGuard(e){var t=Xt
return function(){if(t===Xt)e.apply(void 0,arguments)}}function getGemBalance(){var e=h().getMyUserChannel()
if(!e)return 0
return e.getChannelData("public.permissions.owned."+N,0)-e.getChannelData("public.gems_spent",0)}function worldClaimGem(t,e,r){function success(){ct("gems_claimed."+t,1,true)
Ve.push(be.$(be.STATUSMSG_GEM_FOUND,$e))}if(o.defines.GEMTEST)return void success()
if(!h().getMyUserChannel())return
var a=getGemBalance()
var i=qt.pak("gem_claim")
i.writeAnsiString(t)
i.writeInt(e)
i.writeInt(r)
i.send(sameWorldGuard(function(e){Ne.chat_ui.handleCmdParseError(e)
if(!e){le("item_flow",1,null,null,{item:"gem",flow_type:"source",amount:1,context:"gameplay",context_detail:getWorldID()+":"+t,wallet:a})
success()}}))}function getPerm(e){var t
if(h().loggedIn()&&d().connected){var r=h().getMyUserChannel()
t=r.data&&r.data.public}if(!t)t={}
return b.getPerm(t.permissions,e)}function worldGetRoles(){if(qt)return qt.getChannelData("public.clients."+f()+".ids.roles",{})
var e={}
if(getPerm("sysadmin"))e.sysadmin=1
if(getPerm("team"))e.team=1
return e}function worldGetClients(){if(qt)return qt.getChannelData("public.clients",{})
return{}}function startRaceData(e,t){var r={id:e,start:Date.now()+t}
if(zt()&&!dt()){r.was_playing_as=rt()
if(!rt())it(true)}_t("race_data",r)}function stopRaceData(e){if("boolean"!==typeof e){var t=st("race_data")
e=t&&t.was_playing_as}if("boolean"===typeof e&&rt()!==e)it(e)
_t("race_data",null)}function worldBuzzerStart(e){if(qt&&!at()&&Ne.char_controller.forceUpdatePos()){startRaceData(He.trueBuzzerID(e.buzzer_id),0)
var t=e.chunk_id,r=e.pos_idx,a=e.buzzer_id
qt.send("buzzer_start",{chunk_id:t,pos_idx:r,buzzer_id:a},sameWorldGuard(function(e){if(e){if("ERR_NOT_SINGLE_CLIENT"===e){var t=be.STATUSMSG_RACE_NO_MULTIPLE_CLIENTS
var r=be.STATUSMSG_RACE_SINGLE_CLIENT_ENABLE
if(worldGetRoles().world_admin){Ve.get("race_msg").setMessage(t,5e3)
Ve.get("race_msg_2").setMessage(r,5e3)
Ne.chat_ui.addChatError(t+"\n"+r)}else Ve.get("race_msg").setMessage(t)}else Ve.push(be.$(be.STATUSMSG_RACE_START_ERROR,e))
stopRaceData()}}))}}function worldBuzzerAbandon(){if(qt&&!at()&&et.userDataGet("race_data")){qt.send("buzzer_abandon",null,sameWorldGuard(function(e){if(e)Ve.push(be.$(be.STATUSMSG_RACE_ABANDON_ERROR,e))}))
stopRaceData()}}function worldBuzzerSubmit(e,t,r){var a=e.chunk_id,i=e.pos_idx
if(qt&&!at()&&Ne.char_controller.forceUpdatePos()){var o=st("race_data")
var n=o&&o.was_playing_as
qt.send("buzzer_submit",{chunk_id:a,pos_idx:i,score:t},sameWorldGuard(function(e){if(e)y.modalDialog({title:be.DLG_RACE_SAVE_ERROR_TITLE,text:e,buttons:{ok:{cb:L,in_event_cb:!c.touch_mode?c.pointerLockEnter:null}}})
else{stopRaceData(n)
y.modalDialogClear()
r()}}))
_t("race_data",null)}}function worldBuzzerRemove(e,t){var r=e.chunk_id,a=e.pos_idx
if(qt&&!at())qt.send("buzzer_remove",{chunk_id:r,pos_idx:a,user_id:t},sameWorldGuard(function(e){if(e)y.modalDialog({title:be.DLG_RACE_SAVE_ERROR_TITLE,text:e,buttons:{ok:{cb:L}}})
else y.modalDialogClear()}))}function onWorldStartGroupRace(e){if(qt&&!at()){var t=e.user_id===h().loggedIn()
if(ot()&&!t){onWorldSetPosWG(e.wg_pos)
var r=He.trueBuzzerID(e.group_race_id)
startRaceData(r,e.delay)
qt.send("buzzer_start_group_race",r,sameWorldGuard(function(e){if(e){var t=be.CHATERROR_GROUP_RACE_START
Ve.push(be.separateColon(t,e))
Ne.chat_ui.addChatError(t,e)
stopRaceData()}}))}if(ot()||t){var a=0===e.delay?be.STATUSMSG_GROUP_RACE_START:be.$(be.STATUSMSG_GROUP_RACE_START_SECONDS,e.delay/1e3)
Ve.push(a)
Ne.chat_ui.addChat(a)}}}function onWorldEndGroupRace(e){if(!(null!=e&&e.host))worldBuzzerAbandon()
var t=be.STATUSMSG_GROUP_RACE_CANCELLED
Ve.push(t)
Ne.chat_ui.addChat(t)}function onWorldWinnerGroupRace(e){var t
if(e.user_id===h().loggedIn())t=be.STATUSMSG_GROUP_RACE_WON_BY_YOU
else t=be.$(be.STATUSMSG_GROUP_RACE_WON_BY_OTHER,e.display_name||e.user_id,w(e.time))
Ve.push(t)
Ne.chat_ui.addChat(t)}function onWorldUnlockedProp(e){var t=e.id,r=e.attr1,a=e.attr2,i=e.attr3
Ve.push("Unlocked Prop: "+t+", "+r+", "+a+", "+i)}function handleReconnect(){Ct()
De.resubscribe()
if(qt)qt.send("get_user",void 0,sameWorldGuard(function(e,t){if(!e&&t){ut(true)
et.init(t)}}))}var sr=false
function worldRefreshUserData(){if(sr)return
if(qt){var r=Xt
sr=true
console.log("Refreshing user data after prediction failure...")
whenConnected(function(){if(r!==Xt){sr=false
console.log("Refreshing user data after prediction failure: disconnected")
return}qt.send("get_user",void 0,function(e,t){sr=false
if(r!==Xt){console.log("Refreshing user data after prediction failure: disconnected")
return}if(!e&&t){console.log("Refreshing user data after prediction failure: complete")
ut(true)
et.init(t)}else console.log("Refreshing user data after prediction failure: error",e)})})}}var lr
function handleSubscribeFail(e){var t=Kt
lr=true
if("ERR_ACCESS_DENIED_PASS"===e){Jt=true
$t=false}var r=T.get("w")
var a=T.get("wg")
var i=T.get("pos")
Ne.returnToMainMenu()
if("ERR_ACCESS_DENIED_PASS"===e){Ce.enterPasswordInit(t)
return}if("ERR_ACCESS_DENIED"===e)e=be.$(be.DLG_WORLD_ACCESS_DENIED_MSG,h().loggedIn())
if("ERR_SERVER_FULL"===e)e=be.DLG_WORLD_FULL_MSG
var o={title:be.DLG_JOINING_WORLD_FAILED_TITLE,text:e,buttons:{OK:null}}
if(getPerm("sysadmin")&&"ERR_NOT_FOUND"!==e&&!pe()){o.text+="\n\n"+be.DLG_RUN_ELEVATE_MSG
o.buttons["/elevate"]=function(){Ne.chat_ui.cmdParse("elevate",function(e){if(e)return
T.setMulti({w:r,wg:a||"",pos:i||""})
worldCommOnURLChange()})}}y.modalDialog(o)}function handleSubscribe(e){Qt=false
F(e&&e.public&&e.public.seed)
Wt(Kt,e.public)
n("modapi_cdata",e.public.modapi_continent_data?1:0)
if(Gt().reset);if(e.public.owner.user_id&&e.public.owner.user_id===h().loggedIn()&&!e.public.frozen){var t=Kt
if(!_.get("did_share_url_"+Kt)&&!window.FBInstant&&!l()&&!r)setTimeout(function(){if(t!==Kt)return
if(!Je()){_.set("did_share_url_"+Kt,1)
Qe("share_url")}},6e4)}if(window.FBInstant)setTimeout(function(){Qe("fb_share")
Se()},100)}var cr=/^public\.clients(?:\.|$)/
function onWorldChannelData(e,t,r){if(!Pt.world_data)return
if(!t&&e&&e.public||t&&!t.match(cr))jt(e.public)}function joinWorld(e,o,n,s){if(!d().connected){Ve.push(be.STATUSMSG_CANT_JOIN_NOT_CONNECTED)
return}F("string"===typeof e)
le("world_joining",1,null,String(e),{wgid:n})
Jt=false
F(!qt);++Xt
I.is_reconnected=Zt=false
I.world_id=Kt=e
T.setMulti({w:Kt,wg:n})
var l=[]
Ne.startMain(true,function(){ft(Kt)
le("world_joined",1,null,String(Kt),{initial_wgid:n})
ze()
for(var e in l)l[e]()})
lr=false
I.world_channel=qt=h().getChannel("world."+Kt,true)
Ne.chat_ui.setChannel(qt)
Qt=true
qt.on("channel_data",onWorldChannelData)
if(!qt.hasListener("subscribe",handleSubscribe))qt.onceSubscribe(handleSubscribe)
if(!qt.hasListener("subscribe_fail",handleSubscribeFail))qt.on("subscribe_fail",handleSubscribeFail)
qt.send("get_user",void 0,sameWorldGuard(function(e,t){if(e){if(lr)return
return void d().onError(e)}t=t||{}
console.log("my user data for world."+Kt,t)
var r=false
var a=Bt()&&t.access_level>=U
if(0===t.pos_adv&&a){s=true
n=getHomeWGID(t)}if(o&&Ft())t.pos=o
else if(n&&!a){var i=Ht(n)
if(i&&i.flags&G&&(s||n!==t.wg)){r=true
t.pos=ge(i)}}else if(t.wg)T.set("wg",t.wg)
et.init(t)
if(r)Ie()
if(t.race_data)l.push(function(){if(zt()&&!rt())it(true)})
l.push(function(){if(E())ce("enter_first_world",1,null,null,{is_owner:t.access_level===B,world_type:Ut()?"un":"lf"})})}))
Ee(qt)}function worldTargetGo(e){var t=e.wid,r=e.wgid,a=e.uid
if(!t)t=getWorldID()
if("info"===r){worldGoByURL(t,r)
return}var i=Gt()&&t===getWorldID()
if(a&&i&&Ne.char_controller.followUserGo(a));else if(a){Ne.char_controller.setFollowUserOnLoad(a)
T.setMulti({w:"",wg:"",pos:"",u:a,action:"go"})
worldCommOnURLChange()}else if(!i)if(Ne.omp)worldGoByURL(t,r)
else joinWorld(t,null,r,true)
else{if(!r)r="default"
var o=me(r,{})
if(o)Ne.chat_ui.addChatError(o)}}function worldChannelGuard(r){return function(e,t){if(Qt||this!==qt)return
r.call(this,e,t)}}function worldPerfAutoChannel(){if(qt)return qt.channel_id
var e=f()
if(e)return"client."+e
return null}function worldCommStartup(){se("world_details",function(e){e.world_id=getWorldID()})
T.onChange(worldCommOnURLChange)
var t=h()
t.onLogin(function(){var e=p()
if(e)n("user_id",e)})
t.on("disconnect",function(){if(Kt&&g.full_world_resync){$t=Jt=true
Ne.returnToMainMenu()}})
t.on("connect",function(e){if(!t.logging_in)A(ar,ar=[])
if(e){I.is_reconnected=Zt=true
handleReconnect()}})
t.on("login",function(){A(ar,ar=[])})
t.onChannelMsg("world","world_trans_apply",worldChannelGuard(onWorldTransApply))
t.onChannelMsg("world","world_spoiled",worldChannelGuard(onWorldSpoiled))
t.onChannelMsg("world","world_unspoiled",worldChannelGuard(onWorldUnspoiled))
t.onChannelMsg("world","world_unclaimed",worldChannelGuard(Dt))
t.onChannelMsg("world","world_dig",worldChannelGuard(onWorldDig))
t.onChannelMsg("world","world_start_group_race",worldChannelGuard(onWorldStartGroupRace))
t.onChannelMsg("world","world_end_group_race",worldChannelGuard(onWorldEndGroupRace))
t.onChannelMsg("world","world_winner_group_race",worldChannelGuard(onWorldWinnerGroupRace))
t.onChannelMsg("world","world_unlocked_prop",worldChannelGuard(onWorldUnlockedProp))
t.onChannelMsg("world","token_gen",worldChannelGuard(Ue.onTokenGen))
t.onChannelMsg("world","set_pos",worldChannelGuard(onWorldSetPos))
t.onChannelMsg("world","set_pos_wg",worldChannelGuard(onWorldSetPosWG))
t.onChannelMsg("world","set_access",worldChannelGuard(onWorldSetAccess))
De.init(t,worldChannelGuard)
m(worldPerfAutoChannel)}function leaveWorld(){Mt();++Xt
F(qt)
ft()
le("world_leave",1,null,String(Kt))
lt()
Xe()
Te()
Ne.chat_ui.setChannel(null)
De.reset(qt)
h().unsubscribe(qt.channel_id)
_e()
ye()
qt.removeListener("channel_data",onWorldChannelData)
I.world_channel=qt=null
I.world_id=Kt=null
ar=[]
er=[]
tr=[]
if(!worldAutoConnect())T.setMulti({w:"",wg:""})
n("modapi_cdata",0)}function worldCmdParse(r,a){qt.cmdParse(r,function(e,t){if(e)Ne.chat_ui.addChatError(be.$(be.CHATERROR_RUNNING_COMMAND,r,e))
if(a)a(e,t)})}function myUserCmdParse(e,t){if(v())return void t("ERR_DISCONNECTED")
h().getMyUserChannel().cmdParse(e,t)}function myUserCmdParseWrap(r,a){if(v())return void Ne.chat_ui.addChatError(be.$(be.CHATERROR_RUNNING_COMMAND,r,be.ERR_DISCONNECTED))
h().getMyUserChannel().cmdParse(r,function(e,t){if(e=e||!t&&be.CHATERROR_EMPTY_RESPONSE)Ne.chat_ui.addChatError(be.$(be.CHATERROR_RUNNING_COMMAND,r,e))
else return void a(t)})}},{"../common/permissions.js":203,"../common/store_data.js":208,"../common/voxel_data_common.js":209,"../common/world_constants.js":212,"../common/world_trans.js":213,"../glov/client/client_config.js":243,"../glov/client/cmds.js":244,"../glov/client/engine.js":250,"../glov/client/error_report.js":255,"../glov/client/fscreen.js":262,"../glov/client/input.js":271,"../glov/client/local_storage.js":274,"../glov/client/net.js":279,"../glov/client/perf.js":281,"../glov/client/settings.js":291,"../glov/client/subscription_manager.js":303,"../glov/client/ui.js":306,"../glov/client/urlhash.js":307,"../glov/common/util.js":330,"../glov/common/verify.js":331,"../glov/common/vmath.js":332,"./analytics.js":5,"./blueprint.js":24,"./build_mode.js":27,"./client_cmds.js":34,"./client_entities.js":35,"./continent_loader.js":38,"./editvolume_client.js":72,"./energy_well.js":73,"./fbinstant_worlds.js":80,"./inventory.js":94,"./item_anims.js":96,"./localization/localization":108,"./main.js":112,"./main_menu.js":113,"./megachunk_client.js":116,"./menu.js":117,"./mobs.js":120,"./props.js":141,"./social_referral.js":153,"./status.js":156,"./tiles.js":162,"./tutorial.js":166,"./ui_util.js":168,"./user_data.js":170,"./user_party":172,"./voxel_chunk_manager.js":174,"./voxel_data.js":175,"./voxel_mesh.js":178,"./world_claims.js":181,"./world_metadata.js":186,assert:void 0}],183:[function(e,t,r){"use strict"
r.worldInfoLocalCacheGet=worldInfoLocalCacheGet
r.worldInfoLocalCacheUpdate=worldInfoLocalCacheUpdate
var o=e("assert")
var c=e("../glov/client/engine")
var a=e("../glov/client/local_storage")
var n=a.localStorageGetJSON
var _=a.localStorageSetJSON
var u=100
var d=1e3
var f={name:true,waygates:true,world_type:true,seed:true,unlimited:true,gems:true,user_access:true,trophy:true,owner:true,image:true,world_id:true}
var v
function worldInfoLocalCacheGet(e){if(!v){v={need_save:false,last_save:c.frame_timestamp,by_wid:{}}
var t=n("world_info_cache",[])
for(var r=0;r<t.length;++r){var a=t[r]
o(a.world_id)
v.by_wid[a.world_id]={used:c.frame_timestamp,world_info:a}}}var i=v.by_wid[e]
if(i){i.used=c.frame_timestamp
return i.world_info}return null}function worldInfoLocalCacheUpdate(e,t){if(!v)return
var r=v.by_wid
var a=r[e]
if(a){a.used=c.frame_timestamp
for(var i in f)if(a.world_info[i]!==t[i]){a.world_info[i]=t[i]
v.need_save=true}a.world_info.world_id=e}else{var o={}
for(var n in f)o[n]=t[n]
o.world_id=e
r[e]={used:c.frame_timestamp,world_info:o}
v.need_save=true}if(v.need_save&&c.frame_timestamp-v.last_save>d){v.last_save=c.frame_timestamp
var s=Object.keys(r)
s.sort(function(e,t){return r[e].used-r[t].used})
var l=(s=s.slice(0,u)).map(function(e){return r[e].world_info})
_("world_info_cache",l)}}},{"../glov/client/engine":250,"../glov/client/local_storage":274,assert:void 0}],184:[function(e,t,r){"use strict"
r.worldInfoViewInit=worldInfoViewInit
r.cmpWaygateInit=cmpWaygateInit
r.cmpWaygateID=cmpWaygateID
r.accessString=accessString
r.refreshUserInfo=refreshUserInfo
r.refreshUserAndAccessList=refreshUserAndAccessList
r.refreshWorldInfo=refreshWorldInfo
r.worldInfoModifyingAccess=worldInfoModifyingAccess
r.worldCmdParseGated=worldCmdParseGated
r.worldInfoGetContext=worldInfoGetContext
r.worldInfoGetUser=worldInfoGetUser
r.numberFormat=numberFormat
r.toggleLiked=toggleLiked
r.worldInfoToAccessPreset=worldInfoToAccessPreset
r.displayUserList=displayUserList
r.worldGetUserList=worldGetUserList
r.doWorldInfoView=doWorldInfoView
r.PRESET_BUILDER=r.access_items_admin=r.access_items_owner=r.volume_access_items_for_volume_admin=r.volume_access_items_for_volume_owner=r.volume_access_items_for_world_admin=r.FLOATER_STYLE_ROLE_NO_OUTLINE=r.FLOATER_STYLE_ROLE=r.access_labels_for_volumes=r.access_labels=void 0
function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]
for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))e[a]=r[a]}return e}).apply(this,arguments)}var Ie=e("./localization/localization").L
var l=e("../common/roles_common").classifyRole
var a=e("./styles.js"),i=a.floater_style_banned,o=a.floater_style_banned_no_outline,n=a.floater_style_default,s=a.floater_style_default_no_outline,c=a.floater_style_spectator,_=a.floater_style_spectator_no_outline,u=a.floater_style_world_admin,d=a.floater_style_world_admin_no_outline,f=a.floater_style_world_owner,v=a.floater_style_world_owner_no_outline,h=a.floater_style_sysadmin_no_outline
var p={NONE:Ie.LBL_ACCESS_NONE_LONG,SPECTATOR:Ie.LBL_ACCESS_SPECTATOR_LONG,READONLY:Ie.LBL_ACCESS_READONLY_LONG,AREABUILDER:Ie.LBL_ACCESS_AREABUILDER_LONG,BUILDER:Ie.LBL_ACCESS_BUILDER_LONG,ADMIN:Ie.LBL_ACCESS_ADMIN_LONG,OWNER:Ie.LBL_ACCESS_OWNER}
r.access_labels=p
var m={READONLY:Ie.LBL_ACCESS_READONLY,BUILDER:Ie.LBL_ACCESS_BUILDER_LONG,ADMIN:Ie.LBL_ACCESS_ADMIN_LONG,OWNER:Ie.LBL_ACCESS_OWNER}
r.access_labels_for_volumes=m
var g={NONE:i,SPECTATOR:c,READONLY:n,AREABUILDER:n,BUILDER:n,ADMIN:u,OWNER:f}
r.FLOATER_STYLE_ROLE=g
var E={NONE:o,SPECTATOR:_,READONLY:s,AREABUILDER:s,BUILDER:s,ADMIN:d,FROZEN_OWNER:v,OWNER:v}
r.FLOATER_STYLE_ROLE_NO_OUTLINE=E
var y=[{name:Ie.LBL_ACCESS_DEFAULT,tag:"DEFAULT"},{name:Ie.LBL_ACCESS_READONLY,tag:"READONLY"},{name:Ie.LBL_ACCESS_BUILDER,tag:"BUILDER"},{name:Ie.LBL_ACCESS_ADMIN,tag:"ADMIN"},{name:Ie.LBL_ACCESS_OWNER,tag:"OWNER"}]
var T=(r.volume_access_items_for_world_admin=y).slice(0,-1)
var I=(r.volume_access_items_for_volume_owner=T).slice(0,-1)
r.volume_access_items_for_volume_admin=I
var S=[{name:Ie.LBL_ACCESS_DEFAULT,tag:"DEFAULT"},{name:Ie.LBL_ACCESS_NONE_BAN,tag:"NONE"},{name:Ie.LBL_ACCESS_SPECTATOR,tag:"SPECTATOR"},{name:Ie.LBL_ACCESS_READONLY,tag:"READONLY"},{name:Ie.LBL_ACCESS_AREABUILDER,tag:"AREABUILDER"},{name:Ie.LBL_ACCESS_BUILDER,tag:"BUILDER"},{name:Ie.LBL_ACCESS_ADMIN,tag:"ADMIN"}]
var A=(r.access_items_owner=S).slice(0,-1);[y,T,I,S,r.access_items_admin=A].forEach(function(e){for(var t in e)e[t].style=g[e[t].tag]})
var w="private"
var L="public_spectator"
var R="public_readonly"
var x="public_limited"
var O="public_builder"
r.PRESET_BUILDER=O
var Se=[{name:Ie.LBL_ACCESS_PRESET_PRIVATE,name_long:Ie.LBL_ACCESS_PRESET_PRIVATE_LONG,tag:w},{name:Ie.LBL_ACCESS_PRESET_SPECTATE,tag:L},{name:Ie.LBL_ACCESS_PRESET_VISIT,tag:R},{name:Ie.LBL_ACCESS_PRESET_AREA_BUILD,tag:x},{name:Ie.LBL_ACCESS_PRESET_BUILD_ANYWHERE,tag:O}]
var b=Se.slice(0,Se.length-2)
var ae=e("./platform_share_urls").getPlatformWorldShareLink
var N=e("assert")
var C=e("glov-async").asyncSeries
var ie=e("./build_mode.js").doStamina
var Ae=e("../glov/client/engine.js")
var M=e("./fbinstant_worlds.js"),oe=M.fbShareWorld,ne=M.fbShareWorldLink
var D=e("../glov/client/social.js"),we=D.isFriend,Le=D.friendsGet,Re=D.getUserProfileImage
var xe=e("../glov/client/input.js")
var Oe=e("./layout.js").layoutWide
var P=e("../glov/client/link.js").linkText
var be=e("./main.js")
var Ne=be.returnToMainMenu
var k=e("./main_menu.js")
var B=k.deleteWorld,U=k.forgetWorld,G=k.getWorldInfo,Ce=k.isDoingWorldOp
var F=Math.abs,se=Math.ceil,le=Math.floor,Me=Math.max,De=Math.min
var W=e("./menu.js")
var Pe=W.menuX1,ke=W.menuY1,Be=W.isQuickMenu
var j=e("../glov/client/net.js"),H=j.netClient,z=j.netSubs
var V=e("./race_results.js"),Ue=V.doResultList,Ge=V.prepareResultsList
var ce=e("./race_ui.js").raceReady
var Fe=e("../glov/client/scroll_area.js").scrollAreaCreate
var Y=e("../glov/client/selection_box.js").dropDownCreate
var _e=e("./settlement.js").isSettlement
var We=e("./status.js")
var q=e("./stuck.js"),K=q.unstuck,je=q.unstuckBlocked
var X=e("./styles.js"),ue=X.color_gray80,de=X.color_green,Q=X.color_line,J=X.color_user_alternate,$=X.color_user_over,ee=X.color_user_viewing,He=X.color_white,ze=X.colors_green,Ve=X.colors_user_selected,fe=X.label_disabled_style,Ye=X.label_style,qe=X.label_warning_style,Ke=X.loading_style,Ze=X.menu_header_style,Xe=X.sublabel_style,Qe=X.style_gems
var Je=e("../glov/client/ui.js")
var $e=e("./ui_util.js")
var te=e("./user_data.js"),et=te.isPlayAsViewer,tt=te.playAsViewerSet,rt=te.userDataGet,re=te.userDataPredict,ve=te.userHomeSettlementID,he=te.userLastWaygateTime,pe=te.waygateEditAllowed,me=te.worldReadOnly,at=te.worldReadOnlyBypassPlayingAs
var ge=e("./user_info_view.js"),it=ge.viewUser,ot=ge.userInfoGet,nt=ge.userInfoViewing
var Ee=e("../glov/common/util.js"),ye=Ee.nop,Te=Ee.secondsToFriendlyString
var st=e("../glov/client/walltime.js")
var lt=e("../common/waygate_common.js").WAYGATE_NAME_LEN
var ct=e("./waygate_ui.js"),_t=ct.calcWGLinkWidth,ut=ct.waygateLinkUI,dt=ct.waygateEditRemote
var ft=e("./waygate_upgrade.js").WAYGATE_SAFE_TIME
var vt=e("./world_comm.js"),ht=vt.getPerm,pt=vt.getWorldChannel,mt=vt.getWorldID,gt=vt.worldTargetGo,Et=vt.whenConnected,yt=vt.worldCmdParse,Tt=vt.worldGetClients,It=vt.worldGetRoles,St=vt.worldGoByURL,At=vt.worldPak
var wt=e("../common/world_constants.js"),Lt=wt.ACCESS_SPECTATOR,Rt=wt.ACCESS_READONLY,xt=wt.ACCESS_AREA_BUILDER,Ot=wt.ACCESS_BUILDER,bt=wt.ACCESS_ADMIN,Nt=wt.ACCESS_OWNER,Ct=wt.ACCESS_NONE_HIGH,Mt=wt.ACCESS_TO_STRING,Dt=wt.ACCESS_FROM_STRING,Pt=wt.CHAT_COOLDOWN_MAXIMUM,kt=wt.CHAT_COOLDOWN_MINIMUM,Bt=wt.WAYGATE_FLAG_LISTED,Ut=wt.WORLD_ACCESS_NONE,Gt=wt.WORLD_ACCESS_MODIFY_LIMITED,Ft=wt.WORLD_ACCESS_MODIFY_BUILDER
var Wt=e("./world_metadata.js"),jt=Wt.adventureMode,Ht=Wt.worldMetadata,zt=Wt.worldRaceAsVisitor
var Vt=e("./analytics.js"),Yt=Vt.logEvent,qt=Vt.logEventOnce
var Kt
var Zt
var Xt
var Qt
var Jt
function worldInfoViewInit(e){Jt=e
Kt=false
Qt=Zt=null}function isRecentWorld(e){var t
if(z().loggedIn()&&H().connected){var r=z().getMyUserChannel()
t=r.data&&r.data.public}if(!t)t={}
return(t.recent||{})[e]}var $t
var er
function cmpWaygateInit(e,t){er=e
$t=t}function cmpWaygateID(e,t){if(e===$t)return-1
else if(t===$t)return 1
if("default"===e)return-1
else if("default"===t)return 1
var r=er[e]
var a=er[t]
var i=r&&r.flags&Bt||0
var o=(a&&a.flags&Bt||0)-i
if(o)return o
var n=Number(e)
var s=Number(t)
if(isFinite(n)){if(isFinite(s))return n-s
return 1}else if(isFinite(s))return-1
return e<t?-1:1}var tr=[{name:Ie.LBL_ACCESS_SPECTATOR_ANYONE,tag:"SPECTATOR",level:Lt},{name:Ie.LBL_ACCESS_AREABUILDERS,tag:"AREABUILDER",level:xt},{name:Ie.LBL_ACCESS_BUILDERS,tag:"BUILDER",level:Ot},{name:Ie.LBL_ACCESS_ADMINS,tag:"ADMIN",level:bt},{name:Ie.LBL_ACCESS_OWNER,tag:"OWNER",level:Nt},{name:Ie.LBL_ACCESS_NONE_NOBODY,tag:"NONE",level:Ct}]
var rr=[{name:Ie.LBL_ACCESS_SPECTATOR_ANYONE,tag:"SPECTATOR",level:Lt},{name:Ie.LBL_ACCESS_READONLY_VIEWERS,tag:"READONLY",level:Rt},{name:Ie.LBL_ACCESS_AREABUILDERS,tag:"AREABUILDER",level:xt},{name:Ie.LBL_ACCESS_BUILDERS,tag:"BUILDER",level:Ot},{name:Ie.LBL_ACCESS_ADMINS,tag:"ADMIN",level:bt}]
var ar=[{name:Ie.LBL_ACCESS_AREABUILDERS,tag:"AREABUILDER",level:xt},{name:Ie.LBL_ACCESS_BUILDERS,tag:"BUILDER",level:Ot},{name:Ie.LBL_ACCESS_ADMINS,tag:"ADMIN",level:bt},{name:Ie.LBL_ACCESS_OWNER,tag:"OWNER",level:Nt},{name:Ie.LBL_ACCESS_NONE_NOBODY,tag:"NONE",level:Ct}]
var ir=[{name:Ie.LBL_USER_DISTANCE_NEAR,tag:240},{name:Ie.LBL_USER_DISTANCE_MEDIUM,tag:480},{name:Ie.LBL_USER_DISTANCE_FAR,tag:960},{name:Ie.LBL_USER_DISTANCE_UNLIMITED,tag:0}]
var or=[{name:Ie.LBL_TIME_DYNAMIC,tag:-1},{name:Ie.LBL_TIME_MIDNIGHT,tag:0},{name:Ie.LBL_TIME_DAWN,tag:5.7},{name:Ie.LBL_TIME_MORNING,tag:10},{name:Ie.LBL_TIME_NOON,tag:12},{name:Ie.LBL_TIME_AFTERNOON,tag:16},{name:Ie.LBL_TIME_DUSK,tag:20.2}]
function accessString(e){return Mt[e]||"InvalidAccess"+e}var nr=_extends({},Dt,{FROZEN_OWNER:bt-1,UNKNOWN:999})
var sr={NONE:Ie.LBL_ACCESS_NONE.lower(),SPECTATOR:Ie.LBL_ACCESS_SPECTATOR.lower(),READONLY:Ie.LBL_ACCESS_READONLY.lower(),AREABUILDER:Ie.LBL_ACCESS_AREABUILDER.lower(),BUILDER:Ie.LBL_ACCESS_BUILDER.lower(),ADMIN:Ie.LBL_ACCESS_ADMIN.lower(),FROZEN_OWNER:Ie.LBL_ACCESS_OWNER_CREATOR.lower(),OWNER:Ie.LBL_ACCESS_OWNER.lower()}
var lr=Ie.reactive(function(){var e=""
for(var t in sr){var r=sr[t].toString()
if(r.length>e.length)e=r}return Ie.FORMAT_ROLE_DISPLAY.$({val:e}).toLocalString()})
var cr
function refreshUserInfo(){if(!Zt)return
var i=Zt
cr=true
Et(function(){if(!pt()){cr=false
return}var e=At("get_access")
e.writeAnsiString(i)
e.send(function(e,t){cr=false
if(e)return void be.chat_ui.addChatError(e)
var r=t.readInt()
var a=t.readAnsiString()
if(i!==Zt)return
Xt.access_from_default=r
Xt.access=a
Xt.rank=nr[a]})})}var _r
function refreshAccessList(){_r=true
Et(function(){if(!pt()){_r=false
return}At("get_access_list").send(function(e,t){_r=false
if(e)return void be.chat_ui.addChatError(e)
var r=t.readAnsiString()
var a=t.readJSON()
var i=t.readInt()
var o=t.readInt()
Qt={default_level:r,access_map:a,builder_count:i,builder_limit:o}})})}function refreshUserAndAccessList(){refreshUserInfo()
refreshAccessList()}var ur=false
function refreshWorldInfo(){G(Jt,ur=true,1,function(){ur=false})}function worldInfoModifyingAccess(){return ur}function worldCmdParseGated(e,t){N(t)
if(!pt()){Je.modalDialog({title:Ie.DLG_ERR_LOST_CONNECTION_TITLE,text:Ie.DLG_ERR_LOST_CONNECTION_MSG,buttons:{OK:null}})
return}ur=true
yt(e,function(e){ur=false
if(e)Je.modalDialog({title:Ie.DLG_ERR_MODIFYING_WORLD_TITLE,text:e,buttons:{OK:null}})
t(e)})}function cmpRank(e,t){return t.rank-e.rank}function worldInfoGetContext(e){if(!e)return{}
if(e!==Jt)worldInfoViewInit(e)
var t=G(Jt,true,3e3)
if(!t)return{}
var r=t.owner,a=t.frozen
var i=!a&&r&&r.user_id===z().loggedIn()
var o=a&&r&&r.user_id===z().loggedIn()
var n=false
var s=0
if(e===mt()){s=(n=It().world_admin)?nr[l(It(),false)]:0
if(n&&!Qt&&!_r)refreshAccessList()}return{world_info:t,am_admin:n,frozen:a,mine:i,mine_frozen:o,my_role_rank:s}}function worldInfoSelectUser(e,t){Zt=e
Xt={display_name:t,rank:nr.UNKNOWN}
refreshUserInfo()}function worldInfoGetUser(e,t,r){var a=_r
if(!e.am_admin)return{loading:a,allow_actions:false}
if(t!==Zt)worldInfoSelectUser(t,r)
return{loading:a=a||cr||ur,allow_actions:e.my_role_rank>Xt.rank,access:Xt.access,access_from_default:Xt.access_from_default}}function numberFormat(e,t){if(e<1e3)return String(e)
if((e/=1e3)<99.9)return Ie.$(Ie.FORMAT_NUMBER_THOUSAND,e.toFixed(1))
else if(e<999)return Ie.$(Ie.FORMAT_NUMBER_THOUSAND,e.toFixed(0))
return Ie.$(Ie.FORMAT_NUMBER_MILLION,(e/=1e3).toFixed(1))}function toggleLiked(e){var t=rt("liked")?0:1
re("liked",t,true)
if(t)e.like=(e.like||0)+1
else e.like--
Et(function(){if(!pt())return
yt("world_like "+t)})}function exitMenuAndGo(e,t){be.menuExit()
gt({wid:e,wgid:t})}function promptWaygateSickness(e){Je.modalDialog({title:Ie.DLG_WG_TRAVEL_UNSAFE_TITLE,text:Ie.$(Ie.DLG_WG_TRAVEL_UNSAFE_MSG,$e.STAMINA_SYMBOL),buttons:{yes:e,no:null}})}function promptWaygateGroupRaceCancel(e){Je.modalDialog({title:Ie.DLG_WG_TRAVEL_NOT_ALLOWED_TITLE,text:Ie.DLG_WG_TRAVEL_NOT_ALLOWED_MSG,buttons:{yes:e,no:null}})}function lineSep(e,t,r){Je.drawLine(e-40,t,e+40,t,r+.1,2,1,Q)
return 8}var dr=120
var fr=48
function worldInfoToAccessPreset(e){var t=e.access_modify,r=e.access_public,a=e.access_viewer
if(r)if(t>=Ft)return O
else if(t>=Gt)return x
else if(a)return R
else return L
else return w}function itemIndex(e,t){for(var r=0;r<e.length;++r)if(e[r].tag===t)return r
return 0}var vr=2.5*dr
function doAccessDropdown(e,t,r,a,i){var o=e.access_modify,n=e.access_public,s=e.access_viewer
var l=e.unlimited?Se:b
if(!t)t=Y({z:Z.UI,width:vr,auto_reset:false,entry_height:fr,display:i})
if(!ur&&!t.dropdown_visible){var c=worldInfoToAccessPreset(e)
t.selected=itemIndex(l,c)}t.run({x:r,y:a,items:l,disabled:ur})
if(t.was_clicked&&!ur){var _=t.getSelected().tag
var u=[]
switch(_){case w:break
case L:if(o!==Ut||s)u.push(worldCmdParseGated.bind(null,"world_access default SPECTATOR"))
break
case R:if(o!==Ut||!s)u.push(worldCmdParseGated.bind(null,"world_access default READONLY"))
break
case x:if(o!==Gt)u.push(worldCmdParseGated.bind(null,"world_access default AREABUILDER"))
break
case O:if(o!==Ft)u.push(worldCmdParseGated.bind(null,"world_access default BUILDER"))}if(_===w){if(n)u.push(worldCmdParseGated.bind(null,"world_public 0"))}else if(!n)u.push(worldCmdParseGated.bind(null,"world_public 1"))
u.push(refreshWorldInfo)
C(u,ye)}return t}function findCurrentByLevel(e,t){var r=Ht()[e]
var a=0
for(var i=0;i<t.length;++i)if(r>=t[i].level)a=i
return a}function setCurrentByField(e,t,r,a,i){var o=Ht()[e]
var n
for(var s=0;s<r.length;++s){var l=r[s]
if(i===l.tag)n=l[t]}if(n!==o)worldCmdParseGated(a+" "+i,refreshWorldInfo)}var hr=false
function lazyDropdown(e,t,r,a,i,o,n){var s=Je.font
s.drawSizedAligned(Ye,e-8,t,Z.UI,Je.font_height,s.ALIGN.VCENTER|s.ALIGN.HRIGHT,0,fr,r)
if(!a)a=Y({items:i,z:Z.UI,width:2*dr,auto_reset:false,entry_height:fr})
if(!ur&&!a.dropdown_visible){var l=o(i)
a.selected=l}if(a.dropdown_visible)hr=true
a.run({x:e,y:t,disabled:ur})
if(a.was_clicked&&!ur)n(a.getSelected().tag)
return a}var pr
var mr
var gr
var Er=[0,0]
function startScrollArea(e,t,r,a){if(!e.value)e.value=Fe(t)
e.value.begin(a)
N(!pr&&!mr&&!gr)
pr=r
mr=a
var i=(gr=e.value).getScrollPos()
Er[0]=i
Er[1]=Er[0]+mr.h
if(e.last_scroll_pos!==i){Je.suppressNewDOMElemWarnings()
e.last_scroll_pos=i}return 0}function finishScrollArea(e,t){e.value.end(t)
N(pr&&mr)
N(gr===e.value)
var r=pr+mr.h
gr=mr=pr=null
return r}var yr=4
var Tr=8
var Ir=16
function displayUser(e,t,r,a){var i=e.user_id,o=e.display_name,n=e.role,s=e.style
var l=t.x,c=t.y,_=t.w,u=t.z,d=t.font_height,f=t.row_h
var v=(f-d)/2
var h=Je.font
var p=l
var m=l+_/2
var g=c
if(!o){var E=ot(i)
if(E)o=E.display_name}c+=yr
l+=Tr
Ae.font.drawSizedAligned(s,l,c+v,u+1,d,h.ALIGN.HRIGHT|h.ALIGN.HFIT,m-l-Ir,0,o||i)
Ae.font.drawSizedAligned(s,m,c+v,u+1,d,h.ALIGN.HLEFT|h.ALIGN.HFIT,r,0,Ie.$(Ie.FORMAT_ROLE_DISPLAY,sr[n]))
var y=Je.buttonImage(_extends({x:l=m+r+4,y:c,z:u+1,w:f,h:f,colors:nt(i)?Ve:null},Re(i)))
c+=f+yr
var T=Je.button_mouseover
if(Je.buttonShared({x:p,y:g,w:_,h:c-g,pad_focusable:false,rollover_quiet:nt(i)}).ret)y=true
T=T||Je.button_mouseover
if(y)it({x:m,y:c,user_id:i})
if(1&a||T||nt(i))Je.drawRect(p,g,_,c,u-.5,nt(i)?ee:T?$:J)}function displayUserList(e,t){var r=Ae.font.getStringWidth(Ye,t.font_height,lr)
r=De(r,t.w/2-t.row_h-20)
var a=t.y
e.sort(cmpRank)
for(var i=0;i<e.length;++i){displayUser(e[i],t,r,i)
t.y+=t.row_h+2*yr}return t.y-a}function renameWorld(e){Je.modalTextEntry({edit_text:e,title:Ie.LBL_WORLD_NAME,text:Ie.DLG_WORLD_NAME_MSG,max_len:lt,buttons:{ok:function ok(e){worldCmdParseGated("world_name "+(e.trim()||Ie.LBL_NEW_WORLD),refreshWorldInfo)},cancel:null}})}function changeChatCooldown(e){Je.modalTextEntry({edit_text:""+e,title:Ie.LBL_CHAT_SLOW_MODE_COOLDOWN,text:Ie.DLG_CHAT_SLOW_MODE_COOLDOWN_MSG.$({min:kt,max:Pt}),max_len:3,buttons:{ok:function ok(e){worldCmdParseGated("world_chat_cooldown "+e,refreshWorldInfo)},cancel:null}})}var Sr
var Ar
var wr
var Lr
var Rr
var xr
var Or
function editWorldMenu(e,t,r,a,i){var o=e.access_modify,n=e.access_public
var s=Je.font
var l=t+a/2
var c=r
Je.title_font.drawSizedAligned(Ze,l,r,i+1,1.5*Je.font_height,s.ALIGN.HCENTER,0,0,Ie.LBL_WORLD_SETTINGS)
if(Je.buttonText({x:l+2*dr-fr,y:r,z:i,w:fr,h:fr,text:"←",tooltip:Ie.TLTP_DONE_EDITING})||xe.keyDownEdge(xe.KEYS.BACKSPACE))Kt=false
r+=1.5*Je.font_height+8
r+=lineSep(l,r,i)
s.drawSizedAligned(Ye,l-8,r,Z.UI,Je.font_height,s.ALIGN.VCENTER|s.ALIGN.HRIGHT,0,fr,Ie.LBL_WORLD_NAME)
if(Je.buttonText({x:l,y:r,w:2*dr,h:fr,text:e.name,disabled:ur}))renameWorld(e.name)
r+=fr+4
s.drawSizedAligned(Ye,l-8,r,Z.UI,Je.font_height,s.ALIGN.VCENTER|s.ALIGN.HRIGHT,0,fr,Ie.LBL_ACCESS_PRESET)
Sr=doAccessDropdown(e,Sr,l,r)
r+=fr+4
if(n&&o>=Ft)r+=s.drawSizedWrapped(qe,l,r,Z.UI,a/2-8,0,Je.font_height,Ie.WORLDINFO_ANYONE_BUILD_WARNING)+4
if(!jt()){wr=lazyDropdown(l,r,Ie.LBL_FLYING,wr,tr,findCurrentByLevel.bind(null,"access_fly"),setCurrentByField.bind(null,"access_fly","level",tr,"world_fly"))
r+=fr+4}Lr=lazyDropdown(l,r,Ie.LBL_CHAT,Lr,rr,findCurrentByLevel.bind(null,"access_chat"),setCurrentByField.bind(null,"access_chat","level",rr,"world_chat"))
r+=fr+4
s.drawSizedAligned(Ye,l-8,r,Z.UI,Je.font_height,s.ALIGN.VCENTER|s.ALIGN.HRIGHT,0,fr,Ie.LBL_CHAT_SLOW_MODE_COOLDOWN)
var _=pt().getChannelData("public.chat_cooldown",kt)
if(Je.buttonText({x:l,y:r,w:2*dr,h:fr,text:""+_,disabled:ur}))changeChatCooldown(_)
Rr=lazyDropdown(l,r+=fr+4,Ie.LBL_PLACE_BLUEPRINTS,Rr,ar,findCurrentByLevel.bind(null,"access_blueprint"),setCurrentByField.bind(null,"access_blueprint","level",ar,"world_blueprint"))
r+=fr+4
if(!jt()){var u=Ht(),d=u.time_offs,f=u.time_scale
xr=lazyDropdown(l,r,Ie.LBL_TIME_OF_DAY,xr,or,function(e){var t=0
if(!f){var r=Infinity
for(var a=0;a<e.length;++a){var i=e[a]
var o=F(i.tag-d)
if(o<r){r=o
t=a}}}return t},function(e){var t=e||0
if(-1===t){if(!f)worldCmdParseGated("world_time_scale 1 0",refreshWorldInfo)}else if(f||d!==t)worldCmdParseGated("world_time_scale 0 "+t,refreshWorldInfo)})
r+=fr+4}var v=Ht().user_distance
Or=lazyDropdown(l,r,Ie.LBL_SHOW_OTHER_PLAYERS,Or,ir,function(e){var t=0
for(var r=0;r<ir.length;++r){var a=ir[r]
if(v===a.tag)t=r}return t},setCurrentByField.bind(null,"user_distance","tag",ir,"world_user_vis_dist"))
r+=fr+4
r+=8
if(!window.FBInstant){if(!hr)P({x:l,y:r,text:Ie.LBL_MORE_ACCESS_OPTIONS,url:"https://www.reddit.com/r/WorldsFRVR/wiki/worldaccess"})
r+=Je.font_height+12}return r-c}function exitAndUnstuck(){be.menuExit()
K()}var br
var Nr
var Cr
var Mr
var Dr
var Pr
var kr={background_color:null,auto_hide:true}
var Br={whole:{},waygates:{},users:{},results:{}}
function doWaygateList(e,r,t,a,i,o,n){var s=Je.font
var l=i
var c=a+o/2
Je.title_font.drawSizedAligned(Ze,c,i,n+1,1.5*Je.font_height,s.ALIGN.HCENTER,0,0,Ie.LBL_WAYGATES)
i+=1.5*Je.font_height+8
i+=lineSep(c,i,n)
var _=Nr&&!je()
var u=i
if(Dr&&t){var d=7
t.y-=d
t.h+=d
i=startScrollArea(Br.waygates,kr,i,t)
i+=d}var f=true
if(ie()&&Nr){var v=fr
var h=8
var p=600
var m=Je.font_height
var g=he()
var E=st.seconds()
var y=Me(0,E-g)
var T=c+v/2+h
var I=T-v-h
var S=y>ft
f=S
$e.sprite.draw({x:I,y:i,z:n,w:v,h:v,frame:S?$e.CHECK:$e.TIME,color:S?de:He})
var A=c-p/2
var w=I-h-A
if(!S)s.drawSizedAligned(Ye,A,i,n,m,s.ALIGN.HRIGHT|s.ALIGN.HFIT|s.ALIGN.VCENTER,w,v,Te(ft-y+59))
else s.drawSizedAligned(Xe,A,i,n,m,s.ALIGN.HRIGHT|s.ALIGN.HFIT|s.ALIGN.VCENTER,w,v,Ie.$(Ie.FORMAT_READY_WG_TIME,Te(ft)))
s.drawSizedAligned(S?Ye:Xe,T,i,n,m,s.ALIGN.HFIT|s.ALIGN.VCENTER,p/2,v,S?Ie.WORLDINFO_SAFE_WG_TRAVEL:Ie.WORLDINFO_WG_TRAVEL_UNSAFE)
i+=v+h}var L
function visibleWaygate(e){if(!(r[e].flags&Bt)){var t=e===L
if(br&&pe());else if(t);else return false}return true}r=r||{}
var R=Object.keys(r).filter(visibleWaygate)
L=br&&jt()?ve():null
cmpWaygateInit(r,L)
R.sort(cmpWaygateID)
var x=_t(fr)
var O=!e.unlimited&&e.user_access>=Gt
var b=O&&!br
var N=fr+8
var C=le((Er[0]-i)/N)
var M=De(R.length-1,se((Er[1]-i)/N))
i+=(C=Me(0,De(C,R.length-1)))*N
for(var D=C;D<=M;++D){var P=R[D]
var k=r[P]
var B=false
var U=false
var G=P===L
var F="default"===P
if(!(k.flags&Bt))if(br&&pe())U=B=true
else if(G)B=true
var W=0
var j=c-x-8
var H=k.name||P
if(G){var z={x:j-=fr,y:i,w:fr,h:fr,frame:$e.HOME,text:"",tooltip:Ie.TLTP_HOME_SETTLEMENT}
$e.sprite.draw(z)
if(F){z.tooltip=z.tooltip+"\n"+Ie.TLTP_DEFAULT_WAYGATE
var V={x:z.x+z.h/4,y:z.y+z.h/4,w:z.h/2,h:z.h/2,z:Z.UI+1,color:ue,frame:$e.CHECK}
$e.sprite.draw(V)}Je.label(z)
j-=8}else if(F){var Y={x:j-=fr,y:i,w:fr,h:fr,frame:$e.CHECK,tooltip:Ie.TLTP_DEFAULT_WAYGATE,text:"",color:ue}
$e.sprite.draw(Y)
Je.label(Y)
j-=8}s.drawSizedAligned(U?fe:Ye,W,i,Z.UI,Je.font_height,s.ALIGN.VCENTER|s.ALIGN.HRIGHT|s.ALIGN.HFIT,j-W,fr,H)
var q=O&&!G
var K={x:c-x,y:i,z:n,h:fr,target:{wid:Jt,wgid:P},max_grow:.1,no_overlay:true,in_event_cb:xe.pointerLockEnter,url:"w/"+Jt+"/"+P,ctx:"world_info",disabled:q,tooltip:q?Ie.TLTP_WAYGATE_DISABLED_LF:void 0,disabled_focusable:true}
var X=ut(K)
var Q=c-x+K.w+8
var J=dr
var $=br&&jt()&&_e(P)&&!me()
var ee=br&&pe()
if($||ee)J=fr
if(!b){if(Je.buttonText({x:Q,y:i,w:J,h:fr,text:Ie.BTN_WAYGATE_GO,disabled:q,in_event_cb:xe.pointerLockEnter})||X){var te=exitMenuAndGo.bind(null,Jt,P)
if(!f)te=promptWaygateSickness.bind(null,te)
if(ce())te=promptWaygateGroupRaceCancel.bind(null,te)
te()}Q+=J+8}if($||ee){if(Je.buttonImage({x:Q,y:i,w:fr,h:fr,img:$e.sprite,frame:$?$e.HOME:$e.EDIT,tooltip:$?Ie.BTN_SETTLEMENT_INFO:Ie.BTN_EDIT_WG_INFORMATION}))dt(P)
Q+=fr+8}if(B){Je.label({style:fe,x:Q,y:i,w:dr,h:fr,align:s.ALIGN.HVCENTERFIT,text:Ie.WORLDINFO_UNLISTED})
a+=dr+8}else{if(Je.buttonText({x:Q,y:i,w:dr,h:fr,text:Ie.BTN_GET_LINK}))if(window.FBInstant)ne(Jt,P)
else{Je.provideUserString(Ie.DLG_SHARE_WG_TITLE,ae(Jt,P))
Yt("share_link",1,null,String(Jt),{wgid:P})}Q+=dr+8
if(window.FBInstant&&Je.buttonText({x:Q,y:i,w:dr,h:fr,text:Ie.BTN_SHARE}))oe(Jt,P)
Q+=dr+8}i+=N}i+=(R.length-1-M)*N
if(!R.length){Ae.font.drawSizedAligned(Ye,c,i,n+1,Je.font_height,s.ALIGN.HCENTER,0,0,Ie.WORLDINFO_NO_WG_FOUND)
i+=Je.font_height+4}var re
if(Dr){re=i
i=finishScrollArea(Br.waygates,i)}i+=6
if(Dr)i=De(i,u+re)
if(_){if(Je.buttonText({x:c-dr,y:i,w:2*dr,h:fr,text:Ie.BTN_IM_STUCK}))if(ce())promptWaygateGroupRaceCancel(!f?function(){return promptWaygateSickness(exitAndUnstuck)}:exitAndUnstuck)
else if(!f)promptWaygateSickness(exitAndUnstuck)
else exitAndUnstuck()
i+=fr+8}L=null
return(i+=8)-l}function defaultClientIDsToAccessLevel(e){return l(e.roles,false)}function worldGetUserList(e,t,r){var a={}
var i=[]
if(!r){var o=Tt()
for(var n in o){var s=o[n].ids
if(!s||a[s.user_id])continue
var l=s.roles&&s.roles.frozen_owner?"FROZEN_OWNER":t(s)
if(!l)continue
var c=E[l]
if(s.roles&&(s.roles.sysadmin||s.roles.team))c=h
a[s.user_id]=true
i.push({user_id:s.user_id,display_name:s.display_name,role:l,rank:nr[l],style:c})}}var _=[]
for(var u in e){var d=e[u]
if(a[u])continue
a[u]=true
var f=accessString(d.level)
if(r&&"OWNER"!==f)continue
_.push({user_id:u,role:f,rank:nr[f],style:E[f]})}return{online_users:i,offline_users:_}}var Ur={label:Ie.BTN_JOIN_WORLD,pointerlock:true,cb:function cb(e){be.menuExit()
St(Jt,void 0)}}
var Gr={label:Ie.BTN_GET_LINK,cb:function cb(e){if(window.FBInstant)ne(Jt)
else{Je.provideUserString(Ie.DLG_SHARE_TITLE,ae(Jt))
Yt("share_link",1,null,String(Jt))}}}
var Fr={label:Ie.BTN_SHARE,cb:function cb(e){oe(Jt)}}
var Wr={label:Ie.addEllipsis(Ie.BTN_FORGET_WORLD),cb:function cb(e){Je.modalDialog({title:Ie.DLG_FORGET_WORLD_TITLE,text:Ie.$(Ie.DLG_FORGET_WORLD_MSG,e.name,Jt),buttons:{yes:U.bind(null,Jt),no:null}})}}
var jr={label:Ie.addEllipsis(Ie.BTN_DELETE_WORLD),cb:function cb(e){Je.modalDialog({title:Ie.DLG_DELETE_WORLD_TITLE,text:Ie.$(Ie.DLG_DELETE_WORLD_MSG,e.name,Jt),buttons:{yes:B.bind(null,Jt),no:null}})}}
var Hr=200
var zr=200
function doWorldInfoView(e){qt("home_screen",1,"world_info")
Nr=br=e
if(br)Jt=mt()
else if(Jt===mt())Nr=true
var t=Je.button_height
var r=Z.UI
var a=ke()
var i=0
var o=Pe()-i
var n=a-t
var s=t
var l=i
var c=l+o/2
var _=Je.font,u=Je.title_font
var d=48
kr.z=Z.UI
if(br&&!Be())if(Je.buttonText({x:0,y:t,w:Oe()?391:220,font_height:36,text:Oe()?Ie.BTN_EXIT_TO_MAIN_MENU:Ie.BTN_EXIT_WORLD})){Yt("exit_to_main_menu_button",1,"button","worldinfo")
Ne()}var f=worldInfoGetContext(Jt)
var v=f.world_info,h=f.mine,p=f.mine_frozen,m=f.frozen,g=f.am_admin
if(!v){_.drawSizedAligned(Ke,i,t,r,Je.font_height,_.ALIGN.HVCENTER,o,2*n/3,Ie.WORLDINFO_LOADING)
return}if(v.err){_.drawSizedAligned(Ke,i,t,r,Je.font_height,_.ALIGN.HVCENTER,o,2*n/3,Ie.$(Ie.WORLDINFO_LOADING_ERROR,v.err))
return}var E=v.owner,y=v.waygates,T=v.access_modify
if(ut({x:c-_t(Hr),y:s,h:Hr,target:{wid:Jt},style:"preview",overlay_mode:true,overlay_title:false,overlay_users:false,disabled:Nr,in_event_cb:xe.pointerLockEnter,url:"w/"+Jt,ctx:"world_info_header"})){be.menuExit()
St(Jt,void 0)}var I=s+Hr
var S=450
var A=u.drawSizedAligned(Ze,c,s+=16,r+1,1.5*Je.font_height,_.ALIGN.HCENTERFIT,S,0,v.name)
var w=s
s+=1.5*Je.font_height
var L=Ae.font.drawSizedAligned(Xe,c,s,r+1,.75*Je.font_height,_.ALIGN.HCENTERFIT,S,0,Ie.$(Ie.LBL_NUMBERED_WORLD,Jt))
s+=.75*Je.font_height
s+=4
if(h&&Nr)if(Je.buttonImage({x:c+(S+Me(A,L))/2+8,y:w,z:r,img:$e.sprite,frame:$e.EDIT,w:d,h:d,tooltip:Ie.TLTP_RENAME_WORLD,disabled:ur}))renameWorld(v.name)
if(!h)s-=(d-Je.font_height)/2
var R=h?Je.font_height:d
var x=Ae.font.drawSizedAligned(h?Xe:Ye,c,s,r+1,Je.font_height,_.ALIGN.HCENTERFIT|_.ALIGN.VCENTER,S,R,h?Ie.WORLDINFO_THIS_IS_MY_WORLD:Ie.separateColon(m?Ie.LBL_ACCESS_OWNER_CREATOR:Ie.LBL_ACCESS_OWNER,E.display_name||E.user_id))
if(!h){if(Je.buttonImage(_extends({x:c+(S+x)/2+4,y:s,z:r+1,w:d,h:d,colors:nt(E.user_id)?Ve:null},Re(E.user_id)))||xe.click({x:c,y:s,w:S,h:R,button:0}))it({x:c,y:s+d,user_id:E.user_id})
s+=d+4}else s+=Je.font_height+4
var O=v.players||0
if(O&&!br){var b=v.builders||0
var N=O-b
var C=[]
if(b)C.push(Ie.FORMAT_NUMBER_OF_BUILDERS.$({builders:b}))
if(N)C.push(Ie.FORMAT_NUMBER_OF_VIEWERS.$({viewers:N}))
Ae.font.drawSizedAligned(Ye,c,s,r+1,Je.font_height,_.ALIGN.HCENTERFIT,S,0,Ie.separateComma.apply(Ie,C))
s+=Je.font_height+4}var M=[]
for(var D in Le())if(we(D)){var P=ot(D)
var k=P.display_name,B=P.presence_data
if((B&&B.payload&&B.payload.world_id)===Jt)M.push(k)}var U=M.length
if(U){var G=Ie.separateComma.apply(Ie,M)
var F=Ie.WORLDINFO_FRIENDS.$({val:U,names:G})
var W=false
if(F.length>32){W=true
F=Ie.addEllipsis(F.slice(0,29))}Je.label({style:Ye,align:_.ALIGN.HCENTERFIT,x:c+4,y:s,z:r+1,w:S-8,h:Je.font_height,size:Je.font_height,text:F,tooltip:W?G:void 0})
s+=Je.font_height+4}if(v.gems){Ae.font.drawSizedAligned(Qe,c,s,r+1,Je.font_height,_.ALIGN.HCENTERFIT,S,0,Ie.WORLDINFO_HIDDEN_GEMS.$({gems:v.gems,symbol:$e.GEM_SYMBOL}))
s+=Je.font_height+4}var j=v.stats||{}
var H=j.visit_count||0
var z=j.unique||0
var V=j.like||0
var Y=Ie.separateWords(Ie.WORLDINFO_LIKES.$({val:V,short_val:numberFormat(V)}),"•",Ie.WORLDINFO_VIEWS.$({val:H,short_val:numberFormat(H)}),"•",Ie.WORLDINFO_VISITORS.$({val:z,short_val:numberFormat(z)}))
var q=Ae.font.drawSizedAligned(Ye,c,s,r+1,Je.font_height,_.ALIGN.HCENTERFIT,S,0,Y)
var K=c+S/2-vr/2
if(br){var X=c+(S-q)/2-4-d
if(h)X=De(X,K-4-d)
if(Je.buttonImage({x:X,y:s-(d-Je.font_height)/2,z:r+1,w:d,h:d,img:$e.sprite,colors:rt("liked")?ze:null,img_color:He,frame:rt("liked")?$e.LIKE_ACTIVE:$e.LIKE}))toggleLiked(j)}s+=Je.font_height+4
if(!h&&g){Ae.font.drawSizedAligned(Ye,c,s,r+1,Je.font_height,_.ALIGN.HCENTERFIT,S,0,Ie.WORLDINFO_YOU_ARE_ADMIN)
s+=Je.font_height+4}if(m&&ht("sysadmin")){Ae.font.drawSizedAligned(Ye,c,s,r+1,Je.font_height,_.ALIGN.HCENTERFIT,S,0,"(Admin) This world is frozen")
s+=Je.font_height+4}if(h&&Nr){Ar=doAccessDropdown(v,Ar,K,s,{centered:true})
s+=fr+4}else{var Q=worldInfoToAccessPreset(v)
var J=itemIndex(Se,Q)
var $=Se[J].name_long||Se[J].name
Ae.font.drawSizedAligned(Ye,c,s,r+1,Je.font_height,_.ALIGN.HCENTERFIT,S,0,$)
s+=Je.font_height+4}s=Me(s,I)+8
var ee=[]
if(!Nr){ee.push(Ur)
ee.push(Gr)}if(window.FBInstant)ee.push(Fr)
if(!h&&!p&&isRecentWorld(Jt)&&!Nr)ee.push(Wr)
if(h&&!Nr)ee.push(jr)
var te=c-((dr+8)*ee.length-8)/2
for(var re=0;re<ee.length;++re)if(Je.buttonText({x:te+re*(dr+8),y:s,z:r,w:dr,h:d,text:ee[re].label,in_event_cb:ee[re].pointerlock?xe.pointerLockEnter:void 0,disabled:Ce()}))ee[re].cb(v)
if(ee.length)s+=d+16
var ae=T<Ft&&!at()&&!jt()
Cr=v.spotlit_buzzer
Mr={x:0,y:s,w:o,h:a-s}
if(ae)Mr.h-=d+8
Dr=Oe()&&br
Pr=Mr.w/(Dr?2:1)
var ie=Fe(kr).barWidth()
c=(Pr-ie)/2
if(!Dr)s=startScrollArea(Br.whole,kr,s,{x:Mr.x,y:Mr.y,w:Mr.w,h:Mr.h})
var oe=false
var ne=false
if(h&&Nr){if(!Kt){ne=true
if(Je.buttonText({x:c-dr,y:s,w:2*dr,h:d,text:Kt?Ie.BTN_DONE_EDITING:Ie.BTN_EDIT_WORLD_SETTINGS})){oe=true
Kt=!Kt}s+=d+4}}else Kt=false
hr=false
var se=Kt&&!oe
if(se)s+=editWorldMenu(v,i,s,Pr-ie,r)
if(!se||!Dr){var le=null
if(Dr){var ce=Nr&&!je()
le={x:Mr.x,y:Mr.y,w:Pr,h:Mr.h}
if(Cr)le.h/=2
if(ne){le.y+=fr+4
le.h-=fr+4}le.y+=1.5*Je.font_height+8+8
le.h-=1.5*Je.font_height+8+8
if(ce)le.h-=fr+6}s+=doWaygateList(v,y,le,i,s,Pr-ie,r)}if(Cr&&(!se||!Dr)){var _e=It().world_owner&&Nr
if(_e)if(Je.buttonText({x:i+Tr,y:s+(1.5*Je.font_height-d)/2,w:zr,h:d,font_height:Je.font_height,text:Ie.BTN_REMOVE_SPOTLIGHT,disabled:ur}))worldCmdParseGated("spotlit_buzzer_remove",refreshWorldInfo)
var ue=Ie.separateColon(Ie.LBL_RESULTS,Cr.d)
var de=1.5*Je.font_height
var fe=2*Tr+zr
var ve=u.getStringWidth(Ze,de,ue)
ve=De(ve,Pr-2*Tr)
if(_e)ve=De(ve,Pr-Tr-fe)
var he=c-ve/2
if(_e&&he<i+fe)he+=fe/2
u.drawSizedAligned(Ze,he,s,r+1,de,_.ALIGN.HCENTERFIT,ve,0,ue)
s+=de+8
s+=lineSep(c,s,r)
var pe=Ge(Cr.st)
if(Dr){var me={x:Mr.x,y:s,w:Pr,h:Mr.y+Mr.h-s}
s+=Ue(Br.results,pe,me)}else s+=Ue(null,pe,{x:l,y:s,w:Pr})}if(Dr)s=startScrollArea(Br.users,kr,s,{x:Mr.x+Pr,y:Mr.y,w:Pr,h:Mr.h})
if(br){if(!g)Zt=null
u.drawSizedAligned(Ze,c,s,r+1,1.5*Je.font_height,_.ALIGN.HCENTER,0,0,Ie.$(Ie.LBL_WHO_IS_HERE,O))
s+=1.5*Je.font_height+8
s+=lineSep(c,s,r)
if(g&&Qt&&Qt.builder_limit&&Qt.builder_limit-Qt.builder_count<10){var ge=Qt.builder_count>=Qt.builder_limit
_.drawSizedAligned(ge?qe:Ye,c,s,r+1,Je.font_height,_.ALIGN.HCENTER,0,0,Ie.$(Ie.WORLDINFO_ASSIGNED_ROLES,Qt.builder_count+1,Qt.builder_limit+1))
s+=Je.font_height+8}var Ee=worldGetUserList(Qt&&Qt.access_map,defaultClientIDsToAccessLevel,false),ye=Ee.online_users,Te=Ee.offline_users
s+=displayUserList(ye,{x:0,y:s,w:Pr,z:r,font_height:Je.font_height,row_h:fr})
if(Te.length){u.drawSizedAligned(Ze,c,s+=8,r+1,1.5*Je.font_height,_.ALIGN.HCENTER,0,0,Ie.LBL_OFFLINE_USERS)
s+=1.5*Je.font_height+8
s+=lineSep(c,s,r)
s+=displayUserList(Te,{x:0,y:s,w:Pr,z:r,font_height:Je.font_height,row_h:fr})}}if(Dr)s=finishScrollArea(Br.users,s)
else s=finishScrollArea(Br.whole,s)
c=Mr.x+Mr.w/2
if(br&&!rt("race_data")&&zt())if(ae){if(Je.buttonText({x:i+o/2-dr,y:a-d,w:2*dr,h:d,text:et()?Ie.BTN_PLAYING_AS_VISITOR:Ie.BTN_PLAYING_AS_SELF,in_event_cb:et()?null:xe.pointerLockEnter})){tt(!et())
if(et()){We.push(Ie.STATUSMSG_PLAYING_AS_VISITOR)
be.menuExit()}}}else if(et())tt(false)}},{"../common/roles_common":206,"../common/waygate_common.js":210,"../common/world_constants.js":212,"../glov/client/engine.js":250,"../glov/client/input.js":271,"../glov/client/link.js":273,"../glov/client/net.js":279,"../glov/client/scroll_area.js":289,"../glov/client/selection_box.js":290,"../glov/client/social.js":296,"../glov/client/ui.js":306,"../glov/client/walltime.js":308,"../glov/common/util.js":330,"./analytics.js":5,"./build_mode.js":27,"./fbinstant_worlds.js":80,"./layout.js":99,"./localization/localization":108,"./main.js":112,"./main_menu.js":113,"./menu.js":117,"./platform_share_urls":130,"./race_results.js":143,"./race_ui.js":144,"./settlement.js":148,"./status.js":156,"./stuck.js":159,"./styles.js":160,"./ui_util.js":168,"./user_data.js":170,"./user_info_view.js":171,"./waygate_ui.js":179,"./waygate_upgrade.js":180,"./world_comm.js":182,"./world_metadata.js":186,assert:void 0,"glov-async":void 0}],185:[function(e,t,r){"use strict"
r.worldInitStart=worldInitStart
r.worldInitTick=worldInitTick
var i=e("assert")
var a=e("../glov/common/vmath")
var d=a.v2add
var v=a.v3add
var f=a.v3iFloor
var h=a.v3set
var p=a.vec2
var m=a.vec3
var g=e("../common/globals").ID_FACTOR
var o=e("../common/ids")
var E=o.ITEM_PLANT
var n=o.ITEM_TORCH
var y=o.ITEM_WAYGATE
var T=o.TYPE_BLOCK
var I=o.TYPE_ITEM
var s=e("../common/materials_common").Mat
var S=e("../common/waygate_common").FLAT_SEED_EMPTY
var A=e("../common/world_trans").createTransSet
var l=e("./continent_loader").continentLoaderWhenReady
var w=e("./items").createItem
var L=e("./main")
var c=e("./proc_gen_biomes")
var R=c.getHexome
var x=c.getVerticalSliceById
var O=c.getVerticalSliceWorldPos
var _=e("./proc_gen_constants").HEX_HEIGHT
var b=e("./proc_gen_hydro").initPhase37
var N=e("./props")
var u=e("./tiles")
var C=u.TILE_INTANGIBLE
var M=u.TILE_PROP_BASE
var D=u.TILE_PROP_MAX
var P=u.TILE_STONE_LIGHT
var k=e("./voxel_data")
var B=k.andGetLiquid
var U=k.andGetProp
var G=k.getPropLocalExact
var F=k.getTileLocal
var W=k.getTileRelative
var j=k.localPosFromWorldPos
var H=k.posPairFromLocalIntPos
var z=k.transPropRemove
var V=k.transSetPropLocal
var Y=k.transSetTileLocal
var q=e("./world_comm")
var K=e("./world_comm")
var Z=K.getWorldChannel
var X=K.transact
var Q=K.worldSend
var J=e("./world_metadata")
var $=J.adventureMode
var ee=J.worldMetadata
var te=Math.abs,re=Math.cos,ae=Math.sin,ie=Math.PI
var oe=[-1,1,-g,g]
function searchHexome(e,t){var r=R(e)
if(t>=1){var a=r.params.spawn_weight
if(a>=0||2===t)return[O(r.pos_world).vsid,a]
return null}b(r)
if(!r.hydro_paths||r.river_mouth)return null
var i=null
var o=-Infinity
for(var n=0;n<r.hydro_paths.length;++n){var s=r.hydro_paths[n]
for(var l=0;l<s.length;++l){var c=x(s[l][3])
var _=c.mid_elevation
var u=c.owner_hexome.params.spawn_weight
if(u<=0)continue
if(_<=c.owner_hexome.water_level)continue
var d=0
var f=c.vsid
for(var v=0;v<oe.length;++v){var h=f+oe[v]
var p=x(h)
d+=te(p.mid_elevation-_)}var m=u-.03*d
if(m>o&&d<10){i=f
o=m}}}return i?[i,o]:null}var ne=[[1,0],[0,-1],[-1,0],[0,1],[1,0]]
var se=p(10,10)
function findGoodSpawn(e){var t=p()
var r=R(se[0]+se[1]*g).continent
if(!r)return 0
r.getMidpointHexomePos(t)
var a=p()
var i={}
var o=0
function walkSearch(){d(t,t,ne[o])
d(a,t,ne[o+1])
if(!i[a.join()])o=(o+1)%4}var n=null
var s=0
var l=0
do{var c=t[0]+t[1]*g
var _=t.join()
i[_]=true
console.log("Searching Hexome "+c+" for good spawn...")
var u=searchHexome(c,e)
if(u){++l
console.log("Hexome "+c+", VS "+u[0]+" valid, weight="+u[1])
if(!n||u[1]>n[1]||u[1]===n[1]&&u[0]<n[0])n=u}walkSearch()
if(5e3===++s)return-1}while(l<10)
return n[0]}var le
var ce
var _e
var ue
function waitForContinent(){return 7}function findSpawn(e){var t=Date.now()
if(-1===(le=findGoodSpawn(0)))if(Z().getChannelData("public.modapi_continent_data")){console.error("Unable to find good spawn, using fallback for mod-api provided continents")
if(-1===(le=findGoodSpawn(1))){console.error("Unable to find bad spawn, using final fallback for mod-api provided continents")
le=findGoodSpawn(2)
i(-1!==le)}}else i(false,"Unable to find valid spawn in new world")
var r=x(le)
if("flat"===ee().world_type)ce=-1
else ce=r.mid_elevation
var a=(_e=m(r.pos_world[0]+7,r.pos_world[1]+7,ce+5)).join()+",0,0"
console.log("Found spawn = "+le+" ("+ce+") in "+(Date.now()-t)+"ms")
ue=findWaygatePos
e(a)
return 6}function worldInitStart(e){ue=waitForContinent
l([se[0]*_*1.5,se[1]*_],1,function(){ue=findSpawn.bind(null,e)})}var de=[[0,0],[0,1],[1,0],[1,1],[-1,0],[-1,1],[2,0],[2,1],[0,-1],[1,-1],[0,2],[1,2]]
var fe=m()
function isSolid(){var e=W(0,fe,-1,false)
i(-1!==e)
if(e&&e<C)return true
return false}function isOpen(){var e=W(0,fe,-1,false)
i(-1!==e)
if((!e||e===M&&U().item_id===E)&&!B())return true
return false}function validWaygatePos(e){var t=e[2]
for(var r=0;r<de.length;++r){d(fe,e,de[r])
fe[2]=t-1
if(!isSolid())return false
fe[2]=t
if(!isSolid()&&!isOpen())return false
for(var a=0;a<4;++a){fe[2]=t+a+1
if(!isOpen())return false}}return true}var ve=[[0,-7,-10,0],[-7,0,-10,3],[0,7,-10,2],[7,0,-10,1]]
var he
var pe
function findWaygatePos(){var e=m()
if("flat"===ee().world_type)h(e,_e[0],_e[1],ce)
else{var t=20
var r=0
var a=false
do{t++
r+=2*ie/11
h(e,_e[0]+re(r)*t,_e[1]+ae(r)*t,ce-10)
f(e)
for(var i=0;i<30;++i){if(validWaygatePos(e)){e[2]++
if(!validWaygatePos(e))e[2]--
a=true
break}e[2]++}}while(!a)}console.log("Found valid waygate position at "+e)
he=e
var o=m()
var n=null
for(var s=0;s<ve.length;++s){v(o,e,ve[s])
for(var l=0;l<30;++l){if(validWaygatePos(o)){var c=te(o[2]-e[2])
if(!n||c<n[1])n=[s,c,o[2]]
break}o[2]++}}var _
var u=0
if(!n){_=v(m(),e,[1,1,5])
pe=0}else{var d=n[0]
_=[e[0]+ve[d][0]+1,e[1]+ve[d][1]+1,n[2]+5]
u=90*d
pe=ve[d][3]}L.char_controller.updatePosFromString(_.join(",")+","+u+",0",false)
ue=placeWaygate
return 5}var me
var ge=[[[0,0,0],null],[[0,1,0],null],[[1,0,0],null],[[1,1,0],null],[[-1,-1,0],{type:T,id:P}],[[0,-1,0],{type:T,id:P}],[[1,-1,0],{type:T,id:P}],[[2,-1,0],{type:T,id:P}],[[2,0,0],{type:T,id:P}],[[2,1,0],{type:T,id:P}],[[2,2,0],{type:T,id:P}],[[1,2,0],{type:T,id:P}],[[0,2,0],{type:T,id:P}],[[-1,2,0],{type:T,id:P}],[[-1,1,0],{type:T,id:P}],[[-1,0,0],{type:T,id:P}],[[-1,-1,1],{type:I,id:n,attr1:s.LIGHT_WOOD}],[[-1,2,1],{type:I,id:n,attr1:s.LIGHT_WOOD}],[[2,2,1],{type:I,id:n,attr1:s.LIGHT_WOOD}],[[2,-1,1],{type:I,id:n,attr1:s.LIGHT_WOOD}]]
function placeWaygate(){var e=m()
j(e,he)
me=H(e)
var t=G(e)
if(t&&t.item_id===y){ue=setMetadata
return 4}var r=A()
var a=r.trans()
var i=$()||"flat"===ee().world_type&&ee().seed===S?ge.length:4
var o=[]
for(var n=0;n<i;++n){var s=ge[n][0]
v(fe,e,s)
var l=F(fe,0,false)
if(l)if(l>=M&&l<=D)if(U().item_id===E)z(a,U(),true)
else o[n]=true
else Y(a,fe,0,false,false,l,true)}var c=N.createFromInv(w({type:I,id:y}))
c.setRot(pe)
V(a,e,c,true,true)
for(var _=0;_<i;++_){var u=ge[_],d=u[0],f=u[1]
if(o[_]||!f)continue
v(fe,e,d)
if(f.type===T)Y(a,fe,f.id,false,false,0,true)
else{c=N.createFromInv(w(f))
V(a,fe,c,true,true)}}ue=waitForPlace
a.onComplete(function(){ue=setMetadata})
X(r)
return 4}function waitForPlace(){return 3}function setMetadata(){var e={wgid:"default",chunk_id:me[0],pos_idx:me[1],rot:pe,is_settlement:Boolean($())}
Q("waygate_set",e,function(e){if(e)console.warn(e)
if(!q.world_channel)return
q.world_channel.pak("world_init_finished").send(function(e){if(e)L.chat_ui.addChatError(e)
ue=stageDone})})
ue=waitForMetadataSet
return 2}function waitForMetadataSet(){return 1}function stageDone(){return 0}function worldInitTick(){return ue()}},{"../common/globals":197,"../common/ids":198,"../common/materials_common":201,"../common/waygate_common":210,"../common/world_trans":213,"../glov/common/vmath":332,"./continent_loader":38,"./items":98,"./main":112,"./proc_gen_biomes":133,"./proc_gen_constants":134,"./proc_gen_hydro":137,"./props":141,"./tiles":162,"./voxel_data":175,"./world_comm":182,"./world_metadata":186,assert:void 0}],186:[function(e,t,i){"use strict"
i.worldUserDistance=worldUserDistance
i.worldMetadata=worldMetadata
i.worldMetadataReset=worldMetadataReset
i.worldMetadataFreePos=worldMetadataFreePos
i.worldPhotoMove=worldPhotoMove
i.worldToolLock=worldToolLock
i.worldMetadataWaygates=worldMetadataWaygates
i.worldMetadataWaygate=worldMetadataWaygate
i.worldAccessExvolume=worldAccessExvolume
i.worldAccessSettlement=worldAccessSettlement
i.worldAccessAreaClear=worldAccessAreaClear
i.worldHasGems=worldHasGems
i.worldRaceAsVisitor=worldRaceAsVisitor
i.worldSpotlitBuzzer=worldSpotlitBuzzer
i.unlimitedMode=unlimitedMode
i.adventureMode=adventureMode
i.worldSeed=worldSeed
i.worldMetadataDefaultWaygatePos=worldMetadataDefaultWaygatePos
i.worldMetadataSet=worldMetadataSet
i.worldMetadataUpdate=worldMetadataUpdate
i.world_data=void 0
var o=e("assert")
var r=e("./client_cmds.js").waygateToPosStr
var a=e("../glov/client/cmds.js").cmd_parse
var n=e("./editvolume_client.js").resetEditVolumes
var s=e("./main.js")
var l=e("./main_menu.js").getWorldInfo
var c=e("./settlement.js").settlementUpdate
var _=e("../glov/client/urlhash.js")
var u=e("../glov/common/util.js").has
var d=e("./voxel_data.js").initModeBasedSettings
var f=e("../common/world_constants.js"),v=f.DEFAULT_ACCESS_EXVOLUME,h=f.DEFAULT_ACCESS_SETTLEMENT,p=f.DEFAULT_ACCESS_AREA_CLEAR,m=f.DEFAULT_RACE_AS_VISITOR_LF,g=f.DEFAULT_RACE_AS_VISITOR_UNL,E=f.WORLD_RACE_AS_VISITOR_AUTO,y=f.WORLD_RACE_AS_VISITOR_ON
var T=e("./world_info_view.js"),I=T.PRESET_BUILDER,S=T.worldInfoToAccessPreset
var A=["name","unlimited","access_fly","user_distance","access_chat","access_exvolume","access_waygate","access_blueprint","access_race_join","access_race_edit","access_settlement","access_area_clear","chat_cooldown","race_as_visitor","free_pos","photo_move","tool_lock","time_offs","time_scale","waygates","gems","spotlit_buzzer","image","reset_id","stats","created"]
var w=A.concat(["seed","world_type","reset","need_init"])
var L
i.world_data=L
function worldUserDistance(){return L.user_distance||Infinity}var R=0
a.registerValue("admin_free_pos",{type:a.TYPE_INT,label:"Local world_free_pos override",range:[0,1],access_run:["sysadmin"],get:function get(){return R},set:function set(e){return R=e}})
var x=0
a.registerValue("admin_photo_move",{type:a.TYPE_INT,label:"Local world_photo_move override",range:[0,1],access_run:["sysadmin"],get:function get(){return x},set:function set(e){return x=e}})
var O=-1
a.registerValue("admin_tool_lock",{type:a.TYPE_INT,label:"Local world_tool_lock override, -1 to disable",range:[-1,3],access_run:["sysadmin"],get:function get(){return O},set:function set(e){return O=e}})
function worldMetadata(){return L}function worldMetadataReset(){i.world_data=L=null}function worldMetadataFreePos(){return R||L&&L.free_pos}function worldPhotoMove(){return x||L&&L.photo_move}function worldToolLock(){return-1!==O?O:L&&L.tool_lock||0}function worldMetadataWaygates(){return L.waygates||{}}function worldMetadataWaygate(e){var t=worldMetadataWaygates()
if(!u(t,e))return null
return t[e]}function worldAccessExvolume(){if(void 0!==L.access_exvolume)return L.access_exvolume
return v}function worldAccessSettlement(){if(void 0!==L.access_settlement)return L.access_settlement
return h}function worldAccessAreaClear(){if(void 0!==L.access_area_clear)return L.access_area_clear
return p}function worldHasGems(){return L.gems||0}function worldRaceAsVisitor(){if(L){var e=void 0!==L.race_as_visitor?L.race_as_visitor:L.unlimited?g:m
var t=l(L.world_id,false)
return e===y||e===E&&t&&S(t)!==I}return false}function worldSpotlitBuzzer(){return L&&L.spotlit_buzzer}function unlimitedMode(){return L&&L.unlimited}function adventureMode(){return L&&!L.unlimited}function worldSeed(){return L.seed}function worldMetadataDefaultWaygatePos(){var e=worldMetadataWaygate("default")
if(!e){console.error("Missing default waygate, going to the origin")
return"0,0,100,0,0"}return r(e)}var b
function worldMetadataSet(e,t){o(t.seed)
i.world_data=L={world_id:e}
for(var r=0;r<w.length;++r){var a=w[r]
L[a]=t[a]}b=L.reset_id
_.refreshTitle()
c(true)
n()
d()}function worldMetadataUpdate(e){for(var t=0;t<A.length;++t){var r=A[t]
L[r]=e[r]}c()
if(L.reset&&L.reset_id!==b){console.error("Returning to main menu due to server reset")
s.returnToMainMenu()}}},{"../common/world_constants.js":212,"../glov/client/cmds.js":244,"../glov/client/urlhash.js":307,"../glov/common/util.js":330,"./client_cmds.js":34,"./editvolume_client.js":72,"./main.js":112,"./main_menu.js":113,"./settlement.js":148,"./voxel_data.js":175,"./world_info_view.js":184,assert:void 0}],187:[function(e,t,r){"use strict"
r.playSound=playSound
var a=e("../glov/client/ui").playUISound
function playSound(e){a(e)}},{"../glov/client/ui":306}],188:[function(e,t,r){"use strict"
r.setSSInstantModState=setSSInstantModState
r.addSSPeriodicModState=addSSPeriodicModState
r.logSSEventModState=logSSEventModState
r.soundscapeSetTag=soundscapeSetTag
r.soundscapeTick=soundscapeTick
r.soundscapeStop=soundscapeStop
r.soundscapeStartup=soundscapeStartup
r.SoundScapeEventMod=r.SoundScapePeriodicMod=r.SoundScapeInstantMod=r.SoundScapeTag=void 0
var a=e("../glov/client/engine.js")
var i=a.onEnterBackground
var o=a.onExitBackground
var n=e("../glov/client/sound.js")
var s=n.fadesCount
var l=n.soundTick
var c=e("../glov/client/soundscape.js").GlovSoundScape
var _=e("../glov/common/util.js")
var g=_.clamp
var u=_.merge
var d=e("./debug.js")
var f=e("./soundscape_data.js").SOUNDSCAPE_DATA
var E=e("../glov/client/engine.js")
var v=Math.PI,h=Math.cos
var p=1e3
var m=1e3
var y
var T;(function(e){e["Home"]="home"
e["Night"]="night"
e["Snow"]="snow"
e["Underground"]="underground"})((r.SoundScapeTag=T)||(r.SoundScapeTag=T={}))
var I=["instant","periodic","event"]
var S;(function(e){e[e["Ambiance"]=0]="Ambiance"
e[e["DistHorizontal"]=1]="DistHorizontal"
e[e["DistVertical"]=2]="DistVertical"
e[e["IsFlying"]=3]="IsFlying"
e[e["MAX"]=4]="MAX"})((r.SoundScapeInstantMod=S)||(r.SoundScapeInstantMod=S={}))
var A;(function(e){e[e["VelHorizontal"]=0]="VelHorizontal"
e[e["VelVertical"]=1]="VelVertical"
e[e["VelFly"]=2]="VelFly"
e[e["O2Attribute"]=3]="O2Attribute"
e[e["MAX"]=4]="MAX"})((r.SoundScapePeriodicMod=A)||(r.SoundScapePeriodicMod=A={}))
var w;(function(e){e[e["Broken"]=0]="Broken"
e[e["BlocksPlaced"]=1]="BlocksPlaced"
e[e["PropsPlaced"]=2]="PropsPlaced"
e[e["PropsInteracted"]=3]="PropsInteracted"
e[e["MAX"]=4]="MAX"})((r.SoundScapeEventMod=w)||(r.SoundScapeEventMod=w={}))
var L={instant:S,periodic:A,event:w}
var R={instant:[{min:-.2,max:.2},{max:.1},{max:.2},{max:.2}],periodic:[{max:.2,period:1e3,expire_time:3e4},{max:.4,period:1e3,expire_time:3e4},{max:.3,period:1e3,expire_time:3e4},{max:.4,period:1e3,expire_time:5e3}],event:[{max:.2,steps:100,expire_time:18e4},{max:.2,steps:150,expire_time:18e4},{max:.2,steps:25,expire_time:18e4},{max:.2,steps:100,expire_time:18e4}]}
function soundScapeModValue(e,t,r){return(r=r||0)+(t-r)*g(e,0,1)}var x=function SoundScapePeriodicModState(e,t,r){this.timestamp=void 0
this.value=void 0
this.value=soundScapeModValue(e,t,r)
this.timestamp=E.frame_timestamp}
var O={instant:[],periodic:[],event:[]}
for(var b=0;b<S.MAX;++b)O.instant[b]=0
for(var N=0;N<A.MAX;++N)O.periodic[N]=[]
for(var C=0;C<w.MAX;++C)O.event[C]=[]
function setSSInstantModState(e,t){O.instant[e]=soundScapeModValue(t,R.instant[e].max,R.instant[e].min)}function addSSPeriodicModState(e,t){var r=O.periodic[e]
if(0===r.length||E.frame_timestamp>r[0].timestamp+R.periodic[e].period){var a=R.periodic[e],i=a.min,o=a.max
r.unshift(new x(t,o,i))}}function logSSEventModState(e){O.event[e].unshift(E.timestamp)}function soundscapeSetTag(e,t){y.setTag(e,t)}var M={instant:{keys:[],intensity:[]},periodic:{keys:[],intensity:[]},event:{keys:[],intensity:[]}}
for(var D=0;D<I.length;++D){var P=I[D]
var k=L[P]
for(var B=Object.keys(k).length/2;B<Object.keys(k).length-1;++B)M[P].keys.push(Object.keys(k)[B])}function soundscapeDebug(){var i=[]
function modTypeLines(e){i.push("    "+e+" Mods:")
for(var t=0;t<O[e].length;++t){var r=M[e].intensity[t].toFixed(5)
var a="["+(R[e][t].min||0)+"; "+R[e][t].max+"]"
i.push("        "+M[e].keys[t]+" = "+r+" / "+a)}}i.push("SoundScape Intensity:")
i.push("    Total: "+y.getIntensity().toFixed(5))
for(var e=0;e<I.length;++e)modTypeLines(I[e])
i.push("")
i.push("SoundScape Tags:")
for(var t in y.tags)i.push("    "+t+" = "+y.tags[t])
i.push("")
i.push("SoundScape Layers:")
var r=y.debug()
for(var a=0;a<r.length;++a)i.push("   "+r[a].text)
i.push("")
d.addText(i.join("\n"))}var U=2e5
var G=0
function ambianceModTick(){if((G+=E.frame_dt)>U)G-=U
var e=G/U*2*v
setSSInstantModState(S.Ambiance,(h(e)+1)/2)}function soundscapeTick(){ambianceModTick()
var e=0
var t=E.frame_timestamp
for(var r=0;r<S.MAX;++r){M.instant.intensity[r]=O.instant[r]
e+=O.instant[r]}for(var a=0;a<A.MAX;++a){var i=0
var o=O.periodic[a]
var n=R.periodic[a].expire_time
for(var s=o.length-1;s>=0;--s)if(o[s].timestamp+n<t)o.pop()
else break
for(var l=o.length-1;l>=0;--l)i+=O.periodic[a][l].value
M.periodic.intensity[a]=i/(o.length||1)
e+=M.periodic.intensity[a]}for(var c=0;c<w.MAX;++c){var _=O.event[c]
var u=R.event[c],d=u.steps,f=u.max,v=u.min,h=u.expire_time
for(var p=_.length-1;p>=0;--p)if(_[p]+h<t)_.pop()
else break
var m=(v=v||0)+_.length*((f-v)/d)
M.event.intensity[c]=g(m,v,f)
e+=M.event.intensity[c]}y.setIntensity(g(e,0,1))
y.tick()
if(E.defines.SOUNDSCAPE)soundscapeDebug()}function soundscapeStop(){y.stopAllLayers(p)}var F=1e3/60
var W
function backgroundSoundTick(){l(F)
if(s())W=setTimeout(backgroundSoundTick,F)}var j=false
function soundscapeStartup(){(y=new c(u({add_all:true,kill_delay:p},f))).setIntensity(0)
i(function(){j=true
y.stopAllLayers(p)
y.forceNoTracks(true)
W=setTimeout(backgroundSoundTick,F)})
o(function(){if(j)j=false
y.forceNoTracks(false)
y.setFadeInTime(m)
if(W)clearTimeout(W)})}},{"../glov/client/engine.js":250,"../glov/client/sound.js":297,"../glov/client/soundscape.js":298,"../glov/common/util.js":330,"./debug.js":62,"./soundscape_data.js":154}],189:[function(e,t,r){"use strict"
r.FBLoginButtonTestGroups=r.FB_LOGIN_BUTTON_TEST=void 0
var a="fb_login_button"
r.FB_LOGIN_BUTTON_TEST=a
var i;(function(e){e[e["Hide"]=1]="Hide"
e[e["Show"]=2]="Show"})((r.FBLoginButtonTestGroups=i)||(r.FBLoginButtonTestGroups=i={}))},{}],190:[function(e,t,r){"use strict"
r.createAsyncDictionary=createAsyncDictionary
var o=e("assert")
var n=e("../glov/common/util.js").callEach
function AsyncDictionary(e){o.equal(typeof e.loader,"function")
this.loader=e.loader
this.max=e.max||0
this.generation=0
this.reset()}AsyncDictionary.prototype.numLoading=function(){return this.num_loading}
AsyncDictionary.prototype.reset=function(){for(var e in this.loading){var t=this.loading[e]
n(t.load_cbs,t.load_cbs=null,"ERR_DICT_RESET")}++this.generation
this.loading=Object.create(null)
this.loaded=Object.create(null)
this.count=0
this.num_loading=0}
AsyncDictionary.prototype.prune=function(){var e
var t=0
for(var r in this.loaded){var a=this.loaded[r]
if(!t||a.dict_lru<t){t=a.dict_lru
e=r}}o(t)
delete this.loaded[e];--this.count}
AsyncDictionary.prototype.startLoading=function(r,a){var i=this;++this.num_loading
this.loader(r,function(e,t){if(a.generation!==i.generation){o(!a.load_cbs)
return}o.equal(i.loading[r],a);--i.num_loading
if(e)a.load_error=e
else{i.loaded[r]=t
delete i.loading[r];++i.count
if(i.max){t.dict_lru=Date.now()
if(i.count>i.max)i.prune()}}n(a.load_cbs,a.load_cbs=null,e,t)})}
AsyncDictionary.prototype.get=function(e,t){var r=this.loaded[e]
if(r){if(this.max)r.dict_lru=Date.now()
return t?t(null,r):r}var a=this.loading[e]
if(!a){a=this.loading[e]={load_cbs:[],load_error:null,generation:this.generation}
this.startLoading(e,a)
if(r=this.loaded[e])return t?t(null,r):r}if(a.load_error)return t?t(a.load_error):null
if(t)a.load_cbs.push(t)
else return null}
AsyncDictionary.prototype.has=function(e){return Boolean(this.loaded[e])}
AsyncDictionary.prototype.set=function(e,t){var r=this.loading[e]
if(r){if(r.load_cbs){n(r.load_cbs,r.load_cbs=null,null,t);--r.generation;--this.num_loading}delete this.loading[e]}if(this.loaded[e])--this.count
this.loaded[e]=t;++this.count
if(this.max){t.dict_lru=Date.now()
if(this.count>this.max)this.prune()}}
function createAsyncDictionary(e){return new AsyncDictionary(e)}},{"../glov/common/util.js":330,assert:void 0}],191:[function(e,t,r){"use strict"
var A=Math.floor
r.makeArray=function(e,t,r,a){var i=e.tiles_per_row,o=e.nudge
var n=A(r.width/i)
var s=[]
if(o)for(var l=o[0];l<=o[1];++l)s[l]=1
var c=n/2
var _=a(n,n*(i*i))
var u=0
for(var d=0;d<i;++d){var f=d*n
for(var v=0;v<i;++v){var h=v*n
var p=u*n
if(t&&!t[u])_.preClearRect(0,p,n,n)
if(s[u]){var m=n/8
for(var g=0;g<2;++g){var E=g*c
var y=f+E
var T=p+E
for(var I=0;I<m;++I)_.drawImage(r,h,y,n,1,0,T+I,n,1)
_.drawImage(r,h,y,n,c,0,T+m,n,2*m)
for(var S=0;S<m;++S)_.drawImage(r,h,y+c-1,n,1,0,T+3*m+S,n,1)}}else _.drawImage(r,h,f,n,n,0,p,n,n);++u}}return _}
function nextHighestPowerOfTwo(e){--e
for(var t=1;t<32;t<<=1)e|=e>>t
return e+1}r.makeAtlas=function(e,t,r,a){var i=e.pad,o=e.tiles_per_row
var n=A(r.width/o)
var s=n+2*i
var l=nextHighestPowerOfTwo(s*o)
var c=a(l,l)
var _=0
for(var u=0;u<o;++u){var d=u*n
var f=u*s
for(var v=0;v<o;++v){var h=v*n
var p=v*s
if(t&&!t[_])c.preClearRect(p,f,s,s)
c.drawImage(r,h+n-i,d+n-i,i,i,p,f,i,i)
c.drawImage(r,h,d+n-i,n,i,p+i,f,n,i)
c.drawImage(r,h,d+n-i,i,i,p+i+n,f,i,i)
c.drawImage(r,h+n-i,d,i,n,p,f+i,i,n)
c.drawImage(r,h,d,n,n,p+i,f+i,n,n)
c.drawImage(r,h,d,i,n,p+n+i,f+i,i,n)
c.drawImage(r,h+n-i,d,i,i,p,f+i+n,i,i)
c.drawImage(r,h,d,n,i,p+i,f+i+n,n,i)
c.drawImage(r,h,d,i,i,p+i+n,f+i+n,i,i);++_}}return c}},{}],192:[function(e,t,r){"use strict"
r.BLUEPRINT_MAX_DIM=r.BLUEPRINT_NAME_LEN=r.bid_valid_editable_regex=r.bid_valid_regex=r.TYPE_READONLY=r.TYPE_EDITABLE=r.STATE_SELF_DESTRUCT=r.STATE_EDIT=r.STATE_PRE_EDIT=r.STATE_BUILD=r.STATE_PRE_BUILD=void 0
var a=0
r.STATE_PRE_BUILD=a
var i=1
r.STATE_BUILD=i
var o=2
r.STATE_PRE_EDIT=o
var n=3
r.STATE_EDIT=n
var s=4
r.STATE_SELF_DESTRUCT=s
var l="E"
r.TYPE_EDITABLE=l
var c="R"
r.TYPE_READONLY=c
var _=/^(?:S\d+_\d+_\d+|[ER][A-Z0-9]+)$/
r.bid_valid_regex=_
var u=/^E[A-Z0-9]+$/
r.bid_valid_editable_regex=u
var d=32
r.BLUEPRINT_NAME_LEN=d
var f=16
r.BLUEPRINT_MAX_DIM=f},{}],193:[function(e,t,r){"use strict"
r.volumeContainsPoint=volumeContainsPoint
r.volumesOverlap=volumesOverlap
r.volumeGetOriginMegaChunkId=volumeGetOriginMegaChunkId
r.EDITVOLUME_MAX_SIZE=void 0
var a=e("./megachunk_common").megachunkIdFromWorldPos
var i=480
r.EDITVOLUME_MAX_SIZE=i
function volumeContainsPoint(e,t){return t[0]>=e.min[0]&&t[0]<e.max[0]&&t[1]>=e.min[1]&&t[1]<e.max[1]&&t[2]>=e.min[2]&&t[2]<e.max[2]}function volumesOverlap(e,t){return e.max[0]>t.min[0]&&e.min[0]<t.max[0]&&e.max[1]>t.min[1]&&e.min[1]<t.max[1]&&e.max[2]>t.min[2]&&e.min[2]<t.max[2]}function volumeGetOriginMegaChunkId(e){return a(e.min)}},{"./megachunk_common":202}],194:[function(e,t,r){"use strict"
r.propToEntitlementKey=propToEntitlementKey
r.registerItemEntitlements=registerItemEntitlements
r.entitlementForCostume=entitlementForCostume
r.entitlements=void 0
var _=e("assert")
var u=e("./materials_common").Mat
var d={ctest1:[{type:"costume",name:"villager_1"}],ctest2:[{type:"costume",name:"villager_1"}],ctest3:[{type:"costume",name:"villager_1"}],ctest4:[{type:"costume",name:"villager_1"}],ctest5:[{type:"costume",name:"villager_1"}],ctest6:[{type:"costume",name:"villager_1"}],ctest7:[{type:"costume",name:"villager_1"}],ctest8:[{type:"costume",name:"villager_1"}],ctest9:[{type:"costume",name:"villager_1"}],def:[{type:"costume",name:"villager_1"},{type:"costume",name:"villager_2"},{type:"swap",key:"skin",values:["tone_01","tone_02","tone_03","tone_04","tone_05","tone_06"]},{type:"swap",key:"hair",values:["brown_dark_rum","brown_cinnamon_crumble","brown_bright","grayscale_tin_soldier","red_kobe","yellow_sunflower"]},{type:"swap",key:"eyes",values:["blue_aero","brown_kuro","brown_weathervane","brown_pastel","green_goblin"]}],cbenjaminsen:[{type:"costume",name:"benjaminsen"}],cjonas:[{type:"costume",name:"jonas"}],cglen:[{type:"costume",name:"glen"}],cmicchi:[{type:"costume",name:"micchi"}],cjimbly:[{type:"costume",name:"jimbly"}],cfrancisco:[{type:"costume",name:"francisco"}],cditunes:[{type:"costume",name:"ditunes"}],cyasin:[{type:"costume",name:"yasin"}],cgaps:[{type:"costume",name:"gaps"}],cmooga:[{type:"costume",name:"mooga"}],cvillager_3:[{type:"costume",name:"villager_3"}],cvillager_4:[{type:"costume",name:"villager_4"}],cgnarlshaman:[{type:"costume",name:"gnarl_shaman"}],chumancaptain:[{type:"costume",name:"captain"}],cskeletonminion:[{type:"costume",name:"skeleton_minion"}],cbeta01:[{type:"costume",name:"gnarl_shaman"},{type:"costume",name:"captain"},{type:"costume",name:"skeleton_minion"}],xmas2021:[{type:"costume",name:"2021-12-santa-hat"},{type:"costume",name:"2021-12-snowman"},{type:"costume",name:"2021-12-sweater-1"},{type:"costume",name:"2021-12-sweater-2"}],xmas2021_1:[{type:"costume",name:"2021-12-santa-hat"}],xmas2021_2:[{type:"costume",name:"2021-12-snowman"}],xmas2021_3:[{type:"costume",name:"2021-12-sweater-1"}],xmas2021_4:[{type:"costume",name:"2021-12-sweater-2"}],cfrizard_archaeologist:[{type:"costume",name:"frizard_archaeologist"}],cfrizard_buccaneer:[{type:"costume",name:"frizard_buccaneer"}],chakama:[{type:"costume",name:"human_hakama_boy"}],ckhornos_hunter:[{type:"costume",name:"khornos_hunter"}],cyukata:[{type:"costume",name:"human_yukata_girl"}],xmas2022_1:[{type:"costume",name:"2022-12-reindeer-1"}],xmas2022_2:[{type:"costume",name:"2022-12-reindeer-2"}]};(r.entitlements=d).dev=function(){var e=[]
for(var t in d)e=e.concat(d[t])
return e}()
function propToEntitlementKey(e,t,r,a){if(void 0===t)t=u.NONE
if(void 0===r)r=u.NONE
if(void 0===a)a=u.NONE
return"prop_"+e+"_"+t+"_"+r+"_"+a}function registerItemEntitlements(e,t){for(var r=0;r<t.length;++r){var a=t[r].attr1||u.NONE
var i=t[r].attr2||u.NONE
var o=t[r].attr3||u.NONE
for(var n in d){var s=d[n]
var l=s&&s[0]
if(!l||"prop"!==l.type||l.id!==e)continue
if((a===l.attr1||a===u.ANY||l.attr1===u.ANY)&&(i===l.attr2||i===u.ANY||l.attr2===u.ANY)&&(o===l.attr3||o===u.ANY||l.attr3===u.ANY))_(false,"Duplicate prop entitlement: "+e+", "+a+", "+i+", "+o)}var c=propToEntitlementKey(e,a,i,o)
d[c]=[{type:"prop",id:e,attr1:a,attr2:i,attr3:o}]}}function entitlementForCostume(e){var t
for(var r in d){var a=d[r]
for(var i=0;i<a.length;++i){var o=a[i]
if("costume"===o.type&&o.name===e)if(!t||a.length<d[t].length)t=r}}return t}},{"./materials_common":201,assert:void 0}],195:[function(e,t,r){"use strict"
r.entityWorldsCommonClass=entityWorldsCommonClass
r.WorldsFieldEncoding=r.EntityType=r.ENT_TOL_ROT=r.ENT_TOL_POS=r.VIEW_DIST=r.VA_SIZE=void 0
var a
function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype)
_setPrototypeOf(e.prototype.constructor=e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){e.__proto__=t
return e})(e,t)}var i=e("../glov/common/entity_base_common")
var o=i.EntityBaseCommon
var n=i.EntityFieldEncoding
var s=e("./globals").MEGACHUNK_VOXEL_SIZE
var l=Math.PI,d=Math.abs,f=Math.floor,v=Math.round
var c=s
r.VA_SIZE=c
var _=200
r.VIEW_DIST=_
var u=.1
r.ENT_TOL_POS=u
var h=.1
r.ENT_TOL_ROT=h
var p;(function(e){e[e["Player"]=1]="Player"
e[e["TestingDummy"]=2]="TestingDummy"})((r.EntityType=p)||(r.EntityType=p={}))
function entityWorldsCommonClass(e){return function(o){_inheritsLoose(EntityWorldsCommon,o)
function EntityWorldsCommon(){var e
for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];(e=o.call.apply(o,[this].concat(r))||this).last_sent_pos=void 0
var i=e.data.pos=[0,0,0,0,0,0]
e.last_sent_pos=i.slice(0)
return e}return EntityWorldsCommon}(e)}(function(e){_inheritsLoose(EntityWorldsCommonDummy,e)
function EntityWorldsCommonDummy(){return e.apply(this,arguments)||this}})(entityWorldsCommonClass(o))
var m;(function(e){e[e["EntityPos"]=n.Custom0]="EntityPos"})((r.WorldsFieldEncoding=m)||(r.WorldsFieldEncoding=m={}))
var g=[u/2,u/2,u/2,h/2,h/2,h/2]
var E=256/(2*l)
var y=2*l/256
var T=new Uint8Array(1)
var I=32
var S=1/I
o.registerFieldEncoding(((a={})[m.EntityPos]={encoder:function encEntityPos(e,t,r,a){var i=r
var o=e.last_sent_pos
var n=0
for(var s=0;s<6;++s)if(!a)n|=1<<s
else if(d(o[s]-i[s])>g[s]){o[s]=i[s]
n|=1<<s}t.writeU8(n)
for(var l=0;l<3;++l)if(n&1<<l){var c=v(i[l]*I)
t.writeU8(255&c)
t.writeU8((65280&c)>>8)
t.writeU8((16711680&c)>>16)}for(var _=3;_<6;++_)if(n&1<<_){var u=f(i[_]*E)
if(u<0||u>=256){T[0]=u
u=T[0]}t.writeU8(u)}},decoder:function decEntityPos(e,t){var r=t||[0,0,0,0,0,0]
var a=e.readU8()
for(var i=0;i<3;++i)if(a&1<<i){var o=e.readU8()
var n=e.readU8()
var s=e.readU8()
if(s>=128)s|=65280
var l=s<<16|n<<8|o
r[i]=l*S}for(var c=3;c<6;++c)if(a&1<<c)r[c]=e.readU8()*y
return r}},a))},{"../glov/common/entity_base_common":320,"./globals":197}],196:[function(e,t,r){"use strict"
r.USERS_PROVIDER_FACEBOOK_INSTANT=r.USERS_PROVIDER_FACEBOOK_GAMING=r.USERS_PROVIDER_APPLE=void 0
var a="apl"
r.USERS_PROVIDER_APPLE=a
var i="fbg"
r.USERS_PROVIDER_FACEBOOK_GAMING=i
var o="fbi"
r.USERS_PROVIDER_FACEBOOK_INSTANT=o},{}],197:[function(e,t,r){"use strict"
r.STACK_SIZE=r.FAKE_PURCHASES=r.CHAT_MAX_LEN=r.TILE_PROP_MAX=r.TILE_PROP_BASE=r.ENV_LOCAL=r.ENV_TEST2=r.ENV_TEST=r.ENV_STAGING=r.ENV_PRODUCTION=r.PLATFORM_MIN_SUPPORTED_VERSIONS=r.MIN_SUPPORTED_VERSION=r.CURRENT_VERSION=r.MC_COUNT=r.MEGACHUNK_VOXEL_SIZE=r.MEGACHUNK_SIZE=r.SAFE_DIST_Z=r.SAFE_DIST=r.ID2=r.ID_FACTOR=r.VOXELS_PER_M=r.CS3=r.CS2=r.CHUNK_SIZE=void 0
var a=16
var i=(r.CHUNK_SIZE=a)*a
r.CS2=i
var o=a*a*a
r.CS3=o
var n=2
r.VOXELS_PER_M=n
var s=65536
var l=(r.ID_FACTOR=s)*s
r.ID2=l
var c=s*a/4
var _=r.SAFE_DIST=c
r.SAFE_DIST_Z=_
var u=32
var d=(r.MEGACHUNK_SIZE=u)*a
r.MEGACHUNK_VOXEL_SIZE=d
var f=u*u*u
r.MC_COUNT=f
var v="0.70.2"
r.CURRENT_VERSION=v
var h="0.70.0"
r.MIN_SUPPORTED_VERSION=h
var p={}
r.PLATFORM_MIN_SUPPORTED_VERSIONS=p
var m="prod"
r.ENV_PRODUCTION=m
var g="staging"
r.ENV_STAGING=g
var E="test"
r.ENV_TEST=E
var y="test2"
r.ENV_TEST2=y
var T="local"
r.ENV_LOCAL=T
var I=224
r.TILE_PROP_BASE=I
var S=239
r.TILE_PROP_MAX=S
var A=140
r.CHAT_MAX_LEN=A
var w=false
r.FAKE_PURCHASES=w
var L=100
r.STACK_SIZE=L},{}],198:[function(e,t,r){"use strict"
function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]
for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))e[a]=r[a]}return e}).apply(this,arguments)}var a={TYPE_ITEM:1,TYPE_BLOCK:2,TYPE_CRAFT_CLASS:-1,TYPE_SETTLEMENT_UPGRADE:-2,TYPE_RECIPE:-3}
var i={ITEM_UNKNOWNID:-1,ITEM_PICKAX:1,ITEM_HATCHET:2,ITEM_SHOVEL:4,ITEM_HOE:5,ITEM_WAYGATE:6,ITEM_BAG:7,ITEM_PLANT:8,ITEM_SEEDS_CORN:9,ITEM_SEEDS_WHEAT:10,ITEM_CORN:11,ITEM_WHEAT:12,ITEM_FIBER:15,ITEM_CORD:16,ITEM_ROD:17,ITEM_TOOL_HEAD:18,ITEM_RODH:19,ITEM_RODV:20,ITEM_CHEST_MEDIUM:22,ITEM_DOOR:23,ITEM_TORCH:24,ITEM_FENCE:25,ITEM_HANDSTOOL:26,ITEM_BUCKET:27,ITEM_BLUEPRINT:28,ITEM_LIGHT_CUBE:29,ITEM_LIQUID:30,ITEM_LANTERN:31,ITEM_SHELF:32,ITEM_CHEST_TINY:33,ITEM_CHEST_SMALL:34,ITEM_CHEST_TALL:35,ITEM_FLOWERPOT:36,ITEM_STEPS:37,ITEM_TABLE_LARGE:38,ITEM_TABLE_SMALL:39,ITEM_CHAIR:40,ITEM_BENCH:41,ITEM_BED:42,ITEM_RUG:43,ITEM_LADDER:44,ITEM_ORE:45,ITEM_INGOT:46,ITEM_FURNACE_ORE:47,ITEM_FURNACE_GLASS:48,ITEM_SAWMILL:49,ITEM_OVEN:50,ITEM_WINDOW_SMALL:51,ITEM_WINDOW_MEDIUM:52,ITEM_WINDOW_LARGE:53,ITEM_DOOR_DOUBLE:54,ITEM_GEM:55,ITEM_STONECUTTER_SIMPLE:56,ITEM_STONECUTTER_ADVANCED:57,ITEM_FACTORY_DEBUG:58,ITEM_WORKBENCH:59,ITEM_COAL:60,ITEM_ANVIL:61,ITEM_DOWSER_ADVANCED:62,ITEM_TOOL_HEAD_CAST:63,ITEM_BERRY_BUSH_RED:64,ITEM_BERRY:65,ITEM_JUICER:66,ITEM_BOTTLE:67,ITEM_JUICE:68,ITEM_SPICE_PLANT:69,ITEM_SPICE:70,ITEM_CAMPFIRE:71,ITEM_SEEDS_TOMATO:72,ITEM_TOMATO:73,ITEM_SEEDS_CARROT:74,ITEM_SEEDS_PUMPKIN:75,ITEM_WATERING_SYSTEM:76,ITEM_WILD_CROP:77,ITEM_BREAD:78,ITEM_PUMPKIN:79,ITEM_CARROT:80,ITEM_PIE:81,ITEM_LEFTOVERS:82,ITEM_ROAST_VEGETABLES:83,ITEM_SANDWICH:84,ITEM_BERRY_BUSH_BLUE:85,ITEM_BERRY_BUSH_YELLOW:86,ITEM_MUSHROOM:87,ITEM_MILL:88,ITEM_FLOUR:89,ITEM_ENERGY_WELL:99,ITEM_PAINT_MIXER:100,ITEM_PAINT:101,ITEM_KILN:102,ITEM_DOWSER_SIMPLE:103,ITEM_SEEDS_SUGAR_CANE:104,ITEM_SUGAR_CANE:105,ITEM_SUGAR:106,ITEM_CROISSANT:107,ITEM_SIGNBOARD:108,ITEM_SIGNPOST:109,ITEM_PARTICLE_DEBUGGER:110,ITEM_BONFIRE:111,ITEM_BONFIRE_METAL:112,ITEM_BUZZERSTART:113,ITEM_BUZZERGOAL:114,ITEM_ACCESS_CONTROL:115,ITEM_VEINIUM_GRINDER:116,ITEM_INDICATOR:117,ITEM_SEASHELL:118,ITEM_CORAL_POWDER:119,ITEM_STARFISH:120,ITEM_LEAPGATE:121,ITEM_LEAPGATE_SHARD:122,ITEM_BLOCK_PREVIEW:999,ITEM_TEST00:1e3,ITEM_TEST01:1001,ITEM_TEST02:1002,ITEM_TEST03:1003,ITEM_TEST04:1004,ITEM_TEST05:1005,ITEM_TEST06:1006,ITEM_TEST07:1007,ITEM_TEST08:1008,ITEM_TEST09:1009}
var o=[]
var n=_extends({ITEM_ID_CODE_NAME:o,INV_ELEM_NAME:a},a,{INV_ITEM_NAME:i},i)
t.exports=n;(function(){for(var e in i){var t=i[e]
o[t]=e}})()},{}],199:[function(e,t,r){"use strict"
r.IAP_PROVIDER_FAKE=r.ERR_NOT_AVAILABLE=r.ERR_INVALID_PROVIDER=r.ERR_INVALID_DATA=r.ERR_IAP_USER_CANCELED=r.ERR_IAP_PAYMENT_DECLINED=r.ERR_IAP_CONSUMED=void 0
var a="ERR_IAP_CONSUMED"
r.ERR_IAP_CONSUMED=a
var i="ERR_IAP_PAYMENT_DECLINED"
r.ERR_IAP_PAYMENT_DECLINED=i
var o="ERR_IAP_USER_CANCELED"
r.ERR_IAP_USER_CANCELED=o
var n="ERR_INVALID_DATA"
r.ERR_INVALID_DATA=n
var s="ERR_INVALID_PROVIDER"
r.ERR_INVALID_PROVIDER=s
var l="ERR_NOT_AVAILABLE"
r.ERR_NOT_AVAILABLE=l
var c="fake"
r.IAP_PROVIDER_FAKE=c},{}],200:[function(e,t,r){"use strict"
r.sameItem=sameItem
r.processUnlockableVariants=processUnlockableVariants
r.getItemUnlockableVariantMethods=getItemUnlockableVariantMethods
r.itemHasUnlockMethod=itemHasUnlockMethod
r.resetUnlockMethodCache=resetUnlockMethodCache
r.ENT_UNLOCK_TYPES=void 0
var c=e("assert")
var _=e("./materials_common").Mat
var s={}
function sameItem(e,t,r){if(!e){if(!t)return true
return false}if(!t)return false
if(!(e.type===t.type&&e.id===t.id&&(e.attr1||0)===(t.attr1||0)&&(e.attr2||0)===(t.attr2||0)&&(e.attr3||0)===(t.attr3||0)))return false
var a=e.attribs||s
var i=t.attribs||s
if(a===i)return true
for(var o in a)if(o!==r&&a[o]!==i[o])return false
for(var n in i)if(n!==r&&i[n]!==a[n])return false
return true}var u={lf_break:true}
r.ENT_UNLOCK_TYPES=u
function processUnlockableVariants(e){var t=[]
if(!Array.isArray(e))e=[e]
c(e.length>0)
for(var r=0;r<e.length;++r){var a=e[r]
var i=_[a.attr1||"NONE"]
var o=_[a.attr2||"NONE"]
var n=_[a.attr3||"NONE"]
c(void 0!==i,"Invalid material name: "+i)
c(void 0!==o,"Invalid material name: "+o)
c(void 0!==n,"Invalid material name: "+n)
var s=a.methods
if(!Array.isArray(s))s=[s]
c(s.length>0)
for(var l=0;l<s.length;++l)c(u[s[l]],"Invalid Unlock Method: "+s[l])
t.push({attr1:i,attr2:o,attr3:n,methods:s})}return t}function getItemUnlockableVariantMethods(e){var t=e.attr1||_.NONE
var r=e.attr2||_.NONE
var a=e.attr3||_.NONE
var i=e.unlockable_variants
if(i)for(var o=0;o<i.length;++o){var n=i[o]
var s=n.attr1===_.ANY?_.ANY:t
var l=n.attr2===_.ANY?_.ANY:r
var c=n.attr3===_.ANY?_.ANY:a
if(s===n.attr1&&l===n.attr2&&c===n.attr3)return n.methods}return null}var o={}
function itemHasUnlockMethod(e,t){var r=t+"."+e.id+"."+e.attr1+"."+e.attr2+"."+e.attr3
var a=o[r]
if(void 0!==a)return a
var i=getItemUnlockableVariantMethods(e)
return o[r]=Boolean(i&&i.includes(t))}function resetUnlockMethodCache(){o={}}},{"./materials_common":201,assert:void 0}],201:[function(e,t,r){"use strict"
r.Mat=r.CraftClass=void 0
var a;(function(e){e[e["FUEL"]=1]="FUEL"
e[e["WOOD_RAW"]=2]="WOOD_RAW"
e[e["STONE_RAW"]=3]="STONE_RAW"
e[e["REPAIRABLE"]=4]="REPAIRABLE"
e[e["INGREDIENT"]=5]="INGREDIENT"
e[e["GRINDABLE"]=6]="GRINDABLE"
e[e["SCALED_INGOT"]=7]="SCALED_INGOT"
e[e["BAKED_FOOD"]=8]="BAKED_FOOD"
e[e["WOOD_PLANK"]=9]="WOOD_PLANK"
e[e["FARMING_SEED"]=10]="FARMING_SEED"
e[e["BRICK"]=11]="BRICK"
e[e["WHEAT_CORN"]=12]="WHEAT_CORN"
e[e["VEGETABLE"]=13]="VEGETABLE"
e[e["PIE_FILLING"]=14]="PIE_FILLING"})((r.CraftClass=a)||(r.CraftClass=a={}))
var i;(function(e){e[e["NONE"]=0]="NONE"
e[e["ANY"]=-99]="ANY"
e[e["LEAF"]=1]="LEAF"
e[e["LIGHT_WOOD"]=4]="LIGHT_WOOD"
e[e["WOOD"]=2]="WOOD"
e[e["RED_WOOD"]=5]="RED_WOOD"
e[e["DARK_WOOD"]=3]="DARK_WOOD"
e[e["FLINT"]=100]="FLINT"
e[e["ROCK"]=101]="ROCK"
e[e["STONE"]=102]="STONE"
e[e["CORAL"]=105]="CORAL"
e[e["FANCY_STONE"]=104]="FANCY_STONE"
e[e["UNUSED_STONE"]=103]="UNUSED_STONE"
e[e["SAND"]=201]="SAND"
e[e["DIRT"]=200]="DIRT"
e[e["MUTTAL"]=311]="MUTTAL"
e[e["COAL"]=500]="COAL"
e[e["COPPER"]=300]="COPPER"
e[e["TIN"]=302]="TIN"
e[e["BRONZE"]=303]="BRONZE"
e[e["IRON"]=301]="IRON"
e[e["SILVER"]=304]="SILVER"
e[e["EMBERYLLIUM"]=305]="EMBERYLLIUM"
e[e["GOLD"]=306]="GOLD"
e[e["BRIGHTSTEEL"]=307]="BRIGHTSTEEL"
e[e["COBALT"]=308]="COBALT"
e[e["MYTHRIL"]=309]="MYTHRIL"
e[e["AETHERSTONE"]=310]="AETHERSTONE"
e[e["AETHERSTEEL"]=390]="AETHERSTEEL"
e[e["REGULAR"]=397]="REGULAR"
e[e["FAST"]=398]="FAST"
e[e["SUPER"]=399]="SUPER"
e[e["ANY_INGREDIENT"]=400]="ANY_INGREDIENT"
e[e["TOMATO"]=401]="TOMATO"
e[e["PUMPKIN"]=402]="PUMPKIN"
e[e["CARROT"]=403]="CARROT"
e[e["RED_BERRY"]=404]="RED_BERRY"
e[e["BLUE_BERRY"]=405]="BLUE_BERRY"
e[e["YELLOW_BERRY"]=406]="YELLOW_BERRY"
e[e["LABEL"]=407]="LABEL"
e[e["HOT"]=408]="HOT"
e[e["PUNGENT"]=409]="PUNGENT"
e[e["SAVORY"]=410]="SAVORY"
e[e["BREAD"]=411]="BREAD"
e[e["BROWN_MUSHROOM"]=412]="BROWN_MUSHROOM"
e[e["LUMINESCENT_MUSHROOM"]=413]="LUMINESCENT_MUSHROOM"
e[e["RED_MUSHROOM"]=414]="RED_MUSHROOM"
e[e["CORN"]=415]="CORN"
e[e["CORAL_MUSHROOM"]=416]="CORAL_MUSHROOM"
e[e["RED"]=501]="RED"
e[e["ORANGE"]=502]="ORANGE"
e[e["YELLOW"]=503]="YELLOW"
e[e["GREEN"]=504]="GREEN"
e[e["BLUE"]=505]="BLUE"
e[e["PURPLE"]=506]="PURPLE"})((r.Mat=i)||(r.Mat=i={}))},{}],202:[function(e,t,r){"use strict"
r.chunkPosFromId=chunkPosFromId
r.parseChunkId=parseChunkId
r.chunkIdFromWorldPos=chunkIdFromWorldPos
r.posPairFromWorldPos=posPairFromWorldPos
r.megachunkIdFromWorldPos=megachunkIdFromWorldPos
r.parseWorldPos=parseWorldPos
r.isSpoiled=isSpoiled
r.spoil=spoil
r.unspoil=unspoil
var l=e("assert")
var a=e("../common/globals.js"),i=a.ID_FACTOR,o=a.ID2,c=a.MC_COUNT,_=a.MEGACHUNK_SIZE,n=a.MEGACHUNK_VOXEL_SIZE,s=a.CHUNK_SIZE
var u=Math.floor,d=Math.round
var f=new Int32Array(3)
var v=new Int32Array(3)
var h=new Int32Array(3)
var p={chunk_pos:f,mchunk_pos:v,local_pos:h,mcid:0}
function chunkPosFromId(e){f[2]=d(e/o)
e-=f[2]*o
f[1]=d(e/i)
e-=f[1]*i
f[0]=e
return f}function parseChunkId(e){chunkPosFromId(e)
v[0]=u(f[0]/_)
v[1]=u(f[1]/_)
v[2]=u(f[2]/_)
h[0]=f[0]-v[0]*_
h[1]=f[1]-v[1]*_
h[2]=f[2]-v[2]*_
p.mcid=(v[2]*i+v[1])*i+v[0]
return p}function chunkIdFromWorldPos(e){f[0]=u(e[0]/s)
f[1]=u(e[1]/s)
f[2]=u(e[2]/s)
return(f[2]*i+f[1])*i+f[0]}var m={chunk_pos:f,local_pos:h}
function posPairFromWorldPos(e){m.chunk_id=chunkIdFromWorldPos(e)
h[0]=e[0]-f[0]*s
h[1]=e[1]-f[1]*s
h[2]=e[2]-f[2]*s
m.idx=(h[2]*s+h[1])*s+h[0]
return m}function megachunkIdFromWorldPos(e){v[0]=u(e[0]/n)
v[1]=u(e[1]/n)
v[2]=u(e[2]/n)
return(v[2]*i+v[1])*i+v[0]}var g={chunk_pos:f,mchunk_pos:v,local_pos:h,chunk_id:0,mcid:0}
function parseWorldPos(e){g.chunk_id=chunkIdFromWorldPos(e)
v[0]=u(f[0]/_)
v[1]=u(f[1]/_)
v[2]=u(f[2]/_)
h[0]=f[0]-v[0]*_
h[1]=f[1]-v[1]*_
h[2]=f[2]-v[2]*_
g.mcid=(v[2]*i+v[1])*i+v[0]
return g}function isSpoiled(e,t){var r=(t[2]*_+t[1])*_+t[0]
l(r>=0&&r<c)
var a=false
var i=0
var o=0
while(o<=r){o+=e[i++]
a=!a}return!a}function setPristine(e,t,r){var a=(t[2]*_+t[1])*_+t[0]
l(a>=0&&a<c)
var i=false
var o=0
var n=0
var s=0
while(n<=a){s=n
n+=e[o++]
i=!i}if(i===r)return false
e[--o]--
if(a===n-1){if(o===e.length-1)e.push(1)
else e[o+1]++
if(!e[o]&&0!==o){e[o-1]+=e[o+1]
e.splice(o,2)}}else if(a===s)if(0===o){l(!r)
e.splice(o,0,0,1)}else e[o-1]++
else{e.splice(o+1,0,1,n-a-1)
e[o]=a-s}return true}function spoil(e,t){return setPristine(e,t,false)}function unspoil(e,t){return setPristine(e,t,true)}},{"../common/globals.js":197,assert:void 0}],203:[function(e,t,r){"use strict"
r.getPerm=getPerm
var a={max_blueprints:6,max_photos:Infinity}
function getPerm(e,t){if(!e||void 0===e[t])return a[t]
return e[t]}},{}],204:[function(e,t,r){"use strict"
r.CARD_H=r.CARD_W=r.WG_IMG_KEYS=r.PHT_IMG_KEYS=void 0
var a=["max","card","thumb"]
r.PHT_IMG_KEYS=a
var i=["full","preview","thumb"]
r.WG_IMG_KEYS=i
var o=1200
r.CARD_W=o
var n=630
r.CARD_H=n},{}],205:[function(e,t,r){"use strict"
r.LOGIN_REWARDS=r.LoginRewardRequirementType=void 0
var a;(function(e){e[e["REFERRALS"]=1]="REFERRALS"})((r.LoginRewardRequirementType=a)||(r.LoginRewardRequirementType=a={}))
var i={ref_1:{req_type:a.REFERRALS,referrals:1,product_id:"referrals_1"}}
r.LOGIN_REWARDS=i},{}],206:[function(e,t,r){"use strict"
r.classifyRole=classifyRole
r.isValidRole=isValidRole
var a={SYSADMIN:true,TEAM:true,OWNER:true,ADMIN:true,BUILDER:true,AREABUILDER:true,READONLY:true,SPECTATOR:true,NONE:true}
function classifyRole(e,t){if(!e)return"SPECTATOR"
if(t){if(e.sysadmin)return"SYSADMIN"
if(e.team)return"TEAM"
if(e.frozen_owner)return"OWNER"}if(e.world_owner)return"OWNER"
if(e.world_admin)return"ADMIN"
if(e.world_builder)return"BUILDER"
if(e.world_areabuilder)return"AREABUILDER"
if(e.world_readonly)return"READONLY"
return"SPECTATOR"}function isValidRole(e){return Boolean(a[e])}},{}],207:[function(e,t,r){"use strict"
r.settlementTier=settlementTier
function settlementTier(e){var t=e.unlocks
var r=0
if(t){r=1
while(t["tier"+r])++r;--r}return r}},{}],208:[function(e,t,r){"use strict"
r.getAllProducts=getAllProducts
r.getProduct=getProduct
r.getAllProductItems=getAllProductItems
r.getProductItem=getProductItem
r.validatePurchaseRules=validatePurchaseRules
r.PRODUCT_ITEM_ID_GEM=void 0
var a=e("assert")
var i=e("../glov/common/util").has
var o=10
var n=200
var s=600
var l=1e3
function fillProductItems(e){e.items=e.items||[]
if(!e.items.length)e.items.push({id:e.id,amount:1})
return e}var c="gems"
var _=[{id:"cskeletonminion",max_owned:1},{id:"cgnarlshaman",max_owned:1},{id:"chumancaptain",max_owned:1},{id:"cvillager_3",max_owned:1},{id:"cvillager_4",max_owned:1},{id:"cbeta01",max_owned:1},{id:"xmas2021_1",max_owned:1},{id:"xmas2021_2",max_owned:1},{id:"xmas2021_3",max_owned:1},{id:"xmas2021_4",max_owned:1},{id:"cyukata",max_owned:1},{id:"chakama",max_owned:1},{id:"ckhornos_warrior",max_owned:1},{id:"ckhornos_warrioress",max_owned:1},{id:"ceyra_botanist",max_owned:1},{id:"cfrizard_sea_captain",max_owned:1},{id:"cfrizard_buccaneer",max_owned:1},{id:"cfrizard_archaeologist",max_owned:1},{id:"ckhornos_hunter",max_owned:1},{id:"xmas2022_1",max_owned:1},{id:"xmas2022_2",max_owned:1},{id:"world_slot",max_owned:10},{id:r.PRODUCT_ITEM_ID_GEM=c,max_owned:Infinity}]
var u={}
_.forEach(function(e){return u[e.id]=e})
var d=[{id:"cskeletonminion",cost_gems:100},{id:"cgnarlshaman",cost_gems:200},{id:"chumancaptain",cost_gems:400},{id:"cvillager_3",cost_gems:o},{id:"cvillager_4",cost_gems:o},{id:"cfrizard_archaeologist",cost_gems:s},{id:"cfrizard_buccaneer",cost_gems:l},{id:"chakama",cost_gems:n},{id:"ckhornos_hunter",cost_gems:n},{id:"cyukata",cost_gems:n},{id:"xmas2022_1",cost_gems:20,available_until:new Date("2023-01-08T23:59:59Z").getTime()},{id:"xmas2022_2",cost_gems:20,available_until:new Date("2023-01-08T23:59:59Z").getTime()},{id:"world_slot",cost_gems:10},{id:"referrals_1",items:[{id:c,amount:50}]}].map(fillProductItems)
var f={}
d.forEach(function(e){e.items.forEach(function(e){return a(u[e.id])})
f[e.id]=e})
function getAllProducts(){return d}function getProduct(e){return i(f,e)?f[e]:void 0}function getAllProductItems(){return _}function getProductItem(e){return i(u,e)?u[e]:void 0}function validatePurchaseRules(e,t,r){if(e.available_until&&t>e.available_until||e.available_asof&&t<e.available_asof)return false
if(e.items.length>1)return true
var a=e.items[0]
var i=u[a.id]
return r(a.id)+a.amount<=i.max_owned}},{"../glov/common/util":330,assert:void 0}],209:[function(Q,e,J){(function(X){(function(){"use strict"
J.VoxelDataBase=VoxelDataBase
J.createUtilVD=createUtilVD
J.ZMap=ZMap
J.zmapDeserialize=zmapDeserialize
J.zmapSerialize=zmapSerialize
J.resetDayIndex=resetDayIndex
J.LIGHT_DECREASE=J.LIGHT_INCREASE=J.TORCH_DECREASE=J.TORCH_INCREASE=J.SUN_DECREASE=J.SUN_INCREASE=J.ZMAP_UNDERGROUND=J.ZMAP_MAX=J.ZMAP_UNKNOWN=J.UNCHUNKED_ID=J.ANIM_TYPE_POS=J.ANIM_TYPE_PLAYER=J.ANIM_STYLE_BEAM=J.ANIM_STYLE_PHYS=J.TRANS_INV_EQUIP=J.TRANS_INV_PLAYER=J.TRANSACT_BLUEBOX_INFO=J.TRANSACT_VOLUME_MOD=J.TRANSACT_SETTLEMENT_PROGRESS=J.TRANSACT_STAT=J.TRANSACT_ITEM_ANIM=J.TRANSACT_PROP_MOD=J.TRANSACT_USER_ATTRIB=J.TRANSACT_INV_ATTRIB=J.TRANSACT_PROP_INV_MOD=J.TRANSACT_INV_MOD=J.TRANSACT_BAG_ADD=J.TRANSACT_PROP_SET=J.TRANSACT_VOXEL_SET_RANGE=J.TRANSACT_VOXEL_SET=J.TRANSACT_PRISTINE=J.voxel_data_mem_tracker=void 0
var _=Q("assert")
var s=Q("../glov/common/util").deepEqual
var e=Q("../common/globals")
var o=e.CHUNK_SIZE
var n=e.CS2
var h=e.TILE_PROP_BASE
var u=Math.ceil,d=Math.max
var r={count:0,bytes:0}
J.voxel_data_mem_tracker=r
var t="pristine"
J.TRANSACT_PRISTINE=t
var a="set"
J.TRANSACT_VOXEL_SET=a
var i="setx"
J.TRANSACT_VOXEL_SET_RANGE=i
var l="prop"
J.TRANSACT_PROP_SET=l
var c="bag"
J.TRANSACT_BAG_ADD=c
var f="inv"
J.TRANSACT_INV_MOD=f
var v="pinv"
J.TRANSACT_PROP_INV_MOD=v
var p="iattr"
J.TRANSACT_INV_ATTRIB=p
var m="uattr"
J.TRANSACT_USER_ATTRIB=m
var g="pmod"
J.TRANSACT_PROP_MOD=g
var E="anim"
J.TRANSACT_ITEM_ANIM=E
var y="stat"
J.TRANSACT_STAT=y
var T="sprog"
J.TRANSACT_SETTLEMENT_PROGRESS=T
var I="volm"
J.TRANSACT_VOLUME_MOD=I
var S="bbinfo"
J.TRANSACT_BLUEBOX_INFO=S
var A=1
J.TRANS_INV_PLAYER=A
var w=2
J.TRANS_INV_EQUIP=w
var L=1
J.ANIM_STYLE_PHYS=L
var R=2
J.ANIM_STYLE_BEAM=R
var x=1
J.ANIM_TYPE_PLAYER=x
var O=2
J.ANIM_TYPE_POS=O
var b=11
var N=32768
J.UNCHUNKED_ID=N
var C=-32768
J.ZMAP_UNKNOWN=C
var M=32767
J.ZMAP_MAX=M
_(C<0)
var D="underground"
J.ZMAP_UNDERGROUND=D
var P=1
J.SUN_INCREASE=P
var k=2
J.SUN_DECREASE=k
var B=4
J.TORCH_INCREASE=B
var U=8
J.TORCH_DECREASE=U
var G=P|B
J.LIGHT_INCREASE=G
var F=k|U
J.LIGHT_DECREASE=F
var W=new Int8Array([o,o,o])
function VoxelDataBase(e,t,r,a,i,o){this.pos=new Int32Array(3)
this.pos_world=new Int32Array(3)
this.mem_tracker=o
this.mem_tracker.count++
this.baseInit(e,t,r,a,i)}VoxelDataBase.prototype.baseInit=function(e,t,r,a,i){this.pos[0]=e
this.pos[1]=t
this.pos[2]=r
this.pos_world[0]=e*o
this.pos_world[1]=t*o
this.pos_world[2]=r*o
this.chunk_id=a
this.size=i||W
this.byte_size=this.size[0]*this.size[1]*this.size[2]
this.stride1=this.size[0]
this.stride2=this.size[0]*this.size[1]
this.data=null
this.liquid=null
this.props=null
this.setMemUsage(0)}
VoxelDataBase.prototype.setMemUsage=function(e){if(e!==this.mem_last_bytes){this.mem_tracker.bytes+=e-(this.mem_last_bytes||0)
this.mem_last_bytes=e}}
function createUtilVD(e){var t=new VoxelDataBase(0,0,0,N,e,r)
t.alloc()
return t}function serializeUInt8Array(e,t,r){if(!t)e.push(r,0)
else{var a=t[0]
var i=1
for(var o=1;o<r;++o)if(t[o]!==a){e.push(i,a)
i=1
a=t[o]}else i++
e.push(i,a)}}function deserializeUInt8ArrayFromBuffer(e,t,r){var a=t.str,i=t.offs
var o
function getc(){var e=a[i++]
if(e<=127)return e
else if(e>=192&&e<224)return(31&e)<<6|63&a[i++]
else if(e>=224&&e<240)return(15&e)<<12|(63&a[i++])<<6|63&a[i++]
else{o="Bad character"
return 0}}var n=i
var s=getc()
var l=getc()
if(o)return o
var c
if(!l&&s===r)c=null
else{i=n
c=new Uint8Array(r)
var _=0
for(;i<a.length&&_<r;){var u=getc()
var d=getc()
if(o)return o
if(_+u>r)return"overflow"
while(u){c[_++]=d
u--}}}t.offs=i
e.data=c
return null}function deserializeUInt8Array(e,t,r){var a=t.str
var i=a.charCodeAt(t.offs)
if(!a.charCodeAt(t.offs+1)&&i===r){t.offs+=2
return e.data=null}var o=new Uint8Array(r)
var n=0
for(;t.offs<a.length&&n<r;t.offs+=2){var s=a.charCodeAt(t.offs)
var l=a.charCodeAt(t.offs+1)
if(n+s>r)return"overflow"
while(s){o[n++]=l
s--}}e.data=o
return null}var j
var H
var z
if("undefined"===typeof process){j=function utf8FromBuffer(){_(false)}
H=function bufferAlloc(e){return new Uint8Array(e)}
z=function bufferClone(e,t,r){return e.slice(0,r)}}else{_(X.alloc(1)instanceof Uint8Array)
j=function utf8FromBuffer(e,t){return X.from(e.buffer,e.byteOffset+t,e.byteLength-t).toString("utf8")}
H=function bufferAlloc(e){return X.alloc(e)}
z=function bufferClone(e,t,r){return X.from(e.slice(t,r))}}VoxelDataBase.prototype.deserialize=function(e,t){if(!e)return false
var r=e instanceof Uint8Array
var a=r?e[0]:e.charCodeAt(0)
if(a!==b&&10!==a)return false
var i={str:e,offs:1}
var o={}
var n=r?deserializeUInt8ArrayFromBuffer:deserializeUInt8Array
var s=n(o,i,this.byte_size)
if(s){console.error(s)
return false}this.data=o.data
if(s=n(o,i,this.byte_size)){console.error(s)
return false}this.liquid=o.data
var l=0
if(this.data)l+=this.byte_size
if(this.liquid)l+=this.byte_size
if(i.offs!==e.length){if(!this.props)this.props={}
var c
if(r)c=j(e,i.offs)
else c=e.slice(i.offs)
l+=c.length
var _
try{_=JSON.parse(c)}catch(e){}if(!Array.isArray(_)||!_.length){console.error("invalid prop_list")
return false}if(t&&!this.data)this.alloc()
for(var u=0;u<_.length;++u){var d=_[u]
if(!Array.isArray(d)||4!==d.length){console.error("invalid prop_entry")
return false}var f=this.deserializeProp(d)
if(!f){console.error("deserializeProp failed")
return false}var v=f.pos[2]*this.stride2+f.pos[1]*this.stride1+f.pos[0]
if((this.props[v]=f).baked){if(!this.baked_props)this.baked_props={}
this.baked_props[v]=f.baked}if(f.draw){if(!this.drawable_props)this.drawable_props={}
this.drawable_props[v]=f}if(t&&this.data[v]!==h)this.data[v]=h}}this.setMemUsage(l)
return true}
var V=null
var Y=0
var q
function workBufWriteUTF8(e){if(e<=127)V[q++]=e
else if(e<=2047){V[q++]=e>>6|192
V[q++]=63&e|128}else if(e<=65535){V[q++]=e>>12|224
V[q++]=e>>6&63|128
V[q++]=63&e|128}else _(false,"Invalid character: "+e)}VoxelDataBase.prototype.serialize=function(e,t){_(!this.disposed)
var r=[b]
serializeUInt8Array(r,this.data,this.byte_size)
serializeUInt8Array(r,this.liquid,this.byte_size)
var a=""
if(this.props){var i=[]
for(var o in this.props)i.push(this.serializeProp(this.props[o]))
if(i.length)a=JSON.stringify(i)}if(t){var n=0
if(this.data)n+=this.byte_size
if(this.liquid)n+=this.byte_size
n+=a.length
this.setMemUsage(n)}if(e){var s=3*r.length+4*a.length
if(s>Y){Y=d(u(1.5*Y),s)
V=H(Y)}for(var l=q=0;l<r.length;++l)workBufWriteUTF8(r[l])
for(var c=0;c<a.length;++c)workBufWriteUTF8(a.charCodeAt(c))
_(q<Y)
return z(V,0,q)}else return""+String.fromCharCode.apply(null,r)+a}
var K=new Uint8Array([0])
function unit8ArrayEquals(e,t){t=t||K
var r=d((e=e||K).length,t.length)
for(var a=0;a<r;++a)if((e[a]||0)!==(t[a]||0))return false
return true}VoxelDataBase.prototype.equals=function(e){_(!this.disposed)
_(!e.disposed)
if(!unit8ArrayEquals(this.data,e.data))return false
if(!unit8ArrayEquals(this.liquid,e.liquid))return false
var t=this.props||{}
var r=e.props||{}
for(var a in t){var i=t[a]
var o=r[a]
if(!o)return false
i=i.toJSON()
o=o.toJSON()
if(!s(i,o))return false}for(var n in r)if(!t[n])return false
return true}
VoxelDataBase.prototype.get=function(e,t){if(e[0]<0||e[1]<0||e[2]<0||e[0]>=this.size[0]||e[1]>=this.size[1]||e[2]>=this.size[2])return 0
var r=e[2]*this.stride2+e[1]*this.stride1+e[0]
if(t)return this.liquid[r]
else return this.data[r]}
VoxelDataBase.prototype.set=function(e,t,r){_(!(e[0]<0||e[1]<0||e[2]<0||e[0]>=this.size[0]||e[1]>=this.size[1]||e[2]>=this.size[2]))
var a=e[2]*this.stride2+e[1]*this.stride1+e[0]
if(r)this.liquid[a]=t
else this.data[a]=t}
VoxelDataBase.prototype.getDirect=function(e,t){var r=t?this.liquid:this.data
if(!r)return null
return r[e]}
VoxelDataBase.prototype.getProp=function(e){if(!this.props||e[0]<0||e[1]<0||e[2]<0||e[0]>=this.size[0]||e[1]>=this.size[1]||e[2]>=this.size[2])return null
return this.props[e[2]*this.stride2+e[1]*this.stride1+e[0]]}
VoxelDataBase.prototype.getPropDirect=function(e){if(!this.props)return null
return this.props[e]}
VoxelDataBase.prototype.alloc=function(e){if(e){if(!this.liquid)this.liquid=new Uint8Array(this.byte_size)}else if(!this.data)this.data=new Uint8Array(this.byte_size)}
function ZMap(e){this.data=e||new Int16Array(n)}var Z=32
function zmapDeserialize(e,t){if(t.charCodeAt(0)!==Z)return"bad version"
if(e)_.equal(e.length,n)
var r=0
for(var a=1;a<t.length;){var i=t.charCodeAt(a++)-33
if(-1===i)i=-(t.charCodeAt(a++)-33)
var o=t.charCodeAt(a++)-31
if(r+o>n)return"overflow"
if(e)while(o){e[r++]=i;--o}else r+=o}if(r!==n)return"underflow"
return null}function zmapSerialize(e){_(e instanceof Int16Array)
_.equal(e.length,n)
var t=[Z]
var r=e[0]
var a=0
for(var i=0;i<n;++i){if(e[i]!==r){if(r<0){t.push(32)
r*=-1}t.push(r+33)
t.push(a+31)
r=e[i]
a=0}++a}if(r<0){t.push(32)
r*=-1}t.push(r+33)
t.push(a+31)
return String.fromCharCode.apply(null,t)}function resetDayIndex(e){return 1}}).call(this)}).call(this,Q("buffer").Buffer)},{"../common/globals":197,"../glov/common/util":330,assert:void 0,buffer:void 0}],210:[function(e,t,r){"use strict"
r.waygateImagePath=waygateImagePath
r.waygate_invalid_ids=r.waygate_invalid_regex=r.waygate_valid_regex=r.MAX_WAYGATE_TARGETS=r.WAYGATE_ID_LEN=r.WAYGATE_NAME_LEN=r.MAX_WAYGATES=r.FLAT_SEED_EMPTY=r.FLAT_SEED_WATER=r.FLAT_SEED_GRASS_ON_STONE=void 0
var a
var i=2
r.FLAT_SEED_GRASS_ON_STONE=i
var o=4
r.FLAT_SEED_WATER=o
var n=225
r.FLAT_SEED_EMPTY=n
var s=1e3
r.MAX_WAYGATES=s
var l=32
r.WAYGATE_NAME_LEN=l
var c=16
r.WAYGATE_ID_LEN=c
var _=100
r.MAX_WAYGATE_TARGETS=_
var u=/^[a-z0-9_]{1,16}$/
r.waygate_valid_regex=u
var d=/^__.*__$/
r.waygate_invalid_regex=d
var f={info:1,admin:1,manage:1,share:1,players:1,stats:1,connect:1,undefined:1}
r.waygate_invalid_ids=f
var v=((a={})[i]="grass",a[o]="water",a[n]="empty",a[10]="snow",a[11]="sand",a[3]="stone",a[12]="stone_dark",a[13]="stone_light",a[14]="stone_red",a)
function waygateImagePath(e,t,r){var a=(e=e||{}).waygates||{}
if(!a[r=r||"default"])r="default"
var i=a[r]&&a[r].imgid
var o
if(i){var n=e.image&&e.image.sets&&e.image.sets[i]
var s=n&&n[t]
if(s)o=""+(n.prefix||"")+s}if(!o){o="img/placeholder/"
if("flat"===e.world_type)o+="flat_"+(v[e.seed]||"stone")
else o+="procgen"
o+="_"+t+"."+("thumb"===t?"png":"jpg")}return o}},{}],211:[function(e,t,r){"use strict"
r.waygateUpgradeGetData=waygateUpgradeGetData
r.waygateUpgradeCommonStartup=waygateUpgradeCommonStartup
r.SETTLEMENT_EDITVOLUME_SIZE=r.WAYGATE_UPGRADES=r.WAYGATE_TIERS=void 0
var u=[]
r.WAYGATE_TIERS=u
var d=Object.create(null)
r.WAYGATE_UPGRADES=d
var a=256
r.SETTLEMENT_EDITVOLUME_SIZE=a
var f=e("assert")
var i=e("./ids")
var v=i.ITEM_ANVIL
var h=i.ITEM_BONFIRE
var p=i.ITEM_BONFIRE_METAL
var m=i.ITEM_BUCKET
var g=i.ITEM_CORD
var E=i.ITEM_ENERGY_WELL
var y=i.ITEM_FLOUR
var T=i.ITEM_FURNACE_GLASS
var I=i.ITEM_FURNACE_ORE
var S=i.ITEM_INGOT
var A=i.ITEM_JUICER
var w=i.ITEM_KILN
var L=i.ITEM_MILL
var R=i.ITEM_OVEN
var x=i.ITEM_PAINT_MIXER
var O=i.ITEM_ROD
var b=i.ITEM_SAWMILL
var N=i.ITEM_STONECUTTER_SIMPLE
var C=i.ITEM_TOOL_HEAD
var M=i.ITEM_TOOL_HEAD_CAST
var D=i.ITEM_VEINIUM_GRINDER
var P=i.ITEM_WATERING_SYSTEM
var k=i.ITEM_WORKBENCH
var B=i.TYPE_BLOCK
var U=i.TYPE_CRAFT_CLASS
var G=i.TYPE_ITEM
var o=e("./materials_common")
var F=o.CraftClass
var W=o.Mat
function createItemServer(e){return{count:e.count}}function waygateUpgradeGetData(e){return d[e]}function waygateUpgradeCommonStartup(e,t){e=e||createItemServer
var r=t||{},a=r.TILE_DIRT,i=r.TILE_BRICK_STONE,o=r.TILE_SAND,n=r.TILE_WATER,s=r.TILE_VEINIUM
u.push({name:"Primitive",unlocks:[],radius:20},{name:"Basic Industry",cost:{cost1:e({type:B,id:a,count:10}),cost2:e({type:U,id:F.STONE_RAW,count:10}),cost3:e({type:U,id:F.WOOD_RAW,count:10})},unlocks:[k,N,E],radius:20},{name:"Tools",cost:{cost1:e({type:G,id:g,count:1}),cost2:e({type:G,id:C,attr1:W.ANY,count:1})},unlocks:[b],unlocks_recipes:["shovel","pickax","hatchet","wood_bucket"],radius:25},{name:"Metals",cost:{cost1:e({type:G,id:O,attr1:W.ANY,count:5}),cost2:e({type:U,id:F.BRICK,count:10}),cost3:e({type:G,id:m,attr1:W.ANY,attr2:n,count:1}),cost4:e({type:U,id:F.FARMING_SEED,count:1}),cost5:e({type:B,id:s,count:10})},unlocks:[I,M],unlocks_recipes:["hoe"],radius:30},{name:"Mill and Alloys",cost:{cost1:e({type:U,id:F.WHEAT_CORN,count:1}),cost2:e({type:G,id:S,attr1:W.COPPER,count:3}),cost3:e({type:G,id:S,attr1:W.TIN,count:1}),cost4:e({type:B,id:s,count:100})},unlocks:[T,L],unlocks_recipes:["alloy"],radius:35},{name:"Oven",cost:{cost1:e({type:G,id:y,count:1}),cost2:e({type:G,id:S,attr1:W.BRONZE,count:1})},unlocks:[R,h,p],radius:40},{name:"Juicer",cost:{cost1:e({type:U,id:F.BAKED_FOOD,count:1}),cost2:e({type:G,id:S,attr1:W.IRON,count:1})},unlocks:[A,P,x,D],radius:45},{name:"That's All For Now!",cost:{cost1:e({type:G,id:S,attr1:W.GOLD,count:10})},radius:45})
var l=0
function addUpgrade(e,t){f(!d[e])
t.upgrade_idx=++l
d[e]=t}addUpgrade("radius1",{name:"Size 1",cost:{cost1:e({type:B,id:s,count:100})},radius_add:20,prereqs:["tier2"]})
addUpgrade("radius2",{name:"Size 2",cost:{cost1:e({type:U,id:F.STONE_RAW,count:1e3})},radius_add:20,prereqs:["radius1"]})
addUpgrade("dowser_simple",{name:"Prospecting",cost:{cost1:e({type:G,id:O,attr1:W.ANY,count:2}),cost2:e({type:B,id:s,count:10})},unlocks_recipes:["dowser_simple"],prereqs:["tier3"]})
addUpgrade("kiln",{name:"Bricks and Charcoal",cost:{cost1:e({type:B,id:o,count:30}),cost2:e({type:G,id:S,attr1:W.COPPER,count:10})},unlocks:[w],prereqs:["tier3"]})
addUpgrade("dowser_advanced",{name:"Advanced Prospecting",cost:{cost1:e({type:B,id:s,count:200})},unlocks_recipes:["dowser_advanced"],prereqs:["dowser_simple"]})
addUpgrade("metalworking",{name:"Advanced Metalworking",cost:{cost1:e({type:B,id:i,count:100}),cost2:e({type:B,id:s,count:200})},unlocks:[v],prereqs:["tier3"]})
addUpgrade("radius3",{name:"Size 3",cost:{cost1:e({type:U,id:F.STONE_RAW,count:1e4}),cost2:e({type:B,id:s,count:1e3})},radius_add:20,prereqs:["radius2"]})
for(var c=0;c<u.length;++c){u[c].is_tier=true
u[c].tier_idx=c
d["tier"+c]=u[c]}for(var _ in d)d[_].key=_}},{"./ids":198,"./materials_common":201,assert:void 0}],212:[function(e,t,r){"use strict"
r.CHAT_COOLDOWN_MINIMUM=r.CHAT_COOLDOWN_MAXIMUM=r.WORLD_DIG_MAX_CLIENTS=r.DEFAULT_RACE_AS_VISITOR_LF=r.DEFAULT_RACE_AS_VISITOR_UNL=r.WORLD_RACE_AS_VISITOR_AUTO=r.WORLD_RACE_AS_VISITOR_ON=r.WORLD_RACE_AS_VISITOR_OFF=r.WORLD_ACCESS_MODIFY_BUILDER=r.WORLD_ACCESS_MODIFY_LIMITED=r.WORLD_ACCESS_READONLY=r.WORLD_ACCESS_NONE=r.WAYGATE_SETTLEMENT_AUTO=r.WAYGATE_SETTLEMENT_REGEX=r.WAYGATE_SETTLEMENT_PREFIX=r.VOLUME_SETTLEMENT_PREFIX=r.WAYGATE_FLAG_SETTLEMENT=r.WAYGATE_FLAG_LISTED=r.WORLDINFO_LEVEL_ALL=r.WORLDINFO_LEVEL_BASIC=r.ATTRIB_FIXED_MAX=r.DEFAULT_ACCESS_AREA_CLEAR=r.DEFAULT_ACCESS_SETTLEMENT=r.DEFAULT_ACCESS_VOLUME=r.DEFAULT_ACCESS_EXVOLUME=r.THRESHOLD_ACCESS_MANAGE_VOLUMES=r.ACCESS_FROM_STRING=r.ACCESS_TO_STRING=r.ACCESS_NONE_HIGH=r.ACCESS_DEV=r.ACCESS_OWNER=r.ACCESS_ADMIN=r.ACCESS_BUILDER=r.ACCESS_AREA_BUILDER=r.THRESHOLD_ACCESS_MODIFY=r.ACCESS_READONLY=r.THRESHOLD_ACCESS_AVATAR=r.ACCESS_SPECTATOR=r.THRESHOLD_ACCESS_ALLOWED=r.ACCESS_PUBLIC=r.ACCESS_NONE=void 0
var a=0
r.ACCESS_NONE=a
var i=1
r.ACCESS_PUBLIC=i
var o=2
r.THRESHOLD_ACCESS_ALLOWED=o
var n=10
r.ACCESS_SPECTATOR=n
var s=15
r.THRESHOLD_ACCESS_AVATAR=s
var l=20
r.ACCESS_READONLY=l
var c=25
r.THRESHOLD_ACCESS_MODIFY=c
var _=40
r.ACCESS_AREA_BUILDER=_
var u=50
r.ACCESS_BUILDER=u
var d=80
r.ACCESS_ADMIN=d
var f=90
r.ACCESS_OWNER=f
var v=99
r.ACCESS_DEV=v
var h=100
r.ACCESS_NONE_HIGH=h
var p=[];(r.ACCESS_TO_STRING=p)[a]="NONE"
p[i]="PUBLIC"
p[n]="SPECTATOR"
p[l]="READONLY"
p[_]="AREABUILDER"
p[u]="BUILDER"
p[d]="ADMIN"
p[f]="OWNER"
p[v]="DEV"
p[h]="NONE_HIGH"
var m=function(){var e={}
for(var t in p){var r=Number(t)
if(r===i)continue
e[p[r]]=r
e[t]=r}return e}()
r.ACCESS_FROM_STRING=m
var g=d
r.THRESHOLD_ACCESS_MANAGE_VOLUMES=g
var E=u
r.DEFAULT_ACCESS_EXVOLUME=E
var y=l
r.DEFAULT_ACCESS_VOLUME=y
var T=u
r.DEFAULT_ACCESS_SETTLEMENT=T
var I=f
r.DEFAULT_ACCESS_AREA_CLEAR=I
var S=1e6
r.ATTRIB_FIXED_MAX=S
var A=1
r.WORLDINFO_LEVEL_BASIC=A
var w=9
r.WORLDINFO_LEVEL_ALL=w
var L=1
r.WAYGATE_FLAG_LISTED=L
var R=2
r.WAYGATE_FLAG_SETTLEMENT=R
var x="s:"
r.VOLUME_SETTLEMENT_PREFIX=x
var O="s"
r.WAYGATE_SETTLEMENT_PREFIX=O
var b=/^s\d+/
r.WAYGATE_SETTLEMENT_REGEX=b
var N="settlement_auto"
r.WAYGATE_SETTLEMENT_AUTO=N
var C=0
r.WORLD_ACCESS_NONE=C
var M=2
r.WORLD_ACCESS_READONLY=M
var D=4
r.WORLD_ACCESS_MODIFY_LIMITED=D
var P=8
r.WORLD_ACCESS_MODIFY_BUILDER=P
var k=0
r.WORLD_RACE_AS_VISITOR_OFF=k
var B=1
r.WORLD_RACE_AS_VISITOR_ON=B
var U=2
var G=r.WORLD_RACE_AS_VISITOR_AUTO=U
r.DEFAULT_RACE_AS_VISITOR_UNL=G
var F=k
r.DEFAULT_RACE_AS_VISITOR_LF=F
var W=15
r.WORLD_DIG_MAX_CLIENTS=W
var j=180
r.CHAT_COOLDOWN_MAXIMUM=j
var H=0
r.CHAT_COOLDOWN_MINIMUM=H},{}],213:[function(e,t,r){"use strict"
r.worldTransSetPropCheck=worldTransSetPropCheck
r.encodeChunkPos=encodeChunkPos
r.decodeChunkPos=decodeChunkPos
r.decodeWorldPos=decodeWorldPos
r.Transaction=Transaction
r.TransactionSet=TransactionSet
r.createTransSet=createTransSet
r.pristine_fields=void 0
var V=e("assert")
var a=e("../glov/common/util")
var i=a.callEach
var o=a.isInteger
var n=e("./globals")
var s=n.CHUNK_SIZE
var l=n.ID2
var c=n.ID_FACTOR
var Y=e("./items_common").sameItem
var _=e("./voxel_data_common")
var u=_.ANIM_STYLE_BEAM
var d=_.ANIM_STYLE_PHYS
var f=_.ANIM_TYPE_PLAYER
var v=_.ANIM_TYPE_POS
var q=_.TRANSACT_BAG_ADD
var h=_.TRANSACT_BLUEBOX_INFO
var p=_.TRANSACT_INV_ATTRIB
var m=_.TRANSACT_INV_MOD
var K=_.TRANSACT_ITEM_ANIM
var Z=_.TRANSACT_PROP_INV_MOD
var X=_.TRANSACT_PROP_MOD
var Q=_.TRANSACT_PROP_SET
var g=_.TRANSACT_SETTLEMENT_PROGRESS
var E=_.TRANSACT_STAT
var y=_.TRANSACT_USER_ATTRIB
var T=_.TRANSACT_VOLUME_MOD
var J=_.TRANSACT_VOXEL_SET
var I=_.TRANSACT_VOXEL_SET_RANGE
var S=_.TRANS_INV_EQUIP
var A=_.TRANS_INV_PLAYER
var w=Math.round
var $=1
var L=8
var R={pristine_sends:"p",hexome_choices:"h",detail_data:"d"}
r.pristine_fields=R
var x
function worldTransSetPropCheck(e){x=e}function itemAttribString(e,t){var r=[]
if(e.attr1){V(o(e.attr1))
r.push("1",e.attr1)}if(e.attr2){V(o(e.attr2))
r.push("2",e.attr2)}if(e.attr3){V(o(e.attr3))
r.push("3",e.attr3)}for(var a in e.attribs){var i=e.attribs[a]
V(i)
V(o(i))
if(a!==t)r.push(a,i)}return r.join(",")}function itemFromAttribString(e,t){if(!t)return
var r=t.split(",")
for(var a=0;a<r.length;a+=2){var i=r[a]
var o=Number(r[a+1])
switch(i){case"1":e.attr1=o
break
case"2":e.attr2=o
break
case"3":e.attr3=o
break
default:if(!e.attribs)e.attribs={}
e.attribs[i]=o}}}function pushItem(e,t){e.push(itemAttribString(t),t.type,t.id,t.count)}function pullItem(e,t){var r={type:e[t+1],id:e[t+2],count:e[t+3]}
itemFromAttribString(r,e[t])
return r}function encodeChunkPos(e){V(o(e[0])&&e[0]>=0&&e[0]<16)
V(o(e[1])&&e[1]>=0&&e[1]<16)
V(o(e[2])&&e[2]>=0&&e[2]<16)
return(e[2]<<8)+(e[1]<<4)+e[0]}function decodeChunkPos(e){return[15&e,(240&e)>>4,(3840&e)>>8]}function decodeWorldPos(e,t,r){var a=w(t/l)
var i=w((t-=a*l)/c)
t-=i*c
e[0]=t*s+(15&r)
e[1]=i*s+((240&r)>>4)
e[2]=a*s+((3840&r)>>8)
return e}function Transaction(e){this.tset=e
this.ops=[]
this.submitted=false}Transaction.prototype.toJSON=function(){return this.ops}
Transaction.prototype.onComplete=function(e){V(!this.submitted)
if(this.cbs)this.cbs.push(e)
else this.cbs=[e]}
Transaction.prototype.callCallbacks=function(e){i(this.cbs,null,e)}
Transaction.prototype.numOps=function(){return this.ops.length}
Transaction.prototype.get=function(e){return this.ops[e]}
Transaction.prototype.opSet=function(e,t,r,a,i,o){V(!this.submitted)
var n=[J,e,t,r,(a?1:0)+(i?2:0),o]
this.ops.push(n)
return n}
Transaction.prototype.opInvAttrib=function(e){V(!this.submitted)
V(e.attrib)
V(e.delta)
V(o(e.delta))
var t=!e.prop.user_inv_type
V(!t)
var r=e.prop.contents[e.idx]
V(r)
var a=[p,e.attrib,itemAttribString(r,e.attrib),r.type,r.id,e.delta,e.idx,e.prop.user_inv_type]
this.ops.push(a)}
Transaction.prototype.getInvAttrib=function(e){var t=this.get(e)
V(t)
if(t[0]!==p)return null
if(8!==t.length)return null
var r={idx:t[6],item:{type:t[3],id:t[4]},attrib:t[1],delta:t[5],user_inv_type:t[7]}
itemFromAttribString(r.item,t[2])
if(r.user_inv_type!==A&&r.user_inv_type!==S)return null
return r}
Transaction.prototype.opUserAttrib=function(e,t){V(!this.submitted)
V(e)
V(t)
V(o(t))
var r=[y,e,t]
this.ops.push(r)}
Transaction.prototype.getUserAttrib=function(e){var t=this.get(e)
V(t)
if(t[0]!==y)return null
if(3!==t.length)return null
return{attrib:t[1],delta:t[2]}}
Transaction.prototype.opStat=function(e,t){V(!this.submitted)
V.equal(typeof e,"string")
V(o(t)&&t>0)
this.ops.push([E,e,t])}
Transaction.prototype.opSettlementProgress=function(e,t,r,a,i){V(!this.submitted)
V(o(e))
V.equal(typeof t,"string")
V.equal(typeof r,"string")
V.equal(typeof a,"string")
V(o(i)&&i>0,i)
this.ops.push([g,t,r,a,e,i])}
Transaction.prototype.opBlueboxInfo=function(e,t){this.ops.unshift([h,e,t])}
Transaction.prototype.opVolumeMod=function(e,t,r){V(!this.submitted)
V(o(e))
V.equal(typeof t,"string")
this.ops.push([T,t,r,e])}
Transaction.prototype.opInvMod=function(e){V(!this.submitted)
V(e.prop)
var t=!e.prop.user_inv_type
if(t&&x)x(e.prop)
var r
var a=e.item
if(e.add){r=a.count||1
V(!e.delta)}else{V(e.delta)
r=e.delta}var i=(e.add?$:0)+(e.prop.destroy_on_empty&&e.delta<0?L:0)
var o=[t?Z:m]
pushItem(o,a)
o[4]=r
o.push(e.idx,i)
if(t)o.push(e.prop.chunk_id,encodeChunkPos(e.prop.pos),e.prop.version||0)
else o.push(e.prop.user_inv_type)
o.pred=e.pred
o.cb=e.cb
this.ops.push(o)}
Transaction.prototype.getInvMod=function(e){var t=this.get(e)
V(t)
var r=t[0]
var a=r===Z
if(r!==m&&!a)return null
if(t.length!==(a?10:8))return null
var i=t[5]
var o=t[6]
var n={idx:i,add:Boolean(o&$),item:{type:t[2],id:t[3]},pred:t.pred}
itemFromAttribString(n.item,t[1])
var s=t[4]
if(n.add){if(s>1)n.item.count=s}else n.delta=s
if(a){n.prop_destroy_on_empty=Boolean(o&L)
n.prop_chunk_id=t[7]
n.prop_pos_idx=t[8]
n.prop_pos=decodeChunkPos(n.prop_pos_idx)
n.prop_version=t[9]}else{n.user_inv_type=t[7]
if(n.user_inv_type!==A&&n.user_inv_type!==S)return null}return n}
Transaction.prototype.opBagAdd=function(e,t,r){V(!this.submitted)
var a=r.no_pickup,i=r.item,o=r.is_update_func
var n=r.src_offs
var s=(o?1:0)+(i.stackable?2:0)
var l=[q,a]
pushItem(l,i)
l.push(e,encodeChunkPos(t),n[0],n[1],n[2],s)
this.ops.push(l)}
Transaction.prototype.getBagAdd=function(e){var t=this.get(e)
V(t)
if(t[0]!==q)return null
if(12!==t.length)return null
var r=t[11]
var a={no_pickup:t[1],item:pullItem(t,2),target_chunk_id:t[6],target_pos_idx:t[7],target_pos:decodeChunkPos(t[7]),src_offs:t.slice(8,11),is_update_func:1&r,stackable:2&r}
if(1===a.item.count)delete a.item.count
return a}
Transaction.prototype.opPropSet=function(e,t,r,a){V(!this.submitted)
var i=[Q,a?JSON.stringify(a.toJSON()):"",e||0,t,encodeChunkPos(r)]
this.ops.push(i)
return i}
Transaction.prototype.opPropMod=function(e,t,r,a,i,o){V(!this.submitted)
var n=[X,r,JSON.stringify(a),JSON.stringify(i),e,encodeChunkPos(t),o,0]
V.equal(typeof n[2],"string")
V.equal(typeof n[3],"string")
this.ops.push(n)
return n}
Transaction.prototype.getPropMod=function(e){var t=this.get(e)
V.equal(t[0],X)
if(8!==t.length)return null
var r=t[1]
var a
var i
try{i=JSON.parse(t[2])
a=JSON.parse(t[3])}catch(e){console.error("Error parsing prop_mod value",e)
return null}var o=t[4]
var n=t[5]
return{field:r,old_value:i,new_value:a,item_id:t[6],version:t[7],chunk_id:o,pos_idx:n,pos:decodeChunkPos(n),pred:t.pred}}
var O=/,"attribs":\{[^}]*\}/g
Transaction.prototype.opItemAnim=function(e,t,r,a,i,o,n,s,l){V(!this.submitted)
V(i)
V(s)
V(l.length)
V(l[0])
var c=(t?1:0)+(r===f?2:0)+(o===f?4:0)+(e===u?8:0)
var _=[K,JSON.stringify(l).replace(O,""),c,r===f?i:a,r===v?encodeChunkPos(i):0,o===f?s:n,o===v?encodeChunkPos(s):0]
this.ops.push(_)
return _}
Transaction.prototype.getItemAnim=function(e){var t=this.get(e)
if(t[0]!==K)return null
if(7!==t.length)return null
var r=t[2]
var a=Boolean(1&r)
var i=2&r?f:v
var o=4&r?f:v
var n=8&r?u:d
var s=t[1]
var l
try{l=JSON.parse(s)}catch(e){console.error("Error parsing items string",e)
return null}var c={style:n,from_center:a,src_type:i,target_type:o,items:l}
if(i===v){c.src_chunk_id=t[3]
c.src_pos_idx=t[4]
c.src_pos=decodeChunkPos(t[4])}else c.src=t[3]
if(o===v){c.target_chunk_id=t[5]
c.target_pos_idx=t[6]
c.target_pos=decodeChunkPos(t[6])}else c.target=t[5]
return c}
Transaction.prototype.compact=function(){var e=this.loose_compaction
var t={}
V(this.ops.length)
for(var r=0;r<this.ops.length;++r){var a=this.ops[r]
if(a[0]!==J)continue
var i=1&a[4]
var o=a[1]+","+a[2]+","+i
var n=a[3]
var s=a[5]
if(t[o]){var l=t[o]-1
var c=this.ops[l]
if(c[3]===s);else if(c[5]===s){V(e)
if(c[3]===n);else{V(a.loose_priority&&c.loose_priority)
if(a.loose_priority>c.loose_priority);else n=c[3]}}else V(false)
c[3]=n
c[4]&=a[4]
this.ops.splice(r,1);--r
if(c[3]===c[5]){this.ops.splice(l,1)
delete t[o];--r
for(var _ in t)if(t[_]>l)--t[_]}}else t[o]=r+1}t={}
for(var u=0;u<this.ops.length;++u){var d=this.ops[u]
if(d[0]!==Q)continue
var f=d[3]+","+d[4]
if(t[f]){var v=this.ops[t[f]-1]
if(""===v[1]&&""===d[1]);else{if(""===v[1]||""===d[1]);else V.equal(v[1],"")
V(!d[2]||v[1]&&d[2]===JSON.parse(v[1]).v)}v[1]=d[1]
this.ops.splice(u,1);--u}else t[f]=u+1}t={}
for(var h=0;h<this.ops.length;++h){var p=this.ops[h]
if(p[0]!==Z)continue
var m=p[7]+","+p[8]+","+p[5]
var g=p[6]
if(g===$){if(t[m]);t[m]=h+1}else if(!g)if(!t[m])t[m]=h+1
else{var E=t[m]-1
var y=this.ops[E]
V.equal(y[1],p[1])
V.equal(y[2],p[2])
V.equal(y[3],p[3])
V(y[4])
V(p[4])
y[4]+=p[4]
this.ops.splice(h,1);--h
if(!y[4]){this.ops.splice(E,1)
delete t[m];--h
for(var T in t)if(t[T]>E)--t[T]}}}t={}
for(var I=0;I<this.ops.length;++I){var S=this.ops[I]
if(S[0]!==K)continue
var A=[S[2],S[3],S[4],S[5],S[6]].join(",")
var w=t[A]
if(w){var L=this.ops[w-1]
var R=JSON.parse(S[1])
var x=JSON.parse(L[1])
for(var O=0;O<x.length;++O){var b=x[O]
var N=false
for(var C=0;C<R.length;++C){var M=R[C]
if(Y(M,b)){M.count=(M.count||1)+(b.count||1)
N=true
break}}if(!N)R.push(b)}L[1]=JSON.stringify(R)
this.ops.splice(I,1);--I}else t[A]=I+1}t={}
for(var D=0;D<this.ops.length;++D){var P=this.ops[D]
if(P[0]!==q)continue
var k=[P[1],P[2],P[3],P[4],P[6],P[7],P[11]].join(",")
var B=t[k]
if(B){var U=this.ops[B-1]
V(U[5]>0)
V(P[5]>0)
U[5]+=P[5]
this.ops.splice(D,1);--D}else t[k]=D+1}t={}
for(var G=0;G<this.ops.length;++G){var F=this.ops[G]
if(F[0]!==X)continue
var W=[F[1],F[4],F[5]].join(",")
if(t[W]){var j=t[W]-1
var H=this.ops[j]
V.equal(H[3],F[2])
V.equal(H[6],F[6])
H[3]=F[3]
this.ops.splice(G,1);--G
if(H[2]===H[3]){this.ops.splice(j,1);--G
delete t[W]
for(var z in t)if(t[z]>j)--t[z]}}else t[W]=G+1}this.compress()
V(this.ops.length)}
Transaction.prototype.compress=function(){var e={}
for(var t=0;t<this.ops.length;++t){var r=this.ops[t]
if(r[0]!==J)continue
e[r[1]+","+r[3]+","+r[4]+","+r[5]+","+r[2]]=t+1}var a={}
var i=false
for(var o=0;o<this.ops.length;++o){if(a[o])continue
var n=this.ops[o]
if(n[0]!==J)continue
var s=n[1]+","+n[3]+","+n[4]+","+n[5]+","
var l=n[2]
var c=1
do{var _=e[""+s+(l+c)]
if(!_)break
i=a[_-1]=true
c++}while(true)
if(c>1){n[0]=I
V.equal(n.length,6)
n.push(c)}}if(i)this.ops=this.ops.filter(function(e,t){return!a[t]})}
function TransactionSet(e){for(var t in R)this[t]=null
this.trans_list=e||[]}TransactionSet.prototype.sendPristine=function(e,t){if(!this.pristine_sends)this.pristine_sends={}
V(!this.pristine_sends[e])
this.pristine_sends[e]=t}
TransactionSet.prototype.sendHexomeChoice=function(e,t){if(!this.hexome_choices)this.hexome_choices={}
V(!this.hexome_choices[e])
this.hexome_choices[e]=t}
TransactionSet.prototype.sendDetailData=function(e,t){if(!this.detail_data)this.detail_data={}
V(!this.detail_data[e])
this.detail_data[e]=t}
TransactionSet.prototype.trans=function(){var e=new Transaction(this)
this.trans_list.push(e)
return e}
TransactionSet.prototype.transPre=function(){var e=new Transaction(this)
V(!this.has_trans_pre)
this.has_trans_pre=true
this.trans_list.splice(0,0,e)
return e}
TransactionSet.prototype.get=function(e){return this.trans_list[e]}
TransactionSet.prototype.numTransactions=function(){return this.trans_list.length}
TransactionSet.prototype.toJSON=function(){var e={t:this.trans_list}
for(var t in R)if(this[t])e[R[t]]=this[t]
for(var r=0;r<this.trans_list.length;++r)if(this.trans_list[r].silent_error){e.s=e.s||{}
e.s[r]=1}return e}
TransactionSet.prototype.hasPristineSends=function(){return this.pristine_sends||this.hexome_choices||this.detail_data}
TransactionSet.prototype.mergePristineSends=function(e){for(var t in R)if(e[t]){if(!this[t])this[t]=e[t]
else for(var r in e[t]){V(!this[t][r])
this[t][r]=e[t][r]}e[t]=null}}
Transaction.prototype.fromJSON=function(e){this.ops=e}
TransactionSet.prototype.fromJSON=function(e){for(var t in R)V(!e[R[t]])
V(e.t&&e.t.length)
for(var r=0;r<e.t.length;++r)this.trans().fromJSON(e.t[r])}
function createTransSet(e){return new TransactionSet(e)}},{"../glov/common/util":330,"./globals":197,"./items_common":200,"./voxel_data_common":209,assert:void 0}],214:[function(e,t,r){"use strict"
var i=new function Storage(){this.setItem=function(e,t){this.storage[e]=t}
this.getItem=function(e){return this.storage[e]}
this.getStorageType=function(){return this.type}
try{window.localStorage.test="test"
this.storage=window.localStorage
this.type="localStorage"}catch(e){this.storage={}
this.type="in-memory"}};(function(){function setCanUseCookies(){if(document)if(document.cookie)return true
else{document.cookie="can_use_cookies=test;"
return document.cookie.indexOf("can_use_cookies")>-1}else return false}var e=setCanUseCookies()
var t
function getTLD(){var e=document.location.hostname.split(".")
for(var t=e.length-1;t>=0;t--){var r=e.slice(t).join(".")
document.cookie="get_tld=test;domain=."+r+";"
if(document.cookie.indexOf("get_tld")>-1){document.cookie="get_tld=;domain=."+r+";expires=Thu, 01 Jan 1970 00:00:01 GMT;"
return r}}return""}function generateUID(e){var t=e||"-"
function hex4(){return(65536*(1+Math.random())|0).toString(16).substring(1)}var r=(new Date).getTime().toString(16).slice(0,11)+(65536*(1+Math.random())|0).toString(16).substring(1,2)
return hex4()+hex4()+t+hex4()+t+hex4()+t+hex4()+t+r}function getGlobalUserIdFromStorage(){if(!t){t=generateUID()
i.setItem("globalUserId",t)}return t}function refreshUserIdCookie(){var e=new Date
e.setDate(e.getDate()+730)
document.cookie="_frvr="+t+"; path=/; expires="+new Date(e).toUTCString()+"; domain="+getTLD()+";"}function getGlobalUserIdFromCookie(){var e=document.cookie.match("^(?:.*_frvr=([^;]*)).*$")
t=e&&e[1]||generateUID()
refreshUserIdCookie()
return t}window.__FRVR.defaultGlobalUserId=function(){if(e)return getGlobalUserIdFromCookie()
return getGlobalUserIdFromStorage()}
window.__FRVR.globalUserId=window.__FRVR.defaultGlobalUserId
window.__FRVR.getChannel=function(){var e="other"
var t={edge:"web_edge",firefox:"web_firefox",opera:"web_opera",safari:"web_safari",chrome:"web_chrome",samsungBrowser:"web_samsung",samsungBrowserM4S:"web_samsung_m4s",silk:"web_silk",chromeWrapper:"chromeos",androidWrapper:"android",iOSWrapper:"ios",rcs:"rcs",samsungAppStore:"samsung_galaxy_store",facebookInstant:"facebook_instant",facebookAppWeb:"facebook_canvasweb",facebookApp:"facebook_canvas",samsungBixby:"bixby",samsungGameLauncher:"samsung_game_launcher",samsungInstantPlay:"samsung_instant_play",iMessageContext:"imessage",spilGamesWrapper:"spil",vkru:"vkru",okru:"okru",kongregate:"kongregate",kik:"kik",twitter:"twitter",twitch:"twitch",hago:"hago",oppoGlobal:"oppo_global",tMobile:"tmobile",huawei:"huawei",huaweiquickapp:"huawei_quick_app",yandex:"yandex",crazyGames:"crazy_games",lgtv:"lg_tv",jioStb:"jio_stb",myJio:"jio_my",rocketChat:"rocket_chat",ufone:"ufone",game8:"game8",microsoftPwa:"microsoft_pwa"}
var r=window.__FRVR.platformIs
for(var a in t)if(r[a])e=t[a]
if(("web_safari"===e||"web_chrome"===e)&&r.iOS)e+="_ios"
return e}
var a=window.location.href
window.__FRVR.getQueryString=function(e){var t=a
e=e.replace(/[\[\]]/g,"\\$&")
var r=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)","i").exec(t)
if(!r)return null
if(!r[2])return""
return decodeURIComponent(r[2].replace(/\+/g," "))}
window.__FRVR.platformIs=new function(e,t,r,a){var i,o
var n=this
n[window.__FRVR.buildTimePlatform]=true
n.android=/(android)/i.test(r)&&!/(Windows)/i.test(r)
n.androidVersion=function(){var e=window.navigator.userAgent.toLowerCase().match(/android\s([0-9\.]*)/)
return parseFloat(e?e[1]:0)}()
n.firefoxMobile=/(Mobile)/i.test(r)&&/(Firefox)/i.test(r)
n.slow=n.android&&n.androidVersion<6
n.iOS=/(ipod|iphone|ipad)/i.test(r)||/(Macintosh)/i.test(r)&&"ontouchend"in document
n.windowsMobile=/(IEMobile)/i.test(r)
n.silk=/(silk)/i.test(r)
n.clay=/(clay\.io)/i.test(a)
n.facebookApp=/(fb_canvas)/i.test(a)
n.facebookAppWeb=/(fb_canvas_web)/i.test(a)
n.iframed=e.top!==e.self
n.standalone="standalone"in t&&t.standalone
n.mobileiOSDevice=r.match(/iPhone/i)||r.match(/iPod/i)
n.kongregate=/(kongregateiframe)/i.test(a)
n.kik=/(kik_canvas)/i.test(a)
n.twitter=/(twitter)/gi.test(r)
n.chrome=/Chrome\//.test(r)
n.safari=Boolean(window.navigator.userAgent.match(/Version\/[\d\.]+.*Safari/))
n.secureConnection=0===window.location.protocol.indexOf("https")
n.facebookInstant=Boolean(window.FBInstant)
n.spilGamesWrapper=/(spilgames)/i.test(a)
n.social="on"===window.__FRVR.getQueryString("social")
n.advertisementIsDisabled="off"===window.__FRVR.getQueryString("ads")
n.advertisementInterstitialDisabled="off"===window.__FRVR.getQueryString("int")
n.advertisementOverlayEnabled=!n.iframed||n.spilGamesWrapper||window.__FRVR.getQueryString("partnerid")
n.nosoc="1"===window.__FRVR.getQueryString("nosoc")
n.facebookAd=/(\/\?fb)/i.test(a)
n.mobile=n.android||n.windowsMobile||n.iOS||n.silk||n.firefoxMobile
n.iOSWrapper=(null==(i=window.webkit)?void 0:null==(o=i.messageHandlers)?void 0:o.iosWrapper)||false
n.iPhoneXOrLater="true"===window.__FRVR.getQueryString("iPhoneXOrLater")
n.iMessageContext="true"===window.__FRVR.getQueryString("iMessage")
n.androidWrapper=window.androidwrapper||false
n.appWrapper=n.iOSWrapper||n.androidWrapper
n.chromeWrapper=e.isChromeWrapper||false
n.samsungAppStore="samsung"===window.__FRVR.getQueryString("androidStore")
n.usingWebGLRenderer=false
n.usingCanvasRenderer=false
n.jioStb=Boolean(n["jio-stb"])
n.myJio=Boolean(n.myjio)
n.jio=n.jioStb||n.myJio
n.twitch=""===window.__FRVR.getQueryString("twitch")
n.vkru=""===window.__FRVR.getQueryString("vkru")
n.okru=""===window.__FRVR.getQueryString("okru")
n.tMobile=""===window.__FRVR.getQueryString("tmobile")
n.pwa=""===window.__FRVR.getQueryString("pwa")
n.windowsApp=""===window.__FRVR.getQueryString("windowsapp")
n.enableAppStoreLinks=true
n.samsungGalaxyStorePWA=""===window.__FRVR.getQueryString("samsung")&&"galaxystore"===window.__FRVR.getQueryString("source")
n.samsungGameLauncherPWA=(""===window.__FRVR.getQueryString("pwa")||""===window.__FRVR.getQueryString("samsung"))&&"gamelauncher"===window.__FRVR.getQueryString("source")
n.samsungGameLauncher=window.FRVRInstant?true:""===window.__FRVR.getQueryString("gamelauncher")||"gamelauncher"===window.__FRVR.getQueryString("source")
n.samsungBixby=""===window.__FRVR.getQueryString("samsung")&&!n.samsungGalaxyStorePWA
n.samsungBrowserUK=""===window.__FRVR.getQueryString("samsungbuk")
n.samsungBrowserUS=""===window.__FRVR.getQueryString("samsungbus")
n.samsungBrowserSEA=""===window.__FRVR.getQueryString("samsungbsea")
n.samsungBrowser=""===window.__FRVR.getQueryString("samsungbrowser")
n.samsungGLFallback=""===window.__FRVR.getQueryString("gl_fallback")
n.samsungInstantPlay=Boolean(window.GSInstant)
n.samsung=n.samsungGalaxyStorePWA||n.samsungGameLauncherPWA||n.samsungGameLauncher||n.samsungBixby||n.samsungBrowserUK||n.samsungBrowserUK||n.samsungBrowserUS||n.samsungBrowserSEA||n.samsungBrowser||n.samsungGLFallback||n.samsungInstantPlay
n.rcs=window.__FRVR.getQueryString("rcsid")
n.rcsKr=""===window.__FRVR.getQueryString("rcskr")
n.huaweiquickapp=""===window.__FRVR.getQueryString("huaweiquickapp")
n.huawei=""===window.__FRVR.getQueryString("huawei")||n.huaweiquickapp
n.mozilla=""===window.__FRVR.getQueryString("mozilla")
n.miniclip=""===window.__FRVR.getQueryString("miniclip")
n.chromeOSDevice="true"===window.__FRVR.getQueryString("isChromeOSDevice")
n.opera=Boolean(e.opr)&&Boolean(e.opr.addons)||Boolean(e.opera)||r.indexOf(" OPR/")>=0
n.yandex=Boolean(window.YaGames)
n.firefox=void 0!==e.InstallTrigger
n.edge=/(edge|edgios|edga)\/((\d+)?[\w\.]+)/i.test(r)
n.oppoGlobal=""===window.__FRVR.getQueryString("oppo")
n.lgtv=""===window.__FRVR.getQueryString("lgtv")
n.crazyGames="8289067739"===window.__FRVR.getQueryString("partnerid")
n.mynet=""===window.__FRVR.getQueryString("mynet")
n.ufone="8416254215"===window.__FRVR.getQueryString("partnerid")
n.game8=""===window.__FRVR.getQueryString("game8")
n.partnerWrapper=n.mynet||n.tMobile||n.ufone
n.rocketChat=""===window.__FRVR.getQueryString("rocketchat")
n.progressiveWebAppEnabled=!n.chromeOSDevice&&!n.iframed&&!n.appWrapper&&!n.twitch&&!n.vkru&&!n.okru&&!n.facebookInstant&&!n.partnerWrapper
n.microsoftPwa=window.document&&window.document.referrer&&-1!==document.referrer.indexOf("app-info://platform/microsoft-store")||window.__FRVR.getQueryString("msstart_sdk_init")}(window,window.navigator,window.navigator.userAgent,document.location)})()},{}],215:[function(e,t,s){"use strict"
window.__FRVR={};(function(){var i=5
var l="2.0.0"
var c=5
var t=18e5
var _="/coeus.frvr.com/v1/tm5"
console.log("FRVR Analytics ["+l+"] ["+c+"]")
var u={}
var r=window.navigator&&"function"===typeof window.navigator.sendBeacon
var o=false
var a={protocol_version:"f",app_version:"av",app_build:"ab",cohort:"co",channel:"ch",games_played:"gp",play_session_id:"pi",play_session_count:"pc",days_elapsed:"de",facebook_player_id:"fi",facebook_context_type:"fc",facebook_entrypoint:"fe",facebook_referral_player_id:"fr",utm_source:"us",utm_medium:"um",utm_campaign:"uc",utm_term:"ut",utm_content:"uo",remote_user_id:"ru",global_user_id:"guid",device_width:"dw",device_height:"dh",non_interaction:"ni",country:"ct",event:"e",game:"g",user:"u",client_time:"t",value:"v",provider:"ao",ad_result:"ar",ad_response:"ag",ad_point:"ap",transport:"tr",web_url:"wu",retry:"r",label:"l",advertisement_id:"ai",script_version:"xv",cache_buster:"n",page_session_id:"si"}
var n=new function Storage(){try{window.localStorage.test="test"
this.storage=window.localStorage
this.type="localStorage"}catch(e){this.storage={}
this.type="in-memory"}this.setItem=function(e,t){this.storage[e]=t}
this.getItem=function(e){return this.storage[e]}
this.getStorageType=function(){return this.type}}
function generateUID(e){var t=e||"-"
function hex4(){return(65536*(1+Math.random())|0).toString(16).substring(1)}var r=(new Date).getTime().toString(16).slice(0,11)+(65536*(1+Math.random())|0).toString(16).substring(1,2)
return hex4()+hex4()+t+hex4()+t+hex4()+t+hex4()+t+r}var d="cookie"
function encodedQueryStringFromObject(e){var t=[]
for(var r in e)t.push(encodeURIComponent(r)+"="+("undefined"!==typeof e[r]&&null!==e[r]?encodeURIComponent(e[r]):""))
return t.join("&")}function sendData(t,r,a){a="undefined"!==typeof a?a:i
t(r,function(){if(a>0){var e=5e3*(Math.pow(2,i-a)+Math.random())
r.r=i-a+1
setTimeout(sendData.bind(void 0,t,r,--a),e)}})}function sendBeacon(e,t,r){if(window.navigator.sendBeacon(e,JSON.stringify(t)))return true
r()
return false}function sendXHR(e,t,r){var a=new window.XMLHttpRequest
if(a.overrideMimeType)a.overrideMimeType("text/plain; charset=UTF-8")
try{a.open("POST",e+"?"+encodedQueryStringFromObject(t),true)
a.setRequestHeader("Content-type","text/plain; charset=UTF-8")
a.withCredentials=true
a.onreadystatechange=function(){if(4===a.readyState){var e=a.status
a=a.onreadystatechange=null
if(200!==(e=Number(e))&&204!==e)r()
else o=true}}
a.send()}catch(e){r()}}function sendPixel(e,t,r){t.n=Math.random()
var a=document.createElement("img")
a.onload=function(){o=true
a.onerror=a.onload=null
a.parentElement.removeChild(a)}
a.onerror=function(){if("function"===typeof r)r()
a.onerror=null
a.parentElement.removeChild(a)}
a.src=e+"?"+encodedQueryStringFromObject(t)
a.style.display="none"
document.body.appendChild(a)}function getTransportMethod(e,t){if(r&&o){t.transport="bcn"
return sendBeacon.bind(void 0,e)}if(Boolean(window.XMLHttpRequest)&&"withCredentials"in new window.XMLHttpRequest){t.transport="xhr"
return sendXHR.bind(void 0,e)}t.transport="img"
return sendPixel.bind(void 0,e+"/i")}function compressContext(e){var t={}
for(var r in e)if(void 0!==e[r]&&null!==e[r])t[a[r]||r]=e[r]
return t}function getPageSessionId(){var e=n.getItem("pageSessionId")
if(!e){e=generateUID()
n.setItem("pageSessionId",e)}return e}function getPlaySessionId(){var e=n.getItem("playSessionId")
if(e)if(Number(n.getItem("playSessionIdTimeStamp"))+t<Date.now())e=null
if(!e){e=generateUID()
n.setItem("playSessionId",e)}n.setItem("playSessionIdTimeStamp",Date.now())
return e}var f
function dispatchEvent(e){var t=e.channel
var r=window.__FRVR.globalUserId()
for(var a in u)u[a](e)
var i="unknown://"
if(document&&document.location&&document.location.protocol)i=document.location.protocol
i=f||i
var o
if(document&&document.location&&document.location.href)o=document.location.href
var n=[i,_,e.context||"_unspecified_",r].join("/")
e.app_version=e.app_version||"0.0.0"
e.app_build=e.app_build||"000000"
e.channel=t||e.channel
e.web_url=o
e.script_version=l
e.protocol_version=c
e.page_session_id=e.page_session_id||getPageSessionId()
e.play_session_id=e.play_session_id||null
e.cache_buster=Math.random()
e.global_user_id=r
e.global_user_id_source=d
e.facebook_player_id=window.__FRVR.platformIs.facebookInstant&&window.FBInstant.player&&window.FBInstant.player.getID?window.FBInstant.player.getID():null
var s=60*(new Date).getTimezoneOffset()*1e3
e.client_time=new Date(Date.now()-s).toISOString().slice(0,-1)
sendData(getTransportMethod(n,e),compressContext(e))}function logEvent(e,t){if("object"===typeof e){t=e
e="__unspecified"}(t=t||{}).event=e
dispatchEvent(t)}function addFieldFunction(e,t){u[e]=t}function clearFieldFunction(e){if("*"===e){var t=u.basic;(u={}).basic=t
return}delete u[e]}function setProtocolOverride(e){f=e}(s=window.__FRVR.analytics={}).logEvent=logEvent
s.addFieldFunction=addFieldFunction
s.clearFieldFunction=clearFieldFunction
s.getPageSessionId=getPageSessionId
s.getPlaySessionId=getPlaySessionId
s.compressContext=compressContext
s.extraFieldFunctions=u
s.setProtocolOverride=setProtocolOverride})()
e("./early-utils.js")
e("./game-specifics.js")},{"./early-utils.js":214,"./game-specifics.js":216}],216:[function(e,t,r){"use strict"
var a=e("../../common/globals.js").CURRENT_VERSION;(function(){var t=window.__FRVR
t.analytics.addFieldFunction("basic",function(e){e.context="worlds"
e.app_build="1675164989368"
e.app_version=a
e.channel=t.getChannel()
e.play_session_id=t.analytics.getPlaySessionId()})})()},{"../../common/globals.js":197}],217:[function(e,t,r){"use strict"
r.clearPlatformAdapter=clearPlatformAdapter
r.getPlatformAdapter=getPlatformAdapter
r.initPlatformAdapter=initPlatformAdapter
var a=e("./huawei-quickapp/huawei-quickapp").huaweiInit
var i=e("./yandex/yandex").yandexInit
var o=e("./android/android").androidInit
var n=e("./ios/ios").iosInit
var s
var l={getName:function getName(){return"empty"},createAppShortcut:function createAppShortcut(){return null}}
function clearPlatformAdapter(){s=null}function getPlatformAdapter(){return s}function initPlatformAdapter(){return s=s||i()||a()||o()||n()||l}},{"./android/android":218,"./huawei-quickapp/huawei-quickapp":220,"./ios/ios":222,"./yandex/yandex":223}],218:[function(e,t,r){"use strict"
r.androidInit=androidInit
var a=e("../../../../glov/client/client_config").PLATFORM_ANDROID
var i=e("../../xplay/idfa/idfa").getIDFA
function androidInit(){if(!a)return null
i(function(e,t){if(t)window.__FRVR.analytics.logEvent("idfa",{idfa:t})})
return{getName:function getName(){return"android"},createAppShortcut:function createAppShortcut(){return null}}}},{"../../../../glov/client/client_config":243,"../../xplay/idfa/idfa":231}],219:[function(e,t,r){"use strict"
r.huaweiInitEvents=huaweiInitEvents
r.huaweiCall=huaweiCall
function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]
for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))e[a]=r[a]}return e}).apply(this,arguments)}var i
function buildCallbackRegistry(){var t=0
var r={}
return{register:function register(e){r[++t]=e
return t},clear:function clear(e){if(r[e])delete r[e]},get:function get(e){return r[e]}}}function installMessageHandler(r){var a=window.system.onmessage
window.system.onmessage=function(e){var t
try{t=e&&"{"===e[0]&&JSON.parse(e)}catch(e){console.error(e)}if("object"===typeof t&&t.event)r(t)
if(a)a(e)}}function handleIncomingEvent(e){var t=e.id
var r=t&&i.get(t)
if(r){i.clear(t)
switch(e.event){case"iap-response":case"shortcut-response":r(null,e.data)
break
case"iap-error":case"shortcut-error":r(e.err)}}}function huaweiInitEvents(){if(!i){i=buildCallbackRegistry()
installMessageHandler(handleIncomingEvent)}return true}function huaweiCall(e,t,r){var a=_extends({},t,{event:e,id:i.register(r)})
window.system.postMessage(JSON.stringify(a))}},{}],220:[function(e,t,r){"use strict"
r.huaweiInit=huaweiInit
var a=e("./is-huawei"),i=a.isHuaweiEnabled,o=a.isHuaweiValid
var n=e("./huawei-events"),s=n.huaweiCall,l=n.huaweiInitEvents
var c=e("../../../../glov/client/fscreen.js").fscreenDisable
function createAppShortcut(r){s("shortcut-is-installed",{},function(e,t){if(e||t){if(r)r(e,t)
return}s("shortcut-install",{},r)})}function huaweiInit(){if(!i()||!o())return null
l()
c()
return{getName:function getName(){return"huawei-quickapp"},createAppShortcut:createAppShortcut}}},{"../../../../glov/client/fscreen.js":262,"./huawei-events":219,"./is-huawei":221}],221:[function(e,t,r){"use strict"
r.isHuaweiValid=isHuaweiValid
r.clearIsHuaweiCache=r.isHuaweiEnabled=void 0
function getQueryStringValue(e){var t=window.location.href
var r=e.replace(/[[\]]/g,"\\$&")
var a=new RegExp("[?&]"+r+"(=([^&#]*)|&|#|$)","i").exec(t)
if(!a)return null
if(!a[2])return""
return decodeURIComponent(a[2].replace(/\+/g," "))}function hasHuaweiURLFlag(){return""===getQueryStringValue("huaweiquickapp")}function cached(e){var t=false
var r
return[function(){if(!t){r=e.apply(void 0,arguments)
t=true}return r},function(){t=false}]}var a=cached(hasHuaweiURLFlag),i=a[0],o=a[1]
r.clearIsHuaweiCache=o
r.isHuaweiEnabled=i
function isHuaweiValid(){return window.system&&window.system.postMessage}},{}],222:[function(e,t,r){"use strict"
r.iosInit=iosInit
var a=e("../../../../glov/client/client_config").PLATFORM_IOS
var i=e("../../xplay/idfa/idfa").getIDFA
function iosInit(){if(!a)return null
i(function(e,t){if(t)window.__FRVR.analytics.logEvent("idfa",{idfa:t})})
return{getName:function getName(){return"ios"},createAppShortcut:function createAppShortcut(){return null}}}},{"../../../../glov/client/client_config":243,"../../xplay/idfa/idfa":231}],223:[function(e,t,r){"use strict"
r.yandexInit=yandexInit
function yandexInit(){if(!window.YaGames)return null
return{getName:function getName(){return"yandex"},createAppShortcut:function createAppShortcut(){return null}}}},{}],224:[function(e,t,r){"use strict"
r.isAvailable=isAvailable
r.graphAPI=graphAPI
r.getAuthToken=getAuthToken
r.login=login
r.logout=logout
r.shareLink=shareLink
r.getFbAccountUserIdForAppId=getFbAccountUserIdForAppId
var a=e("./mobile.js")
var i=e("./web.js")
var n=e("../../../../glov/client/client_config.js").PLATFORM_MOBILE?a:i
function isAvailable(){return n.isAvailable()}function graphAPI(e,t,r,a){n.graphAPI(e,t,r,function(e,t){if(e)a(e)
else if(null!=t&&t.error){var r
a(null!=(r=t.error.message)?r:"Unknown error")}else a(null,t)})}function getAuthToken(e){n.getAuthToken(e)}function login(e,t){n.login(e,t)}function logout(){n.logout()}function shareLink(e,t,r,a,i,o){n.shareLink(e,t,r,a,i,o)}function getFbAccountUserIdForAppId(e,t){n.getFbAccountUserIdForAppId(e,t)}},{"../../../../glov/client/client_config.js":243,"./mobile.js":225,"./web.js":226}],225:[function(e,t,r){"use strict"
r.isAvailable=isAvailable
r.graphAPI=graphAPI
r.getAuthToken=getAuthToken
r.login=login
r.logout=logout
r.shareLink=shareLink
var s=e("../host/host.js")
function isAvailable(){return true}function graphAPI(e,t,r,a){s.call("facebook.graphapi",{endpoint:e,method:t,params:r},function(e){if(!a)return
if(e.result)a(null,e.result)
else a("Facebook Graph API failed - "+e.error)})}function getAuthToken(t){s.call("facebook.getauthtoken",{},function(e){if(!t)return
if(Object.prototype.hasOwnProperty.call(e,"error"))t(e.error)
else if(!e.token)t("Facebook relogin failed - token not defined")
else t(null,e)})}function login(e,t){var r={}
for(var a=0;a<=e.length;++a)r["permission"+a]=e[a]
s.call("facebook.login",r,function(e){if(!t)return
if(Object.prototype.hasOwnProperty.call(e,"error"))t(e.error)
else if(!e.token)t("Facebook login failed - token not defined")
else t(null,e)})}function logout(){s.call("facebook.logout",{})}function shareLink(e,t,r,a,i,o){var n={url:e,title:t,imageurl:r,description:a,inmessenger:i}
s.call("facebook.sharelink",n,function(e){o(e.result)})}},{"../host/host.js":228}],226:[function(e,t,r){"use strict"
r.isAvailable=isAvailable
r.graphAPI=graphAPI
r.getAuthToken=getAuthToken
r.login=login
r.logout=logout
var i="Facebook script not imported"
var a="Facebook login failed"
function isAvailable(){return window.FB}function graphAPI(e,t,r,a){if(!window.FB){if(a)a(i)
return}window.FB.api(e,t,r,function(e){if(a)a(null,e)})}function getAuthToken(r){if(!window.FB){if(r)r(i)
return}window.FB.getLoginStatus(function(e){var t
try{if("connected"===e.status)t={token:e.authResponse.accessToken,expiration:e.authResponse.expiresIn,userID:e.authResponse.userID}}catch(e){}if(t)r(null,t)
else r(a)})}function login(e,r){if(!window.FB){if(r)r(i)
return}window.FB.login(function(e){var t
try{if("connected"===e.status)t={token:e.authResponse.accessToken,expiration:e.authResponse.expiresIn,userID:e.authResponse.userID}}catch(e){}if(t){if(r)r(null,t)}else if(r)r(a)},{scope:e})}function logout(){if(!window.FB)return
window.FB.logout()}},{}],227:[function(e,t,r){"use strict"
r.sendToHost=sendToHost
function sendToHost(e){window.androidwrapper.postMessage(e)}},{}],228:[function(e,t,r){"use strict"
r.call=call
r.callResult=callResult
r.log=log
var a=e("../../../../glov/client/client_config.js"),i=a.PLATFORM_ANDROID,o=a.PLATFORM_IOS
var n=o?e("./ios.js"):null
var s=i?e("./android.js"):null
function sendToHostUndefined(e){console.error("Host not defined")}var l=o?n.sendToHost:i?s.sendToHost:sendToHostUndefined
var c={}
var _=0
function call(e,t,r){if(null!==r){var a="cb"+ ++_
c[a]=r
t._callback=a}t._method=e
l("json1:"+JSON.stringify(t))}function callResult(e){var t=e.indexOf(":")
if(t>0){var r=e.substring(0,t)
var a=e.substring(t+1)
switch(r){case"json1":var i=JSON.parse(a)
var o=c[i._callback]
if(o){delete c[i._callback]
delete i._callback
o(i)}}}}function log(e){call("log",{message:""+e})}window.Host={}
window.Host.callResult=callResult},{"../../../../glov/client/client_config.js":243,"./android.js":227,"./ios.js":229}],229:[function(e,t,r){"use strict"
r.sendToHost=sendToHost
function sendToHost(e){window.webkit.messageHandlers.iosWrapper.postMessage(e)}},{}],230:[function(e,t,r){"use strict"
r.getIDFA=getIDFA
var a=e("../host/host")
function getIDFA(t){a.call("googlemobileadsinterstitial.getidfa",{},function(e){if(t)t(""===e.result?null:e.result)})}},{"../host/host":228}],231:[function(e,t,r){"use strict"
r.getIDFA=getIDFA
var a=e("../../../../glov/client/client_config"),i=a.PLATFORM_ANDROID,o=a.PLATFORM_IOS
var n=o?e("./ios.js"):null
var s=i?e("./android.js"):null
function sendToHostUndefined(e){console.error("Host not defined")}var l=o?n.getIDFA:i?s.getIDFA:sendToHostUndefined
function getIDFA(t){l(function(e){if(t)t(e?e.error:null,e)})}},{"../../../../glov/client/client_config":243,"./android.js":230,"./ios.js":232}],232:[function(e,t,r){"use strict"
r.getIDFA=getIDFA
var a=e("../host/host")
function getIDFA(t){a.call("ios.getidfa",{},function(e){if(t)t(""===e.result?null:e.result)})}},{"../host/host":228}],233:[function(e,t,r){"use strict"
r.xplayGetCurrentLoginProvider=xplayGetCurrentLoginProvider
r.xplaySetup=xplaySetup
r.xplayIsLoggedIn=xplayIsLoggedIn
r.xplayReLoginAutomatic=xplayReLoginAutomatic
r.xplayLogin=xplayLogin
r.xplayLogout=xplayLogout
r.xplayIsAvailable=xplayIsAvailable
r.XplayLoginProvider=void 0
var a=e("../../../glov/client/local_storage.js")
var i=e("./facebook/facebook.js")
var o=e("../../../glov/client/client_config.js").PLATFORM_IOS?e("./signin_with_apple/ios.js"):null
var n=e("./yandex/yandex.js")
var s="Login provider not defined"
var l=Object.freeze({Facebook:"Facebook",SignInWithApple:"SignInWithApple",Yandex:"Yandex"})
r.XplayLoginProvider=l
var c=false
function setCurrentLoginProvider(e){a.set("xplay.loginProviderKey",e)}function xplayGetCurrentLoginProvider(){return a.get("xplay.loginProviderKey")}function promptLoginFB(e){i.login(["gaming_profile","email","user_friends"],e)}function promptLoginApple(e){o.promptLogin(e)}function promptLoginYandex(e){n.login(e)}function xplaySetup(){c=true}function xplayIsLoggedIn(){return Boolean(xplayGetCurrentLoginProvider())}function relogin(r,a){switch(r){case l.Facebook:return void i.getAuthToken(function(e,t){if(e){setCurrentLoginProvider(void 0)
return void a(e)}return void a(null,{provider:r,result:t})})
case l.SignInWithApple:return void o.isLogged(function(e,t){if(e){setCurrentLoginProvider(void 0)
return void a(e)}return void a(null,{provider:r,result:t})})
case l.Yandex:return void n.login(function(e,t){if(e)return void a(e)
return void a(null,{provider:r,result:t})})
default:return void a(s)}}function xplayReLoginAutomatic(e){return relogin(xplayGetCurrentLoginProvider(),e)}function xplayLogin(r,a){if(!c)return void a("Not initialized")
var e
switch(r){case l.Facebook:e=promptLoginFB
break
case l.SignInWithApple:e=promptLoginApple
break
case l.Yandex:e=promptLoginYandex
break
default:return void a(s)}e(function(e,t){if(!a)return
if(e){setCurrentLoginProvider()
return void a(e)}setCurrentLoginProvider(r)
return void a(null,t)})}function xplayLogout(e){e=e||function(){}
if(!c)return void e("Not initialized")
if(!xplayIsLoggedIn())return void e("User is already logged out")
var t
switch(xplayGetCurrentLoginProvider()){case l.Facebook:t=i.logout
break
case l.SignInWithApple:t=o.logout
break
default:return void e(s)}setCurrentLoginProvider(void 0)
return void t(e)}function xplayIsAvailable(e){switch(e){case l.Facebook:return null==i?void 0:i.isAvailable()
case l.SignInWithApple:return null==o?void 0:o.isAvailable()
default:return false}}},{"../../../glov/client/client_config.js":243,"../../../glov/client/local_storage.js":274,"./facebook/facebook.js":224,"./signin_with_apple/ios.js":234,"./yandex/yandex.js":235}],234:[function(e,t,r){"use strict"
r.isAvailable=isAvailable
r.isLogged=isLogged
r.promptLogin=promptLogin
r.logout=logout
var a=e("../../../../glov/client/client_config").PLATFORM_IOS
var i=e("../host/host.js")
var o=false
if(a)i.call("applesignin.isAvailable",{},function(e){o=!e.error&&e.result})
function isAvailable(){return o}function isLogged(t){i.call("applesignin.isLogged",{},function(e){if(!t)return
if(Object.prototype.hasOwnProperty.call(e,"error"))t(e.error)
else if(!e.loginCredentials)t("Login credentials not defined")
else if(t)t(e.error,e.loginCredentials)})}function promptLogin(t){i.call("applesignin.login",{},function(e){if(!t)return
if(Object.prototype.hasOwnProperty.call(e,"error"))t(e.error)
else if(!e.loginCredentials)t("Login credentials not defined")
else if(t)t(e.error,e.loginCredentials)})}function logout(t){i.call("applesignin.logout",{},function(e){if(t)t(e.error,e)})}},{"../../../../glov/client/client_config":243,"../host/host.js":228}],235:[function(e,t,r){"use strict"
r.login=login
function initYandexPlayer(t){return window.ysdk.getPlayer({signed:true,scopes:true}).then(function(e){t(null,e.signature)})}function initYandex(){if(!window.YaGames){console.error("[yandex] sdk not available")
return new Promise(function(e){return e(false)})}if(window.ysdk){console.error("[yandex] sdk already initialized")
return new Promise(function(e){return e(true)})}return window.YaGames.init().then(function(e){if(!e){console.error("[yandex] ysdk is not available")
return false}window.ysdk=e
return true})}function login(t){return initYandex().then(function(e){if(!e)return void t("[yandex] sdk not initialized")
initYandexPlayer(t).catch(function(e){console.warn("User not authorized in yandex",e)
window.ysdk.auth.openAuthDialog().then(function(){initYandexPlayer(t).catch(function(e){console.warn("User not authorized in yandex "+e)
t("Authentication failed")})}).catch(function(e){console.warn("User not authorized in yandex again "+e)
t("Authentication failed")})})})}},{}],236:[function(e,t,r){"use strict"
r.create=create
var m=e("assert")
var R=-1
function AABBTreeNode(e,t,r){this.escapeNodeOffset=t
this.externalNode=r
this.extents=e
return this}AABBTreeNode.prototype.isLeaf=function(){return Boolean(this.externalNode)}
AABBTreeNode.prototype.reset=function(e,t,r,a,i,o,n,s){this.escapeNodeOffset=n
this.externalNode=s
var l=this.extents
l[0]=e
l[1]=t
l[2]=r
l[3]=a
l[4]=i
l[5]=o}
AABBTreeNode.prototype.clear=function(){this.escapeNodeOffset=1
this.externalNode=void 0
var e=this.extents
var t=Number.MAX_VALUE
e[0]=t
e[1]=t
e[2]=t
e[3]=-t
e[4]=-t
e[5]=-t}
AABBTreeNode.create=function(e,t,r){return new AABBTreeNode(e,t,r)}
var g=32
var a=0
function AABBTree(e){this.nodes=[]
this.endNode=0
this.needsRebuild=false
this.needsRebound=false
this.numAdds=0
this.numUpdates=0
this.numExternalNodes=0
this.startUpdate=2147483647
this.endUpdate=-2147483647
this.highQuality=Boolean(e.highQuality)
this.name=e.name
this.log_rebuilds=e.log_rebuilds
this.nodesStack=new Array(32)
this.spat_id="_spat"+ ++a}var i=128
var o=[]
AABBTree.allocateNode=function(){if(!o.length)for(var e=0;e<i;e++){var t=new Float32Array(6)
o[e]=AABBTreeNode.create(t,1,void 0)}return o.pop()}
AABBTree.releaseNode=function(e){if(o.length<i){e.clear()
o.push(e)}}
AABBTree.recycleNodes=function(e,t){var r=e.length
var a
for(a=t;a<r;a++){var i=e[a]
if(i)this.releaseNode(i)}e.length=t}
AABBTree.prototype.add=function(e,t){var r=this.endNode
e[this.spat_id]=r
var a=AABBTree.allocateNode()
a.escapeNodeOffset=1
a.externalNode=e
var i=a.extents
i[0]=t[0]
i[1]=t[1]
i[2]=t[2]
i[3]=t[3]
i[4]=t[4]
i[5]=t[5]
this.nodes[r]=a
this.endNode=r+1
this.numAdds++
this.numExternalNodes++
if(this.numAdds>.2*this.numExternalNodes||this.numAdds>100)this.needsRebuild=true}
AABBTree.prototype.remove=function(e){var t=e[this.spat_id]
if(void 0!==t){if(this.numExternalNodes>1){var r=this.nodes
m(r[t].externalNode===e)
r[t].externalNode=R
this.numExternalNodes--}else this.clear()
e[this.spat_id]=void 0}}
AABBTree.prototype.findParent=function(e){var t=this.nodes
var r=e
var a=0
var i
do{a++
i=t[--r]}while(i&&i.escapeNodeOffset<=a)
return i}
AABBTree.prototype.update=function(e,t){var r=e[this.spat_id]
if(void 0!==r){var a=t[0]
var i=t[1]
var o=t[2]
var n=t[3]
var s=t[4]
var l=t[5]
var c=this.needsRebuild
var _=this.needsRebound
var u=this.nodes
var d=u[r]
m(d.externalNode===e)
var f=d.extents
var v=c||_||f[0]>a||f[1]>i||f[2]>o||f[3]<n||f[4]<s||f[5]<l
f[0]=a
f[1]=i
f[2]=o
f[3]=n
f[4]=s
f[5]=l
if(v)if(!c&&u.length>1){this.numUpdates++
if(this.startUpdate>r)this.startUpdate=r
if(this.endUpdate<r)this.endUpdate=r
if(!_)if(2*this.numUpdates>this.numExternalNodes)this.needsRebound=true
else{var h=this.findParent(r)
if(h){var p=h.extents
if(p[0]>a||p[1]>i||p[2]>o||p[3]<n||p[4]<s||p[5]<l)this.needsRebound=true}}else if(this.numUpdates>3*this.numExternalNodes){this.needsRebuild=true
this.numAdds=this.numUpdates}}}else this.add(e,t)}
AABBTree.prototype.needsFinalize=function(){return this.needsRebuild||this.needsRebound}
AABBTree.prototype.finalize=function(){if(this.needsRebuild){this.rebuild()
return true}else if(this.needsRebound){this.rebound()
return true}return false}
AABBTree.prototype.rebound=function(){var e=this.nodes
if(e.length>1){var t=this.startUpdate
var r=this.endUpdate
var a=this.nodesStack
var i=0
var o=0
for(;;){var n=e[o]
var s=o
var l=o+n.escapeNodeOffset
var c=o+1
var _=void 0
do{var u=c+(_=e[c]).escapeNodeOffset
if(c<r){if(!_.externalNode)if(u>t){a[i]=o
i++
o=c}}else break
c=u}while(c<l)
if(o===s){var d=(_=e[c=o+1]).extents
var f=d[0]
var v=d[1]
var h=d[2]
var p=d[3]
var m=d[4]
var g=d[5]
c+=_.escapeNodeOffset
while(c<l){if(f>(d=(_=e[c]).extents)[0])f=d[0]
if(v>d[1])v=d[1]
if(h>d[2])h=d[2]
if(p<d[3])p=d[3]
if(m<d[4])m=d[4]
if(g<d[5])g=d[5]
c+=_.escapeNodeOffset}(d=n.extents)[0]=f
d[1]=v
d[2]=h
d[3]=p
d[4]=m
d[5]=g
r=o
if(i>0)o=a[--i]
else break}}}this.needsRebuild=false
this.needsRebound=false
this.numAdds=0
this.startUpdate=2147483647
this.endUpdate=-2147483647}
AABBTree.prototype.rebuild=function(){if(this.numExternalNodes>0){var e=Date.now()
var t=this.nodes
var r
var a
if(this.numExternalNodes===t.length){a=(r=t).length
this.nodes=t=[]}else{(r=[]).length=this.numExternalNodes
var i=this.endNode
for(var o=a=0;o<i;o++){var n=t[o]
if(n.externalNode)if(n.externalNode!==R){t[o]=void 0
r[a]=n
a++}}if(r.length>a)r.length=a}var s
if(a>1){if(a>g&&this.numAdds>0)if(this.highQuality)this._sortNodesHighQuality(r)
else this._sortNodes(r)
var l=this._predictNumNodes(0,a,0)
if(t.length>l)AABBTree.recycleNodes(t,l)
this._recursiveBuild(r,0,a,0)
var c=t[0].escapeNodeOffset
if(t.length>c)AABBTree.recycleNodes(t,c)
this.endNode=c}else{(s=r[0]).externalNode[this.spat_id]=0
t.length=1
t[0]=s
this.endNode=1}r=null
var _=Date.now()-e
if(this.log_rebuilds&&_>1)console.log("AABBTree.rebuild("+this.name+") in "+_+"ms")}this.needsRebuild=false
this.needsRebound=false
this.numAdds=0
this.numUpdates=0
this.startUpdate=2147483647
this.endUpdate=-2147483647}
function medianFn(e,t,r){if(e<t)if(t<r)return t
else if(e<r)return r
else return e
else if(e<r)return e
else if(t<r)return r
return t}function nthElement(e,t,r,a,i){while(a-t>8){var o=medianFn(i(e[t]),i(e[t+(a-t>>1)]),i(e[a-1]))
var n=t
var s=a
var l=void 0
for(;;n++){while(i(e[n])<o)n++
do{s--}while(o<i(e[s]))
if(n>=s){l=n
break}else{var c=e[n]
e[n]=e[s]
e[s]=c}}if(l<=r)t=l
else a=l}var _=t+1
while(_!==a){var u=e[_]
var d=i(u)
var f=_
var v=_-1
while(f!==t&&d<i(e[v])){e[f]=e[v]
f--
v--}if(f!==_)e[f]=u
_++}}function getkeyXfn(e){var t=e.extents
return t[0]+t[3]}function getkeyYfn(e){var t=e.extents
return t[1]+t[4]}function getkeyZfn(e){var t=e.extents
return t[2]+t[5]}function getreversekeyXfn(e){var t=e.extents
return-(t[0]+t[3])}function getreversekeyYfn(e){var t=e.extents
return-(t[1]+t[4])}function getreversekeyZfn(e){var t=e.extents
return-(t[2]+t[5])}AABBTree.prototype._sortNodes=function(i){var e=i.length
var o=false
function sortNodesRecursive(e,t,r){var a=e+t>>1
if(0===r)if(o)nthElement(i,e,a,t,getreversekeyXfn)
else nthElement(i,e,a,t,getkeyXfn)
else if(2===r)if(o)nthElement(i,e,a,t,getreversekeyZfn)
else nthElement(i,e,a,t,getkeyZfn)
else if(o)nthElement(i,e,a,t,getreversekeyYfn)
else nthElement(i,e,a,t,getkeyYfn)
if(0===r)r=2
else if(2===r)r=1
else r=0
o=!o
if(e+g<a)sortNodesRecursive(e,a,r)
if(a+g<t)sortNodesRecursive(a,t,r)}sortNodesRecursive(0,e,0)}
AABBTree.prototype._sortNodesNoY=function(i){var e=i.length
var o=false
function sortNodesNoYRecursive(e,t,r){var a=e+t>>1
if(0===r)if(o)nthElement(i,e,a,t,getreversekeyXfn)
else nthElement(i,e,a,t,getkeyXfn)
else if(o)nthElement(i,e,a,t,getreversekeyZfn)
else nthElement(i,e,a,t,getkeyZfn)
if(0===r)r=2
else r=0
o=!o
if(e+g<a)sortNodesNoYRecursive(e,a,r)
if(a+g<t)sortNodesNoYRecursive(a,t,r)}sortNodesNoYRecursive(0,e,0)}
function getkeyXZfn(e){var t=e.extents
return t[0]+t[2]+t[3]+t[5]}function getkeyZXfn(e){var t=e.extents
return t[0]-t[2]+t[3]-t[5]}function getreversekeyXZfn(e){var t=e.extents
return-(t[0]+t[2]+t[3]+t[5])}function getreversekeyZXfn(e){var t=e.extents
return-(t[0]-t[2]+t[3]-t[5])}function calculateSAH(e,t,r){var a=e[t]
var i=a.extents
var o=i[0]
var n=i[1]
var s=i[2]
var l=i[3]
var c=i[4]
var _=i[5]
for(var u=t+1;u<r;u++){if(o>(i=(a=e[u]).extents)[0])o=i[0]
if(n>i[1])n=i[1]
if(s>i[2])s=i[2]
if(l<i[3])l=i[3]
if(c<i[4])c=i[4]
if(_<i[5])_=i[5]}return l-o+(c-n)+(_-s)}AABBTree.prototype._sortNodesHighQuality=function(l){var e=l.length
var c=false
function sortNodesHighQualityRecursive(e,t){var r=e+t>>1
nthElement(l,e,r,t,getkeyXfn)
var a=calculateSAH(l,e,r)+calculateSAH(l,r,t)
nthElement(l,e,r,t,getkeyYfn)
var i=calculateSAH(l,e,r)+calculateSAH(l,r,t)
nthElement(l,e,r,t,getkeyZfn)
var o=calculateSAH(l,e,r)+calculateSAH(l,r,t)
nthElement(l,e,r,t,getkeyXZfn)
var n=calculateSAH(l,e,r)+calculateSAH(l,r,t)
nthElement(l,e,r,t,getkeyZXfn)
var s=calculateSAH(l,e,r)+calculateSAH(l,r,t)
if(a<=i&&a<=o&&a<=n&&a<=s)if(c)nthElement(l,e,r,t,getreversekeyXfn)
else nthElement(l,e,r,t,getkeyXfn)
else if(o<=i&&o<=n&&o<=s)if(c)nthElement(l,e,r,t,getreversekeyZfn)
else nthElement(l,e,r,t,getkeyZfn)
else if(i<=n&&i<=s)if(c)nthElement(l,e,r,t,getreversekeyYfn)
else nthElement(l,e,r,t,getkeyYfn)
else if(n<=s)if(c)nthElement(l,e,r,t,getreversekeyXZfn)
else nthElement(l,e,r,t,getkeyXZfn)
else if(c)nthElement(l,e,r,t,getreversekeyZXfn)
else nthElement(l,e,r,t,getkeyZXfn)
c=!c
if(e+g<r)sortNodesHighQualityRecursive(e,r)
if(r+g<t)sortNodesHighQualityRecursive(r,t)}sortNodesHighQualityRecursive(0,e)}
AABBTree.prototype._recursiveBuild=function(e,t,r,a){var i=this.nodes
var o=a
a++
var n
var s
var l
var c
var _
var u
var d
var f
var v
if(t+g>=r){n=(d=(f=e[t]).extents)[0]
s=d[1]
l=d[2]
c=d[3]
_=d[4]
u=d[5]
f.externalNode[this.spat_id]=a
this._replaceNode(i,a,f)
for(var h=t+1;h<r;h++){if(n>(d=(f=e[h]).extents)[0])n=d[0]
if(s>d[1])s=d[1]
if(l>d[2])l=d[2]
if(c<d[3])c=d[3]
if(_<d[4])_=d[4]
if(u<d[5])u=d[5]
a++
f.externalNode[this.spat_id]=a
this._replaceNode(i,a,f)}v=i[a]}else{var p=t+r>>1
if(t+1>=p){(f=e[t]).externalNode[this.spat_id]=a
this._replaceNode(i,a,f)}else this._recursiveBuild(e,t,p,a)
n=(d=(v=i[a]).extents)[0]
s=d[1]
l=d[2]
c=d[3]
_=d[4]
u=d[5]
a+=v.escapeNodeOffset
if(p+1>=r){(f=e[p]).externalNode[this.spat_id]=a
this._replaceNode(i,a,f)}else this._recursiveBuild(e,p,r,a)
if(n>(d=(v=i[a]).extents)[0])n=d[0]
if(s>d[1])s=d[1]
if(l>d[2])l=d[2]
if(c<d[3])c=d[3]
if(_<d[4])_=d[4]
if(u<d[5])u=d[5]}var m=i[o]
if(void 0===m)i[o]=m=AABBTree.allocateNode()
m.reset(n,s,l,c,_,u,a+v.escapeNodeOffset-o)}
AABBTree.prototype._replaceNode=function(e,t,r){var a=e[t]
e[t]=r
if(void 0!==a)AABBTree.releaseNode(a)}
AABBTree.prototype._predictNumNodes=function(e,t,r){r++
if(e+g>=t)r+=t-e
else{var a=e+t>>1
if(e+1>=a)r++
else r=this._predictNumNodes(e,a,r)
if(a+1>=t)r++
else r=this._predictNumNodes(a,t,r)}return r}
AABBTree.prototype.getVisibleNodes=function(e,t,r){var a=0
if(this.numExternalNodes>0){var i=0
var o=Date.now()
var n=this.nodes
var s=this.endNode
var l=e.length
var c=void 0===r?t.length:r
var _,u,d
var f,v,h,p,m,g
var E,y,T,I,S,A
var w=0
for(;;){f=(u=(_=n[w]).extents)[0]
v=u[1]
h=u[2]
p=u[3]
m=u[4]
g=u[5]
E=true
y=0
do{if((I=(T=e[y])[0])*(I<0?f:p)+(S=T[1])*(S<0?v:m)+(A=T[2])*(A<0?h:g)<T[3]){E=false
break}y++}while(y<l)
if(E)if(_.externalNode){if(_.externalNode===R)++i
else{t[c]=_.externalNode
c++
a++}if(++w>=s)break}else{y=0
do{if((I=(T=e[y])[0])*(I>0?f:p)+(S=T[1])*(S>0?v:m)+(A=T[2])*(A>0?h:g)<T[3]){E=false
break}y++}while(y<l)
if(E){d=w+_.escapeNodeOffset
w++
do{if((_=n[w]).externalNode)if(_.externalNode===R)++i
else{t[c]=_.externalNode
c++
a++}w++}while(w<d)
if(w>=s)break}else w++}else if((w+=_.escapeNodeOffset)>=s)break}var L=Date.now()-o
if(i>30&&i>5*a&&L>1)this.needsRebuild=true}return a}
AABBTree.prototype.getOverlappingNodes=function(e,t,r){if(this.numExternalNodes>0){var a=e[0]
var i=e[1]
var o=e[2]
var n=e[3]
var s=e[4]
var l=e[5]
var c=this.nodes
var _=this.endNode
var u,d,f
var v=0
var h=void 0===r?t.length:r
var p=0
for(;;){var m=(d=(u=c[p]).extents)[0]
var g=d[1]
var E=d[2]
var y=d[3]
var T=d[4]
var I=d[5]
if(a<=y&&i<=T&&o<=I&&n>=m&&s>=g&&l>=E)if(u.externalNode){if(u.externalNode!==R){t[h]=u.externalNode
h++
v++}if(++p>=_)break}else if(n>=y&&s>=T&&l>=I&&a<=m&&i<=g&&o<=E){f=p+u.escapeNodeOffset
p++
do{if((u=c[p]).externalNode&&u.externalNode!==R){t[h]=u.externalNode
h++
v++}p++}while(p<f)
if(p>=_)break}else p++
else if((p+=u.escapeNodeOffset)>=_)break}return v}else return 0}
AABBTree.prototype.getExtents=function(){return this.nodes.length>0?this.nodes[0].extents:null}
AABBTree.prototype.getRootNode=function(){return this.nodes[0]}
AABBTree.prototype.getNodes=function(){return this.nodes}
AABBTree.prototype.getEndNodeIndex=function(){return this.endNode}
AABBTree.prototype.getNumLeaves=function(){return this.numExternalNodes}
AABBTree.prototype.clear=function(){if(this.nodes.length)AABBTree.recycleNodes(this.nodes,0)
this.endNode=0
this.needsRebuild=false
this.needsRebound=false
this.numAdds=0
this.numUpdates=0
this.numExternalNodes=0
this.startUpdate=2147483647
this.endUpdate=-2147483647}
AABBTree.rayTest=function(e,l,c){var t=l.origin
var r=l.direction
var h=t[0]
var p=t[1]
var m=t[2]
var g=r[0]
var E=r[1]
var y=r[2]
var T=1/g
var I=1/E
var S=1/y
function distanceExtents(e,t){var r=e[0]
var a=e[1]
var i=e[2]
var o=e[3]
var n=e[4]
var s=e[5]
if(r<=h&&h<=o&&a<=p&&p<=n&&i<=m&&m<=s)return 0
var l,c
var _,u
var d
if(g>=0){l=0===(d=r-h)?0:d*T
c=0===(d=o-h)?0:d*T}else{l=(o-h)*T
c=(r-h)*T}if(E>=0){_=0===(d=a-p)?0:d*I
u=0===(d=n-p)?0:d*I}else{_=(n-p)*I
u=(a-p)*I}if(l>u||_>c)return
if(_>l)l=_
if(u<c)c=u
var f,v
if(y>=0){f=0===(d=i-m)?0:d*S
v=0===(d=s-m)?0:d*S}else{f=(s-m)*S
v=(i-m)*S}if(l>v||f>c)return
if(f>l)l=f
if(v<c)c=v
if(l<0)l=c
return l>=0&&l<t?l:void 0}var _=[]
var u=null
function processNode(e,t,r){var a=e.getNodes()[t]
var i=distanceExtents(a.extents,r)
if(void 0===i)return r
if(a.externalNode){if(a.externalNode!==R){var o=c(e,a.externalNode,l,i,r)
if(o)r=(u=o).factor}}else{var n=_.length
var s
for(s=0;s<n;s++)if(i>_[s].distance)break
_.splice(s-1,0,{tree:e,nodeIndex:t,distance:i})}return r}var a=l.maxFactor
var i
var o
for(o=0;o<e.length;o++)if(0!==(i=e[o]).endNode)a=processNode(i,0,a)
while(0!==_.length){var n=_.pop()
if(n.distance>=a)continue
var s=n.nodeIndex
var d=(i=n.tree).getNodes()
var f=s+d[s].escapeNodeOffset
var v=s+1
do{a=processNode(i,v,a)
v+=d[v].escapeNodeOffset}while(v<f)}return u}
function create(e){return new AABBTree(e)}},{assert:void 0}],237:[function(e,t,r){"use strict"
r.abTestsStartup=abTestsStartup
r.abTestsGetSplitGroup=abTestsGetSplitGroup
var a=e("assert")
var i=e("./local_storage")
var o=i.localStorageGet
var n=i.localStorageGetJSON
var s=i.localStorageSet
var l=i.localStorageSetJSON
var c=e("./net")
var _=c.netClient
var u=c.netDisconnected
var d=c.netSubs
var f="abtests_id"
var v="abtests_groups"
var h=null
var p
var m
var g
function requestClientSplitGroups(){a(h)
var e={client_id:h,permanent_groups:p}
_().send("abtests_client",e,function(e,t){if(e){console.log("Error when trying to get client's AB tests")
return}p=Object.create(null)
m=Object.create(null)
for(var r in t){var a=t[r]
if(a.permanent)p[r]=a.group
m[r]=a.group}l(v,p)})}function requestUserSplitGroups(){if(u())return
d().getMyUserChannel().send("abtests_user",null,function(e,t){if(e){console.log("Error when trying to get user's AB tests")
return}g=Object.create(null)
for(var r in t)g[r]=t[r].group})}function abTestsStartup(){if(h)return
if(!(h=o(f))){h="id"+Math.random()
s(f,h)}p=n(v)||Object.create(null)
m=p
g=Object.create(null)
d().on("connect",function(){requestClientSplitGroups()})
d().on("login",function(){requestUserSplitGroups()})
d().on("logout",function(){g=Object.create(null)})}function abTestsGetSplitGroup(e){var t
return null!=(t=g[e])?t:m[e]}},{"./local_storage":274,"./net":279,assert:void 0}],238:[function(e,t,r){"use strict"
e("./polyfill.js")
var l=document.getElementById("debug")
window.onerror=function(e,t,r,a,i){var o=String(e)
if("[object Object]"===o){try{o=JSON.stringify(e)}catch(e){}o=o.slice(0,600)}if(t||r>0||a>0)o+="\n  at "+t+"("+r+":"+a+")"
if(i&&i.stack){o=""+i.stack
if(i.message)if(-1===o.indexOf(i.message))o=i.message+"\n"+o
var n=document.location.origin||""
if(n){if("/"!==n.slice(-1))n+="/"
o=o.split(n).join("")}o=o.replace(/\[\d+\]<\/?/g,"").replace(/\/</g,"").replace(/<?\/<?/g,"/").replace(/\n\//g,"\n").replace(/\n([^ ])/g,"\n  $1")}if(-1===o.indexOf("Error:"))o="Error: "+o
if(i&&i.type)if("unhandledrejection"===i.type)o="Uncaught (in promise) "+o
var s=true
if(window.glov_error_report)s=window.glov_error_report(o,t,r,a)
if(s)l.innerText=o+"\n\nPlease report this error to the developer, and then reload this page or restart the app."}
window.addEventListener("unhandledrejection",function(e){var t=e.reason
if(!t)return
if(!t||"object"!==typeof t)t={stack:t}
t.type=e.type
window.onerror(e.reason,void 0,0,0,t)})
window.debugmsg=function(e,t){if(t)l.innerText=e
else l.innerText+=e+"\n"}
window.profilerStart=window.profilerStop=window.profilerStopStart=function nop(){}},{"./polyfill.js":284}],239:[function(e,t,i){"use strict"
i.is_discrete_gpu=i.is_firefox=i.is_ios_safari=i.is_webkit=i.is_android=i.is_windows_phone=i.is_ios=i.is_mac_osx=void 0
var r=window.navigator.userAgent
var a=r.match(/Mac OS X/)
i.is_mac_osx=a
var o=!window.MSStream&&r.match(/iPad|iPhone|iPod/)
i.is_ios=o
var n=r.match(/windows phone/i)
var s=!(i.is_windows_phone=n)&&r.match(/android/i)
i.is_android=s
var l=r.match(/WebKit/i)
i.is_webkit=l
var c=o&&l&&!r.match(/CriOS/i)
i.is_ios_safari=c
var _=r.match(/Firefox/i)
i.is_firefox=_
var u=false
i.is_discrete_gpu=u
function init(){try{var e=document.createElement("canvas")
e.width=4
e.height=4
var t=e.getContext("webgl")
if(t){var r=t.getExtension("WEBGL_debug_renderer_info")
if(r){var a=t.getParameter(r.UNMASKED_RENDERER_WEBGL)
i.is_discrete_gpu=u=Boolean(a&&a.match(/nvidia|radeon/i))}}}catch(e){}}init()},{}],240:[function(e,t,r){"use strict"
r.buildUIStartup=buildUIStartup
var S=e("./camera2d.js")
var a=e("./engine.js")
var i=e("./font.js")
var A=Math.min
var w=e("./scroll_area.js").scrollAreaCreate
var L=e("./ui.js")
var o=e("./net.js")
var R=e("../common/util.js").plural
var n=e("../common/vmath.js").vec4
var x
var O
Z.BUILD_ERRORS=Z.BUILD_ERRORS||9900
function onGBState(e){x=e}function onServerError(e){O=e}var b=4
var N=n(0,0,0,1)
var C=i.styleColored(null,4280295679)
var M=i.styleColored(null,3722305023)
var D=i.styleColored(null,14540287)
var P=i.styleColored(null,539033599)
var k=n(1,1,1,1)
var B=/\u001b\[(?:[0-9;]*)[0-9A-ORZcf-nqry=><]/g
var U
function buildUITick(){if(!x&&!O)return
var e=S.x0()+b
var t=S.y0()+b
var r=Z.BUILD_ERRORS
var a=.75*S.w()
var i=L.font,o=L.title_font,n=L.font_height
var s=e
var l=t
var c=((null==x?void 0:x.error_count)||0)+(O?1:0)
var _=(null==x?void 0:x.warning_count)||0
o.drawSizedAligned(C,s,l,r,n,i.ALIGN.HCENTERFIT,a,0,c+" "+R(c,"error")+", "+_+" "+R(_,"warning"))
l+=n+1
L.drawLine(e+.3*a,l,e+.7*a,l,r,.5,true,k)
l+=b
if(!U)U=w({z:r,background_color:null,auto_hide:true})
var u=S.y1()-b-l
var d=l
U.begin({x:s,y:l,w:a,h:u})
var f=a-b-U.barWidth()
l=0
r=Z.UI
function printLine(e,t){t=t.replace(B,"")
l+=i.drawSizedWrapped(M,s,l,r,f,0,n,e+": "+t)}if(x)for(var v in x.tasks){var h=x.tasks[v]
s=0
i.drawSizedAligned(D,s,l,r,n,i.ALIGN.HLEFT,f,0,v+":")
l+=n
s+=n
var p=false
for(var m in h.jobs){var g=h.jobs[m]
var E=g.warnings,y=g.errors
if("all"!==m){if(m.startsWith("source:"))m=m.slice(7)
l+=i.drawSizedWrapped(P,s,l,r,f,0,n,m)}if(E)for(var T=0;T<E.length;++T){printLine("Warning",E[T])
p=true}if(y)for(var I=0;I<y.length;++I){printLine("Error",y[I])
p=true}}if(!p&&h.err)printLine("Error",h.err)
l+=b}if(O){s=0
i.drawSizedAligned(D,s,l,r,n,i.ALIGN.HLEFT,f,0,"Server Error:")
l+=n
s+=n
printLine("Server error",O)}U.end(l)
l=d+A(u,l)
if(L.buttonText({x:e+a-L.button_height,y:t,z:Z.BUILD_ERRORS+1,w:L.button_height,text:"X"}))O=x=null
L.panel({x:e-b,y:t-b,z:Z.BUILD_ERRORS-1,w:a+2*b,h:l-t+2*b,color:N})}function buildUIStartup(){if(o.client&&a.DEBUG){o.client.onMsg("gbstate",onGBState)
o.client.onMsg("server_error",onServerError)
o.subs.on("connect",function(){var e=o.client.pak("gbstate_enable")
e.writeBool(true)
e.send()})
a.addTickFunc(buildUITick)}}},{"../common/util.js":330,"../common/vmath.js":332,"./camera2d.js":241,"./engine.js":250,"./font.js":260,"./net.js":279,"./scroll_area.js":289,"./ui.js":306}],241:[function(e,t,l){"use strict"
l.virtualToCanvas=virtualToCanvas
l.transformX=transformX
l.transformY=transformY
l.canvasToVirtual=canvasToVirtual
l.set=set
l.setSafeAreaPadding=setSafeAreaPadding
l.safeAreaPadding=safeAreaPadding
l.push=push
l.pop=pop
l.domToCanvasRatio=domToCanvasRatio
l.screenAspect=screenAspect
l.setAspectFixed=setAspectFixed
l.setAspectFixed2=setAspectFixed2
l.zoom=zoom
l.shift=shift
l.calcMap=calcMap
l.setNormalized=setNormalized
l.setScreen=setScreen
l.setDOMMapped=setDOMMapped
l.x0Real=x0Real
l.y0Real=y0Real
l.x1Real=x1Real
l.y1Real=y1Real
l.wReal=wReal
l.hReal=hReal
l.x0=x0
l.y0=y0
l.x1=x1
l.y1=y1
l.w=w
l.h=h
l.xScale=xScale
l.yScale=yScale
l.htmlPos=htmlPos
l.htmlSize=htmlSize
l.setInputClipping=setInputClipping
l.domToVirtual=domToVirtual
l.domDeltaToVirtual=domDeltaToVirtual
l.virtualToDom=virtualToDom
l.virtualToFontSize=virtualToFontSize
l.virtualToDomPosParam=virtualToDomPosParam
l.clipTestRect=clipTestRect
l.tickCamera2D=tickCamera2D
l.startup=startup
l.render_offset_y_bottom=l.render_offset_x=l.render_viewport_h=l.render_viewport_w=l.data=void 0
var s=e("assert")
var p=e("./engine.js")
var r=Math.max,m=Math.round
var c=new Float32Array(4)
var f=new Float32Array(13)
l.data=f
var _
var u
var g
var E
var d
l.render_viewport_w=d
var v
l.render_viewport_h=v
var y
l.render_offset_x=y
var T
var I
l.render_offset_y_bottom=I
function reapply(){if(g){f[4]=g/(f[2]-f[0])
f[5]=E/(f[3]-f[1])
f[7]=(f[2]-f[0])/d
f[8]=(f[3]-f[1])/v}else{f[4]=_/(f[2]-f[0])
f[5]=u/(f[3]-f[1])}}function virtualToCanvas(e,t){e[0]=(t[0]-f[0])*f[4]
e[1]=(t[1]-f[1])*f[5]}function transformX(e){return(e-f[0])*f[4]}function transformY(e){return(e-f[1])*f[5]}function canvasToVirtual(e,t){e[0]=t[0]/f[4]+f[0]
e[1]=t[1]/f[5]+f[1]}function safeScreenWidth(){return r(1,_-c[0]-c[1])}function safeScreenHeight(){return r(1,u-c[2]-c[3])}function set(e,t,r,a,i){s(isFinite(e))
s(isFinite(t))
s(isFinite(r))
s(isFinite(a))
if(i||g){f[9]=f[0]=e
f[10]=f[1]=t
f[11]=f[2]=r
f[12]=f[3]=a}else{f[9]=e
f[10]=t
f[11]=r
f[12]=a
var o=(r-e)/safeScreenWidth()
var n=(a-t)/safeScreenHeight()
f[0]=e-c[0]*o
f[1]=t-c[2]*n
f[2]=r+c[1]*o
f[3]=a+c[3]*n}reapply()}function setSafeAreaPadding(e,t,r,a){c[0]=m(e)
c[1]=m(t)
c[2]=m(r)
c[3]=m(a)}function safeAreaPadding(){return c}var a=[]
function push(){a.push(f.slice(0))}function pop(){var e=a.pop()
for(var t=0;t<e.length;++t)f[t]=e[t]
reapply()}function domToCanvasRatio(){return f[6]}function screenAspect(){return safeScreenWidth()/safeScreenHeight()}function setAspectFixed(e,t){var r=g?1:p.pixel_aspect
var a=t/r/e
var i
var o
var n
if(g){o=g
n=E}else{o=safeScreenWidth()
n=safeScreenHeight()}if(a>(i=n/o)){var s=t/r/i
var l=o/s
var c=s-e
var _=m(c*l/2)/l
set(-_,0,e+(c-_),t,false)}else{var u=e*r*i
var d=n/u
var f=u-t
var v=m(f*d/2)/d
set(0,-v,e,t+(f-v),false)}}function setAspectFixed2(e,t){var r=g?1:p.pixel_aspect
var a=t/r/e
var i
if(g)i=E/g
else i=1/screenAspect()
if(a>i)set(0,0,e+(t/r/i-e),t,false)
else set(0,0,e,t+(e*r*i-t),false)}function zoom(e,t,r){var a=1/r
set(e-(e-f[0])*a,t-(t-f[1])*a,e+(f[2]-e)*a,t+(f[3]-t)*a,true)}function shift(e,t){set(f[0]+e,f[1]+t,f[2]+e,f[3]+t,true)}function calcMap(e,t,r){var a=f[11]-f[9]
var i=f[12]-f[10]
var o=(t[0]-f[9])/a
var n=(t[1]-f[10])/i
var s=(t[2]-f[9])/a
var l=(t[3]-f[10])/i
var c=s-o
var _=l-n
var u=r[2]-r[0]
var d=r[3]-r[1]
e[0]=r[0]-u/c*o
e[1]=r[1]-d/_*n
e[2]=r[2]+u/c*(1-s)
e[3]=r[3]+d/_*(1-l)
return e}function setNormalized(){set(0,0,1,1,true)}function setScreen(e){if(g)set(0,0,g,E)
else if(e)set(0,0,safeScreenWidth(),safeScreenHeight())
else set(0,0,safeScreenWidth()/p.dom_to_canvas_ratio,safeScreenHeight()/p.dom_to_canvas_ratio)}function setDOMMapped(){if(g)set(y,T,_-y,u-T,true)
else set(0,0,_/p.dom_to_canvas_ratio,u/p.dom_to_canvas_ratio,true)}function x0Real(){return f[0]}function y0Real(){return f[1]}function x1Real(){return f[2]}function y1Real(){return f[3]}function wReal(){return f[2]-f[0]}function hReal(){return f[3]-f[1]}function x0(){return f[9]}function y0(){return f[10]}function x1(){return f[11]}function y1(){return f[12]}function w(){return f[11]-f[9]}function h(){return f[12]-f[10]}function xScale(){return f[4]}function yScale(){return f[5]}function htmlPos(e,t){if(g)return[((e-f[0])/f[7]+y)/_*100,((t-f[1])/f[8]+T)/u*100]
else return[100*(e-f[0])/(f[2]-f[0]),100*(t-f[1])/(f[3]-f[1])]}function htmlSize(e,t){if(g)return[100*e/f[7]/_,100*t/f[8]/u]
else return[100*e/(f[2]-f[0]),100*t/(f[3]-f[1])]}var i
function setInputClipping(e){i=e}function domToVirtual(e,t){var r=true
if(i)if(t[0]<i[0]||t[0]>i[0]+i[2]||t[1]<i[1]||t[1]>i[1]+i[3])r=false
if(g){e[0]=(t[0]*f[6]-y)*f[7]+f[0]
e[1]=(t[1]*f[6]-T)*f[8]+f[1]}else{e[0]=t[0]*f[6]/f[4]+f[0]
e[1]=t[1]*f[6]/f[5]+f[1]}return r}function domDeltaToVirtual(e,t){if(g){e[0]=t[0]*f[6]*f[7]
e[1]=t[1]*f[6]*f[8]}else{e[0]=t[0]*f[6]/f[4]
e[1]=t[1]*f[6]/f[5]}}var o=new Float32Array(4)
function updateVirtualInputClipping(){domToVirtual(o,i)
if(g){o[2]=i[2]*f[6]*f[7]
o[3]=i[3]*f[6]*f[8]}else{o[2]=i[2]*f[6]/f[4]
o[3]=i[3]*f[6]/f[5]}}function virtualToDom(e,t){if(g){e[0]=(y+(t[0]-f[0])/f[7])/f[6]
e[1]=(T+(t[1]-f[1])/f[8])/f[6]}else{e[0]=(t[0]-f[0])*f[4]/f[6]
e[1]=(t[1]-f[1])*f[5]/f[6]}}function virtualToFontSize(e){if(g)return e/(f[6]*f[8])*.84
else return e*f[5]/f[6]*.84}function virtualToDomPosParam(e,t){if(g){e.x=(y+(t.x-f[0])/f[7])/f[6]
e.w=t.w/f[7]/f[6]
e.y=(T+(t.y-f[1])/f[8])/f[6]
e.h=t.h/f[8]/f[6]}else{e.x=(t.x-f[0])*f[4]/f[6]
e.w=t.w*f[4]/f[6]
e.y=(t.y-f[1])*f[5]/f[6]
e.h=t.h*f[5]/f[6]}if(i){if(e.x<i[0]){e.w=r(0,e.w-(i[0]-e.x))
e.x=i[0]}if(e.y<i[1]){e.h=r(0,e.h-(i[1]-e.y))
e.y=i[1]}if(e.x>i[0]+i[2])e.w=0
if(e.y>i[1]+i[3])e.h=0}}function clipTestRect(e){if(!i)return true
updateVirtualInputClipping()
var t=o
if(e.x>t[0]+t[2]||e.x+e.w<t[0]||e.y>t[1]+t[3]||e.y+e.h<t[1])return false
if(e.x<t[0]){e.w-=t[0]-e.x
e.x=t[0]}if(e.y<t[1]){e.h-=t[1]-e.y
e.y=t[1]}if(e.x+e.w>t[0]+t[2])e.w=t[0]+t[2]-e.x
if(e.y+e.h>t[1]+t[3])e.h=t[1]+t[3]-e.y
return true}function tickCamera2D(){f[6]=p.dom_to_canvas_ratio
_=p.width
u=p.height
var e=[0,0,_,u]
if(p.render_width){g=p.render_width
E=p.render_height
var t=p.pixel_aspect
var r=E/t/g
var a=safeScreenWidth()
var i=safeScreenHeight()
var o=i/a
if(r>o){var n=(E/o-g*t)/2*i/E
l.render_offset_x=y=c[0]+m(n)
T=c[2]
l.render_offset_y_bottom=I=c[3]
l.render_viewport_w=d=m(a-2*n)
l.render_viewport_h=v=i}else{var s=(g*o-E/t)/2*a/g
l.render_offset_x=y=c[0]
T=c[2]+m(s)
l.render_offset_y_bottom=I=c[3]+m(s)
l.render_viewport_w=d=a
l.render_viewport_h=v=m(i-2*s)}e[2]=g
e[3]=E}else{g=E=0
l.render_offset_x=y=0
T=0
l.render_offset_y_bottom=I=0}reapply()
p.setViewport(e)}function startup(){_=p.width
u=p.height
set(0,0,p.width,p.height)
tickCamera2D()}},{"./engine.js":250,assert:void 0}],242:[function(e,t,r){"use strict"
r.chatUICreate=chatUICreate
r.CHAT_FLAG_USERCHAT=r.CHAT_FLAG_EMOTE=void 0
function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]
for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))e[a]=r[a]}return e}).apply(this,arguments)}var R=e("assert")
var a=e("glov-async").asyncParallel
var pe=e("./camera2d.js")
var me=e("./cmds.js").cmd_parse
var ge=e("./engine.js")
var Ee=e("./font.js")
var _=e("./social.js").isFriend
var ye=e("./input.js")
var Te=e("./link.js").link
var i=e("./local_storage.js")
var o=e("./localization.js").getStringIfLocalizable
var x=Math.ceil,O=Math.floor,Ie=Math.max,Se=Math.min,Ae=Math.round
var n=e("./net.js"),we=n.netClient,d=n.netClientId,Le=n.netSubs,f=n.netUserId
var s=e("./words/profanity.js"),l=s.profanityFilter,c=s.profanityStartup
var u=e("./scroll_area.js").scrollAreaCreate
var Re=e("./settings.js")
var v=e("./spot.js"),h=v.SPOT_NAV_DOWN,p=v.SPOT_NAV_LEFT,m=v.SPOT_NAV_RIGHT,g=v.SPOT_NAV_UP,xe=v.spotUnfocus
var Oe=e("./ui.js")
var E=e("../common/util.js"),be=E.clamp,y=E.defaults,T=E.deprecate,Ne=E.matchAll
var I=e("../common/vmath.js"),S=I.vec4,b=I.v3copy
T(r,"create","chatUICreate")
var Ce=1
r.CHAT_FLAG_EMOTE=Ce
var Me=2
r.CHAT_FLAG_USERCHAT=Me
Z.CHAT=Z.CHAT||500
Z.CHAT_FOCUSED=Z.CHAT_FOCUSED||Z.CHAT
var De=S(1,1,1,.5)
var Pe=S(1,1,1,.25)
var A={join_leave:3}
function messageFromUser(e){return"error"!==e.style&&"system"!==e.style}Re.register({chat_auto_unfocus:{default_value:0,type:me.TYPE_INT,range:[0,1],help:"Automatically unfocus chat after sending a message"},chat_show_join_leave:{default_value:1,type:me.TYPE_INT,range:[0,1],label:"Show join/leave messages",help:"Show join/leave messages"},profanity_filter:{default_value:1,type:me.TYPE_INT,range:[0,1],help:"Filter profanity in chat"}})
function CmdHistory(){R("demo"!==i.getStoragePrefix())
this.entries=new Array(50)
this.idx=i.getJSON("console_idx")
if("number"!==typeof this.idx||this.idx<0||this.idx>=this.entries.length)this.idx=0
else for(var e=0;e<this.entries.length;++e)this.entries[e]=i.getJSON("console_e"+e)
this.resetPos()}CmdHistory.prototype.setHist=function(e,t){this.entries[e]=t
i.setJSON("console_e"+e,t)}
CmdHistory.prototype.add=function(e){if(!e)return
var t=this.entries.indexOf(e)
if(-1!==t){var r=(this.idx-1+this.entries.length)%this.entries.length
while(t!==r){var a=(t+1)%this.entries.length
this.setHist(t,this.entries[a])
t=a}this.setHist(r,e)
return}this.setHist(this.idx,e)
this.idx=(this.idx+1)%this.entries.length
i.setJSON("console_idx",this.idx)
this.resetPos()}
CmdHistory.prototype.unadd=function(e){var t=(this.idx-1+this.entries.length)%this.entries.length
if(this.entries[t]!==e)return
this.idx=t
i.setJSON("console_idx",this.idx)
this.resetPos()}
CmdHistory.prototype.resetPos=function(){this.hist_idx=this.idx
this.edit_line=""}
CmdHistory.prototype.prev=function(e){if(this.hist_idx===this.idx)this.edit_line=e
var t=(this.hist_idx-1+this.entries.length)%this.entries.length
var r=this.entries[t]
if(t===this.idx||!r)return this.entries[this.hist_idx]||""
this.hist_idx=t
return r||""}
CmdHistory.prototype.next=function(e){if(this.hist_idx===this.idx)return e||""
var t=(this.hist_idx+1)%this.entries.length
this.hist_idx=t
if(this.hist_idx===this.idx){var r=this.edit_line
this.edit_line=""
return r||""}return this.entries[t]||""}
function defaultGetRoles(){var e
if(f()&&we().connected){var t
var r=Le().getMyUserChannel()
if(null!=(e=r.data&&r.data.public)&&null!=(t=e.permissions)&&t.sysadmin)return{sysadmin:1}}return{}}function ChatUI(e){var t
R.equal(typeof e,"object")
R.equal(typeof e.max_len,"number")
this.edit_text_entry=Oe.createEditBox({placeholder:"Chat",initial_focus:false,auto_unfocus:true,spatial_focus:false,max_len:e.max_len,text:"",custom_nav:((t={})[p]=null,t[g]=null,t[m]=null,t[h]=null,t)})
this.channel=null
this.on_join=this.onMsgJoin.bind(this)
this.on_leave=this.onMsgLeave.bind(this)
this.on_chat=this.onMsgChat.bind(this)
this.on_chat_cb=null
this.handle_cmd_parse=this.handleCmdParse.bind(this)
this.handle_cmd_parse_error=this.handleCmdParseError.bind(this)
me.setDefaultHandler(this.handle_cmd_parse_error)
this.clearChat()
this.max_lines=e.max_lines||8
this.max_messages=e.max_messages||1e3
this.max_len=e.max_len
this.font_height=e.font_height||Oe.font_height
this.hide_disconnected_message=e.hide_disconnected_message||false
this.disconnected_message_top=e.disconnected_message_top||false
this.scroll_area=u({background_color:null,auto_scroll:true})
this.w=e.w||ge.game_width/2
this.h=e.h||ge.game_height/2
this.inner_width_adjust=e.inner_width_adjust||0
this.border=e.border||void 0
this.volume_join_leave=e.volume_join_leave||.15
this.volume_in=e.volume_in||.5
this.volume_out=e.volume_out||.5
this.msg_out_err_delay=e.msg_out_err_delay||0
this.history=new CmdHistory
this.get_roles=defaultGetRoles
this.url_match=e.url_match
this.url_info=e.url_info
this.user_context_cb=e.user_context_cb
this.user_id_mouseover=false
this.fade_start_time=e.fade_start_time||[1e4,1e3]
this.fade_time=e.fade_time||[1e3,500]
this.z_override=null
this.setActiveSize(this.font_height,this.w)
var r=e.outline_width||1
this.styles=y(e.styles||{},{def:Ee.style(null,{color:4008636159,outline_width:r,outline_color:255}),error:Ee.style(null,{color:3707764991,outline_width:r,outline_color:255}),link:Ee.style(null,{color:1346437119,outline_width:r,outline_color:255}),link_hover:Ee.style(null,{color:65535,outline_width:r,outline_color:255}),system:Ee.style(null,{color:2863311615,outline_width:r,outline_color:255})})
this.styles.join_leave=this.styles.system
this.classifyRole=e.classifyRole
Le().on("chat_broadcast",this.onChatBroadcast.bind(this))}ChatUI.prototype.setActiveSize=function(e,t){var r=t-this.scroll_area.barWidth()
if(this.active_font_height!==e||this.wrap_w!==r){this.active_font_height=e
this.indent=Ae(this.active_font_height/24*40)
this.wrap_w=r
for(var a=this.total_lines=0;a<this.msgs.length;++a){var i=this.msgs[a]
i.numlines=Oe.font.numLines(this.styles[i.style]||this.styles.def,this.wrap_w,this.indent,this.active_font_height,i.msg_text)
this.total_lines+=i.numlines}}}
ChatUI.prototype.clearChat=function(){this.msgs=[]
this.total_lines=0}
function notHidden(e){return!e.hidden}ChatUI.prototype.addMsgInternal=function(e){e.timestamp=e.timestamp||Date.now()
if(e.flags&Me)if(e.flags&Ce)e.msg_text=e.display_name+" "+e.msg
else e.msg_text="["+e.display_name+"] "+e.msg
else e.msg_text=e.msg
e.numlines=Oe.font.numLines(this.styles[e.style]||this.styles.def,this.wrap_w,this.indent,this.active_font_height,e.msg_text)
this.total_lines+=e.numlines
this.msgs.push(e)
var t=A[e.style]
if(t)for(var r=this.msgs.length-2;r>=0;--r){var a=this.msgs[r]
if(a.style===e.style&&!a.hidden)if(e.id&&a.id===e.id){a.hidden=true
this.total_lines-=a.numlines
a.numlines=0}else if(--t<=0){a.hidden=true
this.total_lines-=a.numlines
a.numlines=0
break}}if(this.msgs.length>1.25*this.max_messages){this.msgs=this.msgs.filter(notHidden)
if(this.msgs.length>1.25*this.max_messages){this.msgs.splice(0,this.msgs.length-this.max_messages)
for(var i=this.total_lines=0;i<this.msgs.length;++i)this.total_lines+=this.msgs[i].numlines}}}
function toStr(e){return"string"===typeof(e=o(e))?e:JSON.stringify(e)}ChatUI.prototype.addChat=function(e,t){e=toStr(e)
console.log(e)
this.addMsgInternal({msg:e,style:t})}
ChatUI.prototype.addChatFiltered=function(e){e.msg=toStr(e.msg)
console.log("Chat from "+e.id+": "+e.msg)
if(Re.profanity_filter&&e.id!==(f()||d()))e.msg=l(e.msg)
this.addMsgInternal(e)}
ChatUI.prototype.onMsgJoin=function(e){if(!Re.chat_show_join_leave)return
if(e.client_id!==d()){if(this.volume_join_leave)Oe.playUISound("user_join",this.volume_join_leave)
this.addChatFiltered({id:e.user_id||e.client_id,display_name:e.display_name||e.client_id,flags:Ce|Me,msg:"joined the channel",style:"join_leave"})}}
ChatUI.prototype.onMsgLeave=function(e){if(!Re.chat_show_join_leave)return
if(this.volume_join_leave)Oe.playUISound("user_leave",this.volume_join_leave)
this.addChatFiltered({id:e.user_id||e.client_id,display_name:e.display_name||e.client_id,flags:Ce|Me,msg:"left the channel",style:"join_leave"})}
ChatUI.prototype.registerOnMsgChatCB=function(e){R(!this.on_chat_cb)
this.on_chat_cb=e}
ChatUI.prototype.onMsgChat=function(e){if(this.on_chat_cb)this.on_chat_cb(e)
var t=e.msg,r=e.style,a=e.id,i=e.client_id,o=e.display_name,n=e.flags,s=e.ts,l=e.quiet
if(!l&&i!==d())if(this.volume_in)Oe.playUISound("msg_in",this.volume_in)
n=(n||0)|Me
this.addChatFiltered({id:a,display_name:o=o||a,msg:t,style:r,flags:n,timestamp:s,quiet:l})}
ChatUI.prototype.onChatBroadcast=function(e){var t=e.msg,r=e.src
Oe.playUISound("msg_err")
this.addChatFiltered({msg:"["+r+"] "+t,style:"error"})}
ChatUI.prototype.focus=function(){this.edit_text_entry.focus()}
ChatUI.prototype.runLate=function(){this.did_run_late=true
if(ye.keyDownEdge(ye.KEYS.RETURN))this.focus()
if(ye.keyDownEdge(ye.KEYS.SLASH)||ye.keyDownEdge(ye.KEYS.NUMPAD_DIVIDE)){this.focus()
this.edit_text_entry.setText("/")}}
ChatUI.prototype.addChatError=function(e){this.addChat("[error] "+toStr(e),"error")}
ChatUI.prototype.handleCmdParseError=function(e,t){if(e)this.addChatError(e)}
ChatUI.prototype.handleCmdParse=function(e,t){if(e)this.addChatError(e)
else if(t)this.addChat("[system] "+toStr(t),"system")}
ChatUI.prototype.setGetRoles=function(e){this.get_roles=e}
var w={access:null}
ChatUI.prototype.getAccessObj=function(){w.access=this.get_roles()
return w}
ChatUI.prototype.cmdParse=function(r,a){var i=this
var o=a?function(e,t){i.handle_cmd_parse(e,t)
if(a)a(e)}:this.handle_cmd_parse
me.handle(this.getAccessObj(),r,function(e,t){if(e&&me.was_not_found)Le().sendCmdParse(r,o)
else o(e,t)})}
ChatUI.prototype.cmdParseInternal=function(e){me.handle(this.getAccessObj(),e,this.handle_cmd_parse_error)}
function pad2(e){return("0"+e).slice(-2)}function conciseDate(e){return pad2(e.getMonth()+1)+"-"+pad2(e.getDate())+" "+pad2(e.getHours())+":"+pad2(e.getMinutes())+":"+pad2(e.getSeconds())}var N=Ee.styleColored(null,255)
var C=Ee.style(N,{outline_width:.5,outline_color:255})
var M=S(0,0,0,.25)
var D=S(0,0,0,.125)
var P=20
var k=0
var B=""
var U=S()
function drawHelpTooltip(e){R(Array.isArray(e.tooltip))
var t=e.tooltip
var r=1
var a=e.font_height
var i=.5*Oe.tooltip_pad
var o=Se(P,Ie(1,O((e.y-pe.y0()-i)/a)-1))
if(t.length>20){var n=t.join("\n")
if(n!==B){k=0
B=n}r=x(t.length/o)
t=t.slice(k*o,(k+1)*o)}else{k=0
B=""}var s=e.tooltip_width
var l=e.x
var c=e.z||Z.TOOLTIP+5
var _=l+i
var u=s-2*i
var d=e.y
var f=1
var v=2*i+a*t.length
if(!e.do_selection&&1===r&&ye.mouseOver({x:l,y:d-v,w:s,h:v}))f=.15
var h=N
if(1!==f)h=Ee.styleAlpha(h,f)
var p=d-i
var m=null
if(r>1){Oe.font.drawSizedAligned(N,_,p-=a,c+1,a,Ee.ALIGN.HCENTER,u,0,"Page "+(k+1)+" / "+r)
var g={x:l,y:p,w:s,h:a}
if(ye.mouseUpEdge(g))k=(k+1)%r
else if(ye.mouseOver(g))Oe.drawRect(l,p,l+s,p+a,c+.5,M)}for(var E=t.length-1;E>=0;--E){var y=t[E]
p-=a
var T=y.indexOf(" ")
if("/"===y[0]&&-1!==T&&e.do_selection){var I=y.slice(0,T)
var S=y.slice(T)
var A=Oe.font.drawSized(C,_,p,c+1,a,I)
Oe.font.drawSizedAligned(N,_+A,p,c+2,a,Ee.ALIGN.HFIT,u-A,0,S)
var w={x:l,y:p,w:s,h:a}
if(ye.mouseUpEdge(w))m=I.slice(1)
else if(ye.mouseOver(w)){Oe.drawRect(l,p,_+A+4,p+a,c+.5,M)
Oe.drawRect(_+A+4,p,l+s,p+a,c+.5,D)}}else Oe.font.drawSizedAligned(h,_,p,c+1,a,Ee.ALIGN.HFIT,u,0,y)}p-=i
var L=.5*Oe.tooltip_panel_pixel_scale
b(U,Oe.color_panel)
U[3]=f
Oe.panel({x:l,y:p,z:c,w:s,h:d-p,pixel_scale:L,color:U})
return m}ChatUI.prototype.isFocused=function(){return this.edit_text_entry&&this.edit_text_entry.isFocused()}
ChatUI.prototype.sendChat=function(c,_){var u=this
if(!we().connected)this.addChatError("Cannot chat: Disconnected")
else if(!this.channel||!Le().loggedIn()&&!Le().allow_anon)this.addChatError("Cannot chat: Must be logged in")
else if(_.length>this.max_len)this.addChatError("Chat message too long")
else{var e=this.channel.pak("chat")
e.writeInt(c)
e.writeString(_)
e.send(function(e,t){if(e)if("ERR_ECHO"===e){var r,a,i,o,n
var s=null==(r=u.channel)?void 0:null==(a=r.data)?void 0:null==(i=a.public)?void 0:null==(o=i.clients[d()])?void 0:null==(n=o.ids)?void 0:n.roles
var l=u.classifyRole(s,true)
u.onMsgChat({msg:_,style:l,id:f(),client_id:d(),display_name:Le().getDisplayName(),flags:c})}else{u.addChatError(e)
if(!u.edit_text_entry.getText())u.edit_text_entry.setText(_)}})}}
ChatUI.prototype.setZOverride=function(e){this.z_override=e}
ChatUI.prototype.run=function(e){var t=this
var g=Oe.font_height/24
var r=(e=e||{}).border||this.border||8*g
var a=r
var i=e.scroll_grow||0
if(we().disconnected&&!this.hide_disconnected_message)Oe.font.drawSizedAligned(Ee.style(null,{outline_width:2,outline_color:255,color:3709870335}),pe.x0(),this.disconnected_message_top?.8*ge.game_height:pe.y0(),Z.DEBUG,Oe.font_height,this.disconnected_message_top?Ee.ALIGN.HCENTER:Ee.ALIGN.HVCENTER,pe.w(),.2*pe.h(),"Connection lost, attempting to reconnect ("+(we().timeSinceDisconnect()/1e3).toFixed(0)+")...")
if(!this.did_run_late)this.runLate()
this.did_run_late=false
var o=void 0===e.x?pe.x0():e.x
var n=void 0===e.y?pe.y1()-this.h:e.y
var s=n+this.h
var E=o+r
var y=s
var l=this.w
var c=this.isFocused()
var T=this.z_override||(c?Z.CHAT_FOCUSED:Z.CHAT)
this.z_override=null
var _=false
var I=this.font_height
var S=false
var u=(e.hide||ge.defines.NOUI||!Le().loggedIn())&&!c?1:0
var d=Oe.modal_dialog||Oe.menu_up||u
if(!d&&c&&ye.touch_mode){l=pe.x1()-o-24*g
var f=4
var v=pe.screenAspect()
if(v>2)f=4+4*Se((v-2)/8,1)
I*=f}var h=l-r+this.inner_width_adjust
this.setActiveSize(I,h)
if(!d){S=true
y-=r+I+1
if(!c&&e.pointerlock&&ye.pointerLocked())Oe.font.drawSizedAligned(this.styles.def,E,y,T+1,I,Ee.ALIGN.HFIT,h,0,"<Press Enter to chat>")
else{if(c){var p=!ye.keyDown(ye.KEYS.SHIFT)&&ye.keyDownEdge(ye.KEYS.TAB)
if(p)this.focus()
var m=this.edit_text_entry.getText()
if(m){if("/"===m[0]){var A=me.autoComplete(m.slice(1),this.getAccessObj().access)
if(A&&A.length){var w=A[0]
var L=[]
for(var R=0;R<A.length;++R){var x=A[R]
L.push("/"+x.cmd+" - "+x.help)}var O=false
if(1===A.length&&w.cname&&me.canonical(m.slice(1)).slice(0,w.cname.length)===w.cname)if(w.usage)L=w.usage.split("\n")
else L=[w.help]
else O=true
var b=y
var N=this.msgs[this.msgs.length-1]
if(N){var C=N.msg
if(C&&!(N.flags&Me)&&"[error]"===C.slice(0,7)){var M=N.numlines
b-=I*M+a}}var D=drawHelpTooltip({x:E,y:b,tooltip_width:Ie(h,.8*ge.game_width),tooltip:L,do_selection:O,font_height:Se(I,pe.w()/30)})
if(O)if(p||D)this.edit_text_entry.setText("/"+(D||w.cmd)+" ")}}}else this.history.resetPos()
if(ye.keyDownEdge(ye.KEYS.UP))this.edit_text_entry.setText(this.history.prev(m))
if(ye.keyDownEdge(ye.KEYS.DOWN))this.edit_text_entry.setText(this.history.next(m))
this.scroll_area.keyboardScroll()}var P=I
var k=h-(e.cuddly_scroll?this.scroll_area.barWidth()+1+r:r)
if(ye.touch_mode&&!c){y-=2*I
P=3*I
k=6*I}var B=this.edit_text_entry.run({x:E,y:y,w:k,font_height:P,pointer_lock:e.pointerlock})
_=this.isFocused()
if(B===this.edit_text_entry.SUBMIT){this.scroll_area.scrollToEnd()
var U=this.edit_text_entry.getText().trim()
if(U){var G=Date.now()
this.edit_text_entry.setText("")
if("/"===U[0]){if("/"===U[1])U=U.slice(1)
this.history.add(U)
if(Le())Le().serverLog("cmd",U)
this.cmdParse(U.slice(1),function(e){if(!e)return
if(t.volume_out)setTimeout(function(){return Oe.playUISound("msg_out_err",t.volume_out)},Ie(0,1e3*t.msg_out_err_delay-(Date.now()-G)))
if(!t.edit_text_entry.getText())t.edit_text_entry.setText(U)
if(!_)t.focus()})}else this.sendChat(0,U)
if(this.volume_out)Oe.playUISound("msg_out",this.volume_out)
if(Re.chat_auto_unfocus){_=false
xe()}}else{_=false
xe()}}}}y-=a
var F=this.url_match,W=this.url_info,j=this.styles,H=this.wrap_w,z=this.user_context_cb
var V=this
var Y=_||e.always_scroll
var q=0
var K={}
var X=false
function drawChatLine(e,t){if(e.hidden)return
var r=e.msg_text
var a=e.numlines
var i=Y&&F&&Ne(r,F)
var o=i=i&&1===i.length&&i[0]
if(i&&W){var n=i.match(W)
if(n)o=n[1]}var s=I*a
var l
var c=false
if(Y&&!ye.mousePosIsTouch()&&(!e.style||messageFromUser(e)||i)){l=Oe.font.getStringWidth(j.def,I,r)
c=ye.mouseOver({x:E,y:y,w:Se(l,H),h:s,peek:true})}var _=false
var u=0
var d=false
if(e.flags&Me&&z&&e.id&&Y){var f=K[e.display_name]
if(!f)f=K[e.display_name]=Oe.font.getStringWidth(j.def,I,e.display_name)
if(!(e.flags&Ce)){if(!q)q=Oe.font.getStringWidth(j.def,I,"[]")
f+=q}var v={x:E,y:y,w:Se(u=f,H),h:I,button:0,peek:true,z:T+.5,color:De}
if(ye.click(v)){d=true
z({user_id:e.id})}else{_=ye.mouseOver(v)
if(V.user_id_mouseover===e.id)Oe.drawRect2(_extends({},v,{color:Pe}))
if(_){Oe.drawRect2(v)
X=true
V.user_id_mouseover=e.id}}}var h
if(i)h=Te({x:E+u,y:y,w:H-u,h:s,url:i,internal:true})
var p
if(i)p=c&&!_?j.link_hover:j.link
else p=j[e.style]||j.def
Oe.font.drawSizedWrapped(Ee.styleAlpha(p,t),E,y,T+1,H,V.indent,I,r)
if(c&&(!Y||y>V.scroll_area.getScrollPos()-I)&&(!e.style||messageFromUser(e)||i))Oe.drawTooltip({x:E,y:y,z:Z.TOOLTIP,tooltip_above:true,tooltip_width:450*g,tooltip_pad:Ae(.5*Oe.tooltip_pad),tooltip:i&&!_?"Click to open "+o:"Received"+(e.id?' from "'+e.id+'"':"")+" at "+conciseDate(new Date(e.timestamp))+"\nRight-click to copy message"+(_?"\nClick to view user info":""),pixel_scale:.5*Oe.tooltip_panel_pixel_scale})
var m=ye.longPress({x:E,y:y,w:H,h:s})
h=h||ye.click({x:E,y:y,w:H,h:s})
if(d)h=null
if(h||m)if(m||2===h.button)Oe.provideUserString("Chat Text",i||r)
else if(i)V.cmdParseInternal("url "+o)
S=true}var Q=Date.now()
if(Y){var J=this.total_lines*I
if(e.cuddly_scroll){var $=s-r
J+=$-y
y=$}J+=i
y+=i
var ee=e.always_scroll?n+r-i:y-Se(this.h,J)
var te=y-ee
var re=1
this.scroll_area.begin({x:E-re,y:ee,z:T,w:h+re,h:te,focusable_elem:this.edit_text_entry,auto_hide:this.total_lines<=2})
var ae=E
var ie=y
E=re
y=0
var oe=this.scroll_area.getScrollPos()
var ne=oe+te
for(var se=0;se<this.msgs.length;++se){var le=this.msgs[se]
var ce=I*le.numlines
if(y<=ne&&y+ce>=oe)drawChatLine(le,1)
y+=ce}this.scroll_area.end(J)
E=ae
y=ie-te+i
ye.mouseDownEdge({x:o,y:y-r,w:l,h:s-y+r})
if(ye.mouseUpEdge({x:o,y:y-r,w:l,h:s-y+r,in_event_cb:e.pointerlock?ye.pointerLockEnter:null})){xe()
_=false}ye.mouseOver({x:o,y:y-r,w:l,h:s-y+r})
if(_&&ye.mouseDownEdge({peek:true})){xe()
_=false}}else{var _e=this.max_lines
for(var ue=0;ue<this.msgs.length;++ue){var de=this.msgs[this.msgs.length-ue-1]
var fe=Q-de.timestamp
var ve=1-be((fe-this.fade_start_time[u])/this.fade_time[u],0,1)
if(!ve||de.quiet)break
var he=de.numlines
if(he>_e&&ue)break
_e-=he
y-=I*he
drawChatLine(de,ve)}}if(!X)V.user_id_mouseover=false
if(e.pointerlock&&_&&ye.pointerLocked())ye.pointerLockExit()
if(!S&&(Oe.modal_dialog||Oe.menu_up||u))return
Oe.drawRect(o,y-r,o+l,s,T,[.3,.3,.3,.8])}
ChatUI.prototype.setChannel=function(e){var o=this
if(e===this.channel)return
if(this.channel){if(!e)this.addChat("Left channel "+this.channel.channel_id)
this.channel.removeMsgHandler("chat",this.on_chat)
this.channel.removeMsgHandler("join",this.on_join)
this.channel.removeMsgHandler("leave",this.on_leave)}this.channel=e
if(!this.channel)return
this.clearChat()
e.onMsg("chat",this.on_chat)
e.onMsg("join",this.on_join)
e.onMsg("leave",this.on_leave)
var n
var s=[]
var l={}
var c=[]
a([function(r){e.send("chat_get",null,function(e,t){if(!e&&t&&t.msgs&&t.msgs.length)n=t
r()})},function(n){e.onceSubscribe(function(e){var t=e&&e.public&&e.public.clients
if(t)for(var r in t){var a=t[r]
var i=a.ids&&a.ids.user_id
var o=false
if(i&&a.ids.display_name)if(l[i])o=true
else l[i]=a.ids.display_name
if(r===d()||o)continue
if(a.ids)if(i&&_(i))c.push(a.ids.display_name||i||r)
else s.push(a.ids.display_name||i||r)}n()})}],function(){if(!o.channel)return
if(n){var e=o.msgs.slice(0)
if(e.length)o.msgs=[]
for(var t=0;t<n.msgs.length;++t){var r=(n.idx+t)%n.msgs.length
var a=n.msgs[r]
if(a&&a.msg){a.quiet=true
if(l[a.id])a.display_name=l[a.id]
o.onMsgChat(a)}}if(e.length)o.msgs=o.msgs.concat(e)}o.addChat("Joined channel "+o.channel.channel_id,"join_leave")
if(s.length||c.length){var i=[]
if(s.length)if(s.length>10)i.push("Other users already here: "+s.slice(0,10).join(", ")+" (and "+(s.length-10)+" more...)")
else i.push("Other users already here: "+s.join(", "))
if(c.length)i.push("Friends already here: "+c.join(", "))
o.addChatFiltered({msg:i.join("\n"),style:"join_leave"})}})}
function chatUICreate(r){c()
var a=new ChatUI(r)
function emote(e,t){if(!e)return void t(null,"Usage: /me does something.")
if(r.emote_cb)r.emote_cb(e)
a.sendChat(Ce,e)}me.registerValue("volume_chat_joinleave",{type:me.TYPE_FLOAT,label:"Join/Leave chat message volume",range:[0,1],get:function get(){return a.volume_join_leave},set:function set(e){return a.volume_join_leave=e},store:true})
me.registerValue("volume_chat_in",{type:me.TYPE_FLOAT,label:"Incoming chat message volume",range:[0,1],get:function get(){return a.volume_in},set:function set(e){return a.volume_in=e},store:true})
me.registerValue("volume_chat_out",{type:me.TYPE_FLOAT,label:"Outgoing chat message volume",range:[0,1],get:function get(){return a.volume_out},set:function set(e){return a.volume_out=e},store:true})
me.register({cmd:"me",help:"Emote",usage:"$HELP\n  Example: /me jumps up and down!",func:emote})
me.register({access_show:["hidden"],cmd:"em",func:emote})
me.register({cmd:"echo",help:"Echo text locally",func:function func(e,t){a.addChatFiltered({msg:e})
t()}})
return a}},{"../common/util.js":330,"../common/vmath.js":332,"./camera2d.js":241,"./cmds.js":244,"./engine.js":250,"./font.js":260,"./input.js":271,"./link.js":273,"./local_storage.js":274,"./localization.js":275,"./net.js":279,"./scroll_area.js":289,"./settings.js":291,"./social.js":296,"./spot.js":300,"./ui.js":306,"./words/profanity.js":310,assert:void 0,"glov-async":void 0}],243:[function(e,t,r){"use strict"
r.getAbilityReload=getAbilityReload
r.setAbilityReload=setAbilityReload
r.MODE_PRODUCTION=r.MODE_DEVELOPMENT=r.PLATFORM_MOBILE=r.PLATFORM_MSSTART=r.PLATFORM_YANDEX=r.PLATFORM_IOS=r.PLATFORM_ANDROID=r.PLATFORM_FBINSTANT=r.PLATFORM_WEB=r.PLATFORM=void 0
var a=e("assert")
var i=e("../common/enums")
var o=i.Platform
a((0,i.isValidPlatform)(window.conf_platform))
var n=window.conf_platform
var s=(r.PLATFORM=n)===o.Web
r.PLATFORM_WEB=s
var l=n===o.FBInstant
r.PLATFORM_FBINSTANT=l
var c=n===o.Android
r.PLATFORM_ANDROID=c
var _=n===o.IOS
r.PLATFORM_IOS=_
var u=n===o.Yandex
r.PLATFORM_YANDEX=u
var d=n===o.MSStart
r.PLATFORM_MSSTART=d
var f=c||_
r.PLATFORM_MOBILE=f
a(s||l||c||_||u||d)
var v=(s||l)&&Boolean(String(document.location).match(/^https?:\/\/localhost/))
var h=!(r.MODE_DEVELOPMENT=v)
r.MODE_PRODUCTION=h
if(v){var p,m
a(s||!window.FB)
a(l||!window.FBInstant)
a(c===Boolean(window.androidwrapper))
a(_===Boolean(null==(p=window.webkit)?void 0:null==(m=p.messageHandlers)?void 0:m.iosWrapper))}var g=s||d
function getAbilityReload(){return g}function setAbilityReload(e){g=s&&e}},{"../common/enums":321,assert:void 0}],244:[function(e,t,r){"use strict"
r.resetSettings=resetSettings
r.safearea=r.cmd_parse=void 0
var a=e("../common/cmd_parse.js")
var i=e("./local_storage.js")
var n=a.create({storage:i})
r.cmd_parse=n
var o=e("./engine.js")
var s=e("./error_report.js").errorReportDetailsString
var l=e("./net.js")
var c=l.netClient,_=l.netDisconnected
var u=e("./shaders.js")
var d=e("./textures.js")
var f=e("../common/wscommon.js"),v=f.netDelayGet,h=f.netDelaySet
window.cmd=function(e){n.handle(null,e,a.defaultHandler)}
function byteFormat(e){if(e>85e4)return(e/1048576).toFixed(2)+"MB"
if(e>850)return(e/1024).toFixed(2)+"KB"
return e+"B"}n.register({cmd:"texmem",help:"Displays texture memory usage",func:function func(e,t){var r=Object.keys(d.textures);(r=r.filter(function(e){return d.textures[e].gpu_mem>1024})).sort(function(e,t){return d.textures[e].gpu_mem-d.textures[t].gpu_mem})
t(null,r.map(function(e){return byteFormat(d.textures[e].gpu_mem)+" "+e}).join("\n"))}})
n.register({cmd:"gpumem",help:"Displays GPU memory usage summary",func:function func(e,t){var r=o.perf_state.gpu_mem
t(null,byteFormat(r.geom)+" Geo\n"+byteFormat(r.tex)+" Tex\n"+byteFormat(r.geom+r.tex)+" Total")}})
function validDefine(e){if(u.semantic[e])return false
return e.match(/^[A-Z][A-Z0-9_]*$/)}n.register({cmd:"d",help:"Toggles a debug define",func:function func(e,t){if(!(e=e.toUpperCase().trim()))if(o.definesClearAll())return void t(null,"All debug defines cleared")
else return void t(null,"No debug defines active")
if(!validDefine(e))return void t("Invalid define specified")
o.defines[e]=!o.defines[e]
t(null,"D="+e+" now "+(o.defines[e]?"SET":"unset"))
o.definesChanged()}})
n.register({cmd:"renderer",help:"Displays current renderer",func:function func(e,t){t(null,"Renderer=WebGL"+(o.webgl2?2:1))}})
n.register({cmd:"csr",access_run:["sysadmin"],help:"(Admin) Run a command as another user",usage:"$HELP\n  /csr UserID command\nExample: /csr jimbly gems -100",func:function func(e,t){var r=e.indexOf(" ")
if(-1===r)return void t("Invalid number of arguments")
var a=e.slice(0,r)
var i=e.slice(r+1)
var o=l.subs.getChannelImmediate("user."+a).pak("csr_admin_to_user")
o.writeJSON(n.last_access)
o.writeString(i)
o.send(t)}})
function cmdDesc(e){return"/"+e.cmd+" - "+e.help}n.register({cmd:"help",help:"Searches commands",func:function func(e,t){var r=n.autoComplete("",this&&this.access)
if(e){var a=n.canonical(e)
var i=e.toLowerCase()
r=r.filter(function(e){return-1!==e.cname.indexOf(a)||-1!==e.help.toLowerCase().indexOf(i)})}if(!r.length)return void t(null,'No commands found matching "'+e+'"')
t(null,r.map(cmdDesc).join("\n"))}})
var p=[-1,-1,-1,-1]
r.safearea=p
n.registerValue("safe_area",{label:"Safe Area",type:n.TYPE_STRING,usage:"Safe Area value: Use -1 for auto based on browser environment,\nor 0-25 for percentage of screen size\n  Usage: /safe_area [value]\n  Usage: /safe_area horizontal,vertical\n  Usage: /safe_area left,right,top,bottom",default_value:"-1",get:function get(){return-1===p[0]?"-1 (auto)":p.join(",")},set:function set(e){var t=(e=String(e)).split(",")
if(e&&1===t.length)p[0]=p[1]=p[2]=p[3]=Number(e)
else if(2===t.length){p[0]=p[1]=Number(t[0])
p[2]=p[3]=Number(t[1])}else if(4===t.length)for(var r=0;r<4;++r)p[r]=Number(t[r])
for(var a=0;a<4;++a)if(!isFinite(p[a]))p[a]=-1},store:true})
n.register({cmd:"webgl2_auto",help:"Resets WebGL2 auto-detection",func:function func(e,t){if(!i.getJSON("webgl2_disable"))return t(null,"WebGL2 is already being auto-detected")
i.setJSON("webgl2_disable",void 0)
return t(null,"WebGL2 was disabled, will attempt to use it again on the next load")}})
n.registerValue("postprocessing",{label:"Postprocessing",type:n.TYPE_INT,help:"Enables/disables postprocessing",get:function get(){return o.postprocessing?1:0},set:function set(e){return o.postprocessingAllow(e)}})
n.register({cmd:"net_delay",help:"Sets/shows network delay values",usage:"$HELP\n/net_delay time_base time_rand",func:function func(e,t){if(e){var r=e.split(" ")
h(Number(r[0]),Number(r[1])||0)}var a=v()
t(null,"Client NetDelay: "+a[0]+"+"+a[1])}})
n.register({cmd:"error_report_details",help:"Shows details submitted with any error report",access_show:["hidden"],func:function func(e,t){t(null,s())}})
n.register({cmd:"disconnect",help:"Forcibly disconnect WebSocket connection (Note: will auto-reconnect)",func:function func(e,t){var r
var a=null==(r=c())?void 0:r.socket
if(!a)return void t("No socket")
if(_())return void t("Not connected")
a.close()
t()}})
function resetSettings(){var e=n.resetSettings()
if(o.definesClearAll())e.push("Debug defines cleared")
if(!e.length)return null
e.push("Please restart the app or reload to page for the new settings to take effect.")
return e.join("\n")}n.register({cmd:"reset_settings",help:"Resets all settings and options to their defaults (Note: requires an app restart)",func:function func(e,t){t(null,resetSettings()||"No stored settings to reset")}})},{"../common/cmd_parse.js":317,"../common/wscommon.js":334,"./engine.js":250,"./error_report.js":255,"./local_storage.js":274,"./net.js":279,"./shaders.js":293,"./textures.js":304}],245:[function(e,t,r){"use strict"
r.colorPicker=colorPicker
var w=e("./camera2d.js")
var a=e("./hsv.js"),L=a.hsvToRGB,i=a.rgbToHSV
var R=e("./input.js")
var x=Math.min
var O=e("./ui.js")
var b=O.LINE_CAP_SQUARE
var o=e("./sprites.js"),N=o.spriteClipped,C=o.spriteClipPause,M=o.spriteClipResume,l=o.spriteCreate
var c=e("./textures.js")
var D=e("../common/util.js").clamp
var n=e("../common/vmath.js"),_=n.vec3,P=n.v3copy,s=n.vec4
var k=s(0,0,0,1)
function colorPickerOpen(e){e.open=true
if(!e.color_hs){e.color_hs=s(0,0,0,1)
e.color_v=s(0,0,0,1)
e.hsv=_()}i(e.hsv,e.rgba)}function colorPickerAlloc(e){var t={open:false,rgba:s(0,0,0,1)}
P(t.rgba,e.color)
return t}var B
var U
function initTextures(){var e=32
var t=new Uint8Array(e*e*3)
var r=_()
var a=0
for(var i=0;i<e;i++){var o=1-i/(e-1)
for(var n=0;n<e;n++){L(r,360*n/(e-1),o,1)
t[a++]=255*r[0]
t[a++]=255*r[1]
t[a++]=255*r[2]}}B=l({url:"cpicker_hs",width:e,height:e,format:c.format.RGB8,data:t,filter_min:gl.LINEAR,filter_mag:gl.LINEAR,wrap_s:gl.CLAMP_TO_EDGE,wrap_t:gl.CLAMP_TO_EDGE})
t=new Uint8Array(32)
for(var s=0;s<t.length;++s)t[s]=255-255*s/(t.length-1)
U=l({url:"cpicker_v",width:1,height:t.length,format:c.format.R8,data:t,filter_min:gl.LINEAR,filter_mag:gl.LINEAR,wrap_s:gl.CLAMP_TO_EDGE,wrap_t:gl.CLAMP_TO_EDGE})}function colorPicker(e){var t=O.getUIElemData("colorpicker",e,colorPickerAlloc)
var r=e.icon_h||O.button_height
var a=e.icon_w||r
var i=e.picker_h||4*O.button_height
var o=e.pad||3
var n=e.x,s=e.y,l=e.z
if(!t.open)P(t.rgba,e.color)
if(O.buttonImage({x:n,y:s,z:l,w:a,h:r,img:O.sprites.white,color:t.rgba}))if(!t.open)colorPickerOpen(t)
else t.open=false
var c=O.button_mouseover
if(t.open){var _=N()
if(_)C()
if(!B)initTextures()
l+=2
var u=n+=a+o
var d=s=x(s,w.y1()-i)
var f=t.hsv
var v=i
var h=.1*i
L(t.color_v,0,0,f[2])
var p={x:n,y:s,z:l,w:v,h:i,color:t.color_v,max_dist:Infinity}
B.draw(p)
var m=R.drag(p)||R.click(p)
if(m){c=true
var g=m.cur_pos||m.pos
f[0]=D((g[0]-n)/p.w*360,0,360)
f[1]=D(1-(g[1]-s)/p.h,0,1)}var E=n+f[0]*v/360
var y=s+(1-f[1])*i
O.drawLine(E-o,y,E+o,y,l+1,1,1,k,b)
O.drawLine(E,y-o,E,y+o,l+1,1,1,k,b)
n+=v+o
L(t.color_hs,f[0],f[1],1)
var T={x:n,y:s,z:l,w:h,h:i,color:t.color_hs,max_dist:Infinity}
U.draw(T)
if(m=R.drag(T)||R.click(T)){c=true
var I=m.cur_pos||m.pos
f[2]=D(1-(I[1]-s)/T.h,0,1)}var S=s+(1-f[2])*i
O.drawLine(n,S,n+h,S,l+1,1,1,k,b)
n+=h
L(t.rgba,t.hsv[0],t.hsv[1],t.hsv[2])
var A={x:u-o,y:d-o,w:n-u+2*o,h:i+2*o,z:l-1}
if(R.mouseOver(A))c=true
R.drag(A)
O.panel(A)
if(_)M()
if(R.click({peek:true})||!c&&R.mouseDownAnywhere())t.open=false}P(e.color,t.rgba)}},{"../common/util.js":330,"../common/vmath.js":332,"./camera2d.js":241,"./hsv.js":269,"./input.js":271,"./sprites.js":302,"./textures.js":304,"./ui.js":306}],246:[function(e,t,r){"use strict"
r.alphaQueue=alphaQueue
r.alphaDraw=alphaDraw
r.alphaDrawListSize=alphaDrawListSize
r.alphaListPush=alphaListPush
r.alphaListPop=alphaListPop
r.opaqueQueue=opaqueQueue
r.opaqueDraw=opaqueDraw
var a=e("assert")
var i=e("./dyn_geom.js"),o=i.dynGeomDrawAlpha,n=i.dynGeomDrawOpaque
var s=e("./engine.js").mat_vp
var l=[]
function alphaQueue(e){var t=s[2]*e.mat[12]+s[6]*e.mat[13]+s[10]*e.mat[14]+s[14]
l.push([t+(e.sort_bias||0),e])}function cmpAlpha(e,t){return t[0]-e[0]}function alphaDraw(){gl.enable(gl.BLEND)
gl.depthMask(false)
l.sort(cmpAlpha)
for(var e=0;e<l.length;++e)l[e][1].drawAlpha(l[e][0])
l.length=0
o()}function alphaDrawListSize(){return l.length}var c=null
function alphaListPush(){a(!c)
c=l
l=[]}function alphaListPop(){a(!l.length)
a(c)
l=c
c=null}var _=[]
function opaqueQueue(e){_.push(e)}function opaqueDraw(){for(var e=0;e<_.length;++e)_[e]()
_.length=0
n()}},{"./dyn_geom.js":247,"./engine.js":250,assert:void 0}],247:[function(e,t,r){"use strict"
r.dynGeomAlloc=dynGeomAlloc
r.dynGeomLookAt=dynGeomLookAt
r.dynGeomSpriteSetup=dynGeomSpriteSetup
r.dynGeomQueueSprite=dynGeomQueueSprite
r.dynGeomDrawOpaque=dynGeomDrawOpaque
r.dynGeomDrawAlpha=dynGeomDrawAlpha
r.sprite3d_vshader=r.FACE_DEFAULT=r.FACE_CAMERA=r.FACE_FRUSTUM=r.FACE_XYZ=r.FACE_XY=r.FACE_NONE=r.BUCKET_ALPHA=r.BUCKET_DECAL=r.BUCKET_OPAQUE=void 0
var a=1
r.BUCKET_OPAQUE=a
var i=2
r.BUCKET_DECAL=i
var c=3
r.BUCKET_ALPHA=c
var o=0
r.FACE_NONE=o
var _=1
r.FACE_XY=_
var u=2
r.FACE_XYZ=u
var n=4
r.FACE_FRUSTUM=n
var d=8
r.FACE_CAMERA=d
var f=_|n
r.FACE_DEFAULT=f
var v=12
var s=e("assert")
var l=e("gl-mat4/lookAt")
var h=e("../common/util.js"),p=h.log2,m=h.nextHighestPowerOfTwo
var g=e("../common/vmath.js"),E=g.mat4,I=g.v3addScale,y=g.v3copy,T=g.v3cross,S=g.v3iNormalize,A=g.v3scale,w=g.v3sub,L=g.vec3,R=g.zero_vec
var x=e("./engine.js")
var O=x.engineStartupFunc,b=x.setGlobalMatrices
var N=e("./geom.js")
var C=Math.ceil,M=Math.max,D=Math.min
var P=e("./shaders.js")
var k=e("./sprites.js")
var B=k.BLEND_ALPHA,U=k.blendModeReset,G=k.blendModeSet
var F=e("./textures.js")
var W=F.cmpTextureArray
var j
var H=E()
var z
var V=0
var Y
var q
r.sprite3d_vshader=q
var K={}
var Z=[null,[],[],[]]
var X=new Uint16Array([1,3,0,1,2,3])
var Q=new Uint16Array([1,3,0,1,2,3,0,3,1,3,2,1])
var J=[]
function DynGeomData(){this.num_tris=0
this.tris=null
this.tri_pool_idx=0
this.num_verts=0
this.verts=null
this.vert_pool_idx=0
this.texs=null
this.shader=null
this.vshader=null
this.shader_params=null
this.blend=0
this.sort_z=0
this.uid=0}function dynGeomAlloc(){var e
if(J.length)e=J.pop()
else e=new DynGeomData
return e}DynGeomData.prototype.queue=function(e,t){s(isFinite(t))
s(this.texs)
s(this.shader)
s(this.vshader)
this.sort_z=t
this.uid=++V;++z.dyn
Z[e].push(this)}
var $=new Array(15).join(",").split(",").map(function(){return[]})
$[0]=null
var ee=new Array(15).join(",").split(",").map(function(){return[]})
ee[0]=null
var te=4096
var re=$.map(function(e,t){return D(te,1<<14-t)})
var ae=$.map(function(e,t){return D(te,1<<17-t)})
DynGeomData.prototype.allocVerts=function(e){this.num_verts=e
var t=p(this.num_verts)
s(t>0)
this.vert_pool_idx=t
var r=$[this.vert_pool_idx]
if(r&&r.length)this.verts=r.pop()
else{var a=r?m(e):e
this.verts=new Float32Array(v*a)}}
DynGeomData.prototype.allocTris=function(e){this.num_tris=e
var t=p(this.num_tris)
s(t>0)
this.tri_pool_idx=t
var r=ee[this.tri_pool_idx]
if(r&&r.length)this.tris=r.pop()
else{var a=r?m(e):e
this.tris=new Uint16Array(3*a)}}
DynGeomData.prototype.alloc=function(e,t){this.allocVerts(e)
this.allocTris(t)}
DynGeomData.prototype.allocQuad=function(e){this.allocVerts(4)
this.tris=e?Q:X
this.num_tris=this.tris.length/3
this.tri_pool_idx=0}
DynGeomData.prototype.dispose=function(){var e=$[this.vert_pool_idx]
if(e&&e.length<re[this.vert_pool_idx])e.push(this.verts)
this.verts=null
if((e=ee[this.tri_pool_idx])&&e.length<ae[this.tri_pool_idx])e.push(this.tris)
this.tris=null
J.push(this)}
var ie=L()
var oe=L()
var ne=L()
var se=L()
var le=L()
var ce=L()
function dynGeomLookAt(e,t,r){y(se,e)
y(oe,r)
A(ie,oe,-1)
w(ce,t,se)
S(ce)
T(le,ce,oe)
S(le)
T(ne,ce,le)
S(ne)
l(H,se,t,oe)
b(H)}var _e=L()
var ue=L(1,0,0)
var de=L()
function dynGeomSpriteSetup(e){var t=e.pos,r=e.shader,a=e.shader_params,i=e.bucket,o=e.facing,n=e.vshader
i=i||c
r=r||Y
n=n||q
a=a||null
var s
var l
if((o=void 0===o?f:o)&_){s=le
l=ie}else if(o&u){s=le
l=ne}else{s=ue
l=ie}if(s===le&&o&d){w(_e,t,se)
T(de,_e,oe)
s=S(de)}return{bucket:i,my_right:s,my_down:l,sort_z:j[2]*t[0]+j[6]*t[1]+j[10]*t[2]+j[14],shader:r,vshader:n,shader_params:a}}var fe=L()
function dynGeomQueueSprite(e,t){var r=dynGeomSpriteSetup(t),a=r.bucket,i=r.my_right,o=r.my_down,n=r.sort_z,s=r.shader,l=r.vshader,c=r.shader_params
var _=t.pos,u=t.offs,d=t.size,f=t.uvs,v=t.blend,h=t.color,p=t.doublesided
var m=dynGeomAlloc()
h=h||e.color
u=u||R
m.shader=s
m.vshader=l
m.shader_params=c
m.texs=e.texs
m.blend=v||B
p=p||false
var g=e.origin
var E=d[0],y=d[1]
I(fe,_,i,-g[0]*E+u[0])
I(fe,fe,o,-g[1]*y+u[1])
m.allocQuad(p)
var T=m.verts
T[0]=fe[0]
T[1]=fe[1]
T[2]=fe[2]
T[4]=h[0]
T[5]=h[1]
T[6]=h[2]
T[7]=h[3]
T[8]=f[0]
T[9]=f[1]
T[12]=fe[0]+o[0]*y
T[13]=fe[1]+o[1]*y
T[14]=fe[2]+o[2]*y
T[16]=h[0]
T[17]=h[1]
T[18]=h[2]
T[19]=h[3]
T[20]=f[0]
T[21]=f[3]
T[24]=fe[0]+i[0]*E+o[0]*y
T[25]=fe[1]+i[1]*E+o[1]*y
T[26]=fe[2]+i[2]*E+o[2]*y
T[28]=h[0]
T[29]=h[1]
T[30]=h[2]
T[31]=h[3]
T[32]=f[2]
T[33]=f[3]
T[36]=fe[0]+i[0]*E
T[37]=fe[1]+i[1]*E
T[38]=fe[2]+i[2]*E
T[40]=h[0]
T[41]=h[1]
T[42]=h[2]
T[43]=h[3]
T[44]=f[2]
T[45]=f[1]
m.queue(a,n)}var ve
var he
var pe
var me=0
var ge
var Ee=0
var ye=0
var Te
var Ie
var Se
var Ae=65532*v
var we=[]
function commit(){if(Ee===ye)return
we.push({state:ve,start:ye,end:Ee})
ye=Ee}function commitAndFlush(){commit()
if(!we.length)return
s(Ee)
he.updateIndex(ge,Ee)
var e=me/v
he.update(pe,e)
he.bind()
z.tris+=Ee/3
z.verts+=e
for(var t=0;t<we.length;++t){var r=we[t]
var a=r.state,i=r.start,o=r.end
if(Ie!==a.shader||Se!==a.vshader||a.shader_params){P.bind(a.vshader,a.shader,a.shader_params||K)
Ie=a.shader
Se=a.vshader}if(Te)G(a.blend)
F.bindArray(a.texs);++z.draw_calls_dyn
gl.drawElements(he.mode,o-i,gl.UNSIGNED_SHORT,2*i)}we.length=0
ye=Ee=me=0}function drawSetup(e){Te=e
Se=Ie=-1
if(!he){he=N.create([[P.semantic.POSITION,gl.FLOAT,4,false],[P.semantic.COLOR,gl.FLOAT,4,false],[P.semantic.TEXCOORD,gl.FLOAT,4,false]],[],[],N.TRIANGLES)
pe=new Float32Array(1024)
ge=new Uint16Array(1024)}}function drawElem(e){if(!ve||W(e.texs,ve.texs)||e.shader!==ve.shader||e.vshader!==ve.vshader||e.shader_params!==ve.shader_params||Te&&e.blend!==ve.blend){commit()
ve=e}var t=e.num_verts*v
if(me+t>pe.length){commitAndFlush()
if(pe.length!==Ae){var r=pe.length/v/3
var a=D(3*C(1.25*r)*v,Ae)
pe=new Float32Array(a)}}var i=3*e.num_tris
if(Ee+i>ge.length){commitAndFlush()
var o=ge.length/3
var n=M(e.tris.length,3*C(1.25*o))
ge=new Uint16Array(n)}var s=me/v
if(e.verts.length===t){pe.set(e.verts,me)
me+=t}else for(var l=0;l<t;++l)pe[me++]=e.verts[l]
for(var c=0;c<i;++c)ge[Ee++]=s+e.tris[c]}function finishDraw(){commitAndFlush()
U()}function queueDraw(e,t,r,a){drawSetup(e)
for(var i=r;i<a;++i){var o=t[i]
drawElem(o)
o.dispose()}finishDraw()}function cmpOpaue(e,t){var r=e.vshader.id-t.vshader.id
if(r)return r
if(r=e.shader.id-t.shader.id)return r
if(r=W(e.texs,t.texs))return r
return e.uid-t.uid}function cmpAlpha(e,t){var r=t.sort_z-e.sort_z
if(r)return r
return e.uid-t.uid}function dynGeomDrawOpaque(){profilerStart("dynGeomDrawOpaque")
var e=Z[a]
if(e.length){e.sort(cmpOpaue)
queueDraw(false,e,0,e.length)
e.length=0}if((e=Z[i]).length){e.sort(cmpOpaue)
queueDraw(true,e,0,e.length)
e.length=0}profilerStop("dynGeomDrawOpaque")}function dynGeomDrawAlpha(){profilerStart("dynGeomDrawAlpha")
s(!Z[a].length)
s(!Z[i].length)
var e=Z[c]
if(e.length){e.sort(cmpAlpha)
queueDraw(true,e,0,e.length)
e.length=0}profilerStop("dynGeomDrawAlpha")}function dynGeomStartup(){z=N.stats
r.sprite3d_vshader=q=P.create("shaders/sprite3d.vp")
Y=k.sprite_fshader
P.prelink(q,Y)
j=x.mat_vp}O(dynGeomStartup)},{"../common/util.js":330,"../common/vmath.js":332,"./engine.js":250,"./geom.js":263,"./shaders.js":293,"./sprites.js":302,"./textures.js":304,assert:void 0,"gl-mat4/lookAt":void 0}],248:[function(e,t,r){"use strict"
r.editBoxTick=editBoxTick
r.editBoxAnyActive=editBoxAnyActive
r.editBoxCreate=editBoxCreate
r.create=editBoxCreate
var a=e("assert")
var f=e("../common/verify.js")
var v=e("./camera2d.js")
var h=e("./engine.js")
var i=e("./input.js"),p=i.KEYS,m=i.eatAllKeyboardInput,g=i.mouseConsumeClicks,E=i.keyDownEdge,n=i.keyUpEdge,s=i.pointerLockEnter,o=i.pointerLockExit,l=i.pointerLocked,y=i.inputClick
var T=e("./localization.js").getStringIfLocalizable
var c=e("./spot.js"),_=c.SPOT_NAV_DOWN,u=c.SPOT_NAV_LEFT,d=c.SPOT_NAV_RIGHT,I=c.SPOT_NAV_UP,S=c.spotFocusCheck,A=c.spotFocusSteal,w=c.spotUnfocus,L=c.spotlog
var R=e("./ui.js")
var x=e("./ui.js").uiGetDOMElem
var O=false
var b
var N
var C=[]
var M=[]
function editBoxTick(){var e=h.frame_index-1
for(var t=0;t<M.length;++t){var r=M[t]
if(r.last_frame<e)r.unrun()}M=C
C=[]}function setActive(e){b=e
N=h.frame_index}function editBoxAnyActive(){return b&&N>=h.frame_index-1}function formHook(e){e.preventDefault()
if(!editBoxAnyActive())return
b.submitted=true
b.updateText()
if(b.pointer_lock&&!b.text)s("edit_box_submit")}var D=0
var P=function(){function GlovUIEditBox(e){var t
this.key="eb"+ ++D
this.x=0
this.y=0
this.z=Z.UI
this.w=R.button_width
this.type="text"
this.font_height=R.font_height
this.text=""
this.placeholder=""
this.max_len=0
this.zindex=null
this.uppercase=false
this.initial_focus=false
this.onetime_focus=false
this.auto_unfocus=false
this.initial_select=false
this.spellcheck=true
this.esc_clears=true
this.multiline=0
this.autocomplete=false
this.custom_nav=((t={})[u]=null,t[d]=null,t)
this.sticky_focus=true
this.applyParams(e)
a.equal(typeof this.text,"string")
this.last_autocomplete=null
this.is_focused=false
this.elem=null
this.input=null
this.submitted=false
this.pointer_lock=false
this.last_frame=0
this.out={}}var e=GlovUIEditBox.prototype
e.applyParams=function applyParams(e){if(!e)return
for(var t in e)this[t]=e[t]
if(void 0===this.text)this.text=""
this.h=this.font_height
if(this.multiline&&void 0===this.custom_nav[I])this.custom_nav[I]=null
if(this.multiline&&void 0===this.custom_nav[_])this.custom_nav[_]=null}
e.updateText=function updateText(){this.text=this.input.value
if(this.max_len>0)this.text=this.text.slice(0,this.max_len)}
e.getText=function getText(){return this.text}
e.setText=function setText(e){e=String(e)
if(this.input)this.input.value=e
this.text=e}
e.focus=function focus(){if(this.input){this.input.focus()
setActive(this)}else this.onetime_focus=true
A(this)
this.is_focused=true
if(this.pointer_lock&&l())o()}
e.unfocus=function unfocus(){w()}
e.isFocused=function isFocused(){return this.is_focused}
e.updateFocus=function updateFocus(e){var t=this.is_focused
var r=S(this)
var a=r.focused
var i=this.input&&document.activeElement===this.input
if(t!==a){if(a&&!i&&this.input){L("GLOV focused, DOM not, focusing",this)
this.input.focus()}if(!a&&i){L("DOM focused, GLOV not, and changed, blurring",this)
this.input.blur()}}else if(i&&!a){L("DOM focused, GLOV not, stealing",this)
A(this)
a=true}else if(!i&&a)if(e){this.onetime_focus=true
L("GLOV focused, DOM not, new edit box, focusing",this)}else if(document.activeElement===h.canvas||document.activeElement===this.postspan){L("GLOV focused, DOM canvas focused, unfocusing",this)
w()}if(a){setActive(this)
var o=this.pointer_lock&&!this.text?{in_event_cb:s}:null
if(n(p.ESC,o))if(this.text&&this.esc_clears)this.setText("")
else{w()
if(this.input)this.input.blur()
a=false
this.canceled=true}}this.is_focused=a
return r}
e.run=function run(e){this.applyParams(e)
var t=false
if(!f(this.last_frame!==h.frame_index))return null
if(this.last_frame!==h.frame_index-1){this.submitted=false
t=true}this.last_frame=h.frame_index
this.canceled=false
var r=this.updateFocus(t),a=r.allow_focus,i=r.focused
C.push(this)
var o=a&&x(this.elem,true)
if(o!==this.elem){if(o){if(!O){O=true
var n=document.getElementById("dynform")
if(n)n.addEventListener("submit",formHook,true)}o.textContent=""
var s=document.createElement(this.multiline?"textarea":"input")
s.setAttribute("type",this.type)
s.setAttribute("placeholder",T(this.placeholder))
if(this.max_len)s.setAttribute("maxLength",this.max_len)
if(this.multiline)s.setAttribute("rows",this.multiline)
s.setAttribute("tabindex",2)
o.appendChild(s)
var l=document.createElement("span")
l.setAttribute("tabindex",3)
this.postspan=l
o.appendChild(l)
s.value=this.text
if(this.uppercase)s.style["text-transform"]="uppercase"
this.input=s
if(this.initial_focus||this.onetime_focus){s.focus()
setActive(this)
this.onetime_focus=false}if(this.initial_select)s.select()}else this.input=null
this.submitted=false
this.elem=o}else if(this.input)this.updateText()
if(o){var c=v.htmlPos(this.x,this.y)
if(!this.spellcheck)o.spellcheck=false
o.style.left=c[0]+"%"
o.style.top=c[1]+"%"
var _=v.htmlSize(this.w,0)
o.style.width=_[0]+"%"
var u=o.style.fontSize||"?px"
var d=v.virtualToFontSize(this.font_height).toFixed(0)+"px"
if(d!==u)o.style.fontSize=d
if(this.zindex)o.style["z-index"]=this.zindex
if(this.last_autocomplete!==this.autocomplete){this.last_autocomplete=this.autocomplete
this.input.setAttribute("autocomplete",this.autocomplete||"auto_off_"+Math.random())}}if(i){if(this.auto_unfocus)if(y({peek:true}))w()
if(E(p.ENTER))this.submitted=true
m()}g({x:this.x,y:this.y,w:this.w,h:this.h})
if(this.submitted){this.submitted=false
return this.SUBMIT}if(this.canceled){this.canceled=false
return this.CANCEL}return null}
e.unrun=function unrun(){this.elem=null
this.input=null}
return GlovUIEditBox}()
P.prototype.SUBMIT="submit"
P.prototype.CANCEL="cancel"
function editBoxCreate(e){return new P(e)}},{"../common/verify.js":331,"./camera2d.js":241,"./engine.js":250,"./input.js":271,"./localization.js":275,"./spot.js":300,"./ui.js":306,assert:void 0}],249:[function(e,t,r){"use strict"
r.registerShader=registerShader
r.effectsPassAdd=effectsPassAdd
r.effectsPassConsume=effectsPassConsume
r.effectsQueue=effectsQueue
r.effectsTopOfFrame=effectsTopOfFrame
r.effectsReset=effectsReset
r.effectsIsFinal=effectsIsFinal
r.grayScaleMatrix=grayScaleMatrix
r.sepiaMatrix=sepiaMatrix
r.negativeMatrix=negativeMatrix
r.saturationMatrix=saturationMatrix
r.hueMatrix=hueMatrix
r.brightnessAddMatrix=brightnessAddMatrix
r.brightnessScaleMatrix=brightnessScaleMatrix
r.additiveMatrix=additiveMatrix
r.contrastMatrix=contrastMatrix
r.applyCopy=applyCopy
r.applyPixelyExpand=applyPixelyExpand
r.applyGaussianBlur=applyGaussianBlur
r.applyColorMatrix=applyColorMatrix
r.clearAlpha=clearAlpha
r.effectsStartup=effectsStartup
function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]
for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))e[a]=r[a]}return e}).apply(this,arguments)}var s=e("assert")
var _=e("./engine.js")
var u=_.renderWidth,d=_.renderHeight
var a=e("./framebuffer.js"),c=a.framebufferEnd,f=a.framebufferStart,i=a.framebufferTopOfFrame
var o=e("./geom.js")
var v=e("./shaders.js")
var n=e("./sprites.js").spriteQueueFn
var h=e("./textures.js")
var l=e("../common/vmath.js"),p=l.vec2,m=l.vec3,g=l.vec4,E=l.v4set
var y={vp_copy:{vp:"shaders/effects_copy.vp"},copy:{fp:"shaders/effects_copy.fp"},pixely_expand:{fp:"shaders/pixely_expand.fp"},gaussian_blur:{fp:"shaders/effects_gaussian_blur.fp"},color_matrix:{fp:"shaders/effects_color_matrix.fp"}}
function registerShader(e,t){y[e]=t}function getShader(e){var t=y[e]
if(!t.shader)if(t.fp)t.shader=v.create(t.fp)
else t.shader=v.create(t.vp)
return t.shader}var T=false
var I=g(2,2,-1,-1)
var S=p(1,1)
var A={clip_space:I,copy_uv_scale:S}
var w
var L
var R
var x
function startup(){T=true
x=o.create([[v.semantic.POSITION,gl.FLOAT,2,false]],new Float32Array([0,0,1,0,1,1,0,1]),null,o.QUADS)
w={clip_space:I,copy_uv_scale:S,colorMatrix:new Float32Array([0,0,0,0,0,0,0,0,0,0,0,0])}
L={clip_space:I,copy_uv_scale:S,sampleRadius:m(1,1,1),Gauss:new Float32Array([.93,.8,.7,.6,.5,.4,.3,.2,.1])}
R={clip_space:I,copy_uv_scale:S,orig_pixel_size:g()}}var O=0
function effectsPassAdd(){++O}function effectsPassConsume(){s(O);--O}function doEffect(e){effectsPassConsume()
e()}function effectsQueue(e,t){effectsPassAdd()
n(e,doEffect.bind(null,t))}function effectsTopOfFrame(){O=0
i()}function effectsReset(){s.equal(O,0)}function effectsIsFinal(){return!O}function grayScaleMatrix(e){e[0]=.2126
e[1]=.2126
e[2]=.2126
e[3]=.7152
e[4]=.7152
e[5]=.7152
e[6]=.0722
e[7]=.0722
e[8]=.0722
e[9]=e[10]=e[11]=0}function sepiaMatrix(e){e[0]=.393
e[1]=.349
e[2]=.272
e[3]=.769
e[4]=.686
e[5]=.534
e[6]=.189
e[7]=.168
e[8]=.131
e[9]=e[10]=e[11]=0}function negativeMatrix(e){e[0]=e[4]=e[8]=-1
e[1]=e[2]=e[3]=e[5]=e[6]=e[7]=0
e[9]=e[10]=e[11]=1}function saturationMatrix(e,t){var r=1-t
e[0]=.2126*r+t
e[1]=.2126*r
e[2]=.2126*r
e[3]=.7152*r
e[4]=.7152*r+t
e[5]=.7152*r
e[6]=.0722*r
e[7]=.0722*r
e[8]=.0722*r+t
e[9]=e[10]=e[11]=0}function hueMatrix(e,t){var r=Math.cos(t)
var a=Math.sin(t)
e[0]=.7874*r+-.3712362230889293*a+.2126
e[1]=-.2126*r+.20611404610069642*a+.2126
e[2]=-.2126*r+-.9485864922785551*a+.2126
e[3]=-.7152*r+-.4962902913954023*a+.7152
e[4]=.2848*r+.08105997779422341*a+.7152
e[5]=-.7152*r+.6584102469838492*a+.7152
e[6]=-.0722*r+.8675265144843316*a+.0722
e[7]=-.0722*r+-.28717402389491986*a+.0722
e[8]=.9278*r+.290176245294706*a+.0722
e[9]=e[10]=e[11]=0}function brightnessAddMatrix(e,t){e[0]=e[4]=e[8]=1
e[1]=e[2]=e[3]=e[5]=e[6]=e[7]=0
e[9]=e[10]=e[11]=t}function brightnessScaleMatrix(e,t){e[0]=e[4]=e[8]=t
e[1]=e[2]=e[3]=e[5]=e[6]=e[7]=0
e[9]=e[10]=e[11]=0}function additiveMatrix(e,t){e[0]=e[4]=e[8]=1
e[1]=e[2]=e[3]=e[5]=e[6]=e[7]=0
e[9]=t[0]
e[10]=t[1]
e[11]=t[2]}function contrastMatrix(e,t){e[0]=e[4]=e[8]=t
e[1]=e[2]=e[3]=e[5]=e[6]=e[7]=0
e[9]=e[10]=e[11]=.5*(1-t)}function applyEffect(e,t,r){var a=false!==e.final&&effectsIsFinal()||e.final
if(e.no_framebuffer){var i=_.viewport
var o=i[2]
var n=i[3]
r=r||n
I[0]=2*(t=t||o)/o
I[1]=2*r/n}else if(e.viewport){var s=e.viewport
var l=s[2]
var c=s[3]
r=r||c
I[0]=2*(t=t||l)/l
I[1]=2*r/c
f({clear:e.clear,clear_all:e.clear_all,clear_color:e.clear_color,viewport:s,final:a})}else{I[0]=2
I[1]=2
t=t||u()
r=r||d()
f({width:t,height:r,final:a})}v.bind(getShader("vp_copy"),getShader(e.shader),e.params)
h.bindArray(e.texs)
x.draw()}function applyCopy(e){if(!T)startup()
var t=e.source
if(!t)t=c({filter_linear:e.filter_linear,need_depth:e.need_depth})
e.shader=e.shader||"copy"
e.params=e.params?_extends({},A,e.params):A
if(Array.isArray(t))e.texs=t
else e.texs=[t]
applyEffect(e)}function applyPixelyExpand(e){if(!T)startup()
var t=e.source
s(!t)
if(!t)t=c({filter_linear:true})
var r=t.width
var a=t.height
var i=(e.hblur||.25)/r
L.sampleRadius[0]=i
L.sampleRadius[1]=0
L.sampleRadius[2]=1
applyEffect({shader:"gaussian_blur",params:L,texs:[t],final:false},r,a)
var o=c({filter_linear:true})
i=(e.vblur||.75)/a
L.sampleRadius[0]=0
L.sampleRadius[1]=i
L.sampleRadius[2]=1
applyEffect({shader:"gaussian_blur",params:L,texs:[o],final:false},r,a)
var n=c({filter_linear:true})
E(R.orig_pixel_size,t.width,t.height,1/t.width,1/t.height)
applyEffect({shader:"pixely_expand",params:R,texs:[t,o,n],clear:e.clear,clear_all:e.clear_all,clear_color:e.clear_color,viewport:e.viewport})}function applyGaussianBlur(e){if(!T)startup()
var t=c({filter_linear:true})
var r=e.max_size||512
var a=e.min_size||128
var i=t
var o=_.viewport
var n=r
while(n>o[2]||n>o[3])n/=2
while(n>a){applyEffect({shader:e.shader_copy||"copy",params:A,texs:[i],final:false},n,n)
i=c({filter_linear:true})
n/=2}var s=(e.blur||1)/n
L.sampleRadius[0]=s
L.sampleRadius[1]=0
L.sampleRadius[2]=e.glow||1
applyEffect({shader:"gaussian_blur",params:L,texs:[i],final:false},n,n)
var l=c({filter_linear:true})
L.sampleRadius[0]=0
L.sampleRadius[1]=s
L.sampleRadius[2]=e.glow||1
applyEffect({shader:"gaussian_blur",params:L,texs:[l]})
return true}function applyColorMatrix(e){if(!T)startup()
var t=c({filter_linear:true})
var r=e.colorMatrix
var a=w.colorMatrix
a[0]=r[0]
a[1]=r[3]
a[2]=r[6]
a[3]=r[9]
a[4]=r[1]
a[5]=r[4]
a[6]=r[7]
a[7]=r[10]
a[8]=r[2]
a[9]=r[5]
a[10]=r[8]
a[11]=r[11]
applyEffect({shader:"color_matrix",params:w,texs:[t]})
return true}function clearAlpha(){var e=gl.getParameter(gl.DEPTH_TEST)
if(e)gl.disable(gl.DEPTH_TEST)
gl.colorMask(false,false,false,true)
applyCopy({source:h.textures.white,no_framebuffer:true})
gl.colorMask(true,true,true,true)
if(e)gl.enable(gl.DEPTH_TEST)}function effectsStartup(e){e.forEach(function(e){v.prelink(getShader("vp_copy"),getShader(e))})}},{"../common/vmath.js":332,"./engine.js":250,"./framebuffer.js":261,"./geom.js":263,"./shaders.js":293,"./sprites.js":302,"./textures.js":304,assert:void 0}],250:[function(d,e,v){"use strict"
v.disableRender=disableRender
v.addViewSpaceGlobal=addViewSpaceGlobal
v.setGlobalMatrices=setGlobalMatrices
v.setMatVP=setMatVP
v.setFOV=setFOV
v.setGameDims=setGameDims
v.postprocessingAllow=postprocessingAllow
v.glCheckError=glCheckError
v.releaseCanvas=releaseCanvas
v.reloadSafe=reloadSafe
v.defineCausesReload=defineCausesReload
v.definesChanged=definesChanged
v.definesClearAll=definesClearAll
v.updateMatrices=updateMatrices
v.getFrameTimestamp=getFrameTimestamp
v.getFrameIndex=getFrameIndex
v.getFrameDt=getFrameDt
v.getFrameDtActual=getFrameDtActual
v.setState=setState
v.stateActive=stateActive
v.resizing=resizing
v.addTickFunc=addTickFunc
v.removeTickFunc=removeTickFunc
v.postTick=postTick
v.preSpriteRender=preSpriteRender
v.postRender=postRender
v.renderWidth=renderWidth
v.renderHeight=renderHeight
v.setViewport=setViewport
v.clearHad3DThisFrame=clearHad3DThisFrame
v.setupProjection=setupProjection
v.setZRange=setZRange
v.start3DRendering=start3DRendering
v.startSpriteRendering=startSpriteRendering
v.projectionZBias=projectionZBias
v.fixNatives=fixNatives
v.isInBackground=isInBackground
v.onEnterBackground=onEnterBackground
v.onExitBackground=onExitBackground
v.setPixelyStrict=setPixelyStrict
v.getViewportPostprocess=getViewportPostprocess
v.setViewportPostprocess=setViewportPostprocess
v.setFonts=setFonts
v.engineStartupFunc=engineStartupFunc
v.startup=startup
v.loadsPending=loadsPending
v.onLoadMetrics=onLoadMetrics
v.hrnow=v.had_3d_this_frame=v.viewport=v.perf_state=v.PERF_HISTORY_SIZE=v.is_loading=v.hrtime=v.frame_dt=v.frame_index=v.frame_timestamp=v.postprocessing=v.border_clear_color=v.border_color=v.app_state=v.font=v.light_dir_ws=v.light_ambient=v.light_diffuse=v.mat_vp=v.mat_view=v.mat_projection=v.fov_x=v.fov_y=v.ZNEAR=v.ZFAR=v.defines=v.render_height=v.render_width=v.game_height=v.game_width=v.antialias_unavailable=v.antialias=v.dom_to_canvas_ratio=v.pixel_aspect=v.height=v.width=v.glov_particles=v.webgl2=v.canvas=v.DEBUG=void 0
d("./bootstrap.js")
var f=d("./client_config.js").MODE_DEVELOPMENT
v.DEBUG=f
var h=[];(v.require=d)("not_worker")
var p=d("assert")
var l=d("./browser.js").is_ios_safari
var m=d("./build_ui.js").buildUIStartup
var g=d("./camera2d.js")
var c=d("./cmds.js")
var E=d("./effects.js")
var t=E.effectsReset,y=E.effectsTopOfFrame,T=E.effectsIsFinal,I=E.effectsPassAdd,S=E.effectsPassConsume
var r=d("./error_report.js"),a=r.errorReportDisable,A=r.errorReportSetTimeAccum,o=r.errorReportSetDetails,w=r.glovErrorReportDisableSubmit,L=r.glovErrorReportSetCrashCB
var R=d("./font.js")
var x=R.fontTick
var i=d("./framebuffer.js"),O=i.framebufferStart,n=i.framebufferEndOfFrame
var b=d("./geom.js")
var N=d("./input.js")
var C=d("./local_storage.js")
var s=d("gl-mat3/fromMat4")
var _=d("gl-mat4/copy")
var u=d("gl-mat4/invert")
var M=d("gl-mat4/multiply")
var D=d("gl-mat4/transpose")
var P=d("gl-mat4/perspective")
var k=Math.asin,B=Math.cos,U=Math.floor,G=Math.min,F=Math.max,W=Math.PI,j=Math.round,H=Math.sin,z=Math.sqrt
var V=d("./models.js")
var Y=d("./perf.js")
var q=d("./profiler.js"),K=q.profilerFrameStart,X=q.profilerGarbageEstimate
var Q=d("./profiler_ui.js").profilerUIStartup
var J=d("../common/perfcounters.js").perfCounterTick
var $=d("./settings.js")
var ee=d("./shaders.js")
var te=d("./shader_debug_ui.js").shaderDebugUIStartup
var re=d("./sound.js"),ae=re.soundLoading,ie=re.soundStartup,oe=re.soundTick
var ne=d("./spot.js").spotEndInput
var se=d("./sprites.js"),le=se.blendModeReset,ce=se.spriteDraw,_e=se.spriteStartup
var ue=d("./textures.js")
var de=ue.texturesTick
var fe=d("./transition.js")
var ve=d("./ui.js"),he=ve.drawRect,pe=ve.internal,me=pe.cleanupDOMElems,ge=pe.uiEndFrame,Ee=pe.uiSetFonts,ye=pe.uiStartup,Te=pe.uiTick,Ie=ve.uiBindSounds
var Se=d("./urlhash.js")
var Ae=d("../common/util.js"),we=Ae.callEach,Le=Ae.clamp,Re=Ae.nearSame,xe=Ae.ridx
var Oe=d("../common/verify.js")
var be=d("../common/vmath.js"),Ne=be.mat3,Ce=be.mat4,Me=be.vec3,De=be.vec4,Pe=be.v3mulMat4,ke=be.v3iNormalize,Be=be.v4copy,Ue=be.v4same,Ge=be.v4set
var Fe
v.canvas=Fe
var We
v.webgl2=We
var je
v.glov_particles=je
var He
v.width=He
var ze
v.height=ze
var Ve
var Ye
var qe=1
v.pixel_aspect=qe
var Ke=window.devicePixelRatio||1
v.dom_to_canvas_ratio=Ke
var Ze
v.antialias=Ze
var Xe
v.antialias_unavailable=Xe
var Qe
v.game_width=Qe
var Je
v.game_height=Je
var $e
var et
v.render_width=et
var tt
v.render_height=tt
var rt=Se.register({key:"D",type:Se.TYPE_SET,change:definesChanged})
v.defines=rt
var at
v.ZFAR=at
var it
v.ZNEAR=it
var ot=1
v.fov_y=ot
var nt=1
v.fov_x=nt
var st=Ce()
v.mat_projection=st
var lt=Ce()
v.mat_view=lt
var ct=Ce()
var _t=Ce()
v.mat_vp=_t
var ut=Ce()
var dt=Ce()
var ft=Ce()
var vt=Ne()
var ht=Ne()
var pt=Me(.75,.75,.75)
v.light_diffuse=pt
var mt=Me(.25,.25,.25)
v.light_ambient=mt
var gt=Me(-1,-2,-3)
v.light_dir_ws=gt
var Et
v.font=Et
var yt=null
v.app_state=yt
var Tt=De(0,0,0,1)
v.border_color=Tt
var It=De(0,0,0,1)
v.border_clear_color=It
var St=false
function disableRender(e){if(St=e)me()}var At=[]
function addViewSpaceGlobal(e){var t=e+"_ws"
var r=ee.globals[t]
p(r)
p.equal(r.length,3)
var a=e+"_vs"
var i=Me()
ee.addGlobal(a,i)
At.push({vs:i,ws:r})}var wt=Ce()
function setGlobalMatrices(e){_(lt,e)
M(_t,st,lt)
ke(gt)
for(var t=0;t<At.length;++t){var r=At[t]
Pe(r.vs,r.ws,lt)}u(wt,lt)
s(ht,wt)}function setMatVP(e){setupProjection(ot,Ve,Ye,it,at)
_(lt,e)
M(_t,st,lt)}function setFOV(e){var t=Ve/Ye
if(t>$e){v.fov_y=ot=e
var r=H(ot/2)/B(ot/2)*t
v.fov_x=nt=2*k(r/z(r*r+1))}else{var a=H(e/2)/B(e/2)*$e
v.fov_x=nt=2*k(a/z(a*a+1))
var i=H(nt/2)/B(nt/2)/t
v.fov_y=ot=2*k(i/z(i*i+1))}}function setGameDims(e,t){v.game_width=Qe=e
v.game_height=Je=t
$e=Qe/Je}var Lt="5"
var Rt=C.get("glov_no_postprocessing")!==Lt
v.postprocessing=Rt
function postprocessingAllow(e){C.set("glov_no_postprocessing",e?void 0:Lt)
v.postprocessing=Rt=e}function glCheckError(){var e=gl.getError()
if(e){console.error(e)
throw new Error(e)}}function releaseCanvas(){try{if(gl){var e=gl.getExtension("WEBGL_lose_context")
if(e)e.loseContext()}}catch(e){}}function reloadSafe(){a()
releaseCanvas()
if(window.FBInstant)try{window.top.location.reload()}catch(e){window.FBInstant.quit()}else document.location.reload()}window.reloadSafe=reloadSafe
var xt={}
function defineCausesReload(e){xt[e]=rt[e]}defineCausesReload("FORCEWEBGL2")
defineCausesReload("NOWEBGL2")
function definesChanged(){for(var e in xt)if(rt[e]!==xt[e]){Se.onURLChange(reloadSafe)
break}ee.handleDefinesChanged()}function definesClearAll(){var e=false
for(var t in rt){rt[t]=false
e=true}if(e)definesChanged()
return e}function normalizeRow(e,t){var r=e[t]*e[t]+e[t+1]*e[t+1]+e[t+2]*e[t+2]
if(r>0){r=1/z(r)
e[t]*=r
e[t+1]*=r
e[t+2]*=r}}function updateMatrices(e){_(ct,e)
M(ut,lt,e)
M(ft,st,ut)
_(wt,e)
normalizeRow(wt,0)
normalizeRow(wt,4)
normalizeRow(wt,8)
M(dt,lt,wt)
u(wt,dt)
D(wt,wt)
s(vt,wt)}var Ot=0
v.frame_timestamp=Ot
function getFrameTimestamp(){return Ot}var bt=0
v.frame_index=bt
function getFrameIndex(){return bt}var Nt=0
v.frame_dt=Nt
function getFrameDt(){return Nt}var Ct=0
v.hrtime=Ct
var Mt=0
function getFrameDtActual(){return Mt}var Dt=null
var Pt=true
v.is_loading=Pt
function setState(e){if(Pt)Dt=e
else v.app_state=yt=e}function stateActive(e){if(Pt)return Dt===e
else return yt===e}var kt=1e3
var Bt=0
var Ut=0
var Gt=0
var Ft=1e3
var Wt=0
var jt=0
var Ht=128
v.PERF_HISTORY_SIZE=Ht
var zt=window.glov_perf_state={fpsgraph:{index:0,history:new Float32Array(2*Ht)},gpu_mem:{tex:0,geom:0}}
var Vt=(v.perf_state=zt).fpsgraph
Y.addMetric({name:"fps",show_stat:"show_fps",show_graph:"fps_graph",labels:{"fps: ":function fps(){return(1e3/kt).toFixed(1)},"ms/f: ":function msF(){return kt.toFixed(0)},"cpu: ":function cpu(){return Ft.toFixed(0)},"gc/f: ":function gcF(){return jt?jt.toFixed(1):""}},data:Vt,line_scale_top:50,colors:[De(1,.925,.153,1),De(0,.894,.212,1)]},true)
var Yt=true
var qt=false
var Kt=0
function resizing(){return Kt}var Zt=[]
function addTickFunc(e){Zt.push(e)}function removeTickFunc(e){var t=Zt.indexOf(e)
if(-1!==t){Zt.splice(t,1)
return true}return false}var Xt=[]
function postTick(e){e.ticks=e.ticks||1
e.inactive=e.inactive||false
p.equal(typeof e.fn,"function")
Xt.push(e)}var Qt=null
function preSpriteRender(e){if(!Qt)Qt=[]
Qt.push(e)}var Jt=null
function postRender(e){if(!Jt)Jt=[]
Jt.push(e)}function resetEffects(){t()
n()}function renderWidth(){return et||He}function renderHeight(){return tt||ze}var $t=function(){var e=window.screen
if(!l||!e)return 0
return{"896,414":896/414,"812,375":812/375,"736,414":736/414,"716,414":736/414,"667,375":667/375,"647,375":667/375,"548,320":1.775}[F(e.availWidth,e.availHeight)+","+G(e.availWidth,e.availHeight)]||0}()
function safariTopSafeArea(e,t){if($t&&Re(e/t,$t,.001))return 50*(window.devicePixelRatio||1)
return 0}var er
var tr
var rr
var ar
var ir=false
var or=[0,0,0,0]
var nr=[0,0,0,0]
function checkResize(){profilerStart("checkResize")
var e=window.visualViewport||{}
v.dom_to_canvas_ratio=Ke=window.devicePixelRatio||1
v.dom_to_canvas_ratio=Ke*=$.render_scale_all
var t=e.width||window.innerWidth
var r=e.height||window.innerHeight
if(r!==rr){rr=r
if(document.body)document.body.style.height=r+"px"}var a=Fe.getBoundingClientRect()
var i=j(a.width*Ke)||1
var o=j(a.height*Ke)||1
if(-1===c.safearea[0]){if(ar){var n=ar.offsetWidth
var s=ar.offsetHeight
if(n&&s)Ge(or,ar.offsetLeft*Ke,i-(n+ar.offsetLeft)*Ke,F(ar.offsetTop*Ke,safariTopSafeArea(t,r)*$.render_scale_all),ir?0:o-(s+ar.offsetTop)*Ke)}}else Ge(or,i*Le(c.safearea[0],0,25)/100,i*Le(c.safearea[1],0,25)/100,o*Le(c.safearea[2],0,25)/100,o*Le(c.safearea[3],0,25)/100)
if(!Ue(or,nr)){Be(nr,or)
g.setSafeAreaPadding(or[0],or[1],or[2],or[3])
Kt=F(Kt,1)}if(i!==er||o!==tr){window.pixel_scale=Ke
er=Fe.width=i||1
tr=Fe.height=o||1
v.width=He=Fe.width
v.height=ze=Fe.height
Kt=10}if(l&&(window.visualViewport||Kt))window.scroll(0,0)
profilerStop("checkResize")}var sr=De(0,0,1,1)
v.viewport=sr
function setViewport(e){Be(sr,e)
gl.viewport(e[0],e[1],e[2],e[3])}var lr=0
function requestFrame(e){var t=$.max_fps
var r=t>=250?10:1
if(lr>=r)return
if(rt.SLOWLOAD&&Pt)t=2
if(r>1)while(lr<r){setTimeout(tick,1)
lr++}else if(t){var a=F(0,j(1e3/t-(e||0)))
lr++
setTimeout(tick,a)}else{lr++
requestAnimationFrame(tick)}}var cr
var _r
v.had_3d_this_frame=_r
function clearHad3DThisFrame(){v.had_3d_this_frame=_r=false}function setupProjection(e,t,r,a,i){P(st,e,t/r,a,i)
cr=st[10]}function setZRange(e,t){v.ZNEAR=it=e
v.ZFAR=at=t
if(_r)setupProjection(ot,Ve,Ye,it,at)}function set3DRenderResolution(e,t){Ve=e
Ye=t}var ur
var dr
function start3DRendering(e){if((e=e||{}).width)set3DRenderResolution(e.width,e.height)
setFOV(e.fov||$.fov*W/180)
v.had_3d_this_frame=_r=true
if(!e.width&&ur&&!rt.NOCOPY){dr=true
I()}le(true)
gl.enable(gl.BLEND)
gl.enable(gl.DEPTH_TEST)
gl.depthMask(true)
var t=Ve
var r=Ye
if(e.viewport){t=et||He
r=tt||ze}O({width:t,height:r,final:T(),need_depth:e.need_depth||true,clear:true,clear_all:void 0===e.clear_all?$.render_scale_clear:e.clear_all,viewport:e.viewport})
setupProjection(ot,Ve,Ye,it,at)
gl.enable(gl.CULL_FACE)}function renderScaleFinish(){if(rt.NOCOPY){gl.disable(gl.SCISSOR_TEST)
Ge(sr,0,0,He,ze)
gl.viewport(sr[0],sr[1],sr[2],sr[3])}else{S()
if(2===$.render_scale_mode)E.applyPixelyExpand({final:T(),clear:false})
else E.applyCopy({filter_linear:0===$.render_scale_mode})}}function startSpriteRendering(){gl.disable(gl.CULL_FACE)
le(true)
gl.enable(gl.BLEND)
gl.disable(gl.DEPTH_TEST)
gl.depthMask(false)}function projectionZBias(e,t){if(!e){st[10]=cr
return}var r=e/(t*(t+e))*.2
r=F(r,2e-7)
st[10]=cr+r}function fixNatives(e){var t=[]
for(var r in t){console[e?"log":"error"]('Found invasive enumerable property "'+r+'" on Array.prototype, removing...')
var a=t[r]
o("had_native_"+r,typeof a)
delete Array.prototype[r]
Object.defineProperty(Array.prototype,r,{value:a,enumerable:false})}for(var i in t)p(false,"Array.prototype has unremovable member "+i)}function resetState(){profilerStart("resetState")
profilerStart("textures")
ue.texturesResetState()
profilerStopStart("shaders")
ee.shadersResetState()
profilerStopStart("geom;gl")
b.geomResetState()
le(true)
gl.enable(gl.BLEND)
gl.enable(gl.DEPTH_TEST)
gl.depthMask(true)
gl.enable(gl.CULL_FACE)
gl.depthFunc(gl.LEQUAL)
gl.disable(gl.SCISSOR_TEST)
gl.cullFace(gl.BACK)
gl.viewport(0,0,He,ze)
profilerStop()
profilerStop("resetState")}var fr=false
var vr=[]
var hr=[]
function isInBackground(){return fr}function onEnterBackground(e){vr.push(e)}function onExitBackground(e){hr.push(e)}var pr=window.performance?window.performance.now.bind(window.performance):Date.now.bind(Date)
v.hrnow=pr
var mr=0
function tick(e){K()
profilerStart("tick")
profilerStart("top")
lr--
v.hrtime=Ct=pr()
var t=j(Ct)
if(!mr)mr=t
var r=G(F(Mt=t-mr,1),250)
v.frame_dt=Nt=r
mr=t
v.frame_timestamp=Ot+=r
v.frame_index=bt+=1
A(Ot)
fixNatives(false)
Vt.history[Vt.index%Ht*2+1]=Mt
Vt.index++
Vt.history[Vt.index%Ht*2+0]=0;++Ut
Wt+=Gt
if(t-Bt>1e3*$.fps_window)if(!Bt)Bt=t
else{kt=(t-Bt)/Ut
Ft=Wt/Ut
Wt=0
jt=X()/1024
Ut=0
Bt=t}J(r)
y()
if(document.hidden||document.webkitHidden||St){resetEffects()
N.tickInputInactive()
Gt=0
for(var a=Xt.length-1;a>=0;--a)if(Xt[a].inactive&&!--Xt[a].ticks){Xt[a].fn()
xe(Xt,a)}requestFrame()
profilerStop()
return profilerStop("tick")}if(fr){fr=false
we(hr)}checkResize()
v.had_3d_this_frame=_r=false
dr=ur=false
if(et){set3DRenderResolution(et,tt)
I()}else{Ve=F(1,j(He*$.render_scale))
Ye=F(1,j(ze*$.render_scale))
if(Ve!==He)ur=true}resetState()
ue.bind(0,ue.textures.error)
x()
g.tickCamera2D()
fe.render(r)
g.setAspectFixed(Qe,Je)
profilerStopStart("mid")
oe(r)
N.tickInput()
Te(r)
if(Kt){--Kt
var i=[]
g.virtualToDom(i,[0,0])
var o=[]
g.virtualToDom(o,[Qe-1,Je-1])
var n=[i[0],i[1],o[0],o[1]]
var s=n[3]-n[1]
var l=G(256,F(2,U(s/800*16)))
var c=document.getElementById("fullscreen")
if(c)c.style["font-size"]=l+"px"}if(Yt){he(g.x0Real(),g.y0Real(),g.x1Real(),0,Z.BORDERS,Tt)
he(g.x0Real(),Je,g.x1Real(),g.y1Real(),Z.BORDERS,Tt)
he(g.x0Real(),0,0,Je,Z.BORDERS,Tt)
he(Qe,0,g.x1Real(),Je,Z.BORDERS,Tt)}Y.draw()
profilerStopStart("app_state")
for(var _=0;_<Zt.length;++_)Zt[_](r)
if(yt)yt(r)
profilerStopStart("bottom")
ne()
je.tick(r)
if(_r){if(dr)renderScaleFinish()}else if(et)O({width:et,height:tt,clear:true,clear_all:$.render_scale_clear,final:T(),need_depth:false})
else O({width:He,height:ze,clear:true,final:T(),need_depth:false})
if(Qt)we(Qt,Qt=null)
startSpriteRendering()
ce()
ge()
if(Jt)we(Jt,Jt=null)
if(et){S()
var u=[g.render_offset_x,g.render_offset_y_bottom,g.render_viewport_w,g.render_viewport_h]
var d={clear:true,clear_all:true,clear_color:It,viewport:u}
if(qt)E.applyPixelyExpand(d)
else E.applyCopy(d)}N.endFrame()
resetEffects()
de()
for(var f=Xt.length-1;f>=0;--f)if(!--Xt[f].ticks){Xt[f].fn()
xe(Xt,f)}Gt=pr()-t
Vt.history[Vt.index%Ht*2+0]=Gt
requestFrame(pr()-Ct)
profilerStop("bottom")
return profilerStop("tick")}var gr=false
function onBlur(e){gr=true}function onFocus(e){gr=false}function periodiclyRequestFrame(){requestFrame()
setTimeout(periodiclyRequestFrame,1e3)
if(!fr&&gr)if(j(pr())-mr>400){fr=true
we(vr)}}function setPixelyStrict(e){if(e){v.render_width=et=Qe
v.render_height=tt=Je}else{v.render_width=et=void 0
v.render_height=tt=void 0}}function getViewportPostprocess(){return qt}function setViewportPostprocess(e){qt=e}function setFonts(e,t){v.font=Et=e
Ee(e,t)}function engineStartupFunc(e){h.push(e)}function startup(e){fixNatives(true)
v.canvas=Fe=document.getElementById("canvas")
ar=document.getElementById("safearea")
L(function(){setTimeout(requestFrame,1)})
if(false===e.error_report)w()
if(f&&!window.spector)Object.defineProperty(Number.prototype,"length",{get:function get(){p(false,"Numbers do not have a length property")
return}})
ir=e.safearea_ignore_bottom||false
window.addEventListener("resize",checkResize,false)
checkResize()
var t=e.pixely&&"off"!==e.pixely
v.antialias=Ze=e.antialias||!t&&false!==e.antialias
var r=e.high?"high-performance":"default"
var a=["webgl2","webgl","experimental-webgl"]
var i=rt.NOWEBGL2
var o=C.getJSON("webgl2_disable")
if(o&&o.ua===navigator.userAgent&&o.ts>Date.now()-6048e5){console.log("Disabling WebGL2 because a previous run encountered a related error")
i=true}if(f&&!rt.FORCEWEBGL2){var n=C.getJSON("run_count",0)+1
C.setJSON("run_count",n)
if(n%2)i=true}if(i)a.splice(0,1)
var s=[{antialias:Ze,powerPreference:r,alpha:false},{powerPreference:r,alpha:false},{antialias:Ze,alpha:false},{alpha:false},{}]
var l=false
v.webgl2=We=false
for(var c=0;!l&&c<a.length;c+=1)for(var _=0;!l&&_<s.length;++_)try{window.gl=Fe.getContext(a[c],s[_])
if(window.gl){if("webgl2"===a[c])v.webgl2=We=true
if(Ze&&!s[_].antialias){v.antialias_unavailable=Xe=true
v.antialias=Ze=false}l=true
break}}catch(e){}if(!window.requestAnimationFrame)l=false
if(!l){window.alert("Sorry, but your browser does not support WebGL or does not have it enabled.")
document.getElementById("loading").style.visibility="hidden"
document.getElementById("nowebgl").style.visibility="visible"
return false}var u=document.getElementById("nocanvas")
if(Oe(u))u.style.visibility="hidden"
console.log("Using WebGL"+(We?2:1))
p(gl)
Fe.focus()
setGameDims(e.game_width||1280,e.game_height||960)
v.ZNEAR=it=e.znear||.7
v.ZFAR=at=e.zfar||1e4
setPixelyStrict("strict"===e.pixely)
if(e.viewport_postprocess)qt=true
v.pixel_aspect=qe=e.pixel_aspect||1
gl.depthFunc(gl.LEQUAL)
gl.cullFace(gl.BACK)
gl.clearColor(0,.1,.2,1)
gl.pixelStorei(gl.UNPACK_ALIGNMENT,1)
ue.startup()
b.startup()
ee.startup({light_diffuse:pt,light_dir_ws:gt,ambient:mt,mat_m:ct,mat_mv:ut,mat_vp:_t,mvp:ft,mv_inv_trans:vt,mat_inv_view:ht,view:lt,projection:st})
addViewSpaceGlobal("light_dir")
g.startup()
_e()
N.startup(Fe,e)
V.startup()
window.addEventListener("blur",onBlur,false)
window.addEventListener("focus",onFocus,false)
v.glov_particles=je=d("./particles.js").create()
if(t){ue.defaultFilters(gl.NEAREST,gl.NEAREST)
$.runTimeDefault("render_scale_mode",1)}else ue.defaultFilters(gl.LINEAR_MIPMAP_LINEAR,gl.LINEAR)
p(e.font)
e.font=v.font=Et=R.create(e.font.info,e.font.texture)
if(e.title_font)e.title_font=R.create(e.title_font.info,e.title_font.texture)
ye(e)
ie(e.sound)
Ie(e.ui_sounds)
m()
te()
Q()
we(h,h=null)
g.setAspectFixed(Qe,Je)
if(e.state)setState(e.state)
if(void 0!==e.do_borders)Yt=e.do_borders
if(void 0!==e.show_fps)$.show_fps=e.show_fps
periodiclyRequestFrame()
return true}function loadsPending(){return ue.load_count+ae()+V.load_count}var Er=[]
function onLoadMetrics(e){Er.push(e)}onLoadMetrics(function(e){console.log(["Load time summary","  "+e.time_js_load+"ms JS load","  "+e.time_js_init+"ms JS init","  "+e.time_resource_load+"ms resource load",e.time_total+"ms total"].join("\n"))})
function loadingFinished(){var e=Date.now()
var t=window.time_load_onload-window.time_load_start
var r=window.time_load_init-window.time_load_onload
var a=e-window.time_load_init
var i=e-window.time_load_start
we(Er,null,{time_js_load:t,time_js_init:r,time_resource_load:a,time_total:i})}function loading(){var e=loadsPending()
var t=document.getElementById("loading_text")
if(t)t.innerText="Loading ("+e+")..."
if(!e){v.is_loading=Pt=false
v.app_state=yt=Dt
postTick({ticks:2,fn:function fn(){loadingFinished()
var e=document.getElementById("loading")
if(e)e.style.visibility="hidden"}})}}v.app_state=yt=loading
window.glov_engine=v},{"../common/perfcounters.js":326,"../common/util.js":330,"../common/verify.js":331,"../common/vmath.js":332,"./bootstrap.js":238,"./browser.js":239,"./build_ui.js":240,"./camera2d.js":241,"./client_config.js":243,"./cmds.js":244,"./effects.js":249,"./error_report.js":255,"./font.js":260,"./framebuffer.js":261,"./geom.js":263,"./input.js":271,"./local_storage.js":274,"./models.js":278,"./particles.js":280,"./perf.js":281,"./profiler.js":285,"./profiler_ui.js":286,"./settings.js":291,"./shader_debug_ui.js":292,"./shaders.js":293,"./sound.js":297,"./spot.js":300,"./sprites.js":302,"./textures.js":304,"./transition.js":305,"./ui.js":306,"./urlhash.js":307,assert:void 0,"gl-mat3/fromMat4":void 0,"gl-mat4/copy":void 0,"gl-mat4/invert":void 0,"gl-mat4/multiply":void 0,"gl-mat4/perspective":void 0,"gl-mat4/transpose":void 0,not_worker:void 0}],251:[function(e,t,r){"use strict"
r.EntityBaseClient=void 0
function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype)
_setPrototypeOf(e.prototype.constructor=e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){e.__proto__=t
return e})(e,t)}var s=e("assert")
var i=e("./engine")
var a=function(a){_inheritsLoose(EntityBaseClient,a)
function EntityBaseClient(e,t){var r;(r=a.call(this,e,t)||this).fading_out=void 0
r.fading_in=void 0
r.seq_id=void 0
r.data_overrides=void 0
r.fade=void 0
r.last_update_timestamp=void 0
r.is_me=void 0
r.fade=null
r.fading_out=false
r.fading_in=false
r.data_overrides=[]
r.seq_id=0
r.last_update_timestamp=i.frame_timestamp
r.is_me=e===t.my_ent_id
return r}var e=EntityBaseClient.prototype
e.isMe=function isMe(){return this.is_me}
e.getData=function getData(e,t){var r=this.data[e]
for(var a=0;a<this.data_overrides.length;++a){var i=this.data_overrides[a].data[e]
if(void 0!==i)if(null===i)r=void 0
else r=i}return null!=r?r:t}
e.setDataOverride=function setDataOverride(e,t){var r=this.getData(e)
var a=""+this.entity_manager.sub_id_prefix+ ++this.seq_id
t[e]=a
this.data_overrides.push({field:e,field_start:r,field_new:a,data:t})
return r}
e.postEntUpdate=function postEntUpdate(){var r=this
this.last_update_timestamp=i.frame_timestamp
if(this.data_overrides.length){var a={}
this.data_overrides=this.data_overrides.filter(function(e){var t=e.field
if(a[t])return true
else if(r.data[t]===e.field_start)return a[t]=true
else return false})}}
e.actionPrepDataAssignments=function actionPrepDataAssignments(e,t,r){s(!e.data_assignments)
s(!e.predicate)
var a=this.setDataOverride(t,r)
e.predicate={field:t,expected_value:a}
if(r.client_only){var i
e.data_assignments=((i={})[t]=r[t],i)}else e.data_assignments=r}
e.handleActionResult=function handleActionResult(e,t,r){if(t){var a=e.predicate
if(a){var i=a.field
var o=a.expected_value
this.data_overrides=this.data_overrides.filter(function(e){if(e.field===i)if(e.field_start===o){o=e.field_new
return false}return true})}}}
e.actionSend=function actionSend(e,t){(e.ent=this).entity_manager.actionSendQueued(e,t)}
e.applyBatchUpdate=function applyBatchUpdate(e,t){var r=e.field,a=e.action_id,i=e.payload,o=e.data_assignments
s(o)
s(!e.predicate)
var n={action_id:a,payload:i}
this.actionPrepDataAssignments(n,r,o)
this.actionSend(n,t)}
e.hasPendingBatchUpdate=function hasPendingBatchUpdate(){for(var e in this.data_overrides)return true
return false}
e.onDelete=function onDelete(e){return 250}
e.onCreate=function onCreate(e){return e&&!this.entity_manager.received_ent_ready?0:250}
return EntityBaseClient}(e("../common/entity_base_common").EntityBaseCommon)
r.EntityBaseClient=a},{"../common/entity_base_common":320,"./engine":250,assert:void 0}],252:[function(e,t,r){"use strict"
r.clientEntityManagerCreate=clientEntityManagerCreate
function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
return e}function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype)
_setPrototypeOf(e.prototype.constructor=e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){e.__proto__=t
return e})(e,t)}var I=e("assert")
var a=e("../common/entity_base_common")
var E=a.EALF_HAS_ASSIGNMENTS
var y=a.EALF_HAS_ENT_ID
var T=a.EALF_HAS_PAYLOAD
var S=a.EALF_HAS_PREDICATE
var _=a.EntityFieldEncoding
var A=a.EntityFieldSpecial
var w=a.EntityFieldSub
var u=a.EntityUpdateCmd
var i=e("../common/tiny-events").EventEmitter
var n=e("../common/util").ridx
var o=e("./engine")
var s=e("./net")
var l=s.netClientId
var c=s.netDisconnected
var d=s.netSubs
var f=e("./walltime.js")
var v=Math.max,h=Math.min,p=Math.round
function entActionAppend(e,t,r,a){var i=a.action_id,o=a.ent_id,n=a.predicate,s=a.self,l=a.payload,c=a.data_assignments
var _=0
if(n)_|=S
if(s);else _|=y
if(void 0!==l)_|=T
if(c)_|=E
r.writeInt(_)
r.writeAnsiString(i)
if(_&S){I(n)
r.writeAnsiString(n.field)
r.writeAnsiString(n.expected_value||"")}if(_&y){I(o)
r.writeInt(o)}if(_&T)r.writeJSON(l)
if(_&E){var u=e.field_defs_by_name
I(u)
for(var d in c){var f=u[d]
I(f)
var v=f.field_id,h=f.sub,p=f.default_value,m=f.encoder
I(!h)
var g=c[d]
if(g===p||null===g&&void 0===p){r.writeInt(A.Default)
r.writeInt(v)}else{r.writeInt(v)
m(t,r,g,false)}}r.writeInt(A.Terminate)}}var m=function(r){_inheritsLoose(ClientEntityManagerImpl,r)
function ClientEntityManagerImpl(e){var t;(t=r.call(this)||this).my_ent_id=void 0
t.on_broadcast=void 0
t.EntityCtor=void 0
t.channel=void 0
t.client_id=void 0
t.subscription_id=void 0
t.sub_id_prefix=void 0
t.entities=void 0
t.fading_ents=void 0
t.field_defs=void 0
t.field_defs_by_name=void 0
t.field_decoders=void 0
t.field_encoders=void 0
t.received_ent_ready=void 0
t.received_ent_start=void 0
t.frame_wall_time=void 0
t.action_list_queue=null
I(e.channel_type)
d().onChannelMsg(e.channel_type,"ent_update",t.onEntUpdate.bind(_assertThisInitialized(t)))
d().onChannelMsg(e.channel_type,"ent_broadcast",t.onBroadcast.bind(_assertThisInitialized(t)))
d().onChannelMsg(e.channel_type,"ent_start",t.onEntStart.bind(_assertThisInitialized(t)))
d().onChannelMsg(e.channel_type,"ent_ready",t.onEntReady.bind(_assertThisInitialized(t)))
d().onChannelMsg(e.channel_type,"ent_id_change",t.onEntIdChange.bind(_assertThisInitialized(t)))
d().onChannelEvent(e.channel_type,"subscribe",t.onChannelSubscribe.bind(_assertThisInitialized(t)))
t.reinit(e)
t.field_decoders=t.EntityCtor.field_decoders
t.field_encoders=t.EntityCtor.field_encoders
t.frame_wall_time=f()
return t}var e=ClientEntityManagerImpl.prototype
e.reinit=function reinit(e){this.deinit()
this.EntityCtor=e.EntityCtor||this.EntityCtor
this.on_broadcast=e.on_broadcast||this.on_broadcast
this.channel=e.channel
this.reinitInternal()}
e.reinitInternal=function reinitInternal(){this.entities={}
this.fading_ents=[]
this.my_ent_id=0
this.received_ent_ready=false
this.received_ent_start=false
this.sub_id_prefix="::"}
e.deinit=function deinit(){this.received_ent_start=false}
e.finalizeDelete=function finalizeDelete(e){this.emit("ent_delete",e)
delete this.entities[e]}
e.tick=function tick(){this.frame_wall_time=v(this.frame_wall_time,f())
if(this.fading_ents)for(var e=this.fading_ents.length-1;e>=0;--e){var t=this.fading_ents[e]
t.countdown-=o.frame_dt
var r=t.ent_id
if(t.countdown<=0){if(t.is_out)this.finalizeDelete(r)
else{var a=this.entities[r]
I(a)
I(a.fading_in)
a.fading_in=false
a.fade=null}n(this.fading_ents,e)}else{var i=this.entities[r]
I(i)
if(t.is_out)i.fade=h(1,t.countdown/t.countdown_max)
else i.fade=1-t.countdown/t.countdown_max}}}
e.getFrameWallTime=function getFrameWallTime(){return this.frame_wall_time}
e.receivedEntStart=function receivedEntStart(){return this.received_ent_start}
e.receivedEntReady=function receivedEntReady(){return this.received_ent_ready}
e.onChannelSubscribe=function onChannelSubscribe(e){this.reinitInternal()
this.client_id=l()
this.subscription_id=e.sub_id||this.client_id
this.sub_id_prefix=this.subscription_id+":"
this.emit("subscribe",e)}
e.onBroadcast=function onBroadcast(e){if(!this.received_ent_start)return
this.on_broadcast(e)}
e.fadeInEnt=function fadeInEnt(e,t){I(!e.fading_out)
I(!e.fading_in)
e.fading_in=true
this.fading_ents.push({is_out:false,ent_id:e.id,countdown:t,countdown_max:t})}
e.deleteEntityInternal=function deleteEntityInternal(e,t){var r=this.entities[e]
I(r)
I(!r.fading_out)
r.fading_out=true
var a=r.onDelete(t)
if(r.fading_in){r.fading_in=false
for(var i=0;i<this.fading_ents.length;++i){var o=this.fading_ents[i]
if(o.ent_id===e){if(a){o.is_out=true
o.countdown=p((r.fade||0)*a)
o.countdown_max=a}else{n(this.fading_ents,i)
this.finalizeDelete(e)}return}}I(false)}if(a)this.fading_ents.push({is_out:true,ent_id:e,countdown:a,countdown_max:a})
else this.finalizeDelete(e)}
e.getEntityForUpdate=function getEntityForUpdate(e){var t=this.entities[e]
if(!t)t=this.entities[e]=new this.EntityCtor(e,this)
if(t.fading_out){t.fading_out=false
t.fade=null
for(var r=0;r<this.fading_ents.length;++r)if(this.fading_ents[r].ent_id===e){n(this.fading_ents,r)
break}}return t}
e.readDiffFromPacket=function readDiffFromPacket(e,t){var r=this.field_defs,a=this.field_decoders
I(r)
var i=this.getEntityForUpdate(e)
var o=i.data
var n
while(n=t.readInt()){var s=n===A.Default
if(s)n=t.readInt()
var l=r[n]
if(!l)I(l,'Missing field_def in server-provided schema for field#"'+n+'"')
var c=l.default_value,_=l.encoding,u=l.field_name,d=l.sub
var f=a[_]
if(!f)I(f,"Missing decoder for type "+l.encoding)
if(d){I(!s)
var v=o[u]
if(d===w.Array){if(!v)v=o[u]=[]
I(Array.isArray(v))
var h=void 0
while(h=t.readInt())if(-1===h)v.length=t.readInt()
else{var p=f(t,v[h-1])
v[h-1]=p}}else{if(!v)v=o[u]={}
I(v&&"object"===typeof v&&!Array.isArray(v))
var m=v
var g=void 0
while(g=t.readAnsiString()){var E=f(t,m[g])
if(void 0===E)delete m[g]
else m[g]=E}}}else{var y=o[u]
var T=s?c:f(t,y)
if(void 0===T)delete o[u]
else o[u]=T}}i.postEntUpdate()
this.emit("ent_update",i.id)}
e.initSchema=function initSchema(e){var t=[null]
var r={}
var a=this.field_encoders
for(var i=0;i<e.length;++i){var o=e[i]
var n=i+A.MAX
var s=o.e||_.JSON
var l=a[s]
I(l)
var c=t[n]={encoding:s,encoder:l,default_value:o.d,sub:o.s||w.None,field_name:o.n,field_id:n}
r[c.field_name]=c}this.field_defs=t
this.field_defs_by_name=r}
e.initializeNewFullEnt=function initializeNewFullEnt(e){var t=this.field_defs
I(t)
var r=e.data
for(var a=0;a<t.length;++a){var i=t[a]
if(!i)continue
var o=i.default_value,n=i.field_name
if(void 0!==o&&o!==r[n])r[n]=o}}
e.onEntUpdate=function onEntUpdate(e){if(!this.received_ent_start){e.pool()
return}var t
var r=false
while(t=e.readU8())switch(t){case u.Full:var a=e.readInt()
var i=this.getEntityForUpdate(a)
this.initializeNewFullEnt(i)
this.readDiffFromPacket(a,e)
var o=i.onCreate(r)
if(o)this.fadeInEnt(i,o)
break
case u.Diff:var n=e.readInt()
this.readDiffFromPacket(n,e)
break
case u.Delete:var s=e.readInt()
var l=e.readAnsiString()
this.deleteEntityInternal(s,l)
break
case u.Event:var c=e.readJSON()
this.onBroadcast(c)
break
case u.Schema:var _=e.readJSON()
this.initSchema(_)
break
case u.IsInitialList:r=true
break
default:I(false,"Unexpected EntityUpdateCmd: "+t)}}
e.onEntReady=function onEntReady(){if(this.received_ent_start){this.received_ent_ready=true
this.emit("ent_ready")}}
e.isReady=function isReady(){return this.received_ent_ready}
e.onEntStart=function onEntStart(e){if(e.sub_id===this.subscription_id){this.my_ent_id=e.ent_id
this.received_ent_start=true
this.emit("ent_start")}}
e.onEntIdChange=function onEntIdChange(e){if(e.sub_id===this.subscription_id)this.my_ent_id=e.ent_id}
e.checkNet=function checkNet(){if(c()||!this.channel||!this.received_ent_ready)return true
if(l()!==this.client_id)return true
return false}
e.handleActionListResult=function handleActionListResult(e,t,r,a){a=a||[]
for(var i=0;i<t.length;++i){var o=a[i]||{}
var n=r||o.err
var s=o.data
var l=e[i]
var c=l.ent
c.handleActionResult(l,n,s)
var _=t[i]
if(_)_(n||null,s)
else{var u=l.predicate,d=l.data_assignments
if(u&&d){var f=u.field,v=u.expected_value
if("ERR_FIELD_MISMATCH"===n||"ERR_INVALID_ENT_ID"===n){console.log("Received (not unexpected) error "+n+" applying batch update "+f+"="+v+"->"+d[f]+" to ent:"+c.id)
return}}if(n)throw n}}}
e.actionListFlush=function actionListFlush(){if(!this.action_list_queue)return
I(this.channel)
var e=this.action_list_queue,t=e.action_list,r=e.resp_list
this.action_list_queue=null
var a=this.channel.pak("ent_action_list")
a.writeInt(t.length)
for(var i=0;i<t.length;++i){var o=t[i]
var n=o.ent
if(n.id===this.my_ent_id)o.self=true
else o.ent_id=n.id
entActionAppend(this,n,a,o)}a.send(this.handleActionListResult.bind(this,t,r))}
e.actionSendQueued=function actionSendQueued(e,t){if(!this.action_list_queue)this.action_list_queue={action_list:[],resp_list:[]}
this.action_list_queue.action_list.push(e)
this.action_list_queue.resp_list.push(t)}
e.getEnt=function getEnt(e){return this.entities[e]}
e.hasMyEnt=function hasMyEnt(){return Boolean(this.my_ent_id&&this.getEnt(this.my_ent_id))}
e.isEntless=function isEntless(){return!this.my_ent_id}
e.getMyEntID=function getMyEntID(){return this.my_ent_id}
e.getMyEnt=function getMyEnt(){I(this.my_ent_id)
var e=this.getEnt(this.my_ent_id)
I(e)
return e}
e.entitiesFind=function entitiesFind(e,t){var r=this.entities
var a=[]
for(var i in r){var o=r[i]
if(o.fading_out&&t)continue
if(!e(o))continue
a.push(o)}return a}
return ClientEntityManagerImpl}(i)
function clientEntityManagerCreate(e){return new m(e)}},{"../common/entity_base_common":320,"../common/tiny-events":328,"../common/util":330,"./engine":250,"./net":279,"./walltime.js":308,assert:void 0}],253:[function(e,t,r){"use strict"
r.entityPositionManagerCreate=entityPositionManagerCreate
r.PerEntData=void 0
var h=e("assert")
var v=e("./engine")
var p=e("./engine").getFrameTimestamp
var m=e("../common/util").sign
var a=e("./perf_net").registerPingProvider
var g=Math.abs,o=Math.floor,E=Math.max,y=Math.PI,i=Math.sqrt
var T=2*y
function defaultErrorHandler(e){if("ERR_FAILALL_DISCONNECT"!==e)throw e}var I=function PerEntData(e){this.pos=void 0
this.net_speed=void 0
this.net_pos=void 0
this.impulse=void 0
this.net_anim_state=void 0
this.anim_state=void 0
this.pos=e.vec()
this.net_speed=1
this.net_pos=e.vec()
this.impulse=e.vec()
this.net_anim_state={}
this.anim_state={}}
r.PerEntData=I
var n=function(){function EntityPositionManagerImpl(e){this.per_ent_data=void 0
this.entity_manager=void 0
this.dim_pos=void 0
this.dim_rot=void 0
this.n=void 0
this.tol_pos=void 0
this.tol_rot=void 0
this.send_time=void 0
this.entless_send_time=void 0
this.window=void 0
this.snap_factor=void 0
this.smooth_windows=void 0
this.smooth_factor=void 0
this.anim_state_defs=void 0
this.error_handler=void 0
this.ping_time=0
this.ping_time_time=0
this.temp_vec=void 0
this.temp_delta=void 0
this.sends_to_ignore=void 0
this.last_send=void 0
this.dim_pos=e.dim_pos||2
this.dim_rot=e.dim_rot||0
this.n=this.dim_pos+this.dim_rot
this.tol_pos=e.tol_pos||.01
this.tol_rot=e.tol_rot||.1
this.send_time=e.send_time||200
this.entless_send_time=e.entless_send_time||1e3
this.window=e.window||200
this.snap_factor=e.snap_factor||1
this.smooth_windows=e.smooth_windows||6.5
this.smooth_factor=e.smooth_factor||1.2
this.anim_state_defs=e.anim_state_defs||{}
this.error_handler=e.error_handler||defaultErrorHandler
this.entity_manager=e.entity_manager
this.entity_manager.on("ent_delete",this.handleEntDelete.bind(this))
this.entity_manager.on("subscribe",this.handleSubscribe.bind(this))
this.entity_manager.on("ent_update",this.otherEntityChanged.bind(this))
this.reinit()
this.temp_vec=this.vec()
this.temp_delta=this.vec()}var e=EntityPositionManagerImpl.prototype
e.reinit=function reinit(){this.per_ent_data={}
this.sends_to_ignore=0
this.last_send={pos:this.vec(-1),anim_state:{},sending:false,send_time:0,time:0,hrtime:0}}
e.handleEntDelete=function handleEntDelete(e){delete this.per_ent_data[e]}
e.handleSubscribe=function handleSubscribe(){this.reinit()}
e.getPos=function getPos(e){var t=this.per_ent_data[e]
if(!t)return null
return t.pos}
e.getPED=function getPED(e){return this.per_ent_data[e]}
e.vec=function vec(e){var t=new Float64Array(this.n)
if(e)for(var r=0;r<this.n;++r)t[r]=e
return t}
e.vcopy=function vcopy(e,t){for(var r=0;r<this.n;++r)e[r]=t[r]
return e}
e.arr=function arr(e){var arr=new Array(this.n)
for(var t=0;t<this.n;++t)arr[t]=e[t]
return arr}
e.arrPos=function arrPos(e){var t=new Array(this.dim_pos)
for(var r=0;r<this.dim_pos;++r)t[r]=e[r]
return t}
e.vsame=function vsame(e,t){for(var r=0;r<this.dim_pos;++r)if(g(e[r]-t[r])>this.tol_pos)return false
for(var a=this.dim_pos;a<this.n;++a)if(g(e[a]-t[a])>this.tol_rot)return false
return true}
e.vsamePos=function vsamePos(e,t){for(var r=0;r<this.dim_pos;++r)if(g(e[r]-t[r])>this.tol_pos)return false
return true}
e.vlength=function vlength(e){var t=0
for(var r=0;r<this.n;++r){var a=e[r]
t+=a*a}return i(t)}
e.vdist=function vdist(e,t){this.vsub(this.temp_vec,e,t)
for(var r=0;r<this.dim_rot;++r){var a=this.dim_pos+r
var i=g(this.temp_vec[a])
if(i>y)this.temp_vec[a]=i-o((i+y)/T)*T}return this.vlength(this.temp_vec)}
e.vsub=function vsub(e,t,r){for(var a=0;a<this.n;++a)e[a]=t[a]-r[a]
return e}
e.vscale=function vscale(e,t,r){for(var a=0;a<this.n;++a)e[a]=t[a]*r
return e}
e.stateDiff=function stateDiff(e,t){var r=this.anim_state_defs
var a=null
for(var i in r){var o=r[i]
if(e[i]!==t[i]&&(!o.equal||!o.equal(e[i],t[i])))(a=a||{})[i]=true}return a}
e.updateMyPos=function updateMyPos(e,t,r){var a=this
var i=this.entity_manager.isEntless()
if(!i&&!this.entity_manager.hasMyEnt())return
var o=i?!this.vsamePos(e,this.last_send.pos):!this.vsame(e,this.last_send.pos)
var n=!i&&this.stateDiff(t,this.last_send.anim_state)
if(o||n){var s=p()
var l=i?this.entless_send_time:this.send_time
if(!this.last_send.sending&&(!this.last_send.time||s-this.last_send.time>l)||r){if(this.last_send.sending)++this.sends_to_ignore
else this.last_send.sending=true
this.last_send.time=s
this.last_send.hrtime=v.hrnow()
var c=0
if(this.last_send.send_time){var _=s-this.last_send.send_time
if((c=this.vdist(this.last_send.pos,e)/_)<.001)c=0}this.last_send.send_time=s
this.vcopy(this.last_send.pos,e)
var u={}
if(o){u.pos=i?this.arrPos(this.last_send.pos):this.arr(this.last_send.pos)
if(!i)u.speed=c}if(n)for(var d in n){u[d]=t[d]
this.last_send.anim_state[d]=t[d]}var f=function handle_resp(e){if(!a.sends_to_ignore){a.last_send.sending=false
var t=p()
var r=v.hrnow()-a.last_send.hrtime
a.ping_time=r
a.ping_time_time=t
if(r>l)a.last_send.time=t}else--a.sends_to_ignore
if(e)return a.error_handler(e)}
if(this.entity_manager.isEntless()){h(this.entity_manager.channel)
this.entity_manager.channel.send("move",u,f)}else this.entity_manager.getMyEnt().actionSend({action_id:"move",data_assignments:u},f)}}else if(!this.last_send.sending)this.last_send.send_time=this.last_send.time=p()}
e.otherEntityChanged=function otherEntityChanged(e){var t=this.anim_state_defs
var r=this.entity_manager.getEnt(e)
h(r)
var a=r.data
var i=this.per_ent_data[e]
if(!i){i=this.per_ent_data[e]=new I(this)
for(var o in t)i.anim_state[o]=a[o]
this.vcopy(i.pos,a.pos)}for(var n in t)i.net_anim_state[n]=a[n]
if(!this.vsame(i.net_pos,a.pos)){this.vcopy(i.net_pos,a.pos)
i.net_speed=a.speed
for(var s=0;s<this.dim_rot;++s){var l=this.dim_pos+s
while(i.pos[l]>i.net_pos[l]+y)i.pos[l]-=T
while(i.pos[l]<i.net_pos[l]-y)i.pos[l]+=T}var c=this.vsub(this.temp_delta,i.net_pos,i.pos)
var _=this.vlength(c)
if(_>0){var u=_/i.net_speed
if(u<this.send_time+this.window)this.vscale(i.impulse,c,i.net_speed/_)
else if(u<this.send_time+this.window*this.smooth_windows){var d=this.vlength(i.impulse)
var f=i.net_speed
var v=E(f*this.smooth_factor,d)
this.vscale(i.impulse,c,v/_)}else this.vscale(i.impulse,c,1/(this.send_time+this.window*this.snap_factor))}}}
e.updateOtherEntity=function updateOtherEntity(e,t){var r=this.per_ent_data[e]
if(!r)return null
var a=true
for(var i=0;i<this.n;++i)if(r.impulse[i]){var o=r.net_pos[i]-r.pos[i]
var n=m(o)
r.pos[i]+=r.impulse[i]*t
var s=r.net_pos[i]-r.pos[i]
if(m(s)!==n){r.pos[i]=r.net_pos[i]
r.impulse[i]=0}else if(i<this.dim_pos&&g(r.impulse[i])>.001)a=false}var l=this.anim_state_defs
for(var c in l)if(r.anim_state[c]!==r.net_anim_state[c]){var _=l[c]
var u=true
if(_.stopped&&!a){var d=!_.stopped(r.anim_state[c])
var f=_.stopped(r.net_anim_state[c])
if(d&&f)u=false}if(u)r.anim_state[c]=r.net_anim_state[c]}return r}
e.getPing=function getPing(){var e=2e3
if(!this.ping_time_time)return null
var t=p()-this.ping_time_time
if(t>e)return null
return{ping:this.ping_time,fade:1-t/e}}
return EntityPositionManagerImpl}()
function entityPositionManagerCreate(e){var t=new n(e)
a(t.getPing.bind(t))
return t}},{"../common/util":330,"./engine":250,"./perf_net":282,assert:void 0}],254:[function(e,t,r){"use strict"
r.getCurrentEnvironment=getCurrentEnvironment
r.setCurrentEnvironment=setCurrentEnvironment
r.getLinkBase=getLinkBase
r.getAPIPath=getAPIPath
r.getExternalTextureURL=getExternalTextureURL
r.environmentsInit=environmentsInit
var s=e("assert")
var a=e("./client_config").setAbilityReload
var l=e("./cmds").cmd_parse
var i=e("./net").netForceDisconnect
var o=e("./urlhash")
var c={}
var _=null
var u=null
var n
var d
var f
function applyEnvironment(){n=_&&_.link_base||o.getURLBase()
d=_&&_.api_path||n+"api/"
f=n.replace("//localhost:","//127.0.0.1:")}applyEnvironment()
function getCurrentEnvironment(){return _}function setCurrentEnvironment(e){var t=_
if((_=e&&c[e]||u)!==t){applyEnvironment()
a(false)
i()}}function getLinkBase(){return n}function getAPIPath(){return d}function getExternalTextureURL(e){return e.match(/^.{2,7}:/)?e:""+f+e}function environmentsInit(e,t){c={}
var r=[]
for(var a=0,i=e.length;a<i;a++){var o=e[a]
var n=o.name
s(n.length>0)
c[n]=o
r.push(n)}_=u=t&&c[t]||null
applyEnvironment()
if(!r.some(function(e){return"default"===e.toLowerCase()}))r.push("default")
l.registerValue("environment",{type:l.TYPE_STRING,help:"Display or set the current client environment",usage:"Display the current client environment\n  Usage: /environment\nSet the current client environment ("+r.join(", ")+")\n  Usage: /environment <environment_name>",label:"Environment",get:function get(){return JSON.stringify(getCurrentEnvironment()||"default",null,2)},set:setCurrentEnvironment,access_show:["sysadmin"]})
l.register({cmd:"env",help:"Alias for /environment",access_show:["sysadmin"],func:function func(e,t){l.handle(this,"environment "+e,t)}})}},{"./client_config":243,"./cmds":244,"./net":279,"./urlhash":307,assert:void 0}],255:[function(e,t,r){"use strict"
r.errorReportDisable=errorReportDisable
r.errorReportIgnoreUncaughtPromises=errorReportIgnoreUncaughtPromises
r.errorReportSetDetails=errorReportSetDetails
r.errorReportSetDynamicDetails=errorReportSetDynamicDetails
r.errorReportSetTimeAccum=errorReportSetTimeAccum
r.errorReportDetailsString=errorReportDetailsString
r.hasCrashed=hasCrashed
r.errorReportClear=errorReportClear
r.glovErrorReportDisableSubmit=glovErrorReportDisableSubmit
r.glovErrorReportSetCrashCB=glovErrorReportSetCrashCB
r.glovErrorReport=glovErrorReport
r.session_uid=void 0
var a=""+String(Date.now()).slice(-8)+String(Math.random()).slice(2,8)
r.session_uid=a
var l=e("./environments").getAPIPath
var c=e("./fetch.js").fetch
var i=e("./client_config.js").PLATFORM
var _=false
function errorReportDisable(){_=true}var u=false
function errorReportIgnoreUncaughtPromises(){u=true}var o={}
var n={}
function errorReportSetDetails(e,t){if(t)o[e]=escape(String(t))
else delete o[e]}function errorReportSetDynamicDetails(e,t){n[e]=t}errorReportSetDetails("build","1675164989368")
errorReportSetDetails("sesuid",a)
errorReportSetDetails("platform",i)
var s=Date.now()
errorReportSetDetails("time_start",s)
errorReportSetDynamicDetails("url",function(){return escape(location.href)})
errorReportSetDynamicDetails("time_up",function(){return Date.now()-s})
var d=0
function errorReportSetTimeAccum(e){d=e}errorReportSetDynamicDetails("time_accum",function(){return d})
function getDynamicDetail(e){var t=n[e]()
if(!t&&0!==t)return""
return"&"+e+"="+t}function errorReportDetailsString(){return"&"+Object.keys(o).map(function(e){return e+"="+o[e]}).join("&")+Object.keys(n).map(getDynamicDetail).join("")}var f=0
var v=0
function hasCrashed(){return v>0}function errorReportClear(){f=0
window.debugmsg("",true)}var h=true
function glovErrorReportDisableSubmit(){h=false}var p=null
function glovErrorReportSetCrashCB(e){p=e}var m=/avast_submit|vc_request_action|^Error: Script error\.$|^Error: Script error\.\n  at \(0:0\)$|^Error: null$|^Error: null\n  at null\(null:null\)$|getElementsByTagName\('video'\)|document\.getElementById\("search"\)|change_ua|chrome-extension|setConnectedRobot|Failed to (?:start|stop) the audio device|zaloJSV2|getCookie is not defined|originalPrompt|_AutofillCallbackHandler|sytaxError|bannerNight|privateSpecialRepair|__gCrWeb|\$wrap is not/
function glovErrorReport(e,t,r,a,i){console.error(t)
if(p)p()
if(e){++v
var o=Date.now()
var n=o-f
f=o
if(_)return false
if(n<3e4)return false
if(t.match(m))return false}var s=l()
s+=(e?"errorReport":"errorLog")+"?cidx="+v+"&file="+escape(r)+"&line="+(a||0)+"&col="+(i||0)+"&msg="+escape(t)+errorReportDetailsString()
if(h)c({method:"POST",url:s},function(){})
if(u&&t.match(/Uncaught \(in promise\)/))return false
return true}window.glov_error_report=glovErrorReport.bind(null,true)},{"./client_config.js":243,"./environments":254,"./fetch.js":258}],256:[function(e,t,r){"use strict"
r.externalUsersEnabled=externalUsersEnabled
r.externalUsersLoggedIn=externalUsersLoggedIn
r.externalUsersAutoLoginProvider=externalUsersAutoLoginProvider
r.externalUsersLogIn=externalUsersLogIn
r.externalUsersLogOut=externalUsersLogOut
r.externalUsersCurrentUser=externalUsersCurrentUser
r.externalUsersFriends=externalUsersFriends
r.externalUsersPartyId=externalUsersPartyId
r.externalUsersSetupProvider=externalUsersSetupProvider
r.externalUsersSetup=externalUsersSetup
var a=e("assert")
var i=e("../common/external_users_common")
var o=i.ERR_NOT_AVAILABLE
var n=i.ERR_UNAUTHORIZED
var s=e("./social").registerExternalUserInfoProvider
var l={}
var c
function getClient(e){var t=l[e]
a(t)
return t}function externalUsersEnabled(e){var t=l[e]
return t&&t.enabled()||false}function externalUsersLoggedIn(e){var t=l[e]
return t&&t.loggedIn()||false}function externalUsersAutoLoginProvider(){return c}function externalUsersLogIn(e,t,r){getClient(e).logIn(t,r)}function externalUsersLogOut(e){if(e)getClient(e).logOut()
else for(var t in l)getClient(t).logOut()}function externalUsersCurrentUser(e,t){getClient(e).getCurrentUser(t)}function externalUsersFriends(e,t){var r=getClient(e)
if(r.getFriends)r.getFriends(t)
else t(o)}function externalUsersPartyId(e,t){var r=getClient(e)
if(r.getPartyId)r.getPartyId(t)
else t(o)}function externalUsersSetupProvider(t){var e=t.getProvider()
l[e]=t
s(e,function(e){if(t.loggedIn())t.getCurrentUser(e)
else e(n)},t.getFriends&&function(e){if(t.loggedIn())t.getFriends(e)
else e(n)})}function externalUsersSetup(e,t){c=t
e.forEach(externalUsersSetupProvider)}},{"../common/external_users_common":322,"./social":296,assert:void 0}],257:[function(e,t,r){"use strict"
r.onready=onready
r.fbInstantIsReady=fbInstantIsReady
r.fbInstantOnPause=fbInstantOnPause
r.canFollowOfficialPage=canFollowOfficialPage
r.canJoinOfficialGroup=canJoinOfficialGroup
r.fbIsTournamentActive=fbIsTournamentActive
r.fbGetTournamentData=fbGetTournamentData
r.fbCreateTournament=fbCreateTournament
r.fbLeaveTournament=fbLeaveTournament
r.fbInstantInit=fbInstantInit
var a=e("./error_report").errorReportSetDynamicDetails
var i=e("../common/util")
var o=i.callEach
var n=i.eatPossiblePromise
var s=i.nop
var l=i.once
var c=e("./local_storage")
var _=e("./urlhash")
var u=[]
function onready(e){if(!u)return void e()
u.push(e)}function fbInstantIsReady(){return null===u}var d=[]
function fbInstantLogEvent(e){FBInstant.logEvent(e)
d.push(e)
if(d.length>10)d.splice(0,1)}var f=false
function initSubscribe(e,t){t=t||false
function handleSubscribeToBotComplete(){if(e)setTimeout(e,1)}function handleSubscribeToBotFailure(e){if(e&&"USER_INPUT"===e.code)fbInstantLogEvent("bot_subscribe_useraborted")
else{fbInstantLogEvent("bot_subscribe_failure")
console.error("handleSubscribeToBotFailure",e)}handleSubscribeToBotComplete()}function subscribeToBot(){console.warn("Window social trying to bot subscribe")
if(-1!==FBInstant.getSupportedAPIs().indexOf("player.canSubscribeBotAsync"))FBInstant.player.canSubscribeBotAsync().then(function(e){if(e){fbInstantLogEvent("bot_subscribe_show")
FBInstant.player.subscribeBotAsync().then(function(){fbInstantLogEvent("bot_subscribe_success")
handleSubscribeToBotComplete()},handleSubscribeToBotFailure)}else handleSubscribeToBotComplete()},handleSubscribeToBotFailure)
else handleSubscribeToBotComplete()}function handleHomescreenComplete(){subscribeToBot()}function handleCreateShortcutFailure(e){if(e&&"USER_INPUT"===e.code)fbInstantLogEvent("homescreen_install_useraborted")
else{fbInstantLogEvent("homescreen_install_failure")
console.error("handleCreateShortcutFailure",e)}handleHomescreenComplete()}var r=c.get("instant.hasInstalledShortcut.v2")
function createShortcut(){console.warn("Window social trying to create shortcut")
if(-1!==FBInstant.getSupportedAPIs().indexOf("canCreateShortcutAsync")&&!r&&!f){f=true
FBInstant.canCreateShortcutAsync().then(function(e){if(e){fbInstantLogEvent("homescreen_install_show")
FBInstant.createShortcutAsync().then(function(){c.set("instant.hasInstalledShortcut.v2",true)
fbInstantLogEvent("homescreen_install_success")
handleHomescreenComplete()},handleCreateShortcutFailure)}else handleHomescreenComplete()},handleCreateShortcutFailure)}else handleHomescreenComplete()}if(t)subscribeToBot()
else createShortcut()}var v=[]
function fbInstantOnPause(e){v.push(e)}var h=false
var p=false
function canFollowOfficialPage(){return h}function canJoinOfficialGroup(){return p}var m=null
var g=null
function fbIsTournamentActive(){return Boolean(m)}function fbGetTournamentData(){return g}function updateCurrentTournament(e){g=(m=e)&&JSON.parse(m.getPayload())}function fbCreateTournament(e,t,r){t=t?l(t):s
r=r?l(r):s
FBInstant.tournament.createAsync(e).then(function(e){updateCurrentTournament(e)
t()},r)}function fbLeaveTournament(e,t){e=e?l(e):s
t=t?l(t):s
FBInstant.context.switchAsync("SOLO",true).then(function(){updateCurrentTournament(null)
e()},t)}function fbInstantInit(){if(!window.FBInstant)return
a("fblog",function(){return d.join(",")})
var e=1
var i=setInterval(function(){e*=.9
n(FBInstant.setLoadingProgress(100-100*e>>0))},100)
function fbInstantInitSub(){var e
var t=FBInstant.getEntryPointData()||{}
var r=(null==(e=fbGetTournamentData())?void 0:e.querystring)||t.querystring||{}
for(var a in r)_.set(a,r[a])
clearInterval(i)
FBInstant.startGameAsync().then(function(){o(u,u=null)
console.log("Initializing FBInstant")
initSubscribe(function(){console.log("All done initing FBInstant")
window.FBInstant.community.canFollowOfficialPageAsync().then(function(e){h=e},function(e){console.error(e)})
window.FBInstant.community.canJoinOfficialGroupAsync().then(function(e){p=e},function(e){console.error(e)})})})}function fbInstantInitSubWithTournaments(){FBInstant.getTournamentAsync().then(function(e){updateCurrentTournament(e)
fbInstantInitSub()},function(e){if(!e||"TOURNAMENT_NOT_FOUND"!==e.code)console.warn("FBInstant getTournamentAsync failed",e)
fbInstantInitSub()})}FBInstant.initializeAsync().then(fbInstantInitSubWithTournaments,function(e){return console.warn("FBInstant initializeAsync failed",e)})
FBInstant.onPause(function(){o(v)})}},{"../common/util":330,"./error_report":255,"./local_storage":274,"./urlhash":307}],258:[function(e,t,r){"use strict"
r.fetch=fetch
r.ERR_CONNECTION=void 0
var l=e("assert")
var c=e("../common/util.js").once
var _="ERR_CONNECTION"
r.ERR_CONNECTION=_
var a=/\/\/[^/]+\/([^?#]+)/
var i=/([^?#]+)/
function labelFromURL(e){var t=e.match(a)
if(t)return t[1]
return(t=e.match(i))?t[1]:e}function fetch(e,a){a=c(a)
var t=e.method,i=e.url,o=e.response_type,n=e.label
t=t||"GET"
l(i)
n=n||labelFromURL(i)
var s=new XMLHttpRequest
s.open(t,i,true)
if(o&&"json"!==o)s.responseType=o
s.onload=function(){profilerStart("fetch_onload:"+n)
if(200!==s.status&&0!==s.status){var e
try{e=s.responseText}catch(e){}a(String(s.status),e||"")}else if("json"===o){var t
var r
try{t=s.responseText
r=JSON.parse(t)}catch(e){console.error("Received invalid JSON response from "+i+": "+(t||"<empty response>"))
a(e)
profilerStop()
return}a(null,r)}else if("arraybuffer"===o)if(s.response)a(null,s.response)
else a("empty response")
else a(null,s.responseText)
profilerStop()}
s.onerror=function(){profilerStart("fetch_onerror:"+n)
a(_)
profilerStop()}
s.send(null)}},{"../common/util.js":330,assert:void 0}],259:[function(e,t,r){"use strict"
r.filewatchOn=filewatchOn
r.filewatchMessageHandler=filewatchMessageHandler
r.filewatchTriggerChange=filewatchTriggerChange
r.filewatchStartup=filewatchStartup
var a=e("assert")
var o={}
var n=[]
function filewatchOn(e,t){if("."===e[0]){a(!o[e])
o[e]=t}else n.push([e,t])}var s
function filewatchMessageHandler(e){s=e}function onFileChange(e){console.log("FileWatch change: "+e)
var t=e.lastIndexOf(".")
var r=false
if(-1!==t){var a=e.slice(t)
if(o[a])if(false!==o[a](e))r=true}for(var i=0;i<n.length;++i)if(e.match(n[i][0]))if(false!==n[i][1](e))r=true
if(s&&r)s("Reloading: "+e)}function filewatchTriggerChange(e){onFileChange(e)}function filewatchStartup(e){e.onMsg("filewatch",onFileChange)}},{assert:void 0}],260:[function(e,t,r){"use strict"
r.intColorFromVec4Color=intColorFromVec4Color
r.vec4ColorFromIntColor=vec4ColorFromIntColor
r.fontStyle=fontStyle
r.fontStyleColored=fontStyleColored
r.fontStyleAlpha=fontStyleAlpha
r.fontSetDefaultSize=fontSetDefaultSize
r.fontCreate=fontCreate
r.fontTick=fontTick
r.glov_font_default_style=r.font_shaders=r.ALIGN=void 0
r.style=fontStyle
r.styleColored=fontStyleColored
r.styleAlpha=fontStyleAlpha
r.create=fontCreate
var ne=e("assert")
var se=e("./camera2d.js")
var a=e("./camera2d.js"),le=a.transformX,ce=a.transformY
var _e=e("./engine.js")
var i=e("./geom.js")
var ue=e("./localization.js").getStringFromLocalizable
var de=Math.max,fe=Math.min,m=Math.round
var o=e("./shaders.js")
var n=e("./sprites.js")
var ve=n.BLEND_ALPHA,he=n.BLEND_PREMULALPHA,pe=n.spriteChainedStart,me=n.spriteChainedStop,ge=n.spriteDataAlloc
var s=e("./textures.js")
var l=e("../common/util.js").clamp
var c=e("../common/vmath.js"),_=c.v3scale,Ee=c.v3set,u=c.vec4,d=c.v4copy,ye=c.v4scale
var L={HLEFT:0,HCENTER:1,HRIGHT:2,HMASK:3,VTOP:0,VCENTER:4,VBOTTOM:8,VMASK:12,HFIT:16,HWRAP:32,HCENTERFIT:17,HRIGHTFIT:18,HVCENTER:5,HVCENTERFIT:21}
var g=(r.ALIGN=L).HMASK|L.HFIT
function GlovFontStyle(){this.color_vec4=new Float32Array([1,1,1,1])}GlovFontStyle.prototype.outline_width=0
GlovFontStyle.prototype.outline_color=0
GlovFontStyle.prototype.glow_xoffs=0
GlovFontStyle.prototype.glow_yoffs=0
GlovFontStyle.prototype.glow_inner=0
GlovFontStyle.prototype.glow_outer=0
GlovFontStyle.prototype.glow_color=0
GlovFontStyle.prototype.color=4294967295
var f={}
r.font_shaders=f
function intColorFromVec4Color(e){return(255*e[0]|0)<<24|(255*e[1]|0)<<16|(255*e[2]|0)<<8|255*e[3]|0}function vec4ColorFromIntColor(e,t){e[0]=(t>>24&255)/255
e[1]=(t>>16&255)/255
e[2]=(t>>8&255)/255
e[3]=(255&t)/255}function vec4ColorFromIntColorPreMultiplied(e,t){var r=e[3]=(255&t)/255
e[0]=(t>>24&255)*(r*=1/255)
e[1]=(t>>16&255)*r
e[2]=(t>>8&255)*r}var v=new GlovFontStyle
r.glov_font_default_style=v
function fontStyle(e,t){var r=new GlovFontStyle
var a=r.color_vec4
if(e)for(var i in e)r[i]=e[i]
for(var o in t)r[o]=t[o]
r.color_vec4=a
vec4ColorFromIntColor(r.color_vec4,r.color)
return r}function fontStyleColored(e,t){return fontStyle(e,{color:t})}function colorAlpha(e,t){return 4294967040&e|l(m((255&e)*t),0,255)}function fontStyleAlpha(e,t){return fontStyle(e,{color:colorAlpha((e||v).color,t),outline_color:colorAlpha((e||v).outline_color,t),glow_color:colorAlpha((e||v).glow_color,t)})}var Te=null
var h=false
var p=[]
var E=0
var y=[]
var T=0
var I=u()
var Ie
var Se={}
function techParamsAlloc(){if(T===y.length)y.push({param0:u(),outline_color:u(),glow_color:u(),glow_params:u()})
Te=y[T++]}function fontStartup(){if(Te)return
Ie=i.stats
techParamsAlloc()}function techParamsSet(e,t){var r=Te[e]
if(!h)if(r[0]!==t[0]||r[1]!==t[1]||r[2]!==t[2]||r[3]!==t[3]){var a=Te
techParamsAlloc()
d(Te.param0,a.param0)
d(Te.outline_color,a.outline_color)
d(Te.glow_color,a.glow_color)
d(Te.glow_params,a.glow_params)
Ie.font_params++
h=true
r=Te[e]}else return
if(h){r[0]=t[0]
r[1]=t[1]
r[2]=t[2]
r[3]=t[3]}}var S=["param0","outline_color","glow_color","glow_params"]
function sameTP(e){for(var t=0;t<4;++t){var r=S[t]
var a=Te[r]
var i=e[r]
for(var o=0;o<4;++o)if(a[o]!==i[o])return false}return true}function techParamsGet(){if(!h)return Te
h=false
for(var e=0;e<p.length;++e)if(sameTP(p[e])){if(Te===y[T-1])T--
Te=p[e]
if(E===e)E=(E+1)%4;--Ie.font_params
return Te}p[E]=Te
E=(E+1)%4
return Te}function GlovFont(e,t){ne(0!==e.font_size)
this.texture=s.load({url:"img/"+t+".png",filter_min:e.noFilter?gl.NEAREST:gl.LINEAR,filter_mag:e.noFilter?gl.NEAREST:gl.LINEAR,wrap_s:gl.CLAMP_TO_EDGE,wrap_t:gl.CLAMP_TO_EDGE})
this.textures=[this.texture]
this.integral=Boolean(e.noFilter)
this.font_info=e
this.font_size=e.font_size
this.inv_font_size=1/e.font_size
this.shader=f.font_aa
this.tex_w=e.imageW
this.tex_h=e.imageH
for(var r=0;r<e.char_infos.length;++r){var a=e.char_infos[r]
a.scale=1/(a.sc||1)
a.w=a.w||0}this.char_infos=[]
for(var i=0;i<e.char_infos.length;++i){var o=e.char_infos[i];(this.char_infos[e.char_infos[i].c]=o).xpad=o.xpad||0
o.yoffs=o.yoffs||0
o.w_pad_scale=(o.w+o.xpad)*o.scale}this.replacement_character=this.infoFromChar(65533)
if(!this.replacement_character)this.replacement_character=this.infoFromChar(63)
this.whitespace_character=this.infoFromChar(13)
this.default_style=new GlovFontStyle
this.applied_style=new GlovFontStyle
fontStartup()}GlovFont.prototype.drawSizedColor=function(e,t,r,a,i,o,n){return this.drawSized(fontStyleColored(e,o),t,r,a,i,n)}
GlovFont.prototype.drawSized=function(e,t,r,a,i,o){Se.style=e
Se.x=t
Se.y=r
Se.z=a
Se.xsc=i*this.inv_font_size
Se.ysc=i*this.inv_font_size
Se.text=o
return this.drawScaled()}
GlovFont.prototype.drawSizedAligned=function(e,t,r,a,i,o,n,s,l){profilerStart("drawSizedAligned")
l=ue(l)
if(o&L.HWRAP){var c=this.drawSizedAlignedWrapped(e,t,r,a,0,i,o&~L.HWRAP,n,s,l)
profilerStop("drawSizedAligned")
return c}var _=i
var u=i
if(o&g){var d=this.getStringWidth(e,_,l)
if(o&L.HFIT&&d>n){var f=n/d
_*=f
d=n
if(f<.5){if((o&L.VMASK)!==L.VCENTER&&(o&L.VMASK)!==L.VBOTTOM)r+=.5*(u-u*f*2)
u*=2*f}}switch(o&L.HMASK){case L.HCENTER:t+=.5*(n-d)
if(this.integral)t=m(t)
break
case L.HRIGHT:t+=n-d}}switch(o&L.VMASK){case L.VCENTER:r+=.5*(s-u)
if(this.integral)r=m(r)
break
case L.VBOTTOM:r+=s-u}var v=_*this.inv_font_size
var h=u*this.inv_font_size
Se.style=e
Se.x=t
Se.y=r
Se.z=a
Se.xsc=v
Se.ysc=h
Se.text=l
var p=this.drawScaled()
profilerStop("drawSizedAligned")
return p}
GlovFont.prototype.drawSizedAlignedWrapped=function(e,t,r,a,i,o,n,s,l,c){c=ue(c)
ne(s>0)
ne("string"!==typeof l)
var _=[]
var u=[]
_.length=this.wrapLines(e,s,i,o,c,n,function(e,t,r){u[t]=e
_[t]=r})
var d=0
var f=o*_.length
switch(n&L.VMASK){case L.VCENTER:d=(l-f)/2
if(this.integral)d|=0
break
case L.VBOTTOM:d=l-f}n&=~L.VMASK
for(var v=0;v<_.length;++v){var h=_[v]
if(h&&h.trim())this.drawSizedAligned(e,t+u[v],r+d,a,o,n,s-u[v],0,h)
d+=o}return d}
GlovFont.prototype.drawSizedColorWrapped=function(e,t,r,a,i,o,n,s,l){return this.drawScaledWrapped(fontStyleColored(e,s),t,r,a,i,o,n*this.inv_font_size,n*this.inv_font_size,l)}
GlovFont.prototype.drawSizedWrapped=function(e,t,r,a,i,o,n,s){return this.drawScaledWrapped(e,t,r,a,i,o,n*this.inv_font_size,n*this.inv_font_size,s)}
var A=24
function fontSetDefaultSize(e){A=e}GlovFont.prototype.draw=function(e){var t=e.style,r=e.color,a=e.alpha,i=e.x,o=e.y,n=e.z,s=e.size,l=e.w,c=e.h,_=e.align,u=e.text,d=e.indent
if(r)t=fontStyleColored(t,r)
if(void 0!==a)t=fontStyleAlpha(t,a)
d=d||0
s=s||A
n=n||Z.UI
if(_){if(_&L.HWRAP)return this.drawSizedAlignedWrapped(t,i,o,n,d,s,_&~L.HWRAP,l,c,u)
return this.drawSizedAligned(t,i,o,n,s,_,l||0,c||0,u)}else return this.drawSized(t,i,o,n,s,u)}
GlovFont.prototype.wrapLines=function(e,t,r,a,i,o,n){ne("number"!==typeof e)
this.applyStyle(e)
return this.wrapLinesScaled(t,r,a*this.inv_font_size,i,o,n)}
GlovFont.prototype.numLines=function(e,t,r,a,i){return this.wrapLines(e,t,r,a,i,0)}
GlovFont.prototype.dims=function(e,t,r,a,i){var o=0
function lineCallback(e,t,r,a){o=de(o,a)}var n=this.wrapLines(e,t,r,a,i,0,lineCallback)
return{w:o,h:n*a}}
GlovFont.prototype.infoFromChar=function(e){var t=this.char_infos[e]
if(t)return t
if(e>=9&&e<=13)return this.whitespace_character
return this.replacement_character}
GlovFont.prototype.getCharacterWidth=function(e,t,r){ne.equal(typeof r,"number")
this.applyStyle(e)
var a=this.infoFromChar(r)
var i=t*this.inv_font_size
var o=this.calcXAdvance(i)
if(a)return a.w_pad_scale*i+o
return 0}
GlovFont.prototype.getStringWidth=function(e,t,r){r=ue(r)
this.applyStyle(e)
var a=0
var i=t*this.inv_font_size
var o=this.calcXAdvance(i)
for(var n=0;n<r.length;++n){var s=r.charCodeAt(n)
var l=this.infoFromChar(s)
if(l)a+=l.w_pad_scale*i+o}return a}
GlovFont.prototype.getSpaceSize=function(e){var t=this.infoFromChar(32)
return(t?(t.w+t.xpad)*t.scale:this.font_size)*e}
function endsWord(e){return 32===e||0===e||10===e||9===e}GlovFont.prototype.wrapLinesScaled=function(e,t,r,a,i,o){a=ue(a)
ne("function"!==typeof i)
var n=a.length
var s=e-t
var l=i&L.HFIT
var c=this.calcXAdvance(r)
var _=this.getSpaceSize(r)+c
var u=0
var d=0
var f=0
var v=0
var h=-1
var p=0
var m=0
var g=0
var E=-1
var y=0
var T=0
function flushLine(){if(-1!==h&&o)o(f,T,a.slice(d,h),v)
T++
d=p
h=v=-1
m=f=t}do{var I=u<n?a.charCodeAt(u)||65533:0
if(endsWord(I))if(p!==u){var S=false
if(m+g<=e);else if(g>s&&!l){S=true
if(-1===E){if(-1!==h)flushLine()
u=d+1
g=s}else{u=E
g=y}}else if(-1!==h)flushLine()
m=v=m+g
g=0
p=h=u
E=-1
if(S)flushLine()
continue}else{p=u+1
m+=_
if(10===I)flushLine()}else{var A=this.infoFromChar(I)
if(A){var w=A.w_pad_scale*r+c
if(m+(g+=w)<=e){E=u+1
y=g}}}++u}while(u<=n)
if(-1!==h)flushLine()
return T}
GlovFont.prototype.drawScaledWrapped=function(e,i,o,t,r,a,n,s,l){var c=this
if(null===l||void 0===l)l="(null)"
ne(r>0)
this.applyStyle(e)
this.last_width=0
Se.style=e
Se.z=t
Se.xsc=n
Se.ysc=s
return this.wrapLinesScaled(r,a,n,l,0,function(e,t,r,a){Se.x=i+e
Se.y=o+c.font_size*s*t
Se.text=r
c.drawScaled()
c.last_width=de(c.last_width,a)})*this.font_size*s}
GlovFont.prototype.calcXAdvance=function(e){var t=this.font_size/32
var r=m(e*t*de(this.applied_style.outline_width-2,0))
return de(r,e*t*de(this.applied_style.glow_outer-this.applied_style.glow_xoffs-3,0))}
var Ae=u()
var we=u()
var Le=u()
var Re=u()
GlovFont.prototype.drawScaled=function(){var e=Se.style,t=Se.x,r=Se.y,a=Se.z,i=Se.xsc,o=Se.ysc,n=Se.text
profilerStart("drawScaled")
n=ue(n)
var s=t
ne(isFinite(s))
ne(isFinite(r))
ne(isFinite(a))
var l=this.font_info
r+=(l.y_offset||0)*o
var c=this.textures
if(null===n||void 0===n)n="(null)"
var _=n.length
if(0===i||0===o){profilerStop("drawScaled")
return 0}Ie.font_calls++
this.applyStyle(e)
var u=_e.defines.NOPREMUL?ve:he
var d=.5*(i+o)
var f=.5*(i*se.data[4]+o*se.data[5])
var v=this.calcXAdvance(i)
var h=this.font_size/32
var p=0
var m=this.applied_style
var g=.5/l.spread
var E=g/f
var y=Ee(Ae,1/E,-.5/E+.5,fe(0,-.5/E+.5+m.outline_width*h*f))
var T=de(0,m.outline_width*h*d)
var I=m.glow_outer*h
Le[0]=de(I*i-m.glow_xoffs*h*i,T)
Le[2]=de(I*i+m.glow_xoffs*h*i,T)
Le[1]=de(I*o-m.glow_yoffs*h*o,T)
Le[3]=de(I*o+m.glow_yoffs*h*o,T)
techParamsSet("param0",y)
var S=we
if(m.glow_outer){S[2]=1/((m.glow_outer-m.glow_inner)*g*h)
S[3]=fe(0,-(.5-m.glow_outer*g*h)/((m.glow_outer-m.glow_inner)*g*h))}else S[2]=y[3]=0
ye(Re,Le,1/d)
for(var A=0;A<4;++A)if(Re[A]>l.spread){var w=l.spread/Re[A]
Le[A]*=w
Re[A]*=w}var L=m.glow_xoffs<0?-1e-4:0
if(!L)pe()
var R=m.glow_xoffs||m.glow_yoffs
if(!R){S[0]=S[1]=0
techParamsSet("glow_params",S)
techParamsGet()}var x=i/d
var O=o/d
var b=ce(r)
var N=m.color_vec4
var C=this.shader
for(var M=0;M<_;M++){var D=n.charCodeAt(M)
if(9===D){var P=i*this.font_size*4
s=(1+((s-t)/P|0))*P+t}else{var k=this.infoFromChar(D)
if(k){var B=k.scale
var U=i*B
if(k.w){var G=o*B
var F=1/B
var W=this.tex_w
var j=this.tex_h
if(R&&B!==p){S[0]=-m.glow_xoffs*h*F/W
S[1]=-m.glow_yoffs*h*F/j
techParamsSet("glow_params",S)
if(!L){me()
pe()}techParamsGet()
p=B}var H=(k.x0-Re[0]*F)/W
var z=(k.x0+k.w+Re[2]*F)/W
var V=(k.y0-Re[1]*F)/j
var Y=(k.y0+k.h+Re[3]*F)/j
var q=k.w*U+(Le[0]+Le[2])*x
var K=k.h*G+(Le[1]+Le[3])*O
var Z=s-x*Le[0]
var X=r-O*Le[2]+k.yoffs*G
var Q=X+K
var J=Z+q
var $=a+L*M
var ee=le(Z)
var te=ce(X)
var re=le(J)
var ae=ce(Q)
var ie=ge(c,C,Te,u)
var oe=ie.data
oe[0]=ee
oe[1]=te
oe[2]=N[0]
oe[3]=N[1]
oe[4]=N[2]
oe[5]=N[3]
oe[6]=H
oe[7]=V
oe[8]=ee
oe[9]=ae
oe[10]=N[0]
oe[11]=N[1]
oe[12]=N[2]
oe[13]=N[3]
oe[14]=H
oe[15]=Y
oe[16]=re
oe[17]=ae
oe[18]=N[0]
oe[19]=N[1]
oe[20]=N[2]
oe[21]=N[3]
oe[22]=z
oe[23]=Y
oe[24]=re
oe[25]=te
oe[26]=N[0]
oe[27]=N[1]
oe[28]=N[2]
oe[29]=N[3]
oe[30]=z
oe[31]=V
ie.x=ee
ie.y=b
ie.queue($)}s+=(k.w+k.xpad)*U+v}}}if(!L)me()
profilerStop("drawScaled")
return s-t}
GlovFont.prototype.determineShader=function(){var e=this.applied_style.outline_width&&255&this.applied_style.outline_color
var t=this.applied_style.glow_outer>0&&255&this.applied_style.glow_color
if(e)if(t)this.shader=f.font_aa_outline_glow
else this.shader=f.font_aa_outline
else if(t)this.shader=f.font_aa_glow
else this.shader=f.font_aa}
GlovFont.prototype.applyStyle=function(e){if(!e)e=this.default_style
if(_e.defines.NOPREMUL){vec4ColorFromIntColor(I,e.outline_color)
techParamsSet("outline_color",I)
vec4ColorFromIntColor(I,e.glow_color)
techParamsSet("glow_color",I)}else{vec4ColorFromIntColorPreMultiplied(I,e.outline_color)
techParamsSet("outline_color",I)
vec4ColorFromIntColorPreMultiplied(I,e.glow_color)
techParamsSet("glow_color",I)}this.applied_style.outline_width=e.outline_width
this.applied_style.outline_color=e.outline_color
this.applied_style.glow_xoffs=e.glow_xoffs
this.applied_style.glow_yoffs=e.glow_yoffs
this.applied_style.glow_inner=e.glow_inner
this.applied_style.glow_outer=e.glow_outer
this.applied_style.glow_color=e.glow_color
this.applied_style.color=e.color
if(_e.defines.NOPREMUL)d(this.applied_style.color_vec4,e.color_vec4)
else{var t=this.applied_style.color_vec4[3]=e.color_vec4[3]
_(this.applied_style.color_vec4,e.color_vec4,t)}this.determineShader()}
GlovFont.prototype.ALIGN=L
GlovFont.prototype.style=fontStyle
GlovFont.prototype.styleAlpha=fontStyleAlpha
GlovFont.prototype.styleColored=fontStyleColored
function fontShadersInit(){if(f.font_aa)return
f.font_aa=o.create("shaders/font_aa.fp")
f.font_aa_glow=o.create("shaders/font_aa_glow.fp")
f.font_aa_outline=o.create("shaders/font_aa_outline.fp")
f.font_aa_outline_glow=o.create("shaders/font_aa_outline_glow.fp")
o.prelink(n.sprite_vshader,f.font_aa)
o.prelink(n.sprite_vshader,f.font_aa_glow)
o.prelink(n.sprite_vshader,f.font_aa_outline)
o.prelink(n.sprite_vshader,f.font_aa_outline_glow)}function fontCreate(e,t){fontShadersInit()
return new GlovFont(e,t)}function fontTick(){E=0
p.length=0
T=0
techParamsAlloc()}},{"../common/util.js":330,"../common/vmath.js":332,"./camera2d.js":241,"./engine.js":250,"./geom.js":263,"./localization.js":275,"./shaders.js":293,"./sprites.js":302,"./textures.js":304,assert:void 0}],261:[function(e,t,r){"use strict"
r.framebufferSkipRelease=framebufferSkipRelease
r.temporaryTextureClaim=temporaryTextureClaim
r.framebufferCapture=framebufferCapture
r.framebufferStart=framebufferStart
r.framebufferEnd=framebufferEnd
r.framebufferTopOfFrame=framebufferTopOfFrame
r.framebufferEndOfFrame=framebufferEndOfFrame
r.framebufferUpdateCanvasForCapture=framebufferUpdateCanvasForCapture
var u=e("assert")
var a=e("./browser.js").is_ios
var i=e("./cmds.js").cmd_parse
var o=e("./effects.js").applyCopy
var d=e("./engine.js")
var n=d.renderWidth,s=d.renderHeight
var l=e("./perf.js")
var f=e("./settings.js")
var c=e("./textures.js")
var _=0
var v=0
var h={}
var p={}
var m={}
var g=false
function resetFBOs(){g=true}var E=false
function framebufferSkipRelease(){E=true}var y=0
function getTemporaryTexture(e,t,r){var a=e+"_"+t
var i=r&&f.use_fbos
if(i)a+="_fbo"
var o=h[a]
if(!o)o=h[a]={list:[],idx:0}
if(o.idx>=o.list.length){var n=c.createForCapture("temp_"+a+"_"+ ++y)
if(i)n.allocFBO(e,t)
o.list.push(n)}return o.list[o.idx++]}function bindTemporaryDepthbuffer(e,t){var r=e+"_"+t
var a=p[r]
if(!a)a=p[r]={list:[],idx:0}
if(a.idx>=a.list.length){var i=gl.createRenderbuffer()
gl.bindRenderbuffer(gl.RENDERBUFFER,i)
var o
if(f.fbo_depth16){gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_COMPONENT16,e,t)
o=gl.DEPTH_ATTACHMENT}else{gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_STENCIL,e,t)
o=gl.DEPTH_STENCIL_ATTACHMENT}gl.bindRenderbuffer(gl.RENDERBUFFER,null)
a.list.push({depth_buffer:i,attachment:o})}var n=a.list[a.idx++],s=n.depth_buffer,l=n.attachment
gl.framebufferRenderbuffer(gl.FRAMEBUFFER,l,gl.RENDERBUFFER,s)}function bindTemporaryDepthbufferTexture(e,t){var r=e+"_"+t
var a=m[r]
if(!a)a=m[r]={list:[],idx:0}
if(a.idx>=a.list.length){var i=c.createForDepthCapture("temp_"+r+"_"+ ++y,f.fbo_depth16?c.format.DEPTH16:c.format.DEPTH24)
i.allocDepth(e,t)
var o=f.fbo_depth16?gl.DEPTH_ATTACHMENT:gl.DEPTH_STENCIL_ATTACHMENT
a.list.push({tex:i,attachment:o})}var n=a.list[a.idx++],s=n.tex,l=n.attachment
gl.framebufferTexture2D(gl.FRAMEBUFFER,l,gl.TEXTURE_2D,s.handle,0)
return s}function temporaryTextureClaim(e){for(var t in h){var r=h[t]
var a=r.list.indexOf(e)
if(-1!==a){r.list.splice(a,1)
if(r.idx>a)--r.idx
return}}u(false)}function framebufferCaptureStart(e,t,r,a){u.equal(d.viewport[0],0)
u.equal(d.viewport[1],0)
if(!t){t=n()
r=s()}if(!e)e=getTemporaryTexture(t,r,a)
e.captureStart(t,r)
return e}function framebufferCapture(e,t,r,a,i){(e=framebufferCaptureStart(e,t,r,false)).captureEnd(a,i)
return e}var T
var I
function framebufferStart(e){u(!T)
u(!I)
var t=e.width,r=e.height,a=e.viewport,i=e.final,o=e.clear,n=e.need_depth,s=e.clear_all,l=e.clear_color,c=e.force_tex;++v
I=null
if(c){u(a);(T=c).captureStart()}else if(!i){T=framebufferCaptureStart(null,t,r,true)
if(f.use_fbos)if(n)if("texture"===n)I=bindTemporaryDepthbufferTexture(t,r)
else bindTemporaryDepthbuffer(t,r)}if(l)gl.clearColor(l[0],l[1],l[2],l[3])
if(o&&s){gl.disable(gl.SCISSOR_TEST)
gl.clear(gl.COLOR_BUFFER_BIT|(n?gl.DEPTH_BUFFER_BIT:0))}var _
if(a){d.setViewport(a)
_=a[0]||a[1]||a[2]!==d.width||a[3]!==d.height
if(s)_=false}else{d.setViewport([0,0,t,r])
_=t!==d.width}if(_){gl.enable(gl.SCISSOR_TEST)
if(a)gl.scissor(a[0],a[1],a[2],a[3])
else gl.scissor(0,0,t,r)}else gl.disable(gl.SCISSOR_TEST)
if(o&&!s)gl.clear(gl.COLOR_BUFFER_BIT|(n?gl.DEPTH_BUFFER_BIT:0))}function framebufferEnd(e){u(T)
var t=e=e||{},r=t.filter_linear,a=t.wrap,i=t.need_depth
u.equal(Boolean(I),"texture"===i)
T.captureEnd(r,a)
var o
if(I)o=[T,I]
else o=T
I=T=null
return o}function framebufferTopOfFrame(){I=T=null}function framebufferEndOfFrame(){u(!T)
_=v
v=0
E=E&&!g
for(var e in h){var t=h[e]
if(g)t.idx=0
if(!E)while(t.list.length>t.idx)t.list.pop().destroy()
if(!t.list.length)delete h[e]
else t.idx=0}for(var r in p){var a=p[r]
if(g)a.idx=0
if(!E)while(a.list.length>a.idx){var i=a.list.pop().depth_buffer
gl.deleteRenderbuffer(i)}if(!a.list.length)delete p[r]
else a.idx=0}for(var o in m){var n=m[o]
if(g)n.idx=0
if(!E)while(n.list.length>n.idx)n.list.pop().tex.destroy()
if(!n.list.length)delete m[o]
else n.idx=0}E=g=false}function framebufferUpdateCanvasForCapture(){if(T&&f.use_fbos){var e=T
var t=d.viewport.slice(0)
framebufferEnd()
o({source:e,final:true,viewport:t})
framebufferStart({force_tex:e,viewport:t})
return e}else return{width:d.viewport[2],height:d.viewport[3]}}f.register({show_passes:{label:"Show Postprocessing Passes",default_value:0,type:i.TYPE_INT,range:[0,1]},use_fbos:{label:"Use Framebuffer Objects for postprocessing",default_value:a?1:0,type:i.TYPE_INT,range:[0,1],ver:1},fbo_depth16:{label:"Use 16-bit depth buffers for offscreen rendering",default_value:0,type:i.TYPE_INT,range:[0,1],on_change:resetFBOs},fbo_rgba:{label:"Use RGBA color buffers for offscreen rendering",default_value:0,type:i.TYPE_INT,range:[0,1],on_change:resetFBOs}})
g=false
l.addMetric({name:"passes",show_stat:"show_passes",labels:{"passes: ":function passes(){return _.toString()}}})},{"./browser.js":239,"./cmds.js":244,"./effects.js":249,"./engine.js":250,"./perf.js":281,"./settings.js":291,"./textures.js":304,assert:void 0}],262:[function(e,t,r){"use strict"
r.fscreenEnter=fscreenEnter
r.fscreenExit=fscreenExit
r.fscreenAvailable=fscreenAvailable
r.fscreenDisable=fscreenDisable
r.fscreenActive=fscreenActive
var a=e("../common/util.js").eatPossiblePromise
var i={fullscreenEnabled:0,fullscreenElement:1,requestFullscreen:2,exitFullscreen:3}
var o=["fullscreenEnabled","fullscreenElement","requestFullscreen","exitFullscreen"]
var n=["webkitFullscreenEnabled","webkitFullscreenElement","webkitRequestFullscreen","webkitExitFullscreen"]
var s=["mozFullScreenEnabled","mozFullScreenElement","mozRequestFullScreen","mozCancelFullScreen"]
var l=["msFullscreenEnabled","msFullscreenElement","msRequestFullscreen","msExitFullscreen"]
var c=o[0]in document&&o||n[0]in document&&n||s[0]in document&&s||l[0]in document&&l||[]
function fscreenEnter(){var e=document.documentElement
a(e[c[i.requestFullscreen]]())}function fscreenExit(){a(document[c[i.exitFullscreen]]())}var _=false
function fscreenAvailable(){return!_&&Boolean(document[c[i.fullscreenEnabled]])}function fscreenDisable(){_=true}function fscreenActive(){return document[c[i.fullscreenElement]]}},{"../common/util.js":330}],263:[function(e,t,r){"use strict"
r.createIndices=createIndices
r.geomResetState=geomResetState
r.create=create
r.createQuads=createQuads
r.startup=startup
r.stats=r.QUADS=r.TRIANGLE_FAN=r.TRIANGLES=void 0
var u=e("assert")
var a=e("./cmds.js").cmd_parse
var n=e("./engine.js")
var i=e("./perf.js")
var o=e("./settings.js")
var s=e("./shaders.js").MAX_SEMANTIC
var l=Math.ceil,c=Math.max,_=Math.min
var d=4
r.TRIANGLES=d
var f=6
r.TRIANGLE_FAN=f
var v=7
r.QUADS=v
var h=65532
o.register({show_render_stats:{default_value:0,type:a.TYPE_INT,range:[0,1]}})
var p={draw_calls:0,draw_calls_geom:0,draw_calls_sprite:0,draw_calls_dyn:0,tris:0,verts:0,sprites:0,dyn:0,sprite_sort_elems:0,sprite_sort_cmps:0,font_calls:0,font_params:0}
r.stats=p
var m={}
var g={}
var E=function _loop(e){g[e+": "]=function(){return String(m[e])}}
for(var y in p)E(y)
i.addMetric({name:"render_stats",show_stat:"show_render_stats",show_all:true,labels:g})
var T={5120:1,5121:1,5122:2,5123:2,5126:4}
var I
var S=null
var A=null
var w
var L=0
function deleteBuffer(e){if(!e)return
if(S===e){gl.bindBuffer(gl.ARRAY_BUFFER,null)
S=null}if(A===e){gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,null)
A=null}gl.deleteBuffer(e)}var R=0
function enableVertexAttribArray(e){if(e===R)return
var t=R&~e
var r=~R&e
R=e
if(t){var a=0
do{if(1&t)gl.disableVertexAttribArray(a)
a++
t>>=1}while(t)}if(r){var i=0
do{if(1&r)gl.enableVertexAttribArray(i)
i++
r>>=1}while(r)}}function getQuadIndexBuf(e){u(e<=h/4)
if(6*e>L){if(!w)w=gl.createBuffer()
else n.perf_state.gpu_mem.geom-=2*L
L=_(c(l(1.5*L),6*e),6*h/4)
if(A!==w){gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,w)
A=w}var t=new Uint16Array(L)
var r=0
for(var a=0;a<L;){t[a++]=r+1
t[a++]=r+3
t[a++]=r++
t[a++]=r++
t[a++]=r++
t[a++]=r++}gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,t,gl.STATIC_DRAW)
n.perf_state.gpu_mem.geom+=2*L}return w}function createIndices(e){var t={ibo:gl.createBuffer(),ibo_size:e.length}
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,t.ibo)
A=t.ibo
gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,e,gl.STATIC_DRAW)
n.perf_state.gpu_mem.geom+=2*e.length
return t}function formatInfo(e){if(!e.info){var t=0
var r=0
var a=0
var i=0
for(var o=0;o<e.length;++o){var n=e[o]
var s=n[0]
var l=n[1]
var c=n[2]
a|=1<<s
var _=T[l]
u(_)
u(!i||_===i)
i=_
n[3]=n[3]||false
t+=c*(n[4]=_)
r+=c}e.info={stride:t,elem_count:r,used_attribs:a,common_byte_size:i}}return e.info}function Geom(e,t,r,a){this.mode=a||d
this.format=e
var i=this.format_info=formatInfo(e)
this.stride=i.stride
this.used_attribs=i.used_attribs
this.vert_count=t.length/this.format_info.elem_count
this.vert_gpu_mem=t.length*this.format_info.common_byte_size
if(t.length){this.vbo=gl.createBuffer()
gl.bindBuffer(gl.ARRAY_BUFFER,this.vbo)
S=this.vbo
gl.bufferData(gl.ARRAY_BUFFER,t,gl.STATIC_DRAW)
n.perf_state.gpu_mem.geom+=this.vert_gpu_mem}this.orig_mode=a
if(r)if(r.ibo){this.ibo=r.ibo
this.ibo_owned=false
this.ibo_size=r.ibo_size}else if(r.length){this.ibo=gl.createBuffer()
this.ibo_owned=true
this.ibo_size=r.length
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.ibo)
A=this.ibo
gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,r,gl.STATIC_DRAW)
n.perf_state.gpu_mem.geom+=2*r.length}else{this.ibo=null
this.ibo_owned=true
this.ibo_size=0}else if(a===v){u.equal(this.vert_count%4,0)
var o=this.vert_count/4
this.ibo=getQuadIndexBuf(o)
this.ibo_owned=false
this.ibo_size=6*o
this.mode=d}else if(a===f)this.mode=f
else{this.ibo=null
this.ibo_owned=false}this.updateTriCount()}function trianglesFromMode(e,t){if(e===d)return t/3
else if(e===f)return t-2
else{u(!t)
return 0}}Geom.prototype.updateTriCount=function(){var e=this.ibo?this.ibo_size:this.vert_count
this.tri_count=trianglesFromMode(this.mode,e)}
Geom.prototype.updateIndex=function(e,t){u.equal(this.ibo_owned,true)
if(t>this.ibo_size){if(I===this)I=null
n.perf_state.gpu_mem.geom-=2*this.ibo_size
deleteBuffer(this.ibo)
this.ibo_size=e.length
this.ibo=gl.createBuffer()
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.ibo)
A=this.ibo
gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,e,gl.DYNAMIC_DRAW)
n.perf_state.gpu_mem.geom+=2*e.length}else{if(A!==this.ibo){gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.ibo)
A=this.ibo}gl.bufferSubData(gl.ELEMENT_ARRAY_BUFFER,0,e.subarray(0,t))}this.updateTriCount()}
Geom.prototype.updateSub=function(e,t){if(S!==this.vbo){gl.bindBuffer(gl.ARRAY_BUFFER,this.vbo)
S=this.vbo}gl.bufferSubData(gl.ARRAY_BUFFER,e,t)}
Geom.prototype.update=function(e,t){if(t>this.vert_count){if(I===this)I=null
n.perf_state.gpu_mem.geom-=this.vert_gpu_mem
deleteBuffer(this.vbo)
this.vert_count=e.length/this.format_info.elem_count
this.vert_gpu_mem=e.length*this.format_info.common_byte_size
this.vbo=gl.createBuffer()
gl.bindBuffer(gl.ARRAY_BUFFER,this.vbo)
S=this.vbo
gl.bufferData(gl.ARRAY_BUFFER,e,gl.DYNAMIC_DRAW)
n.perf_state.gpu_mem.geom+=this.vert_gpu_mem}else{if(S!==this.vbo){gl.bindBuffer(gl.ARRAY_BUFFER,this.vbo)
S=this.vbo}gl.bufferSubData(gl.ARRAY_BUFFER,0,e.subarray(0,t*this.format_info.elem_count))}if(this.orig_mode===v){u.equal(this.ibo_owned,false)
var r=t/4
this.ibo=getQuadIndexBuf(r)
this.ibo_size=6*r}this.updateTriCount()}
Geom.prototype.dispose=function(){if(this.ibo_owned)deleteBuffer(this.ibo)
this.ibo=null
deleteBuffer(this.vbo)
this.vbo=null
n.perf_state.gpu_mem.geom-=this.vert_gpu_mem
this.vert_gpu_mem=0}
var x=function(){var e=[]
for(var t=0;t<16;++t)e.push({vbo:null,offset:0})
return e}()
function geomResetState(){A=I=null
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,null)
S=null
gl.bindBuffer(gl.ARRAY_BUFFER,null)
for(var e=0;e<s;++e)gl.disableVertexAttribArray(e)
for(var t=R=0;t<x.length;++t)x[t].vbo=null
p.draw_calls=p.draw_calls_geom+p.draw_calls_sprite
for(var r in p){m[r]=p[r]
p[r]=0}}Geom.prototype.bind=function(){if(I!==this){var e=(I=this).vbo
var t=0
for(var r=0;r<this.format.length;++r){var a=this.format[r]
var i=a[2]
var o=a[4]
var n=a[0]
if(x[n].vbo===e);else{if(S!==e){gl.bindBuffer(gl.ARRAY_BUFFER,e)
S=e}var s=a[1]
var l=a[3]
gl.vertexAttribPointer(n,i,s,l,this.stride,t)
x[n].vbo=S}t+=i*o}enableVertexAttribArray(this.used_attribs)}if(this.ibo&&A!==this.ibo){gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.ibo)
A=this.ibo}}
Geom.prototype.draw=function(){this.bind();++p.draw_calls_geom
p.tris+=this.tri_count
p.verts+=this.vert_count
if(this.ibo)gl.drawElements(this.mode,this.ibo_size,gl.UNSIGNED_SHORT,0)
else gl.drawArrays(this.mode,0,this.vert_count)}
Geom.prototype.drawSub=function(e,t){u.equal(this.mode,d)
this.bind();++p.draw_calls_geom
if(this.ibo){p.tris+=t
p.verts+=2*t
gl.drawElements(this.mode,3*t,gl.UNSIGNED_SHORT,2*e)}else gl.drawArrays(this.mode,e,3*t)}
function GeomMultiQuads(e,t){var r=formatInfo(e).elem_count
var a=t.length/r
this.geoms=[]
for(var i=0;i<a;i+=h){var o=_(a-i,h)
var n=new Uint8Array(t.buffer,i*r,o*r)
this.geoms.push(new Geom(e,n,null,v))}}GeomMultiQuads.prototype.draw=function(){for(var e=0;e<this.geoms.length;++e)this.geoms[e].draw()}
GeomMultiQuads.prototype.dispose=function(){for(var e=0;e<this.geoms.length;++e)this.geoms[e].dispose()
this.geoms=null}
function create(e,t,r,a){return new Geom(e,t,r,a)}function createQuads(e,t,r){var a=formatInfo(e)
u(r||t instanceof Uint8Array)
if(t.length/a.elem_count>h)return new GeomMultiQuads(e,t)
return new Geom(e,t,null,v)}function startup(){}},{"./cmds.js":244,"./engine.js":250,"./perf.js":281,"./settings.js":291,"./shaders.js":293,assert:void 0}],264:[function(e,t,r){"use strict"
r.decode=decode
var o=new Array(128)
var n=String.fromCodePoint||String.fromCharCode
var s=[]
function decode(e){var t
var r
var a=e.length
for(var i=s.length=0;i<a;){if((r=e[i++])<=127)t=r
else if(r<=223)t=(31&r)<<6|63&e[i++]
else if(r<=239)t=(15&r)<<12|(63&e[i++])<<6|63&e[i++]
else if(String.fromCodePoint)t=(7&r)<<18|(63&e[i++])<<12|(63&e[i++])<<6|63&e[i++]
else{t=63
i+=3}s.push(o[t]||(o[t]=n(t)))}return s.join("")}},{}],265:[function(e,t,r){"use strict"
r.getAccessorTypeFromSize=getAccessorTypeFromSize
r.ATTRIBUTE_COMPONENT_TYPE_TO_ARRAY=r.ATTRIBUTE_COMPONENT_TYPE_TO_BYTE_SIZE=r.ATTRIBUTE_TYPE_TO_COMPONENTS=void 0
var a=["SCALAR","VEC2","VEC3","VEC4"]
function getAccessorTypeFromSize(e){return a[e-1]||a[0]}var i={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16}
r.ATTRIBUTE_TYPE_TO_COMPONENTS=i
var o={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4}
r.ATTRIBUTE_COMPONENT_TYPE_TO_BYTE_SIZE=o
var n={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array}
r.ATTRIBUTE_COMPONENT_TYPE_TO_ARRAY=n},{}],266:[function(e,t,r){"use strict"
var d=e("assert")
var a=e("./unpack-glb-buffers.js").unpackGLBBuffers
var i=e("./unpack-binary-json.js").unpackBinaryJson
function padTo4Bytes(e){return e+3&-4}var f=e("./decode-utf8.js")
var o=e("./gltf-type-utils.js"),l=o.ATTRIBUTE_TYPE_TO_COMPONENTS,c=o.ATTRIBUTE_COMPONENT_TYPE_TO_BYTE_SIZE,_=o.ATTRIBUTE_COMPONENT_TYPE_TO_ARRAY
var v=1735152710
var h=12
var p=8
var m=1313821514
var g=5130562
var E=true
var y=false
function GLBParser(){this.binaryByteOffset=null
this.packedJson=null
this.json=null}function parseBinary(e){var t=new DataView(e.glbArrayBuffer)
var r=t.getUint32(0,y)
var a=t.getUint32(4,E)
var i=t.getUint32(8,E)
if(!(r===v))console.warn("Invalid GLB magic string")
d(2===a,"Invalid GLB version "+a+". Only .glb v2 supported")
d(i>20)
var o=t.getUint32(12,E)
var n=t.getUint32(16,E)
d(n===m||0===n,"JSON chunk format "+n)
var s=h+p
var l=new Uint8Array(e.glbArrayBuffer,s,o)
var c=f.decode(l)
e.json=JSON.parse(c)
var _=s+padTo4Bytes(o)
e.binaryByteOffset=_+p
var u=t.getUint32(_+4,E)
d(u===g||1===u,"BIN chunk format "+u)
return{arrayBuffer:e.glbArrayBuffer,binaryByteOffset:e.binaryByteOffset,json:e.json}}function parseInternal(e){var t=parseBinary(e)
e.packedJson=t.json
e.unpackedBuffers=a(e.glbArrayBuffer,e.json,e.binaryByteOffset)
e.json=i(e.json,e.unpackedBuffers)}GLBParser.prototype.parseSync=function(e){this.glbArrayBuffer=e
if(null===this.json&&null===this.binaryByteOffset)parseInternal(this)
return this}
GLBParser.prototype.parse=function(e){return this.parseSync(e)}
GLBParser.prototype.getApplicationData=function(e){return this.json[e]}
GLBParser.prototype.getJSON=function(){return this.json}
GLBParser.prototype.getArrayBuffer=function(){return this.glbArrayBuffer}
GLBParser.prototype.getBinaryByteOffset=function(){return this.binaryByteOffset}
GLBParser.prototype.getBufferView=function(e){var t=(e.byteOffset||0)+this.binaryByteOffset
return new Uint8Array(this.glbArrayBuffer,t,e.byteLength)}
GLBParser.prototype.getBuffer=function(e){var t=_[e.componentType]
var r=l[e.type]
var a=c[e.componentType]
var i=e.count*r
var o=e.count*r*a
var n=this.json.bufferViews[e.bufferView]
d(o>=0&&e.byteOffset+o<=n.byteLength)
var s=n.byteOffset+this.binaryByteOffset+e.byteOffset
return new t(this.glbArrayBuffer,s,i)}
GLBParser.prototype.getImageData=function(e){return{typedArray:this.getBufferView(e.bufferView),mimeType:e.mimeType||"image/jpeg"}}
GLBParser.prototype.getImage=function(e){var t=this.getBufferView(e.bufferView)
var r=e.mimeType||"image/jpeg"
var a=new Blob([t],{type:r})
var i=(window.URL||window.webkitURL).createObjectURL(a)
var o=new Image
o.src=i
return o};(t.exports=GLBParser).parse=function(e){return(new GLBParser).parse(e)}},{"./decode-utf8.js":264,"./gltf-type-utils.js":265,"./unpack-binary-json.js":267,"./unpack-glb-buffers.js":268,assert:void 0}],267:[function(e,t,r){"use strict"
r.unpackBinaryJson=unpackBinaryJson
function parseJSONPointer(e){if("string"===typeof e){if(0===e.indexOf("##/"))return e.slice(1)
var t=e.match(/#\/([a-z]+)\/([0-9]+)/)
if(t){var r=parseInt(t[2],10)
return[t[1],r]}if(t=e.match(/\$\$\$([0-9]+)/))return["accessors",parseInt(t[1],10)]}return null}function decodeJSONPointer(e,t){var r=parseJSONPointer(e)
if(r){var a=r[0]
var i=r[1]
var o=t[a]&&t[a][i]
if(o)return o
console.error("Invalid JSON pointer "+e+": #/"+a+"/"+i)}return null}function unpackJsonArraysRecursive(e,t,r,a){if(void 0===a)a={}
var i=e
var o=decodeJSONPointer(i,r)
if(o)return o
if(Array.isArray(i))return i.map(function(e){return unpackJsonArraysRecursive(e,t,r,a)})
if(null!==i&&"object"===typeof i){var n={}
for(var s in i)n[s]=unpackJsonArraysRecursive(i[s],t,r,a)
return n}return i}function unpackBinaryJson(e,t,r){if(void 0===r)r={}
return unpackJsonArraysRecursive(e,e,t,r)}},{}],268:[function(e,t,r){"use strict"
r.unpackGLBBuffers=unpackGLBBuffers
var d=e("assert")
var a=e("./gltf-type-utils.js"),s=a.ATTRIBUTE_TYPE_TO_COMPONENTS,l=a.ATTRIBUTE_COMPONENT_TYPE_TO_BYTE_SIZE,c=a.ATTRIBUTE_COMPONENT_TYPE_TO_ARRAY
function getArrayBufferAtOffset(e,t){var r=e.byteLength-t
var a=new ArrayBuffer(r)
var i=new Uint8Array(e)
var o=new Uint8Array(a)
for(var n=0;n<r;n++)o[n]=i[t+n]
return a}function getArrayTypeAndLength(e,t){var r=c[e.componentType]
var a=s[e.type]
var i=l[e.componentType]
var o=e.count*a
var n=e.count*a*i
d(n>=0&&n<=t.byteLength)
return{ArrayType:r,length:o,byteLength:n}}function unpackAccessors(e,t,r){var a=r.accessors||[]
var i=[]
for(var o=0;o<a.length;++o){var n=a[o]
d(n)
var s=t[n.bufferView]
if(s){var l=getArrayTypeAndLength(n,s),c=l.ArrayType,_=l.length
var u=new c(e,s.byteOffset,_)
u.accessor=n
i.push(u)}}return i}function unpackImages(e,t,r){var a=r.images||[]
var i=[]
for(var o=0;o<a.length;++o){var n=a[o]
d(n)
if(void 0===n.bufferView){i.push(null)
continue}var s=t[n.bufferView]
d(s)
var l=new Uint8Array(e,s.byteOffset,s.byteLength)
l.imate=n
i.push(l)}return i}function unpackGLBBuffers(e,t,r){if(r)e=getArrayBufferAtOffset(e,r)
var a=t.bufferViews||[]
for(var i=0;i<a.length;++i){var o=a[i]
d(o.byteLength>=0)}return{accessors:unpackAccessors(e,a,t),images:unpackImages(e,a,t)}}},{"./gltf-type-utils.js":265,assert:void 0}],269:[function(e,t,r){"use strict"
var l=Math.max,c=Math.min,_=Math.floor
r.rgbToHSV=function rgbToHSV(e,t){var r=t[0]
var a=t[1]
var i=t[2]
var o=c(r,a,i)
var n=l(r,a,i)
var s=(e[2]=n)-o
if(0!==s)e[1]=s/n
else{e[1]=0
e[0]=0
return}if(r===n)e[0]=(a-i)/s
else if(a===n)e[0]=2+(i-r)/s
else e[0]=4+(r-a)/s
e[0]*=60
if(e[0]<0)e[0]+=360}
r.hsvToRGB=function hsvToRGB(e,t,r,a){if(0===r){e[0]=e[1]=e[2]=a
return e}if((t/=60)>=6)t-=6
var i=_(t)
var o=t-i
var n=a*(1-r)
var s=a*(1-r*o)
var l=a*(1-r*(1-o))
switch(i){case 0:e[0]=a
e[1]=l
e[2]=n
break
case 1:e[0]=s
e[1]=a
e[2]=n
break
case 2:e[0]=n
e[1]=a
e[2]=l
break
case 3:e[0]=n
e[1]=s
e[2]=a
break
case 4:e[0]=l
e[1]=n
e[2]=a
break
default:e[0]=a
e[1]=n
e[2]=s}return e}},{}],270:[function(e,t,r){"use strict"
r.topOfFrame=topOfFrame
r.on=on
r.handle=handle
var c=e("assert")
var _={}
function topOfFrame(){_={}}function on(e,t,r){var a=_[e]=_[e]||[]
if("number"===typeof t)a[t]=r
else a.push([t,r])}function handle(e,t){var r=_[e]
if(!r)return
switch(e){case"keydown":case"keyup":if(r[t.keyCode])r[t.keyCode](e,t)
break
case"mouseup":case"mousedown":var a=t.pageX
var i=t.pageY
var o=t.button
for(var n=0;n<r.length;++n){var s=r[n]
var l=s[0]
if(a>=l.x&&a<l.x+l.w&&i>=l.y&&i<l.y+l.h&&(l.button<0||l.button===o)){s[1](e,t)
break}}break
default:c(false)}}},{assert:void 0}],271:[function(e,t,m){"use strict"
m.inputTouchMode=inputTouchMode
m.inputEatenMouse=inputEatenMouse
m.pointerLocked=pointerLocked
m.pointerLockEnter=pointerLockEnter
m.pointerLockJustEntered=pointerLockJustEntered
m.pointerLockExit=pointerLockExit
m.inputLastTime=inputLastTime
m.debugGetMouseMoveX=debugGetMouseMoveX
m.handleTouches=handleTouches
m.startup=startup
m.fakeTouchEvent=fakeTouchEvent
m.tickInput=tickInput
m.endFrame=endFrame
m.tickInputInactive=tickInputInactive
m.eatAllInput=eatAllInput
m.eatAllKeyboardInput=eatAllKeyboardInput
m.mousePos=mousePos
m.mouseDomPos=mouseDomPos
m.mouseMoved=mouseMoved
m.mouseButtonHadEdge=mouseButtonHadEdge
m.mouseButtonHadUpEdge=mouseButtonHadUpEdge
m.mouseWheel=mouseWheel
m.mouseOverCaptured=mouseOverCaptured
m.mouseOver=mouseOver
m.mouseDownAnywhere=mouseDownAnywhere
m.mouseDownMidClick=mouseDownMidClick
m.mouseDownOverBounds=mouseDownOverBounds
m.mousePosIsTouch=mousePosIsTouch
m.numTouches=numTouches
m.keyDown=keyDown
m.keyDownEdge=keyDownEdge
m.keyUpEdge=keyUpEdge
m.padGetAxes=padGetAxes
m.padButtonDown=padButtonDown
m.padButtonDownEdge=padButtonDownEdge
m.padButtonUpEdge=padButtonUpEdge
m.mouseUpEdge=mouseUpEdge
m.mouseDownEdge=mouseDownEdge
m.mouseConsumeClicks=mouseConsumeClicks
m.drag=drag
m.longPress=longPress
m.dragDrop=dragDrop
m.dragOver=dragOver
m.pad_mode=m.touch_mode=m.PAD=m.KEYS=m.inputClick=m.click=void 0
var r=e("./input_constants")
var c=e("assert")
var s=0
var g=0
var E=1
var l=2
var y=true
var a=true
var i=false
var o=mouseUpEdge
m.click=o
var n=mouseUpEdge
m.inputClick=n;(0,e("../common/util.js").deprecate)(m,"mouseDown","mouseDownAnywhere, mouseDownMidClick, mouseDownOverBounds")
var _=e("./input_constants")
var u=_.ANY
var d=_.POINTERLOCK
for(var f in r)if("default"!==f)m[f]=r[f]
var v={BACKSPACE:8,TAB:9,ENTER:13,RETURN:13,SHIFT:16,CTRL:17,ALT:18,ESC:27,ESCAPE:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INS:45,DEL:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,NUMPAD0:96,NUMPAD1:97,NUMPAD2:98,NUMPAD3:99,NUMPAD4:100,NUMPAD5:101,NUMPAD6:102,NUMPAD7:103,NUMPAD8:104,NUMPAD9:105,NUMPAD_MULTIPLY:106,NUMPAD_ADD:107,NUMPAD_SUBTRACT:109,NUMPAD_DECIMAL_POINT:110,NUMPAD_DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,EQUALS:187,COMMA:188,MINUS:189,PERIOD:190,SLASH:191,TILDE:192}
m.KEYS=v
if("function"===typeof Proxy)m.KEYS=v=new Proxy(v,{get:function get(e,t){var r=e[t]
c(r)
return r}})
var h={A:0,SELECT:0,B:1,CANCEL:1,X:2,Y:3,LB:4,LEFT_BUMPER:4,RB:5,RIGHT_BUMPER:5,LT:6,LEFT_TRIGGER:6,RT:7,RIGHT_TRIGGER:7,BACK:8,START:9,LEFT_STICK:10,RIGHT_STICK:11,UP:12,DOWN:13,LEFT:14,RIGHT:15,ANALOG_UP:20,ANALOG_LEFT:21,ANALOG_DOWN:22,ANALOG_RIGHT:23,LSTICK_UP:20,LSTICK_LEFT:21,LSTICK_DOWN:22,LSTICK_RIGHT:23,RSTICK_UP:24,RSTICK_LEFT:25,RSTICK_DOWN:26,RSTICK_RIGHT:27}
m.PAD=h
var p=e("./browser.js"),T=p.is_firefox,I=p.is_mac_osx
var S=e("./camera2d.js")
var A=e("./cmds.js").cmd_parse
var w=e("./engine.js")
var L=e("./in_event.js")
var R=e("./local_storage.js")
var x=Math.abs,O=Math.max,b=Math.min,N=Math.sqrt
var C=e("./pointer_lock.js")
var M=e("./settings.js")
var D=e("./sound.js").soundResume
var P=e("./spot.js").spotMouseoverHook
var k=e("../common/util.js").empty
var B=e("../common/vmath.js"),U=B.vec2,G=B.v2add,F=B.v2copy,W=B.v2lengthSq,j=B.v2set,H=B.v2scale,z=B.v2sub
var V
var Y
var q={}
var K=[]
var Z=[]
var X=U()
var Q=U()
var J=false
var $=false
var ee=[]
var te=[]
var re=0
var ae=2
var ie=false
var oe=false
var ne={}
var se=true
var le=R.getJSON("touch_mode",false)
var ce=!(m.touch_mode=le)&&R.getJSON("pad_mode",false)
m.pad_mode=ce
A.registerValue("mouse_log",{type:A.TYPE_INT,range:[0,1],get:function get(){return i},set:function set(e){return i=e}})
function inputTouchMode(){return le}function inputEatenMouse(){return oe}function eventTimestamp(e){if(e&&e.timeStamp){if(e.timeStamp<1e12!==w.hrtime<1e12)return w.hrtime
return e.timeStamp}return w.hrtime}function TouchData(e,t,r,a){this.delta=U()
this.total=0
this.cur_pos=e.slice(0)
this.start_pos=e.slice(0)
this.touch=t
this.button=r
this.start_time=Date.now()
this.dispatched=false
this.dispatched_drag=false
this.dispatched_drag_over=false
this.was_double_click=false
this.up_edge=0
this.down_edge=0
this.state=E
this.down_time=0
this.origin_time=eventTimestamp(a)}TouchData.prototype.down=function(e,t){if(t)this.down_edge++
this.state=E
this.origin_time=eventTimestamp(e)}
var _e=.01
function timeDelta(e,t){var r=eventTimestamp(e)
return O(r-t,_e)}function KeyData(){this.down_edge=0
this.origin_time=0
this.down_time=0
this.up_edge=0
this.state=g}KeyData.prototype.keyUp=function(e){++this.up_edge
this.down_time+=timeDelta(e,this.origin_time)
this.state=g}
function setMouseToMid(){j(X,.5*w.width/S.domToCanvasRatio(),.5*w.height/S.domToCanvasRatio())}function pointerLocked(){return C.isLocked()}var ue="m"+d
var de=-1
function pointerLockEnter(e){C.enter(e)}function onPointerLockEnter(){if(le)return
de=w.frame_index
var e=ne[ue]
setMouseToMid()
if(e){F(e.start_pos,X)
e.state=E
e.origin_time=w.hrtime}else e=ne[ue]=new TouchData(X,false,d,null)
re=ae}function pointerLockJustEntered(e){return w.frame_index<=de+(e||1)}function pointerLockExit(){var e=ne[ue]
if(e){F(e.cur_pos,X)
e.state=g}C.exit()
re=ae}var fe
var ve={isTrusted:1,sourceCapabilities:1,path:1,currentTarget:1,view:1}
function eventlog(e){if(e===fe)return
var t=[]
for(var r in fe=e){var a=e[r]
if(!a||"function"===typeof a||r.toUpperCase()===r||ve[r])continue
t.push(r+":"+(a.id||a))}console.log(w.frame_index+" "+e.type+" "+(pointerLocked()?"ptrlck":"unlckd")+" "+t.join(","))}function letWheelEventThrough(e){return e.target&&("INPUT"===e.target.tagName||"TEXTAREA"===e.target.tagName||"LABEL"===e.target.tagName)}function letEventThrough(e){return e.target&&("INPUT"===e.target.tagName||"TEXTAREA"===e.target.tagName||"LABEL"===e.target.tagName||String(e.target.className).includes("noglov"))}function ignored(e){if(!letEventThrough(e)){e.preventDefault()
e.stopPropagation()}}var he=false
var pe=false
function beforeUnload(e){if(pe&&he){pointerLockExit()
e.preventDefault()
e.returnValue="Are you sure you want to quit?"}else w.releaseCanvas()}function protectUnload(e){pe=e}var me=0
function inputLastTime(){return me}function onUserInput(){D()
me=Date.now()}function releaseAllKeysDown(e){for(var t in q){var r=q[t]
if(r.state===E)r.keyUp(e)}}function onKeyUp(e){protectUnload(e.ctrlKey)
var t=e.keyCode
if(!letEventThrough(e)){e.stopPropagation()
e.preventDefault()}if(t===v.ESC&&pointerLocked())pointerLockExit()
var r=q[t]
if(r&&r.state===E)if(I&&"Meta"===e.key)releaseAllKeysDown(e)
else r.keyUp(e)
L.handle("keyup",e)}function onKeyDown(e){protectUnload(e.ctrlKey)
var t=e.keyCode
if(!(letEventThrough(e)||t>=v.F5&&t<=v.F12||t===v.I&&(e.altKey&&e.metaKey||e.ctrlKey&&e.shiftKey)||t===v.R&&e.ctrlKey)){e.stopPropagation()
e.preventDefault()}onUserInput()
var r=q[t]
if(!r)r=q[t]=new KeyData
if(r.state!==E){++r.down_edge
r.state=E
r.origin_time=eventTimestamp(e)
L.handle("keydown",e)}}var ge=0
function debugGetMouseMoveX(){var e=ge
ge=0
return e}var Ee=false
var ye=false
var Te=false
var Ie=U()
var Se=0
var Ae=0
var we=0
var Le=0
function onMouseMove(e,t){if(!letEventThrough(e)&&!t&&3!==e.button){e.preventDefault()
e.stopPropagation()
if(le){R.setJSON("touch_mode",false)
m.touch_mode=le=false}if(ce){R.setJSON("pad_mode",false)
m.pad_mode=ce=false}}Ee=true
X[0]=e.pageX
X[1]=e.pageY
J=false
var r=e.movementX||e.mozMovementX||e.webkitMovementX||0
var a=e.movementY||e.mozMovementY||e.webkitMovementY||0
ge+=r
var i=false
if(pointerLocked()){setMouseToMid()
if(r||a){var o=e.timeStamp||Date.now()
var n=x(r)
var s=x(a)
var l=n+s
if(l>200&&(l>3*Se||o-Ae>1e3))console.log("Ignoring mousemove with sudden large delta: "+r+","+a)
else if(T&&r===we&&a===Le&&n<2&&s<2);else{j(Ie,r||0,a||0)
i=true}Se=l
Ae=o
we=r
Le=a}}else{z(Ie,X,Q)
if(Ie[0]||Ie[1])i=true
F(Q,X)}if(i&&re&&W(Ie)>1e4)i=false
if(i)for(var c=d;c<ee.length;++c)if(ee[c]||c===d&&pointerLocked()){var _=ne["m"+c]
if(_){G(_.delta,_.delta,Ie)
_.total+=x(Ie[0])+x(Ie[1])
F(_.cur_pos,X)}}}function onMouseDown(e){if(i)eventlog(e)
onMouseMove(e)
onUserInput()
var t=letEventThrough(e)
var r=e.button
ee[r]=true
var a="m"+r
if(ne[a])F(ne[a].start_pos,X)
else ne[a]=new TouchData(X,false,r,e)
ne[a].down(e,!t)
if(!t)L.handle("mousedown",e)
ye=true
if(window.focus)window.focus()}var Re=[{timestamp:0,pos:U()},{timestamp:0,pos:U()}]
function registerMouseUpEdge(e,t){e.up_edge++
var r=Re[0]
Re[0]=Re[1]
Re[1]=r
F(r.pos,e.cur_pos)
r.timestamp=t}function onMouseUp(e){if(i)eventlog(e)
onMouseMove(e)
var t=letEventThrough(e)
var r=e.button
if(ee[r]){var a=ne["m"+r]
if(a){F(a.cur_pos,X)
if(!t)registerMouseUpEdge(a,eventTimestamp(e))
a.state=g
a.down_time+=timeDelta(e,a.origin_time)}delete ee[r]}Te=ye=true
if(!t)L.handle("mouseup",e)}function onWheel(e){var t=Ee
onMouseMove(e,true)
Ee=t
var r=-e.deltaY||e.wheelDelta||-e.detail
te.push({pos:[e.pageX,e.pageY],delta:r>0?1:-1,dispatched:false})
if(!letWheelEventThrough(e)){e.stopPropagation()
e.preventDefault()}}var xe=U()
var Oe=0
function onTouchChange(e){onUserInput()
if(!le){R.set("touch_mode",true)
m.touch_mode=le=true}if(ce){R.set("pad_mode",false)
m.pad_mode=ce=false}if(false!==e.cancelable)e.preventDefault()
var t=e.touches
var r={}
var a=t.length
var i=0
for(var o=0;o<t.length;++o){var n=t[o]
try{if(!isFinite(n.pageX)||!isFinite(n.pageY)){--a
continue}}catch(e){--a
continue}var s=ne[n.identifier]
j(xe,n.pageX,n.pageY)
if(!s){(s=ne[n.identifier]=new TouchData(xe,true,0,e)).down(e,true)
ye=true
L.handle("mousedown",n)}else{++i
z(Ie,xe,s.cur_pos)
G(s.delta,s.delta,Ie)
s.total+=x(Ie[0])+x(Ie[1])
F(s.cur_pos,xe)}r[n.identifier]=true
if(y&&1===a){F(X,xe)
J=true}}var l
var c=[]
for(var _ in ne)if(!r[_]){var u=ne[_]
if(u.touch&&u.state===E){++i
l=u
c.push(_)
L.handle("mouseup",{pageX:u.cur_pos[0],pageY:u.cur_pos[1]})
registerMouseUpEdge(u,eventTimestamp(e))
Te=ye=true
u.state=g
u.down_time+=timeDelta(e,u.origin_time)
u.release=true}}for(var d=0;d<c.length;++d){var f=c[d]
var v=ne[f]
var h="r"+ ++Oe
delete ne[f]
ne[h]=v}if(y)if(1===i&&0===a){delete ee[0]
F(X,l.cur_pos)
J=true}else if(1===a){var p=t[0]
if(!i)ee[0]=true
j(X,p.pageX,p.pageY)
J=true}else if(a>1)delete ee[0]}function onBlurOrFocus(e){protectUnload(false)
releaseAllKeysDown(e)}var be={}
function genAnalogMap(){if(a){be[h.LEFT]=[h.LSTICK_LEFT,h.RSTICK_LEFT]
be[h.RIGHT]=[h.LSTICK_RIGHT,h.RSTICK_RIGHT]
be[h.UP]=[h.LSTICK_UP,h.RSTICK_UP]
be[h.DOWN]=[h.LSTICK_DOWN,h.RSTICK_DOWN]}}var Ne=false
function handleTouches(e){e.addEventListener("touchstart",onTouchChange,Ne)
e.addEventListener("touchmove",onTouchChange,Ne)
e.addEventListener("touchend",onTouchChange,Ne)
e.addEventListener("touchcancel",onTouchChange,Ne)}function startup(e,t){Y=e
C.startup(Y,onPointerLockEnter)
if(void 0!==t.map_analog_to_dpad)a=t.map_analog_to_dpad
V=t.pad_to_touch
genAnalogMap()
try{var r=Object.defineProperty({},"passive",{get:function get(){Ne={passive:false}
return false}})
window.addEventListener("test",null,r)
window.removeEventListener("test",null,r)}catch(e){Ne=false}window.addEventListener("keydown",onKeyDown,false)
window.addEventListener("keyup",onKeyUp,false)
window.addEventListener("click",ignored,false)
window.addEventListener("contextmenu",ignored,false)
window.addEventListener("mousemove",onMouseMove,false)
window.addEventListener("mousedown",onMouseDown,false)
window.addEventListener("mouseup",onMouseUp,false)
if(window.WheelEvent)window.addEventListener("wheel",onWheel,Ne)
else{window.addEventListener("DOMMouseScroll",onWheel,false)
window.addEventListener("mousewheel",onWheel,false)}window.addEventListener("blur",onBlurOrFocus,false)
window.addEventListener("focus",onBlurOrFocus,false)
handleTouches(Y)
window.addEventListener("beforeunload",beforeUnload,false)}var Ce=.26
var Me=Ce*Ce
var De=2
var Pe=.35
function getGamepadData(e){var t=Z[e]
if(!t){t=Z[e]={id:e,timestamp:0,sticks:new Array(De)}
for(var r=0;r<De;++r)t.sticks[r]=U()
K[e]={}}return t}function updatePadState(e,t,r,a){if(r&&!t[a]){t[a]=l
onUserInput()
if(le){R.set("touch_mode",false)
m.touch_mode=le=false}if(!ce){R.setJSON("pad_mode",true)
m.pad_mode=ce=true}if(a===V){var i="g"+e.id
if(ne[i]){setMouseToMid()
F(ne[i].start_pos,X)}else ne[i]=new TouchData(X,false,0,null)
ne[i].down(null,true)}}else if(!r&&t[a]){t[a]=s
if(a===V){var o="g"+e.id
var n=ne[o]
if(n){setMouseToMid()
F(n.cur_pos,X)
registerMouseUpEdge(n,w.hrtime)
n.state=g
n.down_time+=O(w.hrtime-n.origin_time,_e)}}}}function gamepadUpdate(){var e
try{e=navigator.gamepads||navigator.webkitGamepads||navigator.getGamepads&&navigator.getGamepads()||navigator.webkitGetGamepads&&navigator.webkitGetGamepads()}catch(e){}if(e){var t=e.length
for(var r=0;r<t;r++){var a=e[r]
if(!a)continue
var i=getGamepadData(r)
var o=K[r]
if(i.timestamp<a.timestamp){var n=a.buttons
i.timestamp=a.timestamp
var s=n.length
for(var l=0;l<s;l++){var c=n[l]
if("object"===typeof c)c=c.value
updatePadState(i,o,c=c>.5,l)}}var _=a.axes
if(_.length>=2*De){for(var u=0;u<De;++u){var d=i.sticks[u]
j(d,_[2*u],-_[2*u+1])
var f=W(d)
if(f>Me){f=N(f)
H(d,d,1/f)
f=b(f,1)
H(d,d,f=(f-Ce)/(1-Ce))}else j(d,0,0)
if(u<=1&&void 0!==V){var v=ne["g"+i.id]
if(v){H(Ie,d,w.frame_dt)
G(v.delta,v.delta,Ie)
v.total+=x(Ie[0])+x(Ie[1])
setMouseToMid()
F(v.cur_pos,X)}}}updatePadState(i,o,i.sticks[0][0]<-Pe,h.LSTICK_LEFT)
updatePadState(i,o,i.sticks[0][0]>Pe,h.LSTICK_RIGHT)
updatePadState(i,o,i.sticks[0][1]<-Pe,h.LSTICK_DOWN)
updatePadState(i,o,i.sticks[0][1]>Pe,h.LSTICK_UP)
updatePadState(i,o,i.sticks[1][0]<-Pe,h.RSTICK_LEFT)
updatePadState(i,o,i.sticks[1][0]>Pe,h.RSTICK_RIGHT)
updatePadState(i,o,i.sticks[1][1]<-Pe,h.RSTICK_DOWN)
updatePadState(i,o,i.sticks[1][1]>Pe,h.RSTICK_UP)}}}}function fakeTouchEvent(e){var t="faketouch"
var r=ne[t]
if(r&&!e){setMouseToMid()
F(r.cur_pos,X)
registerMouseUpEdge(r,w.hrtime)
r.state=g
r.down_time+=O(w.hrtime-r.origin_time,_e)}else if(!r&&e){setMouseToMid()
ne[t]=new TouchData(X,false,0,null)}}function tickInput(){if(re)--re
var e=w.hrtime
for(var t in q){var r=q[t]
if(r.state===E){r.down_time+=O(e-r.origin_time,_e)
r.origin_time=e}}for(var a in ne){var i=ne[a]
if(i.state===E){i.down_time+=O(e-i.origin_time,_e)
i.origin_time=e}}$=false
gamepadUpdate()
L.topOfFrame()
he=false
if(ne[ue]&&!pointerLocked())pointerLockExit()
se=k(ne)}function endFrameTickMap(t){Object.keys(t).forEach(function(e){switch(t[e]){case l:t[e]=E
break
case s:delete t[e]}})}function endFrame(e){for(var t in q){var r=q[t]
if(r.state===g){q[t]=null
delete q[t]}else{r.up_edge=0
r.down_edge=0
r.down_time=0}}K.forEach(endFrameTickMap)
if(!e){for(var a in ne){var i=ne[a]
if(i.state===g){ne[a]=null
delete ne[a]}else{i.delta[0]=i.delta[1]=0
i.dispatched=false
i.dispatched_drag=false
i.dispatched_drag_over=false
if(i.drag_payload_frame===w.frame_index-2)i.drag_payload=null
i.up_edge=0
i.down_edge=0
i.down_time=0}}te.length=0
Te=ye=Ee=oe=false}ie=false}function tickInputInactive(){L.topOfFrame()
he=false
endFrame()}function eatAllInput(e){endFrame(e)
if(!e)oe=$=true
ie=true}function eatAllKeyboardInput(){eatAllInput(true)}function mousePos(e){e=e||U()
S.domToVirtual(e,X)
return e}function mouseDomPos(){return X}function mouseMoved(){return Ee}function mouseButtonHadEdge(){return ye}function mouseButtonHadUpEdge(){return Te}var ke={}
function mousePosParamUnique(e){var t=(e=e||ke).mouse_pos_param
if(!t)t=e.mouse_pos_param={}
t.x=void 0===e.x?S.x0Real():e.x
t.y=void 0===e.y?S.y0Real():e.y
t.w=void 0===e.w?S.wReal():e.w
t.h=void 0===e.h?S.hReal():e.h
t.button=void 0===e.button?u:e.button
return t}var Be={}
function mousePosParam(e){Be.x=void 0===(e=e||{}).x?S.x0Real():e.x
Be.y=void 0===e.y?S.y0Real():e.y
Be.w=void 0===e.w?S.wReal():e.w
Be.h=void 0===e.h?S.hReal():e.h
Be.button=void 0===e.button?u:e.button
return Be}var Ue=U()
function checkPos(e,t){if(!S.domToVirtual(Ue,e))return false
return Ue[0]>=t.x&&(Infinity===t.w||Ue[0]<t.x+t.w)&&Ue[1]>=t.y&&(Infinity===t.h||Ue[1]<t.y+t.h)}function wasDoubleClick(e){if(w.hrtime-Re[0].timestamp>M.double_click_time)return false
return checkPos(Re[0].pos,e)}function mouseWheel(e){if(oe||!te.length)return 0
var t=mousePosParam(e=e||{})
var r=0
for(var a=0;a<te.length;++a){var i=te[a]
if(i.dispatched)continue
if(checkPos(i.pos,t)){r+=i.delta
i.dispatched=true}}return r}function mouseOverCaptured(){$=true}function mouseOver(e){profilerStart("mouseOver")
var t=mousePosParamUnique(e=e||{})
P(t,e)
if($||pointerLocked()&&!e.allow_pointerlock){profilerStop("mouseOver")
return false}if(!e.peek&&!e.peek_touch)for(var r in ne){var a=ne[r]
if(checkPos(a.cur_pos,t)){a.down_edge=0
a.up_edge=0
if(!e||!e.drag_target)a.dispatched=true}}var i=false
if(checkPos(X,t)){if(!e.peek&&!e.peek_over)$=true
i=true}profilerStop("mouseOver")
return i}function mouseDownAnywhere(e){if(oe)return false
if(void 0===e)e=u
for(var t in ne){var r=ne[t]
if(r.state!==E||!(e===u||e===r.button))continue
return true}return false}function mouseDownMidClick(e){if(oe||se)return false
var t=mousePosParam(e=e||{})
var r=t.button
var a=e.max_dist||50
for(var i in ne){var o=ne[i]
if(o.state!==E||!(r===u||r===o.button)||o.total>a)continue
if(checkPos(o.cur_pos,t))return true}return false}function mouseDownOverBounds(e){if(oe||se)return false
var t=mousePosParam(e=e||{})
var r=t.button
for(var a in ne){var i=ne[a]
if(i.state!==E||!(r===u||r===i.button))continue
if(checkPos(i.cur_pos,t))return true}return false}function mousePosIsTouch(){return J}function numTouches(){return Object.keys(ne).length}function keyDown(e){if(e===v.CTRL)he=true
if(ie)return 0
var t=q[e]
if(!t)return 0
if(t.state===E)c(t.down_time)
return t.down_time}function keyDownEdge(e,t){if(ie)return 0
if(t&&t.in_event_cb)L.on("keydown",e,t.in_event_cb)
var r=q[e]
if(!r)return 0
var a=r.down_edge
r.down_edge=0
return a}function keyUpEdge(e,t){if(ie)return 0
if(t&&t.in_event_cb)L.on("keyup",e,t.in_event_cb)
var r=q[e]
if(!r)return 0
var a=r.up_edge
r.up_edge=0
return a}function padGetAxes(e,t,r){c(t>=0&&t<De)
if(void 0===r){var a=U()
j(e,0,0)
for(var i=0;i<Z.length;++i){padGetAxes(a,t,i)
G(e,e,a)}return}var o=getGamepadData(r).sticks
F(e,o[t])}function padButtonDownInternal(e,t,r){if(t[r])return w.frame_dt
return 0}function padButtonDownEdgeInternal(e,t,r){if(t[r]===l){t[r]=E
return 1}return 0}function padButtonUpEdgeInternal(e,t,r){if(t[r]===s){delete t[r]
return 1}return 0}function padButtonShared(e,t,r){c(void 0!==t)
var a=0
if(void 0===r){for(var i=0;i<K.length;++i)a+=padButtonShared(e,t,i)
return a}if(oe)return 0
var o=Z[r]
if(!o)return 0
var n=K[r]
var s=be[t]
if(s)for(var l=0;l<s.length;++l)a+=e(o,n,s[l])||0
return a+e(o,n,t)}function padButtonDown(e,t){return padButtonShared(padButtonDownInternal,e,t)}function padButtonDownEdge(e,t){return padButtonShared(padButtonDownEdgeInternal,e,t)}function padButtonUpEdge(e,t){return padButtonShared(padButtonUpEdgeInternal,e,t)}var Ge=U()
var Fe=U()
var We=U()
function mouseUpEdge(e){e=e||{}
if(oe||!e.in_event_cb&&se)return null
var t=mousePosParam(e)
var r=t.button
var a=e.max_dist||50
var i=false
for(var o in ne){var n=ne[o]
if(n.total>a){i=true
continue}if(!n.up_edge)continue
if(n.long_press_dispatched)continue
if(!(r===u||r===n.button))continue
if(checkPos(n.cur_pos,t)){if(!e.peek)n.up_edge=0
return{button:n.button,pos:Ue.slice(0),start_time:n.start_time,was_double_click:wasDoubleClick(t)}}}if(e.in_event_cb&&!$&&!i){if(!e.phys)e.phys={}
e.phys.button="number"===typeof e.in_event_button?e.in_event_button:r
S.virtualToDomPosParam(e.phys,t)
L.on("mouseup",e.phys,e.in_event_cb)}return null}function mouseDownEdge(e){e=e||{}
if(oe||!e.in_event_cb&&se)return null
var t=mousePosParam(e)
var r=t.button
for(var a in ne){var i=ne[a]
if(!i.down_edge||!(r===u||r===i.button))continue
if(checkPos(i.cur_pos,t)){if(!e.peek)i.down_edge=0
return{button:i.button,pos:Ue.slice(0),start_time:i.start_time}}}if(e.in_event_cb&&!$){if(!e.phys)e.phys={}
e.phys.button=r
S.virtualToDomPosParam(e.phys,t)
L.on("mousedown",e.phys,e.in_event_cb)}return null}function mouseConsumeClicks(e){if(se)return
var t=mousePosParam(e=e||{})
var r=t.button
for(var a in ne){var i=ne[a]
if(!(r===u||r===i.button)||i.dispatched_drag)continue
if(checkPos(i.start_pos,t)){i.down_edge=0
i.start_pos[0]=i.start_pos[1]=Infinity
i.total=Infinity}}}function drag(e){if(oe||se)return null
var t=mousePosParam(e=e||{})
var r=t.button
var a=e.min_dist||0
for(var i in ne){var o=ne[i]
if(!(r===u||r===o.button)||o.dispatched_drag)continue
if(checkPos(o.start_pos,t)){S.domDeltaToVirtual(We,[o.total/2,o.total/2])
var n=We[0]+We[1]
if(n<a)continue
if(!e.peek)o.dispatched_drag=true
var s=o.down_edge
if(e.eat_clicks)o.down_edge=o.up_edge=0
if(e.payload){o.drag_payload=e.payload
o.drag_payload_frame=w.frame_index}S.domToVirtual(Ge,o.start_pos)
S.domToVirtual(Fe,o.cur_pos)
S.domDeltaToVirtual(We,o.delta)
return{cur_pos:Fe,start_pos:Ge,delta:We,total:n,button:o.button,touch:o.touch,start_time:o.start_time,is_down_edge:s,down_time:o.down_time}}}return null}function longPress(e){if(oe||se)return null
var t=mousePosParam(e=e||{})
var r=t.button
var a=e.long_press_max_dist||50
var i=e.min_time||500
for(var o in ne){var n=ne[o]
if(!(r===u||r===n.button)||n.long_press_dispatched)continue
if(checkPos(n.start_pos,t)){S.domDeltaToVirtual(We,[n.total/2,n.total/2])
var s=We[0]+We[1]
if(s>a)continue
if(Date.now()-n.start_time<i)continue
if(!e.peek)n.long_press_dispatched=true
var l=n.down_edge
if(e.eat_clicks)n.down_edge=n.up_edge=0
S.domToVirtual(Ge,n.start_pos)
S.domToVirtual(Fe,n.cur_pos)
S.domDeltaToVirtual(We,n.delta)
return{long_press:true,cur_pos:Fe,start_pos:Ge,delta:We,total:s,button:n.button,touch:n.touch,start_time:n.start_time,is_down_edge:l,down_time:n.down_time}}}return null}function dragDrop(e){if(oe||se)return null
var t=mousePosParam(e=e||{})
var r=t.button
for(var a in ne){var i=ne[a]
if(!(r===u||r===i.button)||i.dispatched||!i.drag_payload)continue
if(!i.up_edge)continue
if(checkPos(i.cur_pos,t)){if(!e.peek){i.dispatched_drag_over=true
i.dispatched_drag=true
i.dispatched=true}return{drag_payload:i.drag_payload}}}return null}function dragOver(e){if(oe||se)return null
var t=mousePosParam(e=e||{})
var r=t.button
for(var a in ne){var i=ne[a]
if(!(r===u||r===i.button)||i.dispatched_drag_over||!i.drag_payload)continue
if(i.state!==E)continue
if(checkPos(i.cur_pos,t)){if(!e.peek)i.dispatched_drag_over=true
S.domToVirtual(Fe,i.cur_pos)
return{cur_pos:Fe,drag_payload:i.drag_payload}}}return null}},{"../common/util.js":330,"../common/vmath.js":332,"./browser.js":239,"./camera2d.js":241,"./cmds.js":244,"./engine.js":250,"./in_event.js":270,"./input_constants":272,"./local_storage.js":274,"./pointer_lock.js":283,"./settings.js":291,"./sound.js":297,"./spot.js":300,assert:void 0}],272:[function(e,t,r){"use strict"
r.POINTERLOCK=r.ANY=r.BUTTON_POINTERLOCK=r.BUTTON_ANY=r.BUTTON_RIGHT=r.BUTTON_MIDDLE=r.BUTTON_LEFT=void 0
var a=0
r.BUTTON_LEFT=a
var i=1
r.BUTTON_MIDDLE=i
var o=2
r.BUTTON_RIGHT=o
var n=-2
r.BUTTON_ANY=n
var s=-1
r.BUTTON_POINTERLOCK=s
var l=n
r.ANY=l
var c=s
r.POINTERLOCK=c},{}],273:[function(e,t,r){"use strict"
r.linkGetDefaultStyle=linkGetDefaultStyle
r.link=link
r.linkText=linkText
r.linkTick=linkTick
var g=e("assert")
var E=e("./engine.js")
var a=e("./font.js").style
var y=e("./camera2d.js")
var T=e("./in_event.js")
var I=e("./input.js")
var S=Math.abs
var A=e("./ui.js").uiGetDOMElem
var w=e("./ui.js")
var L=e("./settings.js")
var i=e("./spot.js"),R=i.SPOT_DEFAULT_BUTTON,x=i.spot,O=i.spotFocusSteal,b=i.spotKey
var N=a(null,{color:1346437119,outline_width:1,outline_color:32})
var C=a(null,{color:65535,outline_width:1,outline_color:32})
function linkGetDefaultStyle(){return N}var M={}
var D=/https?:\/\//
function preventFocus(e){e.preventDefault()
if(e.relatedTarget)e.relatedTarget.focus()
else e.currentTarget.blur()}function link(e){var t=e.x,r=e.y,a=e.w,i=e.h,o=e.url,n=e.internal,s=e.allow_modal
if(!o.match(D))o=document.location.protocol+"//"+o
var l=b(e)
var c=M[l]
if(!c)c=M[l]={clicked:false}
c.frame=E.frame_index
var _={x:t,y:r,w:a,h:i}
if(y.clipTestRect(_)&&!(L.shader_debug||L.show_profiler)){var u=A(c.elem,s)
if(u!==c.elem)if(c.elem=u){u.textContent=""
var d=document.createElement("a")
d.setAttribute("draggable",false)
d.textContent=" "
d.className="glovui_link noglov"
d.setAttribute("target","_blank")
d.setAttribute("href",o)
d.setAttribute("tabindex","-1")
d.addEventListener("focus",preventFocus)
c.url=o
if(n){var f
var v
I.handleTouches(d)
d.onmousedown=function(e){f=e.pageX
v=e.pageY}
d.onclick=function(e){e.preventDefault()
if(f)if(S(e.pageX-f)+S(e.pageY-v)>50)return
c.clicked=true
T.handle("mouseup",e)}}u.appendChild(d)
c.a_elem=d}if(u){if(o!==c.url){c.a_elem.setAttribute("href",o)
c.url=o}var h=y.htmlPos(_.x,_.y)
u.style.left=h[0]+"%"
u.style.top=h[1]+"%"
var p=y.htmlSize(_.w,_.h)
u.style.width=p[0]+"%"
u.style.height=p[1]+"%"}}var m=c.clicked
c.clicked=false
return m}function linkText(e){var t=e.style_link,r=e.style_link_hover,a=e.x,i=e.y,o=e.z,n=e.font_size,s=e.text,l=e.url,c=e.internal
s=s||l
o=o||Z.UI
n=n||w.font_height
var _=w.font.getStringWidth(t||N,n,s)
var u=n
e.w=_
e.h=u
e.def=R
var d=x(e)
var f=d.focused?r||C:t||N
w.font.drawSized(f,a,i,o,n,s)
var v=1
w.drawLine(a,i+u-v,a+_,i+u-v,o-.5,v,1,f.color_vec4)
var h=link(e)
if(h)O(e)
if(d.ret&&!c){var p=b(e)
var m=M[p]
g(m)
g(m.a_elem)
m.a_elem.click()}return h||d.ret}function linkTick(){for(var e in M)if(M[e].frame!==E.frame_index-1)delete M[e]}},{"./camera2d.js":241,"./engine.js":250,"./font.js":260,"./in_event.js":270,"./input.js":271,"./settings.js":291,"./spot.js":300,"./ui.js":306,assert:void 0}],274:[function(e,t,r){"use strict"
r.setStoragePrefix=setStoragePrefix
r.getStoragePrefix=getStoragePrefix
r.localStorageGet=localStorageGet
r.localStorageSet=localStorageSet
r.localStorageSetJSON=localStorageSetJSON
r.localStorageGetJSON=localStorageGetJSON
r.localStorageClearAll=localStorageClearAll
r.localStorageExportAll=localStorageExportAll
r.localStorageImportAll=localStorageImportAll
var c=e("assert")
var _="demo"
var a=false
function setStoragePrefix(e){if(a)return
a=true
_=e}function getStoragePrefix(){c(a)
return _}var u=function(){try{localStorage.setItem("test","test")
localStorage.removeItem("test")
return localStorage}catch(e){return null}}()
var d={}
function localStorageGet(e){c(a)
var t=d[e=_+"_"+e]||u&&u.getItem(e)
if("undefined"===t)t=void 0
else if(null===t)t=void 0
return t}function localStorageSet(e,t){c(a)
e=_+"_"+e
if(void 0===t||null===t){if(u)u.removeItem(e)
delete d[e]}else{var r=String(t)
d[e]=r
try{if(u)u.setItem(e,r)}catch(e){}}}function localStorageSetJSON(e,t){localStorageSet(e,JSON.stringify(t))}function localStorageGetJSON(e,t){var r=localStorageGet(e)
if(void 0===r)return t
try{return JSON.parse(r)}catch(e){}return t}function localStorageClearAll(e){var t=new RegExp("^"+_+"_"+(e||""),"u")
if(u){var r=[]
for(var a=0;a<u.length;a++){var i=u.key(a)
c(i)
if(i.match(t))r.push(i)}for(var o=0;o<r.length;o++)u.removeItem(r[o])}for(var n in d)if(n.match(t))delete d[n]}function localStorageExportAll(e){var t={}
var r=new RegExp("^"+_+"_("+(e||"")+".*)","u")
if(u)for(var a=0;a<u.length;a++){var i=u.key(a)
c(i)
var o=i.match(r)
if(o){var n=u.getItem(i)
if(n&&"undefined"!==n)t[o[1]]=n}}for(var s in d){var l=s.match(r)
if(l)t[l[1]]=d[s]}return t}function localStorageImportAll(e){localStorageClearAll()
for(var t in e)localStorageSet(t,e[t])}r.get=localStorageGet
r.set=localStorageSet
r.setJSON=localStorageSetJSON
r.getJSON=localStorageGetJSON
r.clearAll=localStorageClearAll},{assert:void 0}],275:[function(e,t,r){"use strict"
r.getStringFromLocalizable=getStringFromLocalizable
r.getStringIfLocalizable=getStringIfLocalizable
function getStringFromLocalizable(e){return e&&e.toLocalString?e.toLocalString():e}function getStringIfLocalizable(e){return e&&e.toLocalString?e.toLocalString():e}},{}],276:[function(e,t,r){"use strict"
r.mat43=mat43
r.m43identity=m43identity
r.m43mul=m43mul
function mat43(){var e=new Float32Array(12)
e[0]=e[4]=e[8]=1
return e}function m43identity(e){e[0]=1
e[1]=0
e[2]=0
e[3]=0
e[4]=1
e[5]=0
e[6]=0
e[7]=0
e[8]=1
e[9]=0
e[10]=0
e[11]=0}function m43mul(e,t,r){var a=t[0]
var i=t[1]
var o=t[2]
var n=t[3]
var s=t[4]
var l=t[5]
var c=t[6]
var _=t[7]
var u=t[8]
var d=t[9]
var f=t[10]
var v=t[11]
var h=r[0]
var p=r[1]
var m=r[2]
var g=r[3]
var E=r[4]
var y=r[5]
var T=r[6]
var I=r[7]
var S=r[8]
e[0]=h*a+g*i+T*o
e[1]=p*a+E*i+I*o
e[2]=m*a+y*i+S*o
e[3]=h*n+g*s+T*l
e[4]=p*n+E*s+I*l
e[5]=m*n+y*s+S*l
e[6]=h*c+g*_+T*u
e[7]=p*c+E*_+I*u
e[8]=m*c+y*_+S*u
e[9]=h*d+g*f+T*v+r[9]
e[10]=p*d+E*f+I*v+r[10]
e[11]=m*d+y*f+S*v+r[11]
return e}},{}],277:[function(e,t,r){"use strict"
t.exports=function(e,t,r,a){var i=r[0]
var o=r[1]
var n=r[2]
var s=r[3]
var l=i+i
var c=o+o
var _=n+n
var u=i*l
var d=i*c
var f=i*_
var v=o*c
var h=o*_
var p=n*_
var m=s*l
var g=s*c
var E=s*_
e[0]=(1-(v+p))*t
e[1]=(d+E)*t
e[2]=(f-g)*t
e[3]=0
e[4]=(d-E)*t
e[5]=(1-(u+p))*t
e[6]=(h+m)*t
e[7]=0
e[8]=(f+g)*t
e[9]=(h-m)*t
e[10]=(1-(u+v))*t
e[11]=0
e[12]=a[0]
e[13]=a[1]
e[14]=a[2]
e[15]=1
return e}},{}],278:[function(e,t,a){"use strict"
a.load=load
a.startup=startup
a.default_fshader=a.default_vshader=a.models=a.load_count=void 0
var M=e("assert")
var D=e("./geom.js")
var P=e("./glb/parser.js")
var k=e("./glb/gltf-type-utils.js").ATTRIBUTE_TYPE_TO_COMPONENTS
var i=e("./engine.js")
var o=e("./fetch.js").fetch
var B=e("./shaders.js")
var U=e("./textures.js")
var n=e("../common/vmath.js").vec4
var r=e("./webfs.js").webFSGetFile
var s=0
a.load_count=s
var l={}
a.models=l
var c
a.default_vshader=c
var _
a.default_fshader=_
function initShaders(){a.default_vshader=c=B.create("shaders/default.vp")
a.default_fshader=_=B.create("shaders/default.fp")
B.prelink(c,_)}function Model(e){var t=(this.url=e).lastIndexOf("/")
if(-1!==t)this.base_url=e.slice(0,t+1)
else this.base_url=""}Model.prototype.load=function(){var r=this
a.load_count=s+=1
o({url:this.url,response_type:"arraybuffer"},function(e,t){a.load_count=--s
if(e)window.onerror("Model loading error","models.js",0,0,e)
else try{r.parse(t)}catch(e){window.onerror("Model loading error","models.js",0,0,e)}})}
var G={TANGENT:true}
Model.prototype.parse=function(e){var t=P.parse(e)
if(!t)return
var r=t.getJSON()
var a=[]
for(var i=0;i<r.meshes.length;++i){var o=r.meshes[i]
for(var n=0;n<o.primitives.length;++n){var s=o.primitives[n]
var l=r.materials[s.material]
var c=null
if(l){var _=(l.pbrMetallicRoughness||{}).baseColorTexture||{}
var u=r.textures&&r.textures[_.index]||{}
var d=r.samplers&&r.samplers[u.sampler]||{}
var f=r.images&&r.images[u.source]||{}
if(f.uri){var v={url:""+this.base_url+f.uri,filter_mag:d.magFilter,filter_min:d.minFilter,wrap_s:d.wrapS,wrap_t:d.wrapT}
c=U.load(v)}}var h=[]
var p=[]
var m=[]
var g=0
var E=0
for(var y in s.attributes){if(G[y])continue
M(void 0!==B.semantic[y])
var T=r.accessors[s.attributes[y]]
M.equal(T.componentType,5126)
var I=gl.FLOAT
var S=k[T.type]
M(S)
var A=T.count
if(!E)E=A
else M.equal(E,A)
h.push([B.semantic[y],I,S])
var w=t.getBuffer(T)
p.push(w)
m.push(0)
g+=w.length}var L=new Float32Array(g)
var R=0
for(var x=0;x<E;++x)for(var O=0;O<h.length;++O)for(var b=0;b<h[O][2];++b)L[R++]=p[O][m[O]++]
var N=r.accessors[s.indices]
M(N)
M.equal(N.type,"SCALAR")
var C=t.getBuffer(N)
if(5125===N.componentType){M(E<65535)
C=new Uint16Array(C)}else M.equal(N.componentType,5123)
a.push({geom:D.create(h,L,C,s.mode),texture:c})}}this.data={objs:a}}
Model.prototype.draw=function(e){i.updateMatrices(e)
B.bind(c,_,{color:n(1,1,1,1)})
var t=this.data.objs
for(var r=0;r<t.length;++r){var a=t[r]
if(a.texture)U.bind(0,a.texture)
a.geom.draw()}}
Model.prototype.drawGeom=function(){var e=this.data.objs
for(var t=0;t<e.length;++t)e[t].geom.draw()}
function load(e){if(l[e])return l[e]
var t=l[e]=new Model(e)
t.data=l.box.data
t.load()
return t}function startup(){initShaders();(l.box=new Model("box")).parse(r("models/box_textured_embed.glb").buffer)}},{"../common/vmath.js":332,"./engine.js":250,"./fetch.js":258,"./geom.js":263,"./glb/gltf-type-utils.js":265,"./glb/parser.js":266,"./shaders.js":293,"./textures.js":304,"./webfs.js":309,assert:void 0}],279:[function(e,t,r){"use strict"
r.init=init
r.buildString=buildString
r.netDisconnectedRaw=netDisconnectedRaw
r.netDisconnected=netDisconnected
r.netForceDisconnect=netForceDisconnect
r.netClient=netClient
r.netClientId=netClientId
r.netUserId=netUserId
r.netSubs=netSubs
r.netBuildString=buildString
r.netInit=init
var a=e("./filewatch.js").filewatchStartup
var i=e("../common/packet.js").packetEnableDebug
var o=e("./subscription_manager.js")
var n=e("./wsclient.js")
var s=e("../common/wscommon.js")
var l=n.WSClient
var c
var _
function init(e){if((e=e||{}).ver)n.CURRENT_VERSION=e.ver
if(String(document.location).match(/^https?:\/\/localhost/)){if(!e.no_packet_debug){console.log("PacketDebug: ON")
i(true)}if(!e.no_net_delay)s.netDelaySet()}c=new l(e.path);(_=o.create(c,e.cmd_parse)).auto_create_user=Boolean(e.auto_create_user)
_.no_auto_login=Boolean(e.no_auto_login)
_.allow_anon=Boolean(e.allow_anon)
window.subs=_
r.subs=_
r.client=c
a(c)
if(e.engine){e.engine.addTickFunc(function(e){c.checkDisconnect()
_.tick(e)})
e.engine.onLoadMetrics(function(e){_.onceConnected(function(){c.send("load_metrics",e)})})}}var u=new Date(Number("1675164989368")).toISOString().replace("T"," ").slice(5,-8)
function buildString(){return n.CURRENT_VERSION?n.CURRENT_VERSION+" ("+u+")":u}function netDisconnectedRaw(){return!c||!c.connected||c.disconnected||!c.socket||1!==c.socket.readyState}function netDisconnected(){return netDisconnectedRaw()||_.logging_in}function netForceDisconnect(){var e
if(_)_.was_logged_in=false
null==c||(null==(e=c.socket)||(null==e.close||e.close()))}function netClient(){return c}function netClientId(){return c.id}function netUserId(){return _.getUserId()}function netSubs(){return _}},{"../common/packet.js":325,"../common/wscommon.js":334,"./filewatch.js":259,"./subscription_manager.js":303,"./wsclient.js":313}],280:[function(e,t,r){"use strict"
r.create=create
function create(){return{tick:function tick(){}}}},{}],281:[function(e,t,r){"use strict"
r.addMetric=addMetric
r.friendlyBytes=friendlyBytes
r.perfSetAutoChannel=perfSetAutoChannel
r.perfGraphOverride=perfGraphOverride
r.draw=draw
r.perf_mem_counters=void 0
var o={}
r.perf_mem_counters=o
var x=e("./engine.js")
var O=[]
function addMetric(e,t){if(e.show_graph){e.num_lines=e.colors.length
e.history_size=e.data.history.length/e.num_lines}e.num_labels=Object.keys(e.labels).length
if(void 0===e.interactable)e.interactable=x.DEBUG&&(e.num_labels>1&&!e.show_all||e.show_graph)
if(t)O.splice(0,0,e)
else O.push(e)}var b=e("./camera2d.js")
var a=e("./cmds.js").cmd_parse
var N=e("./font.js")
var g=e("./input.js")
var C=Math.max
var i=e("./net.js"),n=i.netClient,s=i.netClientId,l=i.netDisconnected
var c=e("../common/perfcounters.js").perfCounterHistory
var M=e("./profiler_ui.js").profilerUI
var D=e("./settings.js")
var _=e("./sprites.js"),A=_.spriteChainedStart,w=_.spriteChainedStop
var P=e("./ui.js")
var u=e("../common/vmath.js"),d=u.vec4,E=u.v3copy
e("./perf_net.js")
var k=2
var B=d(0,0,0,.5)
var y=d(0,0,0,.75)
var T=d()
D.register({show_metrics:{default_value:1,type:a.TYPE_INT,range:[0,1]},show_fps:{label:"Show FPS",default_value:x.DEBUG?1:0,type:a.TYPE_INT,range:[0,4]},fps_graph:{label:"FPS Graph",default_value:0,type:a.TYPE_INT,range:[0,1]},fps_window:{label:"FPS Time Window (seconds)",default_value:1,type:a.TYPE_FLOAT,range:[.001,120]},show_perf_counters:{default_value:0,type:a.TYPE_INT,range:[0,1]},show_perf_memory:{default_value:0,type:a.TYPE_INT,range:[0,1],access_run:["sysadmin"]},perf_provider:{default_value:"client",type:a.TYPE_STRING,usage:"Set the perf provider for /show_perf_counters and /show_perf_memory\n  CLIENT : show client values\n  AUTO : automatically determine appropriate server\n  user.1234 : use server hosting a particular worker",access_run:["sysadmin"]}})
a.register({cmd:"fps",help:"Toggles FPS display",func:function func(e,t){if(D.show_fps&&D.show_metrics||"0"===e)D.set("show_fps",0)
else{D.set("show_fps",1)
D.set("show_metrics",1)}t()}})
var U=N.style({outline_width:2,outline_color:128,color:4294967295})
function friendlyUnit(e,t){var r=0
while(r<e.length-1&&t>=e[r+1][0])r++
if(0===r)return t+" "+e[r][1]
return(t/e[r][0]).toFixed(2)+" "+e[r][1]}var f=[[1,"bytes"],[1024,"KB"],[1048576,"MB"],[1073741824,"GB"]]
var v=[[1,""],[1e3,"k"],[1e6,"m"],[1e9,"g"]]
function friendlyBytes(e){return friendlyUnit(f,e)}function friendlyCount(e){return friendlyUnit(v,e)}function showMetric(e,t){var r=x.font
var a=k
var i=D.render_scale_all<1?P.font_height/D.render_scale_all:P.font_height
var o=i*(t.width||2.5)
var n=b.x1Real()-o-a
var s=e
e+=a
var l=0
var c=t.show_all?Infinity:D[t.show_stat]
var _=false
var u=1
for(var d in t.labels){var f=t.labels[d]()
if(f){var v=U
if(f.alpha){u=f.alpha
f=f.value
v=N.styleAlpha(U,u)}var h=r.drawSizedAligned(v,n,e,Z.FPSMETER+3,i,N.ALIGN.HRIGHT,0,0,d)
l=C(l,h)
r.drawSizedAligned(v,n,e,Z.FPSMETER+3,i,N.ALIGN.HFIT,o,0,f)
e+=i
_=true}if(!--c)break}if(!_)return e-a
var p=B
var m={x:(n-=l+k)-a,y:s,w:o+l+k+2*a,h:(e+=a)-s}
if(t.interactable){if(g.mouseUpEdge(m))if(t.num_labels>1&&D[t.show_stat]<=1)D.set(t.show_stat,t.num_labels)
else if(t.show_graph&&!D[t.show_graph])D.set(t.show_graph,1)
else{if(t.show_graph)D.set(t.show_graph,0)
D.set(t.show_stat,1)}if(g.mouseOver(m))p=y}if(1!==u){T[3]=p[3]*u
p=E(T,p)}P.drawRect(m.x,m.y,m.x+m.w,e,Z.FPSMETER+2,p)
return e}function showMetricGraph(e,t){var r=x.game_height<300
var a=r?1:3
var i=r?0:1
var o=r?64:128
var n=t.history_size-1
var s=(a+i)*n
var l=b.x1Real()-s
var c=o+2*i
var _=Z.FPSMETER
A()
P.drawRect(l,e-c,l+s,e,_++,B)
l+=i
e-=i
var u=t.data.index
var d=o/t.line_scale_top
for(var f=0;f<n;f++){var v=(f+u+1)%t.history_size*t.num_lines
var h=t.data.history
var p=0
for(var m=0;m<t.num_lines;m++){var g=h[v+m]
var E=void 0
if(t.bars_stack){E=p
p+=g}else{var y=0
for(var T=0;T<t.num_lines;T++){if(T===m)continue
var I=h[v+T]
if((I<g||I===g&&T<m)&&I>y)y=I}E=y
p=g}var S=t.colors[m]
P.drawRect(l,e-p*d,l+a,e-E*d,_,S)}l+=a+i}_+=n
e-=o+i
w()
return e}function perfDefaultAutoChannel(){var e=s()
if(e)return"client."+e
return null}var h=perfDefaultAutoChannel
function perfSetAutoChannel(e){h=e}var p=1e4
var m=2500
var I={last_update:-Infinity,data:null}
function updatePerfProvider(){var e=p
var r={}
if(D.show_perf_counters)r.counters=1
if(D.show_perf_memory){r.memory=1
e=m}var t=D.perf_provider.toLowerCase()
if("client"===t){var a={source:"client"}
if(r.counters)a.counters=c()
if(r.memory)a.memory=o
return a}if(I.in_flight||l())return I.data
if(x.frame_timestamp-I.last_update<e)return I.data
var i
if("auto"===t)i=h()
else if(t.match(/^[^.]+\.[^.]+$/))i=t
if(i){I.in_flight=true
n().send("perf_fetch",{channel_id:i,fields:r},function(e,t){if(e)console.error("Error getting perf data: "+Object.keys(r)+": "+e)
I.data=t
I.last_update=x.frame_timestamp
I.in_flight=false})}return I.data}function perfMemObjToLines(e,t,r){for(var a in t){var i=t[a]
if(i&&"object"===typeof i)perfMemObjToLines(e,i,""+r+a+".")
else{if("number"===typeof i)if(a.endsWith("bytes")||r.includes("data_size"))i=friendlyBytes(i)
else i=friendlyCount(i)
e.push(""+r+a+": "+i)}}}var G=null
function perfGraphOverride(e){G=e}function draw(){b.push()
M()
b.setAspectFixed(x.game_width,x.game_height)
if(D.show_metrics){var e=b.y0Real()
var t=b.y1Real()
if(G){t=showMetricGraph(t,G)
t-=k}for(var r=0;r<O.length;++r){var a=O[r]
if(D[a.show_stat]){e=showMetric(e,a)
e+=k}if(!G&&D[a.show_graph]){t=showMetricGraph(t,a)
t-=k}}}if(D.show_perf_counters||D.show_perf_memory){var i=x.font
var o=updatePerfProvider()||{}
var n=b.y0Real()
var s=n
var l=D.render_scale_all<1?P.font_height/D.render_scale_all:P.font_height
var c=6*l
var _=b.x0Real()
var u=_+2*c
var d=u+c
var f=Z.FPSMETER+1
var v=_+c
if(o.source){i.drawSized(U,v,n,f,l,"Source: "+o.source)
n+=l}if(o.log){var h=.67*b.wReal()
d=C(d,v+h)
n+=i.drawSizedWrapped(U,v,n,f,h,20,l,o.log)+4}if(o.memory&&D.show_perf_memory){var p=[]
perfMemObjToLines(p,o.memory,"")
for(var m=0;m<p.length;++m){i.drawSized(U,u,n,f,l,p[m])
n+=l}}if(o.counters&&D.show_perf_counters){var g=o.counters||[]
var E={}
for(var y=0;y<g.length;++y){var T=g[y]
for(var I in T){E[I]=E[I]||[]
E[I][y]=T[I]}}var S=Object.keys(E)
S.sort()
for(var A=0;A<S.length;++A){var w=S[A]
var L=E[w]
i.drawSizedAligned(U,u-2*c,n,f,l,N.ALIGN.HRIGHT|N.ALIGN.HFIT,2*c,0,w+": ")
for(var R=0;R<L.length;++R)if(L[R])i.drawSizedAligned(U,u+c*R,n,f,l,N.ALIGN.HFIT,c,0,L[R]+" ")
d=C(d,u+c*L.length)
n+=l}}P.drawRect(_,s,d,n,f-.1,B)}b.pop()
G=null}},{"../common/perfcounters.js":326,"../common/vmath.js":332,"./camera2d.js":241,"./cmds.js":244,"./engine.js":250,"./font.js":260,"./input.js":271,"./net.js":279,"./perf_net.js":282,"./profiler_ui.js":286,"./settings.js":291,"./sprites.js":302,"./ui.js":306}],282:[function(e,t,r){"use strict"
r.registerPingProvider=registerPingProvider
var a=e("../common/wscommon")
var i=a.wsstats
var o=a.wsstats_out
var n=e("./cmds").cmd_parse
var s=e("./perf")
var l=e("./settings")
var c=Math.min
l.register({show_net:{default_value:0,type:n.TYPE_INT,range:[0,2]}})
var _={msgs:0,bytes:0,time:Date.now(),dm:0,db:0}
var u={msgs:0,bytes:0,time:Date.now(),dm:0,db:0}
function bandwidth(e,t){var r=Date.now()
if(r-t.time>1e3){t.dm=e.msgs-t.msgs
t.db=e.bytes-t.bytes
t.msgs=e.msgs
t.bytes=e.bytes
if(r-t.time>2e3)t.time=r
else t.time+=1e3}return(t.db/1024).toFixed(2)+" kb ("+t.dm+")"}s.addMetric({name:"net",show_stat:"show_net",width:5,labels:{"down: ":bandwidth.bind(null,i,_),"up: ":bandwidth.bind(null,o,u)}})
var d=0
function registerPingProvider(t){var e
var r=1===++d?"":""+d
l.register(((e={})["show_ping"+r]={default_value:0,type:n.TYPE_INT,range:[0,1]},e))
s.addMetric({name:"ping"+r,show_stat:"show_ping"+r,labels:{"ping: ":function ping(){var e=t()
if(!e||e.fade<.001)return""
return{value:""+e.ping.toFixed(1),alpha:c(1,3*e.fade)}}}})}},{"../common/wscommon":334,"./cmds":244,"./perf":281,"./settings":291}],283:[function(e,t,r){"use strict"
r.isLocked=isLocked
r.exit=exit
r.enter=enter
r.startup=startup
var a=e("../common/util.js").eatPossiblePromise
var i=false
var o
var n
function isLocked(){return i}function pointerLog(e){console.log("PointerLock: "+e)}function exit(){pointerLog("Lock exit requested")
i=false
a(document.exitPointerLock())}function enter(e){i=true
n()
pointerLog("Trying pointer lock in response to "+e)
a(o.requestPointerLock())}function onPointerLockChange(){if(document.pointerLockElement||document.mozPointerLockElement||document.webkitPointerLockElement){pointerLog("Lock successful")
if(!i){pointerLog("User canceled lock")
a(document.exitPointerLock())}}else if(i){pointerLog("Lock lost")
i=false}}function onPointerLockError(e){pointerLog("Error")
i=false}function startup(e,t){n=t;(o=e).requestPointerLock=o.requestPointerLock||o.mozRequestPointerLock||o.webkitRequestPointerLock||function(){}
document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock||function(){}
document.addEventListener("pointerlockchange",onPointerLockChange,false)
document.addEventListener("mozpointerlockchange",onPointerLockChange,false)
document.addEventListener("webkitpointerlockchange",onPointerLockChange,false)
document.addEventListener("pointerlockerror",onPointerLockError,false)
document.addEventListener("mozpointerlockerror",onPointerLockError,false)
document.addEventListener("webkitpointerlockerror",onPointerLockError,false)}},{"../common/util.js":330}],284:[function(e,t,r){"use strict"
var a=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array]
if(!Uint8Array.prototype.slice)a.forEach(function(o){Object.defineProperty(o.prototype,"slice",{value:function value(e,t){if(void 0===t)t=this.length
if(t<0)t=this.length-t
if((e=e||0)>=this.length)e=this.length-1
if(t>this.length)t=this.length
if(t<e)t=e
var r=t-e
var a=new o(r)
for(var i=0;i<r;++i)a[i]=this[e+i]
return a}})})
function cmpDefault(e,t){return e-t}var i={join:function join(e){return Array.prototype.join.call(this,e)},fill:function fill(e,t,r){if(void 0===r)r=this.length
for(var a=t||0;a<r;++a)this[a]=e
return this},sort:function sort(e){Array.prototype.sort.call(this,e||cmpDefault)}}
var o=function _loop(t){if(!Uint8Array.prototype[t])a.forEach(function(e){Object.defineProperty(e.prototype,t,{value:i[t]})})}
for(var n in i)o(n)
if(!String.prototype.endsWith){Object.defineProperty(String.prototype,"endsWith",{value:function value(e){return this.slice(-e.length)===e}})
Object.defineProperty(String.prototype,"startsWith",{value:function value(e){return this.slice(0,e.length)===e}})}if(!String.prototype.includes)Object.defineProperty(String.prototype,"includes",{value:function value(e,t){return-1!==this.indexOf(e,t)}})
if(!Array.prototype.includes)Object.defineProperty(Array.prototype,"includes",{value:function value(e,t){return-1!==this.indexOf(e,t)}})
if(!Object.values)Object.values=function values(t){return Object.keys(t).map(function(e){return t[e]})}
if(!Object.entries)Object.entries=function entries(e){var t=Object.keys(e)
var r=new Array(t.length)
for(var a=t.length-1;a>=0;--a)r[a]=[t[a],e[t[a]]]
return r}
if(!Object.assign)Object.assign=function assign(e,t){for(var r=1;r<arguments.length;++r){var a=arguments[r]
for(var i in a)e[i]=a[i]}return e}
if(!Math.sign)Math.sign=function sign(e){return e<0?-1:e>0?1:0}
if("undefined"!==typeof window){if(!window.Intl)window.Intl={}
if(!window.Intl.NumberFormat){window.Intl.NumberFormat=function(){}
window.Intl.NumberFormat.prototype.format=function(e){return String(e)}}if(!window.Intl.DateTimeFormat){window.Intl.DateTimeFormat=function(){}
window.Intl.DateTimeFormat.prototype.format=function(e){return String(e)}}}},{}],285:[function(e,t,r){"use strict"
r.profilerChildCallCount=profilerChildCallCount
r.profilerWarning=profilerWarning
r.profilerNodeRoot=profilerNodeRoot
r.profilerNodeTick=profilerNodeTick
r.profilerHistoryIndex=profilerHistoryIndex
r.profilerFrameStart=profilerFrameStart
r.profilerPaused=profilerPaused
r.profilerPause=profilerPause
r.profilerMemDepthGet=profilerMemDepthGet
r.profilerMemDepthSet=profilerMemDepthSet
r.profilerMeasureBloat=profilerMeasureBloat
r.profilerGarbageEstimate=profilerGarbageEstimate
r.profilerWalkTree=profilerWalkTree
r.profilerAvgTime=profilerAvgTime
r.profilerMaxMem=profilerMaxMem
r.profilerAvgMem=profilerAvgMem
r.profilerExport=profilerExport
r.profilerImport=profilerImport
r.profilerDump=profilerDump
r.MEM_DEPTH_DEFAULT=r.HIST_TOT=r.HIST_COMPONENTS=r.HIST_SIZE=r.HAS_MEMSIZE=void 0
var h=Boolean(window.performance&&performance.memory&&performance.memory.usedJSHeapSize)
r.HAS_MEMSIZE=h
var p=128
r.HIST_SIZE=p
var m=3
r.HIST_COMPONENTS=m
var g=p*m
r.HIST_TOT=g
var a=2
r.MEM_DEPTH_DEFAULT=a
var l=e("assert")
var i=e("./engine.js")
var c=Math.floor,E=Math.max,_=Math.min,u=Math.round
var o=e("./local_storage.js"),n=o.localStorageGetJSON,s=o.localStorageSetJSON
var d=n("profiler_open_keys",{})
var f=0
function ProfilerEntry(e,t){this.parent=e
this.depth=e?e.depth+1:0
this.next=null
this.child=null
this.name=t
this.count=0
this.time=0
this.dmem=0
this.start_time=0
this.start_mem=0
this.history=new Float32Array(g)
this.id=++f
this.show_children=!(e&&e.parent)||d[this.getKey()]||false
this.color_override=null}ProfilerEntry.prototype.isEmpty=function(){for(var e=0;e<g;e+=m)if(this.history[e])return false
return true}
ProfilerEntry.prototype.toJSON=function(){var e=this.next,t=this.child
while(e&&e.isEmpty())e=e.next
while(t&&t.isEmpty())t=t.next
var r={i:this.name,h:Array.prototype.slice.call(this.history)}
if(e)r.n=e
if(t)r.c=t
return r}
function profilerEntryFromJSON(e,t){var r=new ProfilerEntry(e,t.i)
l.equal(t.h.length,r.history.length)
for(var a=0;a<t.h.length;++a)r.history[a]=t.h[a]
if(t.n)r.next=profilerEntryFromJSON(e,t.n)
if(t.c)r.child=profilerEntryFromJSON(r,t.c)
return r}ProfilerEntry.prototype.getKey=function(){if(!this.parent)return""
else return this.parent.getKey()+"."+this.name}
ProfilerEntry.prototype.toggleShowChildren=function(){this.show_children=!this.show_children
if(this.show_children)d[this.getKey()]=1
else delete d[this.getKey()]
s("profiler_open_keys",d)}
var y=new ProfilerEntry(null,"root")
var v=new ProfilerEntry(y,"GPU/idle")
y.child=v
var T=new ProfilerEntry(y,"tick")
v.next=T
var I=y
var S=null
var A=0
var w=false
var L=a
function memSizeChrome(){return performance.memory.usedJSHeapSize}function memSizeNop(){return 0}var R=h?memSizeChrome:memSizeNop
var x=10
function profilerChildCallCount(e,t,r){var a=e.child
var i=0
while(a){if(r){var o=0
var n=0
for(var s=0;s<g;s+=m)if(!t||a.history[s+2]){n++
o+=a.history[s]}if(n)i+=u(o/n)}else if(!t||a.history[A+2])i+=a.history[A]
i+=profilerChildCallCount(a,t,r)
a=a.next}return i}var O=1e3
function profilerWarning(){var e=profilerChildCallCount(y,false,true)
if(e>O)return"Warning: Too many per-frame profilerStart() calls ("+e+" > "+O+")"
else if(!h)return"To access memory profiling, run in Chrome"
else if(L>1&&x<10)return"For precise memory profiling, launch Chrome with --enable-precise-memory-info"
return""}function profilerNodeRoot(){return y}function profilerNodeTick(){return T}function profilerHistoryIndex(){return A}var b=[0,0]
var N=[0,0,0]
function profilerFrameStart(){y.count=1
var e=performance.now()
y.time=e-y.start_time
y.start_time=e
if(L>0){var t=R()
y.dmem=t-y.start_mem
y.start_mem=t}v.count=1
v.time=y.time
v.dmem=y.dmem
for(var r=y.child;r;r=r.next){if(r===v)continue
v.time-=r.time
v.dmem-=r.dmem
if(L>1)if(r.count)if(r.dmem)x++
else x-=5}var a=0
var i=0
for(var o=y.child;o;o=o.next)if(o.dmem<0)i-=o.dmem
else a+=o.dmem
if(a>i){b[0]+=a
N[0]++}else{b[1]+=i
N[1]++}if(I!==y){console.error("Profiler starting new frame but some section was not stopped",I&&I.name)
I=y}if(!w)A=(A+m)%g
var n=y
while(n){var s=true
if(!w){n.history[A]=n.count
n.history[A+1]=n.time
n.history[A+2]=n.dmem}n.count=0
n.time=0
n.dmem=0
do{if(s&&n.child)n=n.child
else if(n.next)n=n.next
else{s=false
if(n=n.parent)continue}break}while(true)}}function profilerStart(e){var t
if(S&&S.name===e)t=S
else if(S&&S.next&&S.next.name===e)t=S.next
else{var r=null
for(t=I.child;t;t=(r=t).next)if(t.name===e)break
if(!t)if(!r){l(!I.child)
t=new ProfilerEntry(I,e)
I.child=t}else if(S){(t=new ProfilerEntry(I,e)).next=S.next
S.next=t}else{t=new ProfilerEntry(I,e)
r.next=t}}l(t.parent===I);(I=t).start_time=performance.now()
if(t.depth<L)t.start_mem=R()
S=null}function profilerStop(e){if(e)l.equal(e,I.name)
I.time+=performance.now()-I.start_time
if(I.depth<L)I.dmem+=R()-I.start_mem
I.count++
I=(S=I).parent}function profilerStopStart(e){profilerStop(null)
profilerStart(e)}if(window.performance&&window.performance.now){window.profilerStart=profilerStart
window.profilerStop=profilerStop
window.profilerStopStart=profilerStopStart}function profilerPaused(){return w}function profilerPause(e){w=e}function profilerMemDepthGet(){return L}function profilerMemDepthSet(e){L=e}var C={time:0,mem:0}
var M={time:0,mem:0}
var D={inner:C,outer:M}
var P="profilerMeasureBloat"
var k="profilerMeasureBloat:child"
var B=10
function profilerMeasureBloat(){var e=L
if(L>=2)L=Infinity
profilerStart(P)
profilerStart(k)
profilerStopStart(k)
profilerStopStart(k)
profilerStopStart(k)
profilerStop(k)
profilerStop(P)
L=e
var t=null
for(t=I.child;t.name!==P;t=t.next);var r=t.child
l.equal(r.name,k)
C.time=Infinity
C.mem=0
M.time=Infinity
var a=M.mem=0
var i=(A-m*(B-1)+g)%g
for(var o=0;o<B;o++){var n=(i+o*m)%g
C.time=_(C.time,r.history[n+1])
M.time=_(M.time,t.history[n+1])
if(r.history[n+2]>0&&t.history[n+2]>0){C.mem+=r.history[n+2]
M.mem+=t.history[n+2];++a}}C.time/=4
M.time=E(0,M.time-C.time)/4
var s=C.mem/a/4
M.mem=a?E(0,c((M.mem/a-s)/4)):0
C.mem=a?E(0,c(s)):0
return D}function profilerGarbageEstimate(){var e
if(N[0]>N[1])e=b[0]/N[0]
else e=b[1]/N[1]
N[0]=N[1]=0
b[0]=b[1]=0
return e}function profilerWalkTree(e,t){var r=0
var a=e
while(a){var i=true
if(a!==e)if(!t(a,r))i=false
do{if(i&&a.child){r++
a=a.child}else if(a.next)a=a.next
else{r--
i=false
if(a=a.parent)continue}break}while(true)}}function profilerAvgTime(e){var t=0
for(var r=0;r<g;r+=m)if(e.history[r])t+=e.history[r+1]
return t/p}function profilerMaxMem(e){var t=0
for(var r=0;r<g;r+=m)if(e.history[r])t=E(t,e.history[r+2])
return t}function profilerAvgMem(e){var t=0
var r=0
for(var a=0;a<g;a+=m)if(e.history[a]){var i=e.history[a+2]
if(i>=0){t+=i
r++}}if(r)t/=r
return t}function profilerExport(){var e={history_index:A,root:y,mem_depth:h?L:0,device:{ua:window.navigator.userAgent,vendor:gl.getParameter(gl.VENDOR),renderer:gl.getParameter(gl.RENDERER),webgl:i.webgl2?2:1,width:i.width,height:i.height}}
var t=gl.getExtension("WEBGL_debug_renderer_info")
if(t){e.device.renderer_unmasked=gl.getParameter(t.UNMASKED_RENDERER_WEBGL)
e.device.vendor_unmasked=gl.getParameter(t.UNMASKED_VENDOR_WEBGL)}var r=JSON.stringify(e)
return r.replace(/\d\.\d\d\d\d+/g,function(e){e=e[5]>"4"?e.slice(0,4)+(Number(e[4])+1):e.slice(0,5)
while("0"===e.slice(-1)||"."===e.slice(-1))e=e.slice(0,-1)
return e})}function profilerImport(e){var t
try{t=JSON.parse(e)}catch(e){}if(!t)return null
t.root=profilerEntryFromJSON(null,t.root)
return t}function profilerDump(){l(I===y)
var f=["","","# PROFILER RESULTS"]
var v=profilerAvgTime(y)
profilerWalkTree(y,function(e,t){var r=0
var a=0
var i=0
var o=0
var n=0
for(var s=0;s<g;s+=m)if(e.history[s]){o++
a+=e.history[s]
r+=e.history[s+1]
i=E(i,e.history[s+1])
n=E(n,e.history[s+2])}if(!a)return true
var l=r/p/v
var c=r/o
var _=(a/o).toFixed(0)
var u=""
for(var d=1;d<t;++d)u+="* "
u+=(100*l).toFixed(0)+"% "+e.name+" "
u+=(1e3*c).toFixed(0)+" ("+_+") max:"+(1e3*i).toFixed(0)
if(h)u+=" dmem:"+n
f.push(u)
return true})
var e=profilerWarning()
if(e)f.push("",e)
f.push("","")
console.log(f.join("\n"))}window.profilerDump=profilerDump},{"./engine.js":250,"./local_storage.js":274,assert:void 0}],286:[function(e,t,r){"use strict"
r.profilerUIStartup=profilerUIStartup
r.profilerUI=profilerUI
var g=e("./camera2d.js")
var a=e("./cmds.js").cmd_parse
var C=e("./engine.js")
var i=e("./font.js").style
var M=e("./input.js")
var E=Math.floor,D=Math.max,P=Math.min,k=Math.round
var o=e("./net.js"),n=o.netClient,s=o.netDisconnected
var B=e("./ui.js")
var l=e("./perf.js"),c=l.perfGraphOverride,U=l.friendlyBytes
var _=e("./profiler.js"),G=_.HIST_SIZE,F=_.HIST_COMPONENTS,W=_.HIST_TOT,y=_.HAS_MEMSIZE,T=_.MEM_DEPTH_DEFAULT,j=_.profilerAvgTime,I=_.profilerChildCallCount,u=_.profilerImport,S=_.profilerExport,A=_.profilerHistoryIndex,w=_.profilerAvgMem,L=_.profilerMaxMem,R=_.profilerMeasureBloat,x=_.profilerMemDepthGet,O=_.profilerMemDepthSet,d=_.profilerNodeTick,f=_.profilerNodeRoot,b=_.profilerPause,N=_.profilerPaused,H=_.profilerWalkTree,z=_.profilerWarning
var V=e("./settings.js")
var v=e("./sprites.js"),Y=v.spriteChainedStart,q=v.spriteChainedStop
var K=e("../common/util.js").lerp
var h=e("../common/vmath.js"),p=h.vec2,m=h.vec4
Z.PROFILER=Z.PROFILER||9950
var X=m(.5,.5,1,1)
var Q=null
var J
var $
function useNewRoot(e){if(J=($=e).child)J.color_override=X}function useSavedProfile(e){var t=u(e)
if(!t){B.modalDialog({title:"Error loading profile",text:e||"No data",buttons:{Ok:null}})
return}useNewRoot(t.root)
Q=t}function useLiveProfile(){useNewRoot(f())
Q=null}function profilerToggle(e,t){useLiveProfile()
if("1"===e)V.set("show_profiler",1)
else if("0"===e){V.set("show_profiler",0)
O(T)}else if(V.show_profiler)if(N())b(false)
else{V.set("show_profiler",0)
O(T)}else{V.set("show_profiler",1)
b(true)}if(t)t()}var ee=C.DEBUG?void 0:["hidden"]
a.register({cmd:"profiler_toggle",help:"Show or toggle profiler visibility",access_show:ee,func:profilerToggle})
var te=["% of user","% of parent","% of frame","% of mem"]
V.register({show_profiler:{default_value:0,type:a.TYPE_INT,range:[0,1],access_show:ee},profiler_average:{default_value:1,type:a.TYPE_INT,range:[0,2],access_show:["hidden"]},profiler_relative:{default_value:1,type:a.TYPE_INT,range:[0,te.length-1],access_show:["hidden"]},profiler_interactable:{default_value:1,type:a.TYPE_INT,range:[0,1],access_show:["hidden"]},profiler_graph:{default_value:0,type:a.TYPE_INT,range:[0,1],access_show:["hidden"]},profiler_mem_depth:{default_value:T,type:a.TYPE_INT,range:[0,100],access_show:["hidden"]},profiler_hide_bloat:{default_value:1,type:a.TYPE_INT,range:[0,1],access_show:ee}})
var re
var ae
var ie=i(null,{color:4286545919})
var oe=i(null,{color:4294955263})
var ne=i(null,{color:4294955263})
var se=i(null,{color:3506438143})
var le=i(null,{color:3506426111})
var ce=i(null,{color:4294967295,outline_width:.8,outline_color:4294967295})
var _e=i(null,{color:4294967295,outline_width:1,outline_color:128})
var ue=22
var de=24
var fe=(de-ue)/2
var ve
var he
var pe
var me
var ge=Z.PROFILER
var Ee=Z.PROFILER+1
var ye=Z.PROFILER+2
var Te=Z.PROFILER+3
var Ie=Z.PROFILER+4
var Se=Z.PROFILER+5
var Ae=58
var we=56
var Le=120
var Re=["Profiler","µs (count)","max","GC / Δmem"]
var xe=[400,Ae+4+we,Ae,Le]
var Oe=[]
var be
for(var Ne=Oe[0]=0;Ne<xe.length;++Ne)Oe[Ne+1]=Oe[Ne]+xe[Ne]+4
var Ce=Oe[xe.length]
var Me=Oe[xe.length-1]
var De=m(0,.25,0,.85)
var Pe=m(0,0,0,.85)
var ke=m(.2,.2,.2,.85)
var Be=m(.3,.3,.3,.85)
var Ue=m(0,0,.5,.85)
var Ge=m(.2,.2,.7,.85)
var Fe=m(0,0,.3,.85)
var We=m(.2,.2,.4,.85)
var je=m(1,1,.5,1)
var He=m(0,0,0,.5)
var ze=16
var Ve=4096
var Ye
var qe
var Ke
var Ze
var Xe
var Qe
var Je
var $e
var et
var tt
var rt={}
var at
var it
var ot=0
var nt={history_size:G,num_lines:2,data:{history:new Float32Array(2*G),index:0},line_scale_top:ze,bars_stack:true,colors:[m(.5,1,.5,1),X]}
var st
var lt={x:0,peek:true,h:de}
function profilerShowEntryEarly(e,t){if(0===V.profiler_relative&&e===J)return false
var r=0
for(var a=0;a<W;a+=F)r+=e.history[a]
if(!r)return true
lt.y=ae
lt.w=et
if(M.mouseOver(lt)){rt[(at=e).id]=1
for(var i=e.parent;i;i=i.parent)rt[i.id]=2}ae+=de
if(!e.show_children)return false
return true}function hasActiveChildren(e){if(!(e=e.child))return false
while(e){for(var t=0;t<W;t+=F)if(e.history[t])return true
e=e.next}return false}function childMemCallCount(e,t){var r=e.child
var a=0
while(r){if(r.history[t+2])a+=r.history[t]
a+=childMemCallCount(r,t)
r=r.next}return a}function nodeMemValue(e,t){var r=e.history[t]
var a=e.history[t+2]
if(tt&&V.profiler_hide_bloat&&a>0)a=D(0,a-r*st.inner.mem-childMemCallCount(e,t)*st.outer.mem)
return a}var ct={x:0,h:de}
function profilerShowEntry(e,t){if(0===V.profiler_relative&&e===J)return false
var r=0
var a=0
var i=0
var o=0
var n=Infinity
var s=-Infinity
var l=0
var c=0
for(var _=0;_<W;_+=F)if(e.history[_]){o++
a+=e.history[_]
r+=e.history[_+1]
i=D(i,e.history[_+1])
var u=nodeMemValue(e,_)
ot=D(ot,u)
n=P(n,u)
s=D(s,u)
if(u>=0){l+=u;++c}}if(!a)return true
if(c)l=k(l/c)
var d=1===rt[e.id]
var f=2===rt[e.id]
if($e){ct.y=ae
ct.w=et
var v=M.click(ct)
if(v)if(1===v.button)e.parent.toggleShowChildren()
else e.toggleShowChildren()}profilerStart("bar graph")
Y()
var h=d?Ue:f?Fe:Pe
var p=d?Ge:f?We:ke
if(!C.defines.NORECTS)B.drawRect4Color(0,ae,et,ae+de,ge,h,h,p,p)
var m=be
var g=1+V.profiler_graph
var E=V.profiler_graph?Ve:ze
for(var y=0;y<G;++y){var T=e.history[(Je+(y+1)*F)%W+g]
if(T>0){var I=T/E
var S=P(I*de,de)
if(I<1){je[0]=I
je[1]=1}else{je[0]=1
je[1]=D(0,2-I)}var A=e.color_override||je
if(!C.defines.NORECTS){var w=B.drawRect(m+y*me,ae+de-S,m+(y+1)*me,ae+de,Ee,A)
w.x=w.y=0}}}q()
profilerStop("bar graph")
ae+=fe
var L
if(hasActiveChildren(e))if(!e.show_children)L="▶"
else L="▼"
var R=0
if(1===V.profiler_relative){if(e.parent)if(Qe)R=r/G/j(e.parent)
else R=e.history[Ze]?e.history[Ze]/e.parent.history[Ze]:0}else if(3===V.profiler_relative)if(2===Qe)R=s/qe
else if(Qe)R=l/qe
else R=e.history[Xe]/qe
else if(Qe)R=r/G/Ye
else R=e.history[Ze]/Ye
m=t*ue
if(L)re.drawSized(null,m-16,ae,ye,ue,L)
m+=2*ue
re.drawSizedAligned(ne,m,ae+pe,Ie,he,re.ALIGN.HRIGHT,0,0,(100*R).toFixed(0)+"%")
re.drawSized(_e,m+=4,ae,Te,ue,e.name)
m=Oe[1]
var x=Qe?r/o:e.history[Ze]
var O=Qe?(a/o).toFixed(0):e.history[Ke]
re.drawSizedAligned(se,m,ae+pe,Se,he,re.ALIGN.HRIGHT,Ae,0,(1e3*x).toFixed(0))
m+=Ae+4
re.drawSizedAligned(oe,m,ae+pe,Ie,he,re.ALIGN.HFIT,we,0,"("+O+")")
m=Oe[2]
var b=.25*i>r/o&&i>500
re.drawSizedAligned(b?ie:se,m,ae+pe,Se,he,re.ALIGN.HRIGHT,xe[2],0,(1e3*i).toFixed(0))
if(tt){m=Oe[3]
var N=2===Qe?s:Qe?l:nodeMemValue(e,Ke)
if(n<0){re.drawSizedAligned(ie,m,ae+pe,Se,he,re.ALIGN.HLEFT|re.ALIGN.HFIT,Le/2,0,""+U(-n))
re.drawSizedAligned(le,m+Le/2,ae+pe,Se,he,re.ALIGN.HRIGHT|re.ALIGN.HFIT,Le/2,0,""+N)}else re.drawSizedAligned(le,m,ae+pe,Se,he,re.ALIGN.HRIGHT,Le,0,""+N)}ae+=ue+fe
if(!e.show_children)return false
return true}function doZoomedGraph(){if(V.profiler_graph){nt.line_scale_top=Ve
if(!at)at=d()}else if(!at||at===J)nt.line_scale_top=2*ze
else nt.line_scale_top=ze
var e=1+V.profiler_graph
if(at){var t=at
for(var r=0;r<G;++r){nt.data.history[2*r]=t.history[r*F+e]
nt.data.history[2*r+1]=0}}else for(var a=0;a<G;++a){var i=a*F+e
nt.data.history[2*a]=$.history[i]-J.history[i]
nt.data.history[2*a+1]=J.history[i]}nt.data.index=Je/F
c(nt)}var _t=140
var ut=48
var dt=24
var ft=p()
var vt={inner:{time:0,mem:0},outer:{time:0,mem:0}}
var ht
var pt
var mt
var gt
var Et
var yt
var Tt
var It
var St
var At
var wt
var Lt
var Rt
function buttonInit(){var e=Z.PROFILER+10
ht={x:et,y:ae=0,z:e,w:_t,h:ut,font_height:dt}
pt={x:et+_t,y:ae,z:e,w:ut,h:ut,font_height:dt,text:"X"}
mt={x:et,y:ae+=ut,z:e,w:_t,h:ut,font_height:dt}
gt={x:et,y:ae+=ut,z:e,w:_t,h:ut,font_height:dt}
Et={x:et,y:ae+=ut,z:e,w:_t,h:ut,font_height:dt}
yt={x:et,y:ae+=ut,z:e,w:_t,h:ut,font_height:dt}
ae+=ut
Tt={x:et,y:ae+=de,z:e,w:_t/3,h:ut,font_height:dt,text:"-"}
It={x:et+_t/3,y:ae,z:e,w:_t/3,h:ut,font_height:dt}
St={x:et+2*_t/3,y:ae,z:e,w:_t/3,h:ut,font_height:dt,text:"+"}
At={x:et,y:ae+=ut,z:e,w:_t,h:ut,font_height:dt}
ae+=ut
wt={x:et,y:ae+=de,z:e,w:_t/2,h:ut,font_height:dt,text:"save"}
Lt={x:et+_t/2,y:ae,z:e,w:_t/2,h:ut,font_height:dt,text:"load"}}function profilerUIRun(){profilerStart("profilerUIRun")
profilerStart("top+buttons")
st=vt
if(!Q&&V.profiler_hide_bloat)st=R()
if(C.render_width){var e=ue/B.font_height
g.set(0,0,e*C.render_width,e*C.render_height)
ve=1
me=e}else{g.setScreen(true)
ve=.9
me=2}be=Oe[1]-G*me
pe=(ue-(he=ue*ve))/2
if(x()!==V.profiler_mem_depth)O(V.profiler_mem_depth)
if(Q){Je=Q.history_index
tt=Q.mem_depth>0}else{Je=A()
tt=y}et=tt?Ce:Me
if(!ht||et!==Rt){Rt=et
buttonInit()}var t=Z.PROFILER+10
ae=0
var r=et
ht.text=V.profiler_interactable?"interactable":"overlay"
if(B.buttonText(ht))V.set("profiler_interactable",1-V.profiler_interactable)
if(($e=V.profiler_interactable)&&B.buttonText(pt))V.set("show_profiler",0)
ae+=ut
var a=Q?"loaded":N()?"paused":"live"
if($e){mt.text=a
if(B.buttonText(mt))if(Q)useLiveProfile()
else b(!N())}else re.drawSizedAligned(null,r,ae,t,ue,re.ALIGN.HVCENTERFIT,_t,ut,a)
ae+=ut
if($e){gt.text=te[V.profiler_relative]
if(B.buttonText(gt))V.set("profiler_relative",(V.profiler_relative+1)%te.length)}else re.drawSizedAligned(null,r,ae,t,ue,re.ALIGN.HVCENTERFIT,_t,ut,te[V.profiler_relative])
ae+=ut
a=2===V.profiler_average?"max":V.profiler_average?"average":"last frame"
if($e){Et.text=a
if(B.buttonText(Et)){var i=y?3:2
V.set("profiler_average",(V.profiler_average+1)%i)}}else re.drawSizedAligned(null,r,ae,t,ue,re.ALIGN.HVCENTERFIT,_t,ut,a)
ae+=ut
a=V.profiler_graph?"graph: mem":"graph: CPU"
if($e){yt.text=a
if(B.buttonText(yt))V.set("profiler_graph",1-V.profiler_graph)}else re.drawSizedAligned(null,r,ae,t,ue,re.ALIGN.HVCENTERFIT,_t,ut,a)
ae+=ut
if(Q?true:y){var o=Q?Q.mem_depth:x()
re.drawSizedAligned(null,r,ae,t,ue,re.ALIGN.HVCENTERFIT,_t,de,"Mem Depth")
ae+=de
a=""+(o||"OFF")
if($e){Tt.disabled=Q||0===o
if(B.buttonText(Tt)){O(o-1)
V.set("profiler_mem_depth",x())}It.disabled=Q
It.text=a
if(B.buttonText(It)){if(o===T)O(99)
else O(T)
V.set("profiler_mem_depth",x())}St.disabled=Q
if(B.buttonText(St)){O(o+1)
V.set("profiler_mem_depth",x())}}else re.drawSizedAligned(null,r,ae,t,ue,re.ALIGN.HVCENTERFIT,_t,ut,a)}else ae+=de
ae+=ut
a=1e3===V.max_fps?"max CPU":0===V.max_fps?"anim frame":"?"
if($e){At.text=a
if(B.buttonText(At))V.set("max_fps",0===V.max_fps?1e3:0)}else re.drawSizedAligned(null,r,ae,t,ue,re.ALIGN.HVCENTERFIT,_t,ut,a)
ae+=ut
var n=I($,false,V.profiler_average)
re.drawSizedAligned(null,r,ae,t,ue,re.ALIGN.HVCENTERFIT,_t,de,n+" calls")
ae+=de
if($e){wt.disabled=Q
if(B.buttonText(wt)){var s=document.createElement("a")
s.href="data:application/json,"+encodeURIComponent(S())
s.setAttribute("download","profile.json")
s.click()}if(B.buttonText(Lt)){var l=document.createElement("input")
l.setAttribute("type","file")
var c=new FileReader
c.onload=function(){if(2===c.readyState)useSavedProfile(c.error||c.result)}
l.onchange=function(){c.readAsText(l.files[0])}
l.click()}ae+=ut}B.drawRect(r,0,r+_t,ae,t-1,Pe)
ae=0
re.drawSizedAligned(ce,Oe[0],ae,t,ue,re.ALIGN.HLEFT,xe[0],0,Re[0])
for(var _=1;_<Re.length-(tt?0:1);++_)re.drawSizedAligned(ce,Oe[_],ae,t,ue,re.ALIGN.HCENTER,xe[_],0,Re[_])
B.drawRect(0,ae,et,ae+de,t-1,Be)
var u=ae+=de
at=null
it=-1
if($e){rt={}
H($,profilerShowEntryEarly)
if(at){if(Q||N()){var d=M.mousePos(ft)[0]-be
if((it=E(d/me))<0||it>=G)it=-1}for(var f=ot=0;f<W;f+=F)if(at.history[f])ot=D(ot,at.history[f+2])}}if(ot<.25*Ve||ot>Ve)Ve=K(.1,Ve,ot)
ot=0
Qe=V.profiler_average
Ke=Je
if(-1!==it){Qe=false
Ke=(Ke-(G-it-1)*F+W)%W}Ze=Ke+1
Xe=Ke+2
if(Qe){if(0===V.profiler_relative){Ye=0
var v=$.child
while(v){if(v!==J)Ye+=j(v)
v=v.next}Ye=D(Ye,.001)}else if(2===V.profiler_relative)Ye=j($)
else if(3===V.profiler_relative)if(2===Qe)qe=L($)
else qe=w($)}else if(0===V.profiler_relative){Ye=0
var h=$.child
while(h){if(h!==J)Ye+=h.history[Ze]
h=h.next}Ye=D(Ye,.001)}else if(2===V.profiler_relative)Ye=$.history[Ze]
else if(3===V.profiler_relative)if((qe=$.history[Xe])<0){var p=$.child
qe=0
while(p){qe+=D(0,p.history[Xe])
p=p.next}}profilerStopStart("interface")
ae=u
H($,profilerShowEntry)
var m=!Q&&z()
if(m){re.drawSizedAligned(_e,ue,ae,Te,ue,re.ALIGN.HVCENTERFIT,et-2*ue,1.5*de,m)
B.drawRect(0,ae,et,ae+1.5*de,Te-.5,De)}if(-1!==it)B.drawRect(be+it*me,u,be+(it+1)*me,ae,Ee+.5,He)
if($e)M.mouseOver({x:0,y:0,w:et,h:ae})
doZoomedGraph()
profilerStop()
profilerStop("profilerUIRun")}function profilerUIStartup(){re=B.font
useLiveProfile()}function profilerUI(){if(C.DEBUG&&M.keyUpEdge(M.KEYS.F7))profilerToggle()
if(V.show_profiler)profilerUIRun()
if(C.DEBUG||V.show_profiler);}a.register({cmd:"profile",help:"Captures a performance profile for developer investigation",prefix_usage_with_help:true,usage:"Optionally delays for DELAY seconds before capturing the profile.\nUsage: /profile [DELAY]",func:function func(e,r){function doit(){var e=S()
if(s()){B.provideUserString("Profiler Snapshot",e)
r()}else n().send("profile",e,function(e,t){if(null!=t&&t.id){B.provideUserString("Profile submitted","ID="+t.id)
r(null,"Profile submitted with ID="+t.id)}else r(e,t)})}if(Number(e))setTimeout(doit,1e3*Number(e))
else doit()}})},{"../common/util.js":330,"../common/vmath.js":332,"./camera2d.js":241,"./cmds.js":244,"./engine.js":250,"./font.js":260,"./input.js":271,"./net.js":279,"./perf.js":281,"./profiler.js":285,"./settings.js":291,"./sprites.js":302,"./ui.js":306}],287:[function(e,t,r){"use strict"
r.quat=quat
r.qiNegW=qiNegW
r.qiNormalize=qiNormalize
r.qFromAxisAngle=qFromAxisAngle
r.qFromYPR=qFromYPR
r.qRotateX=qRotateX
r.qRotateY=qRotateY
r.qRotateZ=qRotateZ
r.qSlerp=qSlerp
r.qTransformVec3=qTransformVec3
r.qMult=qMult
r.qInvert=qInvert
r.qLerp=qLerp
r.unit_quat=void 0
var a=e("../common/vmath.js"),i=a.rovec4,o=a.vec4
var m=Math.acos,v=Math.cos,g=Math.sin,n=Math.sqrt
var E=1e-6
var s=i(0,0,0,-1)
r.unit_quat=s
function quat(){return o(0,0,0,-1)}r.createQuat=quat
function qiNegW(e){if(e[3]>0){e[0]*=-1
e[1]*=-1
e[2]*=-1
e[3]*=-1}}function qiNormalize(e){var t=n(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]+e[3]*e[3])
if(0!==t){var r=1/t
e[0]*=r
e[1]*=r
e[2]*=r
e[3]*=r}qiNegW(e)}function qFromAxisAngle(e,t,r){var a=g(r*=.5)
e[0]=a*t[0]
e[1]=a*t[1]
e[2]=a*t[2]
e[3]=v(r)
qiNegW(e)
return e}function qFromYPR(e,t,r,a){var i=g(.5*r)
var o=v(.5*r)
var n=g(.5*t)
var s=v(.5*t)
var l=g(.5*a)
var c=v(.5*a)
var _=o*s
var u=i*n
var d=i*s
var f=o*n
e[0]=d*c-f*l
e[1]=u*c+_*l
e[2]=f*c+d*l
e[3]=_*c-u*l
qiNormalize(e)
return e}function qRotateX(e,t,r){var a=t[0]
var i=t[1]
var o=t[2]
var n=t[3]
var s=g(r*=.5)
var l=v(r)
e[0]=a*l+n*s
e[1]=i*l+o*s
e[2]=o*l-i*s
e[3]=n*l-a*s
return e}function qRotateY(e,t,r){var a=t[0]
var i=t[1]
var o=t[2]
var n=t[3]
var s=g(r*=.5)
var l=v(r)
e[0]=a*l-o*s
e[1]=i*l+n*s
e[2]=o*l+a*s
e[3]=n*l-i*s
return e}function qRotateZ(e,t,r){var a=t[0]
var i=t[1]
var o=t[2]
var n=t[3]
var s=g(r*=.5)
var l=v(r)
e[0]=a*l+i*s
e[1]=i*l-a*s
e[2]=o*l+n*s
e[3]=n*l-o*s
return e}function qSlerp(e,t,r,a){var i=r[0]
var o=r[1]
var n=r[2]
var s=r[3]
var l=a[0]
var c=a[1]
var _=a[2]
var u=a[3]
var d
var f
var v=i*l+o*c+n*_+s*u
if(v<0){v=-v
l=-l
c=-c
_=-_
u=-u}if(1-v>E){var h=m(v)
var p=g(h)
d=g((1-t)*h)/p
f=g(t*h)/p}else{d=1-t
f=t}e[0]=d*i+f*l
e[1]=d*o+f*c
e[2]=d*n+f*_
e[3]=d*s+f*u
return e}function qTransformVec3(e,t,r){var a=r[0]
var i=r[1]
var o=r[2]
var n=r[3]
var s=t[0]
var l=t[1]
var c=t[2]
var _=i*c-o*l
var u=o*s-a*c
var d=a*l-i*s
var f=i*d-o*u
var v=o*_-a*d
var h=a*u-i*_
var p=2*n
u*=p
d*=p
v*=2
h*=2
e[0]=s+(_*=p)+(f*=2)
e[1]=l+u+v
e[2]=c+d+h
return e}function qMult(e,t,r){var a=t[0]
var i=t[1]
var o=t[2]
var n=t[3]
var s=r[0]
var l=r[1]
var c=r[2]
var _=r[3]
e[0]=a*_+n*s+i*c-o*l
e[1]=i*_+n*l+o*s-a*c
e[2]=o*_+n*c+a*l-i*s
e[3]=n*_-a*s-i*l-o*c
return e}function qInvert(e,t){var r=t[0]
var a=t[1]
var i=t[2]
var o=t[3]
var n=r*r+a*a+i*i+o*o
var s=n?1/n:0
e[0]=-r*s
e[1]=-a*s
e[2]=-i*s
e[3]=o*s
return e}function qLerp(e,t,r,a){qiNormalize(r)
qiNormalize(a)
var i=(r[0]*a[0]+r[1]*a[1]+r[2]*a[2]+r[3]*a[3]<0?-1:1)*(1-t)
e[0]=r[0]*i+a[0]*t
e[1]=r[1]*i+a[1]*t
e[2]=r[2]*i+a[2]*t
e[3]=r[3]*i+a[3]*t
qiNormalize(e)
return e}},{"../common/vmath.js":332}],288:[function(e,t,r){"use strict"
r.randFastCreate=randFastCreate
r.randSimpleSpatial=randSimpleSpatial
function step2(e){e=e>>>0||22329833666
e^=e<<13
e^=e>>>17
e^=e<<5
e^=e<<13
return((e^=e>>>17)^e<<5)>>>0}function RandSeed2(e){this.seed=step2(e)}RandSeed2.prototype.reseed=function(e){this.seed=step2(e)}
RandSeed2.prototype.step=function(){var e=this.seed
e^=e<<13
e^=e>>>17
return(this.seed=(e^=e<<5)>>>0)-1}
RandSeed2.prototype.uint32=RandSeed2.prototype.step
RandSeed2.prototype.range=function(e){return this.step()*e*2.3283064376e-10|0}
RandSeed2.prototype.random=function(){return 2.3283064376e-10*this.step()}
RandSeed2.prototype.floatBetween=function(e,t){return e+(t-e)*this.random()}
function randFastCreate(e){return new RandSeed2(e)}var i=134775813
var o=1103515245
function randSimpleSpatial(e,t,r,a){return(((t^(r+=10327*a))*i^e+t)*(o*t<<16^o*r-i)>>>0)/4294967295}},{}],289:[function(e,t,r){"use strict"
r.scrollAreaSetPixelScale=scrollAreaSetPixelScale
r.scrollAreaCreate=scrollAreaCreate
function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]
for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))e[a]=r[a]}return e}).apply(this,arguments)}var X=e("assert")
var a=e("../common/util.js")
var Q=a.clamp
var i=a.merge
var h=e("../common/verify.js")
var o=e("../common/vmath")
var n=o.vec2
var s=o.vec4
var J=e("./camera2d.js")
var $=e("./engine.js")
var ee=e("./input.js")
var l=e("./input.js")
var te=l.BUTTON_LEFT
var c=l.KEYS
var _=l.PAD
var u=e("./spot.js")
var re=u.SPOT_DEFAULT_BUTTON
var ae=u.SPOT_STATE_DOWN
var ie=u.SPOT_STATE_FOCUSED
var oe=u.spot
var ne=u.spotPadMode
var p=u.spotSubBegin
var se=u.spotSubEnd
var le=u.spotUnfocus
var d=e("./sprites.js")
var ce=d.spriteClipPop
var m=d.spriteClipPush
var _e=e("./ui.js")
var ue=Math.max,de=Math.min,f=Math.round
var v=50
var fe=180
function darken(e,t){return s(e[0]*t,e[1]*t,e[2]*t,e[3])}var g=1
function scrollAreaSetPixelScale(e){g=e}var ve=n()
var E=0
var y=function(){function ScrollAreaInternal(e){this.id="sa:"+ ++E
this.x=0
this.y=0
this.z=Z.UI
this.w=10
this.h=10
this.rate_scroll_click=_e.font_height
this.pixel_scale=g
this.top_pad=true
this.color=s(1,1,1,1)
this.background_color=s(.4,.4,.4,1)
this.auto_scroll=false
this.auto_hide=false
this.no_disable=false
this.focusable_elem=null
this.min_dist=void 0
this.disabled=false
this.rate_scroll_wheel=void 0
this.rollover_color=void 0
this.rollover_color_light=void 0
this.disabled_color=void 0
this.scroll_pos=0
this.overscroll=0
this.overscroll_delay=0
this.grabbed_pos=0
this.grabbed=false
this.consumed_click=false
this.drag_start=null
this.began=false
this.last_internal_h=0
this.last_frame=0
this.was_disabled=false
this.scrollbar_visible=false
this.last_max_value=0
this.applyParams(e=e||{})
this.rate_scroll_wheel=e.rate_scroll_wheel||2*this.rate_scroll_click
this.rollover_color=e.rollover_color||darken(this.color,.75)
this.rollover_color_light=e.rollover_color_light||darken(this.color,.95)
X(this.rollover_color_light!==this.color)
this.disabled_color=e.disabled_color||this.rollover_color}var e=ScrollAreaInternal.prototype
e.applyParams=function applyParams(e){if(!e)return
i(this,e)}
e.barWidth=function barWidth(){var e=this.pixel_scale
return _e.sprites.scrollbar_top.uidata.total_w*e}
e.isFocused=function isFocused(){X(false,"deprecated?")
return false}
e.consumedClick=function consumedClick(){return this.consumed_click}
e.isVisible=function isVisible(){return this.scrollbar_visible}
e.begin=function begin(e){this.applyParams(e)
var t=this.x,r=this.y,a=this.w,i=this.h,o=this.z,n=this.id
h(!this.began)
this.began=true
p({x:t,y:r,w:a,h:i,key:n})
m(o+.05,t,r,a-this.barWidth(),i)
var s=J.x0()
var l=J.x1()
var c=J.y0()
var _=J.y1()
var u=-(t-s)
var d=-(r-c)+this.getScrollPos()
var f=u+l-s
var v=d+_-c
J.push()
J.set(u,d,f,v)}
e.getScrollPos=function getScrollPos(){return f(this.scroll_pos+this.overscroll)}
e.clampScrollPos=function clampScrollPos(){var e=Q(this.scroll_pos,0,this.last_max_value)
if(this.scroll_pos<0)this.overscroll=ue(this.scroll_pos,-v)
else if(this.scroll_pos>this.last_max_value)this.overscroll=de(this.scroll_pos-this.last_max_value,v)
this.scroll_pos=e}
e.keyboardScroll=function keyboardScroll(){if(this.was_disabled)return
var e=false
var t=ee.padButtonDown(_.RIGHT_TRIGGER)||ee.padButtonDown(_.LEFT_TRIGGER)
if(ee.keyDownEdge(c.PAGEDOWN)+(t?ee.padButtonDownEdge(_.DOWN):0)){this.scroll_pos=de(this.scroll_pos+this.h,this.scroll_pos===this.last_max_value?Infinity:this.last_max_value)
e=true}if(ee.keyDownEdge(c.PAGEUP)+(t?ee.padButtonDownEdge(_.UP):0)){this.scroll_pos=ue(this.scroll_pos-this.h,0===this.scroll_pos?-this.h:0)
e=true}if(e)this.clampScrollPos()}
e.end=function end(e){X(e>=0)
e=ue(e,1)
X(this.began)
this.began=false
this.consumed_click=false
var t=se()
J.pop()
ce()
if(t&&ne())this.scrollIntoFocus(t.y,t.y+t.h+1,this.h)
var r=ue(e-this.h+1,0)
if(this.scroll_pos>=r)this.scroll_pos=ue(0,r)
var a=this.scroll_pos===this.last_max_value
if(this.auto_scroll&&(this.last_frame!==$.getFrameIndex()-1||this.last_internal_h!==e&&a)){this.overscroll=ue(0,this.scroll_pos+this.overscroll-r)
this.scroll_pos=r}this.last_internal_h=e
this.last_frame=$.getFrameIndex()
if(this.overscroll){var i=$.getFrameDt()
if(i>=this.overscroll_delay){this.overscroll_delay=0
this.overscroll*=ue(1-.008*i,0)}else this.overscroll_delay-=i}var o=this.auto_hide,n=this.pixel_scale,s=this.rollover_color,l=this.rollover_color_light
var c=_e.sprites,_=c.scrollbar_top,u=c.scrollbar_bottom,d=c.scrollbar_trough,f=c.scrollbar_handle,v=c.scrollbar_handle_grabber
var h=_.uidata.total_w*n
var p=de(_.uidata.total_h*n,this.h/3)
var m=this.top_pad?p:0
var g=this.x+this.w-h
var E=this.h/e
E=Q(E,0,1)
var y=this.h>=e?0:this.scroll_pos/(e-this.h)
y=Q(y,0,1)
X(isFinite(y))
var T=E*(this.h-2*m)
var I=f.uidata.total_h*n
var S=this.h-2*p
T=ue(T,de(I,.75*S))
var A=this.y+m+y*(this.h-2*m-T)
var w=this.color
var L=this.color
var R=this.color
var x=this.color
var O=this.disabled
var b=false
if(!this.h)b=O=true
else if(1===E){b=true
if(this.no_disable)x=w=L=R=this.disabled_color
else O=true}var N=false
if(this.was_disabled=O){x=w=L=R=this.disabled_color
this.drag_start=null}else{var C=ee.mouseWheel({x:this.x,y:this.y,w:this.w,h:this.h})
if(C){this.overscroll_delay=fe
this.scroll_pos-=this.rate_scroll_wheel*C
if(t)le()}var M={x:g,y:A,w:h,h:T,button:0,spot_debug_ignore:true}
var D=ee.mouseDownEdge(M)
if(D){this.grabbed_pos=D.pos[1]-A
this.grabbed=true
R=l}if(this.grabbed)N=true
if(this.grabbed){var P=ee.mouseUpEdge({button:0})
if(P){ve[1]=P.pos[1]
this.consumed_click=true}else if(!ee.mouseDownAnywhere(0)){this.grabbed=false
this.consumed_click=true}else ee.mousePos(ve)
if(this.grabbed){var k=ve[1]-(this.y+m)-this.grabbed_pos
var B=this.h-2*m-T
if(B>0){this.scroll_pos=(e-this.h)*k/B
X(isFinite(this.scroll_pos))}R=l}}if(ee.mouseOver(M))if(R!==l)R=s
var U={x:g,y:this.y,w:h,h:p,button:te,pad_focusable:false,disabled:this.grabbed,disabled_focusable:false,def:re}
var G=_extends({},U,{y:this.y+this.h-p})
var F=oe(U)
while(F.ret){--F.ret
N=true
this.scroll_pos-=this.rate_scroll_click
this.consumed_click=true}if(F.spot_state===ae)w=l
else if(F.spot_state===ie)w=s
F=oe(G)
while(F.ret){--F.ret
N=true
this.scroll_pos+=this.rate_scroll_click
this.consumed_click=true}if(F.spot_state===ae)L=l
else if(F.spot_state===ie)L=s
var W={key:"bar_"+this.id,x:g,y:this.y,w:h,h:this.h,button:te,sound_rollover:null,pad_focusable:false,def:re}
var j=oe(W)
while(j.ret){--j.ret
this.consumed_click=N=true
if(j.pos)if(j.pos[1]>A+T/2)this.scroll_pos+=this.h
else this.scroll_pos-=this.h}var H=ee.drag({x:this.x,y:this.y,w:this.w-h,h:this.h,button:0,min_dist:this.min_dist})
if(H){if(null===this.drag_start)this.drag_start=this.scroll_pos
this.scroll_pos=this.drag_start-H.cur_pos[1]+H.start_pos[1]
this.consumed_click=true}else this.drag_start=null
ee.drag({x:this.x+this.w-h,y:this.y,w:h,h:this.h,button:0})}if(N&&this.focusable_elem)this.focusable_elem.focus()
this.last_max_value=r
this.clampScrollPos()
if(this.background_color)_e.drawRect(this.x,this.y,this.x+this.w,this.y+this.h,this.z,this.background_color)
if(O&&(o&&b||!this.h)){this.scrollbar_visible=false
return}this.scrollbar_visible=true
_.draw({x:g,y:this.y,z:this.z+.2,w:h,h:p,color:w})
u.draw({x:g,y:this.y+this.h-p,z:this.z+.2,w:h,h:p,color:L})
var z=p/2
var V=S+2*z
var Y=-z/n/d.uidata.total_h
var q=Y+V/n/d.uidata.total_h
d.draw({x:g,y:this.y+z,z:this.z+.1,w:h,h:V,uvs:[d.uvs[0],Y,d.uvs[2],q],color:x})
_e.drawVBox({x:g,y:A,z:this.z+.3,w:h,h:T},f,R)
var K=v.uidata.total_h*n
v.draw({x:g,y:A+(T-K)/2,z:this.z+.4,w:h,h:K,color:R})}
e.scrollIntoFocus=function scrollIntoFocus(e,t,r){var a=this.scroll_pos
var i=false
if((e=ue(e,0))<this.scroll_pos){this.scroll_pos=e
i=true}if((t-=r)>this.scroll_pos){this.scroll_pos=t
i=true}if(i)this.overscroll=a-this.scroll_pos}
e.scrollToEnd=function scrollToEnd(){this.scroll_pos=this.last_max_value}
e.resetScroll=function resetScroll(){this.scroll_pos=0
this.overscroll=0}
return ScrollAreaInternal}()
function scrollAreaCreate(e){return new y(e)}},{"../common/util.js":330,"../common/verify.js":331,"../common/vmath":332,"./camera2d.js":241,"./engine.js":250,"./input.js":271,"./spot.js":300,"./sprites.js":302,"./ui.js":306,assert:void 0}],290:[function(e,t,r){"use strict"
r.selboxDefaultDrawItemBackground=selboxDefaultDrawItemBackground
r.selboxDefaultDrawItemText=selboxDefaultDrawItemText
r.selboxDefaultDrawItem=selboxDefaultDrawItem
r.selectionBoxCreate=selectionBoxCreate
r.dropDownCreate=dropDownCreate
r.GlovMenuItem=r.default_display=void 0
var a
function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype)
_setPrototypeOf(e.prototype.constructor=e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){e.__proto__=t
return e})(e,t)}r.create=selectionBoxCreate
var _=e("assert")
var s=Math.max,l=Math.round,P=Math.sin
var i=e("../common/util.js")
var k=i.clamp
var o=i.cloneShallow
var u=i.easeIn
var n=i.merge
var c=e("../common/vmath.js")
var d=c.v4copy
var f=c.vec4
var w=e("./camera2d.js")
var B=e("./engine.js")
var L=e("./font.js")
var v=e("./input.js")
var R=v.KEYS
var x=v.PAD
var U=v.drag
var O=v.keyDownEdge
var b=v.mouseButtonHadUpEdge
var h=v.padButtonDown
var N=v.padButtonDownEdge
var G=e("./link.js").link
var p=e("./scroll_area.js").scrollAreaCreate
var m=e("./spot.js")
var F=m.SPOT_DEFAULT_BUTTON
var W=m.SPOT_NAV_DOWN
var j=m.SPOT_NAV_LEFT
var H=m.SPOT_NAV_RIGHT
var z=m.SPOT_NAV_UP
var V=m.SPOT_STATE_DISABLED
var Y=m.SPOT_STATE_DOWN
var q=m.SPOT_STATE_FOCUSED
var g=m.SPOT_STATE_REGULAR
var K=m.spot
var C=m.spotFocusSteal
var M=m.spotPadMode
var X=m.spotSubBegin
var Q=m.spotSubEnd
var D=m.spotSubPop
var J=m.spotSubPush
var E=e("./sprites.js")
var $=E.spriteClipPause
var ee=E.spriteClipResume
var te=E.spriteClipped
var y=e("./ui.js")
var re=y.playUISound
var ae=y.uiFontStyleFocused
var ie=y.uiFontStyleNormal
var oe=e("./ui.js")
var S=null
var T=0
var ne
var se=L.style(null,{color:3755991039})
var le=L.style(null,{color:4294967295})
var ce=L.style(null,{color:255})
var _e=L.style(null,{color:2155905279})
var A=8
var I=f(1,1,1,1)
var ue=f(1,1,1,1)
function selboxDefaultDrawItemBackground(e){e.item_idx,e.item
var t=e.x,r=e.y,a=e.z,i=e.w,o=e.h,n=e.image_set,s=e.color,l=e.image_set_extra,c=e.image_set_extra_alpha
oe.drawHBox({x:t,y:r,z:a,w:i,h:o},n,s)
if(l&&c){d(ue,s)
ue[3]*=u(c,2)
oe.drawHBox({x:t,y:r,z:a+.001,w:i,h:o},l,ue)}}function selboxDefaultDrawItemText(e){e.item_idx
var t=e.item,r=e.x,a=e.y,i=e.z,o=e.w,n=e.h,s=e.display,l=e.font_height,c=e.style
var _=i+1
var u=false
if(s.tab_stop){var d=t.name
var f=d.indexOf("\t")
if(-1!==f){u=true
var v=d.slice(0,f)
var h=d.slice(f+1)
var p=r+s.xpad
var m=r+s.xpad+s.tab_stop+A
var g=s.tab_stop
var E=o-s.tab_stop-2*s.xpad-A
if(s.use_markup){var y={}
y.align=L.ALIGN.HFIT
y.x_size=y.y_size=l
y.w=g
y.h=1
y.style=c
S.print(y,p,a,_,v)
y.w=E
S.print(y,m,a,_,h)}else{ne.drawSizedAligned(c,p,a,_,l,L.ALIGN.HFIT|L.ALIGN.VCENTER,g,n,v)
ne.drawSizedAligned(c,m,a,_,l,L.ALIGN.HFIT|L.ALIGN.VCENTER,E,n,h)}}}if(!u){var T={}
T.align=(t.centered||s.centered?L.ALIGN.HCENTERFIT:L.ALIGN.HFIT)|L.ALIGN.VCENTER
T.x_size=T.y_size=l
T.w=o-2*s.xpad
T.h=n
T.style=c
var I=r+s.xpad
if(s.use_markup)S.print(T,I,a,_,t.name)
else ne.drawSizedAligned(T.style,I,a,_,T.x_size,T.align,T.w,T.h,t.name)}}function selboxDefaultDrawItem(e){selboxDefaultDrawItemBackground(e)
selboxDefaultDrawItemText(e)}var de={style_default:se,style_selected:le,style_disabled:_e,style_down:ce,color_default:I,color_selected:I,color_disabled:I,color_down:I,draw_item_cb:selboxDefaultDrawItem,centered:false,bounce:true,tab_stop:0,xpad:8,selection_fade:Infinity,use_markup:false}
r.default_display=de
var fe=f(.5,.5,.5,1)
var ve=f(.816,.816,.816,1)
var he=((a={})[g]=I,a[Y]=ve,a[q]=ve,a[V]=fe,a)
var pe=80
var me=function GlovMenuItem(e){if((e=e||{})instanceof GlovMenuItem){for(var t in e)this[t]=e[t]
return}if("string"===typeof e)e={name:e}
this.name=e.name||"NO_NAME"
this.state=e.state||null
this.cb=e.cb||null
this.value=void 0===e.value?null:e.value
this.value_min=e.value_min||0
this.value_max=e.value_max||0
this.value_inc=e.value_inc||0
this.href=e.href||null
this.tag=e.tag||null
this.style=e.style||null
this.exit=Boolean(e.exit)
this.prompt_int=Boolean(e.prompt_int)
this.prompt_string=Boolean(e.prompt_string)
this.no_sound=Boolean(e.no_sound)
this.slider=Boolean(e.slider)
this.no_controller_exit=Boolean(e.no_controller_exit)
this.plus_minus=Boolean(e.plus_minus)
this.disabled=Boolean(e.disabled)
this.centered=Boolean(e.centered)
this.auto_focus=Boolean(e.auto_focus)
this.selection_alpha=0}
r.GlovMenuItem=me
var ge=function(){function SelectionBoxBase(e){_(!e.auto_unfocus,"Old parameter: auto_unfocus")
this.key="dd"+ ++T
this.x=0
this.y=0
this.z=Z.UI
this.width=oe.button_width
this.items=[]
this.disabled=false
this.display=o(de)
this.scroll_height=0
this.font_height=oe.font_height
this.entry_height=oe.button_height
this.auto_reset=true
this.reset_selection=false
this.initial_selection=0
this.show_as_focused=-1
this.applyParams(e)
this.selected=0
this.was_clicked=false
this.was_right_clicked=false
this.is_focused=false
this.expected_frame_index=0
this.ctx={}
if(this.is_dropdown||this.scroll_height)this.sa=p({})}var e=SelectionBoxBase.prototype
e.applyParams=function applyParams(e){if(!e)return
for(var t in e)if("items"===t)this.items=e.items.map(function(e){return new me(e)})
else if("display"===t)n(this.display,e[t])
else this[t]=e[t]}
e.isSelected=function isSelected(e){if("number"===typeof e)return this.selected===e
return this.items[this.selected].tag===e}
e.getSelected=function getSelected(){return this.items[this.selected]}
e.handleInitialSelection=function handleInitialSelection(){var e=this.auto_reset
if(this.reset_selection||e&&this.expected_frame_index!==B.getFrameIndex()){this.reset_selection=false
if(this.items[this.initial_selection]&&!this.items[this.initial_selection].disabled)this.selected=this.initial_selection
else for(var t=0;t<this.items.length;++t)if(!this.items[t].disabled){this.selected=t
break}}}
e.runPrep=function runPrep(e){var t=this.ctx,r=this.entry_height,a=this.is_dropdown
this.was_clicked=false
this.was_right_clicked=false
var i=0
var o=-1
var n=-1
for(var s=0;s<this.items.length;++s)if(!this.items[s].disabled){if(-1===o)o=s
i++
n=s}var l=this.scroll_height
if(!l&&a)l=w.y1()-(e+r)
t.first_non_disabled_selection=o
t.last_non_disabled_selection=n
t.num_non_disabled_selections=i
t.list_visible=!a||this.dropdown_visible
t.scroll_height=l}
e.selectWalk=function selectWalk(e,t){var r=this.ctx,a=this.selected,i=this.key
var o=r.num_non_disabled_selections,n=r.first_non_disabled_selection,s=r.last_non_disabled_selection,l=r.list_visible
if(!o)this.selected=0
else if(e>=s)this.selected=s
else if(e<=n)this.selected=n
else{while(this.items[e].disabled)e+=t
this.selected=e}if(this.selected!==a)if(l)C({key:i+"_"+this.selected})
else this.was_clicked=true}
e.selectForward=function selectForward(e){this.selectWalk(e,1)}
e.selectBackward=function selectBackward(e){this.selectWalk(e,-1)}
e.doPadMovement=function doPadMovement(){var e=this.ctx,t=this.entry_height
var r=e.list_visible,a=e.scroll_height
var i=l(s(a-1,0)/t)
if(!r)i=1
if(i){var o=h(x.RIGHT_TRIGGER)||h(x.LEFT_TRIGGER)
var n=O(R.PAGEDOWN)+(o?N(x.DOWN):0)
if(n){re("rollover")
this.selectForward(this.selected+i*n)}if(n=O(R.PAGEUP)+(o?N(x.UP):0)){re("rollover")
this.selectBackward(this.selected-i*n)}}if(O(R.HOME)){re("rollover")
this.selectForward(0)}if(O(R.END)){re("rollover")
this.selectBackward(Infinity)}}
e.doList=function doList(e,t,r,a,i){var o=this.ctx,n=this.disabled,s=this.display,l=this.entry_height,c=this.font_height,_=this.key,u=this.selected,d=this.show_as_focused,f=this.width
var v=o.scroll_height
var h=f
var p=t
if(a){this.sa.begin({x:e,y:t,z:r,w:f,h:v})
e=t=0
h=f-this.sa.barWidth()}else if(this.is_dropdown)X({key:_,x:e,y:t,z:r,w:f,h:v||l})
var m=B.getFrameDt()
var g=false
var E=o.first_non_disabled_selection,y=o.last_non_disabled_selection
for(var T=0;T<this.items.length;T++){var I
var S=this.items[T]
var A=S.disabled
var w=null
var L=null
var R=0
if(S.href)G({x:e,y:t,w:f,h:l,url:S.href})
var x={def:F,key:_+"_"+T,disabled:n||A,disabled_focusable:false,x:e,y:t,w:f,h:l,custom_nav:((I={})[H]=null,I[j]=null,I),auto_focus:S.auto_focus}
if(T===E&&this.nav_loop)x.custom_nav[z]=_+"_"+y
if(T===y&&this.nav_loop)x.custom_nav[W]=_+"_"+E
var O=K(x)
if(T===d){O.focused=true
O.spot_state=q}var b=O.focused||O.spot_state===Y
g=g||b
if(S.slider||S.plus_minus)if(O.nav===j){O.nav=H
O.button=2}if(O.nav===H){re("button_click")
O.spot_state=Y
O.ret=true}if(O.ret){this.was_clicked=true
this.was_right_clicked=2===O.button
this.selected=T
this.onListSelect()}var N=false
if(b){this.selected=T
if(!this.is_dropdown&&s.bounce)if(this.selected!==u){N=true
this.bounce_time=pe}else if(m>=this.bounce_time)this.bounce_time=0
else{N=true
this.bounce_time-=m}}if(O.nav===j){this.selected=i
this.onListSelect()}var C=void 0
var M=void 0
if(O.spot_state===Y||O.spot_state===q){M=s.style_selected||le
C=s.color_selected||de.color_selected
S.selection_alpha=k(S.selection_alpha+m*s.selection_fade,0,1)
if(1===S.selection_alpha)w=oe.sprites.menu_selected
else{w=oe.sprites.menu_entry
L=oe.sprites.menu_selected
R=S.selection_alpha}if(O.spot_state===Y)if(oe.sprites.menu_down){w=oe.sprites.menu_down
if(s.style_down){M=s.style_down
C=s.color_down||de.color_down}}else{M=s.style_down||ce
C=s.color_down||de.color_down}}else{S.selection_alpha=k(S.selection_alpha-m*s.selection_fade,0,1)
if(1!==S.selection_alpha){L=oe.sprites.menu_selected
R=S.selection_alpha}if(O.spot_state===V){M=s.style_disabled||_e
C=s.color_disabled||de.color_disabled
w=oe.sprites.menu_entry}else{M=S.style||s.style_default||se
C=s.color_default||de.color_default
w=oe.sprites.menu_entry}}var D=0
if(N)D=-4*P(20*this.bounce_time/pe/10)*l/32
s.draw_item_cb({item_idx:T,item:S,x:e,y:t+D,z:r+1,w:h,h:l,image_set:w,color:C,image_set_extra:L,image_set_extra_alpha:R,font_height:c,display:s,style:M})
if(O.ret&&S.href)window.location.href=S.href
t+=l}o.scroll_area_consumed_click=false
if(a){this.sa.end(t)
o.scroll_area_consumed_click=this.sa.consumedClick()
t=p+v}else if(this.is_dropdown){U({x:e,y:p,w:f,h:t-p})
Q()}o.any_focused=g
return t}
return SelectionBoxBase}()
var Ee=function(r){_inheritsLoose(GlovSelectionBox,r)
function GlovSelectionBox(e){var t
_(!e.is_dropdown,"Use dropDownCreate() instead");(t=r.call(this,e)||this).bounce_time=0
return t}var e=GlovSelectionBox.prototype
e.getHeight=function getHeight(){var e=this.entry_height
var t=this.items.length*e
if(this.scroll_height&&this.items.length*e>this.scroll_height)t=this.scroll_height
return t+2+3}
e.focus=function focus(){_(false,"deprecated?")
var e=this.key
C({key:e+"_0"})}
e.onListSelect=function onListSelect(){}
e.run=function run(e){this.applyParams(e)
var t=this.x,r=this.y,a=this.z,i=this.entry_height,o=this.ctx
this.handleInitialSelection()
var n=r
var s
this.runPrep(r)
var l=o.scroll_height
var c=l&&this.items.length*i>l
r=this.doList(t,r,a,c,this.selected)
if(o.any_focused)this.doPadMovement()
this.expected_frame_index=B.getFrameIndex()+1
t=10
s=r+=5
_.equal(s-n,this.getHeight())
return s-n}
return GlovSelectionBox}(ge)
Ee.prototype.is_dropdown=false
Ee.prototype.nav_loop=false
var ye=function(r){_inheritsLoose(GlovDropDown,r)
function GlovDropDown(e){var t
_(!e.is_dropdown,"Old parameter: is_dropdown");(t=r.call(this,e)||this).dropdown_visible=false
t.last_selected=void 0
return t}var e=GlovDropDown.prototype
e.focus=function focus(){_(false,"deprecated?")
C(this)
this.is_focused=true}
e.onListSelect=function onListSelect(){this.dropdown_visible=false
C(this)}
e.run=function run(e){var t
this.applyParams(e)
var r=this.x,a=this.y,i=this.z,o=this.width,n=this.font_height,s=this.entry_height,l=this.disabled,c=this.key,_=this.display,u=this.ctx
this.handleInitialSelection()
if(void 0!==this.last_selected&&(this.last_selected>=this.items.length||this.items[this.last_selected].disabled))this.last_selected=void 0
var d=a
var f
this.runPrep(a)
var v=u.first_non_disabled_selection,h=u.list_visible,p=u.scroll_height
var m={key:c,disabled:l,x:r,y:a,z:i+2-.1,w:o,h:s,def:F,custom_nav:((t={})[H]=null,t)}
u.root_spot_rect=m
if(this.dropdown_visible){m.custom_nav[j]=null
m.custom_nav[W]=c+"_"+v}var g=K(m)
this.is_focused=g.focused
if(g.kb_focused||h)this.doPadMovement()
this.selectForward(this.selected)
var E=this.dropdown_visible&&void 0!==this.last_selected?this.last_selected:this.selected
if(this.dropdown_visible&&(O(R.ESC)||N(x.B))){this.selected=E
this.onListSelect()}if(g.ret||g.nav){if(g.nav)re("button_click")
if(this.dropdown_visible){this.selected=E
this.dropdown_visible=false}else{this.dropdown_visible=true
this.last_selected=this.selected
if(M())C({key:c+"_"+this.selected})}}oe.drawHBox({x:r,y:a,z:i+1,w:o,h:s},oe.sprites.menu_header,he[g.spot_state])
var y=(_.centered?L.ALIGN.HCENTER:L.ALIGN.HLEFT)|L.ALIGN.HFIT|L.ALIGN.VCENTER
ne.drawSizedAligned(g.focused?ae():ie(),r+_.xpad,a,i+2,n,y,o-_.xpad-oe.sprites.menu_header.uidata.wh[2]*s,s,this.items[E].name)
f=(a+=s)+2
if(this.dropdown_visible){i+=1e3
var T=te()
if(T)$()
J()
var I=p&&this.items.length*s>p
if(!I&&a+this.items.length*s>=w.y1())a=w.y1()-this.items.length*s
this.doList(r,a,i,I,E)
if(this.was_clicked)this.dropdown_visible=false
D()
if(T)ee()
var S=u.any_focused,A=u.scroll_area_consumed_click
if(g.ret||this.was_clicked)S=true
this.is_focused=this.is_focused||S
if(!S)this.selected=E
if(!S&&!g.focused&&!A)if(b()||M()){this.selected=E
this.dropdown_visible=false}}this.expected_frame_index=B.getFrameIndex()+1
return f-d}
return GlovDropDown}(ge)
ye.prototype.is_dropdown=true
ye.prototype.nav_loop=true
function selectionBoxCreate(e){if(!ne)ne=oe.font
return new Ee(e)}function dropDownCreate(e){if(!ne)ne=oe.font
return new ye(e)}},{"../common/util.js":330,"../common/vmath.js":332,"./camera2d.js":241,"./engine.js":250,"./font.js":260,"./input.js":271,"./link.js":273,"./scroll_area.js":289,"./spot.js":300,"./sprites.js":302,"./ui.js":306,assert:void 0}],291:[function(e,t,a){"use strict"
a.get=get
a.set=set
a.setAsync=setAsync
a.runTimeDefault=runTimeDefault
a.push=push
a.pop=pop
a.register=register
var i={}
a.true=true
var o=e("assert")
var n=e("../common/util.js").titleCase
var s=e("./cmds.js").cmd_parse
var r=e("./engine.js")
var l={}
function get(e){return a[e]}function set(e,t){if(a[e]!==t)s.handle(null,e+" "+t,null)}function setAsync(e,t){r.postTick({fn:set.bind(null,e,t)})}function runTimeDefault(e,t){o(!l[e])
if(!i[e])a[e]=t}var c=null
function push(e){o(!c)
c={}
for(var t in e){c[t]=a[t]
a[t]=e[t]
var r=l[t]
if(r)r(false)}}function pop(){o(c)
for(var e in c){a[e]=c[e]
var t=l[e]
if(t)t(false)}c=null}function register(r){Object.keys(r).forEach(function(t){var e=r[t]
a[t]=e.default_value
if(e.on_change)l[t]=e.on_change
s.registerValue(t,{type:e.type,label:e.label||n(t.replace(/_/g," ")),range:e.range,get:function get(){return a[t]},set:function set(e){i[t]=true
a[t]=e},store:false!==e.store,ver:e.ver,help:e.help,usage:e.usage,prefix_usage_with_help:e.prefix_usage_with_help,on_change:e.on_change,access_run:e.access_run,access_show:e.access_show,default_value:e.default_value})})}register({max_fps:{label:"Maximum frame rate (FPS)",prefix_usage_with_help:true,usage:"Display current maximum: /max_fps\nDisable maximum FPS limit: /max_fps 0 (highly recommended)\nSet maximum FPS limit: /max_fps 30\nDefault: /max_fps 0",default_value:0,type:s.TYPE_FLOAT,ver:1},render_scale:{label:"Render Scale (3D)",default_value:1,type:s.TYPE_FLOAT,range:[.1,1]},render_scale_mode:{label:"Render Scale Mode",default_value:0,type:s.TYPE_INT,range:[0,2]},render_scale_all:{label:"Render Scale (All)",default_value:1,type:s.TYPE_FLOAT,range:[.3333,4]},render_scale_clear:{label:"Render Scale Full Clear",default_value:1,type:s.TYPE_INT,range:[0,1]},fov:{default_value:60,type:s.TYPE_FLOAT,range:[1,100]},double_click_time:{default_value:500,type:s.TYPE_INT,range:[0,2500]}})},{"../common/util.js":330,"./cmds.js":244,"./engine.js":250,assert:void 0}],292:[function(e,t,r){"use strict"
r.shaderDebugUIStartup=shaderDebugUIStartup
var b=e("./camera2d.js")
var a=e("./cmds.js").cmd_parse
var i=e("./engine.js")
var o=e("./fetch.js").fetch
var N=e("./font.js")
var C=e("./input.js")
var M=Math.min
var D=e("./scroll_area.js").scrollAreaCreate
var P=e("./shaders.js").shadersGetDebug
var k=e("./settings.js")
var B=e("./ui.js")
var n=e("../common/util.js").errorString
var s=e("../common/vmath.js").vec4
Z.SHADER_DEBUG=Z.SHADER_DEBUG||900
var l="http://localhost:3000/api/shaderstats"
var c={}
function getShaderStats(e,t,r){if(c[e])return c[e].data
if(r)return null
var a=c[e]={data:null}
o({url:l+"?stage="+t+"&text="+encodeURIComponent(e),response_type:"json"},function(e,t){if(e)a.data={err:"Fetch error: "+n(e)}
else a.data=t})
return a.data}var U=4
var G=N.styleColored(null,2156986367)
var F=N.styleColored(null,572662527)
var W=N.styleColored(null,3710001919)
var j=s(.4,.4,.4,1)
var H=s(1,1,1,1)
var z=s(.8,0,0,1)
var V=s(.4,.6,1,1)
var Y
var q
var K
function shaderDebugUITick(){var e=B.tooltip_pad
var t=b.x0()+e
var r=b.y0()+e
var o=Z.SHADER_DEBUG
var n=B.font,a=B.title_font,i=B.font_height
var s=20*i
var l=t
var c=r
var _=P()
a.drawSizedAligned(G,l,c,o,i,n.ALIGN.HCENTERFIT,s,0,"Shaders ("+_.length+")")
if(!Y){Y=D({z:o,background_color:null,auto_hide:true})
q=D({z:o,background_color:null,auto_hide:true})}var u=s-U-Y.barWidth()
var d=.3*u
var f=d/2
var v=u-d-U
n.draw({x:l+v+U,y:c+.5*B.font_height,z:o,w:f-1,color:1077952767,size:.5*B.font_height,text:"Ops",align:n.ALIGN.HCENTERFIT})
n.draw({x:l+v+U+f+1,y:c+.5*B.font_height,z:o,w:f-1,color:1077952767,size:.5*B.font_height,text:"Bytes",align:n.ALIGN.HCENTERFIT})
c+=i+1
B.drawLine(t+.3*s,c,t+.7*s,c,o,.5,true,j)
c+=U
var h=b.y1()-U-c
var p=c
Y.begin({x:l,y:c,w:s,h:h})
c=l=0
o=Z.UI
for(var m=0;m<_.length;++m){var g=_[m]
var E=g.filename.replace("shaders/","")
if(g.defines_arr.length)E+="("+g.defines_arr.join(",")+")"
if(B.buttonText({text:E,x:l,y:c,z:o,w:v,h:i,color:K===g?V:g.valid?void 0:z,align:N.ALIGN.HFIT}))if(K===g)K=void 0
else K=g
var y=getShaderStats(g.shader_source_text,g.type===gl.FRAGMENT_SHADER?"frag":"vert",false)
if(!y||y.err)n.draw({x:l+v+U,y:c,z:o,w:d,color:null!=y&&y.err?2147483903:2155905279,text:null!=y&&y.err?"ERR":"...",align:n.ALIGN.HCENTERFIT})
else{var T
var I=255
n.draw({x:l+v+U,y:c,z:o,w:f-1,color:I,text:""+(null==(T=y.spirv)?void 0:T.count_total),align:n.ALIGN.HCENTERFIT})
n.draw({x:l+v+U+f+1,y:c,z:o,w:f-1,color:I,text:y.bin_size.toLocaleString(),align:n.ALIGN.HCENTERFIT})}c+=i}Y.end(c)
c=p+M(h,c)
o=Z.SHADER_DEBUG
var S=B.font_height
if(B.buttonText({x:t+s-S,y:r,z:o+1,w:S,h:S,text:"X"}))k.set("shader_debug",0)
B.panel({x:t-e,y:r-e,z:o-1,w:s+2*e,h:c-r+2*e,color:H})
if(!K)return
var A=K
t+=s+2*e
s=b.x1()-U-t
l=t
c=r
n.draw({x:l,y:c,z:o,w:s,style:F,text:A.filename,align:n.ALIGN.HCENTERFIT})
c+=i+1
B.drawLine(t+.3*s,c,t+.7*s,c,o,.5,true,j)
p=c+=U
q.begin({x:l,y:c,w:s,h:h})
u=s-U-q.barWidth()
c=l=0
o=Z.UI
if(A.error_text)c+=n.draw({x:l,y:c,z:o,w:u,color:2147483903,style:F,text:A.error_text,align:n.ALIGN.HWRAP})
function flatten(e,t){for(var r in e){if("text"===r||"spirv_raw"===r)continue
var a=e[r]
var i=t?t+"."+r:r
if("object"===typeof a)flatten(a,i)
else{n.draw({x:l,y:c,z:o,w:u,style:F,text:i+": "+a,align:n.ALIGN.HFIT})
c+=B.font_height}}}var w=getShaderStats(A.shader_source_text,A.type===gl.FRAGMENT_SHADER?"frag":"vert")
if(!w)c+=n.draw({x:l,y:c,z:o,w:s,style:F,text:"Loading shader stats...",align:n.ALIGN.HWRAP})
else if(w.err)c+=n.draw({x:l,y:c,z:o,w:u,style:W,text:String(w.err),align:n.ALIGN.HWRAP})
else flatten(w)
var L=.5*B.font_height
if(null!=w&&w.text){c+=U
B.drawLine(l+.3*s,c,l+.7*s,c,o,.5,true,j)
c+=U/2
n.draw({x:l,y:c,z:o,w:s,style:F,text:"Analyzed Shader Source",align:n.ALIGN.HCENTERFIT})
c+=i+1
var R=n.draw({x:l,y:c,z:o,w:s,size:L,style:F,text:w.text,align:n.ALIGN.HWRAP})
if(C.click({x:l,y:c,w:s,h:R}))B.provideUserString("Analyzed shader source",w.text)
c+=R}if(null!=w&&w.spirv_raw){c+=U
B.drawLine(l+.3*s,c,l+.7*s,c,o,.5,true,j)
c+=U/2
n.draw({x:l,y:c,z:o,w:s,style:F,text:"SPIR-V Disassembly",align:n.ALIGN.HCENTERFIT})
c+=i+1
var x=n.draw({x:l,y:c,z:o,w:s,size:L,style:F,text:w.spirv_raw,align:n.ALIGN.HWRAP})
if(C.click({x:l,y:c,w:s,h:x}))B.provideUserString("SPIR-V Disassembly",w.spirv_raw)
c+=x}c+=U
B.drawLine(l+.3*s,c,l+.7*s,c,o,.5,true,j)
c+=U/2
n.draw({x:l,y:c,z:o,w:s,style:F,text:"Actual WebGL Shader Source",align:n.ALIGN.HCENTERFIT})
c+=i+1
var O=n.draw({x:l,y:c,z:o,w:s,size:L,style:F,text:A.shader_source_text,align:n.ALIGN.HWRAP})
if(C.click({x:l,y:c,w:s,h:O}))B.provideUserString("Used WebGL shader source",A.shader_source_text)
c+=O
q.end(c)
c=p+M(h,c)
o=Z.SHADER_DEBUG
B.panel({x:t-e,y:r-e,z:o-1,w:s+2*e,h:c-r+2*e,color:H})}function shaderDebugUIStartup(){k.register({shader_debug:{label:"Shader Debug",default_value:0,type:a.TYPE_INT,range:[0,1],access_show:["sysadmin"],on_change:function on_change(){i.removeTickFunc(shaderDebugUITick)
if(k.shader_debug)i.addTickFunc(shaderDebugUITick)}}})}},{"../common/util.js":330,"../common/vmath.js":332,"./camera2d.js":241,"./cmds.js":244,"./engine.js":250,"./fetch.js":258,"./font.js":260,"./input.js":271,"./scroll_area.js":289,"./settings.js":291,"./shaders.js":293,"./ui.js":306}],293:[function(e,t,r){"use strict"
r.shadersResetState=shadersResetState
r.setGLErrorReportDetails=setGLErrorReportDetails
r.shadersGetDebug=shadersGetDebug
r.shaderCreate=shaderCreate
r.shadersRequirePrelink=shadersRequirePrelink
r.bind=bind
r.prelink=prelink
r.addReservedDefine=addReservedDefine
r.handleDefinesChanged=handleDefinesChanged
r.setInternalDefines=setInternalDefines
r.startup=startup
r.addGlobal=addGlobal
r.globals=r.semantic=r.MAX_SEMANTIC=void 0
r.create=shaderCreate
var a=5
r.MAX_SEMANTIC=a
var f=e("assert")
var v=e("./engine.js")
var i=e("./error_report.js"),o=i.errorReportClear,n=i.errorReportSetDetails,s=i.glovErrorReport
var l=e("./filewatch.js").filewatchOn
var c=e("../common/util.js"),_=c.matchAll,h=c.nop
var u=e("./textures.js").texturesUnloadDynamic
var d=e("./webfs.js").webFSGetFile
var p=0
var m=null
var g={ATTR0:0,POSITION:0,ATTR1:1,COLOR:1,COLOR_0:1,ATTR2:2,TEXCOORD:2,TEXCOORD_0:2,ATTR3:3,NORMAL:3,ATTR4:4,TEXCOORD_1:4}
r.semantic=g
var E
r.globals=E
var y
var T
var I
var S
var A
var w=[]
var L=/attribute [^ ]+ ([^ ;]+);/g
var R=/uniform (?:(?:low|medium|high)p )?((?:(?:vec|mat)\d(?:x\d)?|float) [^ ;]+);/g
var x=/uniform sampler(?:2D|Cube) ([^ ;]+);/g
var O=/\n#include "([^"]+)"/g
var b={float:1,vec2:2,vec3:3,vec4:4,mat3:9,mat4:16}
function loadInclude(e){return'\n// from include "'+e+'":\n'+d(e,"text")+"\n"}function shadersResetState(){for(var e=0;e<w.length;++e){var t=w[e]
if(t.programs)for(var r in t.programs){var a=t.programs[r]
for(var i=0;i<a.uniforms.length;++i){var o=a.uniforms[i]
for(var n=0;n<o.size;++n)o.value[n]=NaN}}}m=null
gl.useProgram(null)}function setGLErrorReportDetails(){var e={max_fragment_uniform_vectors:gl.getParameter(gl.MAX_FRAGMENT_UNIFORM_VECTORS),max_varying_vectors:gl.getParameter(gl.MAX_VARYING_VECTORS),max_vertex_attribs:gl.getParameter(gl.MAX_VERTEX_ATTRIBS),max_vertex_uniform_vectors:gl.getParameter(gl.MAX_VERTEX_UNIFORM_VECTORS),vendor:gl.getParameter(gl.VENDOR),renderer:gl.getParameter(gl.RENDERER),webgl:v.webgl2?2:1}
var t=gl.getExtension("WEBGL_debug_renderer_info")
if(t){e.renderer_unmasked=gl.getParameter(t.UNMASKED_RENDERER_WEBGL)
e.vendor_unmasked=gl.getParameter(t.UNMASKED_VENDOR_WEBGL)}for(var r in e)n(r,e[r])}var N=false
var C
var M
var D=false
function reportShaderError(e,t){function doReport(){N=false
setGLErrorReportDetails()
var e="Shader error(s):\n    "+C.join("\n    ")
D=true
if(!M)s(false,e,"shaders.js")
else f(false,e)
C=null}if(!N){setTimeout(doReport,1e3)
N=true
C=[]
M=false}M=M||!e
C.push(t)}function parseIncludes(i,e){var o={}
e.replace(R,function(e,t){o[t]=true})
return e.replace(O,function(e,t){var r=i.split("/")
r.pop()
r.push(t)
var a=loadInclude(r=r.join("/"))
if(!a){console.error("Could not evaluate "+e)
return e}return a.replace(R,function(e,t){if(o[t])return"// [removed "+t+"]"
o[t]=true
return e})})}var P=["#version 300 es","#define WEBGL2"].join("\n")
var k=[P,"#define varying in","out lowp vec4 fragColor;","#define gl_FragColor fragColor","#define texture2D texture","#define textureCube texture",""].join("\n")
var B=[P,"#define varying out","#define attribute in",""].join("\n")
function Shader(e){var t=e.filename,r=e.defines,a=e.non_fatal
f.equal(typeof t,"string")
var i=t.endsWith(".fp")?gl.FRAGMENT_SHADER:t.endsWith(".vp")?gl.VERTEX_SHADER:0
f(i)
this.type=i
this.filename=t
this.non_fatal=a
this.defines_arr=r||[]
this.defines=this.defines_arr.map(function(e){return"#define "+e+"\n"}).join("")
this.shader=gl.createShader(i)
this.id=++p
if(i===gl.VERTEX_SHADER)this.programs={}
w.push(this)
this.compile()}function shadersGetDebug(){return w}function cleanShaderError(e){if(e)e=e.replace(/\0/g,"").trim()
return e}Shader.prototype.compile=function(){var e=this.type,t=this.filename
var r=""
var a=d(t,"text")
if(v.webgl2&&a.includes("#pragma WebGL2"))r=e===gl.VERTEX_SHADER?B:k
a=(a=parseIncludes(t,a=""+r+T+this.defines+a)).replace(/#pragma WebGL2?/g,"")
if(e===gl.VERTEX_SHADER){this.attributes=_(a,L)
this.attributes.forEach(function(e){return f(void 0!==g[e])})}else{this.samplers=_(a,x)
var i=[]
this.samplers.forEach(function(e){var t=Number(e.slice(-1))
f(!isNaN(t))
f(!i[t])
i[t]=true})}this.uniforms=_(a,R)
this.uniforms.forEach(function(e){var t=e.split(" ")[0]
f(b[t])})
this.shader_source_text=a
gl.shaderSource(this.shader,a)
gl.compileShader(this.shader)
if(!gl.getShaderParameter(this.shader,gl.COMPILE_STATUS)){this.valid=false
var o=this.error_text=cleanShaderError(gl.getShaderInfoLog(this.shader))
if(this.defines_arr.length)t+="("+this.defines_arr.join(",")+")"
console[this.non_fatal?"warn":"error"]("Error compiling "+t+": "+o)
reportShaderError(this.non_fatal,t+": "+o)
console.log(a.split("\n").map(function(e,t){return t+1+": "+e}).join("\n"))}else{this.valid=true
if(this.error_text)delete this.error_text}}
function shaderCreate(e){if("object"===typeof e)return new Shader(e)
return new Shader({filename:e})}function uniformSetValue(e){switch(e.width){case 1:gl.uniform1fv(e.location,e.value)
break
case 2:gl.uniform2fv(e.location,e.value)
break
case 3:gl.uniform3fv(e.location,e.value)
break
case 4:gl.uniform4fv(e.location,e.value)
break
case 9:gl.uniformMatrix3fv(e.location,false,e.value)
break
case 16:gl.uniformMatrix4fv(e.location,false,e.value)}}var U=false
function shadersRequirePrelink(e){var t=U
U=e
return t}function link(e,t,r){f(!U)
var _=e.programs[t.id]={handle:gl.createProgram(),uniforms:null}
if(!_.handle)f(false,"gl.createProgram() returned "+_.handle+(gl.createProgram()?", retry would succeed":""))
gl.attachShader(_.handle,e.shader)
gl.attachShader(_.handle,t.shader)
for(var a=0;a<e.attributes.length;++a)gl.bindAttribLocation(_.handle,g[e.attributes[a]],e.attributes[a])
gl.linkProgram(_.handle)
_.valid=gl.getProgramParameter(_.handle,gl.LINK_STATUS)
if(!_.valid){var i=cleanShaderError(gl.getProgramInfoLog(_.handle))
console.error("Shader link error: "+i)
if(r&&(!v.DEBUG||r===h))r(i)
else reportShaderError(false,"Shader link error ("+e.filename+" & "+t.filename+"): "+i)
_.uniforms=[]
return _}gl.useProgram(_.handle)
m=_
var o=e.uniforms.slice(0)
for(var n=0;n<t.uniforms.length;++n){var s=t.uniforms[n]
if(-1===o.indexOf(s))o.push(s)}_.uniforms=o.map(function(e){var t=(e=e.split(" "))[0]
var r=e[1]
var a=1
var i=r.match(/([^[]+)\[(\d+)\]/)
if(i){r=i[1]
a=Number(i[2])}var o=gl.getUniformLocation(_.handle,r)
if(null===o)return null
var n=b[t]
var s=n*a
var l=E[r]
y[r]=true
var c={name:r,size:s,width:n,count:a,value:new Float32Array(s),location:o,glob:l}
uniformSetValue(c)
return c}).filter(function(e){return e})
for(var l=0;l<t.samplers.length;++l){var c=t.samplers[l]
var u=Number(c.slice(-1))
var d=gl.getUniformLocation(_.handle,c)
if(null!==d)gl.uniform1i(d,u)}return _}function autoLink(e,t,r){var a=e.programs[t.id]
if(!a)a=link(e,t,r)
if(!a.valid){if(!(a=link(e,I,h)).valid&&S)a=link(e,S,h)
if(!a.valid)a=link(A,I,h)
e.programs[t.id]=a}return a}function bind(e,t,r){var a=e.programs[t.id]
if(!a)a=autoLink(e,t)
if(a!==m){m=a
gl.useProgram(a.handle)}for(var i=0;i<a.uniforms.length;++i){var o=a.uniforms[i]
var n=r[o.name]||o.glob
if(!n)continue
var s=false
for(var l=0;l<o.size;++l)if(n[l]!==o.value[l]){s=true
break}if(s){for(var c=0;c<o.size;++c)o.value[c]=n[c]
uniformSetValue(o)}}}function prelink(e,t,r,a){if(void 0===r)r={}
var i=autoLink(e,t,a)
if(i.valid)bind(e,t,r)
return i.valid}var G={WEBGL2:1}
function addReservedDefine(e){G[e]=1}var F={}
function applyDefines(){T=Object.keys(v.defines).filter(function(e){return!G[e]}).concat(Object.keys(F)).map(function(e){return"#define "+e+"\n"}).join("")}function shaderReload(){shadersRequirePrelink(false)
if(w.length){if(D){o()
D=false}gl.useProgram(null)
for(var e=0;e<w.length;++e){var t=w[e].programs
if(t){for(var r in t)gl.deleteProgram(t[r].handle)
w[e].programs={}}}for(var a=0;a<w.length;++a)w[a].compile()
u()}}function handleDefinesChanged(){applyDefines()
shaderReload()}function setInternalDefines(e){for(var t in e)if(e[t])F[t]=e[t]
else delete F[t]
handleDefinesChanged()}function onShaderChange(e){shaderReload()}function startup(e){applyDefines()
r.globals=E=e
y={}
I=shaderCreate("shaders/error.fp")
if(v.webgl2)S=shaderCreate("shaders/error_gl2.fp")
A=shaderCreate("shaders/error.vp")
l(".fp",onShaderChange)
l(".vp",onShaderChange)}function addGlobal(e,t){f(!E[e])
f(!y[e])
E[e]=t
for(var r=0;r<t.length;++r)f(isFinite(t[r]))}},{"../common/util.js":330,"./engine.js":250,"./error_report.js":255,"./filewatch.js":259,"./textures.js":304,"./webfs.js":309,assert:void 0}],294:[function(e,t,r){"use strict"
r.sliderSetDefaultShrink=sliderSetDefaultShrink
r.sliderIsDragging=sliderIsDragging
r.sliderIsFocused=sliderIsFocused
r.slider=slider
var a
function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]
for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))e[a]=r[a]}return e}).apply(this,arguments)}var g=e("assert")
var E=Math.round,y=Math.max
var T=e("../common/util.js").clamp
var i=e("../common/vmath.js").vec4
var I=e("./input.js")
var o=e("./spot.js")
var n=o.SPOT_DEFAULT_BUTTON
var S=o.SPOT_NAV_LEFT
var A=o.SPOT_NAV_RIGHT
var w=o.spot
var s=e("./ui.js")
var L=s.Z_MIN_INC
var R=s.drawHBox
var x=s.playUISound
var O=e("./ui.js")
var b=_extends({},n,{sound_button:null,custom_nav:((a={})[A]=null,a[S]=null,a)})
var N=1
var C=1
var M=0
function sliderSetDefaultShrink(e,t,r){N=e
C=t
M=r||0}var D=i(1,1,1,1)
var P=i(.5,.5,.5,1)
var k=i(.75,.75,.75,1)
var B=false
var U=false
function sliderIsDragging(){return B}function sliderIsFocused(){return U}function slider(e,t){g("number"===typeof t.x)
g("number"===typeof t.y)
g(t.min<t.max)
t.z=t.z||Z.UI
t.w=t.w||O.button_width
t.h=t.h||O.button_height
t.max_dist=t.max_dist||Infinity
var r=t.vshrink||N
var a=t.handle_shrink||C
var i=t.disabled||false
var o=t.h*a
var n=O.sprites.slider_handle.uidata.wh[0]*o
var s=t.pad_focusable
B=false
var l=a-r+M
R({x:t.x+t.h*l/2,y:t.y+t.h*(1-r)/2,z:t.z,w:t.w-t.h*l,h:t.h*r},O.sprites.slider,t.color)
var c=E(y(O.sprites.slider.uidata.wh[0]*t.h*r,n)/2)
var _=t.w-2*c
var u=!i&&I.drag(t)
var d=Boolean(u)
t.def=b
if(d)t.focus_steal=true
t.pad_focusable=s
var f=w(t)
U=f.focused
if(f.ret&&f.pos){d=false
e=(f.pos[0]-(t.x+c))/_
e=t.min+(t.max-t.min)*T(e,0,1)
x("button_click")}else if(d){e=(u.cur_pos[0]-(t.x+c))/_
e=t.min+(t.max-t.min)*T(e,0,1)
I.mouseOver()
U=B=true}if(f.nav){x("button_click")
var v=t.step||(t.max-t.min)/16
if(f.nav===A)e=T(e+v,t.min,t.max)
else if(f.nav===S)e=T(e-v,t.min,t.max)}var h=t.x+c+_*(e-t.min)/(t.max-t.min)-n/2
var p=t.y+t.h/2-o/2
var m=D
if(d)m=P
else if(f.focused)m=k
O.sprites.slider_handle.draw({x:h,y:p,z:t.z+L,w:n,h:o,color:m,frame:0})
return e}},{"../common/util.js":330,"../common/vmath.js":332,"./input.js":271,"./spot.js":300,"./ui.js":306,assert:void 0}],295:[function(e,t,r){"use strict"
r.viewportRenderPrepare=viewportRenderPrepare
r.viewportRenderFinish=viewportRenderFinish
r.snapshot=snapshot
r.snapshotStartup=snapshotStartup
r.OFFSET_GOLDEN=void 0
var n=e("assert")
var a=e("./camera2d.js")
var i=e("./draw_list.js"),s=i.alphaDraw,l=i.alphaDrawListSize,o=i.alphaListPush,c=i.alphaListPop
var _=e("./effects.js")
var u=e("./engine.js")
var d=e("./framebuffer.js").framebufferCapture
var f=e("gl-mat4/lookAt")
var v=Math.max,h=Math.PI,p=Math.tan
var m=e("./shaders.js")
var g=e("./sprites.js")
var E=e("./sprites.js").spriteCreate
var y=g.blendModeSet,T=g.BLEND_ALPHA
var I=e("./textures.js")
var S=e("../common/vmath.js"),A=S.mat4,w=S.vec3,L=S.v3addScale,R=S.v3copy,x=S.vec4,O=S.v4copy,b=S.zaxis
var N=e("./quat.js"),C=N.qRotateZ,M=N.qTransformVec3,D=N.quat,P=N.unit_quat
var k=w(-1/1.618,-1,1/1.618/1.618)
r.OFFSET_GOLDEN=k
var B
var U=x()
function viewportRenderPrepare(e){var t=e.pre,r=e.viewport
O(U,u.viewport)
o()
g.spriteQueuePush()
a.push()
if(t)t()
y(T)
gl.enable(gl.BLEND)
gl.enable(gl.DEPTH_TEST)
gl.depthMask(true)
gl.enable(gl.CULL_FACE)
u.setViewport(r)
a.setNormalized()
gl.enable(gl.SCISSOR_TEST)
gl.scissor(r[0],r[1],r[2],r[3])}function viewportRenderFinish(e){var t=e.post
gl.disable(gl.SCISSOR_TEST)
if(t)t()
c()
a.pop()
g.spriteQueuePop()
u.setViewport(U)
u.startSpriteRendering()}var G=A()
var F=w()
var W=w()
var j=w()
var H=D()
var z=x(0,1,1,0)
var V=15/180*h
var Y=.5/p(V/2)*1.1
var q=0
function snapshot(e){n(!u.had_3d_this_frame)
var t=e.camera_offset||k
var r=e.name||"snapshot_"+ ++q
var a=e.on_unload
var i=e.sprite&&e.sprite.texs||[I.createForCapture(r+"(0)",a),I.createForCapture(r+"(1)",a)]
e.viewport=[0,0,e.w,e.h]
viewportRenderPrepare(e)
var o=v(e.size[0],e.size[2])*Y+e.size[1]/2
u.setupProjection(V,e.w,e.h,.1,2*o)
L(F,e.pos,e.size,.5)
if(e.rot){C(H,P,e.rot)
M(j,t,H)}else R(j,t)
L(W,F,j,o)
f(G,W,F,b)
u.setGlobalMatrices(G)
gl.clearColor(0,0,0,0)
gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT)
if(e.snapshot_backdrop){gl.depthMask(false)
_.applyCopy({source:e.snapshot_backdrop,no_framebuffer:true})
gl.depthMask(true)}e.draw()
if(l()){s()
gl.depthMask(true)}d(i[0],e.w,e.h,true,false)
gl.clearColor(1,1,1,0)
gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT)
if(e.snapshot_backdrop){gl.depthMask(false)
_.applyCopy({source:e.snapshot_backdrop,no_framebuffer:true})
gl.depthMask(true)}e.draw()
if(l()){s()
gl.depthMask(true)}d(i[1],e.w,e.h,true,false)
viewportRenderFinish(e)
if(!e.sprite)e.sprite=E({texs:i,shader:B,uvs:z})
return e.sprite}function snapshotStartup(){B=m.create("shaders/snapshot.fp")
m.prelink(g.sprite_vshader,B)}},{"../common/vmath.js":332,"./camera2d.js":241,"./draw_list.js":246,"./effects.js":249,"./engine.js":250,"./framebuffer.js":261,"./quat.js":287,"./shaders.js":293,"./sprites.js":302,"./textures.js":304,assert:void 0,"gl-mat4/lookAt":void 0}],296:[function(e,t,r){"use strict"
r.friendsGet=friendsGet
r.isFriend=isFriend
r.friendIsBlocked=friendIsBlocked
r.friendAdd=friendAdd
r.friendRemove=friendRemove
r.friendBlock=friendBlock
r.friendUnblock=friendUnblock
r.richPresenceSet=richPresenceSet
r.getExternalCurrentUserInfos=getExternalCurrentUserInfos
r.getExternalFriendInfos=getExternalFriendInfos
r.getExternalUserInfos=getExternalUserInfos
r.getUserProfileImage=getUserProfileImage
r.setDefaultUserProfileImage=setDefaultUserProfileImage
r.registerExternalUserInfoProvider=registerExternalUserInfoProvider
r.socialInit=socialInit
var i=e("assert")
var l=e("./client_config").PLATFORM_FBINSTANT
var a=e("../common/enums")
var c=a.ID_PROVIDER_FB_GAMING
var _=a.ID_PROVIDER_FB_INSTANT
var o=a.PRESENCE_ACTIVE
var n=a.PRESENCE_INACTIVE
var s=a.PRESENCE_OFFLINE
var u=e("../common/friends_data").FriendStatus
var d=e("../common/util").deepEqual
var f=e("./cmds").cmd_parse
var v=e("./input")
var h=e("./net")
var p=h.netDisconnected
var m=h.netSubs
var g=e("./sprites").spriteCreate
var E=e("./textures")
var y=6e4
var T=null
function friendsGet(){return null!=T?T:Object.create(null)}function isFriend(e){var t=null==T?void 0:T[e]
return(null==t?void 0:t.status)===u.Added||(null==t?void 0:t.status)===u.AddedAuto}function friendIsBlocked(e){var t=null==T?void 0:T[e]
return(null==t?void 0:t.status)===u.Blocked}function makeFriendCmdRequest(e,r,a){r=r.toLowerCase()
var i=m().loggedIn()
if(p())return void a("ERR_DISCONNECTED")
if(!i)return void a("ERR_NOT_LOGGED_IN")
m().getMyUserChannel().cmdParse(e+" "+r,function(e,t){if(e)return void a(e)
else if(i!==m().loggedIn()||!T)return void a("Invalid data")
if(t.friend)T[r]=t.friend
else delete T[r]
a(null,t.msg)})}function friendAdd(e,t){makeFriendCmdRequest("friend_add",e,t)}function friendRemove(e,t){makeFriendCmdRequest("friend_remove",e,t)}function friendBlock(e,t){makeFriendCmdRequest("friend_block",e,t)}function friendUnblock(e,t){makeFriendCmdRequest("friend_unblock",e,t)}f.register({cmd:"friend_add",help:"Add a friend",func:friendAdd})
f.register({cmd:"friend_remove",help:"Remove a friend",func:friendRemove})
f.register({cmd:"friend_block",help:"Block someone from seeing your rich presence, also removes from your friends list",func:friendBlock})
f.register({cmd:"friend_unblock",help:"Reset a user to allow seeing your rich presence again",func:friendUnblock})
f.register({cmd:"friend_list",help:"List all friends",func:function func(e,t){if(!T)return void t("Friends list not loaded")
t(null,Object.keys(T).filter(isFriend).join(",")||"You have no friends")}})
f.register({cmd:"friend_block_list",help:"List all blocked users",func:function func(e,t){if(!T)return void t("Friends list not loaded")
t(null,Object.keys(T).filter(friendIsBlocked).join(",")||"You have no blocked users")}})
var I=0
f.registerValue("invisible",{type:f.TYPE_INT,help:"Hide rich presence information from other users",label:"Invisible",range:[0,1],get:function get(){return I},set:function set(e){return I=e}})
var S=0
f.registerValue("afk",{type:f.TYPE_INT,help:"Appear as idle to other users",label:"AFK",range:[0,1],get:function get(){return S},set:function set(e){return S=e}})
function onPresence(e){this.presence_data=e}var A=null
var w=false
function richPresenceSend(){if(!m().loggedIn()||!A||w)return
w=true
m().onceConnected(function(){w=false
if(!m().loggedIn()||!A)return
var e=m().getMyUserChannel().pak("presence_set")
e.writeInt(A.active)
e.writeAnsiString(A.state)
e.writeJSON(A.payload)
e.send()})}function richPresenceSet(e,t,r){e=!e||S||Date.now()-v.inputLastTime()>y?n:o
if(I)e=s
r=r||null
if(!A||e!==A.active||t!==A.state||!d(A.payload,r)){A={active:e,state:t,payload:r}
richPresenceSend()}}var L=Object.create(null)
var R=Object.create(null)
function getExternalCurrentUserInfos(){return L}function getExternalFriendInfos(e){return R[e]}function getExternalUserInfos(e){if(e===m().loggedIn())return getExternalCurrentUserInfos()
else return getExternalFriendInfos(e)}function setExternalCurrentUser(e,t){if(t)L[e]=t
else delete L[e]}function updateExternalFriendsOnServer(n,s,e){if(0===s.length&&0===e.length||p())return
var l=m().loggedIn()
var t=m().getMyUserChannel().pak("friend_auto_update")
t.writeAnsiString(n)
for(var r=0;r<s.length;++r)t.writeAnsiString(s[r].external_id)
t.writeAnsiString("")
for(var a=0;a<e.length;++a)t.writeAnsiString(e[a])
t.writeAnsiString("")
t.send(function(e,t){if(l!==m().loggedIn()||!T)return
else if(e)return
else if(!t)return
var i=Object.create(null)
for(var r in t){var a=T[r]=t[r]
if(a.ids){var o=a.ids[n]
i[o]=r}}s.forEach(function(e){var t=e.external_id
var r=i[t]
if(r){var a=R[r]
if(!a)a=R[r]=Object.create(null)
a[n]=e}})})}function setExternalFriends(i,e){var o=Object.create(null)
for(var t in T){var r
var a=null==(r=T[t].ids)?void 0:r[i]
if(a)o[a]=t}for(var n in R)delete R[n][i]
var s=[]
e.forEach(function(e){var t=e.external_id
var r=o[t]
if(r){var a=R[r]
if(!a)a=R[r]=Object.create(null)
a[i]=e
delete o[t]}else s.push(e)})
var l=[]
for(var c in o)l.push(c)
if(0!==s.length||0!==l.length)updateExternalFriendsOnServer(i,s,l)}function requestExternalCurrentUser(r,e){var a=m().loggedIn()
e(function(e,t){if(a!==m().loggedIn())return
else if(e||!t)return
setExternalCurrentUser(r,t)})}function requestExternalFriends(r,e){var a=m().loggedIn()
e(function(e,t){if(a!==m().loggedIn()||!T)return
else if(e||!t)return
setExternalFriends(r,t)})}var x={}
var O
function getUserProfileImage(e){var t=x[e]
if(t)return t
var r=null
if(l){var a,i
r=null==(a=getExternalUserInfos(e))?void 0:null==(i=a[_])?void 0:i.profile_picture_url}else{var o,n
r=null==(o=getExternalUserInfos(e))?void 0:null==(n=o[c])?void 0:n.profile_picture_url}if(r){var s=E.load({url:r,filter_min:gl.LINEAR_MIPMAP_LINEAR,filter_mag:gl.LINEAR,soft_error:true,auto_unload:function auto_unload(){return delete x[e]}})
if(s&&s.loaded)return x[e]={img:g({tex:s})}}return O}function setDefaultUserProfileImage(e){O=e}var b={}
function registerExternalUserInfoProvider(e,t,r){if(t||r){var a
i(!T)
i(!(null!=(a=m())&&a.loggedIn()))
b[e]={get_current_user:t,get_friends:r}}else delete b[e]}function socialInit(){m().on("login",function(){var e=m().getMyUserChannel()
var n=m().loggedIn()
richPresenceSend()
T=null
if(p())return
e.pak("friend_list").send(function(e,t){if(e||n!==m().loggedIn())return
T=t
for(var r in b){var a=b[r],i=a.get_current_user,o=a.get_friends
if(i)requestExternalCurrentUser(r,i)
if(o)requestExternalFriends(r,o)}})})
m().on("logout",function(){T=null
L=Object.create(null)
R=Object.create(null)})
m().onChannelMsg("user","presence",onPresence)}},{"../common/enums":321,"../common/friends_data":323,"../common/util":330,"./client_config":243,"./cmds":244,"./input":271,"./net":279,"./sprites":302,"./textures":304,assert:void 0}],297:[function(e,t,r){"use strict"
r.isPlaceholderSound=isPlaceholderSound
r.fadesCount=fadesCount
r.soundOnLoadFail=soundOnLoadFail
r.soundLoad=soundLoad
r.soundPause=soundPause
r.soundResume=soundResume
r.soundStartup=soundStartup
r.soundResumed=soundResumed
r.soundTick=soundTick
r.soundPlay=soundPlay
r.soundPlayStreaming=soundPlayStreaming
r.soundPlayMusic=soundPlayMusic
r.soundLoading=soundLoading
r.FADE=r.FADE_IN=r.FADE_OUT=r.FADE_DEFAULT=void 0
var a=0
r.FADE_DEFAULT=a
var c=1
r.FADE_OUT=c
var _=2
r.FADE_IN=_
var i=c+_
r.FADE=i
var m=e("assert")
var o=e("../common/util")
var g=o.callEach
var n=o.defaults
var E=o.ridx
var y=e("./browser").is_firefox
var s=e("./cmds").cmd_parse
var l=e("./fbinstant").fbInstantOnPause
var u=e("./filewatch").filewatchOn
var T=e("./urlhash")
var d=e("@jimbly/howler/src/howler.core.js"),I=d.Howl,f=d.Howler
var S=e("./settings")
var A=Math.abs,v=Math.floor,w=Math.max,L=Math.min,h=Math.random
function isPlaceholderSound(e){return e.is_placeholder}var R={}
var x=[]
var O=0
var p={ext_list:["mp3","wav"],fade_rate:.001}
var b
var N={}
var C=0
var M=[]
var D
function fadesCount(){return M.length}var P=1
var k=1
S.register({volume:{default_value:1,type:s.TYPE_FLOAT,range:[0,1]}})
S.register({volume_music:{default_value:1,type:s.TYPE_FLOAT,range:[0,1]}})
S.register({volume_sound:{default_value:1,type:s.TYPE_FLOAT,range:[0,1]}})
function musicVolume(){return S.volume*S.volume_music}function soundVolume(){return S.volume*S.volume_sound}var B={}
var U
function soundOnLoadFail(e){U=e}function soundLoad(e,t,r){if((t=t||{}).streaming&&y)t.streaming=false
var a=t,o=a.streaming,n=a.loop
if(Array.isArray(e)){m(!r)
for(var i=0;i<e.length;++i)soundLoad(e[i],t)
return}var s="string"===typeof e?e:e.file
if(R[s]){if(r)r()
return}if(B[s]){if(r)B[s].push(r)
return}var l=[]
if(r)l.push(r)
B[s]=l
var c=s
var _=c.match(/^((?:[\0-\t\x0B\f\x0E-\u2027\u202A-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*)\.(mp3|ogg|wav|webm)$/)
var u
if(_){c=_[1]
u=_[2]}var d="sounds/"+c
var f=[]
var v=""
if(t.for_reload)v="?rl="+Date.now()
if(u)f.push(""+T.getURLBase()+d+"."+u+v)
for(var h=0;h<b.ext_list.length;++h){var p=b.ext_list[h]
if(p!==u)f.push(""+T.getURLBase()+d+"."+p+v)}function tryLoad(a){if(a===f.length){console.error("Error loading sound "+c+": All fallbacks exhausted, giving up")
if(U)U(c)
g(l,delete B[s],"Error loading sound")
return}if(!o)++O
var i=false
var e=new I({src:f.slice(a),html5:Boolean(o),loop:Boolean(n),volume:0,onload:function onload(){if(!i){if(!o)--O
i=true
e.glov_load_opts=t
R[s]=e
g(l,delete B[s],null)}},onloaderror:function onloaderror(e,t,r){if(a===f.length-1)console.error("Error loading sound "+f[a]+": "+t)
else console.log("Error loading sound "+f[a]+": "+t+", trying fallback...")
if(!i){if(!o)--O
i=true
tryLoad(a+1)}}})}tryLoad(0)}function soundReload(e){var t=e.match(/^sounds\/([^.]+)\.\w+$/)
var r=t&&t[1]
if(!r)return
if(!R[r]){console.log("Reload trigged for non-existent sound: "+e)
return}var a=R[r].glov_load_opts
a.for_reload=true
delete R[r]
soundLoad(r,a)}function soundPause(){soundTick(P=k=0)}function soundResume(){k=1
f.manualUnlock()}function soundStartup(e){b=n(e||{},p)
D=[]
for(var t=0;t<2;++t)D.push({sound:null,id:0,current_volume:0,target_volume:0,sys_volume:0,need_play:false})
u(".mp3",soundReload)
u(".ogg",soundReload)
u(".wav",soundReload)
u(".webm",soundReload)
l(soundPause)}function soundResumed(){return!f.noAudio&&f.safeToPlay}function soundTick(e){C+=e
if(P!==k){var t=.004*e
if(P<k)P=L(P+t,k)
else P=w(P-t,k)}if(!soundResumed())return
for(var r=0;r<x.length;++r){var a=x[r],i=a.sound,o=a.play_volume,n=a.set_volume_when_played
if(!i.playing())E(x,r)
else if(n!==musicVolume()){i.volume(o)
x[r].set_volume_when_played=musicVolume()}}var s=e*b.fade_rate
for(var l=0;l<D.length;++l){var c=D[l]
if(!c.sound)continue
var _=S.volume*S.volume_music===0?0:c.target_volume
if(c.current_volume!==_){var u=_-c.current_volume
var d=L(A(u),s)
if(u<0)c.current_volume=w(_,c.current_volume-d)
else c.current_volume=L(_,c.current_volume+d)
if(!c.target_volume&&!c.current_volume){if(!c.need_play)c.sound.stop(c.id)
c.sound=null}}if(c.sound){var f=c.current_volume*musicVolume()*P
if(c.need_play){c.need_play=false
c.id=c.sound.play()
c.sys_volume=-1}if(c.sys_volume!==f){c.sound.volume(f,c.id)
c.sys_volume=f}}}for(var v=M.length-1;v>=0;--v){var h=M[v]
var p=h.target_volume-h.volume
var m=L(A(p),h.time?e/h.time:s)
if(p<0)h.volume=w(h.target_volume,h.volume-m)
else h.volume=L(h.target_volume,h.volume+m)
h.sound.volume(h.volume)
if(h.volume===h.target_volume){E(M,v)
if(!h.volume)h.sound.stop(h.id)}}}function soundPlay(e,t,r){t=t||1
if(S.volume*(r?S.volume_music:S.volume_sound)===0)return null
if(!soundResumed())return null
if(Array.isArray(e))e=e[v(h()*e.length)]
if("object"===typeof e){t*=e.volume||1
e=e.file}var a=R[e]
if(!a)return null
var i=N[e]||-9e9
if(C-i<45)return null
var o=r?musicVolume:soundVolume
var n=a.play(void 0,t*o()*P)
N[e]=C
var s={name:e,volume_current:t,stop:a.stop.bind(a,n),playing:a.playing.bind(a,n),location:function location(){var e=a.seek(n)
if("number"!==typeof e)return 0
return e},duration:a.duration.bind(a,n),volume:function volume(e){s.volume_current=e
a.volume(e*o()*P,n)},fade:function fade(e,t){var r={sound:s,volume:s.volume_current,target_volume:e,id:n,time:t,settingsVolume:o}
for(var a=0;a<M.length;++a)if(M[a].id===n){M[a]=r
return}M.push(r)}}
if(r)x.push({sound:s,play_volume:t,set_volume_when_played:musicVolume()})
return s}function soundPlayStreaming(t,r,a,i){if(S.volume*(a?S.volume_music:S.volume_sound)===0)return null
if(Array.isArray(t))t=t[v(h()*t.length)]
var o={name:t,is_placeholder:true}
soundLoad(t,{streaming:true,loop:false},function(e){if(!e){o=soundPlay(t,r,a)
if(i)i(o)}})
return o}function soundPlayMusic(n,s,l){if(S.volume*S.volume_music===0)return
if(void 0===s)s=1
l=l||a
soundLoad(n,{streaming:true,loop:true},function(e){m(!e)
var t=R[n]
m(t)
if(D[0].sound===t){D[0].target_volume=s
if(!l)if(!s){t.stop(D[0].id)
D[0].sound=null}else{var r=D[0].sys_volume=s*musicVolume()*P
t.volume(r,D[0].id)
if(!t.playing())t.play(void 0,r)}return}if(D[0].current_volume)if(l&c){var a=D[1]
D[1]=D[0]
D[0]=a
D[1].target_volume=0}if(D[0].sound)D[0].sound.stop(D[0].id)
D[0].sound=t
D[0].target_volume=s
var i=l&_?0:s
D[0].current_volume=i
if(soundResumed()){var o=i*musicVolume()*P
D[0].id=t.play(void 0,o)
D[0].sys_volume=o
D[0].need_play=false}else D[0].need_play=true})}function soundLoading(){return O}},{"../common/util":330,"./browser":239,"./cmds":244,"./fbinstant":257,"./filewatch":259,"./settings":291,"./urlhash":307,"@jimbly/howler/src/howler.core.js":void 0,assert:void 0}],298:[function(e,t,r){"use strict"
r.GlovSoundScape=void 0
var a=e("./soundscape_types")
var C=e("assert")
var M=e("../common/util").ridx
var o=e("./engine.js")
var i=e("./sound")
var D=i.isPlaceholderSound
var s=i.soundLoad
var P=i.soundPlay
var k=i.soundPlayStreaming
var B=i.soundResumed
var l=e("./soundscape_types").dataLayerHasMax
var U=e("./settings")
var G=Math.floor,F=Math.max,W=Math.min,j=Math.random
for(var n in a)if("default"!==n)r[n]=a[n]
var c=function GlovSSFile(e,t){this.file=void 0
this.fade_time=void 0
this.excl_group=void 0
this.excl_group_first=void 0
this.excl_group_debug=void 0
this.file=""+e.base_path+t.file
if("string"===typeof t.excl_group)t.excl_group=[t.excl_group]
C(Array.isArray(t.excl_group))
this.excl_group_first=t.excl_group[0]
this.excl_group_debug=t.excl_group.join(",")
var r={}
for(var a=0;a<t.excl_group.length;++a)r[t.excl_group[a]]=true
this.excl_group=r
this.fade_time=t.fade_time||e.default_fade_time}
var _=3e4
var u=15e3
var d=Infinity
var f=5e3
var v=function GlovSSTagLayer(r,e,t){var a=this
this.excl_group_master=void 0
this.sync_with=void 0
this.odds=void 0
this.odds_total=void 0
this.period=void 0
this.period_noise=void 0
this.min_intensity=void 0
this.max_intensity=void 0
this.add_delay=void 0
this.files=void 0
this.files_map=void 0
this.priority=void 0
this.files_map={}
this.files=e.files.map(function(e){var t=new c(r,e)
a.files_map[t.file]=t
if(!r.streaming)s(e.file,{streaming:true})
return t})
this.priority=e.priority
this.excl_group_master=t.excl_group_master
this.sync_with=e.sync_with||t.sync_with
this.odds=e.odds||t.odds
this.period=e.period||t.period||_
this.period_noise=t.period_noise||u
this.min_intensity=e.min_intensity||t.min_intensity
this.max_intensity=e.max_intensity||t.max_intensity||d
this.add_delay=e.add_delay||t.add_delay||f
for(var i=this.odds_total=0;i<this.odds.length;++i)this.odds_total+=this.odds[i]}
var h=function GlovSSParentLayer(r,e){var a=this
this.excl_group_master=void 0
this.sync_with=void 0
this.odds=void 0
this.odds_total=void 0
this.period=void 0
this.period_noise=void 0
this.min_intensity=void 0
this.max_intensity=void 0
this.add_delay=void 0
this.files=void 0
this.files_map=void 0
this.tags=void 0
this.user_idx=void 0
var t=e.tags
this.files_map={}
this.files=e.files.map(function(e){var t=new c(r,e)
a.files_map[t.file]=t
if(!r.streaming)s(e.file,{streaming:true})
return t})
this.excl_group_master=e.excl_group_master
this.sync_with=e.sync_with
this.min_intensity=e.min_intensity
this.odds_total=0
if(l(e)){this.odds=[0]
for(var i=0;i<e.max;++i)this.odds.push(1)}else this.odds=e.odds
for(var o=0;o<this.odds.length;++o)this.odds_total+=this.odds[o]
this.add_delay=e.sync_with?0:e.add_delay||f
this.period=e.period||_
this.period_noise=e.period_noise||u
this.max_intensity=e.max_intensity||d
this.tags={}
for(var n in t)this.tags[n]=new v(r,t[n],this)
this.user_idx=++r.user_idx}
var p=false
var m=true
var g=500
var E=true
var H=1e3
var z=1
var V=1e-4
var y=function(){function GlovSoundScape(e){this.data_layers=void 0
this.layers=void 0
this.base_path=void 0
this.default_fade_time=void 0
this.enable_logs=void 0
this.streaming=void 0
this.kill_delay=void 0
this.force_no_tracks=false
this.fade_in_time=0
this.fade_in_start=0
this.intensity=0
this.tags={}
this.streaming_cbs={}
this.layer_state={}
this.layer_keys=[]
this.timestamp=o.frame_timestamp
this.user_idx=0
this.data_layers=e.layers
this.layers={}
this.base_path=e.base_path
this.default_fade_time=e.default_fade_time
this.enable_logs=void 0!==e.enable_logs?e.enable_logs:p
this.streaming=void 0!==e.streaming?e.streaming:m
this.kill_delay=void 0!==e.kill_delay?e.kill_delay:g
e.add_all=void 0!==e.add_all?e.add_all:E
if(e.add_all)this.addAll()}var e=GlovSoundScape.prototype
e.addLayer=function addLayer(e){var o=this
if(!this.layer_state[e]){this.layers[e]=new h(this,this.data_layers[e])
this.layer_state[e]={active:[],rel_intensity:j(),last_add:0,change:this.timestamp+this.layers[e].period+j()*this.layers[e].period_noise,add_blocked:false,drained:false}
this.layer_keys.push(e)
this.layer_keys.sort(function(e,t){var r=o.layers[e]
var a=o.layers[t]
var i=(r.excl_group_master?1:0)-(a.excl_group_master?1:0)
if(i)return-i
if(i=(r.sync_with?1:0)-(a.sync_with?1:0))return i
return r.user_idx-a.user_idx})}}
e.addAll=function addAll(){for(var e in this.data_layers)this.addLayer(e)}
e.getTag=function getTag(e){return this.tags[e]}
e.setTag=function setTag(e,t){this.tags[e]=t}
e.getIntensity=function getIntensity(){return this.intensity}
e.setIntensity=function setIntensity(e){this.intensity=e}
e.getLayer=function getLayer(e){var t=this.layers[e]
var r=t
var a=0
for(var i in t.tags){if(!this.tags[i])continue
var o=t.tags[i]
if(o.priority>a)a=(r=o).priority}return r}
e.forceNoTracks=function forceNoTracks(e){this.force_no_tracks=e}
e.setFadeInTime=function setFadeInTime(e){this.fade_in_start=o.frame_timestamp
this.fade_in_time=o.frame_timestamp+e}
e.tick=function tick(){var A=this
var w=o.frame_timestamp
var L=this.intensity,R=this.layer_state,x=this.layer_keys
var O=""
var b
function filterValidFiles(e){return!b[e.file]&&(!e.excl_group||e.excl_group[O])}function filterValidFilesMaster(e){return!b[e.file]&&(!e.excl_group||!O||e.excl_group[O])}if(this.fade_in_time&&w>this.fade_in_time){this.fade_in_time=0
this.fade_in_start=0}var N
if(this.streaming){N=false
for(var e=0;e<x.length;++e){var t=R[x[e]]
for(var r=0;r<t.active.length;++r)if(!D(t.active[r].sound))N=true}}var a=function _loop(e){var c=x[e]
var t=A.getLayer(c)
var r=t.files,a=t.files_map,i=t.add_delay,o=t.sync_with,n=t.excl_group_master
var _=R[c]
if(w>_.change){_.change=w+t.period+j()*t.period_noise
_.rel_intensity=j()}var u=0
if(!A.force_no_tracks){if(L>t.min_intensity&&L<t.max_intensity&&t.odds_total){var s=_.rel_intensity*t.odds_total
u=0
do{if((s-=t.odds[u])<0)break
u++}while(u<t.odds.length-1)}u=W(u,r.length)
if(U.volume*U.volume_music===0||!B()){u=0
A.stopAllLayers(A.kill_delay)}}b={}
for(var l=_.active.length-1;l>=0;--l){var d=_.active[l]
var f=d.file,v=d.sound,h=d.start
if(!v){A.log(c,"remove (not playing) "+f.file)
M(_.active,l)}else if(D(v)){if(!N)d.start=h=w
if(w-h>H){A.addStreamedSoundCB(v,function(e){return e.fade(0,1)})
A.log(c,"remove (not loaded on time) "+f.file)
M(_.active,l)}}else if(!v.playing()){if(w-h>H){A.log(c,"remove (not playing) "+f.file)
M(_.active,l)}}else{var p=!a[f.file]?"not in file list":null
if(f.excl_group)if(n){if(!O)O=f.excl_group_first
C(f.excl_group[O])}else if(O&&!f.excl_group[O])p="mismatched excl_group"
if(p){A.log(c,"stop ("+p+") "+f.file)
A.stopSound(_.active,l)}else b[f.file]=true}}if(o){var m=A.layer_state[o]
if(m.last_add===w){for(var g=_.active.length-1;g>=0;--g){var E=_.active[g]
var y=E.sound,T=E.file
if(D(y))A.addStreamedSoundCB(y,function(e){e.fade(0,1)})
else if(!y.playing()){A.log(c,"remove (sync'd changed) "+T.file)
M(_.active,g)}delete b[T.file]}u=W(u,m.active.length)
A.log(c,"sync'd changed, want "+u)}else u=W(u,_.active.length,m.active.length)}while(_.active.length>u){var I=G(j()*_.active.length)
A.log(c,"stop (over wanted count) "+_.active[I].file.file)
A.stopSound(_.active,I)
_.last_add=0}_.add_blocked=false
_.drained=false
var S=function _loop2(){if(_.last_add&&w-_.last_add<i){_.add_blocked=true
return"break"}var e=r.filter(n?filterValidFilesMaster:filterValidFiles)
if(!e.length){_.drained=true
return"break"}var s=e[G(j()*e.length)]
var l={file:s,start:w}
var t=void 0
if(A.streaming)t=k(s.file,z,true,function(e){if(e){var t=e.name
l.sound=e
A.log(c,"start "+s.file)
if(A.fade_in_time){var r=(w-A.fade_in_start)/(A.fade_in_time-A.fade_in_start)
var a=F(V,z*r)
e.volume(a)
var i=z
e.fade(i,A.fade_in_time-w)}var o=A.streaming_cbs[t]
if(o){for(var n=0;n<o.length;++n)o[n](e)
delete A.streaming_cbs[t]}}})
else t=P(s.file,z,true)
if(!t){A.log(c,"start "+(A.streaming?"streaming ":"")+"failed "+s.file);--u}else{if(A.streaming)delete A.streaming_cbs[t.name]
A.log(c,"start "+(A.streaming?"streaming ":"")+s.file)
l.sound=t
_.last_add=w
_.active.push(l)
b[s.file]=true
if(n&&s.excl_group){C(!O||s.excl_group[O])
O=s.excl_group_first}}}
while(_.active.length<u)if("break"===S())break}
for(var i=0;i<x.length;++i)a(i)}
e.callSoundCBWhenPossible=function callSoundCBWhenPossible(e,t){if(D(e))this.addStreamedSoundCB(e,t)
else t(e)}
e.addStreamedSoundCB=function addStreamedSoundCB(e,t){var r=e.name
if(!this.streaming_cbs[r])this.streaming_cbs[r]=[]
this.streaming_cbs[r].push(t)}
e.stopSound=function stopSound(e,t,r){var a=e[t]
M(e,t)
if(D(a.sound))this.addStreamedSoundCB(a.sound,function(e){e.fade(0,1)})
else a.sound.fade(0,r||a.file.fade_time)}
e.stopAllLayers=function stopAllLayers(e){var t=this.layer_state,r=this.layer_keys
for(var a=0;a<r.length;++a){var i=t[r[a]]
for(var o=i.active.length-1;o>=0;--o){var n=i.active[o].sound
if(D(n)){this.addStreamedSoundCB(n,function(e){e.fade(0,1)})
i.last_add=0}else if(!n.playing())M(i.active,o)
else{this.stopSound(i.active,o,e)
i.last_add=0}}}}
e.debugSolo=function debugSolo(a){var i=this
var e=this.layer_state,t=this.layer_keys
for(var r=0;r<t.length;++r){var o=e[t[r]]
var n=function _loop3(e){var t=o.active[e]
var r=t.sound
i.callSoundCBWhenPossible(r,function(e){if(e.playing())if(t===a||!a)e.volume(1)
else e.volume(0)})}
for(var s=o.active.length-1;s>=0;--s)n(s)}}
e.debug=function debug(){var e=this.layer_state
var t=[]
for(var r in e){var a=e[r]
var i=this.getLayer(r)
var o=a.active,n=a.rel_intensity
if(o.length||this.intensity>i.min_intensity&&this.intensity<i.max_intensity)t.push({text:"Layer "+r+(1===i.odds_total?"":" ("+n.toFixed(2)+")")+(a.add_blocked?" (waiting)":"")+(a.drained?" (no options)":"")+":"})
for(var s=0;s<o.length;++s){var l=o[s]
var c="  "+l.file.file.substring(l.file.file.lastIndexOf("/")+1)+"\t   "+(l.file.excl_group?l.file.excl_group_debug:"*")+" "
if(D(l.sound))c+="  (Sound being streamed...)"
else{var _,u
c+="  ("+(null==(_=l.sound)?void 0:_.location().toFixed(1))+"/"+(null==(u=l.sound)?void 0:u.duration().toFixed(1))+")"}t.push({hover:l,text:c})}}return t}
e.log=function log(e,t){if(this.enable_logs)console.log((o.frame_timestamp/1e3).toFixed(2)+" ["+e+"]: "+t)}
return GlovSoundScape}()
r.GlovSoundScape=y},{"../common/util":330,"./engine.js":250,"./settings":291,"./sound":297,"./soundscape_types":299,assert:void 0}],299:[function(e,t,r){"use strict"
r.dataLayerHasMax=dataLayerHasMax
function dataLayerHasMax(e){return Boolean(e.max)}},{}],300:[function(e,t,r){"use strict"
r.spotPadMode=spotPadMode
r.spotSetPadMode=spotSetPadMode
r.spotlog=spotlog
r.spotGet=spotGet
r.spotKey=spotKey
r.spotUnfocus=spotUnfocus
r.spotTopOfFrame=spotTopOfFrame
r.spotSuppressPad=spotSuppressPad
r.spotPadSuppressed=spotPadSuppressed
r.spotEndOfFrame=spotEndOfFrame
r.spotSubPush=spotSubPush
r.spotSubPop=spotSubPop
r.spotSubBegin=spotSubBegin
r.spotSubEnd=spotSubEnd
r.spotMouseoverHook=spotMouseoverHook
r.spotFocusSteal=spotFocusSteal
r.spotFocusCheck=spotFocusCheck
r.spotEndInput=spotEndInput
r.spotAsyncActivateButton=spotAsyncActivateButton
r.spot=spot
r.SPOT_DEFAULT_LABEL=r.SPOT_DEFAULT_BUTTON_DRAW_ONLY=r.SPOT_DEFAULT_BUTTON_DISABLED=r.SPOT_DEFAULT_BUTTON=r.SPOT_DEFAULT=r.SPOT_STATE_DISABLED=r.SPOT_STATE_FOCUSED=r.SPOT_STATE_DOWN=r.SPOT_STATE_REGULAR=r.SPOT_NAV_PREV=r.SPOT_NAV_NEXT=r.SPOT_NAV_DOWN=r.SPOT_NAV_RIGHT=r.SPOT_NAV_UP=r.SPOT_NAV_LEFT=r.SPOT_NAV_NONE=void 0
function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]
for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))e[a]=r[a]}return e}).apply(this,arguments)}var a=e("./input_constants").BUTTON_ANY
var w=0
r.SPOT_NAV_NONE=w
var b=1
r.SPOT_NAV_LEFT=b
var N=2
r.SPOT_NAV_UP=N
var C=3
r.SPOT_NAV_RIGHT=C
var M=4
r.SPOT_NAV_DOWN=M
var S=5
r.SPOT_NAV_NEXT=S
var A=6
r.SPOT_NAV_PREV=A
var L=7
var R=1
r.SPOT_STATE_REGULAR=R
var x=2
r.SPOT_STATE_DOWN=x
var O=3
r.SPOT_STATE_FOCUSED=O
var D=4
r.SPOT_STATE_DISABLED=D
var P={key:void 0,disabled:false,in_event_cb:null,drag_target:false,drag_over:false,button:a,is_button:false,button_long_press:false,pad_focusable:true,spatial_focus:true,auto_focus:false,long_press_focuses:true,sound_button:"button_click",sound_rollover:"rollover",touch_focuses:false,disabled_focusable:true,hotkey:null,hotpad:null,focus_steal:false,sticky_focus:false,custom_nav:null}
var i=_extends({},r.SPOT_DEFAULT=P,{is_button:true})
r.SPOT_DEFAULT_BUTTON=i
var o=_extends({},P,{disabled:true,sound_rollover:null})
r.SPOT_DEFAULT_BUTTON_DISABLED=o
var n=_extends({},P,{pad_focusable:false})
r.SPOT_DEFAULT_BUTTON_DRAW_ONLY=n
var s=_extends({},P,{sound_rollover:null,touch_focuses:true})
r.SPOT_DEFAULT_LABEL=s
var k=e("assert")
var B=Math.abs,U=Math.max
var l=e("../common/verify")
var c=e("./camera2d.js")
var _=e("./engine.js")
var d=e("./font.js").fontStyle
var u=e("./input.js")
var G=u.KEYS
var F=u.PAD
var W=u.dragDrop
var j=u.dragOver
var H=u.inputClick
var f=u.inputEatenMouse
var z=u.inputTouchMode
var v=u.keyDown
var V=u.keyDownEdge
var Y=u.longPress
var q=u.mouseButtonHadEdge
var h=u.mouseDomPos
var K=u.mouseDownAnywhere
var p=u.mouseDownEdge
var X=u.mouseDownMidClick
var Q=u.mouseMoved
var J=u.mouseOver
var $=u.mousePosIsTouch
var ee=u.padButtonDownEdge
var m=e("./settings.js")
var g=e("./ui.js")
var E=e("./ui.js")
var y=E.drawLine
var T=E.drawRect
var te=E.drawTooltipBox
var re=E.playUISound
var ae=g.internal.checkHooks
var I=null
var ie=null
var oe=[]
var ne=null
var se=false
var le=null
var ce={x:0,y:0,w:0,h:0}
var _e=[]
var ue=[]
var de=[]
var fe=[]
var ve={}
var he={}
var pe=false
var me=false
var ge=null
function isSubRect(e){return e.is_sub_rect}function spotPadMode(){return pe}function spotSetPadMode(e){pe=e}function spotlog(){}function spotGet(e,t){var r=t?_e:ue
var a=null
for(var i=0;i<r.length;++i){if(e===r[i].key)return r[i]
if(e===r[i].key_computed)a=r[i]}return a}function spotKey(e){if(e.key_computed)if(!_.defines.SPOT_DEBUG)return e.key_computed
profilerStart("spotKey")
var t=e.key||(I?I.key_computed:"")+"_"+e.x+"_"+e.y
if(e.key_computed)k.equal(e.key_computed,t)
else e.key_computed=t
profilerStop("spotKey")
return e.key_computed}function spotFocusSet(e,t,r,a){if(t&&(!Q()||$()))return false
var i=e.def||P
var o=void 0===e.sound_rollover?i.sound_rollover:e.sound_rollover
var n=e.key_computed||spotKey(e)
var s=se&&!r&&t&&n!==ne
var l=s?le:ne
if((o||!t)&&l!==n)re(o||P.sound_rollover)
if(l!==n||pe!==!t)spotlog("spotFocusSet",n,a,t?"":"pad_mode",s?"nonsticky":"")
pe=!t
if(s)le=n
else{ne=n
var c=void 0===e.sticky_focus?i.sticky_focus:e.sticky_focus
se=c
le=null}k(e.dom_pos)
return true}function spotUnfocus(){spotlog("spotUnfocus")
le=ne=null
pe=se=false}var Ee=0
var ye=1
var Te=2
function findBestTargetInternal(e,t,r,a,i){var o=t.w/2
var n=t.h/2
var s=t.x+o
var l=t.y+n
var c=t.x
var _=t.x+t.w
var u=t.y
var d=t.y+t.h
var f=null
var v
for(var h=0;h<r.length;++h){var p=r[h]
if(!i(p))continue
var m=p.dom_pos
var g=void 0
if(a===Ee){var E=void 0
var y=m.x+m.w
var T=m.y+m.h
var I=c-y
var S=m.x-_
var A=u-T
var w=m.y-d
if(I>=-o&&T>u-I&&m.y<d+I){E=b
g=I+U(m.y-l,l-T,0)}else if(S>=-o&&T>u-S&&m.y<d+S){E=C
g=S+U(m.y-l,l-T,0)}else if(A>=-n&&y>=c-A&&m.x<=_+A){E=N
g=A+U(m.x-s,s-y,0)}else if(w>=-n&&y>=c-w&&m.x<=_+w){E=M
g=w+U(m.x-s,s-y,0)}if(void 0===E){var L=m.x+m.w/2-s
var R=m.y+m.h/2-l
g=B(L)+B(R)
if(B(L)>B(R))if(L>0)E=C
else E=b
else if(R>0)E=M
else E=N}if(E!==e)continue}else{var x=m.x+m.w/2-s
var O=m.y+m.h/2-l
g=B(x)+B(O)
if(a===ye)if(x<=0&&e===C||x>=0&&e===b||O<=0&&e===M||O>=0&&e===N)continue}if(!f||g<v){f=p
v=g}}return f}var Ie=1e-5
var Se
function spotDebugList(e,t){if(!Se)Se=d(null,{color:255,outline_color:4294967244,outline_width:2})
for(var r=0;r<t.length;++r){var a=t[r]
var i=a.dom_pos
var o=void 0
if(isSubRect(a)){if(e)g.font.drawSizedAligned(Se,i.x,i.y,Z.DEBUG,8,g.font.ALIGN.HVCENTERFIT,i.w,i.h,a.key_computed||"unknown")
continue}if(a.spot_debug_ignore)continue
if(a.only_mouseover)o=[1,.5,0,.5]
else{var n=a.def||P
if(!(void 0===a.pad_focusable?n.pad_focusable:a.pad_focusable))continue
if(!(void 0===a.spatial_focus?n.spatial_focus:a.spatial_focus))continue
for(var s=0;s<t.length;++s){if(r===s)continue
var l=t[s]
if(isSubRect(l))continue
if(l.sub_rect!==a.sub_rect)continue
var c=l.def||P
var _=void 0===l.pad_focusable?c.pad_focusable:l.pad_focusable
if(l.only_mouseover||!_)continue
if(!(void 0===l.spatial_focus?c.spatial_focus:l.spatial_focus))continue
var u=l.dom_pos
if(i.x<u.x+u.w-Ie&&i.x+i.w>u.x+Ie&&i.y<u.y+u.h-Ie&&i.y+i.h>u.y+Ie)o=[1,0,0,.5]}}if(!e&&!o)continue
T(i.x,i.y,i.x+i.w,i.y+i.h,Z.DEBUG,o||[1,1,0,.5])
g.font.drawSizedAligned(Se,i.x,i.y,Z.DEBUG,8,g.font.ALIGN.HVCENTERFIT,i.w,i.h,a.key_computed||"unknown")}}function spotDebug(){c.push()
c.setDOMMapped()
var e=v(G.SHIFT)
spotDebugList(e,ue)
if(pe||e)for(var t=b;t<=M;++t){var r=de[t]
if(r){var a=ce
var i=r.dom_pos
var o=fe[t]
if(o){a=o.dom_pos
y(a.x+a.w/2,a.y+a.h/2,i.x+i.w/2,i.y+i.h/2,Z.DEBUG,1,.95,[1,.5,0,1])
a=ce
i=o.dom_pos}y(a.x+a.w/2,a.y+a.h/2,i.x+i.w/2,i.y+i.h/2,Z.DEBUG,1,.95,[1,1,0,1])}}c.pop()}var Ae
var we
function filterMatchesSubrect(e){return e!==we&&e.sub_rect===Ae}function overlaps(e,t){return e.x+e.w>t.x&&e.x<t.x+t.w&&e.y+e.h>t.y&&e.y<t.y+t.h}function contains(e,t){return t.x>=e.x&&t.x+t.w<=e.x+e.w&&t.y>=e.y&&t.y+t.h<=e.y+e.h}function filterInSubrectView(e){if(e.sub_rect!==Ae)return false
return overlaps(e.dom_pos,Ae.dom_pos)}function filterMatchesSubrectOrInVisibleChild(e){if(e===we)return false
if(e.sub_rect===Ae)return true
if(e.sub_rect&&e.sub_rect.sub_rect===Ae)return overlaps(e.dom_pos,e.sub_rect.dom_pos)
return false}var Le=[filterInSubrectView,filterMatchesSubrect]
function findBestWithinSubrect(e,t,r,a,i){Ae=a
for(var o=0;o<Le.length;++o){var n=Le[o]
for(var s=0;s<=i;++s){var l=findBestTargetInternal(e,t,r,s,n)
if(l){k(!isSubRect(l))
return l}}}return null}function findBestTargetFromSubRect(e,t,r,a,i){Ae=e
var o=findBestTargetInternal(t,r,a,i,filterMatchesSubrectOrInVisibleChild)
if(o)if(isSubRect(o))if(!(o=findBestWithinSubrect(t,r,a,fe[t]=o,i)))fe[t]=void 0
return o}function spotCalcNavTargets(){for(var e=1;e<L;++e){de[e]=void 0
fe[e]=void 0}var t
var r=[]
var a
var i
for(var o=0;o<ue.length;++o){var n=ue[o]
if(isSubRect(n)){if(!n.is_empty_sub_rect)r.push(n)}else if(n.key_computed===ne){if(!de[A]&&a)de[A]=a
t=n}else{var s=n.def||P
if(void 0===n.pad_focusable?s.pad_focusable:n.pad_focusable){if(!i)i=n
a=n
if(!de[S]&&t)de[S]=n
if(void 0===n.spatial_focus?s.spatial_focus:n.spatial_focus)r.push(n)}}}if(!de[A]&&a)de[A]=a
if(!de[S])de[S]=i
var l
var c
if(t){c=t.sub_rect
ce.x=t.dom_pos.x
ce.y=t.dom_pos.y
ce.w=t.dom_pos.w
ce.h=t.dom_pos.h
l=ye}else{c=null
for(var _=0;_<ue.length;++_){var u=ue[_]
if(isSubRect(u))if(contains(u.dom_pos,ce))c=u}if(c)l=ye
else l=Te}for(var d=1;d<=M;++d)for(var f=0;f<=l;++f){we=null
var v=findBestTargetFromSubRect(c,d,ce,r,f)
if(v){de[d]=v
break}if(c)if(v=findBestTargetFromSubRect((we=c).sub_rect,d,ce,r,f)){de[d]=v
break}}if(t){var h=t.def||P
var p=void 0===t.custom_nav?h.custom_nav:t.custom_nav
if(p){var m
for(var g in p){var E=Number(g)
var y=p[E]
if(null===y||void 0===y)de[E]=y
else{if(!m){m={}
for(var T=0;T<ue.length;++T){var I=ue[T]
if(!isSubRect(I))m[I.key_computed]=I}}if(m[y])de[E]=m[y]}}}}}function spotTopOfFrame(){if(Q()){var e=h()
ce.x=e[0]
ce.y=e[1]
ce.w=0
ce.h=0}if(p({peek:true}))pe=false
oe.length=0}function spotSuppressPad(){me=true
if(pe&&ne&&!se){spotUnfocus()
pe=true}}function spotPadSuppressed(){return me}function spotEndOfFrame(){spotCalcNavTargets()
he=ve
me=false
_e=ue
ue=[]
ve={}
ge=null}function frameSpotsPush(e){k(e.dom_pos)
l(isFinite(e.dom_pos.x))
l(isFinite(e.dom_pos.y))
l(isFinite(e.dom_pos.w))
l(isFinite(e.dom_pos.h))
e.sub_rect=I
ue.push(e)
if(I)I.is_empty_sub_rect=false}function spotEntirelyObscured(e){var t=e.dom_pos
for(var r=0;r<ue.length;++r){var a=ue[r]
if(isSubRect(a))continue
if(a.sub_rect!==I)continue
var i=a.dom_pos
if(i.x<=t.x&&i.x+i.w>=t.x+t.w&&i.y<=t.y&&i.y+i.h>=t.y+t.h)return true}return false}function spotSubPush(){oe.push([I,ie])
I=null}function spotSubPop(){var e=l(oe.pop())
I=e[0]
ie=e[1]}function spotSubBegin(e){k(e.key)
k(!I)
spotKey(e)
var t=e
t.is_sub_rect=true
if(!t.dom_pos)t.dom_pos={}
c.virtualToDomPosParam(t.dom_pos,t)
if(!spotEntirelyObscured(t))frameSpotsPush(t);(I=t).is_empty_sub_rect=true
ie=null}function spotSubEnd(){k(I)
I=null
return ie}function spotMouseoverHook(e,t){if(f()||t.peek)return
if(t.key_computed)return
var r=e
if(!r.dom_pos)r.dom_pos={}
c.virtualToDomPosParam(r.dom_pos,r)
if(!spotEntirelyObscured(r)){var a=r
a.only_mouseover=true
a.pad_focusable=false
if(_.defines.SPOT_DEBUG)a.spot_debug_ignore=t.eat_clicks||t.spot_debug_ignore
frameSpotsPush(a)}}function keyCheck(e){if(me)return false
switch(e){case b:return V(G.LEFT)||ee(F.LEFT)
case N:return V(G.UP)||ee(F.UP)
case C:return V(G.RIGHT)||ee(F.RIGHT)
case M:return V(G.DOWN)||ee(F.DOWN)
case A:return v(G.SHIFT)&&V(G.TAB)||ee(F.LEFT_BUMPER)
case S:return!v(G.SHIFT)&&V(G.TAB)||ee(F.RIGHT_BUMPER)
default:k(false)}return false}function spotFocusCheckNavButtonsFocused(e){for(var t=1;t<L;++t){var r=de[t]
if(void 0!==r&&keyCheck(t))if(r)spotFocusSet(r,false,false,"nav_focused")
else e.out.nav=t}}function spotFocusCheckNavButtonsUnfocused(e){for(var t=1;t<L;++t){var r=de[t]
if(r&&r.key_computed===e.key_computed&&keyCheck(t))spotFocusSet(r,false,false,"nav_unfocused")}}function spotFocusSetSilent(e){var t=spotKey(e)
var r=e.def||P
ne=t
var a=void 0===e.sticky_focus?r.sticky_focus:e.sticky_focus
se=a
le=null}function spotFocusSteal(e){spotlog("spotFocusSteal",spotKey(e),false)
pe=true
spotFocusSetSilent(e)}function spotParamAddOut(e){if(!e.out)e.out={}}function spotParamAddPosCache(e){k(e.key_computed)
if(!e.dom_pos)e.dom_pos={}}function spotParamIsSpotInternal(e){}function spotFocusCheck(e){spotParamAddOut(e)
var t=e.out
t.focused=false
t.kb_focused=false
t.allow_focus=false
var r=spotKey(e)
var a=e.def||P
if(void 0===e.disabled?a.disabled:e.disabled)if(!(void 0===e.disabled_focusable?a.disabled_focusable:e.disabled_focusable))return t
if(void 0===e.focus_steal?a.focus_steal:e.focus_steal)spotFocusSetSilent(e)
if(ne===r)spotFocusCheckNavButtonsFocused(e)
else spotFocusCheckNavButtonsUnfocused(e)
var i=ne===r||le===r
if(f()){if(ne===r){spotUnfocus()
i=false}if(le===r){le=null
i=false}}else{t.allow_focus=true
spotParamAddPosCache(e)
c.virtualToDomPosParam(e.dom_pos,e)
var o=void 0===e.auto_focus?a.auto_focus:e.auto_focus
if(!spotEntirelyObscured(e)||i&&se){frameSpotsPush(e)
if(o)if(!i&&!he[r]&&pe){spotlog("auto_focus",r)
spotFocusSetSilent(e)
i=true}}if(o)ve[r]=e
if(I&&ne===r)ie=e}t.kb_focused=ne===r
t.focused=i
return t}function spotEndInput(){if(_.defines.SPOT_DEBUG)spotDebug()}function spotAsyncActivateButton(e){ge=e}var Re={key:"",timestamp:0}
function spotSignalRet(e){var t=e.out
var r=e.key_computed
k(r)
t.double_click=r===Re.key&&_.frame_timestamp-Re.timestamp<m.double_click_time
Re.key=r
Re.timestamp=_.frame_timestamp
t.ret++}function spot(e){profilerStart("spot")
var t=e.def||P
var r=void 0===e.disabled?t.disabled:e.disabled
var a=void 0===e.is_button?t.is_button:e.is_button
var i=void 0===e.button_long_press?t.button_long_press:e.button_long_press
var o=void 0===e.in_event_cb?t.in_event_cb:e.in_event_cb
var n=void 0===e.drag_target?t.drag_target:e.drag_target
var s=void 0===e.drag_over?t.drag_over:e.drag_over
var l=void 0===e.touch_focuses?t.touch_focuses:e.touch_focuses
var c=void 0===e.focus_steal?t.focus_steal:e.focus_steal
var _=void 0===e.custom_nav?t.custom_nav:e.custom_nav
spotParamAddOut(e)
var u=e.out
u.focused=false
u.ret=0
if(i)u.long_press=false
if(n)u.drag_drop=null
if(_)u.nav=w
var d=R
var f=spotFocusCheck(e),v=f.focused,h=f.allow_focus,p=f.kb_focused
spotParamIsSpotInternal(e)
if(r)d=D
else{var m
var g
if(n&&(u.drag_drop=W(e))){spotFocusSet(e,true,true,"drag_drop")
spotSignalRet(e)
v=true}else if(i&&(g=Y(e))||a&&(m=H(e))){if(g){u.long_press=g.long_press
u.button=g.button
u.pos=void 0}else{k(m)
u.button=m.button
u.pos=m.pos}if($())if(l)if(!v){spotFocusSet(e,false,false,"touch_focus")
v=true}else{spotSignalRet(e)
spotUnfocus()
v=false}else{spotSignalRet(e)
spotUnfocus()
v=false}else{spotSignalRet(e)
spotFocusSet(e,true,true,"click")
v=true}}else if(!a&&l&&$()&&H(e)){spotFocusSet(e,false,false,"touch_focus")
v=true}else if(n&&j(e)){spotFocusSet(e,true,false,"drag_over")
v=true
if(K())d=x}else if(s&&j(e));}if(h&&z())if((void 0===e.long_press_focuses?t.long_press_focuses:e.long_press_focuses)&&Y(e)){spotFocusSet(e,false,false,"long_press")
v=true}var E=J(e)
if(v&&!c&&!E)if(q()){v=false
spotUnfocus()}else if(Q()){v=false
if(ne===e.key_computed)spotUnfocus()
else if(le===e.key_computed)le=null}if(E)if(h)if(spotFocusSet(e,true,false,"mouseover"))v=true
if(a&&E&&X(e))if(!r)d=x
var y=false
if(v){if(d===R)d=O
if(a&&!r&&p&&!me){var T=o?{in_event_cb:o}:null
if(V(G.SPACE,T)||V(G.RETURN,T)||ee(F.A))y=true}}if(!r){var I=void 0===e.hotkey?t.hotkey:e.hotkey
var S=void 0===e.hotpad?t.hotpad:e.hotpad
if(I)if(V(I,o?{in_event_cb:o}:null))y=true
if(S)if(ee(S))y=true
if(ge===e.key_computed)y=true}if(y){spotSignalRet(e)
u.button=0
u.pos=null}u.focused=v
if(u.ret){d=x
var A=void 0===e.sound_button?t.sound_button:e.sound_button
if(A)re(A)}if(u.focused&&e.tooltip)te(e)
ae(e,Boolean(u.ret))
u.spot_state=d
profilerStop("spot")
return u}},{"../common/verify":331,"./camera2d.js":241,"./engine.js":250,"./font.js":260,"./input.js":271,"./input_constants":272,"./settings.js":291,"./ui.js":306,assert:void 0}],301:[function(e,t,r){"use strict"
r.spriteAnimationCreate=spriteAnimationCreate
var a=e("assert")
var i=Math.floor,o=Math.random
var n=function(){function SpriteAnimationImpl(e){this.frame=0
this.time=0
this.frame_time=0
this.state=null
this.anim=null
this.anim_idx=0
this.data=void 0
if(e instanceof SpriteAnimationImpl){this.data=e.data
if(e.state)this.setState(e.state)}else{this.data=e
for(var t in this.data){var r=this.data[t]
if("number"===typeof r.frames)r.frames=[r.frames]
if("number"===typeof r.times){var a=new Array(r.frames.length)
for(var i=0;i<r.frames.length;++i)a[i]=r.times
r.times=a}if(r.times_random)if("number"===typeof r.times_random){var o=new Array(r.frames.length)
for(var n=0;n<r.frames.length;++n)o[n]=r.times_random
r.times_random=o}for(var s=r.total_time=0;s<r.times.length;++s)r.total_time+=r.times[s]
if(void 0===r.loop)r.loop=true}}}var e=SpriteAnimationImpl.prototype
e.clone=function clone(){return new SpriteAnimationImpl(this)}
e.setFrameIndex=function setFrameIndex(e){this.anim_idx=e
a(this.anim)
this.frame=this.anim.frames[e]
this.frame_time=this.anim.times[e]
if(this.anim.times_random)this.frame_time+=i(o()*this.anim.times_random[e])}
e.setState=function setState(e,t){if(e===this.state&&!t)return this
if(!this.data[e]){console.error("Tried to set anim state "+e+" which does not exist")
return this}this.state=e
this.anim=this.data[e]
if(this.anim.init_time)this.time=i(o()*this.anim.init_time)
else this.time=0
this.setFrameIndex(0)
return this}
e.progress=function progress(){if(!this.anim)return 1
var e=this.time
for(var t=0;t<this.anim_idx;++t)e+=this.anim.times[t]
return e/this.anim.total_time}
e.update=function update(e){if(!this.anim)return
this.time+=e
if(this.time>this.frame_time){this.time-=this.frame_time
this.anim_idx++
if(this.anim_idx===this.anim.frames.length)if(this.anim.loop)this.anim_idx%=this.anim.frames.length
else if(this.anim.transition_to)this.setState(this.anim.transition_to)
else{this.anim=null
return}this.setFrameIndex(this.anim_idx)
if(this.time>=this.frame_time)this.time=this.frame_time-1}}
e.getFrame=function getFrame(e){if(void 0!==e)this.update(e)
return this.frame}
return SpriteAnimationImpl}()
function spriteAnimationCreate(e){return new n(e)}r.createSpriteAnimation=spriteAnimationCreate
r.create=spriteAnimationCreate},{assert:void 0}],302:[function(e,t,r){"use strict"
r.spriteQueuePush=spriteQueuePush
r.spriteQueuePop=spriteQueuePop
r.spriteChainedStart=spriteChainedStart
r.spriteChainedStop=spriteChainedStop
r.spriteDataAlloc=spriteDataAlloc
r.spriteQueueFn=spriteQueueFn
r.queueraw4color=queueraw4color
r.queueraw4=queueraw4
r.queueSpriteData=queueSpriteData
r.queueraw4colorBuffer=queueraw4colorBuffer
r.queueraw=queueraw
r.queuesprite=queuesprite
r.spriteClip=spriteClip
r.spriteClipped=spriteClipped
r.spriteClipPush=spriteClipPush
r.spriteClipPop=spriteClipPop
r.spriteClipPause=spriteClipPause
r.spriteClipResume=spriteClipResume
r.blendModeSet=blendModeSet
r.blendModeReset=blendModeReset
r.spriteDraw=spriteDraw
r.spriteDrawPartial=spriteDrawPartial
r.buildRects=buildRects
r.spriteCreate=spriteCreate
r.spriteStartup=spriteStartup
r.sprite_fshader=r.sprite_vshader=r.BLEND_PREMULALPHA=r.BLEND_ADDITIVE=r.BLEND_ALPHA=r.BlendMode=void 0
r.createSprite=spriteCreate
r.create=spriteCreate
var a={BLEND_ALPHA:0,BLEND_ADDITIVE:1,BLEND_PREMULALPHA:2}
r.BlendMode=a
var i=0
r.BLEND_ALPHA=i
var o=1
r.BLEND_ADDITIVE=o
var n=2
r.BLEND_PREMULALPHA=n
var R=e("assert")
var x=e("./camera2d.js")
var s=e("./dyn_geom.js").dynGeomQueueSprite
var l=e("./engine.js")
var c=e("./geom.js")
var O=Math.cos,_=Math.max,u=Math.min,d=Math.round,b=Math.sin
var f=e("./textures.js")
var v=f.cmpTextureArray
var h=e("./shaders.js")
var p=e("../common/util.js"),m=p.deprecate,I=p.nextHighestPowerOfTwo
var g=e("../common/vmath.js"),E=g.vec2,S=g.vec4
m(r,"clip","spriteClip")
m(r,"clipped","spriteClipped")
m(r,"clipPush","spriteClipPush")
m(r,"clipPop","spriteClipPop")
m(r,"clipPause","spriteClipPause")
m(r,"clipResume","spriteClipResume")
m(r,"queuefn","spriteQueueFn")
m(r,"draw","spriteDraw")
m(r,"drawPartial","spriteDrawPartial")
var y
r.sprite_vshader=y
var T
r.sprite_fshader=T
var A
var w=S()
var L={clip_space:w}
var N=0
var C
var M=[]
var D=[]
var P=[]
function spriteQueuePush(e){R(P.length<10)
P.push(M)
M=e||[]}function spriteQueuePop(e){R(P.length)
R(e||!M.length)
M=P.pop()}function SpriteData(){this.data=new Float32Array(32)
this.texs=null
this.shader=null
this.shader_params=null
this.x=0
this.y=0
this.z=0
this.blend=0
this.uid=0
this.chained=false
this.next=null}SpriteData.prototype.queue=function(e){++C.sprites
if(!this.chained){this.z=e
this.uid=++N
M.push(this)}}
var k=false
var B=null
function spriteChainedStart(){k=true
B=null}function spriteChainedStop(){k=false
B=null}function spriteDataAlloc(e,t,r,a){var i
if(D.length)i=D.pop()
else i=new SpriteData
i.texs=e
if(k&&B){i.chained=true
B.next=i}else{i.chained=false
i.shader=t||null
if(r){r.clip_space=L.clip_space
i.shader_params=r}else i.shader_params=null
i.blend=a||0}if(k)B=i
return i}function cmpSprite(e,t){++C.sprite_sort_cmps
if(e.z!==t.z)return e.z-t.z
if(e.blend===o&&t.blend===o)return 0
if(e.y!==t.y)return e.y-t.y
if(e.x!==t.x)return e.x-t.x
return e.uid-t.uid}function spriteQueueFn(e,t){R(isFinite(e))
M.push({fn:t,x:0,y:0,z:e,uid:++N})}function queueraw4color(e,t,r,a,i,o,n,s,l,c,_,u,d,f,v,h,p,m,g,E,y,T,I,S,A){R(isFinite(T))
var w=spriteDataAlloc(e,I,S,A)
var L=w.data
L[0]=(t-x.data[0])*x.data[4]
L[1]=(r-x.data[1])*x.data[5]
L[2]=a[0]
L[3]=a[1]
L[4]=a[2]
L[5]=a[3]
L[6]=i
L[7]=o
L[8]=(n-x.data[0])*x.data[4]
L[9]=(s-x.data[1])*x.data[5]
L[10]=l[0]
L[11]=l[1]
L[12]=l[2]
L[13]=l[3]
L[14]=c
L[15]=_
L[16]=(u-x.data[0])*x.data[4]
L[17]=(d-x.data[1])*x.data[5]
L[18]=f[0]
L[19]=f[1]
L[20]=f[2]
L[21]=f[3]
L[22]=v
L[23]=h
L[24]=(p-x.data[0])*x.data[4]
L[25]=(m-x.data[1])*x.data[5]
L[26]=g[0]
L[27]=g[1]
L[28]=g[2]
L[29]=g[3]
L[30]=E
L[31]=y
w.x=L[0]
w.y=L[1]
w.queue(T)
return w}function queueraw4(e,t,r,a,i,o,n,s,l,c,_,u,d,f,v,h,p,m){return queueraw4color(e,t,r,v,_,u,a,i,v,_,f,o,n,v,d,f,s,l,v,d,u,c,h,p,m)}function queueSpriteData(e,t){R(isFinite(t))
var r=e.data
r[0]=(r[0]-x.data[0])*x.data[4]
r[1]=(r[1]-x.data[1])*x.data[5]
r[8]=(r[8]-x.data[0])*x.data[4]
r[9]=(r[9]-x.data[1])*x.data[5]
r[16]=(r[16]-x.data[0])*x.data[4]
r[17]=(r[17]-x.data[1])*x.data[5]
r[24]=(r[24]-x.data[0])*x.data[4]
r[25]=(r[25]-x.data[1])*x.data[5]
e.x=r[0]
e.y=r[1]
e.queue(t)
return e}function queueraw4colorBuffer(e,t,r,a,i,o){R(isFinite(r))
var n=spriteDataAlloc(e,a,i,o)
var s=n.data
for(var l=0;l<32;++l)s[l]=t[l]
queueSpriteData(n,r)
return n}function queueraw(e,t,r,a,i,o,n,s,l,c,_,u,d,f){return queueraw4color(e,t,r,_,n,s,t,r+o,_,n,c,t+i,r+o,_,l,c,t+i,r,_,l,s,a,u,d,f)}var U=S()
function fillUVs(e,t,r,a,i){var o=0
var n=0
if(!a&&!e.nozoom){var s=_((i[2]-i[0])*e.width/t,(i[3]-i[1])*e.height/r)
if(s<1){if(e.filter_mag===gl.LINEAR)o=n=.5
else if(e.filter_mag===gl.NEAREST)if(l.antialias)o=n=s/2
else o=n=.01*s}else if(s>1)o=n=.5+s/2
if(i[0]>i[2])o*=-1
if(i[1]>i[3])n*=-1}U[0]=i[0]+o/e.width
U[1]=i[1]+n/e.height
U[2]=i[2]-o/e.width
U[3]=i[3]-n/e.height}var G={}
function queuesprite4colorObj(){var e=G.rot,t=G.z,r=G.sprite,a=G.color_ul,i=G.color_ll,o=G.color_lr,n=G.color_ur
R(isFinite(t))
var s=spriteDataAlloc(r.texs,G.shader,G.shader_params,G.blend)
var l=(G.x-x.data[0])*x.data[4]
var c=(G.y-x.data[1])*x.data[5]
var _=G.w*x.data[4]
var u=G.h*x.data[5]
if(G.pixel_perfect){l|=0
c|=0
_|=0
u|=0}s.x=l
s.y=c
var d=s.data
if(!e){var f=l-r.origin[0]*_
var v=c-r.origin[1]*u
var h=f+_
var p=v+u
d[0]=f
d[1]=v
d[8]=f
d[9]=p
d[16]=h
d[17]=p
d[24]=h
d[25]=v}else{var m=r.origin[0]*_
var g=r.origin[1]*u
var E=O(e)
var y=b(e)
var T=l-E*m+y*g
var I=c-y*m-E*g
var S=E*u
var A=E*_
var w=y*u
var L=y*_
d[0]=T
d[1]=I
d[8]=T-w
d[9]=I+S
d[16]=T+A-w
d[17]=I+L+S
d[24]=T+A
d[25]=I+L}fillUVs(s.texs[0],_,u,G.nozoom,G.uvs)
d[2]=a[0]
d[3]=a[1]
d[4]=a[2]
d[5]=a[3]
d[6]=U[0]
d[7]=U[1]
d[10]=i[0]
d[11]=i[1]
d[12]=i[2]
d[13]=i[3]
d[14]=U[0]
d[15]=U[3]
d[18]=o[0]
d[19]=o[1]
d[20]=o[2]
d[21]=o[3]
d[22]=U[2]
d[23]=U[3]
d[26]=n[0]
d[27]=n[1]
d[28]=n[2]
d[29]=n[3]
d[30]=U[2]
d[31]=U[1]
s.queue(t)
return s}function queuesprite(e,t,r,a,i,o,n,s,l,c,_,u,d,f){l=l||e.color
G.sprite=e
G.x=t
G.y=r
G.z=a
G.w=i
G.h=o
G.rot=n
G.uvs=s
G.color_ul=l
G.color_ll=l
G.color_lr=l
G.color_ur=l
G.shader=c
G.shader_params=_
G.nozoom=u
G.pixel_perfect=d
G.blend=f
return queuesprite4colorObj(G)}var F=E()
var W=E()
function clipCoordsScissor(e,t,r,a){x.virtualToCanvas(F,[e,t])
F[0]=d(F[0])
F[1]=d(F[1])
x.virtualToCanvas(W,[e+r,t+a])
W[0]=d(W[0])-F[0]
W[1]=d(W[1])-F[1]
var i=l.render_height||l.height
return[F[0],i-(F[1]+W[1]),W[0],W[1]]}function clipCoordsDom(e,t,r,a){var i=S()
x.virtualToDom(i,[e+r,t+a])
i[2]=i[0]
i[3]=i[1]
x.virtualToDom(i,[e,t])
i[0]=d(i[0])
i[1]=d(i[1])
i[2]=d(i[2])-i[0]
i[3]=d(i[3])-i[1]
return i}function spriteClip(e,t,r,a,i,o){var n=clipCoordsScissor(r,a,i,o)
spriteQueueFn(e-.01,function(){gl.enable(gl.SCISSOR_TEST)
gl.scissor(n[0],n[1],n[2],n[3])})
spriteQueueFn(t-.01,function(){gl.disable(gl.SCISSOR_TEST)})}var j=[]
function spriteClipped(){return j.length>0}function spriteClipPush(e,t,r,a,i){R(j.length<10)
var o=clipCoordsScissor(t,r,a,i)
var n=clipCoordsDom(t,r,a,i)
x.setInputClipping(n)
spriteQueuePush()
j.push({z:e,scissor:o,dom_clip:n})}function spriteClipPop(){R(spriteClipped())
spriteQueueFn(Z.TOOLTIP-.1,function(){gl.disable(gl.SCISSOR_TEST)})
var e=j.pop(),t=e.z,r=e.scissor
var a=M
spriteQueuePop(true)
if(j.length){var i=j[j.length-1].dom_clip
x.setInputClipping(i)}else x.setInputClipping(null)
spriteQueueFn(t,function(){gl.enable(gl.SCISSOR_TEST)
gl.scissor(r[0],r[1],r[2],r[3])
spriteQueuePush()
M=a
spriteDraw()
spriteQueuePop()})}var H
function spriteClipPause(){R(spriteClipped())
R(!H)
H=true
spriteQueuePush(P[0])
x.setInputClipping(null)
j.push({dom_clip:null})}function spriteClipResume(){R(spriteClipped())
R(H)
j.pop()
H=false
R(spriteClipped())
var e=j[j.length-1].dom_clip
spriteQueuePop(true)
x.setInputClipping(e)}var z
var V
var Y
var q=0
var K=0
var X=0
var Q
var J
var $=65532
var ee=[]
function commit(){if(X===K)return
ee.push({state:z,start:K,end:X})
K=X}function blendModeSet(e){if(Q!==e)if((Q=e)===o)gl.blendFunc(gl.SRC_ALPHA,gl.ONE)
else if(Q===n)gl.blendFunc(gl.ONE,gl.ONE_MINUS_SRC_ALPHA)
else gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA)}function blendModeReset(e){if(Q!==i||e){gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA)
Q=i}}function commitAndFlush(){commit()
if(!ee.length)return
R(X)
V.update(Y,X)
V.bind()
for(var e=0;e<ee.length;++e){var t=ee[e]
var r=t.state,a=t.start,i=t.end
if(J!==r.shader||r.shader_params){h.bind(y,r.shader||T,r.shader_params||L)
J=r.shader}if(Q!==r.blend)blendModeSet(r.blend)
f.bindArray(r.texs);++C.draw_calls_sprite
gl.drawElements(V.mode,3*(i-a)/2,gl.UNSIGNED_SHORT,3*a)}ee.length=0
K=X=0}function drawSetup(){if(l.defines.NOSPRITES)M.length=0
if(!M.length)return
w[0]=2/l.viewport[2]
w[1]=-2/l.viewport[3]
J=Q=-1
if(!V){V=c.create([[h.semantic.POSITION,gl.FLOAT,2,false],[h.semantic.COLOR,gl.FLOAT,4,false],[h.semantic.TEXCOORD,gl.FLOAT,2,false]],[],null,c.QUADS)
Y=new Float32Array(1024)
q=Y.length/8}profilerStart("sort")
M.sort(cmpSprite)
C.sprite_sort_elems+=M.length
profilerStop("sort")
z=null
R.equal(X,0)
R.equal(K,0)
R.equal(ee.length,0)}function growSpriteBuffer(){var e=u(1.25*q+3&-4,$)
q=e
Y=new Float32Array(8*e)}function drawElem(e){var t=0
if(e.fn){commitAndFlush()
z=null
e.fn()
Q=J=-1
R.equal(X,0)
R.equal(K,0)
R.equal(ee.length,0)
w[0]=2/l.viewport[2]
w[1]=-2/l.viewport[3]
t++}else{if(!z||v(e.texs,z.texs)||e.shader!==z.shader||e.shader_params!==z.shader_params||e.blend!==z.blend){commit()
z=e}do{if(X+4>q){commitAndFlush()
if(q!==$)growSpriteBuffer()}var r=8*X
X+=4
Y.set(e.data,r)
t++
D.push(e)
var a=e.next
e.next=null
e=a}while(e)}return t}function finishDraw(){commitAndFlush()
blendModeReset()}function spriteDraw(){profilerStart("sprites:draw")
drawSetup()
profilerStart("drawElem")
for(var e=0;e<M.length;++e)drawElem(M[e])
profilerStop("drawElem")
M.length=0
finishDraw()
profilerStop("sprites:draw")}function spriteDrawPartial(e){profilerStart("sprites:drawPartial")
drawSetup()
profilerStart("drawElem")
for(var t=0;t<M.length;++t){var r=M[t]
if(r.z>e){M=M.slice(t)
break}drawElem(r)}profilerStop("drawElem")
finishDraw()
profilerStop("sprites:drawPartial")}function buildRects(e,t,r){var a=[]
var i=0
for(var o=0;o<e.length;++o)i+=e[o]
var n=0
for(var s=0;s<t.length;++s)n+=t[s]
var l
var c
if(!r||I(r.src_width)===r.width&&I(r.src_height)===r.height){l=I(i)
c=I(n)}else{l=i
c=n}var _=[]
for(var u=0;u<e.length;++u)_.push(e[u]/n)
var d=[]
for(var f=0;f<t.length;++f)d.push(t[f]/i)
var v=[]
var h=false
var p=0
for(var m=0;m<t.length;++m){var g=0
for(var E=0;E<e.length;++E){var y=S(g/l,p/c,(g+e[E])/l,(p+t[m])/c)
a.push(y)
var T=e[E]/t[m]
if(1!==T)h=true
v.push(T)
g+=e[E]}p+=t[m]}return{widths:e,heights:t,wh:_,hw:d,rects:a,aspect:h?v:null,total_w:i,total_h:n}}function Sprite(t){var r=this
if(t.texs)this.texs=t.texs
else{var e=t.ext||".png"
this.texs=[]
if(t.tex)this.texs.push(t.tex)
else if(t.layers){R(t.name)
this.texs=[]
for(var a=0;a<t.layers;++a)this.texs.push(f.load({url:"img/"+t.name+"_"+a+e,filter_min:t.filter_min,filter_mag:t.filter_mag,wrap_s:t.wrap_s,wrap_t:t.wrap_t}))}else if(t.name)this.texs.push(f.load({url:"img/"+t.name+e,filter_min:t.filter_min,filter_mag:t.filter_mag,wrap_s:t.wrap_s,wrap_t:t.wrap_t}))
else{R(t.url)
this.texs.push(f.load(t))}}this.origin=t.origin||E(0,0)
this.size=t.size||E(1,1)
this.color=t.color||S(1,1,1,1)
this.uvs=t.uvs||S(0,0,1,1)
if(!t.uvs)this.texs[0].onLoad(function(e){r.uvs[2]=e.src_width/e.width
r.uvs[3]=e.src_height/e.height})
if(t.ws){this.uidata=buildRects(t.ws,t.hs)
this.texs[0].onLoad(function(e){r.uidata=buildRects(t.ws,t.hs,e)})}this.shader=t.shader||null}Sprite.prototype.draw=function(e){if(0===e.w||0===e.h)return null
var t=(e.w||1)*this.size[0]
var r=(e.h||1)*this.size[1]
var a="number"===typeof e.frame?this.uidata.rects[e.frame]:e.uvs||this.uvs
var i=e.color||this.color
G.sprite=this
G.x=e.x
G.y=e.y
G.z=e.z||Z.UI
G.w=t
G.h=r
G.rot=e.rot
G.uvs=a
G.color_ul=i
G.color_ll=i
G.color_lr=i
G.color_ur=i
G.shader=e.shader||this.shader
G.shader_params=e.shader_params
G.nozoom=e.nozoom
G.pixel_perfect=e.pixel_perfect
G.blend=e.blend
return queuesprite4colorObj(G)}
Sprite.prototype.drawDualTint=function(e){e.shader=A
e.shader_params={color1:e.color1}
return this.draw(e)}
Sprite.prototype.draw4Color=function(e){if(0===e.w||0===e.h)return null
var t=(e.w||1)*this.size[0]
var r=(e.h||1)*this.size[1]
var a="number"===typeof e.frame?this.uidata.rects[e.frame]:e.uvs||this.uvs
G.sprite=this
G.x=e.x
G.y=e.y
G.z=e.z||Z.UI
G.w=t
G.h=r
G.rot=e.rot
G.uvs=a
G.color_ul=e.color_ul
G.color_ll=e.color_ll
G.color_lr=e.color_lr
G.color_ur=e.color_ur
G.shader=e.shader||this.shader
G.shader_params=e.shader_params
G.nozoom=e.nozoom
G.pixel_perfect=e.pixel_perfect
G.blend=e.blend
return queuesprite4colorObj(G)}
Sprite.prototype.draw3D=function(e){if("number"===typeof e.frame)e.uvs=this.uidata.rects[e.frame]
else if(!e.uvs)e.uvs=this.uvs
s(this,e)}
function spriteCreate(e){return new Sprite(e)}function spriteStartup(){C=c.stats
w[2]=-1
w[3]=1
r.sprite_vshader=y=h.create("shaders/sprite.vp")
r.sprite_fshader=T=h.create("shaders/sprite.fp")
A=h.create("shaders/sprite_dual.fp")
h.prelink(y,T)
h.prelink(y,A)}},{"../common/util.js":330,"../common/vmath.js":332,"./camera2d.js":241,"./dyn_geom.js":247,"./engine.js":250,"./geom.js":263,"./shaders.js":293,"./textures.js":304,assert:void 0}],303:[function(e,t,r){"use strict"
r.isFirstSession=isFirstSession
r.create=create
var _=e("assert")
var a=e("../common/chunked_send")
var i=a.chunkedReceiverFinish
var o=a.chunkedReceiverFreeFile
var n=a.chunkedReceiverGetFile
var s=a.chunkedReceiverInit
var l=a.chunkedReceiverOnChunk
var c=a.chunkedReceiverStart
var u=e("../common/dot-prop")
var d=e("../common/md5")
var f=e("../common/packet").isPacket
var v=e("../common/perfcounters").perfCounterAdd
var h=e("../common/tiny-events")
var p=e("../common/util")
var m=e("../common/util").errorString
var g=e("./external_users_client")
var E=g.externalUsersAutoLoginProvider
var y=g.externalUsersCurrentUser
var T=g.externalUsersEnabled
var I=g.externalUsersLogIn
var S=g.externalUsersLogOut
var A=e("./local_storage")
var w=e("./net").netDisconnectedRaw
var L=e("./walltime")
var R=false
function isFirstSession(){return R}function ClientChannelWorker(e,t,r,a){h.call(this)
this.subs=e
this.channel_id=t
this.subscriptions=0
this.subscribe_failed=false
this.got_subscribe=false
this.immediate_subscribe=0
this.channel_data_ver=0
this.handlers=Object.create(r)
this.base_event_listeners=a
this.data={}}p.inherits(ClientChannelWorker,h)
ClientChannelWorker.prototype.emit=function(e){var t=arguments
h.prototype.emit.apply(this,t)
if(this.base_event_listeners){var r=this.base_event_listeners[e]
if(r)for(var a=0;a<r.length;++a)r[a].apply(this,Array.prototype.slice.call(t,1))}}
ClientChannelWorker.prototype.onSubscribe=function(e){_(this.subscriptions||this.autosubscribed)
this.on("subscribe",e)
if(this.got_subscribe)e(this.data)}
ClientChannelWorker.prototype.onceSubscribe=function(e){_(this.subscriptions||this.autosubscribed)
if(this.got_subscribe)e(this.data)
else this.once("subscribe",e)}
ClientChannelWorker.prototype.numSubscriptions=function(){return this.subscriptions}
ClientChannelWorker.prototype.handleChannelData=function(e,t){var r=this
console.log("got channel_data("+this.channel_id+"):  "+JSON.stringify(e))
this.data=e;++this.channel_data_ver
this.emit("channel_data",this.data)
this.got_subscribe=true
this.emit("subscribe",this.data)
var a=this.channel_id.split(".")[0]
var i=this.subs.cmds_fetched_by_type
if(i&&!i[a]){i[a]=true
this.send("cmdparse","cmd_list",function(e,t){if(e){console.error("Error getting cmd_list for "+a)
delete i[a]}else r.subs.cmd_parse.addServerCommands(t)})}t()}
ClientChannelWorker.prototype.handleApplyChannelData=function(e,t){if(void 0===e.value)u.delete(this.data,e.key)
else u.set(this.data,e.key,e.value);++this.channel_data_ver
this.emit("channel_data",this.data,e.key,e.value)
t()}
ClientChannelWorker.prototype.handleBatchSet=function(e,t){for(var r=0;r<e.length;++r){var a=e[r],i=a[0],o=a[1]
if(void 0===o)u.delete(this.data.public,i)
else u.set(this.data.public,i,o);++this.channel_data_ver
this.emit("channel_data",this.data,"public."+i,o)}t()}
ClientChannelWorker.prototype.getChannelData=function(e,t){return u.get(this.data,e,t)}
ClientChannelWorker.prototype.setChannelData=function(e,t,r,a){if(!r)u.set(this.data,e,t)
var i=t&&t.q||void 0
var o=this.subs.client.pak("set_channel_data")
o.writeAnsiString(this.channel_id)
o.writeBool(i)
o.writeAnsiString(e)
o.writeJSON(t)
o.send(a)}
ClientChannelWorker.prototype.removeMsgHandler=function(e,t){_(this.handlers[e]===t)
delete this.handlers[e]}
ClientChannelWorker.prototype.onMsg=function(e,t){_(!this.handlers[e]||this.handlers[e]===t)
this.handlers[e]=t}
ClientChannelWorker.prototype.pak=function(e){var t=this.subs.client.pak("channel_msg")
t.writeAnsiString(this.channel_id)
t.writeAnsiString(e)
return t}
ClientChannelWorker.prototype.send=function(e,t,r,a){_(!r||"function"===typeof r)
_(!a)
this.subs.client.send("channel_msg",{channel_id:this.channel_id,msg:e,data:t},r)}
ClientChannelWorker.prototype.cmdParse=function(e,t){this.send("cmdparse",e,t)}
ClientChannelWorker.prototype.unsubscribe=function(){this.subs.unsubscribe(this.channel_id)}
function SubscriptionManager(e,t){h.call(this)
this.client=e
this.channels={}
this.logged_in=false
this.login_credentials=null
this.logged_in_username=null
this.logged_in_display_name=null
this.was_logged_in=false
this.logging_in=false
this.logging_out=false
this.auto_create_user=false
this.allow_anon=false
this.no_auto_login=false
this.auto_login_error=void 0
if(this.cmd_parse=t)this.cmds_fetched_by_type={}
this.base_handlers={}
this.channel_handlers={}
this.channel_event_listeners={}
this.first_connect=true
this.server_time=0
this.server_time_interp=0
this.cack_data={}
e.onMsg("connect",this.handleConnect.bind(this))
e.onMsg("disconnect",this.handleDisconnect.bind(this))
e.onMsg("channel_msg",this.handleChannelMessage.bind(this))
e.onMsg("server_time",this.handleServerTime.bind(this))
e.onMsg("chat_broadcast",this.handleChatBroadcast.bind(this))
e.onMsg("restarting",this.handleRestarting.bind(this))
if(t)e.onMsg("csr_to_client",this.handleCSRToClient.bind(this))
this.chunked=null
e.onMsg("upload_start",this.handleUploadStart.bind(this))
e.onMsg("upload_chunk",this.handleUploadChunk.bind(this))
e.onMsg("upload_finish",this.handleUploadFinish.bind(this))
this.onChannelMsg(null,"channel_data",ClientChannelWorker.prototype.handleChannelData)
this.onChannelMsg(null,"apply_channel_data",ClientChannelWorker.prototype.handleApplyChannelData)
this.onChannelMsg(null,"batch_set",ClientChannelWorker.prototype.handleBatchSet)}p.inherits(SubscriptionManager,h)
SubscriptionManager.prototype.onceConnected=function(e){if(this.client.connected&&1===this.client.socket.readyState)return void e()
this.once("connect",e)}
SubscriptionManager.prototype.getBaseHandlers=function(e){var t=this.channel_handlers[e]
if(!t)t=this.channel_handlers[e]=Object.create(this.base_handlers)
return t}
SubscriptionManager.prototype.onChannelMsg=function(e,t,r){var a=e?this.getBaseHandlers(e):this.base_handlers
_(!a[t])
a[t]=r}
SubscriptionManager.prototype.onChannelEvent=function(e,t,r){var a=this.channel_event_listeners[e]
if(!a)a=this.channel_event_listeners[e]={}
if(!a[t])a[t]=[]
a[t].push(r)}
SubscriptionManager.prototype.handleChatBroadcast=function(e){console.error("["+e.src+"] "+e.msg)
this.emit("chat_broadcast",e)}
SubscriptionManager.prototype.handleRestarting=function(e){this.restarting=e
this.emit("restarting",e)}
SubscriptionManager.prototype.handleDisconnect=function(e){this.emit("disconnect",e)}
SubscriptionManager.prototype.handleConnect=function(e){var r=this
var a=false
if(this.first_connect)this.first_connect=false
else a=true
this.restarting=Boolean(e.restarting)
this.cack_data=e
L.sync(e.time)
if(w())return
var i=this
function resub(){var e=function _loop(t){var r=i.channels[t]
if(r.subscriptions)i.client.send("subscribe",t,function(e){if(e){r.subscribe_failed=true
console.error("Error subscribing to "+t+": "+e)
r.emit("subscribe_fail",e)}})}
for(var t in i.channels)e(t)
i.emit("connect",a)}if(this.logging_in);else if(this.was_logged_in)this.loginInternal(this.login_credentials,function(e){if(e&&"ERR_FAILALL_DISCONNECT"===e);else if(e){r.auto_login_error=e
var t=r.login_credentials&&r.login_credentials.password?"user_id, password":JSON.stringify(r.login_credentials)
_(false,"Login failed for "+t+": "+m(e))}else resub()})
else if(!this.no_auto_login){var t=E()
if(t&&T(t))this.loginExternal(t,function(e){r.auto_login_error=e})
else if(A.get("name")&&A.get("password"))this.login(A.get("name"),A.get("password"),function(e){r.auto_login_error=e})
else if(A.get("login_external")){this.login_credentials={provider:A.get("login_external")}
this.loginInternal(this.login_credentials,function(e){if(e){r.auto_login_error=e
S()}})}resub()}else resub()
this.fetchCmds()}
SubscriptionManager.prototype.fetchCmds=function(){var r=this
var e="client"
var t=this.cmds_fetched_by_type
if(t&&!t[e]){t[e]=true
this.client.send("cmd_parse_list_client",null,function(e,t){if(!e)r.cmd_parse.addServerCommands(t)})}}
SubscriptionManager.prototype.handleChannelMessage=function(e,t){_(f(e))
var r=e.readAnsiString()
var a=e.readAnsiString()
var i=e.readBool()
var o=i?e:e.readJSON()
if(!o||!o.q){var n
if(!i)n=JSON.stringify(o)
else if("function"===typeof o.contents)n=o.contents()
else n="(pak)"
console.log("got channel_msg("+r+") "+a+": "+n)}var s=this.getChannel(r)
var l=s.handlers[a]
if(!l){console.error("no handler for channel_msg("+r+") "+a+": "+JSON.stringify(o))
return}var c=r.split(".")[0]+"."+a
v("cm."+c)
profilerStart(c)
l.call(s,o,t)
profilerStop(c)}
SubscriptionManager.prototype.handleServerTime=function(e){this.server_time=e.readInt()
if(this.server_time<this.server_time_interp&&this.server_time>this.server_time_interp-250);else this.server_time_interp=this.server_time
L.sync(e.readInt())}
SubscriptionManager.prototype.getServerTime=function(){return this.server_time_interp}
SubscriptionManager.prototype.tick=function(e){this.server_time_interp+=e
for(var t in this.channels){var r=this.channels[t]
if(r.immediate_subscribe)if(e>=r.immediate_subscribe){r.immediate_subscribe=0
this.unsubscribe(t)}else r.immediate_subscribe-=e}}
SubscriptionManager.prototype.onUploadProgress=function(e,t){var a=this
if(!this.upload_progress_cbs)this.upload_progress_cbs={}
_(!this.upload_progress_cbs[e])
this.upload_progress_cbs[e]=t
if(!this.chunked)this.chunked=s("client_receive",Infinity)
if(!this.chunked.on_progress)this.chunked.on_progress=function(e,t,r){if(a.upload_progress_cbs[r])a.upload_progress_cbs[r](e,t)}}
SubscriptionManager.prototype.handleUploadStart=function(e,t){if(!this.chunked)this.chunked=s("client_receive",Infinity)
c(this.chunked,e,t)}
SubscriptionManager.prototype.handleUploadChunk=function(e,t){l(this.chunked,e,t)}
SubscriptionManager.prototype.handleUploadFinish=function(e,t){i(this.chunked,e,t)}
SubscriptionManager.prototype.uploadGetFile=function(e){return n(this.chunked,e)}
SubscriptionManager.prototype.uploadFreeFile=function(e){return o(e)}
SubscriptionManager.prototype.subscribe=function(e){this.getChannel(e,true)}
SubscriptionManager.prototype.getChannel=function(t,e){var r=this.channels[t]
if(!r){var a=t.split(".")[0]
var i=this.getBaseHandlers(a)
var o=this.channel_event_listeners[a]
r=this.channels[t]=new ClientChannelWorker(this,t,i,o)}if(e){r.subscriptions++
if(!w()&&1===r.subscriptions){r.subscribe_failed=false
this.client.send("subscribe",t,function(e){if(e){r.subscribe_failed=true
console.error("Error subscribing to "+t+": "+e)
r.emit("subscribe_fail",e)}})}}return r}
SubscriptionManager.prototype.getUserId=function(){return this.loggedIn()}
SubscriptionManager.prototype.getDisplayName=function(){return this.logged_in_display_name}
SubscriptionManager.prototype.getLoginProvider=function(){return this.login_provider}
SubscriptionManager.prototype.getMyUserChannel=function(){var e=this.loggedIn()
if(!e)return null
var t=this.getChannel("user."+e)
if(!this.logging_out)t.autosubscribed=true
return t}
SubscriptionManager.prototype.unsubscribe=function(e){var t=this.channels[e]
_(t)
_(t.subscriptions)
t.subscriptions--
if(!t.subscriptions)t.got_subscribe=false
if(!w()&&!t.subscriptions&&!t.subscribe_failed)this.client.send("unsubscribe",e)}
SubscriptionManager.prototype.getChannelImmediate=function(e,t){t=t||6e4
var r=this.getChannel(e)
if(!r.immediate_subscribe)this.subscribe(e)
r.immediate_subscribe=t
return r}
SubscriptionManager.prototype.onLogin=function(e){this.on("login",e)
if(this.logged_in)return void e()}
SubscriptionManager.prototype.loggedIn=function(){return this.logging_out?false:this.logged_in?this.logged_in_username||"missing_name":false}
SubscriptionManager.prototype.userOnChannelData=function(e,t,r,a){if(e!==this.getUserId())return
if("public.display_name"===r)this.logged_in_display_name=a}
SubscriptionManager.prototype.handleLoginResponse=function(e,t,r){var a=this
this.logging_in=false
if(!t){R=r.first_session
this.logged_in_username=r.user_id
this.logged_in_display_name=r.display_name
this.logged_in=true
this.was_logged_in=true
var i=this.getMyUserChannel()
i.onceSubscribe(function(){if(!a.did_master_subscribe&&i.getChannelData("public.permissions.sysadmin")){a.did_master_subscribe=true
a.subscribe("master.master")
a.subscribe("global.global")}})
if(!i.subs_added_user_on_channel_data){i.on("channel_data",this.userOnChannelData.bind(this,this.logged_in_username))
i.subs_added_user_on_channel_data=true}this.emit("login")}else this.emit("login_fail",t)
e(t)}
SubscriptionManager.prototype.loginInternal=function(e,i){var o=this
if(this.logging_in)return void i("Login already in progress")
this.logging_in=true
this.logged_in=false
if(e.provider){var n=e.provider
return void I(n,true,function(e,a){if(e)return void o.handleLoginResponse(i,e)
A.set("login_external",o.login_provider=n)
y(n,function(e,t){if(e);if(w())return void o.handleLoginResponse(i,"ERR_DISCONNECTED")
var r={provider:n,validation_data:a.validation_data,display_name:t.name}
o.client.send("login_external",r,o.handleLoginResponse.bind(o,i))})})}else this.client.send("login",{user_id:e.user_id,password:d(this.client.secret+e.password)},this.handleLoginResponse.bind(this,i))}
SubscriptionManager.prototype.userCreateInternal=function(e,t){if(this.logging_in)return t("Login already in progress")
this.logging_in=true
this.logged_in=false
return this.client.send("user_create",e,this.handleLoginResponse.bind(this,t))}
function hashedPassword(e,t){if("prehashed"===t.split("$$")[0])t=t.split("$$")[1]
else t=d(d(e.toLowerCase())+t)
return t}SubscriptionManager.prototype.login=function(r,a,i){var o=this
if(!(r=(r||"").trim()))return i("Missing username")
if(!(a=(a||"").trim()))return i("Missing password")
var e=hashedPassword(r,a)
if(e!==a)A.set("password","prehashed$$"+e)
this.login_credentials={user_id:r,password:e}
if(!this.auto_create_user)return this.loginInternal(this.login_credentials,i)
return this.loginInternal(this.login_credentials,function(e,t){if(!e||"ERR_USER_NOT_FOUND"!==e)return void i(e,t)
o.userCreate({user_id:r,password:a,password_confirm:a,email:"autocreate@glovjs.org"},i)})}
SubscriptionManager.prototype.loginExternal=function(e,t){this.login_credentials={provider:e}
return this.loginInternal(this.login_credentials,t)}
SubscriptionManager.prototype.userCreate=function(e,t){e.user_id=(e.user_id||"").trim()
if(!e.user_id)return t("Missing username")
e.password=(e.password||"").trim()
if(!e.password)return t("Missing password")
e.password_confirm=(e.password_confirm||"").trim()
if(!this.auto_create_user&&!e.password_confirm)return t("Missing password confirmation")
e.email=(e.email||"").trim()
if(!this.auto_create_user&&!e.email)return t("Missing email")
e.display_name=(e.display_name||"").trim()
var r=hashedPassword(e.user_id,e.password)
if(r!==e.password)A.set("password","prehashed$$"+r)
if(r!==hashedPassword(e.user_id,e.password_confirm))return t("Passwords do not match")
this.login_credentials={user_id:e.user_id,password:r}
return this.userCreateInternal({display_name:e.display_name||e.user_id,user_id:e.user_id,email:e.email,password:r},t)}
SubscriptionManager.prototype.logout=function(){var t=this
_(this.logged_in)
_(!this.logging_in)
_(!this.logging_out)
if(this.did_master_subscribe){this.did_master_subscribe=false
this.unsubscribe("master.master")
this.unsubscribe("global.global")}for(var e in this.channels){var r=this.channels[e]
if(r.immediate_subscribe){r.immediate_subscribe=0
this.unsubscribe(e)}_(!r.subscriptions,"Remaining active subscription for "+e)
if(r.autosubscribed)r.autosubscribed=false}this.logging_out=true
this.client.send("logout",null,function(e){t.logging_out=false
if(!e){R=false
A.set("password",void 0)
A.set("login_external",t.login_provider=void 0)
t.logged_in=false
t.logged_in_username=null
t.logged_in_display_name=null
t.was_logged_in=false
t.login_credentials=null
t.emit("logout")}})}
SubscriptionManager.prototype.serverLog=function(e,t){var r=this
this.onceConnected(function(){r.client.send("log",{type:e,data:t})})}
SubscriptionManager.prototype.sendCmdParse=function(t,r){var a=this
this.onceConnected(function(){var e=a.client.pak("cmd_parse_auto")
e.writeString(t)
e.send(r)})}
SubscriptionManager.prototype.handleCSRToClient=function(e,r){var a=this
var t=e.readString()
var i=e.readJSON()
this.cmd_parse.handle({access:i},t,function(e,t){if(e&&a.cmd_parse.was_not_found)return r(null,{found:0,err:e})
return r(e,{found:1,resp:t})})}
function create(e,t){return new SubscriptionManager(e,t)}},{"../common/chunked_send":316,"../common/dot-prop":319,"../common/md5":324,"../common/packet":325,"../common/perfcounters":326,"../common/tiny-events":328,"../common/util":330,"./external_users_client":256,"./local_storage":274,"./net":279,"./walltime":308,assert:void 0}],304:[function(e,t,c){"use strict"
c.defaultFilters=defaultFilters
c.textureWhite=textureWhite
c.bind=bind
c.bindArray=bindArray
c.cmpTextureArray=cmpTextureArray
c.isArrayBound=isArrayBound
c.texturesResetState=texturesResetState
c.createForCapture=createForCapture
c.createForDepthCapture=createForDepthCapture
c.load=load
c.cname=cname
c.findTexForReplacement=findTexForReplacement
c.texturesTick=texturesTick
c.texturesUnloadDynamic=texturesUnloadDynamic
c.textureSupportsDepth=textureSupportsDepth
c.startup=startup
c.format=c.load_count=c.textures=void 0
c.textureLoad=load
var h=e("assert")
var _=e("./engine.js")
var a=e("./filewatch.js").filewatchOn
var u=e("./local_storage.js")
var i=e("./settings.js")
var d=e("./shaders.js").setGLErrorReportDetails
var r=e("./urlhash.js")
var o=e("../common/util.js"),p=o.callEach,m=o.isPowerOfTwo,g=o.nextHighestPowerOfTwo,n=o.ridx
var s=3e5
var l={}
c.textures=l
var f=0
c.load_count=f
var v=4
var E=0
var y
var T
var I
var S=[{target:"TEXTURE_CUBE_MAP_NEGATIVE_X",pos:[0,1]},{target:"TEXTURE_CUBE_MAP_POSITIVE_X",pos:[0,0]},{target:"TEXTURE_CUBE_MAP_NEGATIVE_Y",pos:[1,0]},{target:"TEXTURE_CUBE_MAP_POSITIVE_Y",pos:[1,1]},{target:"TEXTURE_CUBE_MAP_NEGATIVE_Z",pos:[2,0]},{target:"TEXTURE_CUBE_MAP_POSITIVE_Z",pos:[2,1]}]
var A={R8:{count:1},RGB8:{count:3},RGBA8:{count:4},DEPTH16:{count:1},DEPTH24:{count:1}}
c.format=A
function defaultFilters(e,t){T=e
I=t}var w=null
var L=[]
var R
var x
var O
function setUnit(e){if(e!==w){gl.activeTexture(gl.TEXTURE0+e)
w=e}}function bindHandle(e,t,r){if(L[e]!==r){setUnit(e)
gl.bindTexture(t,r)
L[e]=r}}function unbindAll(e){for(var t=0;t<L.length;++t){setUnit(t)
gl.bindTexture(e,e===gl.TEXTURE_2D?R:null)
L[t]=null}}function textureWhite(){return l.white}function bind(e,t){t.last_use=O
bindHandle(e,t.target,t.eff_handle)}function bindArray(e){for(var t=0;t<e.length;++t){var r=e[t]
r.last_use=O
var a=r.eff_handle
if(L[t]!==a){if(t!==w){gl.activeTexture(gl.TEXTURE0+t)
w=t}gl.bindTexture(r.target,a)
L[t]=a}}}function cmpTextureArray(e,t){var r=e.length-t.length
if(r)return r
for(var a=0;a<e.length;++a)if(r=e[a].id-t[a].id)return r
return 0}function isArrayBound(e){for(var t=0;t<e.length;++t){var r=e[t].eff_handle
if(L[t]!==r)return false}return true}function texturesResetState(){w=-1
if(_.webgl2)unbindAll(gl.TEXTURE_2D_ARRAY)
unbindAll(gl.TEXTURE_2D)
setUnit(0)}var b=[]
var N=0
function Texture(e){this.id=++N
this.name=e.name
this.loaded=false
this.load_fail=false
this.target=e.target||gl.TEXTURE_2D
this.is_array=this.target===gl.TEXTURE_2D_ARRAY
this.is_cube=this.target===gl.TEXTURE_CUBE_MAP
this.handle=gl.createTexture()
this.eff_handle=R
this.setSamplerState(e)
this.src_width=this.src_height=1
this.width=this.height=1
this.nozoom=e.nozoom||false
this.on_load=[]
this.gpu_mem=0
this.soft_error=e.soft_error||false
this.last_use=O
this.auto_unload=e.auto_unload||false
if(this.auto_unload)b.push(this)
this.format=e.format||A.RGBA8
if(e.data){var t=this.updateData(e.width,e.height,e.data)
if(t){d()
h(false,"Error loading "+e.name+": "+t)}}else{unbindAll(this.target)
if(e.url){this.url=e.url
this.loadURL(e.url)}}}Texture.prototype.updateGPUMem=function(){var e=this.width*this.height*this.format.count
if(this.mipmaps)e*=1.5
var t=e-this.gpu_mem
_.perf_state.gpu_mem.tex+=t
this.gpu_mem=t}
function bindForced(e){var t=e.target
setUnit(0)
L[0]=null
bindHandle(0,t,e.handle)}Texture.prototype.setSamplerState=function(e){var t=this.target
bindForced(this)
this.filter_min=e.filter_min||T
this.filter_mag=e.filter_mag||I
gl.texParameteri(t,gl.TEXTURE_MIN_FILTER,this.filter_min)
gl.texParameteri(t,gl.TEXTURE_MAG_FILTER,this.filter_mag)
this.wrap_s=e.wrap_s||gl.REPEAT
this.wrap_t=e.wrap_t||gl.REPEAT
gl.texParameteri(t,gl.TEXTURE_WRAP_S,this.wrap_s)
gl.texParameteri(t,gl.TEXTURE_WRAP_T,this.wrap_t)
this.mipmaps=this.filter_min>=9984&&this.filter_min<=9987||e.force_mipmaps
if(E)if(this.mipmaps&&e.filter_mag!==gl.NEAREST)gl.texParameterf(gl.TEXTURE_2D,y,v)
else gl.texParameterf(gl.TEXTURE_2D,y,1)}
Texture.prototype.updateData=function updateData(e,t,r){profilerStart("Texture:updateData")
h(!this.destroyed)
bindForced(this)
this.last_use=O
this.src_width=e
this.src_height=t
this.width=e
this.height=t
for(var a=0;a<10&&gl.getError();++a);var i=(!m(e)||!m(t))&&!this.is_array&&!this.is_cube&&!(!this.mipmaps&&this.wrap_s===gl.CLAMP_TO_EDGE&&this.wrap_t===gl.CLAMP_TO_EDGE)
if(i){this.width=g(e)
this.height=g(t)
gl.texImage2D(this.target,0,this.format.internal_type,this.width,this.height,0,this.format.internal_type,this.format.gl_type,null)}if(r instanceof Uint8Array){h(r.length>=e*t*this.format.count)
h(!this.is_cube)
if(this.is_array){var o=t/e
gl.texImage3D(this.target,0,this.format.internal_type,e,e,o,0,this.format.internal_type,this.format.gl_type,r)}else if(i)gl.texSubImage2D(this.target,0,0,0,e,t,this.format.internal_type,this.format.gl_type,r)
else gl.texImage2D(this.target,0,this.format.internal_type,e,t,0,this.format.internal_type,this.format.gl_type,r)}else{if(!r.width){profilerStop()
return"Missing width ("+r.width+') ("'+String(r).slice(0,100)+'")'}if(this.is_cube){h.equal(2*e,3*t)
var n=t/2
var s=document.createElement("canvas")
s.width=n
s.height=n
var l=s.getContext("2d")
for(var c=0;c<S.length;++c){var _=S[c]
l.drawImage(r,_.pos[0]*n,_.pos[1]*n,n,n,0,0,n,n)
gl.texImage2D(gl[_.target],0,this.format.internal_type,this.format.internal_type,this.format.gl_type,s)}}else if(this.is_array){var u=t/e
gl.texImage3D(this.target,0,this.format.internal_type,e,e,u,0,this.format.internal_type,this.format.gl_type,r)
if(gl.getError()){var d=document.createElement("canvas")
d.width=e
d.height=t
d.getContext("2d").drawImage(r,0,0)
gl.texImage3D(this.target,0,this.format.internal_type,e,e,u,0,this.format.internal_type,this.format.gl_type,d)}}else if(i){if(e!==this.width)gl.texSubImage2D(this.target,0,1,0,this.format.internal_type,this.format.gl_type,r)
if(t!==this.height)gl.texSubImage2D(this.target,0,0,1,this.format.internal_type,this.format.gl_type,r)
gl.texSubImage2D(this.target,0,0,0,this.format.internal_type,this.format.gl_type,r)}else gl.texImage2D(this.target,0,this.format.internal_type,this.format.internal_type,this.format.gl_type,r)}var f=null
var v=gl.getError()
if(v)f="GLError("+v+")"
if(!f&&this.mipmaps){gl.generateMipmap(this.target)
if(v=gl.getError())f="GLError("+v+")"}if(!f){this.updateGPUMem()
this.eff_handle=this.handle
this.loaded=true
p(this.on_load,this.on_load=null,this)}profilerStop()
return f}
Texture.prototype.onLoad=function(e){if(this.loaded)e(this)
else this.on_load.push(e)}
var C=4
Texture.prototype.loadURL=function loadURL(i,o){var n=this
h(!n.destroyed)
if(!i.match(/^.{2,7}:/))i=""+r.getURLBase()+i
var s=n.load_gen=(n.load_gen||0)+1
function tryLoad(t){profilerStart("Texture:tryLoad")
var r=false
function done(e){if(!r){r=true
return void t(e)}}var e=new Image
e.onload=function(){profilerStart("Texture:onload")
done(e)
profilerStop()}
function fail(){done(null)}e.onerror=fail
e.crossOrigin="anonymous"
e.src=i
profilerStop()}c.load_count=f+=1
var l=0
function handleLoad(e){if(n.load_gen!==s||n.destroyed){c.load_count=--f
return}var t=""
if(e){n.format=A.RGBA8
if(o)e=o(n,e)
var r=n.updateData(e.width,e.height,e)
if(r){t=": "+r
if(n.is_array&&("GLError(1282)"===r||"GLError(1281)"===r)&&_.webgl2&&!_.DEBUG){u.setJSON("webgl2_disable",{ua:navigator.userAgent,ts:Date.now()})
console.error('Error loading array texture "'+i+'"'+t+", reloading without WebGL2..")
_.reloadSafe()
return}if(!n.for_reload)l=C}else{c.load_count=--f
return}}var a='Error loading texture "'+(i&&i.length>200?i.slice(0,200)+"...":i)+'"'+t
if(++l>C){c.load_count=--f
n.eff_handle=x
n.load_fail=true
console.error(a+(t?"":", retries failed"))
if(n.soft_error)n.err="Load failed"
else{d()
h(false,a)}return}console.error(a+", retrying... ")
setTimeout(tryLoad.bind(null,handleLoad),100*l*l)}tryLoad(handleLoad)}
Texture.prototype.allocFBO=function(e,t){var r=i.fbo_rgba?gl.RGBA:gl.RGB
bindForced(this)
gl.texImage2D(this.target,0,r,e,t,0,r,gl.UNSIGNED_BYTE,null)
this.fbo=gl.createFramebuffer()
gl.bindFramebuffer(gl.FRAMEBUFFER,this.fbo)
gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,this.handle,0)
this.last_use=O
this.src_width=this.width=e
this.src_height=this.height=t
this.updateGPUMem()}
Texture.prototype.allocDepth=function(e,t){bindForced(this)
gl.texImage2D(gl.TEXTURE_2D,0,this.format.internal_type,e,t,0,this.format.format,this.format.gl_type,null)
this.last_use=O
this.src_width=this.width=e
this.src_height=this.height=t
this.updateGPUMem()}
Texture.prototype.captureStart=function(e,t){h(!this.capture)
this.capture={w:e,h:t}
if(this.fbo)gl.bindFramebuffer(gl.FRAMEBUFFER,this.fbo)}
Texture.prototype.captureEnd=function(e,t){h(this.capture)
var r=this.capture
this.capture=null
if(this.fbo)gl.bindFramebuffer(gl.FRAMEBUFFER,null)
else this.copyTexImage(0,0,r.w,r.h)
var a=e?gl.LINEAR:gl.NEAREST
this.setSamplerState({filter_min:a,filter_mag:a,wrap_s:t?gl.REPEAT:gl.CLAMP_TO_EDGE,wrap_t:t?gl.REPEAT:gl.CLAMP_TO_EDGE})}
Texture.prototype.copyTexImage=function(e,t,r,a){h(!this.destroyed)
h(r&&a)
bindHandle(0,this.target,this.handle)
gl.copyTexImage2D(this.target,0,gl.RGB,e,t,r,a,0)
this.last_use=O
this.src_width=this.width=r
this.src_height=this.height=a
this.updateGPUMem()}
Texture.prototype.destroy=function(){if(this.destroyed)return
profilerStart("Texture:destroy")
h(this.name)
var e=this.auto_unload
if(e){this.auto_unload=null
var t=b.indexOf(this)
h(-1!==t)
n(b,t)}delete l[this.name]
unbindAll(this.target)
gl.deleteTexture(this.handle)
if(this.fbo){gl.bindFramebuffer(gl.FRAMEBUFFER,null)
gl.deleteFramebuffer(this.fbo)}this.width=this.height=0
this.updateGPUMem()
this.destroyed=true
if("function"===typeof e)e()
profilerStop("Texture:destroy")}
function create(e){h(e.name)
var t=new Texture(e)
return l[e.name]=t}var M=0
function createForCapture(e,t){var r=e||"screen_temporary_tex_"+ ++M
h(!l[r])
var a=create({filter_min:gl.NEAREST,filter_mag:gl.NEAREST,wrap_s:gl.CLAMP_TO_EDGE,wrap_t:gl.CLAMP_TO_EDGE,format:A.RGB8,name:r,auto_unload:t})
a.loaded=true
a.eff_handle=a.handle
return a}function createForDepthCapture(e,t){var r=e||"screen_temporary_tex_"+ ++M
h(!l[r])
var a=create({filter_min:gl.NEAREST,filter_mag:gl.NEAREST,wrap_s:gl.CLAMP_TO_EDGE,wrap_t:gl.CLAMP_TO_EDGE,format:t,name:r})
a.loaded=true
a.eff_handle=a.handle
return a}function load(e){var t=e.name=e.name||e.url
h(t)
var r=l[t]
if(!r)r=create(e)
r.last_use=O
return r}function cname(e){var t=e.lastIndexOf("/")
if(-1!==t)e=e.slice(t+1)
if(-1!==(t=e.indexOf(".")))e=e.slice(0,t)
return e.toLowerCase()}function findTexForReplacement(e){e=cname(e)
for(var t in l)if(cname(t)===e)return l[t]
return null}var D=0
function texturesTick(){O=_.frame_timestamp
var e=b.length
if(!e)return
if(D>=e)D=0
var t=b[D]
if(t.last_use<O-s){console.log("Unloading texture "+t.name)
t.destroy()}else++D}function texturesUnloadDynamic(){while(b.length)b[0].destroy()}function textureReload(e){var t=l[e]
if(t&&t.url){t.for_reload=true
t.loadURL(t.url+"?rl="+Date.now())
return true}return false}var P
function textureSupportsDepth(){return P}function startup(){T=gl.LINEAR_MIPMAP_LINEAR
I=gl.LINEAR
A.R8.internal_type=gl.LUMINANCE
A.R8.gl_type=gl.UNSIGNED_BYTE
A.RGB8.internal_type=gl.RGB
A.RGB8.gl_type=gl.UNSIGNED_BYTE
A.RGBA8.internal_type=gl.RGBA
A.RGBA8.gl_type=gl.UNSIGNED_BYTE
var e
if(_.webgl2){P=true
e=gl.UNSIGNED_INT_24_8}else{var t=gl.getExtension("WEBGL_depth_texture")
if(t){e=t.UNSIGNED_INT_24_8_WEBGL
P=true}}if(P){A.DEPTH16.internal_type=_.webgl2?gl.DEPTH_COMPONENT16:gl.DEPTH_COMPONENT
A.DEPTH16.format=gl.DEPTH_COMPONENT
A.DEPTH16.gl_type=gl.UNSIGNED_SHORT
A.DEPTH24.internal_type=_.webgl2?gl.DEPTH24_STENCIL8:gl.DEPTH_STENCIL
A.DEPTH24.format=gl.DEPTH_STENCIL
A.DEPTH24.gl_type=e}var r=gl.getExtension("EXT_texture_filter_anisotropic")||gl.getExtension("MOZ_EXT_texture_filter_anisotropic")||gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")
if(r){y=r.TEXTURE_MAX_ANISOTROPY_EXT
v=E=gl.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}x=load({name:"error",width:2,height:2,nozoom:true,format:A.RGBA8,filter_mag:gl.NEAREST,data:new Uint8Array([255,20,147,255,255,0,0,255,255,255,255,255,255,20,147,255])}).handle
R=load({name:"loading",width:2,height:2,nozoom:true,format:A.RGBA8,data:new Uint8Array([127,127,127,255,0,0,0,255,64,64,64,255,127,127,127,255])}).handle
load({name:"white",width:2,height:2,nozoom:true,format:A.RGBA8,data:new Uint8Array([255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255])})
load({name:"invisible",width:2,height:2,nozoom:true,format:A.RGBA8,data:new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0])})
a(".png",textureReload)}},{"../common/util.js":330,"./engine.js":250,"./filewatch.js":259,"./local_storage.js":274,"./settings.js":291,"./shaders.js":293,"./urlhash.js":307,assert:void 0}],305:[function(e,t,r){"use strict"
r.queue=queue
r.render=render
r.active=active
r.fade=fade
r.splitScreen=splitScreen
r.pixelate=pixelate
r.randomTransition=randomTransition
r.CONTINUE=r.REMOVE=r.IMMEDIATE=void 0
var n=e("assert")
var f=e("./camera2d.js")
var _=e("./engine.js")
var a=e("./effects.js"),i=a.applyCopy,u=a.effectsQueue,o=a.effectsIsFinal
var s=e("./framebuffer.js"),l=s.framebufferCapture,c=s.framebufferStart,d=s.framebufferEnd,v=s.temporaryTextureClaim
var h=Math.floor,p=Math.min,m=Math.pow,g=Math.random
var E=e("./sprites.js")
var y=e("./shaders.js")
var T=e("./textures.js")
var I=e("./ui.js")
var S=e("../common/util.js").easeOut
var A=e("../common/vmath.js"),w=A.unit_vec,L=A.vec4
var R=e("../common/verify.js")
var x=[]
var O="immediate"
r.IMMEDIATE=O
var b="remove"
r.REMOVE=b
var N="continue"
r.CONTINUE=N
var C={transition_pixelate:{fp:"shaders/transition_pixelate.fp"}}
function getShader(e){var t=C[e]
if(!t.shader)t.shader=y.create(t.fp)
return t.shader}function GlovTransition(e,t){this.z=e
this.capture=null
this.func=t
this.accum_time=0}function transitionCapture(e){n(!e.capture)
e.capture=T.createForCapture()
l(e.capture)}function transitionCaptureFramebuffer(e){n(!e.capture)
e.capture=d()
v(e.capture)
if(e.capture.fbo)i({source:e.capture,final:o()})
else c({width:e.capture.width,height:e.capture.height,final:o()})}function queue(e,t){n(!_.had_3d_this_frame)
var r=false
if(e===O){r=true
e=Z.TRANSITION_FINAL}for(var a=0;a<x.length;++a){var i=x[a]
if(i.z===e)if(!R(i.capture))return false}var o=new GlovTransition(e,t)
x.push(o)
if(r)transitionCapture(o)
else u(e+Z.TRANSITION_RANGE,transitionCaptureFramebuffer.bind(null,o))
return true}function destroyTexture(e){profilerStart("transition:destroyTexture")
e.destroy()
profilerStop()}function render(e){e=p(e,100)
for(var t=0;t<x.length;++t){var r=x[t]
r.accum_time+=e
n(r.capture)
var a=t<x.length-1
if(r.func(r.z,r.capture,r.accum_time,a)===b){setTimeout(destroyTexture.bind(null,r.capture),0)
x.splice(t,1)
t--}}}function active(){return x.length}function glovTransitionFadeFunc(e,t,r,a,i){var o=p(a/e,1)
var n=1-S(o,2)
var s=L(1,1,1,n)
f.setNormalized()
E.queueraw4([r],0,0,0,1,1,1,1,0,t,0,1,1,0,s)
if(i||1===o)return b
return N}function glovTransitionSplitScreenFunc(e,t,r,a,i,o,n){var s=L(1,1,1,1)
var l=S(p(o/e,1),2)
f.setNormalized()
var c=[[0,1],[1,0]]
var _=l
var u=c[0][1]+(c[1][1]-c[0][1])/2
if(r){E.queueraw([i],0,0,a,1-_,.5,0,c[0][1],c[1][0]*(1-l),u,w)
E.queueraw([i],0+_,.5,a,1-_,.5,c[1][0]*l,u,c[1][0],c[1][1],w)}else{E.queueraw([i],0-_,0,a,1,.5,c[0][0],c[0][1],c[1][0],u,w)
E.queueraw([i],0+_,.5,a,1,.5,c[0][0],u,c[1][0],c[1][1],w)}var d=p(4*l,1)
s[3]=d
I.drawRect(0,.5-(t*=d),1-_,.5,a+1,s)
I.drawRect(1-_-t,0,1-_,.5,a+1,s)
I.drawRect(_,.5,1,.5+t,a+1,s)
I.drawRect(_,.5,_+t,1,a+1,s)
if(n||1===l)return b
return N}var M=1
var D=[null]
function transitionPixelateCapture(){var e=d()
c({width:e.width,height:e.height,final:o()})
D[0]=e}function glovTransitionPixelateFunc(e,t,r,a,i){var o=_.width
var n=p(a/e,1)
f.setNormalized()
D[0]=r
if(n>.5)u(t,transitionPixelateCapture)
var s=m(2,h(2*(n>.5?1-n:n)*8.9))/1024*o*M
var l=L(r.width/s,r.height/s,s/r.width,s/r.height)
var c=L(.5/r.width,.5/r.height,(r.texSizeX-1)/r.width,(r.texSizeY-1)/r.height)
E.queueraw(D,0,0,t+1,1,1,0,1,1,0,w,getShader("transition_pixelate"),{param0:l,param1:c})
if(i||1===n)return b
return N}function fade(e){return glovTransitionFadeFunc.bind(null,e)}function splitScreen(e,t,r){t/=f.w()
return glovTransitionSplitScreenFunc.bind(null,e,t,r)}function pixelate(e){return glovTransitionPixelateFunc.bind(null,e)}function randomTransition(e){e=e||1
switch(h(3*g())){case 0:return fade(500*e)
case 1:return splitScreen(250*e,2,false)
case 2:return pixelate(750*e)
default:n(0)}return null}},{"../common/util.js":330,"../common/verify.js":331,"../common/vmath.js":332,"./camera2d.js":241,"./effects.js":249,"./engine.js":250,"./framebuffer.js":261,"./shaders.js":293,"./sprites.js":302,"./textures.js":304,"./ui.js":306,assert:void 0}],306:[function(e,t,s){"use strict"
s.makeColorSet=makeColorSet
s.addHook=addHook
s.getUIElemData=getUIElemData
s.setFontStyles=setFontStyles
s.uiFontStyleNormal=uiFontStyleNormal
s.uiFontStyleFocused=uiFontStyleFocused
s.uiFontStyleDisabled=uiFontStyleDisabled
s.uiFontStyleModal=uiFontStyleModal
s.buttonWasFocused=buttonWasFocused
s.colorSetSetShades=colorSetSetShades
s.uiGetFontStyleFocused=uiGetFontStyleFocused
s.uiSetFontStyleFocused=uiSetFontStyleFocused
s.loadUISprite=loadUISprite
s.loadUISprite2=loadUISprite2
s.setButtonsDefaultLabels=setButtonsDefaultLabels
s.setProvideUserStringDefaultMessages=setProvideUserStringDefaultMessages
s.suppressNewDOMElemWarnings=suppressNewDOMElemWarnings
s.uiGetDOMElem=uiGetDOMElem
s.uiBindSounds=uiBindSounds
s.drawHBox=drawHBox
s.drawVBox=drawVBox
s.drawBox=drawBox
s.drawMultiPartBox=drawMultiPartBox
s.playUISound=playUISound
s.focusCanvas=focusCanvas
s.uiHandlingNav=uiHandlingNav
s.panel=panel
s.drawTooltip=drawTooltip
s.drawTooltipBox=drawTooltipBox
s.progressBar=progressBar
s.buttonShared=buttonShared
s.buttonBackgroundDraw=buttonBackgroundDraw
s.buttonSpotBackgroundDraw=buttonSpotBackgroundDraw
s.buttonTextDraw=buttonTextDraw
s.buttonText=buttonText
s.buttonImage=buttonImage
s.button=button
s.print=print
s.label=label
s.modalDialog=modalDialog
s.modalDialogClear=modalDialogClear
s.modalTextEntry=modalTextEntry
s.createEditBox=createEditBox
s.isMenuUp=isMenuUp
s.menuUp=menuUp
s.copyTextToClipboard=copyTextToClipboard
s.provideUserString=provideUserString
s.drawRect=drawRect
s.drawRect2=drawRect2
s.drawRect4Color=drawRect4Color
s.drawElipse=drawElipse
s.drawCircle=drawCircle
s.drawHollowCircle=drawHollowCircle
s.drawLine=drawLine
s.drawHollowRect=drawHollowRect
s.drawHollowRect2=drawHollowRect2
s.drawCone=drawCone
s.setFontHeight=setFontHeight
s.scaleSizes=scaleSizes
s.setPanelPixelScale=setPanelPixelScale
s.setModalSizes=setModalSizes
s.setTooltipWidth=setTooltipWidth
s.button_last_color=s.menu_up=s.button_click=s.button_focused=s.button_mouseover=s.color_panel=s.color_button=s.sprites=s.title_font=s.font=s.tooltip_pad=s.tooltip_width=s.tooltip_panel_pixel_scale=s.panel_pixel_scale=s.modal_pad=s.modal_title_scale=s.modal_y0=s.modal_width=s.button_img_size=s.modal_button_width=s.button_width=s.font_height=s.button_height=s.internal=s.LINE_CAP_ROUND=s.LINE_CAP_SQUARE=s.LINE_ALIGN=s.Z_MIN_INC=s.Z=void 0
var r
function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]
for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))e[a]=r[a]}return e}).apply(this,arguments)}window.Z=window.Z||{}
var W=window.Z
s.Z=W
var p=1e-5
s.Z_MIN_INC=p
W.BORDERS=W.BORDERS||90
W.UI=W.UI||100
W.MODAL=W.MODAL||1e3
W.TOOLTIP=W.TOOLTIP||2e3
W.DEBUG=W.DEBUG||9800
W.TRANSITION_FINAL=W.TRANSITION_FINAL||9900
W.TRANSITION_RANGE=W.TRANSITION_RANGE||10
W.FPSMETER=W.FPSMETER||1e4
var z=1
s.LINE_ALIGN=z
var V=2
s.LINE_CAP_SQUARE=V
var Y=4
s.LINE_CAP_ROUND=Y
var a={checkHooks:checkHooks,cleanupDOMElems:cleanupDOMElems,uiEndFrame:uiEndFrame,uiSetFonts:uiSetFonts,uiStartup:uiStartup,uiTick:uiTick}
s.internal=a
var I=e("assert")
var q=e("./camera2d.js")
var i=e("./edit_box.js"),n=i.editBoxCreate,l=i.editBoxTick
var o=e("./effects.js")
var c=o.effectsQueue
var K=e("./engine.js")
var Z=e("./font.js")
var _=Z.fontSetDefaultSize,u=Z.fontStyle,d=Z.fontStyleColored
var j=e("./input.js")
var f=e("./link.js").linkTick
var v=e("./localization.js").getStringFromLocalizable
var X=Math.abs,h=Math.floor,S=Math.max,Q=Math.min,J=Math.round,$=Math.sqrt
var m=e("./scroll_area.js").scrollAreaSetPixelScale
var g=e("./slider.js").sliderSetDefaultShrink
var E=e("./sound.js"),y=E.soundLoad,T=E.soundPlay
var A=e("./spot.js"),w=A.SPOT_DEFAULT_BUTTON,L=A.SPOT_DEFAULT_BUTTON_DRAW_ONLY,R=A.SPOT_DEFAULT_LABEL,x=A.SPOT_STATE_REGULAR,O=A.SPOT_STATE_DOWN,b=A.SPOT_STATE_FOCUSED,N=A.SPOT_STATE_DISABLED,C=A.spot,M=A.spotEndOfFrame,D=A.spotKey,P=A.spotPadMode,k=A.spotPadSuppressed,B=A.spotTopOfFrame,U=A.spotUnfocus
var ee=e("./sprites.js")
var te=ee.BLEND_PREMULALPHA,G=ee.spriteClipped,F=ee.spriteClipPause,H=ee.spriteClipResume,re=ee.spriteChainedStart,ae=ee.spriteChainedStop,ie=ee.spriteCreate
var oe=e("./textures.js")
var ne=e("../common/util.js"),se=ne.clamp,le=ne.clone,ce=ne.defaults,_e=ne.deprecate,ue=ne.lerp,de=ne.merge
var fe=e("./mat43.js"),ve=fe.mat43,he=fe.m43identity,pe=fe.m43mul
var me=e("../common/vmath.js"),ge=me.vec2,Ee=me.vec4,ye=me.v3scale,Te=me.unit_vec
_e(s,"slider_dragging","slider.js:sliderIsDragging()")
_e(s,"slider_rollover","slider.js:sliderIsFocused()")
_e(s,"setSliderDefaultShrink","slider.js:sliderSetDefaultShrink()")
_e(s,"slider","slider.js:slider()")
_e(s,"bindSounds","uiBindSounds")
_e(s,"modal_font_style","uiFontStyleModal()")
_e(s,"font_style_noraml","uiFontStyleNoraml()")
_e(s,"font_style_focused","uiFontStyleFocused()")
var Ie=.75
var Se
var Ae
var we={blur:[.125,.865],saturation:[.5,.1],brightness:[1,1-Ie],fallback_darken:Ee(0,0,0,Ie),z:W.MODAL}
var Le=Ee(1,1,1,1)
var Re=[]
function applyColorSet(e){ye(e.regular,e.color,Le[0])
ye(e.rollover,e.color,Le[1])
ye(e.down,e.color,Le[2])
ye(e.disabled,e.color,Le[3])}function makeColorSet(e){var t={color:e,regular:Ee(),rollover:Ee(),down:Ee(),disabled:Ee()}
for(var r in t)t[r][3]=e[3]
Re.push(t)
applyColorSet(t)
return t}var xe=[]
function addHook(e,t){xe.push({draw:e,click:t})}var Oe={}
function getUIElemData(e,t,r){var a=D(t)
var i=Oe[e]
if(!i)i=Oe[e]={}
var o=i[a]
if(!o)o=i[a]=r?r(t):{}
o.frame_index=K.frame_index
return o}function doBlurEffect(e){o.applyGaussianBlur({blur:e})}var be=ve()
var Ne=ve()
function doDesaturateEffect(e,t){he(be)
o.saturationMatrix(Ne,e)
pe(be,be,Ne)
o.brightnessScaleMatrix(Ne,t)
pe(be,be,Ne)
o.applyColorMatrix({colorMatrix:be})}var Ce=32
s.button_height=Ce
var Me=24
s.font_height=Me
var De=200
s.button_width=De
var Pe=100
s.modal_button_width=Pe
var ke=Ce
s.button_img_size=ke
var Be=600
s.modal_width=Be
var Ue=200
s.modal_y0=Ue
var Ge=1.2
s.modal_title_scale=Ge
var Fe=16
s.modal_pad=Fe
var We=32/13
var je=s.panel_pixel_scale=We
s.tooltip_panel_pixel_scale=je
var He=400
s.tooltip_width=He
var ze=8
s.tooltip_pad=ze
var Ve
var Ye
var qe
var Ke
function setFontStyles(e,t,r,a){Ve=e||d(null,255)
Ye=t||u(Ve,{})
Ke=r||u(Ve,{})
qe=a||d(Ve,572662527)}setFontStyles()
function uiFontStyleNormal(){return Ve}function uiFontStyleFocused(){return Ye}function uiFontStyleDisabled(){return Ke}function uiFontStyleModal(){return Ke}var Ze
s.font=Ze
var Xe
s.title_font=Xe
var Qe={}
s.sprites=Qe
var Je=makeColorSet([1,1,1,1])
s.color_button=Je
var $e=Ee(1,1,.75,1)
s.color_panel=$e
var et={}
var tt=false
s.button_mouseover=tt
var rt=false
s.button_focused=rt
var at=null
s.button_click=at
function buttonWasFocused(){return rt}var it=null
var ot=false
s.menu_up=ot
var nt=de({},we)
var st=0
var lt=[]
var ct=0
var _t
var ut
var dt={ok:"OK",cancel:"Cancel",yes:"Yes",no:"No"}
var ft="Text copied to clipboard!"
var vt="Copy to clipboard FAILED, please copy from below."
function colorSetSetShades(e,t,r){Le[1]=e
Le[2]=t
Le[3]=r
for(var a=0;a<Re.length;++a)applyColorSet(Re[a])}function uiGetFontStyleFocused(){return Ye}function uiSetFontStyleFocused(e){Ye=e}function loadUISprite(e,t,r){var a=gl.CLAMP_TO_EDGE
var i=gl.CLAMP_TO_EDGE
Qe[e]=ie({name:"ui/"+e,ws:t,hs:r,wrap_s:a,wrap_t:i})}function loadUISprite2(e,t){if(null===t)return
var r=gl.CLAMP_TO_EDGE
var a=t.wrap_t?gl.REPEAT:gl.CLAMP_TO_EDGE
var i={ws:t.ws,hs:t.hs,wrap_s:r,wrap_t:a,layers:t.layers}
if(t.url)i.url=t.url
else i.name="ui/"+(t.name||e)
Qe[e]=ie(i)}function uiSetFonts(e,t){s.font=Ze=e
s.title_font=Xe=t||Ze}function setButtonsDefaultLabels(e){for(var t in e)dt[t.toLowerCase()]=e[t]}function setProvideUserStringDefaultMessages(e,t){ft=e
vt=t}var ht={color_set_shades:[1,1,1],white:{url:"white"},button:{ws:[8,112,8],hs:[128]},button_rollover:{ws:[8,112,8],hs:[128]},button_down:{ws:[8,112,8],hs:[128]},button_disabled:{ws:[8,112,8],hs:[128]},panel:{ws:[32,64,32],hs:[32,64,32]},menu_entry:{ws:[8,112,8],hs:[128]},menu_selected:{ws:[8,112,8],hs:[128]},menu_down:{ws:[8,112,8],hs:[128]},menu_header:{ws:[8,112,136],hs:[128]},slider:{ws:[56,16,56],hs:[128]},slider_handle:{ws:[64],hs:[128]},scrollbar_bottom:{ws:[64],hs:[64]},scrollbar_trough:{ws:[64],hs:[8],wrap_t:true},scrollbar_top:{ws:[64],hs:[64]},scrollbar_handle_grabber:{ws:[64],hs:[64]},scrollbar_handle:{ws:[64],hs:[24,16,24]},progress_bar:{ws:[48,32,48],hs:[128]},progress_bar_trough:{ws:[48,32,48],hs:[128]}}
function uiStartup(e){s.font=Ze=e.font
s.title_font=Xe=e.title_font||Ze
var t=e.ui_sprites
Se=j.KEYS
Ae=j.PAD
var r=_extends({},ht,e.ui_sprites)
for(var a in r){var i=ht[a]
if("object"===typeof i&&!Array.isArray(i)){var o=t&&t[a]
loadUISprite2(a,void 0===o?i:o)}}Qe.button_regular=Qe.button
if(r.color_set_shades)colorSetSetShades.apply(void 0,r.color_set_shades)
if(r.slider_params)g.apply(void 0,r.slider_params)
if(Qe.button_rollover&&1!==Le[1])colorSetSetShades(1,Le[2],Le[3])
if(Qe.button_down&&1!==Le[2])colorSetSetShades(Le[1],1,Le[3])
if(Qe.button_disabled&&1!==Le[3])colorSetSetShades(Le[1],Le[2],1);(_t={ok:{key:[Se.O],pad:[Ae.X],low_key:[Se.ESC]},cancel:{key:[Se.ESC],pad:[Ae.B,Ae.Y]}}).yes=le(_t.ok)
_t.yes.key.push(Se.Y)
_t.no=le(_t.cancel)
_t.no.key.push(Se.N)
if(void 0!==e.line_mode)ut=e.line_mode
else ut=z|Y
scaleSizes(1)}var pt
var mt=[0,0,0,0,0,0,0]
var gt=0
function suppressNewDOMElemWarnings(){gt=K.frame_index+1}function uiGetDOMElem(e,t){if(it&&!t)return null
if(ct>=lt.length||!e){var r=document.createElement("div")
if(K.DEBUG&&!K.resizing()&&K.frame_index>gt){mt[K.frame_index%mt.length]=1
var a=0
for(var i=0;i<mt.length;++i)a+=mt[i]
I(a<mt.length,"Allocated new DOM elements for too many consecutive frames")}r.setAttribute("class","glovui_dynamic")
if(!pt)pt=document.getElementById("dynamic_text")
pt.appendChild(r)
lt.push(r)
e=r}if(lt[ct]!==e)for(var o=ct+1;o<lt.length;++o)if(lt[o]===e){lt[o]=lt[ct]
lt[ct]=e}var n=lt[ct]
ct++
return n}var Et={button_click:"button_click",rollover:"rollover"}
function uiBindSounds(e){for(var t in et=ce(e||{},Et))y(et[t])}var yt={nozoom:true}
function drawHBox(e,t,r){re()
var a=t.uidata
var i=e.x
var o=[a.wh[0]*e.h,0,a.wh[2]*e.h]
if(e.no_min_width&&o[0]+o[2]>e.w){var n=e.w/(o[0]+o[2])
o[0]*=n
o[2]*=n}else o[1]=S(0,e.w-o[0]-o[2])
yt.y=e.y
yt.z=e.z
yt.h=e.h
yt.color=r
yt.color1=e.color1
yt.shader=null
for(var s=0;s<o.length;++s){var l=o[s]
if(l){yt.x=i
yt.w=l
yt.uvs=a.rects[s]
if(e.color1)t.drawDualTint(yt)
else t.draw(yt)}i+=l}ae()}function drawVBox(e,t,r){re()
var a=t.uidata
var i=[a.hw[0]*e.w,0,a.hw[2]*e.w]
var o=e.y
i[1]=S(0,e.h-i[0]-i[2])
yt.x=e.x
yt.z=e.z
yt.w=e.w
yt.color=r
yt.shader=null
for(var n=0;n<i.length;++n){var s=i[n]
yt.y=o
yt.h=s
yt.uvs=a.rects[n]
t.draw(yt)
o+=s}ae()}function drawBox(e,t,r,a){re()
var i=t.uidata
var o=r
var n=[i.widths[0]*o,0,i.widths[2]*o]
n[1]=S(0,e.w-n[0]-n[2])
var s=[i.heights[0]*o,0,i.heights[2]*o]
s[1]=S(0,e.h-s[0]-s[2])
var l=e.x
yt.z=e.z
yt.color=a
yt.shader=null
for(var c=0;c<n.length;++c){var _=n[c]
if(_){yt.x=l
yt.w=_
var u=e.y
for(var d=0;d<s.length;++d){var f=s[d]
if(f){yt.y=u
yt.h=f
yt.uvs=i.rects[3*d+c]
t.draw(yt)
u+=f}}l+=_}}ae()}function drawMultiPartBox(e,t,r,a,i){re()
var o=r.uidata
var n=a
var s=[]
var l=0
var c=0
for(var _=0;_<o.widths.length;_++)if(t.widths[_]<0){s.push(o.widths[_]*n)
l+=o.widths[_]*n}else{s.push(0)
c+=t.widths[_]}I(1===c)
for(var u=0;u<o.widths.length;u++)if(t.widths[u]>=0)s[u]=S(0,(e.w-l)*t.widths[u])
var d=[]
var f=c=0
for(var v=0;v<o.heights.length;v++)if(t.heights[v]<0){d.push(o.heights[v]*n)
f+=o.heights[v]*n}else{d.push(0)
c+=t.heights[v]}I(1===c)
for(var h=0;h<o.heights.length;h++)if(t.heights[h]>=0)d[h]=S(0,(e.h-f)*t.heights[h])
var p=e.x
for(var m=0;m<s.length;++m){var g=s[m]
if(g){var E=e.y
for(var y=0;y<d.length;++y){var T=d[y]
if(T){r.draw({x:p,y:E,z:e.z,color:i,w:g,h:T,uvs:o.rects[y*s.length+m],nozoom:true})
E+=T}}p+=g}}ae()}function playUISound(e,t){profilerStart("playUISound")
if("select"===e)e="button_click"
if(et[e])T(et[e],t)
profilerStop("playUISound")}function focusCanvas(){U()}function uiHandlingNav(){return ot||!k()}function panel(e){I("number"===typeof e.x)
I("number"===typeof e.y)
I("number"===typeof e.w)
I("number"===typeof e.h)
e.z=e.z||W.UI-1
e.eat_clicks=void 0===e.eat_clicks?true:e.eat_clicks
var t=e.color||$e
drawBox(e,e.sprite||Qe.panel,e.pixel_scale||We,t)
if(e.eat_clicks)j.mouseOver(e)}function drawTooltip(e){var t=e.tooltip
if("function"===typeof t)if(!(t=t(e)))return
t=v(t)
I("number"===typeof e.x)
I("number"===typeof e.y)
I("string"===typeof t)
var r=G()
if(r)F()
var a=e.tooltip_width||He
var i=e.z||W.TOOLTIP
var o=e.y
var n=e.tooltip_pad||ze
var s=a-2*n
var l=Ze.dims(Ke,s,0,Me,t)
var c=e.tooltip_above
if(!c&&e.tooltip_auto_above_offset)c=o+l.h+2*n>q.y1()
var _=e.x
var u=l.w+2*n
if(_+u>q.x1())_=q.x1()-u
if(c)o-=l.h+2*n+(e.tooltip_auto_above_offset||0)
var d=o+n
d+=Ze.drawSizedWrapped(Ke,_+n,d,i+1,s,0,Me,t)
panel({x:_,y:o,z:i,w:u,h:(d+=n)-o,pixel_scale:e.pixel_scale||je,eat_clicks:false})
if(r)H()}function checkHooks(e,t){if(e.hook)for(var r=0;r<xe.length;++r){if(t)xe[r].click(e)
xe[r].draw(e)}}function drawTooltipBox(e){var t=e.tooltip
if("function"===typeof t)if(!(t=t(e)))return
drawTooltip({x:e.x,y:e.y+e.h+2,tooltip_auto_above_offset:e.h+4,tooltip_above:e.tooltip_above,tooltip:t,tooltip_width:e.tooltip_width})}function progressBar(e){drawHBox(e,Qe.progress_bar_trough,e.color_trough||e.color||Te)
var t=se(e.progress,0,1)
drawHBox({x:e.x+(e.centered?e.w*(1-t)*.5:0),y:e.y,z:(e.z||W.UI)+p,w:e.w*t,h:e.h,no_min_width:true},Qe.progress_bar,e.color||Te)
if(e.tooltip)C({x:e.x,y:e.y,w:e.w,h:e.h,tooltip:e.tooltip,def:R})}var Tt=((r={})[x]="regular",r[O]="down",r[b]="rollover",r[N]="disabled",r)
var It=_extends({},w,{disabled:true,disabled_focusable:false,sound_rollover:null})
function buttonShared(e){profilerStart("buttonShared")
e.z=e.z||W.UI
if(e.rollover_quiet)e.sound_rollover=null
var t
if(e.draw_only&&!e.draw_only_mouseover)t={ret:false,state:"regular",focused:false}
else{if(e.draw_only){I(!e.def||e.def===L)
e.def=L}else if(e.disabled&&!e.disabled_focusable)e.def=e.def||It
else e.def=e.def||w
if(e.sound)e.sound_button=e.sound;(t=C(e)).state=Tt[t.spot_state]
if(t.ret){s.button_click=at=t
at.was_double_click=t.double_click}}s.button_focused=rt=s.button_mouseover=tt=t.focused
e.z+=e.z_bias&&e.z_bias[t.state]||0
profilerStop("buttonShared")
return t}var St
s.button_last_color=St
function buttonBackgroundDraw(e,t){profilerStart("buttonBackgroundDraw")
var r=e.colors||Je
var a=s.button_last_color=St=e.color||r[t]
if(!e.no_bg){var i=e.base_name||"button"
var o=Qe[i+"_"+t]
if(!o)o=Qe[i]
drawHBox(e,o,a)}profilerStop("buttonBackgroundDraw")}function buttonSpotBackgroundDraw(e,t){profilerStart("buttonSpotBackgroundDraw")
var r=Tt[t]
var a=e.colors||Je
var i=s.button_last_color=St=e.color||a[r]
if(!e.no_bg){var o=e.base_name||"button"
var n=Qe[o+"_"+r]
if(!n)n=Qe[o]
drawHBox(e,n,i)}profilerStop("buttonSpotBackgroundDraw")}function buttonTextDraw(e,t,r){profilerStart("buttonTextDraw")
buttonBackgroundDraw(e,t)
var a=Q(.25*e.font_height,.1*e.w)
var i="disabled"===t
Ze.drawSizedAligned(i?qe:r?Ye:Ve,e.x+a,e.y,e.z+.1,e.font_height,e.align||Z.ALIGN.HVCENTERFIT,e.w-2*a,e.h,e.text)
profilerStop("buttonTextDraw")}function buttonText(e){profilerStart("buttonText")
e.text=v(e.text)
I("number"===typeof e.x)
I("number"===typeof e.y)
I("string"===typeof e.text)
e.w=e.w||De
e.h=e.h||Ce
e.font_height=e.font_height||Me
var t=buttonShared(e)
var r=t.ret
buttonTextDraw(e,t.state,t.focused)
profilerStop("buttonText")
return r?t:null}function buttonImageDraw(e,t,r){profilerStart("buttonImageDraw")
var a=e.img_rect
var i=e.imgs&&e.imgs[t]||e.img
if("number"===typeof e.frame)a=i.uidata.rects[e.frame]
buttonBackgroundDraw(e,t)
var o=St
var n=i.origin
var s=i.size[0]
var l=i.size[1]
var c=s/l
if("number"===typeof e.frame)c=i.uidata.aspect?i.uidata.aspect[e.frame]:1
var _=e.w*e.shrink
var u=e.h*e.shrink*c
s=Q(_,u)
var d=(e.h-(l=s/c))/2
var f={x:e.x+(e.left_align?d:(e.w-s)/2)+n[0]*s,y:e.y+d+n[1]*l,z:e.z+(e.z_inc||p),color:e.img_color||e.color1&&e.color||o,color1:e.color1,w:s/i.size[0],h:l/i.size[1],uvs:a,rot:e.rotation}
if(e.flip){var v=f.x,h=f.w
f.x=v+h
f.w=-h}if(e.color1)i.drawDualTint(f)
else i.draw(f)
profilerStop("buttonImageDraw")}function buttonImage(e){profilerStart("buttonImage")
I("number"===typeof e.x)
I("number"===typeof e.y)
I(e.imgs||e.img&&e.img.draw)
e.z=e.z||W.UI
e.w=e.w||ke
e.h=e.h||e.w||ke
e.shrink=e.shrink||.75
var t=buttonShared(e)
var r=t.ret
buttonImageDraw(e,t.state,t.focused)
profilerStop("buttonImage")
return r?t:null}function button(e){if(e.img&&!e.text)return buttonImage(e)
else if(e.text&&!e.img)return buttonText(e)
profilerStart("button")
I("number"===typeof e.x)
I("number"===typeof e.y)
I(e.img&&e.img.draw)
e.z=e.z||W.UI
e.h=e.h||ke
e.w=e.w||De
e.shrink=e.shrink||.75
e.left_align=true
e.font_height=e.font_height||Me
var t=buttonShared(e)
var r=t.ret,a=t.state,i=t.focused
buttonImageDraw(e,a,i)
var o=e.no_bg
var n=e.w
var s=e.x
e.no_bg=true
e.x+=e.h*e.shrink
e.w-=e.h*e.shrink
buttonTextDraw(e,a,i)
e.no_bg=o
e.w=n
e.x=s
profilerStop("button")
return r?t:null}function print(e,t,r,a,i){return Ze.drawSized(e,t,r,a,Me,i)}function label(e){profilerStart("label")
var t=e.style,r=e.x,a=e.y,i=e.align,o=e.w,n=e.h,s=e.text,l=e.tooltip
s=v(s)
var c=e.font||Ze
var _=e.z||W.UI
var u=e.size||Me
I(isFinite(r))
I(isFinite(a))
I.equal(typeof s,"string")
if(l){if(!o)o=c.getStringWidth(t,u,s)
I(isFinite(o))
I(isFinite(n))
if(C({x:r,y:a,w:o,h:n,tooltip:l,def:R}).focused&&P())if(e.style_focused)t=e.style_focused
else drawElipse(r-.25*o,a-.25*n,r+1.25*o,a+1.25*n,_-.001,.5,Te)}if(s)if(i)c.drawSizedAligned(t,r,a,_,u,i,o,n,s)
else c.drawSized(t,r,a,_,u,s)
profilerStop("label")}function modalDialog(e){e.title=v(e.title)
e.text=""+(v(e.text)||"")
I(!e.title||"string"===typeof e.title)
I(!e.text||"string"===typeof e.text)
I(!e.buttons||"object"===typeof e.buttons)
if(e.buttons)for(var t in e.buttons)if("object"!==typeof e.buttons[t])e.buttons[t]={cb:e.buttons[t]}
it=e}function modalDialogClear(){it=null}var At=ge(24,24)
var wt=ge()
function modalDialogRun(){q.domDeltaToVirtual(wt,At)
var e=false
var t=it.font_height||Me
var r=Ce
var a=Fe
var i=.5*Fe
var o=1
var n=true
var s
if(wt[0]>.05*q.h()&&q.w()>2*q.h()){e=true
r=t
i=a=4
var l=q.h()
q.push()
for(s=1;;s++){q.setAspectFixed2(1,t*(Ge+1+s)+4.5*a)
o=q.h()/l
if(!it.text)break
var c=q.x1()-q.x0()-2*a
if(Ze.numLines(Ke,c,0,t,it.text)<=s)break}}var _=it,u=_.buttons,d=_.click_anywhere
var f=Object.keys(u||{})
var v=q.x1()-q.x0()
var h=e?v:it.width||Be
var p=it.button_width||Pe
p=Q(p,2*h/3/f.length)
var m=h-2*a
var g=q.x0()+J((v-h)/2)
var E=g+a
var y=e?0:it.y0||Ue
var T=J(y+a)
if(it.title){if(e){Xe.drawSizedAligned(Ke,E,T,W.MODAL,t*Ge,Z.ALIGN.HFIT,m,0,it.title)
T+=t*Ge}else T+=Xe.drawSizedWrapped(Ke,E,T,W.MODAL,m,0,t*Ge,it.title)
T=J(T+1.5*i)}if(it.text||e){if(e){if(it.text)Ze.drawSizedAligned(Ke,E,T,W.MODAL,t,Z.ALIGN.HWRAP,m,0,it.text)
T+=t*s}else T+=Ze.drawSizedWrapped(Ke,E,T,W.MODAL,m,0,t,it.text)
T=J(T+i)}var I=it.color||null
var S
if(it.tick){var A=h-2*a
if(e)A-=(a+p)*f.length
var w={x0:g,y0:y,x:E,y:T,modal_width:h,avail_width:A,font_height:t,fullscreen_mode:e}
S=it.tick(w)
T=w.y}E=g+h-(a+p)*f.length
var L=-1
for(var R=0;R<f.length;++R){var x=f[R]
var O=x.toLowerCase()
var b=u[x]=u[x]||{}
var N=_t[O]
var C=0
if(N){for(var M=0;M<N.key.length;++M){C+=j.keyDownEdge(N.key[M],b.in_event_cb)
if(N.key[M]===S)C++}for(var D=0;D<N.pad.length;++D)C+=j.padButtonDownEdge(N.pad[D])}if(d&&0===R&&j.click())++C
if(C)L=R
var P=b.label||dt[O]||x
if(buttonText(ce({key:"md_"+x,x:E,y:T,z:W.MODAL,w:p,h:r,text:P,auto_focus:0===R},b)))L=R
E=J(E+a+p)}if(-1===L)for(var k=0;k<f.length;++k){var B=f[k]
var U=_t[B.toLowerCase()]
if(U&&U.low_key)for(var G=0;G<U.low_key.length;++G)if(j.keyDownEdge(U.low_key[G],u[B].in_event_cb)||U.low_key[G]===S)L=k}if(-1!==L){var F=f[L]
playUISound("button_click")
it=null
if(u[F].cb)u[F].cb()
n=false}if(f.length>0)T+=r
T=J(T+i+a)
panel({x:g,y:y,z:W.MODAL-1,w:h,h:(e?q.y1():T)-y,pixel_scale:We*o,color:I})
if(j.pointerLocked()&&n)j.pointerLockExit()
j.eatAllInput()
if(e)q.pop()}function modalTextEntry(a){var i=n({initial_focus:true,spellcheck:false,initial_select:true,text:a.edit_text,max_len:a.max_len,esc_clears:false})
var e={}
for(var t in a.buttons){var r=a.buttons[t]
if(null!==r&&"object"===typeof r&&"cb"in r)r=a.buttons[t].cb
if("function"===typeof r)r=function(e){return function(){e(i.getText())}}(r)
e[t]=ce({cb:r},a.buttons[t])}a.buttons=e
a.text=""+(a.text||"")
var o=a.tick
a.tick=function(e){var t=i.run({x:e.x,y:e.y,w:e.avail_width||a.edit_w,font_height:e.font_height})
if(!e.fullscreen_mode)e.y+=e.font_height+Fe
var r
if(t===i.SUBMIT)r=Se.O
else if(t===i.CANCEL)r=Se.ESC
if(o)r=o(e)||r
return r}
modalDialog(a)}function createEditBox(e){return n(e)}var Lt=0
function isMenuUp(){return it||ot}function releaseOldUIElemData(){for(var e in Oe){var t=Oe[e]
var r=false
for(var a in t)if(t[a].frame_index<K.frame_index-1)delete t[a]
else r=true
if(!r)delete Oe[e]}}function uiTick(e){mt[K.frame_index%mt.length]=0
releaseOldUIElemData()
l()
f()
ct=0
var t=false
if(it||ot){var r=nt
if(!ot)r=we
var a=Q((st+=e)/500,1)
if(K.postprocessing&&!K.defines.NOPP){var i=ue(a,r.blur[0],r.blur[1])
if(i)c(r.z-2,doBlurEffect.bind(null,i))
var o=ue(a,r.saturation[0],r.saturation[1])
var n=ue(a,r.brightness[0],r.brightness[1])
if(1!==o||1!==n)c(r.z-1,doDesaturateEffect.bind(null,o,n))
t=true}else Qe.white.draw({x:q.x0Real(),y:q.y0Real(),z:r.z-2,color:r.fallback_darken,w:q.wReal(),h:q.hReal()})}else st=0
s.menu_up=ot=false
if(!K.is_loading&&K.getFrameDtActual()>50&&t){if((Lt=(Lt||0)+1)>=6)K.postprocessingAllow(false)}else if(Lt)Lt=0
B()
if(it)modalDialogRun()}function uiEndFrame(){M()
if(j.click({x:-Infinity,y:-Infinity,w:Infinity,h:Infinity}))U()
while(ct<lt.length){var e=lt.pop()
pt.removeChild(e)}}function cleanupDOMElems(){while(lt.length){var e=lt.pop()
pt.removeChild(e)}}function menuUp(e){de(nt,we)
if(e)de(nt,e)
s.menu_up=ot=true
j.eatAllInput()}function copyTextToClipboard(e){var t=document.createElement("textarea")
t.style.position="fixed"
t.style.top=0
t.style.left=0
t.style.width="2em"
t.style.height="2em"
t.style.border="none"
t.style.outline="none"
t.style.boxShadow="none"
t.style.background="transparent"
t.value=e
document.body.appendChild(t)
t.focus()
t.select()
var r=false
try{r=document.execCommand("copy")}catch(e){}document.body.removeChild(t)
return r}function provideUserString(e,t){var r=copyTextToClipboard(t)
modalTextEntry({edit_w:400,edit_text:t.replace(/[\n\r]/g," "),title:e,text:r?ft:vt,buttons:{ok:null}})}var Rt={}
function drawRect(e,t,r,a,i,o){var n=Q(e,r)
var s=Q(t,a)
var l=S(e,r)
var c=S(t,a)
Rt.x=n
Rt.y=s
Rt.z=i
Rt.w=l-n
Rt.h=c-s
Rt.color=o
return Qe.white.draw(Rt)}function drawRect2(e){return Qe.white.draw(e)}var xt={}
function drawRect4Color(e,t,r,a,i,o,n,s,l){var c=Q(e,r)
var _=Q(t,a)
var u=S(e,r)
var d=S(t,a)
xt.x=c
xt.y=_
xt.z=i
xt.w=u-c
xt.h=d-_
xt.color_ul=o
xt.color_ll=s
xt.color_lr=l
xt.color_ur=n
return Qe.white.draw4Color(xt)}function spreadTechParams(e){e=Q(S(e,0),.99)
var t={param0:Ee(0,0,0,0)}
t.param0[0]=1/(1-e)
t.param0[1]=-.5*t.param0[0]+.5
return t}var Ot=Ee()
function premulAlphaColor(e){Ot[0]=e[0]*e[3]
Ot[1]=e[1]*e[3]
Ot[2]=e[2]*e[3]
Ot[3]=e[3]
return Ot}function drawElipseInternal(e,t,r,a,i,o,n,s,l,c,_,u,d){if(!d&&!K.defines.NOPREMUL){d=te
u=premulAlphaColor(u)}ee.queueraw(e.texs,t,r,o,a-t,i-r,s,l,c,_,u,Z.font_shaders.font_aa,spreadTechParams(n),d)}function drawCircleInternal(e,t,r,a,i,o,n,s,l,c,_,u){drawElipseInternal(e,t-2*i+4*i*n,r-2*i+4*i*s,t-2*i+4*i*l,r-2*i+4*i*c,a,o,n,s,l,c,_,u)}function initCircleSprite(){var e=32
var t=new Uint8Array(e*e)
var r=(e-1)/2
for(var a=0;a<e;a++)for(var i=0;i<e;i++){var o=$((a-r)*(a-r)+(i-r)*(i-r))/r
var n=se(1-o,0,1)
t[a+i*e]=255*n}Qe.circle=ie({url:"circle",width:e,height:e,format:oe.format.R8,data:t,filter_min:gl.LINEAR,filter_mag:gl.LINEAR,wrap_s:gl.CLAMP_TO_EDGE,wrap_t:gl.CLAMP_TO_EDGE,origin:ge(.5,.5)})}function drawElipse(e,t,r,a,i,o,n,s){if(!Qe.circle)initCircleSprite()
drawElipseInternal(Qe.circle,e,t,r,a,i,o,0,0,1,1,n,s)}function drawCircle(e,t,r,a,i,o,n){if(!Qe.circle)initCircleSprite()
drawCircleInternal(Qe.circle,e,t,r,a,i,0,0,1,1,o,n)}function drawHollowCircle(e,t,r,a,i,o,n){if(!Qe.hollow_circle){var s=128
var l=2
var c=new Uint8Array(s*s)
var _=(s-1)/2
for(var u=0;u<s;u++)for(var d=0;d<s;d++){var f=$((u-_)*(u-_)+(d-_)*(d-_))/_
var v=se(1-f,0,1)
if(v>.5)v=1-v
v+=l/s
c[u+d*s]=255*v}Qe.hollow_circle=ie({url:"hollow_circle",width:s,height:s,format:oe.format.R8,data:c,filter_min:gl.LINEAR,filter_mag:gl.LINEAR,wrap_s:gl.CLAMP_TO_EDGE,wrap_t:gl.CLAMP_TO_EDGE,origin:ge(.5,.5)})}drawCircleInternal(Qe.hollow_circle,e,t,r,a,i,0,0,1,1,o,n)}var bt=16
var Nt=16
var Ct=h((Nt-1)/2)
var Mt=.5/Nt
var Dt=1-1.5/Nt
var Pt=.5/bt
var kt=(Ct+.5)/bt
var Bt=1-kt
var Ut=1-.5/bt
function drawLine(e,t,r,a,i,o,n,s,l){if(void 0===l)l=ut
var c
if(!K.defines.NOPREMUL){c=te
s=premulAlphaColor(s)}var _=l&Y?"line3":"line2"
if(!Qe[_]){var u=new Uint8Array(bt*Nt)
var d=Ct
var f=bt-1-Ct
if("line2"===_)for(var v=0;v<Nt;v++){var h=X((v-Ct)/Ct)
var p=J(255*se(1-h,0,1))
for(var m=0;m<bt;m++){var g=J(255*se(h=m<d?m/Ct:m>=f?1-(m-f)/Ct:1,0,1))
u[m+v*bt]=Q(g,p)}}else for(var E=0;E<Nt;E++){var y=X((E-Ct)/Ct)
for(var T=0;T<bt;T++){var I=T<d?1-T/Ct:T>=f?(T-f)/Ct:0
var S=$(I*I+y*y)
S=se(1-S,0,1)
u[T+E*bt]=J(255*S)}}Qe[_]=ie({url:_,width:bt,height:Nt,format:oe.format.R8,data:u,filter_min:gl.LINEAR,filter_mag:gl.LINEAR,wrap_s:gl.CLAMP_TO_EDGE,wrap_t:gl.CLAMP_TO_EDGE})}var A=Qe[_].texs
var w=.5*(q.data[4]+q.data[5])
var L=o*w
var R=L+4
var x=.5*R
var O=x*(1/w)
var b=r-e
var N=a-t
var C=$(b*b+N*N)
var M=-(N/=C)*O
var D=(b/=C)*O
if(l&z){var P=(t-q.data[1])*q.data[5]
var k=(J(P-x)+x-P)/q.data[5]
t+=k
a+=k
var B=(e-q.data[0])*q.data[4]
var U=(J(B-x)+x-B)/q.data[4]
e+=U
r+=U}var G=1-(L+1)/R
var F=1/(1+n*(G+2/R-1)-G)
var W={param0:[F,-G*F]}
ee.queueraw4(A,r+M,a+D,r-M,a-D,e-M,t-D,e+M,t+D,i,kt,Mt,Bt,Dt,s,Z.font_shaders.font_aa,W,c)
if(l&(Y|V)){var j=b*o/2
var H=N*o/2
ee.queueraw4(A,r-M,a-D,r+M,a+D,r+M+j,a+D+H,r-M+j,a-D+H,i,Bt,Dt,Ut,Mt,s,Z.font_shaders.font_aa,W,c)
ee.queueraw4(A,e-M,t-D,e+M,t+D,e+M-j,t+D-H,e-M-j,t-D-H,i,kt,Dt,Pt,Mt,s,Z.font_shaders.font_aa,W,c)}}function drawHollowRect(e,t,r,a,i,o,n,s,l){drawLine(e,t,r,t,i,o,n,s,l)
drawLine(r,t,r,a,i,o,n,s,l)
drawLine(r,a,e,a,i,o,n,s,l)
drawLine(e,a,e,t,i,o,n,s,l)}function drawHollowRect2(e){drawHollowRect(e.x,e.y,e.x+e.w,e.y+e.h,e.z||W.UI,e.line_width||1,e.precise||1,e.color||Te)}function drawCone(e,t,r,a,i,o,n,s,l){var c
if(!K.defines.NOPREMUL){c=te
l=premulAlphaColor(l)}if(!Qe.cone){var _=32
var u=new Uint8Array(_*_)
var d=(_-1)/2
for(var f=0;f<_;f++)for(var v=0;v<_;v++){var h=0
var p=0
var m=0
if(f>d){h=(f-d)/d
p=X(v-d)/d
m=h*$(h*h+p*p)}var g=se(1-m,0,1)
u[f+v*_]=255*g}Qe.cone=ie({url:"cone",width:_,height:_,format:oe.format.R8,data:u,filter_min:gl.LINEAR,filter_mag:gl.LINEAR,wrap_s:gl.CLAMP_TO_EDGE,wrap_t:gl.CLAMP_TO_EDGE,origin:ge(.5,.5)})}var E=r-e
var y=a-t
var T=$(E*E+y*y)
var I=-(y/=T)
var S=E/=T
ee.queueraw4(Qe.cone.texs,e-I*o,t-S*o,e+I*o,t+S*o,r+I*n,a+S*n,r-I*n,a-S*n,i,0,0,1,1,l,Z.font_shaders.font_aa,spreadTechParams(s),c)}function setFontHeight(e){s.font_height=Me=e
_(Me)}function scaleSizes(e){s.button_height=Ce=J(32*e)
setFontHeight(J(24*e))
s.button_width=De=J(200*e)
s.button_img_size=ke=Ce
s.modal_button_width=Pe=J(De/2)
s.modal_width=Be=J(600*e)
s.modal_y0=Ue=J(200*e)
s.modal_title_scale=Ge=1.2
s.modal_pad=Fe=J(16*e)
s.tooltip_width=He=J(400*e)
s.tooltip_pad=ze=J(8*e)
s.panel_pixel_scale=We=Ce/Qe.panel.uidata.total_h
s.tooltip_panel_pixel_scale=je=We
m(Ce/Qe.button.uidata.total_h)}function setPanelPixelScale(e){s.tooltip_panel_pixel_scale=je=s.panel_pixel_scale=We=e}function setModalSizes(e,t,r,a,i){s.modal_button_width=Pe=e||J(De/2)
s.modal_width=Be=t||600
s.modal_y0=Ue=r||200
s.modal_title_scale=Ge=a||1.2
s.modal_pad=Fe=i||Fe}function setTooltipWidth(e,t){s.tooltip_width=He=e
s.tooltip_panel_pixel_scale=je=t
s.tooltip_pad=ze=Fe/2*t}},{"../common/util.js":330,"../common/vmath.js":332,"./camera2d.js":241,"./edit_box.js":248,"./effects.js":249,"./engine.js":250,"./font.js":260,"./input.js":271,"./link.js":273,"./localization.js":275,"./mat43.js":276,"./scroll_area.js":289,"./slider.js":294,"./sound.js":297,"./spot.js":300,"./sprites.js":302,"./textures.js":304,assert:void 0}],307:[function(e,t,r){"use strict"
r.getURLBase=getURLBase
r.getURLPageBase=getURLPageBase
r.onChange=onChange
r.refreshTitle=refreshTitle
r.onURLChange=onURLChange
r.startup=startup
r.route=route
r.routeFixed=routeFixed
r.register=register
r.set=set
r.setMulti=setMulti
r.get=get
r.go=go
r.TYPE_STRING=r.TYPE_SET=void 0
var c=e("assert")
var f=e("../common/util.js").callEach
var a=1e3
var m="set"
r.TYPE_SET=m
var i="string"
r.TYPE_STRING=i
var g={}
var E
var o=(document.location.href||"").match(/^[^#?]+/)[0]
if(!o.endsWith("/"))o+="?"
var n=o.replace(/[^/]*$/,"")
var v=[]
function getURLBase(){return n}function getURLPageBase(){return o}function onChange(e){v.push(e)}function cmpNumKeys(e,t){var r=t.keys.length-e.keys.length
if(r)return r
for(var a=0;a<e.keys.length;++a)if(e.keys[a]<t.keys[a])return-1
else if(e.keys[a]>t.keys[a])return 1
c(false)
return 0}var y=/:(\w+)/g
var T=[]
function queryString(){return String(document.location).slice(o.length)}var _=/[^\w]\w+=([^&]+)/
function getValue(e,t){if(t.routes)for(var r=0;r<t.routes.length;++r){var a=t.routes[r]
var i=e.match(a.regex)
if(i){if(a.value)return a.value
return i[1+a.keys.indexOf(t.key)]}}var o=e.match(t.regex)||[]
if(t.type===m){var n={}
for(var s=0;s<o.length;++s){var l=o[s].match(_)
c(l)
n[l[1]]=1}return n}else return o[1]||t.def}var s=null
function goInternal(e){var t={}
for(var r in g){var a=g[r]
if(a.hides)if(getValue(e,a))for(var i in a.hides)t[i]=1}var o={}
for(var n in g){if(t[n])continue
var s=g[n]
var l=getValue(e,s)
if(s.type===m){for(var c in l)if(!s.value[c]){s.value[c]=1
o[n]=true}for(var _ in s.value)if(!l[_]){delete s.value[_]
o[n]=true}}else if(l!==s.value){o[n]=true
s.value=l}}for(var u in o){var d=g[u]
if(d.change)d.change(d.value)}f(v)}var I
function toString(){I=""
var e=[]
var r={}
for(var t in g){var a=g[t]
if(a.hides&&a.value)for(var i in a.hides)r[i]=1}var o=""
e:for(var n=0;n<T.length;++n){var s=T[n]
var l=""
for(var c=0;c<s.keys.length;++c){var _=s.keys[c]
if(r[_])continue e
var u=g[_]
if(u.hide_values[u.value])continue e
if(!l&&u.title)l=u.title(u.value)}for(var d=0;d<s.keys.length;++d){var f=s.keys[d]
if(g[f].route_only)r[f]=true}o=s.route_string.replace(y,function(e,t){r[t]=true
return String(g[t].value)})
if(!I&&l)I=l
break}for(var v in g){if(r[v])continue
var h=g[v]
if(h.type===m)for(var p in h.value)e.push(v+"="+p)
else if(!h.hide_values[h.value]){e.push(v+"="+h.value)
if(!I&&h.title)I=h.title(h.value)}}if(E)I=E(I)
I=String(I)
return o+(e.length?"?":"")+e.join("&")}function refreshTitle(){toString()
if(I&&I!==document.title)document.title=I}function periodicRefreshTitle(){profilerStart("periodicRefreshTitle")
refreshTitle()
setTimeout(periodicRefreshTitle,1e3)
profilerStop()}function onPopState(){var e=queryString()
goInternal(s=e)
refreshTitle()}var l
function onURLChange(e){l=e}var u=0
var d=false
var h=false
function updateHistoryCommit(){profilerStart("updateHistoryCommit")
d=false
u=Date.now()
var e=""+o+s
if(e.endsWith("?"))e=e.slice(0,-1)
try{if(h){h=false
window.history.pushState(void 0,I,e)}else window.history.replaceState(void 0,I,e)}catch(e){}if(I)document.title=I
if(l)l()
profilerStop()}function updateHistory(e){var t=toString()
if(s===t)return
h=h||e
s=t
if(d)return
var r=a
if(Date.now()-u>a)r=1
d=true
setTimeout(updateHistoryCommit,r)}function startup(e){c(!E)
if(!(E=e.title_transformer)&&(e.title_suffix||e.title_default)){var t=e.title_suffix,r=e.title_default
E=function title_transformer(e){if(t&&e)return e+" | "+t
return e||r||t}}updateHistory(false)
if(E){refreshTitle()
setTimeout(periodicRefreshTitle,1e3)}}function routeEx(e){var t=e.keys
for(var r=0;r<t.length;++r){var a=g[t[r]]
c(a)
a.routes=a.routes||[]
a.routes.push(e)
a.value=getValue(queryString(),a)}T.push(e)
T.sort(cmpNumKeys)}function route(e){var r=[]
var t=e.replace(y,function(e,t){r.push(t)
return"([^/&?]+)"})
routeEx({route_string:e,regex:new RegExp("^"+t+"(?:$|\\?)"),keys:r})}function routeFixed(e,t){routeEx({route_string:e,regex:new RegExp("^"+e+"(?:$|\\?)"),value:"1",keys:[t]})}function register(e){c(e.key)
c(!g[e.key])
e.type=e.type||i
var t="(?:[^\\w])"+e.key+"=([^&]+)"
var r=""
if(e.type===m)r="g"
else{e.def=e.def||""
e.hide_values=e.hide_values||{}
e.hide_values[e.def]=true}e.regex=new RegExp(t,r);(g[e.key]=e).value=getValue(queryString(),e)
var a=e.value
if(e.type===m&&"function"===typeof Proxy)a=new Proxy(e.value,{set:function set(e,t,r){if(r)e[t]=1
else delete e[t]
updateHistory()
return true}})
if(!window.onpopstate)window.onpopstate=onPopState
return a}function set(e,t,r){var a=g[e]
c(a)
if(a.type===m){if(Boolean(a.value[t])!==Boolean(r)){a.value[t]=r?1:0
updateHistory(a.push)}}else if(a.value!==t){a.value=t
updateHistory(a.push)}}function setMulti(e){var t=false
var r=false
for(var a in e){var i=e[a]
var o=g[a]
c(o)
c(o.type!==m)
if(o.value!==i){o.value=i
t=true
r=r||o.push}}if(t)updateHistory(r)}function get(e){var t=g[e]
c(t)
return t.value}function go(e){goInternal(e)
updateHistory(true)}},{"../common/util.js":330,assert:void 0}],308:[function(e,t,r){"use strict"
var a=Math.floor,i=Math.min
var o=0
function now(){return Date.now()+o}t.exports=r=now
r.now=now
var n=true
r.sync=function(e){if(n)o=e-Date.now()
else o=i(o,e-Date.now())}
function toSS2020(e){return a(e/1e3)-1577836800}r.toSS2020=toSS2020
r.seconds=function(){return toSS2020(now())}},{}],309:[function(e,t,r){"use strict"
r.webFSGetFileNames=webFSGetFileNames
r.webFSGetFile=webFSGetFile
r.webFSExists=webFSExists
r.webFSReportUnused=webFSReportUnused
var s=e("assert")
var a=e("./filewatch.js"),i=a.filewatchOn,o=a.filewatchTriggerChange
var n=e("./urlhash.js")
var l=e("../common/util.js"),c=l.clone,_=l.deepEqual
var u=window.glov_webfs||{}
var d={}
var f={}
var v=false
function decode(e){var t=e[0]
var r=e[1]
var a=new Uint8Array(t)
var i=0
var o=0
while(i<t){var n=r.charCodeAt(o++)
if(126===n)n=0
else if(27===n)n=r.charCodeAt(o++)
a[i++]=n}s.equal(o,r.length)
s.equal(i,t)
return a}function webFSGetFileNames(e){var t=[]
for(var r in u)if(r.startsWith(e))t.push(r)
return t}function webFSGetFile(e,t){var r=d[e]
if(r)return r
f[e]=true
s(window.glov_webfs,"Failed to load fsdata.js")
var a=u[e]
s(a,"Error loading file: "+e)
if("jsobj"===t){s(!Array.isArray(a))
r=v?c(a):a}else{s(Array.isArray(a))
if("text"===t)r=a[1]
else r=decode(a)}return d[e]=r}function webFSExists(e){return Boolean(u[e])}function webFSReportUnused(e){e=e||/\.(fp|vp)$/
var t=0
for(var r in u)if(!f[r]&&!r.match(e)){console.warn("WebFS file bundled but unreferenced: "+r)
t+=u[r][0]}if(t)console.warn("WebFS wasting "+t+" bytes")}function webFSReload(){v=true
window.glov_webfs=null
var e=document.createElement("script")
e.src=n.getURLBase()+"fsdata.js?rl="+Date.now()
e.onload=function(){if(window.glov_webfs){var e=u
u=window.glov_webfs
d={}
f={}
for(var t in u){var r=e[t]
var a=u[t]
if(Array.isArray(r)){for(var i=0;i<a.length;++i)if(!r||a[i]!==r[i]){o(t)
break}}else if(!_(r,a))o(t)}}}
document.getElementsByTagName("head")[0].appendChild(e)}i("fsdata.js",webFSReload)},{"../common/util.js":330,"./filewatch.js":259,"./urlhash.js":307,assert:void 0}],310:[function(e,t,r){"use strict"
r.profanityStartup=profanityStartup
r.profanityFilter=profanityFilter
var a=e("../../common/rand_alea.js").mashString
var i=e("../rand_fast.js").randFastCreate
var o=e("../../common/words/profanity_common.js"),n=o.profanityFilterCommon,s=o.profanityCommonStartup
var l=e("../webfs.js").webFSGetFile
var c
function profanityStartup(){c=l("words/replacements.txt","text").split("\n").filter(function(e){return e})
s(l("words/filter.gkg","text"),l("words/exceptions.txt","text"))}var _=i()
var u
function randWord(){if(-1===u||1===c.length)u=_.range(c.length)
else{var e=_.range(c.length-1)
u=e<u?e:e+1}return c[u]}function profanityFilter(e){u=-1
_.seed=a(e)
return n(e,randWord)}},{"../../common/rand_alea.js":327,"../../common/words/profanity_common.js":333,"../rand_fast.js":288,"../webfs.js":309}],311:[function(e,t,r){"use strict"
r.numWorkers=numWorkers
r.addHandler=addHandler
r.sendmsg=sendmsg
r.setNumWorkers=setNumWorkers
r.startup=startup
r.keepBusy=keepBusy
r.keep_busy=r.ALL=void 0
var a=e("assert")
e("not_worker")
var o=[]
function numWorkers(){return o.length}var i={}
var n=-1
r.ALL=n
function addHandler(e,t){a(!i[e])
i[e]=t}function sendmsg(e,t,r,a){if(e===n)for(var i=0;i<o.length;++i)sendmsg(i,t,r)
else o[e].postMessage({id:t,data:r},a)}function workerOnMessage(e,t){if((t=t.data)instanceof Object&&t.id){profilerStart("worker:"+t.id)
a(i[t.id])
i[t.id](e,t.data)
profilerStop()}else console.log("worker_comm (main thread) unhandled message",t)}function workerOnError(e,t,r,a,i){if(!t&&e.message&&e.filename)window.onerror(e.message,e.filename,e.lineno,e.colno,i||e)
else if("[object Event]"===String(e))window.onerror("Unknown worker error ("+(e.message||e.type||e)+")",t,r,a,i)
else window.onerror(e,t,r,a,i)}var s
function allocWorker(e,t){var r=s&&s[e]&&"#"+s[e]||""
var a=new Worker(""+(t||"worker.bundle.js")+r)
a.onmessage=workerOnMessage.bind(null,o.length)
a.onerror=workerOnError
o.push(a)}function setNumWorkers(e,t){for(var r=o.length;r<e;++r)allocWorker(r,t)}var l=0
r.keep_busy=l
function startup(e,t){if(String(document.location).match(/^https?:\/\/localhost/))s=t
addHandler("debugmsg",function(e,t){window.debugmsg(t.msg,t.clear)})
addHandler("log",function(e,t){console.log("[Worker#"+e+"] "+t)})
addHandler("error",function(e,t){console.error(t)
window.onerror(null,null,null,null,t)})
addHandler("busy_done",function(e){if(e<l)sendmsg(e,"busy",1e3)})
allocWorker(0,e)}function keepBusy(e){for(var t=l;t<e;++t)sendmsg(t,"busy",1e3)
r.keep_busy=l=e}},{assert:void 0,not_worker:void 0}],312:[function(e,t,r){"use strict"
r.startup=startup
var d=e("./camera2d.js")
var a=e("./cmds.js").cmd_parse
var f=e("./engine.js")
var v=Math.max
var i=e("./settings.js")
var h=e("./ui.js")
var o=e("../common/vmath.js").vec4
var n=e("./worker_comm.js")
var s=n.addHandler,l=n.keepBusy,c=n.numWorkers,_=n.sendmsg
var p=256
var u=[]
var m=[o(0,0,0,.75),o(.161,.678,1,1),o(1,.639,0,1),o(1,.467,.659,1)]
var g=1
var E=32
var y=.25
var T=o(0,0,0,.5)
function drawGraph(e,t){var r=507
var a=d.x1Real()-g
var i=a-r
var o=Z.FPSMETER
e-=g
h.drawRect(i,e-E,a+r,e,o++,T)
a-=(f.frame_timestamp-t.last_update)*y
for(var n=1;n<p;++n){if(a<=i)break
var s=(t.index-n+p)%p
var l=t.type[s]
var c=t.time[s]
if(!c)continue
var _=m[l]
var u=v(1,c*y)
if(!l)h.drawRect(v(i,a-u),e-.75*E,a,e-.25*E,o,_)
else h.drawRect(v(i,a-u),e-E,a,e,o,_)
a-=u}return e-E}function tickWorkerPerf(){if(!i.worker_graph)return
d.setAspectFixed(f.game_width,f.game_height)
var e=d.y1Real()
if(i.fps_graph)e-=130
for(var t=0;t<u.length;++t)e=drawGraph(e,u[t])}function onTiming(e,t){var r=u[e]
if(!r){console.log("[Worker"+e+"] "+(100*t.time_work/t.elapsed).toFixed().padStart(2)+"% work "+(100*t.time_idle/t.elapsed).toFixed().padStart(2)+"% idle ("+t.batches.length/2+" batches)")
return}var a=r.batch_idx,i=r.index
for(var o=0;o<t.batches.length;){r.type[i]=0
r.time[i++]=t.batches[o++]
r.type[i]=a+1
r.time[i++]=t.batches[o++]
a=(a+1)%3
i%=p}r.batch_idx=a
r.index=i
r.last_update=f.frame_timestamp}function startup(){i.register({worker_graph:{default_value:0,type:a.TYPE_INT,range:[0,1]}})
a.registerValue("worker_busy",{type:a.TYPE_INT,label:"Worker Busy",range:[0,8],get:function get(){return n.keep_busy},set:l,access_show:["hidden"]})
for(var e=0;e<c();++e)u[e]={index:0,batch_idx:0,last_update:0,type:new Uint8Array(p),time:new Float32Array(p)}
s("timing",onTiming)
for(var t=0;t<c();++t)_(t,"timing_enable",true)
f.addTickFunc(tickWorkerPerf)}},{"../common/vmath.js":332,"./camera2d.js":241,"./cmds.js":244,"./engine.js":250,"./settings.js":291,"./ui.js":306,"./worker_comm.js":311}],313:[function(e,t,r){"use strict"
r.WSClient=WSClient
r.ERR_CLIENT_VERSION_OLD=r.ERR_CLIENT_VERSION_NEW=r.ERR_RESTARTING=r.ERR_CONNECTING=void 0
var a=e("./environments")
var n=a.getAPIPath
var _=a.setCurrentEnvironment
var s=e("../common/ack.js")
var i=s.ackInitReceiver
var u=e("assert")
var o=e("./error_report.js"),l=o.errorReportSetDetails,c=o.session_uid
var d=e("./fetch.js"),f=d.fetch,v=d.ERR_CONNECTION
var h=Math.min,p=Math.random
var m=e("../common/perfcounters.js").perfCounterAdd
var g=e("./urlhash.js")
var E=e("../common/wscommon.js")
var y=E.wsHandleMessage
var T=e("./client_config.js"),I=T.PLATFORM,S=T.getAbilityReload
var A="ERR_CONNECTING"
r.ERR_CONNECTING=A
var w="ERR_RESTARTING"
r.ERR_RESTARTING=w
var L="ERR_CLIENT_VERSION_NEW"
r.ERR_CLIENT_VERSION_NEW=L
var R="ERR_CLIENT_VERSION_OLD"
r.ERR_CLIENT_VERSION_OLD=R
r.CURRENT_VERSION=0
function WSClient(e){this.id=null
this.my_ids={}
this.handlers={}
this.socket=null
this.net_delayer=null
this.connected=false
this.disconnected=false
this.retry_scheduled=false
this.retry_count=0
this.disconnect_time=Date.now()
this.last_receive_time=Date.now()
this.idle_counter=0
this.last_send_time=Date.now()
this.connect_error=A
i(this)
if(e)this.path=e
this.connect(false)
this.onMsg("cack",this.onConnectAck.bind(this))
this.onMsg("build",this.onBuildTimestamp.bind(this))
this.onMsg("error",this.onError.bind(this))}WSClient.prototype.logPacketDispatch=function(e,t,r,a){m("ws."+a)}
WSClient.prototype.timeSinceDisconnect=function(){return Date.now()-this.disconnect_time}
function getVersionUrlParams(){return"plat="+I+"&ver="+r.CURRENT_VERSION+"&build=1675164989368"}function jsonParseResponse(e){if(!e)return null
if("<"===e.trim()[0])return null
try{return JSON.parse(e)}catch(e){return null}}function whenServerReady(a){var i=0
function doit(){f({url:n()+"ready?"+getVersionUrlParams()},function(e,t){if(e){var r=jsonParseResponse(t)
if("ERR_CLIENT_VERSION_OLD"!==(null==r?void 0:r.status)){++i
setTimeout(doit,h(i*i*100,15e3)*(.75+.5*p()))
return}}a()})}doit()}WSClient.prototype.onBuildTimestamp=function(e){if("1675164989368"!==e)if(this.on_build_timestamp_mismatch)this.on_build_timestamp_mismatch()
else if(S()){console.error("App build mismatch (server: "+e+", client: 1675164989368), reloading")
whenServerReady(function(){if(window.reloadSafe)window.reloadSafe()
else document.location.reload()})}else console.warn("App build mismatch (server: "+e+", client: 1675164989368), ignoring")}
WSClient.prototype.onConnectAck=function(e,t){var r=this
r.connected=true
r.connect_error=null
r.disconnected=false
r.id=e.id
r.my_ids[e.id]=true
l("client_id",r.id)
r.secret=e.secret
if(e.build)r.onBuildTimestamp(e.build)
u(r.handlers.connect)
e.client_id=r.id
r.handlers.connect(r,e)
t()}
WSClient.prototype.pak=function(e){return E.wsPak(e,null,this)}
WSClient.prototype.send=function(e,t,r){E.sendMessage.call(this,e,t,r)}
WSClient.prototype.onError=function(e){console.error("WSClient Error")
console.error(e)
if(!(e instanceof Error))e=new Error(e)
throw e}
WSClient.prototype.onMsg=function(e,a){u.ok(!this.handlers[e])
this.handlers[e]=function wrappedCallback(e,t,r){return a(t,r)}}
WSClient.prototype.checkForNewAppBuild=function(){var r=this
if(!S())return
if(this.new_build_check_in_progress)return
this.new_build_check_in_progress=true
f({url:g.getURLBase()+"app.ver.json",response_type:"json"},function(e,t){r.new_build_check_in_progress=false
if(t&&t.ver)r.onBuildTimestamp(t.ver)
if(e&&e!==v)if(!r.delayed_recheck){r.delayed_recheck=true
setTimeout(function(){r.delayed_recheck=false
r.checkForNewAppBuild()},1e3)}})}
WSClient.prototype.retryConnection=function(){var e=this
u(!e.socket)
u(!e.retry_scheduled)
e.retry_scheduled=true;++e.retry_count
this.checkForNewAppBuild()
setTimeout(function(){u(e.retry_scheduled)
u(!e.socket)
e.retry_scheduled=false
e.connect(true)},h(e.retry_count*e.retry_count*100,15e3)*(.75+.5*p()))}
WSClient.prototype.checkDisconnect=function(){if(this.connected&&1!==this.socket.readyState){this.on_close()
u(!this.connected)}}
WSClient.prototype.connect=function(s){var l=this
var c=this
c.socket={readyState:0}
u(!this.ready_check_in_progress)
this.ready_check_in_progress=true
f({url:n()+"ready?"+getVersionUrlParams()},function(e,t){var r=jsonParseResponse(t)
var a=null==r?void 0:r.status
var i=null==r?void 0:r.redirect_environment
var o=null==r?void 0:r.update_available
var n=o&&S()
u(l.ready_check_in_progress)
l.ready_check_in_progress=false
l.connect_error=A
if(!e&&!i&&!n){if(o);return void l.connectAfterReady(s)}console.log("Server not ready, err="+e+", response="+t)
if("ERR_RESTARTING"===a||"ERR_STARTUP"===a)c.connect_error=w
else if("ERR_CLIENT_VERSION_NEW"===a)c.connect_error=L
else if("ERR_CLIENT_VERSION_OLD"===a)c.connect_error=R
if(i)_(i)
c.socket=null
c.net_delayer=null
l.retryConnection()})}
WSClient.prototype.connectAfterReady=function(e){var t=this
var r=t.path||n().replace(/^http/,"ws").replace(/api\/$/,"ws")
r=r+"?"+getVersionUrlParams()+(e&&t.id&&t.secret?"&reconnect="+t.id+"&secret="+t.secret:"")+"&sesuid="+c
var a=new WebSocket(r)
a.binaryType="arraybuffer"
t.socket=a
function guard(e){return function(){if(t.socket!==a)return
e.apply(void 0,arguments)}}function abort(e){t.socket=null
t.net_delayer=null
if(t.connected){t.disconnect_time=Date.now()
t.disconnected=true
l("disconnected",1)}t.connected=false
t.connect_error=A
if(!e)try{a.close()}catch(e){}t.handlers.disconnect()
s.failAll(t)}function retry(e){abort(e)
t.retryConnection()}var i=false
t.socket.addEventListener("error",guard(function(e){if(!i){console.log("WebSocket error during initial connection, retrying...",e)
retry()}else console.error("WebSocket error",e)}))
t.socket.addEventListener("message",guard(function(e){profilerStart("WS")
u(e.data instanceof ArrayBuffer)
y(t,new Uint8Array(e.data))
profilerStop("WS")}))
t.socket.addEventListener("open",guard(function(){console.log("WebSocket open")
i=true
t.retry_count=0}))
t.on_close=guard(function(){console.log("WebSocket close, retrying connection...")
retry(true)})
t.socket.addEventListener("close",t.on_close)
var o=guard(function(){if(Date.now()-t.last_send_time>=E.PING_TIME&&t.connected&&1===t.socket.readyState)t.send("ping")
setTimeout(o,E.PING_TIME/2)})
setTimeout(o,E.PING_TIME/2)}},{"../common/ack.js":314,"../common/perfcounters.js":326,"../common/wscommon.js":334,"./client_config.js":243,"./environments":254,"./error_report.js":255,"./fetch.js":258,"./urlhash.js":307,assert:void 0}],314:[function(e,t,r){"use strict"
r.ackInitReceiver=ackInitReceiver
r.ackWrapPakStart=ackWrapPakStart
r.ackWrapPakPayload=ackWrapPakPayload
r.ackWrapPakFinish=ackWrapPakFinish
r.ackReadHeader=ackReadHeader
r.failAll=failAll
r.ackHandleMessage=ackHandleMessage
var y=e("assert")
var a=e("./packet.js").isPacket
var T=e("./perfcounters.js").perfCounterAddValue
function ackInitReceiver(e){e.last_pak_id=0
e.resp_cbs={}
e.responses_waiting=0}var I="ERR_FAILALL_DISCONNECT"
var n=8
var s=16
var l=32
function ackWrapPakStart(e,t,r){var a=0
e.ack_data={receiver:t}
if("number"===typeof r){a|=n
e.writeInt(r)}else e.writeAnsiString(r)
var i=t?++t.last_pak_id:0
e.ack_data.resp_pak_id=i
e.ack_data.resp_pak_id_offs=e.getOffset()
e.writeInt(i)
e.ack_data.data_offs=e.getOffset()
e.ack_data.flags=a}function ackWrapPakPayload(e,t){if(a(t))e.appendRemaining(t)
else{e.ack_data.flags|=l
e.writeJSON(t)}}function ackWrapPakFinish(e,t,r){var a=e.ack_data.flags
var i=e.getOffset()
if(t){y.equal(e.ack_data.data_offs,i)
a|=s
e.writeString(String(t))
i=e.getOffset()}e.makeReadable()
var o=0
if(r&&false!==r.expecting_response){o=e.ack_data.resp_pak_id
y(o)
y(e.ack_data.receiver)
e.ack_data.receiver.resp_cbs[o]=r}else{e.seek(e.ack_data.resp_pak_id_offs)
e.zeroInt()
e.seek(i)}e.updateFlags(a)
delete e.ack_data
return o}function ackReadHeader(e){var t=e.getFlags()
var r=t&n?e.readInt():e.readAnsiString()
var a=e.readInt()
var i=t&s?e.readString():void 0
var o
if(t&l)o=e.readJSON()
else o=e
return{msg:r,err:i,data:o,pak_id:a}}function failAll(e,t){t=t||I
var r=e.resp_cbs
e.resp_cbs={}
e.responses_waiting=0
for(var a in r)r[a](t)}function ackHandleMessage(a,e,t,i,o,r,n){var s=t.getOffset()
var l=ackReadHeader(t),c=l.err,_=l.data,u=l.msg,d=l.pak_id
if(a.logPacketDispatch){T("net.recv_bytes.total",t.totalSize())
var f="number"===typeof u?"ack":u
T("net.recv_bytes."+f,t.totalSize())
a.logPacketDispatch(e,t,s,f)}var v=Date.now()
var h=Boolean(d)
var p
if(h)p="pending"
var m=false
var g=v
if(n&&!n(a,u,_))return
function preSendResp(e){y(!m,"Response function called twice")
m=true
if(h){if(p){if("pending"!==p)clearTimeout(p)}else if(e===I);else(a.log?a:console).log("Response finally sent for "+u+" after "+((Date.now()-g)/1e3).toFixed(1)+"s")
a.responses_waiting--}}function respFunc(e,t,r){preSendResp(e)
if(!h){if(r){a.onError("Sending a response to a packet ("+u+") that did not expect one, but we are expecting a response")
return}if(e)i("error",null,e,null)
return}i(d,e,t,r)}respFunc.expecting_response=h
respFunc.pak=function(e){y(h)
var r=o(d,e)
var a=r.send
r.send=function(e,t){preSendResp(e)
a.call(r,e,t)}
return r}
if("number"===typeof u){var E=a.resp_cbs[u]
if(!E)return void a.onError("Received response to unknown packet with id "+u+" from "+e)
delete a.resp_cbs[u]
profilerStart("response")
E(c,_,respFunc)
profilerStop("response")}else{if(!u)return void a.onError("Received message with no .msg from "+e)
profilerStart(u)
r(u,_,respFunc)
profilerStop(u)}if(h){a.responses_waiting++
if(!m&&!respFunc.suppress_timeout)p=setTimeout(function(){p=null
if(!respFunc.suppress_timeout)(a.log?a:console).log("Response not sent for "+u+" from "+e+" after "+((Date.now()-g)/1e3).toFixed(1)+"s")},15e3)}}},{"./packet.js":325,"./perfcounters.js":326,assert:void 0}],315:[function(e,t,r){(function(o){(function(){"use strict"
var i=Math.floor
var s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("")
var l="="
function encode(e,t,r){var a=e.u8
var i=""
var o
var n
for(o=0;o<r-2;o+=3){i+=s[a[n=t+o]>>2]
i+=s[((3&a[n])<<4)+(a[n+1]>>4)]
i+=s[((15&a[n+1])<<2)+(a[n+2]>>6)]
i+=s[63&a[n+2]]}if(r%3){i+=s[a[n=t+(o=r-r%3)]>>2]
if(r%3===2){i+=s[((3&a[n])<<4)+(a[n+1]>>4)]
i+=s[(15&a[n+1])<<2]
i+=l}else{i+=s[(3&a[n])<<4]
i+=l+l}}return i}function decodeNativeBrowser(e,t){var r=window.atob(e)
var a=r.length
var i=t(a)
var o=i.u8
for(var n=0;n<a;++n)o[n]=r.charCodeAt(n)
i.decode_size=a
return i}function encodeNativeNode(e,t,r){return o.from(e.buffer).toString("base64",t,t+r)}function decodeNativeNode(e,t){var r=t(3*(e.length>>2)+i(e.length%4/1.5))
var a=o.from(r.buffer)
r.decode_size=a.write(e,"base64")
return r}var e="undefined"!==typeof window
r.base64Decode=e?decodeNativeBrowser:decodeNativeNode
r.base64Encode=e?encode:encodeNativeNode
r.base64CharTable=s}).call(this)}).call(this,e("buffer").Buffer)},{buffer:void 0}],316:[function(e,t,r){"use strict"
r.chunkedReceiverInit=chunkedReceiverInit
r.chunkedReceiverCleanup=chunkedReceiverCleanup
r.chunkedReceiverFreeFile=chunkedReceiverFreeFile
r.chunkedReceiverGetFile=chunkedReceiverGetFile
r.chunkedReceiverStart=chunkedReceiverStart
r.chunkedReceiverOnChunk=chunkedReceiverOnChunk
r.chunkedReceiverFinish=chunkedReceiverFinish
r.chunkedSend=chunkedSend
r.MAX_CLIENT_UPLOAD_SIZE=void 0
var u=e("assert")
var a=e("glov-async"),d=a.asyncParallelLimit,n=a.asyncSeries
var f=e("./crc32.js")
var v=Math.ceil,h=Math.min
var i=e("./packet.js"),l=i.packetBufPoolAlloc,o=i.packetBufPoolFree
var s=2097152
r.MAX_CLIENT_UPLOAD_SIZE=s
var p=8092
function cleanupFile(e,t,r){var a=e.files[t]
if(a.dv){o(a.dv)
delete a.dv}e.buffer_size-=a.length
u(e.buffer_size>=0)
delete e.files[t]}function chunkedReceiverInit(e,t){return{name:e,max_buffer_size:t,last_file_id:0,buffer_size:0,files:{}}}function chunkedReceiverCleanup(e){if(!e||!e.files)return
for(var t in e.files)cleanupFile(e,t)}function chunkedReceiverFreeFile(e){var t=e.buffer,r=e.dv
u(t)
u(r)
o(r)
delete e.buffer}function chunkedReceiverGetFile(t,r){if(!t)return{err:"ERR_NOT_INITIALIZED"}
function err(e){console.error(t.name+": chunkedReceiverGetFile("+r+"): "+e)
return{err:e}}if(!t.files)return err("ERR_FILE_NOT_FOUND")
var e=t.files[r]
if(!e)return err("ERR_FILE_NOT_FOUND")
if(!e.finished){cleanupFile(t,r)
return err("ERR_UPLOAD_UNFINISHED")}var a=e.dv,i=e.mime_type,o=e.length
e.buffer=null
e.dv=null
cleanupFile(t,r)
return{dv:a,mime_type:i,buffer:new Uint8Array(a.buffer,a.byteOffset,o)}}function chunkedReceiverStart(e,t,r){u(e)
var a=t.readInt()
var i=t.readU32()
var o=t.readAnsiString()
var n=e.name+": chunkedReceiverStart length="+a+" crc="+i+" mime="+o
if(a>e.max_buffer_size){console.error(n+": ERR_TOO_LARGE")
return void r("ERR_TOO_LARGE")}if(e.buffer_size+a>e.max_buffer_size){console.error(n+": ERR_OUT_OF_SPACE")
return void r("ERR_OUT_OF_SPACE")}e.buffer_size+=a
var s=++e.last_file_id
console.log(n+" id="+s)
e.files[s]={length:a,crc:i,mime_type:o,total:0,dv:l(a)}
r(null,s)}function chunkedReceiverOnChunk(e,t,r){if(!e){t.pool()
return void r("ERR_NOT_INITED")}var a=t.readInt()
var i=t.readInt()
var o=t.readBuffer(false)
var n=e.name+": chunkedReceiverOnChunk id="+a+" offs="+i+" length="+o.length
var s=e.files&&e.files[a]
if(!s){console.error(n+": ERR_INVALID_FILE_ID")
return void r("ERR_INVALID_FILE_ID")}if(s.total+o.length>s.length){cleanupFile(e,a)
console.error(n+": ERR_BUFFER_OVERRUN")
return void r("ERR_BUFFER_OVERRUN")}console.debug(n)
s.total+=o.length
s.dv.u8.set(o,i)
if(e.on_progress)e.on_progress(s.total,s.length,s.mime_type,a)
r()}function chunkedReceiverFinish(e,t,r){var a=t.readInt()
if(!e)return void r("ERR_NOT_INITED")
var i=e.files&&e.files[a]
var o=e.name+": chunkedReceiverFinish id="+a
if(!i){console.error(o+": ERR_INVALID_FILE_ID")
return void r("ERR_INVALID_FILE_ID")}if(i.total!==i.length){cleanupFile(e,a)
console.error(o+": ERR_INCOMPLETE (total="+i.total+" length="+i.length+")")
return void r("ERR_INCOMPLETE")}var n=f(i.dv.u8,i.length)
if(n!==i.crc){cleanupFile(e,a)
console.error(o+": ERR_CRC_MISMATCH (expected="+i.crc+" actual="+n+")")
return void r("ERR_CRC_MISMATCH")}i.finished=true
r()}function chunkedSend(e,t){var s=e.client,l=e.buffer,a=e.mime_type,i=e.max_in_flight
u(l instanceof Uint8Array,"Invalid data type")
u(a,"Missing mime_type")
var c=l.length
u(c)
var o=f(l)
var _
n([function getID(r){var e=s.pak("upload_start")
e.writeInt(c)
e.writeU32(o)
e.writeAnsiString(a)
e.send(function(e,t){_=t
r(e)})},function streamFile(e){var o=v(c/p)
var n=false
function sendChunk(e,t){if(n)return void t()
u(e<o)
var r=s.pak("upload_chunk")
r.writeInt(_)
var a=e*p
r.writeInt(a)
var i=h(p,c-a)
r.writeBuffer(new Uint8Array(l.buffer,l.byteOffset+a,i))
r.send(function(e){if(e)n=true
t(e)})}var t=[]
for(var r=0;r<o;++r)t.push(sendChunk.bind(null,r))
d(t,i,e)},function finish(e){var t=s.pak("upload_finish")
t.writeInt(_)
t.send(e)}],function(e){t(e,_)})}},{"./crc32.js":318,"./packet.js":325,assert:void 0,"glov-async":void 0}],317:[function(e,t,r){"use strict"
r.canonical=canonical
r.defaultHandler=defaultHandler
r.create=create
r.TYPE_STRING=r.TYPE_FLOAT=r.TYPE_INT=void 0
var v=e("assert")
var h=e("./util.js").isInteger
var n=e("./perfcounters.js").perfCounterAdd
function canonical(e){return e.toLowerCase().replace(/[_.]/g,"")}var p=0
r.TYPE_INT=p
var m=1
r.TYPE_FLOAT=m
var a=2
r.TYPE_STRING=a
var g=["INTEGER","NUMBER","STRING"]
function defaultHandler(e,t){if(e)console.error(e,t)
else console.info(t)}function checkAccess(e,t){if(t)for(var r=0;r<t.length;++r)if(!e||!e[t[r]])return false
return true}function formatUsage(e,t,r){return!e?void 0:r?t+"\n"+e:t?String(e).replace(/\$HELP/,t):String(e)}function CmdParse(e){this.cmds={}
this.cmds_for_complete=this.cmds
this.was_not_found=false
this.storage=e&&e.storage
this.default_handler=defaultHandler
this.last_access=null
this.register({cmd:"cmd_list",func:this.cmdList.bind(this),access_show:["hidden"]})}CmdParse.prototype.cmdList=function(e,t){if(!this.cmd_list){var r=this.cmd_list={}
for(var a in this.cmds){var i=this.cmds[a]
var o=[]
if(i.access_show)o=o.concat(i.access_show)
if(i.access_run)o=o.concat(i.access_run)
if(-1!==o.indexOf("hidden"))continue
var n={name:i.name,help:String(i.help)}
if(i.usage)n.usage=formatUsage(i.usage,i.help,i.prefix_usage_with_help)
if(o.length)n.access_show=o
r[a]=n}}t(null,this.cmd_list)}
CmdParse.prototype.setDefaultHandler=function(e){v(this.default_handler===defaultHandler)
this.default_handler=e}
CmdParse.prototype.checkAccess=function(e){return checkAccess(this.last_access,e)}
CmdParse.prototype.handle=function(e,t,r){r=r||this.default_handler
this.was_not_found=false
var a=t.match(/^([^\s]+)(?:\s+(.*))?$/)
if(!a){r("Missing command")
return true}var i=canonical(a[1])
var o=this.cmds[i]
this.last_access=e&&e.access
if(o&&!checkAccess(this.last_access,o.access_run)){r('Access denied: "'+a[1]+'"')
return false}if(!o){this.was_not_found=true
r('Unknown command: "'+a[1]+'"')
return this.was_not_found=false}n("cmd."+i)
o.fn.call(e,a[2]||"",r)
return true}
CmdParse.prototype.register=function(e){v.equal(typeof e,"object")
var t=e.cmd,r=e.func,a=e.help,i=e.usage,o=e.prefix_usage_with_help,n=e.access_show,s=e.access_run,l=e.store_data
v(t)
v(r,'Missing function for command "'+t+'"')
var c=String(a||"").toLowerCase()
if(c.includes("(admin)"))v(s&&s.includes("sysadmin"))
if(c.includes("(hidden)"))v(n&&n.length)
var _=canonical(t)
v(!this.cmds[_],'Duplicate commands registered as "'+_+'"')
this.cmds[_]={name:t,fn:r,help:a,usage:i,prefix_usage_with_help:o,access_show:n,access_run:s,store_data:l}}
function formatRangeValue(e,t){var r=String(t)
if(e===m&&!r.includes("."))r+=".00"
return r}var E="cmd_parse_"
CmdParse.prototype.registerValue=function(l,c){var _=this
v(g[c.type]||!c.set)
v(c.set||c.get)
var u=c.label||l
var d=c.store&&this.storage||false
var f=""+E+canonical(l)
if(c.ver)f+="_"+c.ver
var e
if(d){v(c.set)
e={store_key:f,param:c}
var t=this.storage.getJSON(f)
if(void 0!==t){if(c.range){t=Number(t)
if(!isFinite(t)||t<c.range[0]||t>c.range[1])t=void 0}if(void 0!==t)c.set(t)
if(c.on_change)c.on_change(true)}}var r=function fn(e,t){function value(){t(null,u+" = "+c.get())}function usage(){t("Usage: /"+l+" "+g[c.type])}if(!e)if(c.get&&c.set){var r=c.type===p&&c.range&&0===c.range[0]&&1===c.range[1]
var a=[u+":"]
if(c.range)a.push("Valid range: ["+formatRangeValue(c.type,c.range[0])+"..."+formatRangeValue(c.type,c.range[1])+"]")
var i=c.get()
if(r){a.push("To disable: /"+l+" 0")
a.push("To enable: /"+l+" 1")}else{a.push("To change: /"+l+" NewValue")
a.push("  example: /"+l+" "+(c.range?i===c.range[0]?c.range[1]:c.range[0]:1))}var o=c.default_value
if(void 0!==o)a.push("Default value = "+o+(r?" ("+(o?"Enabled":"Disabled")+")":""))
a.push("Current value = "+i+(r?" ("+(i?"Enabled":"Disabled")+")":""))
return t(null,a.join("\n"))}else if(c.get)return value()
else return usage()
if(!c.set)return t("Usage: /"+l)
var n=Number(e)
if(c.range)if(n<c.range[0])n=c.range[0]
else if(n>c.range[1])n=c.range[1]
var s=n
if(c.type===p){if(!h(n))return usage()
c.set(n)}else if(c.type===m){if(!isFinite(n))return usage()
c.set(n)}else{s=e
c.set(e)}if(d)_.storage.setJSON(f,s)
if(c.on_change)c.on_change(false)
if(c.get)return value()
else return t(null,u+" udpated")}
this.register({cmd:l,func:r,help:c.help||(c.get&&c.set?'Set or display "'+u+'" value':c.set?'Set "'+u+'" value':'Display "'+u+'" value'),usage:c.usage||(c.get?'Display "'+u+'" value\n  Usage: /'+l+"\n":"")+(c.set?'Set "'+u+'" value\n  Usage: /'+l+" NewValue":""),prefix_usage_with_help:c.prefix_usage_with_help,access_show:c.access_show,access_run:c.access_run,store_data:e})}
CmdParse.prototype.resetSettings=function(){var e=[]
var t=this.storage.localStorageExportAll(E)
var r=0
for(var a in t){var i=t[a]
var o=a.slice(E.length)
var n=void 0
var s=o.split("_")
o=s[0]
n=s[1]
var l=this.cmds[o]
if(!l){this.storage.set(a,void 0)
e.push('Cleared unknown setting "'+o+'" = '+i);++r}else{var c
var _=l.name,u=l.store_data
var d=null==u?void 0:null==(c=u.param)?void 0:c.default_value
if(u&&u.store_key!==a){this.storage.set(a,void 0)
e.push('Cleared old setting "'+_+" (v"+(n||0)+')"');++r}else if(void 0!==d)if(JSON.stringify(d)===i)this.storage.set(a,void 0)
else{this.storage.set(a,void 0)
e.push('Cleared setting "'+_+'" = '+i+" (default = "+d+")");++r}else{this.storage.set(a,void 0)
e.push('Cleared setting "'+_+'" = '+i);++r}}}if(e.length)e.push("Reset "+r+" setting(s)")
return e}
function cmpCmd(e,t){if(e.cname<t.cname)return-1
return 1}CmdParse.prototype.addServerCommands=function(e){var t=this.cmds_for_complete
if(this.cmds_for_complete===this.cmds){t=this.cmds_for_complete={}
for(var r in this.cmds)t[r]=this.cmds[r]}for(var a in e)if(!t[a])t[a]=e[a]}
CmdParse.prototype.autoComplete=function(e,t){var r=[]
var a=canonical((e=e.split(" "))[0])
for(var i in this.cmds_for_complete)if(1===e.length&&i.slice(0,a.length)===a||e.length>1&&i===a){var o=this.cmds_for_complete[i]
if(checkAccess(t,o.access_show)&&checkAccess(t,o.access_run))r.push({cname:i,cmd:o.name,help:String(o.help),usage:formatUsage(o.usage,o.help,o.prefix_usage_with_help)})}r.sort(cmpCmd)
return r}
CmdParse.prototype.canonical=canonical
CmdParse.prototype.TYPE_INT=p
CmdParse.prototype.TYPE_FLOAT=m
CmdParse.prototype.TYPE_STRING=a
function create(e){return new CmdParse(e)}},{"./perfcounters.js":326,"./util.js":330,assert:void 0}],318:[function(e,t,r){"use strict"
var i=new Array(256);(function(){for(var e=0;e<256;e++){var t=e
for(var r=0;r<8;r++)if(1&t)t=-306674912^t>>>1
else t>>>=1
i[e]=t}})()
function update_crc(e,t,r){for(var a=0;a<r;a++)e=i[255&(e^t[a])]^e>>>8
return e}function crc32(e,t){return(4294967295^update_crc(4294967295,e,t=t||e.length))>>>0}t.exports=crc32
t.exports.crc32=crc32},{}],319:[function(e,t,r){"use strict"
var a=(0,e("./util.js").arrayToSet)(["__proto__","prototype","constructor"])
function isObject(e){var t=typeof e
return null!==e&&("object"===t||"function"===t)}function isValidPath(e){for(var t=0;t<e.length;++t)if(a[e[t]])return false
return true}function getPathSegments(e){var t=e.split(".")
var r=[]
for(var a=0;a<t.length;a++){var i=t[a]
while("\\"===i[i.length-1]&&void 0!==t[a+1]){i=i.slice(0,-1)+"."
i+=t[++a]}r.push(i)}if(!isValidPath(r))return[]
return r}t.exports={get:function get(e,t,r){if(!isObject(e)||"string"!==typeof t)return void 0===r?e:r
var a=getPathSegments(t)
if(0===a.length)return r
for(var i=0;i<a.length;i++)if(void 0===(e=e[a[i]])||null===e){if(i!==a.length-1)return r
break}return void 0===e?r:e},set:function set(e,t,r){if(!isObject(e)||"string"!==typeof t)return e
var a=e
var i=getPathSegments(t)
for(var o=0;o<i.length;o++){var n=i[o]
if(o===i.length-1)e[n]=r
else if(!isObject(e[n]))e[n]={}
e=e[n]}return a},delete:function _delete(e,t){if(!isObject(e)||"string"!==typeof t)return false
var r=getPathSegments(t)
for(var a=0;a<r.length;a++){var i=r[a]
if(a===r.length-1){delete e[i]
return true}if(!isObject(e=e[i]))return false}},has:function has(e,t){if(!isObject(e)||"string"!==typeof t)return false
var r=getPathSegments(t)
if(0===r.length)return false
for(var a=0;a<r.length;a++)if(isObject(e)){if(!(r[a]in e))return false
e=e[r[a]]}else return false
return true}}},{"./util.js":330}],320:[function(e,t,r){"use strict"
r.EntityBaseCommon=r.EntityUpdateCmd=r.EntityFieldSpecial=r.EntityFieldSub=r.EntityFieldEncoding=r.EALF_HAS_ASSIGNMENTS=r.EALF_HAS_PAYLOAD=r.EALF_HAS_ENT_ID=r.EALF_HAS_PREDICATE=void 0
var a
var n=e("assert")
var i=1
r.EALF_HAS_PREDICATE=i
var o=2
r.EALF_HAS_ENT_ID=o
var s=4
r.EALF_HAS_PAYLOAD=s
var l=8
r.EALF_HAS_ASSIGNMENTS=l
var c={JSON:1,Int:2,Float:3,AnsiString:4,U8:5,U32:6,String:7,Boolean:8,Vec2:9,Vec3:10,U8Vec3:11,IVec3:12,Custom0:127}
r.EntityFieldEncoding=c
var _={None:0,Array:1,Record:2}
r.EntityFieldSub=_
var u={Terminate:0,Default:1,MAX:2}
r.EntityFieldSpecial=u
var d;(function(e){e[e["Terminate"]=0]="Terminate"
e[e["Full"]=1]="Full"
e[e["Diff"]=2]="Diff"
e[e["Delete"]=3]="Delete"
e[e["Event"]=4]="Event"
e[e["Schema"]=5]="Schema"
e[e["IsInitialList"]=6]="IsInitialList"})((r.EntityUpdateCmd=d)||(r.EntityUpdateCmd=d={}))
var f=function(){function EntityBaseCommon(e,t){this.id=void 0
this.data=void 0
this.entity_manager=void 0
this.id=e
this.data={}
this.entity_manager=t}EntityBaseCommon.prototype.getData=function getData(e){n(0)
return}
EntityBaseCommon.registerFieldEncoding=function registerFieldEncoding(e){for(var t in e){var r=Number(t)
var a=e[r]
var i=a.encoder
var o=a.decoder
n(!this.field_encoders[r])
this.field_encoders[r]=i
this.field_decoders[r]=o}}
return EntityBaseCommon}();(r.EntityBaseCommon=f).field_encoders={}
f.field_decoders={}
f.registerFieldEncoding(((a={})[c.JSON]={encoder:function encJSON(e,t,r){t.writeJSON(r)},decoder:function decJSON(e,t){return e.readJSON()}},a[c.Int]={encoder:function encInt(e,t,r){t.writeInt(r)},decoder:function decInt(e,t){return e.readInt()}},a[c.Float]={encoder:function encFloat(e,t,r){t.writeFloat(r)},decoder:function decFloat(e,t){return e.readFloat()}},a[c.AnsiString]={encoder:function encAnsiString(e,t,r){t.writeAnsiString(r)},decoder:function decAnsiString(e,t){return e.readAnsiString()}},a[c.U8]={encoder:function encU8(e,t,r){t.writeU8(r)},decoder:function decU8(e,t){return e.readU8()}},a[c.U32]={encoder:function encU32(e,t,r){t.writeU32(r)},decoder:function decU32(e,t){return e.readU32()}},a[c.String]={encoder:function encString(e,t,r){t.writeString(r)},decoder:function decString(e,t){return e.readString()}},a[c.Boolean]={encoder:function encBool(e,t,r){t.writeBool(r)},decoder:function decBool(e,t){return e.readBool()}},a[c.Vec2]={encoder:function encVec2(e,t,r){var a=r
t.writeFloat(a[0])
t.writeFloat(a[1])},decoder:function decVec2(e,t){var r=t||[]
r[0]=e.readFloat()
r[1]=e.readFloat()
return r}},a[c.Vec3]={encoder:function encVec3(e,t,r){var a=r
t.writeFloat(a[0])
t.writeFloat(a[1])
t.writeFloat(a[2])},decoder:function decVec3(e,t){var r=t||[]
r[0]=e.readFloat()
r[1]=e.readFloat()
r[2]=e.readFloat()
return r}},a[c.U8Vec3]={encoder:function encU8Vec3(e,t,r){var a=r
t.writeU8(a[0])
t.writeU8(a[1])
t.writeU8(a[2])},decoder:function decU8Vec3(e,t){var r=t||[]
r[0]=e.readU8()
r[1]=e.readU8()
r[2]=e.readU8()
return r}},a[c.IVec3]={encoder:function encIVec3(e,t,r){var a=r
t.writeInt(a[0])
t.writeInt(a[1])
t.writeInt(a[2])},decoder:function decIVec3(e,t){var r=t||[]
r[0]=e.readInt()
r[1]=e.readInt()
r[2]=e.readInt()
return r}},a))},{assert:void 0}],321:[function(e,t,r){"use strict"
r.getStringEnumValues=getStringEnumValues
r.isValidNumberEnumKey=isValidNumberEnumKey
r.isValidStringEnumKey=isValidStringEnumKey
r.isValidStringEnumValue=isValidStringEnumValue
r.getPlatformValues=getPlatformValues
r.isValidPlatform=isValidPlatform
r.Platform=r.ID_PROVIDER_FB_INSTANT=r.ID_PROVIDER_FB_GAMING=r.ID_PROVIDER_APPLE=r.PRESENCE_INACTIVE=r.PRESENCE_ACTIVE=r.PRESENCE_OFFLINE=void 0
var a=0
r.PRESENCE_OFFLINE=a
var i=1
r.PRESENCE_ACTIVE=i
var o=2
r.PRESENCE_INACTIVE=o
var n="apl"
r.ID_PROVIDER_APPLE=n
var s="fbg"
r.ID_PROVIDER_FB_GAMING=s
var l="fbi"
r.ID_PROVIDER_FB_INSTANT=l
function getStringEnumValues(e){return Object.values(e)}function isValidNumberEnumKey(e,t){return"number"===typeof e[t]}function isValidStringEnumKey(e,t){return t in e}function isValidStringEnumValue(e,t){for(var r in e)if(e[r]===t)return true
return false}var c;(function(e){e["Android"]="android"
e["FBInstant"]="fbinstant"
e["IOS"]="ios"
e["MSStart"]="msstart"
e["Web"]="web"
e["Yandex"]="yandex"})((r.Platform=c)||(r.Platform=c={}))
function getPlatformValues(){return getStringEnumValues(c)}function isValidPlatform(e){return isValidStringEnumValue(c,e)}},{}],322:[function(e,t,r){"use strict"
r.ERR_NOT_AVAILABLE=r.ERR_UNAUTHORIZED=r.ERR_INVALID_PROVIDER=r.ERR_INVALID_DATA=void 0
var a="ERR_INVALID_DATA"
r.ERR_INVALID_DATA=a
var i="ERR_INVALID_PROVIDER"
r.ERR_INVALID_PROVIDER=i
var o="ERR_UNAUTHORIZED"
r.ERR_UNAUTHORIZED=o
var n="ERR_NOT_AVAILABLE"
r.ERR_NOT_AVAILABLE=n},{}],323:[function(e,t,r){"use strict"
r.FriendStatus=void 0
var a;(function(e){e[e["Added"]=1]="Added"
e[e["AddedAuto"]=2]="AddedAuto"
e[e["Removed"]=3]="Removed"
e[e["Blocked"]=4]="Blocked"})((r.FriendStatus=a)||(r.FriendStatus=a={}))},{}],324:[function(e,t,r){"use strict"
var R=e("assert")
function stringUtf8Encode(e){var t
var r
var a=[]
e=e.replace(/\r\n/g,"\n")
for(r=0;r<e.length;++r)if((t=e.charCodeAt(r))<128)a.push(String.fromCharCode(t))
else if(t>127&&t<2048){a.push(String.fromCharCode(t>>6|192))
a.push(String.fromCharCode(63&t|128))}else{a.push(String.fromCharCode(t>>12|224))
a.push(String.fromCharCode(t>>6&63|128))
a.push(String.fromCharCode(63&t|128))}return a.join("")}function rotateLeft(e,t){return e<<t|e>>>32-t}function addUnsigned(e,t){var r=2147483648&e
var a=2147483648&t
var i=1073741824&e
var o=1073741824&t
var n=(1073741823&e)+(1073741823&t)
if(i&o)return 2147483648^n^r^a
if(i|o)if(1073741824&n)return 3221225472^n^r^a
else return 1073741824^n^r^a
else return n^r^a}function F(e,t,r){return e&t|~e&r}function G(e,t,r){return e&r|t&~r}function H(e,t,r){return e^t^r}function I(e,t,r){return t^(e|~r)}function FF(e,t,r,a,i,o,n){e=addUnsigned(e,addUnsigned(addUnsigned(F(t,r,a),i),n))
return addUnsigned(rotateLeft(e,o),t)}function GG(e,t,r,a,i,o,n){e=addUnsigned(e,addUnsigned(addUnsigned(G(t,r,a),i),n))
return addUnsigned(rotateLeft(e,o),t)}function HH(e,t,r,a,i,o,n){e=addUnsigned(e,addUnsigned(addUnsigned(H(t,r,a),i),n))
return addUnsigned(rotateLeft(e,o),t)}function II(e,t,r,a,i,o,n){e=addUnsigned(e,addUnsigned(addUnsigned(I(t,r,a),i),n))
return addUnsigned(rotateLeft(e,o),t)}function convertToWordArray(e){var t=e.length
var r=t+8
var a=16*((r-r%64)/64+1)
var i=new Array(a-1)
var o=0
var n=0
while(n<t){o=n%4*8
i[(n-n%4)/4]|=e.charCodeAt(n)<<o
n++}i[(n-n%4)/4]|=128<<(o=n%4*8)
i[a-2]=t<<3
i[a-1]=t>>>29
return i}function wordToHex(e){var t=""
var r=""
var a
for(a=0;a<=3;a++)t+=(r="0"+(e>>>8*a&255).toString(16)).substr(r.length-2,2)
return t}t.exports=function md5(e){var t
var r
var a
var i
var o
var n
var s
var l
var c
var _=7
var u=12
var d=17
var f=22
var v=5
var h=9
var p=14
var m=20
var g=4
var E=11
var y=16
var T=23
var I=6
var S=10
var A=15
var w=21
var L
if("string"===typeof e)L=convertToWordArray(e=stringUtf8Encode(e))
else R(false)
o=1732584193
n=4023233417
s=2562383102
l=271733878
for(c=0;c<L.length;c+=16){o=FF(t=o,r=n,a=s,i=l,L[c],_,3614090360)
l=FF(l,o,n,s,L[c+1],u,3905402710)
s=FF(s,l,o,n,L[c+2],d,606105819)
n=FF(n,s,l,o,L[c+3],f,3250441966)
o=FF(o,n,s,l,L[c+4],_,4118548399)
l=FF(l,o,n,s,L[c+5],u,1200080426)
s=FF(s,l,o,n,L[c+6],d,2821735955)
n=FF(n,s,l,o,L[c+7],f,4249261313)
o=FF(o,n,s,l,L[c+8],_,1770035416)
l=FF(l,o,n,s,L[c+9],u,2336552879)
s=FF(s,l,o,n,L[c+10],d,4294925233)
n=FF(n,s,l,o,L[c+11],f,2304563134)
o=FF(o,n,s,l,L[c+12],_,1804603682)
l=FF(l,o,n,s,L[c+13],u,4254626195)
s=FF(s,l,o,n,L[c+14],d,2792965006)
o=GG(o,n=FF(n,s,l,o,L[c+15],f,1236535329),s,l,L[c+1],v,4129170786)
l=GG(l,o,n,s,L[c+6],h,3225465664)
s=GG(s,l,o,n,L[c+11],p,643717713)
n=GG(n,s,l,o,L[c],m,3921069994)
o=GG(o,n,s,l,L[c+5],v,3593408605)
l=GG(l,o,n,s,L[c+10],h,38016083)
s=GG(s,l,o,n,L[c+15],p,3634488961)
n=GG(n,s,l,o,L[c+4],m,3889429448)
o=GG(o,n,s,l,L[c+9],v,568446438)
l=GG(l,o,n,s,L[c+14],h,3275163606)
s=GG(s,l,o,n,L[c+3],p,4107603335)
n=GG(n,s,l,o,L[c+8],m,1163531501)
o=GG(o,n,s,l,L[c+13],v,2850285829)
l=GG(l,o,n,s,L[c+2],h,4243563512)
s=GG(s,l,o,n,L[c+7],p,1735328473)
o=HH(o,n=GG(n,s,l,o,L[c+12],m,2368359562),s,l,L[c+5],g,4294588738)
l=HH(l,o,n,s,L[c+8],E,2272392833)
s=HH(s,l,o,n,L[c+11],y,1839030562)
n=HH(n,s,l,o,L[c+14],T,4259657740)
o=HH(o,n,s,l,L[c+1],g,2763975236)
l=HH(l,o,n,s,L[c+4],E,1272893353)
s=HH(s,l,o,n,L[c+7],y,4139469664)
n=HH(n,s,l,o,L[c+10],T,3200236656)
o=HH(o,n,s,l,L[c+13],g,681279174)
l=HH(l,o,n,s,L[c],E,3936430074)
s=HH(s,l,o,n,L[c+3],y,3572445317)
n=HH(n,s,l,o,L[c+6],T,76029189)
o=HH(o,n,s,l,L[c+9],g,3654602809)
l=HH(l,o,n,s,L[c+12],E,3873151461)
s=HH(s,l,o,n,L[c+15],y,530742520)
o=II(o,n=HH(n,s,l,o,L[c+2],T,3299628645),s,l,L[c],I,4096336452)
l=II(l,o,n,s,L[c+7],S,1126891415)
s=II(s,l,o,n,L[c+14],A,2878612391)
n=II(n,s,l,o,L[c+5],w,4237533241)
o=II(o,n,s,l,L[c+12],I,1700485571)
l=II(l,o,n,s,L[c+3],S,2399980690)
s=II(s,l,o,n,L[c+10],A,4293915773)
n=II(n,s,l,o,L[c+1],w,2240044497)
o=II(o,n,s,l,L[c+8],I,1873313359)
l=II(l,o,n,s,L[c+15],S,4264355552)
s=II(s,l,o,n,L[c+6],A,2734768916)
n=II(n,s,l,o,L[c+13],w,1309151649)
o=II(o,n,s,l,L[c+4],I,4149444226)
l=II(l,o,n,s,L[c+11],S,3174756917)
s=II(s,l,o,n,L[c+2],A,718787259)
n=II(n,s,l,o,L[c+9],w,3951481745)
o=addUnsigned(o,t)
n=addUnsigned(n,r)
s=addUnsigned(s,a)
l=addUnsigned(l,i)}return(wordToHex(o)+wordToHex(n)+wordToHex(s)+wordToHex(l)).toLowerCase()}},{assert:void 0}],325:[function(x,e,O){(function(R){(function(){"use strict"
O.packetBufPoolAlloc=packetBufPoolAlloc
O.packetBufPoolFree=packetBufPoolFree
O.packetDefaultFlags=packetDefaultFlags
O.packetEnableDebug=packetEnableDebug
var i=O.PACKET_DEBUG=1
var e=O.PACKET_RESERVED1=2
var t=O.PACKET_RESERVED2=4
var l=i|e|t
var n=256
var c=x("assert")
var s=Math.max
var r=x("./util.js"),a=r.deprecate,o=r.isInteger,_=r.log2
var u=x("./base64.js"),d=u.base64Encode,f=u.base64Decode
a(O,"default_flags")
var v=[void 0,null,0,false,"",NaN]
var h=1024
var p="PKTERR_UNDERRUN"
var m=5e3
var g=5e3
var E=[0,10,10,20,20,20,20,20,20,20,5e3,20,20,20,20,20,20,10,10]
var y=[]
var T=[]
var I=E.map(function(){return[]})
function allocDataView(e){var t=_(e)
c(t)
if(t>=I.length)t=0
if(t){e=1<<t
if(I[t].length)return I[t].pop()}var r=new Uint8Array(e)
var a=new DataView(r.buffer)
a.u8=r
if(t)a.packet_pool_idx=t
return a}function wrapU8AsDataView(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength)
t.u8=e
return t}function utf8ByteLength(e){var t=e.length
var r=t
for(var a=0;a<t;++a){var i=e.charCodeAt(a)
if(i>127){++r
if(i>2047){++r
if(i>65535){++r
if(i>2097151){++r
if(i>67108863)++r}}}}}return r}function utf8WriteChar(e,t,r){if(r>1114111)r=65535
if(r<=127)e.u8[t++]=r
else if(r<=2047){e.u8[t++]=r>>6|192
e.u8[t++]=63&r|128}else if(r<=65535){e.u8[t++]=r>>12|224
e.u8[t++]=r>>6&63|128
e.u8[t++]=63&r|128}else if(r<=1114111){e.u8[t++]=r>>18|240
e.u8[t++]=r>>12&63|128
e.u8[t++]=r>>6&63|128
e.u8[t++]=63&r|128}else c(false)
return t}function poolBuf(e){c(e)
c(e.u8)
var t=e.packet_pool_idx
if(t){var r=I[t]
if(r.length<E[t])r.push(e)}}function packetBufPoolAlloc(e){return allocDataView(e)}function packetBufPoolFree(e){poolBuf(e)}var S=0
function packetDefaultFlags(){return S}function packetEnableDebug(e){if(e)S|=i}function Packet(e,t,r){this.reinit(e,t,r)}Packet.prototype.reinit=function(e,t,r){this.flags=e||0
this.has_flags=false
this.buf=null
this.buf_len=0
this.buf_offs=0
this.bufs=null
this.bsizes=null
this.readable=false
this.ref_count=1
this.pak_debug=r
if(t){this.fit(t,true)
this.buf_len=t}}
Packet.prototype.getRefCount=function(){return this.ref_count}
Packet.prototype.ref=function(){c(this.ref_count);++this.ref_count}
Packet.prototype.pool=function(){c(this.ref_count)
if(--this.ref_count)return
if(this.flags&n);else{if(this.buf)poolBuf(this.buf)
if(this.bufs)for(var e=0;e<this.bufs.length;++e)poolBuf(this.bufs[e])}if(y.length<m)y.push(this)
if(this.pak_debug)this.pak_debug.poolDebug()}
Packet.prototype.totalSize=function(){var e=0
if(this.readable)return this.buf_len
if(this.bsizes)for(var t=0;t<this.bsizes.length;++t)e+=this.bsizes[t]
return e+this.buf_offs}
Packet.prototype.setReadable=function(){c(this.buf)
c(!this.bufs)
c(!this.readable)
this.readable=true}
Packet.prototype.makeReadable=function(){c(this.buf)
c(!this.readable)
var e=this.totalSize()
this.readable=true
if(!this.bufs){this.buf_len=e
this.buf_offs=0
return}var t=allocDataView(e)
var r=t.u8
var a=0
for(var i=0;i<this.bufs.length;++i){var o=this.bsizes[i]
var n=this.bufs[i]
if(a+n.u8.length>e){c.equal(n.byteOffset,0)
r.set(new Uint8Array(n.buffer,0,o),a)}else r.set(n.u8,a)
a+=o
poolBuf(n)}c.equal(this.buf.byteOffset,0)
r.set(new Uint8Array(this.buf.buffer,this.buf.byteOffset,this.buf_offs),a)
poolBuf(this.buf)
c.equal(a+this.buf_offs,e)
this.bufs=this.bsizes=null
this.buf=t
this.buf_offs=0
this.buf_len=e}
Packet.prototype.flush=function(){var e=this.buf,t=this.buf_offs
if(!this.bufs){this.bufs=[e]
this.bsizes=[t]}else{this.bufs.push(e)
this.bsizes.push(t)}this.buf=null
this.buf_len=0
this.buf_offs=0}
Packet.prototype.fit=function(e,t){var r=this.buf,a=this.buf_len,i=this.buf_offs
var o=i+e
if(o<=a){if(!t)this.buf_offs=o
return i}c(!this.readable)
if(r)this.flush()
this.buf_len=a=s(h,e)
this.buf=allocDataView(a)
this.buf_offs=t?0:e
return 0}
Packet.prototype.advance=function(e){var t=this.buf_offs
var r=t+e
if((this.buf_offs=r)>this.buf_len)throw new Error(p)
if(r===this.buf_len)this.pool()
return t}
Packet.prototype.ended=function(){return this.buf_offs===this.buf_len}
Packet.prototype.writeU8=function(e){c(e>=0&&e<256)
var t=this.fit(1)
this.buf.u8[t]=e}
Packet.prototype.readU8=function(){return this.buf.u8[this.advance(1)]}
Packet.prototype.writeInt=function(e){c(o(e))
var t=this.fit(9,true)
var r=this.buf
var a=e<0?1:0
if(a)e=-e
if(e<248){if(a)r.u8[t++]=255
r.u8[t++]=e}else if(e<65536){r.u8[t++]=248+a
r.setUint16(t,e,true)
t+=2}else if(e<4294967296){r.u8[t++]=250+a
r.setUint32(t,e,true)
t+=4}else{r.u8[t++]=252+a
var i=e>>>0
r.setUint32(t,i,true)
r.setUint32(t+=4,(e-i)/4294967296,true)
t+=4}this.buf_offs=t}
Packet.prototype.zeroInt=function(){var e=this.buf.u8[this.buf_offs]
if(e<248){this.buf.u8[this.buf_offs++]=0
return}this.buf_offs++
var t
switch(e){case 253:case 252:t=8
break
case 251:case 250:t=4
break
case 249:case 248:t=2
break
case 255:t=1
break
default:throw new Error("PKTERR_PACKED_INT")}while(t){--t
this.buf.u8[this.buf_offs++]=0}}
Packet.prototype.readInt=function(){var e=this.buf.u8[this.advance(1)]
if(e<248)return e
var t=1
switch(e){case 249:t=-1
case 248:return t*this.buf.getUint16(this.advance(2),true)
case 251:t=-1
case 250:return t*this.buf.getUint32(this.advance(4),true)
case 253:t=-1
case 252:var r=this.buf.getUint32(this.advance(4),true)
return t*(4294967296*this.buf.getUint32(this.advance(4),true)+r)
case 255:return-this.buf.u8[this.advance(1)]
default:throw new Error("PKTERR_PACKED_INT")}}
Packet.prototype.writeFloat=function(e){c.equal(typeof e,"number")
if(!e){this.buf.u8[this.fit(1)]=0
return}var t=this.fit(5,true)
this.buf.setFloat32(t,e,true)
if(this.buf.u8[t]<=1){this.buf.u8[t++]=1
this.buf.setFloat32(t,e,true)}this.buf_offs=t+4}
Packet.prototype.readFloat=function(){var e=this.advance(1)
var t=this.buf.u8[e]
if(!t)return 0
if(1===t)return this.buf.getFloat32(this.advance(4),true)
this.advance(3)
return this.buf.getFloat32(e,true)}
Packet.prototype.writeU32=function(e){c.equal(typeof e,"number")
this.buf.setUint32(this.fit(4),e,true)}
Packet.prototype.readU32=function(){return this.buf.getUint32(this.advance(4),true)}
Packet.prototype.writeString=function(e){c.equal(typeof e,"string")
var t=utf8ByteLength(e)
this.writeInt(t)
if(!t)return
var r=this.fit(t)
var a=this.buf
for(var i=0;i<e.length;++i){var o=e.charCodeAt(i)
if(o<=127)a.u8[r++]=o
else r=utf8WriteChar(a,r,o)}}
Packet.prototype.utf8ReadChar=function(e){var t=this.buf
if(e>=192&&e<224)return(31&e)<<6|63&t.u8[this.buf_offs++]
else if(e>=224&&e<240)return(15&e)<<12|(63&t.u8[this.buf_offs++])<<6|63&t.u8[this.buf_offs++]
else if(e>=240&&e<248)return(15&e)<<18|(63&t.u8[this.buf_offs++])<<12|(63&t.u8[this.buf_offs++])<<6|63&t.u8[this.buf_offs++]
else return 65533}
var A=[]
Packet.prototype.readString=function(){var e=this.readInt()
if(!e)return""
if(this.buf_offs+e>this.buf_len)throw new Error(p)
var t=this.buf
var r=this.buf_offs+e
var a
if(e>8192){a=""
while(this.buf_offs<r){var i=t.u8[this.buf_offs++]
if(i>127)i=this.utf8ReadChar(i)
a+=String.fromCharCode(i)}}else{A.length=e
var o=0
while(this.buf_offs<r){var n=t.u8[this.buf_offs++]
if(n>127)n=this.utf8ReadChar(n)
A[o++]=n}if(A.length!==o)A.length=o
a=String.fromCharCode.apply(void 0,A)}if(this.buf_offs===this.buf_len)this.pool()
return a}
Packet.prototype.writeAnsiString=function(e){c.equal(typeof e,"string")
var t=e.length
this.writeInt(t)
var r=this.fit(t)
var a=this.buf
for(var i=0;i<t;++i)a.u8[r++]=e.charCodeAt(i)}
Packet.prototype.readAnsiString=function(){var e=this.readInt()
if(!e)return""
var t=this.advance(e)
var r=this.buf
A.length=e
for(var a=0;a<e;++a)A[a]=r.u8[t++]
return String.fromCharCode.apply(void 0,A)}
Packet.prototype.writeJSON=function(e){if(!e){var t=v.indexOf(e)
c(-1!==t)
this.writeU8(t+1)
return}this.writeU8(0)
this.writeString(JSON.stringify(e))}
Packet.prototype.readJSON=function(){var e=this.readU8()
if(e){if(e-1>=v.length)throw new Error("PKTERR_JSON_HEADER")
return v[e-1]}var t=this.readString()
return JSON.parse(t)}
Packet.prototype.writeBuffer=function(e){this.writeInt(e.length)
if(e.length){var t=this.fit(e.length)
this.buf.u8.set(e,t)}}
var w=new Uint8Array(0)
Packet.prototype.readBuffer=function(e){var t=this.readInt()
if(!t)return w
var r=this.advance(t)
if(e)return this.buf.u8.slice(r,r+t)
else{var a=this.buf
return new Uint8Array(a.buffer,a.byteOffset+r,t)}}
Packet.prototype.writeBool=function(e){this.writeU8(e?1:0)}
Packet.prototype.readBool=function(){return Boolean(this.readU8())}
Packet.prototype.append=function(e){c.equal(this.flags&l,e.flags&l)
if(e.bufs)for(var t=0;t<e.bufs.length;++t){var r=e.bufs[t]
var a=e.bsizes[t]
var i=this.fit(a)
if(a!==r.byteLength)this.buf.u8.set(new Uint8Array(r.buffer,r.byteOffset,a),i)
else this.buf.u8.set(r.u8,i)}if(e.buf){var o=e.buf
var n=e.readable?e.buf_len:e.buf_offs
var s=this.fit(n)
if(n!==o.byteLength)this.buf.u8.set(new Uint8Array(o.buffer,o.byteOffset,n),s)
else this.buf.u8.set(o.u8,s)}}
Packet.prototype.appendRemaining=function(e){c.equal(this.flags&l,e.flags&l)
c(e.readable)
c(!e.bufs)
c(e.buf)
c(e.buf_offs<=e.buf_len)
var t=e.buf_len-e.buf_offs
if(t){var r=this.fit(t)
this.buf.u8.set(new Uint8Array(e.buf.buffer,e.buf.byteOffset+e.buf_offs,t),r)}e.pool()}
Packet.prototype.toJSON=function(){var e={f:this.flags}
if(this.bufs){e.b=[]
for(var t=0;t<this.bufs.length;++t)e.b.push(d(this.bufs[t],0,this.bsizes[t]))}if(this.buf)if(this.readable)e.d=d(this.buf,0,this.buf_len)
else e.d=d(this.buf,0,this.buf_offs)
return e}
Packet.prototype.setBuffer=function(e,t){c(!this.buf)
c(!this.bufs)
c(this.flags&n)
c(e instanceof Uint8Array)
this.buf=wrapU8AsDataView(e)
this.buf_len=t
this.readable=true}
Packet.prototype.getBuffer=function(){c(this.buf)
c(!this.bufs)
return this.buf.u8}
Packet.prototype.getBufferLen=function(){c(this.buf)
c(!this.bufs)
return this.readable?this.buf_len:this.buf_offs}
Packet.prototype.getOffset=function(){if(this.readable)return this.buf_offs
return this.totalSize()}
Packet.prototype.seek=function(e){c(this.readable)
c(e>=0&&e<=this.buf_len)
this.buf_offs=e}
Packet.prototype.writeFlags=function(){c(!this.has_flags)
c.equal(this.buf_offs,0)
this.writeU8(this.flags)
this.has_flags=true}
Packet.prototype.updateFlags=function(e){c(this.has_flags)
c(!(e&l))
this.flags=this.flags&l|e;(this.bufs?this.bufs[0]:this.buf).u8[0]=this.flags}
Packet.prototype.readFlags=function(){var e=this.readU8()
c.equal(e,255&this.flags)
this.has_flags=true
return this.flags}
Packet.prototype.getFlags=function(){return this.flags}
Packet.prototype.getInternalFlags=function(){return this.flags&l}
Packet.prototype.contents=function(){return"pak("+this.totalSize()+"b)"}
function PacketDebug(e,t){this.reinit(e,t)}PacketDebug.prototype.reinit=function(e,t){var r=this
this.in_pool=false
if(y.length){this.pak=y.pop()
this.pak.reinit(e,t,this)}else this.pak=new Packet(e,t,this)
this.warned=false
this.pool_timer=setTimeout(function(){console.warn("Packet not pooled after 5s: "+r.contents())
r.warned=true},g)}
PacketDebug.prototype.poolDebug=function(){if(this.warned)console.warn("Packet pooled after timeout")
else clearTimeout(this.pool_timer)
c(!this.in_pool)
this.in_pool=true
if(T.length<m)T.push(this)}
var L=[null,"U8","U32","Int","Float","String","AnsiString","JSON","Bool","Buffer"]
L.forEach(function(r,a){if(!r)return
var e="write"+r
var t="read"+r
var i=Packet.prototype[e]
var o=Packet.prototype[t]
PacketDebug.prototype[e]=function(e){this.pak.writeU8(a)
i.call(this.pak,e)}
PacketDebug.prototype[t]=function(e){var t=this.pak.readU8()
if(t!==a)c(false,"PacketDebug error: Expected "+r+"("+a+"), found "+L[t]+"("+t+")")
return o.call(this.pak,e)}})
PacketDebug.prototype.zeroInt=function(){this.pak.writeU8(3)
this.pak.zeroInt()};["ended","getBuffer","getBufferLen","getFlags","getInternalFlags","getOffset","getRefCount","makeReadable","pool","readFlags","ref","seek","setBuffer","setReadable","toJSON","totalSize","updateFlags","writeFlags"].forEach(function(e){var t=Packet.prototype[e]
PacketDebug.prototype[e]=function(){return t.apply(this.pak,arguments)}})
PacketDebug.prototype.append=function(e){c(e instanceof PacketDebug)
this.pak.append(e.pak)}
PacketDebug.prototype.appendRemaining=function(e){c(e instanceof PacketDebug)
this.pak.appendRemaining(e.pak)}
function format(e){switch(typeof e){case"object":if(e instanceof Uint8Array)return"u8<"+e.length+">"
return JSON.stringify(e)
default:return e}}PacketDebug.prototype.contents=function(){var e=this.pak
var t=e.getOffset()
var r=t
var a=["buf:"+e.buf_offs+"/"+e.buf_len]
if(e.bufs){e.makeReadable()
a.push("bufs")}else if(e.buf){if(e.readable)r=e.buf_len
e.buf_offs=0}else{a.push("empty")
r=-1}var i=e.ref_count
e.ref_count=2
try{if(!i)a.push("!ref_count=0!")
if(e.has_flags)a.push("flags:"+e.readU8())
while(e.buf_offs<r){var o=e.readU8()
var n=L[o]
if(!n){a.push("UnknownType:"+o)
break}var s=e["read"+n]()
a.push(n+":"+format(s))}}catch(e){a.push("Error dumping packet contents: "+e)}e.ref_count=i
e.buf_offs=t
return a.join(",")}
function packetCreate(e,t){if(void 0===e)e=S
var r=e&i?T:y
if(r.length){var a=r.pop()
a.reinit(e,t)
return a}if(e&i)return new PacketDebug(e,t)
return new Packet(e,t)}O.packetCreate=packetCreate
function packetFromBuffer(e,t,r){var a=e[0]
c.equal(typeof a,"number")
if(r){c(t)
c(e.buffer instanceof ArrayBuffer)
var i=packetCreate(a,t)
if(e.byteLength!==t)e=R.from(e.buffer,0,t)
i.getBuffer().set(e)
i.setReadable()
return i}else{c(e instanceof Uint8Array)
var o=packetCreate(a|n)
o.setBuffer(e,t||e.byteLength)
return o}}O.packetFromBuffer=packetFromBuffer
function packetFromJSON(e){var t=packetCreate(e.f)
var r=t.pak||t
function decode(e){return f(e,allocDataView)}if(e.b){r.bsizes=[]
r.bufs=[]
for(var a=0;a<e.b.length;++a){var i=decode(e.b[a])
r.bufs.push(i)
r.bsizes.push(i.decode_size)
delete i.decode_size}}if(e.d){r.buf=decode(e.d)
r.buf_len=r.buf.decode_size
delete r.buf.decode_size
r.buf_offs=0}return t}O.packetFromJSON=packetFromJSON
function isPacket(e){return e instanceof Packet||e instanceof PacketDebug}O.isPacket=isPacket}).call(this)}).call(this,x("buffer").Buffer)},{"./base64.js":315,"./util.js":330,assert:void 0,buffer:void 0}],326:[function(e,t,r){"use strict"
r.perfCounterAdd=perfCounterAdd
r.perfCounterAddValue=perfCounterAddValue
r.perfCounterTick=perfCounterTick
r.perfCounterHistory=perfCounterHistory
var a=1e4
var i=5
var o={time_start:Date.now()}
var n=[o]
var s=a
function perfCounterAdd(e){o[e]=(o[e]||0)+1}function perfCounterAddValue(e,t){o[e]=(o[e]||0)+t}function perfCounterTick(e,t){if((s-=e)<=0){s=a
if(n.length===i)n.splice(0,1)
var r=Date.now()
o.time_end=r
if(t)t(o);(o={}).time_start=r
n.push(o)}}function perfCounterHistory(){return n}},{}],327:[function(e,t,r){"use strict"
r.mashString=mashString
r.mashI53=mashI53
r.randCreate=randCreate
r.shuffleArray=shuffleArray
function mashString(e){var t=4022871197
for(var r=0;r<e.length;r++){var a=.02519603282416938*(t+=e.charCodeAt(r))
a-=t=a>>>0
t=(a*=t)>>>0
t+=4294967296*(a-=t)}return t>>>0}function mashI53(e){var t=4022871197
while(e){var r=e%256
e=(e-r)/256
var a=.02519603282416938*(t+=r)
a-=t=a>>>0
t=(a*=t)>>>0
t+=4294967296*(a-=t)}return 2.3283064365386963e-10*(t>>>0)}function Mash(){this.n=3228327880}Mash.prototype.mash=function(e){var t=this.n+e
var r=.02519603282416938*t
r-=t=r>>>0
t=(r*=t)>>>0
return 2.3283064365386963e-10*((this.n=t+=4294967296*(r-=t))>>>0)}
function Alea(e){this.reseed(e)}Alea.prototype.reseed=function(e){this.c=1
var t=new Mash
this.s0=.3014581324532628
this.s1=.2643220406025648
this.s2=.7516536582261324
this.s0-=t.mash(e)
if(this.s0<0)this.s0+=1
this.s1-=t.mash(e)
if(this.s1<0)this.s1+=1
this.s2-=t.mash(e)
if(this.s2<0)this.s2+=1}
Alea.prototype.step=function(){var e=2091639*this.s0+2.3283064365386963e-10*this.c
this.s0=this.s1
this.s1=this.s2
return this.s2=e-(this.c=0|e)}
Alea.prototype.uint32=function(){return 4294967296*this.step()}
Alea.prototype.fract53=function(){return this.step()+11102230246251565e-32*(2097152*this.step()|0)}
Alea.prototype.random=Alea.prototype.step
Alea.prototype.range=function(e){return this.step()*e|0}
Alea.prototype.floatBetween=function(e,t){return e+(t-e)*this.random()}
Alea.prototype.exportState=function(){return[this.s0,this.s1,this.s2,this.c]}
Alea.prototype.importState=function(e){this.s0=e[0]
this.s1=e[1]
this.s2=e[2]
this.c=e[3]}
function randCreate(e){return new Alea(e)}function shuffleArray(e,t){for(var r=t.length-1;r>=1;--r){var a=e.range(r+1)
var i=t[r]
t[r]=t[a]
t[a]=i}}},{}],328:[function(e,t,r){"use strict"
var o=e("assert")
function EventEmitter(){this._listeners={}}t.exports=EventEmitter
Object.defineProperty(t.exports,"EventEmitter",{value:EventEmitter,enumerable:false})
function addListener(e,t,r,a){o("function"===typeof r)
var i=e._listeners[t]
if(!i)i=e._listeners[t]=[]
i.push({once:a,fn:r})}EventEmitter.prototype.hasListener=function(e,t){var r=this._listeners[e]
if(!r)return false
for(var a=0;a<r.length;++a)if(r[a].fn===t)return true
return false}
EventEmitter.prototype.on=function(e,t){addListener(this,e,t,0)
return this}
EventEmitter.prototype.once=function(e,t){addListener(this,e,t,1)
return this}
EventEmitter.prototype.removeListener=function(e,t){var r=this._listeners[e]
o(r)
for(var a=0;a<r.length;++a)if(r[a].fn===t){r.splice(a,1)
return this}o(false)
return this}
function filterNotOnce(e){return!e.once}EventEmitter.prototype.emit=function(e){var t=this._listeners[e]
if(!t)return false
var r=false
var a=false
for(var i=arguments.length,o=new Array(i>1?i-1:0),n=1;n<i;n++)o[n-1]=arguments[n]
for(var s=0;s<t.length;++s){var l=t[s]
r=true
l.fn.apply(l,o)
if(l.once)a=true}if(a)this._listeners[e]=t.filter(filterNotOnce)
return r}},{assert:void 0}],329:[function(e,t,r){"use strict"
r.isDataObject=isDataObject
r.isClientHandlerSource=isClientHandlerSource
function isDataObject(e){return e?"object"===typeof e&&!Array.isArray(e):false}function isClientHandlerSource(e){return"client"===e.type}},{}],330:[function(e,t,r){"use strict"
r.nop=nop
r.identity=identity
r.once=once
r.empty=empty
r.easeInOut=easeInOut
r.easeIn=easeIn
r.easeOut=easeOut
r.clone=clone
r.merge=merge
r.has=has
r.defaults=defaults
r.defaultsDeep=defaultsDeep
r.cloneShallow=cloneShallow
r.deepEqual=deepEqual
r.deepAdd=deepAdd
r.clamp=clamp
r.lerp=lerp
r.mix=mix
r.map01=map01
r.sign=sign
r.mod=mod
r.log2=log2
r.ridx=ridx
r.round100=round100
r.round1000=round1000
r.fract=fract
r.nearSame=nearSame
r.titleCase=titleCase
r.lineCircleIntersect=lineCircleIntersect
r.lineLineIntersect=lineLineIntersect
r.inherits=inherits
r.isPowerOfTwo=isPowerOfTwo
r.nextHighestPowerOfTwo=nextHighestPowerOfTwo
r.logdata=logdata
r.isInteger=isInteger
r.toNumber=toNumber
r.randomNot=randomNot
r.toArray=toArray
r.arrayToSet=arrayToSet
r.objectToSet=objectToSet
r.matchAll=matchAll
r.callEach=callEach
r.sanitize=sanitize
r.plural=plural
r.secondsToFriendlyString=secondsToFriendlyString
r.secondsSince2020=secondsSince2020
r.dateToSafeLocaleString=dateToSafeLocaleString
r.msToTimeString=msToTimeString
r.cleanupStringArray=cleanupStringArray
r.cleanStringSplit=cleanStringSplit
r.eatPossiblePromise=eatPossiblePromise
r.errorString=errorString
r.deprecate=deprecate
var n=e("assert")
var u=Math.abs,s=Math.floor,a=Math.min,i=Math.max,o=Math.random,l=Math.round,c=Math.pow,d=Math.sqrt
function nop(){}function identity(e){return e}function once(e){var t=false
return function(){if(t)return
t=true
e.apply(void 0,arguments)}}function empty(e){for(var t in e)return false
return true}function easeInOut(e,t){var r=c(e,t)
return r/(r+c(1-e,t))}function easeIn(e,t){return 2*easeInOut(.5*e,t)}function easeOut(e,t){return 2*easeInOut(.5+.5*e,t)-1}function clone(e){if(!e)return e
return JSON.parse(JSON.stringify(e))}function merge(e,t){for(var r in t)e[r]=t[r]
return e}function has(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function defaults(e,t){for(var r in t)if(!has(e,r))e[r]=t[r]
return e}function defaultsDeep(e,t){for(var r in t)if(!has(e,r))e[r]=t[r]
else if("object"===typeof e[r])defaultsDeep(e[r],t[r])
return e}function cloneShallow(e){return merge({},e)}function deepEqual(e,t){if(Array.isArray(e)){if(!Array.isArray(t))return false
if(e.length!==t.length)return false
for(var r=0;r<e.length;++r)if(!deepEqual(e[r],t[r]))return false
return true}else if("object"===typeof e){if("object"!==typeof t)return false
if(!e||!t)return!e&&!t
for(var a in e)if(!deepEqual(e[a],t[a]))return false
for(var i in t)if(void 0!==t[i]&&void 0===e[i])return false
return true}return e===t}function deepAdd(e,t){n(e&&t)
for(var r in t){var a=t[r]
var i=e[r]
if("object"===typeof a){n(a)
var o=e[r]=i||{}
n.equal(typeof o,"object")
deepAdd(o,a)}else{if(!i)i=0
n("number"===typeof i)
n("number"===typeof a)
e[r]=(i||0)+a}}}function clamp(e,t,r){return a(i(t,e),r)}function lerp(e,t,r){return(1-e)*t+e*r}function mix(e,t,r){return(1-r)*e+r*t}function map01(e,t,r){return(e-t)/(r-t)}function sign(e){return e<0?-1:e>0?1:0}function mod(e,t){return(e%t+t)%t}function log2(e){for(var t=1,r=0;;t<<=1,++r)if(t>=e)return r}function ridx(e,t){e[t]=e[e.length-1]
e.pop()}function round100(e){return l(100*e)/100}function round1000(e){return l(1e3*e)/1e3}function fract(e){return e-s(e)}function nearSame(e,t,r){return u(t-e)<=r}function titleCase(e){return e.split(" ").map(function(e){return""+e[0].toUpperCase()+e.slice(1)}).join(" ")}var f=1e-5
function lineCircleIntersect(e,t,r,a){var i=[t[0]-e[0],t[1]-e[1]]
var o=i[0]*i[0]+i[1]*i[1]
var n=2*(i[0]*(e[0]-r[0])+i[1]*(e[1]-r[1]))
var s=r[0]*r[0]+r[1]*r[1]
s+=e[0]*e[0]+e[1]*e[1]
s-=2*(r[0]*e[0]+r[1]*e[1])
var l=n*n-4*o*(s-=a*a)
if(u(o)<f||l<0)return false
var c=(-n+d(l))/(2*o)
var _=(-n-d(l))/(2*o)
if(c>=0&&c<=1||_>=0&&_<=1)return true
return false}function lineLineIntersect(e,t,r,a){var i=(a[1]-r[1])*(t[0]-e[0])-(a[0]-r[0])*(t[1]-e[1])
var o=(a[0]-r[0])*(e[1]-r[1])-(a[1]-r[1])*(e[0]-r[0])
var n=(t[0]-e[0])*(e[1]-r[1])-(t[1]-e[1])*(e[0]-r[0])
if(0===i){if(!o&&!n)return true
return false}var s=o/i
var l=n/i
if(s<0||s>1||l<0||l>1)return false
return true}function inherits(e,t){n("function"===typeof t)
var r=e.prototype
e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}})
for(var a in r)e.prototype[a]=r[a]
for(var i in t)e[i]=t[i]}function isPowerOfTwo(e){return 0===(e&e-1)}function nextHighestPowerOfTwo(e){--e
for(var t=1;t<32;t<<=1)e|=e>>t
return e+1}function logdata(e){if(void 0===e)return""
var t=JSON.stringify(e)
if(t.length<120)return t
return t.slice(0,117)+"...("+t.length+")"}function isInteger(e){return"number"===typeof e&&isFinite(e)&&s(e)===e}function toNumber(e){return Number(e)}function randomNot(e,t){var r
do{r=s(o()*t)}while(r===e)
return r}function toArray(e){return Array.prototype.slice.call(e)}function arrayToSet(e){var t=Object.create(null)
for(var r=0;r<e.length;++r)t[e[r]]=true
return t}function objectToSet(e){return merge(Object.create(null),e)}function matchAll(e,t){var r=[]
var a
do{if(a=t.exec(e))r.push(a[1])}while(a)
return r}function callEach(e,t){if(e&&e.length){for(var r=arguments.length,a=new Array(r>2?r-2:0),i=2;i<r;i++)a[i-2]=arguments[i]
for(var o=0;o<e.length;++o)e[o].apply(e,a)}}var _=/[\uD800-\uDFFF\x00-\x1F\x7F\u1D54\u1D55\u2000-\u200F\u205F-\u206F\uFE00]/g
function sanitize(e){return(e||"").replace(_,"")}function plural(e,t){return t+(1===e?"":"s")}function secondsToFriendlyString(e,t){var r=s(e/86400)
var a=s((e-=60*r*60*24)/3600)
var i=s((e-=60*a*60)/60)
e-=60*i
var o=[]
if(r){var n=s(r/365.25)
if(n){r-=s(365.25*n)
o.push(n+" "+plural(n,"year"))}o.push(r+" "+plural(r,"day"))}if(a)o.push(a+" "+plural(a,"hour"))
if(i||!o.length)o.push(i+" "+plural(i,"minute"))
if(t)o.push(e+" "+plural(e,"second"))
return o.join(", ")}function secondsSince2020(){return s(Date.now()/1e3)-1577836800}function dateToSafeLocaleString(t,r){var a
try{a=r?t.toLocaleDateString():t.toLocaleString()}catch(e){console.error(e,"(Using toString as fallback)")
a=r?t.toDateString():t.toString()}return a}function msToTimeString(e,t){var r=e%1e3
var a
var i
var o
o=(i=(a=e-r)-(a%=6e4))-(i%=36e5)
i/=6e4
return((o/=36e5)?o+":":"")+(o&&i<10?"0":"")+i+":"+((a/=1e3)<10?"0":"")+a+((t=t||{}).hide_ms?"":"."+(r<10?"00":r<100?"0":"")+r)}var v=arrayToSet(["am","an","and","as","at","be","by","el","for","in","is","la","las","los","of","on","or","the","that","this","to","with"])
function cleanupStringArray(e){return e.filter(function(e){return e.length>1&&e.length<=32&&!v[e]})}function cleanStringSplit(e,t){return cleanupStringArray(sanitize(e).replace(/[.,/\\@#£!$%^&*;:<>{}|?=\-+_`'"~[\]()]/g,"").replace(/\s{1,}/g," ").toLowerCase().split(t).map(function(e){return e.trim()}))}function eatPossiblePromise(e){if(e&&e.catch)e.catch(nop)}function errorString(e){var t=String(e)
if("[object Object]"===t)try{t=JSON.stringify(e)}catch(e){}if(e&&e.stack&&e.message)t=String(e.message)
return t.slice(0,600)}function deprecate(e,t,r){Object.defineProperty(e,t,{get:function get(){n(false,t+" is deprecated, use "+r+" instead")
return}})}},{assert:void 0}],331:[function(e,t,r){"use strict"
var a=true
function verify(e,t){if(!e&&a)throw new Error("Assertion failed"+(t?": "+t:""))
return e}(function(e){e.ok=verify
function equal(e,t){if(e===t)return true
if(a)throw new Error('Assertion failed: "'+e+'"==="'+t+'"')
return false}e.equal=equal
function dothrow(e){a=e}e.dothrow=dothrow})(verify=verify||{})
t.exports=verify},{}],332:[function(e,t,r){"use strict"
r.vec1=vec1
r.vec2=vec2
r.ivec2=ivec2
r.vec3=vec3
r.ivec3=ivec3
r.vec4=vec4
r.v2abs=v2abs
r.v2add=v2add
r.v2addScale=v2addScale
r.v2angle=v2angle
r.v2copy=v2copy
r.v2dist=v2dist
r.v2distSq=v2distSq
r.v2div=v2div
r.v2dot=v2dot
r.v2floor=v2floor
r.v2iFloor=v2iFloor
r.v2lengthSq=v2lengthSq
r.v2length=v2length
r.v2lerp=v2lerp
r.v2mul=v2mul
r.v2normalize=v2normalize
r.v2iNormalize=v2iNormalize
r.v2round=v2round
r.v2iRound=v2iRound
r.v2same=v2same
r.v2scale=v2scale
r.v2set=v2set
r.v2sub=v2sub
r.v3add=v3add
r.v3iAdd=v3iAdd
r.v3addScale=v3addScale
r.v3angle=v3angle
r.v3copy=v3copy
r.v3cross=v3cross
r.v3determinant=v3determinant
r.v3distSq=v3distSq
r.v3dist=v3dist
r.v3div=v3div
r.v3dot=v3dot
r.v3iFloor=v3iFloor
r.v3floor=v3floor
r.v3lengthSq=v3lengthSq
r.v3length=v3length
r.v3lerp=v3lerp
r.v3iMax=v3iMax
r.v3iMin=v3iMin
r.v3mul=v3mul
r.v3iMul=v3iMul
r.v3mulMat4=v3mulMat4
r.m4TransformVec3=m4TransformVec3
r.v3normalize=v3normalize
r.v3iNormalize=v3iNormalize
r.v3perspectiveProject=v3perspectiveProject
r.v3pow=v3pow
r.v3round=v3round
r.v3iRound=v3iRound
r.v3same=v3same
r.v3scale=v3scale
r.v3scaleFloor=v3scaleFloor
r.v3iScale=v3iScale
r.v3set=v3set
r.v3sub=v3sub
r.v3iSub=v3iSub
r.v3zero=v3zero
r.v4add=v4add
r.v4clone=v4clone
r.v4copy=v4copy
r.v4dot=v4dot
r.v4fromRGBA=v4fromRGBA
r.v4lerp=v4lerp
r.v4mul=v4mul
r.v4mulAdd=v4mulAdd
r.v4same=v4same
r.v4scale=v4scale
r.v4set=v4set
r.v4zero=v4zero
r.zaxis=r.yaxis=r.xaxis=r.identity_mat4=r.identity_mat3=r.zero_vec=r.half_vec=r.unit_vec=r.rovec4=r.roivec3=r.rovec3=r.roivec2=r.rovec2=r.rovec1=r.mat4=r.mat3=void 0
var a=e("gl-mat3/create")
var i=e("gl-mat4/create")
var o=Math.abs,n=Math.acos,s=Math.max,l=Math.min,c=Math.floor,_=Math.pow,u=Math.round,d=Math.sqrt
var f=a
r.mat3=f
var v=i
r.mat4=v
function vec1(e){return new Float32Array([e||0])}var h=vec1
r.rovec1=h
function vec2(e,t){var r=new Float32Array(2)
if(e||t){r[0]=e
r[1]=t}return r}var p=vec2
r.rovec2=p
function ivec2(e,t){var r=new Int32Array(2)
if(e||t){r[0]=e
r[1]=t}return r}var m=ivec2
r.roivec2=m
function vec3(e,t,r){var a=new Float32Array(3)
if(e||t||r){a[0]=e
a[1]=t
a[2]=r}return a}var g=vec3
r.rovec3=g
function ivec3(e,t,r){var a=new Int32Array(3)
if(e||t||r){a[0]=e
a[1]=t
a[2]=r}return a}var E=ivec3
r.roivec3=E
function vec4(e,t,r,a){var i=new Float32Array(4)
if(e||t||r||a){i[0]=e
i[1]=t
i[2]=r
i[3]=a}return i}var y=vec4
r.rovec4=y
function frozenVec4(e,t,r,a){return y(e,t,r,a)}var T=frozenVec4(1,1,1,1)
r.unit_vec=T
var I=frozenVec4(.5,.5,.5,.5)
r.half_vec=I
var S=frozenVec4(0,0,0,0)
r.zero_vec=S
var A=f()
r.identity_mat3=A
var w=v()
r.identity_mat4=w
var L=frozenVec4(1,0,0,0)
r.xaxis=L
var R=frozenVec4(0,1,0,0)
r.yaxis=R
var x=frozenVec4(0,0,1,0)
r.zaxis=x
function v2abs(e,t){e[0]=o(t[0])
e[1]=o(t[1])
return e}function v2add(e,t,r){e[0]=t[0]+r[0]
e[1]=t[1]+r[1]
return e}function v2addScale(e,t,r,a){e[0]=t[0]+r[0]*a
e[1]=t[1]+r[1]*a
return e}function v2angle(e,t){var r=d((e[0]*e[0]+e[1]*e[1])*(t[0]*t[0]+t[1]*t[1]))
return n(l(s(r&&(e[0]*t[0]+e[1]*t[1])/r,-1),1))}function v2copy(e,t){e[0]=t[0]
e[1]=t[1]
return e}function v2dist(e,t){return d((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1]))}function v2distSq(e,t){return(e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])}function v2div(e,t,r){e[0]=t[0]/r[0]
e[1]=t[1]/r[1]
return e}function v2dot(e,t){return e[0]*t[0]+e[1]*t[1]}function v2floor(e,t){e[0]=c(t[0])
e[1]=c(t[1])
return e}function v2iFloor(e){e[0]=c(e[0])
e[1]=c(e[1])
return e}function v2lengthSq(e){return e[0]*e[0]+e[1]*e[1]}function v2length(e){return d(v2lengthSq(e))}function v2lerp(e,t,r,a){var i=1-t
e[0]=i*r[0]+t*a[0]
e[1]=i*r[1]+t*a[1]
return e}function v2mul(e,t,r){e[0]=t[0]*r[0]
e[1]=t[1]*r[1]
return e}function v2normalize(e,t){var r=t[0]*t[0]+t[1]*t[1]
if(r>0){r=1/d(r)
e[0]=t[0]*r
e[1]=t[1]*r}return e}function v2iNormalize(e){var t=e[0]*e[0]+e[1]*e[1]
if(t>0){t=1/d(t)
e[0]*=t
e[1]*=t}return e}function v2round(e,t){e[0]=u(t[0])
e[1]=u(t[1])
return e}function v2iRound(e){e[0]=u(e[0])
e[1]=u(e[1])
return e}function v2same(e,t){return e[0]===t[0]&&e[1]===t[1]}function v2scale(e,t,r){e[0]=t[0]*r
e[1]=t[1]*r
return e}function v2set(e,t,r){e[0]=t
e[1]=r
return e}function v2sub(e,t,r){e[0]=t[0]-r[0]
e[1]=t[1]-r[1]
return e}function v3add(e,t,r){e[0]=t[0]+r[0]
e[1]=t[1]+r[1]
e[2]=t[2]+r[2]
return e}function v3iAdd(e,t){e[0]+=t[0]
e[1]+=t[1]
e[2]+=t[2]
return e}function v3addScale(e,t,r,a){e[0]=t[0]+r[0]*a
e[1]=t[1]+r[1]*a
e[2]=t[2]+r[2]*a
return e}function v3angle(e,t){var r=d((e[0]*e[0]+e[1]*e[1]+e[2]*e[2])*(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]))
return n(l(s(r&&(e[0]*t[0]+e[1]*t[1]+e[2]*t[2])/r,-1),1))}function v3copy(e,t){e[0]=t[0]
e[1]=t[1]
e[2]=t[2]
return e}function v3cross(e,t,r){var a=t[0]
var i=t[1]
var o=t[2]
var n=r[0]
var s=r[1]
var l=r[2]
e[0]=i*l-o*s
e[1]=o*n-a*l
e[2]=a*s-i*n
return e}function v3determinant(e,t,r){var a=e[0]
var i=t[0]
var o=r[0]
var n=e[1]
var s=t[1]
var l=r[1]
var c=e[2]
var _=t[2]
var u=r[2]
return a*(u*s-l*_)+i*(-u*n+l*c)+o*(_*n-s*c)}function v3distSq(e,t){return(e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])+(e[2]-t[2])*(e[2]-t[2])}function v3dist(e,t){return d(v3distSq(e,t))}function v3div(e,t,r){e[0]=t[0]/r[0]
e[1]=t[1]/r[1]
e[2]=t[2]/r[2]
return e}function v3dot(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function v3iFloor(e){e[0]=c(e[0])
e[1]=c(e[1])
e[2]=c(e[2])
return e}function v3floor(e,t){e[0]=c(t[0])
e[1]=c(t[1])
e[2]=c(t[2])
return e}function v3lengthSq(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]}function v3length(e){return d(v3lengthSq(e))}function v3lerp(e,t,r,a){var i=1-t
e[0]=i*r[0]+t*a[0]
e[1]=i*r[1]+t*a[1]
e[2]=i*r[2]+t*a[2]
return e}function v3iMax(e,t){e[0]=s(e[0],t[0])
e[1]=s(e[1],t[1])
e[2]=s(e[2],t[2])
return e}function v3iMin(e,t){e[0]=l(e[0],t[0])
e[1]=l(e[1],t[1])
e[2]=l(e[2],t[2])
return e}function v3mul(e,t,r){e[0]=t[0]*r[0]
e[1]=t[1]*r[1]
e[2]=t[2]*r[2]
return e}function v3iMul(e,t){e[0]*=t[0]
e[1]*=t[1]
e[2]*=t[2]
return e}function v3mulMat4(e,t,r){var a=t[0]
var i=t[1]
var o=t[2]
e[0]=a*r[0]+i*r[4]+o*r[8]
e[1]=a*r[1]+i*r[5]+o*r[9]
e[2]=a*r[2]+i*r[6]+o*r[10]
return e}function m4TransformVec3(e,t,r){var a=t[0]
var i=t[1]
var o=t[2]
e[0]=a*r[0]+i*r[4]+o*r[8]+r[12]
e[1]=a*r[1]+i*r[5]+o*r[9]+r[13]
e[2]=a*r[2]+i*r[6]+o*r[10]+r[14]
return e}function v3normalize(e,t){var r=t[0]*t[0]+t[1]*t[1]+t[2]*t[2]
if(r>0){r=1/d(r)
e[0]=t[0]*r
e[1]=t[1]*r
e[2]=t[2]*r}return e}function v3iNormalize(e){var t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2]
if(t>0){t=1/d(t)
e[0]*=t
e[1]*=t
e[2]*=t}return e}function v3perspectiveProject(e,t,r){var a=t[0]
var i=t[1]
var o=t[2]
var n=.5/(r[3]*a+r[7]*i+r[11]*o+r[15]||1e-5)
e[0]=(r[0]*a+r[4]*i+r[8]*o+r[12])*n+.5
e[1]=(r[1]*a+r[5]*i+r[9]*o+r[13])*-n+.5
e[2]=r[2]*a+r[6]*i+r[10]*o+r[14]
return e}function v3pow(e,t,r){e[0]=_(t[0],r)
e[1]=_(t[1],r)
e[2]=_(t[2],r)
return e}function v3round(e,t){e[0]=u(t[0])
e[1]=u(t[1])
e[2]=u(t[2])
return e}function v3iRound(e){e[0]=u(e[0])
e[1]=u(e[1])
e[2]=u(e[2])
return e}function v3same(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function v3scale(e,t,r){e[0]=t[0]*r
e[1]=t[1]*r
e[2]=t[2]*r
return e}function v3scaleFloor(e,t,r){e[0]=c(t[0]*r)
e[1]=c(t[1]*r)
e[2]=c(t[2]*r)
return e}function v3iScale(e,t){e[0]*=t
e[1]*=t
e[2]*=t
return e}function v3set(e,t,r,a){e[0]=t
e[1]=r
e[2]=a
return e}function v3sub(e,t,r){e[0]=t[0]-r[0]
e[1]=t[1]-r[1]
e[2]=t[2]-r[2]
return e}function v3iSub(e,t){e[0]-=t[0]
e[1]-=t[1]
e[2]-=t[2]
return e}function v3zero(e){e[0]=e[1]=e[2]=0
return e}function v4add(e,t,r){e[0]=t[0]+r[0]
e[1]=t[1]+r[1]
e[2]=t[2]+r[2]
e[3]=t[3]+r[3]
return e}function v4clone(e){return e.slice(0)}function v4copy(e,t){e[0]=t[0]
e[1]=t[1]
e[2]=t[2]
e[3]=t[3]
return e}function v4dot(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function v4fromRGBA(e){return vec4((e>>>24)/255,((16711680&e)>>16)/255,((65280&e)>>8)/255,(255&e)/255)}function v4lerp(e,t,r,a){var i=1-t
e[0]=i*r[0]+t*a[0]
e[1]=i*r[1]+t*a[1]
e[2]=i*r[2]+t*a[2]
e[3]=i*r[3]+t*a[3]
return e}function v4mul(e,t,r){e[0]=t[0]*r[0]
e[1]=t[1]*r[1]
e[2]=t[2]*r[2]
e[3]=t[3]*r[3]
return e}function v4mulAdd(e,t,r,a){e[0]=t[0]*r[0]+a[0]
e[1]=t[1]*r[1]+a[1]
e[2]=t[2]*r[2]+a[2]
e[3]=t[3]*r[3]+a[3]
return e}function v4same(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function v4scale(e,t,r){e[0]=t[0]*r
e[1]=t[1]*r
e[2]=t[2]*r
e[3]=t[3]*r
return e}function v4set(e,t,r,a,i){e[0]=t
e[1]=r
e[2]=a
e[3]=i
return e}function v4zero(e){e[0]=e[1]=e[2]=e[3]=0
return e}},{"gl-mat3/create":void 0,"gl-mat4/create":void 0}],333:[function(e,t,r){"use strict"
r.profanityCommonStartup=profanityCommonStartup
r.reservedStartup=reservedStartup
r.profanityFilterCommon=profanityFilterCommon
r.isProfane=isProfane
r.isReserved=isReserved
var u=e("assert")
var d=Math.max
var f="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+"
var v="4bcd3fgh1jk1mn0pqr57uvwxy24bcd3fgh1jk1mn0pqr57uvwxy201234567897"
var a=/[a-zA-Z0-9+]+/g
var h={}
function canonize(e){return e.split("").map(function(e){return h[e]||e}).join("")}function rot13(e){return e.split("").map(function(e){if((e=e.charCodeAt(0))>=97&&e<=122)e=97+(e-97+13)%26
else if(e>=65&&e<=90)e=65+(e-65+13)%26
return String.fromCharCode(e)}).join("")}var p={}
var i={}
var n=["","s","s","in","ing","er","ers","ed","y"]
var m=["","5","35","1n","1ng","3r","3r5","3d","y"]
var g=0
var E=false
function profanityCommonStartup(e,t){u(!E)
E=true
for(var r=0;r<f.length;++r)h[f[r]]=v[r]
var a=e.split("\n").filter(function(e){return e})
for(var i=0;i<a.length;++i){var o=rot13(a[i])
var n=o.length
o=canonize(o)
u.equal(n,o.length)
for(var s=0;s<m.length;++s){var l=o+m[s]
var c=p[l]
if(!c||c>s){g=d(g,l.length)
p[l]=s+1}}}a=t.split("\n").filter(function(e){return e})
for(var _=0;_<a.length;++_)delete p[canonize(a[_])]}function reservedStartup(e){var t=e.split("\n").filter(function(e){return e})
for(var r=0;r<t.length;++r){var a=canonize(t[r])
i[a]=1}}var s
function filterWord(e){if(e.length>=g)return e
var t=e[0].toUpperCase()===e[0]
var r=canonize(e)
var a=p[r]
if(!a)return e;--a
var i=s()
if(t)i=i[0].toUpperCase()+i.slice(1)
var o=n[a]
if(i[i.length-1]===o[0])o=o.slice(1)
if(i.endsWith("e")&&"i"===o[0])i=i.slice(0,-1)
return i+o}var o
function checkWord(e){if(e.length>=g)return
if(p[canonize(e)])o=true}function profanityFilterCommon(e,t){u(E)
s=t
return e.replace(a,filterWord)}function isProfane(e){u(E)
o=false
e.replace(a,checkWord)
return o}var l
function checkReserved(e){if(i[canonize(e)])l=true}function isReserved(e){u(E)
l=false
e.replace(a,checkReserved)
return l}},{assert:void 0}],334:[function(e,t,r){"use strict"
r.netDelaySet=netDelaySet
r.netDelayGet=netDelayGet
r.wsPakSendDest=wsPakSendDest
r.wsPak=wsPak
r.sendMessage=sendMessage
r.wsHandleMessage=wsHandleMessage
r.PING_TIME=r.CONNECTION_TIMEOUT=r.wsstats_out=r.wsstats=void 0
var i={msgs:0,bytes:0}
r.wsstats=i
var o={msgs:0,bytes:0}
r.wsstats_out=o
var a=e("./ack.js")
var _=e("assert")
var s=a.ackHandleMessage,u=a.ackReadHeader,n=a.ackWrapPakStart,l=a.ackWrapPakPayload,d=a.ackWrapPakFinish
var c=Math.random,f=Math.round
var v=e("./packet.js"),h=v.isPacket,p=v.packetCreate,m=v.packetDefaultFlags,g=v.packetFromBuffer
var E=e("./perfcounters.js").perfCounterAddValue
var y=6e4
var T=(r.CONNECTION_TIMEOUT=y)/2
r.PING_TIME=T
var I=28
var S=0
var A=0
function socketSendInternal(e,t,r){if(e.ws_server)e.socket.send(t,r.pool.bind(r))
else{e.socket.send(t)
r.pool()}}function netDelaySet(e,t){if(void 0===e){e=100
t=50}if(e)console.log("NetDelay: ON ("+e+"+"+t+")")
else console.log("NetDelay: Off")
S=e
A=t}function netDelayGet(){return[S,A]}function NetDelayer(e,t){this.client=e
this.head=null
this.tail=null
this.tick=this.tickFn.bind(this)}NetDelayer.prototype.send=function(e,t){var r=Date.now()
var a=f(S+A*c())
var i={buf:e,pak:t,time:r+a,next:null}
if(this.tail){this.tail.next=i
this.tail=i}else{this.head=this.tail=i
setTimeout(this.tick,a)}}
NetDelayer.prototype.tickFn=function(){var e=this.client
if(e.net_delayer!==this){while(this.head){var t=this.head
t.pak.pool()
this.head=t.next}this.tail=null
return}var r=Date.now()
do{var a=this.head
this.head=a.next
if(!this.head)this.tail=null
socketSendInternal(e,a.buf,a.pak)}while(this.head&&this.head.time<=r)
if(this.head)setTimeout(this.tick,this.head.time-r)}
function wsPakSendDest(e,t){if(!e.connected||1!==e.socket.readyState){console.warn("Attempting to send on a disconnected link (client_id:"+e.id+"), ignoring")
t.pool()
return}var r=t.getBuffer()
var a=t.getBufferLen()
if(a!==r.length)r=new Uint8Array(r.buffer,r.byteOffset,a)
E("net.send_bytes.total",r.length)
o.msgs++
o.bytes+=r.length
if(S){if(!e.net_delayer)e.net_delayer=new NetDelayer(e)
e.net_delayer.send(r,t)}else socketSendInternal(e,r,t)
e.last_send_time=Date.now()}function wsPakSendFinish(e,t,r){var a=e.ws_data,i=a.client,o=a.msg
delete e.ws_data
var n=d(e,t,r)
if(!i.connected||1!==i.socket.readyState){if("channel_msg"===o){e.seek(0)
e.readFlags()
var s=u(e)
var l
var c
if(h(s.data)){e.ref()
l=e.readAnsiString()
c=e.readAnsiString()
if(!e.ended())e.pool()}else{l=s.data.channel_id
c=s.data.msg}o="channel_msg:"+l+":"+c}if("number"!==typeof o){(i.log?i:console).log("Attempting to send msg="+o+" on a disconnected link, ignoring")
if(!i.log&&i.onError&&o)i.onError("Attempting to send msg="+o+" on a disconnected link")}if(n)delete i.resp_cbs[n]
e.pool()
return}_.equal(Boolean(r&&false!==r.expecting_response),Boolean(n))
wsPakSendDest(i,e)}function wsPakSend(e,t){if("function"===typeof e&&!t){t=e
e=null}wsPakSendFinish(this,e,t)}function wsPak(e,t,r){_("string"===typeof e||"number"===typeof e)
var a=p(t?t.getInternalFlags():m(),t?t.totalSize()+I:0)
a.writeFlags()
n(a,r,e)
a.ws_data={msg:e,client:r}
a.send=wsPakSend
return a}function sendMessageInternal(e,t,r,a,i){var o=wsPak(t,h(a)?a:null,e)
if(!r)l(o,a)
o.send(r,i)}function sendMessage(e,t,r){sendMessageInternal(this,e,null,t,r)}function wsHandleMessage(o,e,t){++i.msgs
var r=Date.now()
var n=o.id?"client "+o.id:"server"
if(!(e instanceof Uint8Array)){(o.log?o:console).log("Received incorrect WebSocket data type from "+n+" ("+typeof e+")")
if("string"===typeof e)(o.log?o:console).log("Invalid WebSocket data: "+JSON.stringify(e.slice(0,120)))
if(o.ws_server){if(!o.has_warned_about_text){o.has_warned_about_text=true
o.send("error","Server received non-binary WebSocket data.  Likely cause is a proxy, VPN or something else intercepting and modifying network traffic.")}return}return void o.onError("Invalid data received")}i.bytes+=e.length
var a=g(e,e.length,false)
a.readFlags()
o.last_receive_time=r
o.idle_counter=0
return void s(o,n,a,function sendFunc(e,t,r,a){if(a&&!a.expecting_response)a=null
sendMessageInternal(o,e,t,r,a)},function pakFunc(e,t){return wsPak(e,t,o)},function handleFunc(e,t,r){var a=o.handlers[e]
if(!a){var i="No handler for message "+JSON.stringify(e)+" from "+n
console.error(i,h(t)?t.contents():t)
if(o.onError)return o.onError(i)
return r(i)}return a(o,t,r)},t)}},{"./ack.js":314,"./packet.js":325,"./perfcounters.js":326,assert:void 0}]},{},[10])

//# sourceMappingURL=app.bundle.js.map
